(self.webpackChunkbusinessgate=self.webpackChunkbusinessgate||[]).push([[502],{1401:(An,xt,H)=>{"use strict";H.d(xt,{Am:()=>kr,Bd:()=>nn,FA:()=>mn,Fy:()=>at,I9:()=>Gt,Im:()=>Er,Ku:()=>Je,Ll:()=>Ge,T9:()=>Xe,Uj:()=>xe,XA:()=>Le,ZQ:()=>Ze,bD:()=>us,cY:()=>Te,eX:()=>Tt,g:()=>sn,gR:()=>nr,hp:()=>Bt,jZ:()=>it,lT:()=>Ht,lV:()=>Cn,nr:()=>Pt,sr:()=>bn,tD:()=>pt,u:()=>se,zW:()=>Qe,zw:()=>He});const m=function(Ae){const Ne=[];let ft=0;for(let Vt=0;Vt<Ae.length;Vt++){let Rt=Ae.charCodeAt(Vt);Rt<128?Ne[ft++]=Rt:Rt<2048?(Ne[ft++]=Rt>>6|192,Ne[ft++]=63&Rt|128):55296==(64512&Rt)&&Vt+1<Ae.length&&56320==(64512&Ae.charCodeAt(Vt+1))?(Rt=65536+((1023&Rt)<<10)+(1023&Ae.charCodeAt(++Vt)),Ne[ft++]=Rt>>18|240,Ne[ft++]=Rt>>12&63|128,Ne[ft++]=Rt>>6&63|128,Ne[ft++]=63&Rt|128):(Ne[ft++]=Rt>>12|224,Ne[ft++]=Rt>>6&63|128,Ne[ft++]=63&Rt|128)}return Ne},De={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(Ae,Ne){if(!Array.isArray(Ae))throw Error("encodeByteArray takes an array as a parameter");this.init_();const ft=Ne?this.byteToCharMapWebSafe_:this.byteToCharMap_,Vt=[];for(let Rt=0;Rt<Ae.length;Rt+=3){const Mn=Ae[Rt],ar=Rt+1<Ae.length,wr=ar?Ae[Rt+1]:0,Hr=Rt+2<Ae.length,Li=Hr?Ae[Rt+2]:0;let _r=(15&wr)<<2|Li>>6,Bs=63&Li;Hr||(Bs=64,ar||(_r=64)),Vt.push(ft[Mn>>2],ft[(3&Mn)<<4|wr>>4],ft[_r],ft[Bs])}return Vt.join("")},encodeString(Ae,Ne){return this.HAS_NATIVE_SUPPORT&&!Ne?btoa(Ae):this.encodeByteArray(m(Ae),Ne)},decodeString(Ae,Ne){return this.HAS_NATIVE_SUPPORT&&!Ne?atob(Ae):function(Ae){const Ne=[];let ft=0,Vt=0;for(;ft<Ae.length;){const Rt=Ae[ft++];if(Rt<128)Ne[Vt++]=String.fromCharCode(Rt);else if(Rt>191&&Rt<224){const Mn=Ae[ft++];Ne[Vt++]=String.fromCharCode((31&Rt)<<6|63&Mn)}else if(Rt>239&&Rt<365){const Hr=((7&Rt)<<18|(63&Ae[ft++])<<12|(63&Ae[ft++])<<6|63&Ae[ft++])-65536;Ne[Vt++]=String.fromCharCode(55296+(Hr>>10)),Ne[Vt++]=String.fromCharCode(56320+(1023&Hr))}else{const Mn=Ae[ft++],ar=Ae[ft++];Ne[Vt++]=String.fromCharCode((15&Rt)<<12|(63&Mn)<<6|63&ar)}}return Ne.join("")}(this.decodeStringToByteArray(Ae,Ne))},decodeStringToByteArray(Ae,Ne){this.init_();const ft=Ne?this.charToByteMapWebSafe_:this.charToByteMap_,Vt=[];for(let Rt=0;Rt<Ae.length;){const Mn=ft[Ae.charAt(Rt++)],wr=Rt<Ae.length?ft[Ae.charAt(Rt)]:0;++Rt;const Li=Rt<Ae.length?ft[Ae.charAt(Rt)]:64;++Rt;const Wr=Rt<Ae.length?ft[Ae.charAt(Rt)]:64;if(++Rt,null==Mn||null==wr||null==Li||null==Wr)throw new Be;Vt.push(Mn<<2|wr>>4),64!==Li&&(Vt.push(wr<<4&240|Li>>2),64!==Wr&&Vt.push(Li<<6&192|Wr))}return Vt},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let Ae=0;Ae<this.ENCODED_VALS.length;Ae++)this.byteToCharMap_[Ae]=this.ENCODED_VALS.charAt(Ae),this.charToByteMap_[this.byteToCharMap_[Ae]]=Ae,this.byteToCharMapWebSafe_[Ae]=this.ENCODED_VALS_WEBSAFE.charAt(Ae),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[Ae]]=Ae,Ae>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(Ae)]=Ae,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(Ae)]=Ae)}}};class Be extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const xe=function(Ae){return function(Ae){const Ne=m(Ae);return De.encodeByteArray(Ne,!0)}(Ae).replace(/\./g,"")},se=function(Ae){try{return De.decodeString(Ae,!0)}catch(Ne){console.error("base64Decode failed: ",Ne)}return null};function He(Ae,Ne){if(!(Ne instanceof Object))return Ne;switch(Ne.constructor){case Date:return new Date(Ne.getTime());case Object:void 0===Ae&&(Ae={});break;case Array:Ae=[];break;default:return Ne}for(const ft in Ne)!Ne.hasOwnProperty(ft)||!qe(ft)||(Ae[ft]=He(Ae[ft],Ne[ft]));return Ae}function qe(Ae){return"__proto__"!==Ae}const ct=()=>{try{return function Oe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const Ae=process.env.__FIREBASE_DEFAULTS__;return Ae?JSON.parse(Ae):void 0})()||(()=>{if(typeof document>"u")return;let Ae;try{Ae=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const Ne=Ae&&se(Ae[1]);return Ne&&JSON.parse(Ne)})()}catch(Ae){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${Ae}`)}},Xe=()=>{var Ae;return null===(Ae=ct())||void 0===Ae?void 0:Ae.config},Le=Ae=>{var Ne;return null===(Ne=ct())||void 0===Ne?void 0:Ne[`_${Ae}`]};class Te{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((Ne,ft)=>{this.resolve=Ne,this.reject=ft})}wrapCallback(Ne){return(ft,Vt)=>{ft?this.reject(ft):this.resolve(Vt),"function"==typeof Ne&&(this.promise.catch(()=>{}),1===Ne.length?Ne(ft):Ne(ft,Vt))}}}function at(Ae,Ne){if(Ae.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const Vt=Ne||"demo-project",Rt=Ae.iat||0,Mn=Ae.sub||Ae.user_id;if(!Mn)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const ar=Object.assign({iss:`https://securetoken.google.com/${Vt}`,aud:Vt,iat:Rt,exp:Rt+3600,auth_time:Rt,sub:Mn,user_id:Mn,firebase:{sign_in_provider:"custom",identities:{}}},Ae);return[xe(JSON.stringify({alg:"none",type:"JWT"})),xe(JSON.stringify(ar)),""].join(".")}function Ze(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function it(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ze())}function Ge(){var Ae;const Ne=null===(Ae=ct())||void 0===Ae?void 0:Ae.forceEnvironment;if("node"===Ne)return!0;if("browser"===Ne)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch{return!1}}function nn(){return"object"==typeof self&&self.self===self}function bn(){const Ae="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof Ae&&void 0!==Ae.id}function Cn(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function Ht(){const Ae=Ze();return Ae.indexOf("MSIE ")>=0||Ae.indexOf("Trident/")>=0}function Pt(){return!Ge()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Qe(){try{return"object"==typeof indexedDB}catch{return!1}}function Tt(){return new Promise((Ae,Ne)=>{try{let ft=!0;const Vt="validate-browser-context-for-indexeddb-analytics-module",Rt=self.indexedDB.open(Vt);Rt.onsuccess=()=>{Rt.result.close(),ft||self.indexedDB.deleteDatabase(Vt),Ae(!0)},Rt.onupgradeneeded=()=>{ft=!1},Rt.onerror=()=>{var Mn;Ne((null===(Mn=Rt.error)||void 0===Mn?void 0:Mn.message)||"")}}catch(ft){Ne(ft)}})}class sn extends Error{constructor(Ne,ft,Vt){super(ft),this.code=Ne,this.customData=Vt,this.name="FirebaseError",Object.setPrototypeOf(this,sn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,mn.prototype.create)}}class mn{constructor(Ne,ft,Vt){this.service=Ne,this.serviceName=ft,this.errors=Vt}create(Ne,...ft){const Vt=ft[0]||{},Rt=`${this.service}/${Ne}`,Mn=this.errors[Ne],ar=Mn?function Vn(Ae,Ne){return Ae.replace(Fr,(ft,Vt)=>{const Rt=Ne[Vt];return null!=Rt?String(Rt):`<${Vt}?>`})}(Mn,Vt):"Error";return new sn(Rt,`${this.serviceName}: ${ar} (${Rt}).`,Vt)}}const Fr=/\{\$([^}]+)}/g;function nr(Ae,Ne){return Object.prototype.hasOwnProperty.call(Ae,Ne)}function Er(Ae){for(const Ne in Ae)if(Object.prototype.hasOwnProperty.call(Ae,Ne))return!1;return!0}function us(Ae,Ne){if(Ae===Ne)return!0;const ft=Object.keys(Ae),Vt=Object.keys(Ne);for(const Rt of ft){if(!Vt.includes(Rt))return!1;const Mn=Ae[Rt],ar=Ne[Rt];if(Hn(Mn)&&Hn(ar)){if(!us(Mn,ar))return!1}else if(Mn!==ar)return!1}for(const Rt of Vt)if(!ft.includes(Rt))return!1;return!0}function Hn(Ae){return null!==Ae&&"object"==typeof Ae}function kr(Ae){const Ne=[];for(const[ft,Vt]of Object.entries(Ae))Array.isArray(Vt)?Vt.forEach(Rt=>{Ne.push(encodeURIComponent(ft)+"="+encodeURIComponent(Rt))}):Ne.push(encodeURIComponent(ft)+"="+encodeURIComponent(Vt));return Ne.length?"&"+Ne.join("&"):""}function Gt(Ae){const Ne={};return Ae.replace(/^\?/,"").split("&").forEach(Vt=>{if(Vt){const[Rt,Mn]=Vt.split("=");Ne[decodeURIComponent(Rt)]=decodeURIComponent(Mn)}}),Ne}function Bt(Ae){const Ne=Ae.indexOf("?");if(!Ne)return"";const ft=Ae.indexOf("#",Ne);return Ae.substring(Ne,ft>0?ft:void 0)}function pt(Ae,Ne){const ft=new Mt(Ae,Ne);return ft.subscribe.bind(ft)}class Mt{constructor(Ne,ft){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=ft,this.task.then(()=>{Ne(this)}).catch(Vt=>{this.error(Vt)})}next(Ne){this.forEachObserver(ft=>{ft.next(Ne)})}error(Ne){this.forEachObserver(ft=>{ft.error(Ne)}),this.close(Ne)}complete(){this.forEachObserver(Ne=>{Ne.complete()}),this.close()}subscribe(Ne,ft,Vt){let Rt;if(void 0===Ne&&void 0===ft&&void 0===Vt)throw new Error("Missing Observer.");Rt=function Ur(Ae,Ne){if("object"!=typeof Ae||null===Ae)return!1;for(const ft of Ne)if(ft in Ae&&"function"==typeof Ae[ft])return!0;return!1}(Ne,["next","error","complete"])?Ne:{next:Ne,error:ft,complete:Vt},void 0===Rt.next&&(Rt.next=vi),void 0===Rt.error&&(Rt.error=vi),void 0===Rt.complete&&(Rt.complete=vi);const Mn=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?Rt.error(this.finalError):Rt.complete()}catch{}}),this.observers.push(Rt),Mn}unsubscribeOne(Ne){void 0===this.observers||void 0===this.observers[Ne]||(delete this.observers[Ne],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(Ne){if(!this.finalized)for(let ft=0;ft<this.observers.length;ft++)this.sendOne(ft,Ne)}sendOne(Ne,ft){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[Ne])try{ft(this.observers[Ne])}catch(Vt){typeof console<"u"&&console.error&&console.error(Vt)}})}close(Ne){this.finalized||(this.finalized=!0,void 0!==Ne&&(this.finalError=Ne),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function vi(){}function Je(Ae){return Ae&&Ae._delegate?Ae._delegate:Ae}},2373:(An,xt,H)=>{"use strict";H.d(xt,{a9:()=>sn,T5:()=>Fr,hT:()=>Ot,Pt:()=>mn,wv:()=>on,YG:()=>Vn});var O=H(1769),z=H(9868),ye=H(5640);const m=(Hn,Sr,kr)=>{let Gt,Bt;return Ce=>{Sr.value>=0&&(Ce||kr)&&(Bt=Sr.value-(Gt||0),(Bt||void 0===Gt)&&(Gt=Sr.value,Sr.delta=Bt,Hn(Sr)))}};var ae=H(4756),Be=H(4872);const Ve=()=>{const Hn=(0,Be.z)();return Hn&&Hn.activationStart||0},xe=(Hn,Sr)=>{const kr=(0,Be.z)();let Gt="navigate";return kr&&(Gt=ae.j.document.prerendering||Ve()>0?"prerender":kr.type.replace(/_/g,"-")),{name:Hn,value:typeof Sr>"u"?-1:Sr,rating:"good",delta:0,entries:[],id:`v3-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:Gt}},se=(Hn,Sr,kr)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(Hn)){const Gt=new PerformanceObserver(Bt=>{Sr(Bt.getEntries())});return Gt.observe(Object.assign({type:Hn,buffered:!0},kr||{})),Gt}}catch{}};var me=H(7423);const He=Hn=>{const Sr=xe("CLS",0);let kr,Gt=0,Bt=[];const Ce=Mt=>{Mt.forEach(hn=>{hn.hadRecentInput||(Gt&&0!==Bt.length&&hn.startTime-Bt[Bt.length-1].startTime<1e3&&hn.startTime-Bt[0].startTime<5e3?(Gt+=hn.value,Bt.push(hn)):(Gt=hn.value,Bt=[hn]),Gt>Sr.value&&(Sr.value=Gt,Sr.entries=Bt,kr&&kr()))})},pt=se("layout-shift",Ce);if(pt){kr=m(Hn,Sr);const Mt=()=>{Ce(pt.takeRecords()),kr(!0)};return(0,me.Q)(Mt),Mt}};var qe=H(8810);const Oe=Hn=>{const Sr=(0,qe.N)(),kr=xe("FID");let Gt;const Bt=Mt=>{Mt.startTime<Sr.firstHiddenTime&&(kr.value=Mt.processingStart-Mt.startTime,kr.entries.push(Mt),Gt(!0))},Ce=Mt=>{Mt.forEach(Bt)},pt=se("first-input",Ce);Gt=m(Hn,kr),pt&&(0,me.Q)(()=>{Ce(pt.takeRecords()),pt.disconnect()},!0)};let je=0,ht=1/0,et=0;const ct=Hn=>{Hn.forEach(Sr=>{Sr.interactionId&&(ht=Math.min(ht,Sr.interactionId),et=Math.max(et,Sr.interactionId),je=et?(et-ht)/7+1:0)})};let Ue;const Le=()=>Ue?je:performance.interactionCount||0,at=[],Ze={},it=Hn=>{const kr=Ze[Hn.interactionId];if(kr||at.length<10||Hn.duration>at[at.length-1].latency){if(kr)kr.entries.push(Hn),kr.latency=Math.max(kr.latency,Hn.duration);else{const Gt={id:Hn.interactionId,latency:Hn.duration,entries:[Hn]};Ze[Gt.id]=Gt,at.push(Gt)}at.sort((Gt,Bt)=>Bt.latency-Gt.latency),at.splice(10).forEach(Gt=>{delete Ze[Gt.id]})}},nn=(Hn,Sr)=>{Sr=Sr||{},"interactionCount"in performance||Ue||(Ue=se("event",ct,{type:"event",buffered:!0,durationThreshold:0}));const kr=xe("INP");let Gt;const Bt=pt=>{pt.forEach(hn=>{hn.interactionId&&it(hn),"first-input"===hn.entryType&&!at.some(vi=>vi.entries.some($r=>hn.duration===$r.duration&&hn.startTime===$r.startTime))&&it(hn)});const Mt=(()=>{const Hn=Math.min(at.length-1,Math.floor(Le()/50));return at[Hn]})();Mt&&Mt.latency!==kr.value&&(kr.value=Mt.latency,kr.entries=Mt.entries,Gt())},Ce=se("event",Bt,{durationThreshold:Sr.durationThreshold||40});Gt=m(Hn,kr,Sr.reportAllChanges),Ce&&(Ce.observe({type:"first-input",buffered:!0}),(0,me.Q)(()=>{Bt(Ce.takeRecords()),kr.value<0&&Le()>0&&(kr.value=0,kr.entries=[]),Gt(!0)}))},bn={},Cn=Hn=>{const Sr=(0,qe.N)(),kr=xe("LCP");let Gt;const Bt=pt=>{const Mt=pt[pt.length-1];if(Mt){const hn=Math.max(Mt.startTime-Ve(),0);hn<Sr.firstHiddenTime&&(kr.value=hn,kr.entries=[Mt],Gt())}},Ce=se("largest-contentful-paint",Bt);if(Ce){Gt=m(Hn,kr);const pt=()=>{bn[kr.id]||(Bt(Ce.takeRecords()),Ce.disconnect(),bn[kr.id]=!0,Gt(!0))};return["keydown","click"].forEach(Mt=>{addEventListener(Mt,pt,{once:!0,capture:!0})}),(0,me.Q)(pt,!0),pt}},qt=Hn=>{ae.j.document&&(ae.j.document.prerendering?addEventListener("prerenderingchange",()=>qt(Hn),!0):"complete"!==ae.j.document.readyState?addEventListener("load",()=>qt(Hn),!0):setTimeout(Hn,0))},Ht=(Hn,Sr)=>{Sr=Sr||{};const kr=xe("TTFB"),Gt=m(Hn,kr,Sr.reportAllChanges);qt(()=>{const Bt=(0,Be.z)();if(Bt){if(kr.value=Math.max(Bt.responseStart-Ve(),0),kr.value<0||kr.value>performance.now())return;kr.entries=[Bt],Gt(!0)}})},lt={},Ct={};let Pt,Qe,Tt,$t,Qt;function sn(Hn,Sr=!1){return mr("cls",Hn,jr,Pt,Sr)}function mn(Hn,Sr=!1){return mr("lcp",Hn,Ai,Tt,Sr)}function Vn(Hn){return mr("ttfb",Hn,Ri,$t)}function Fr(Hn){return mr("fid",Hn,ur,Qe)}function Ot(Hn){return mr("inp",Hn,nr,Qt)}function on(Hn,Sr){return Zn(Hn,Sr),Ct[Hn]||(function Er(Hn){const Sr={};"event"===Hn&&(Sr.durationThreshold=0),se(Hn,kr=>{Or(Hn,{entries:kr})},Sr)}(Hn),Ct[Hn]=!0),us(Hn,Sr)}function Or(Hn,Sr){const kr=lt[Hn];if(kr&&kr.length)for(const Gt of kr)try{Gt(Sr)}catch(Bt){ye.T&&O.vF.error(`Error while triggering instrumentation handler.\nType: ${Hn}\nName: ${(0,z.qQ)(Gt)}\nError:`,Bt)}}function jr(){return He(Hn=>{Or("cls",{metric:Hn}),Pt=Hn})}function ur(){return Oe(Hn=>{Or("fid",{metric:Hn}),Qe=Hn})}function Ai(){return Cn(Hn=>{Or("lcp",{metric:Hn}),Tt=Hn})}function Ri(){return Ht(Hn=>{Or("ttfb",{metric:Hn}),$t=Hn})}function nr(){return nn(Hn=>{Or("inp",{metric:Hn}),Qt=Hn})}function mr(Hn,Sr,kr,Gt,Bt=!1){let Ce;return Zn(Hn,Sr),Ct[Hn]||(Ce=kr(),Ct[Hn]=!0),Gt&&Sr({metric:Gt}),us(Hn,Sr,Bt?Ce:void 0)}function Zn(Hn,Sr){lt[Hn]=lt[Hn]||[],lt[Hn].push(Sr)}function us(Hn,Sr,kr){return()=>{kr&&kr();const Gt=lt[Hn];if(!Gt)return;const Bt=Gt.indexOf(Sr);-1!==Bt&&Gt.splice(Bt,1)}}},4756:(An,xt,H)=>{"use strict";H.d(xt,{j:()=>z});const z=H(7018).OW},4872:(An,xt,H)=>{"use strict";H.d(xt,{z:()=>ye});var O=H(4756);const ye=()=>O.j.__WEB_VITALS_POLYFILL__?O.j.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||(()=>{const m=O.j.performance.timing,ae=O.j.performance.navigation.type,De={entryType:"navigation",startTime:0,type:2==ae?"back_forward":1===ae?"reload":"navigate"};for(const Be in m)"navigationStart"!==Be&&"toJSON"!==Be&&(De[Be]=Math.max(m[Be]-m.navigationStart,0));return De})()):O.j.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},8810:(An,xt,H)=>{"use strict";H.d(xt,{N:()=>De});var O=H(4756),z=H(7423);let ye=-1;const De=()=>(ye<0&&(ye="hidden"!==O.j.document.visibilityState||O.j.document.prerendering?1/0:0,(0,z.Q)(({timeStamp:Be})=>{ye=Be},!0)),{get firstHiddenTime(){return ye}})},7423:(An,xt,H)=>{"use strict";H.d(xt,{Q:()=>z});var O=H(4756);const z=(ye,m)=>{const ae=De=>{("pagehide"===De.type||"hidden"===O.j.document.visibilityState)&&(ye(De),m&&(removeEventListener("visibilitychange",ae,!0),removeEventListener("pagehide",ae,!0)))};addEventListener("visibilitychange",ae,!0),addEventListener("pagehide",ae,!0)}},5640:(An,xt,H)=>{"use strict";H.d(xt,{T:()=>O});const O=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__},8251:(An,xt,H)=>{"use strict";H.d(xt,{Z:()=>Be,k:()=>Ve});var O=H(7474),z=H(3892);const ye="7";function m(xe){return`${xe.protocol?`${xe.protocol}:`:""}//${xe.host}${xe.port?`:${xe.port}`:""}${xe.path?`/${xe.path}`:""}/api/`}function Be(xe,se={}){const He="string"!=typeof se&&se._metadata?se._metadata.sdk:void 0;return("string"==typeof se?se:se.tunnel)||`${function ae(xe){return`${m(xe)}${xe.projectId}/envelope/`}(xe)}?${function De(xe,se){return(0,O.u4)({sentry_key:xe.publicKey,sentry_version:ye,...se&&{sentry_client:`${se.name}/${se.version}`}})}(xe,He)}`}function Ve(xe,se){const me=(0,z.AD)(xe);if(!me)return"";const He=`${m(me)}embed/error-page/`;let qe=`dsn=${(0,z.SB)(me)}`;for(const Oe in se)if("dsn"!==Oe&&"onClose"!==Oe)if("user"===Oe){const je=se.user;if(!je)continue;je.name&&(qe+=`&name=${encodeURIComponent(je.name)}`),je.email&&(qe+=`&email=${encodeURIComponent(je.email)}`)}else qe+=`&${encodeURIComponent(Oe)}=${encodeURIComponent(se[Oe])}`;return`${He}?${qe}`}},5948:(An,xt,H)=>{"use strict";H.d(xt,{V:()=>it,S:()=>qt});var O=H(3892),z=H(1769),ye=H(781),m=H(5801),ae=H(7473),De=H(4965),Be=H(6619),Ve=H(8251),xe=H(557),qe=H(2248),Oe=H(5560),je=H(1057);var Le=H(9439),Te=H(3787),at=H(3400);const Ze="Not capturing exception because it's already been captured.";class it{constructor(lt){if(this._options=lt,this._integrations={},this._integrationsInitialized=!1,this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],lt.dsn?this._dsn=(0,O.AD)(lt.dsn):xe.T&&z.vF.warn("No DSN provided, client will not send events."),this._dsn){const Ct=(0,Ve.Z)(this._dsn,lt);this._transport=lt.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...lt.transportOptions,url:Ct})}}captureException(lt,Ct,Pt){if((0,ye.GR)(lt))return void(xe.T&&z.vF.log(Ze));let Qe=Ct&&Ct.event_id;return this._process(this.eventFromException(lt,Ct).then(Tt=>this._captureEvent(Tt,Ct,Pt)).then(Tt=>{Qe=Tt})),Qe}captureMessage(lt,Ct,Pt,Qe){let Tt=Pt&&Pt.event_id;const $t=(0,m.NF)(lt)?lt:String(lt),Qt=(0,m.sO)(lt)?this.eventFromMessage($t,Ct,Pt):this.eventFromException(lt,Pt);return this._process(Qt.then(sn=>this._captureEvent(sn,Pt,Qe)).then(sn=>{Tt=sn})),Tt}captureEvent(lt,Ct,Pt){if(Ct&&Ct.originalException&&(0,ye.GR)(Ct.originalException))return void(xe.T&&z.vF.log(Ze));let Qe=Ct&&Ct.event_id;return this._process(this._captureEvent(lt,Ct,(lt.sdkProcessingMetadata||{}).capturedSpanScope||Pt).then(Qt=>{Qe=Qt})),Qe}captureSession(lt){"string"!=typeof lt.release?xe.T&&z.vF.warn("Discarded session because of missing or non-string release"):(this.sendSession(lt),(0,Le.qO)(lt,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(lt){const Ct=this._transport;return Ct?(this.metricsAggregator&&this.metricsAggregator.flush(),this._isClientDoneProcessing(lt).then(Pt=>Ct.flush(lt).then(Qe=>Pt&&Qe))):(0,ae.XW)(!0)}close(lt){return this.flush(lt).then(Ct=>(this.getOptions().enabled=!1,this.metricsAggregator&&this.metricsAggregator.close(),Ct))}getEventProcessors(){return this._eventProcessors}addEventProcessor(lt){this._eventProcessors.push(lt)}setupIntegrations(lt){(lt&&!this._integrationsInitialized||this._isEnabled()&&!this._integrationsInitialized)&&this._setupIntegrations()}init(){this._isEnabled()&&this._setupIntegrations()}getIntegrationById(lt){return this.getIntegrationByName(lt)}getIntegrationByName(lt){return this._integrations[lt]}getIntegration(lt){try{return this._integrations[lt.id]||null}catch{return xe.T&&z.vF.warn(`Cannot retrieve integration ${lt.id} from the current Client`),null}}addIntegration(lt){const Ct=this._integrations[lt.name];(0,je.qm)(this,lt,this._integrations),Ct||(0,je.lc)(this,[lt])}sendEvent(lt,Ct={}){this.emit("beforeSendEvent",lt,Ct);let Pt=function He(Ht,lt,Ct,Pt){const Qe=(0,De.Cj)(Ct),Tt=Ht.type&&"replay_event"!==Ht.type?Ht.type:"event";!function se(Ht,lt){lt&&(Ht.sdk=Ht.sdk||{},Ht.sdk.name=Ht.sdk.name||lt.name,Ht.sdk.version=Ht.sdk.version||lt.version,Ht.sdk.integrations=[...Ht.sdk.integrations||[],...lt.integrations||[]],Ht.sdk.packages=[...Ht.sdk.packages||[],...lt.packages||[]])}(Ht,Ct&&Ct.sdk);const $t=(0,De.n2)(Ht,Qe,Pt,lt);return delete Ht.sdkProcessingMetadata,(0,De.h4)($t,[[{type:Tt},Ht]])}(lt,this._dsn,this._options._metadata,this._options.tunnel);for(const Tt of Ct.attachments||[])Pt=(0,De.W3)(Pt,(0,De.bm)(Tt,this._options.transportOptions&&this._options.transportOptions.textEncoder));const Qe=this._sendEnvelope(Pt);Qe&&Qe.then(Tt=>this.emit("afterSendEvent",lt,Tt),null)}sendSession(lt){const Ct=function me(Ht,lt,Ct,Pt){const Qe=(0,De.Cj)(Ct),Tt={sent_at:(new Date).toISOString(),...Qe&&{sdk:Qe},...!!Pt&&lt&&{dsn:(0,O.SB)(lt)}},$t="aggregates"in Ht?[{type:"sessions"},Ht]:[{type:"session"},Ht.toJSON()];return(0,De.h4)(Tt,[$t])}(lt,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(Ct)}recordDroppedEvent(lt,Ct,Pt){if(this._options.sendClientReports){const Qe=`${lt}:${Ct}`;xe.T&&z.vF.log(`Adding outcome: "${Qe}"`),this._outcomes[Qe]=this._outcomes[Qe]+1||1}}captureAggregateMetrics(lt){xe.T&&z.vF.log(`Flushing aggregated metrics, number of metrics: ${lt.length}`);const Ct=function nt(Ht,lt,Ct,Pt){const Qe={sent_at:(new Date).toISOString()};Ct&&Ct.sdk&&(Qe.sdk={name:Ct.sdk.name,version:Ct.sdk.version}),Pt&&lt&&(Qe.dsn=(0,O.SB)(lt));const Tt=function Xe(Ht){const lt=function ct(Ht){let lt="";for(const Ct of Ht){const Pt=Object.entries(Ct.tags),Qe=Pt.length>0?`|#${Pt.map(([Tt,$t])=>`${Tt}:${$t}`).join(",")}`:"";lt+=`${Ct.name}@${Ct.unit}:${Ct.metric}|${Ct.metricType}${Qe}|T${Ct.timestamp}\n`}return lt}(Ht);return[{type:"statsd",length:lt.length},lt]}(Ht);return(0,De.h4)(Qe,[Tt])}(lt,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(Ct)}on(lt,Ct){this._hooks[lt]||(this._hooks[lt]=[]),this._hooks[lt].push(Ct)}emit(lt,...Ct){this._hooks[lt]&&this._hooks[lt].forEach(Pt=>Pt(...Ct))}_setupIntegrations(){const{integrations:lt}=this._options;this._integrations=(0,je.P$)(this,lt),(0,je.lc)(this,lt),this._integrationsInitialized=!0}_updateSessionFromEvent(lt,Ct){let Pt=!1,Qe=!1;const Tt=Ct.exception&&Ct.exception.values;if(Tt){Qe=!0;for(const sn of Tt){const mn=sn.mechanism;if(mn&&!1===mn.handled){Pt=!0;break}}}const $t="ok"===lt.status;($t&&0===lt.errors||$t&&Pt)&&((0,Le.qO)(lt,{...Pt&&{status:"crashed"},errors:lt.errors||Number(Qe||Pt)}),this.captureSession(lt))}_isClientDoneProcessing(lt){return new ae.T2(Ct=>{let Pt=0;const Tt=setInterval(()=>{0==this._numProcessing?(clearInterval(Tt),Ct(!0)):(Pt+=1,lt&&Pt>=lt&&(clearInterval(Tt),Ct(!1)))},1)})}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(lt,Ct,Pt,Qe=(0,Oe.rm)()){const Tt=this.getOptions(),$t=Object.keys(this._integrations);return!Ct.integrations&&$t.length>0&&(Ct.integrations=$t),this.emit("preprocessEvent",lt,Ct),(0,at.mG)(Tt,lt,Ct,Pt,this,Qe).then(Qt=>{if(null===Qt)return Qt;const sn={...Qe.getPropagationContext(),...Pt?Pt.getPropagationContext():void 0};if((!Qt.contexts||!Qt.contexts.trace)&&sn){const{traceId:Vn,spanId:Fr,parentSpanId:Ot,dsc:on}=sn;Qt.contexts={trace:{trace_id:Vn,span_id:Fr,parent_span_id:Ot},...Qt.contexts};const Or=on||(0,Te.l)(Vn,this,Pt);Qt.sdkProcessingMetadata={dynamicSamplingContext:Or,...Qt.sdkProcessingMetadata}}return Qt})}_captureEvent(lt,Ct={},Pt){return this._processEvent(lt,Ct,Pt).then(Qe=>Qe.event_id,Qe=>{if(xe.T){const Tt=Qe;"log"===Tt.logLevel?z.vF.log(Tt.message):z.vF.warn(Tt)}})}_processEvent(lt,Ct,Pt){const Qe=this.getOptions(),{sampleRate:Tt}=Qe,$t=Cn(lt),Qt=bn(lt),sn=lt.type||"error",mn=`before send for type \`${sn}\``;if(Qt&&"number"==typeof Tt&&Math.random()>Tt)return this.recordDroppedEvent("sample_rate","error",lt),(0,ae.xg)(new Be.U(`Discarding event because it's not included in the random sample (sampling rate = ${Tt})`,"log"));const Vn="replay_event"===sn?"replay":sn;return this._prepareEvent(lt,Ct,Pt,(lt.sdkProcessingMetadata||{}).capturedSpanIsolationScope).then(on=>{if(null===on)throw this.recordDroppedEvent("event_processor",Vn,lt),new Be.U("An event processor returned `null`, will not send event.","log");if(Ct.data&&!0===Ct.data.__sentry__)return on;const jr=function nn(Ht,lt,Ct){const{beforeSend:Pt,beforeSendTransaction:Qe}=Ht;return bn(lt)&&Pt?Pt(lt,Ct):Cn(lt)&&Qe?Qe(lt,Ct):lt}(Qe,on,Ct);return function Ge(Ht,lt){const Ct=`${lt} must return \`null\` or a valid event.`;if((0,m.Qg)(Ht))return Ht.then(Pt=>{if(!(0,m.Qd)(Pt)&&null!==Pt)throw new Be.U(Ct);return Pt},Pt=>{throw new Be.U(`${lt} rejected with ${Pt}`)});if(!(0,m.Qd)(Ht)&&null!==Ht)throw new Be.U(Ct);return Ht}(jr,mn)}).then(on=>{if(null===on)throw this.recordDroppedEvent("before_send",Vn,lt),new Be.U(`${mn} returned \`null\`, will not send event.`,"log");const Or=Pt&&Pt.getSession();!$t&&Or&&this._updateSessionFromEvent(Or,on);const jr=on.transaction_info;if($t&&jr&&on.transaction!==lt.transaction){const ur="custom";on.transaction_info={...jr,source:ur}}return this.sendEvent(on,Ct),on}).then(null,on=>{throw on instanceof Be.U?on:(this.captureException(on,{data:{__sentry__:!0},originalException:on}),new Be.U(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${on}`))})}_process(lt){this._numProcessing++,lt.then(Ct=>(this._numProcessing--,Ct),Ct=>(this._numProcessing--,Ct))}_sendEnvelope(lt){if(this.emit("beforeEnvelope",lt),this._isEnabled()&&this._transport)return this._transport.send(lt).then(null,Ct=>{xe.T&&z.vF.error("Error while sending event:",Ct)});xe.T&&z.vF.error("Transport disabled")}_clearOutcomes(){const lt=this._outcomes;return this._outcomes={},Object.keys(lt).map(Ct=>{const[Pt,Qe]=Ct.split(":");return{reason:Pt,category:Qe,quantity:lt[Ct]}})}}function bn(Ht){return void 0===Ht.type}function Cn(Ht){return"transaction"===Ht.type}function qt(Ht){const lt=(0,qe.KU)();!lt||!lt.addEventProcessor||lt.addEventProcessor(Ht)}},6754:(An,xt,H)=>{"use strict";H.d(xt,{U:()=>O});const O="production"},557:(An,xt,H)=>{"use strict";H.d(xt,{T:()=>O});const O=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__},7266:(An,xt,H)=>{"use strict";H.d(xt,{jB:()=>Ve,lG:()=>De,lb:()=>Be});var O=H(7018),z=H(7473),ye=H(1769),m=H(5801),ae=H(557);function De(){return(0,O.BY)("globalEventProcessors",()=>[])}function Be(xe){De().push(xe)}function Ve(xe,se,me,He=0){return new z.T2((qe,Oe)=>{const je=xe[He];if(null===se||"function"!=typeof je)qe(se);else{const ht=je({...se},me);ae.T&&je.id&&null===ht&&ye.vF.log(`Event processor "${je.id}" dropped event`),(0,m.Qg)(ht)?ht.then(et=>Ve(xe,et,me,He+1).then(qe)).then(null,Oe):Ve(xe,ht,me,He+1).then(qe).then(null,Oe)}})}},2248:(An,xt,H)=>{"use strict";H.d(xt,{Cp:()=>De,J0:()=>qt,J5:()=>Ct,KU:()=>nn,ZQ:()=>se,o:()=>me,o5:()=>Cn,r:()=>Ve,v4:()=>et});var O=H(7018),z=H(6754),ye=H(5560),m=H(9439),ae=H(3400);function De(Pt,Qe){return(0,ye.BF)().captureException(Pt,(0,ae.li)(Qe))}function Ve(Pt,Qe){return(0,ye.BF)().captureEvent(Pt,Qe)}function se(Pt,Qe){(0,ye.BF)().addBreadcrumb(Pt,Qe)}function me(Pt,Qe){(0,ye.BF)().setContext(Pt,Qe)}function et(...Pt){const Qe=(0,ye.BF)();if(2===Pt.length){const[Tt,$t]=Pt;return Qe.withScope(Tt?()=>(Qe.getStackTop().scope=Tt,$t(Tt)):$t)}return Qe.withScope(Pt[0])}function nn(){return(0,ye.BF)().getClient()}function Cn(){return(0,ye.BF)().getScope()}function qt(Pt){const Qe=nn(),Tt=(0,ye.rm)(),$t=Cn(),{release:Qt,environment:sn=z.U}=Qe&&Qe.getOptions()||{},{userAgent:mn}=O.OW.navigator||{},Vn=(0,m.fj)({release:Qt,environment:sn,user:$t.getUser()||Tt.getUser(),...mn&&{userAgent:mn},...Pt}),Fr=Tt.getSession();return Fr&&"ok"===Fr.status&&(0,m.qO)(Fr,{status:"exited"}),Ht(),Tt.setSession(Vn),$t.setSession(Vn),Vn}function Ht(){const Pt=(0,ye.rm)(),Qe=Cn(),Tt=Qe.getSession()||Pt.getSession();Tt&&(0,m.Vu)(Tt),lt(),Pt.setSession(),Qe.setSession()}function lt(){const Pt=(0,ye.rm)(),Qe=Cn(),Tt=nn(),$t=Qe.getSession()||Pt.getSession();$t&&Tt&&Tt.captureSession&&Tt.captureSession($t)}function Ct(Pt=!1){Pt?Ht():lt()}},5560:(An,xt,H)=>{"use strict";H.d(xt,{BF:()=>ht,EU:()=>Oe,rm:()=>et});var O=H(5801),z=H(781),ye=H(5800),m=H(1769),ae=H(7018),De=H(6754),Be=H(557),Ve=H(647),xe=H(9439),se=H(7199);const me=parseFloat(se.M),He=100;class qe{constructor(it,Ge,nn,bn=me){let Cn,qt;this._version=bn,Ge?Cn=Ge:(Cn=new Ve.HG,Cn.setClient(it)),nn?qt=nn:(qt=new Ve.HG,qt.setClient(it)),this._stack=[{scope:Cn}],it&&this.bindClient(it),this._isolationScope=qt}isOlderThan(it){return this._version<it}bindClient(it){const Ge=this.getStackTop();Ge.client=it,Ge.scope.setClient(it),it&&it.setupIntegrations&&it.setupIntegrations()}pushScope(){const it=this.getScope().clone();return this.getStack().push({client:this.getClient(),scope:it}),it}popScope(){return!(this.getStack().length<=1||!this.getStack().pop())}withScope(it){const Ge=this.pushScope();let nn;try{nn=it(Ge)}catch(bn){throw this.popScope(),bn}return(0,O.Qg)(nn)?nn.then(bn=>(this.popScope(),bn),bn=>{throw this.popScope(),bn}):(this.popScope(),nn)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(it,Ge){const nn=this._lastEventId=Ge&&Ge.event_id?Ge.event_id:(0,z.eJ)(),bn=new Error("Sentry syntheticException");return this.getScope().captureException(it,{originalException:it,syntheticException:bn,...Ge,event_id:nn}),nn}captureMessage(it,Ge,nn){const bn=this._lastEventId=nn&&nn.event_id?nn.event_id:(0,z.eJ)(),Cn=new Error(it);return this.getScope().captureMessage(it,Ge,{originalException:it,syntheticException:Cn,...nn,event_id:bn}),bn}captureEvent(it,Ge){const nn=Ge&&Ge.event_id?Ge.event_id:(0,z.eJ)();return it.type||(this._lastEventId=nn),this.getScope().captureEvent(it,{...Ge,event_id:nn}),nn}lastEventId(){return this._lastEventId}addBreadcrumb(it,Ge){const{scope:nn,client:bn}=this.getStackTop();if(!bn)return;const{beforeBreadcrumb:Cn=null,maxBreadcrumbs:qt=He}=bn.getOptions&&bn.getOptions()||{};if(qt<=0)return;const lt={timestamp:(0,ye.lu)(),...it},Ct=Cn?(0,m.pq)(()=>Cn(lt,Ge)):lt;null!==Ct&&(bn.emit&&bn.emit("beforeAddBreadcrumb",Ct,Ge),nn.addBreadcrumb(Ct,qt))}setUser(it){this.getScope().setUser(it),this.getIsolationScope().setUser(it)}setTags(it){this.getScope().setTags(it),this.getIsolationScope().setTags(it)}setExtras(it){this.getScope().setExtras(it),this.getIsolationScope().setExtras(it)}setTag(it,Ge){this.getScope().setTag(it,Ge),this.getIsolationScope().setTag(it,Ge)}setExtra(it,Ge){this.getScope().setExtra(it,Ge),this.getIsolationScope().setExtra(it,Ge)}setContext(it,Ge){this.getScope().setContext(it,Ge),this.getIsolationScope().setContext(it,Ge)}configureScope(it){const{scope:Ge,client:nn}=this.getStackTop();nn&&it(Ge)}run(it){const Ge=je(this);try{it(this)}finally{je(Ge)}}getIntegration(it){const Ge=this.getClient();if(!Ge)return null;try{return Ge.getIntegration(it)}catch{return Be.T&&m.vF.warn(`Cannot retrieve integration ${it.id} from the current Hub`),null}}startTransaction(it,Ge){const nn=this._callExtensionMethod("startTransaction",it,Ge);return Be.T&&!nn&&(this.getClient()?m.vF.warn("Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':\nSentry.addTracingExtensions();\nSentry.init({...});\n"):m.vF.warn("Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'")),nn}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(it=!1){if(it)return this.endSession();this._sendSessionUpdate()}endSession(){const Ge=this.getStackTop().scope,nn=Ge.getSession();nn&&(0,xe.Vu)(nn),this._sendSessionUpdate(),Ge.setSession()}startSession(it){const{scope:Ge,client:nn}=this.getStackTop(),{release:bn,environment:Cn=De.U}=nn&&nn.getOptions()||{},{userAgent:qt}=ae.OW.navigator||{},Ht=(0,xe.fj)({release:bn,environment:Cn,user:Ge.getUser(),...qt&&{userAgent:qt},...it}),lt=Ge.getSession&&Ge.getSession();return lt&&"ok"===lt.status&&(0,xe.qO)(lt,{status:"exited"}),this.endSession(),Ge.setSession(Ht),Ht}shouldSendDefaultPii(){const it=this.getClient(),Ge=it&&it.getOptions();return!(!Ge||!Ge.sendDefaultPii)}_sendSessionUpdate(){const{scope:it,client:Ge}=this.getStackTop(),nn=it.getSession();nn&&Ge&&Ge.captureSession&&Ge.captureSession(nn)}_callExtensionMethod(it,...Ge){const bn=Oe().__SENTRY__;if(bn&&bn.extensions&&"function"==typeof bn.extensions[it])return bn.extensions[it].apply(this,Ge);Be.T&&m.vF.warn(`Extension method ${it} couldn't be found, doing nothing.`)}}function Oe(){return ae.OW.__SENTRY__=ae.OW.__SENTRY__||{extensions:{},hub:void 0},ae.OW}function je(Ze){const it=Oe(),Ge=Te(it);return at(it,Ze),Ge}function ht(){const Ze=Oe();if(Ze.__SENTRY__&&Ze.__SENTRY__.acs){const it=Ze.__SENTRY__.acs.getCurrentHub();if(it)return it}return function ct(Ze=Oe()){return(!function Le(Ze){return!!(Ze&&Ze.__SENTRY__&&Ze.__SENTRY__.hub)}(Ze)||Te(Ze).isOlderThan(me))&&at(Ze,new qe),Te(Ze)}(Ze)}function et(){return ht().getIsolationScope()}function Te(Ze){return(0,ae.BY)("hub",()=>new qe,Ze)}function at(Ze,it){return!!Ze&&((Ze.__SENTRY__=Ze.__SENTRY__||{}).hub=it,!0)}},1057:(An,xt,H)=>{"use strict";H.d(xt,{F:()=>Oe,P$:()=>xe,_C:()=>je,lc:()=>se,mH:()=>Ve,qm:()=>me});var O=H(781),z=H(1769),ye=H(557),m=H(7266),ae=H(5560);const De=[];function Ve(ht){const et=ht.defaultIntegrations||[],ct=ht.integrations;let Ue;et.forEach(Le=>{Le.isDefaultInstance=!0}),Ue=Array.isArray(ct)?[...et,...ct]:"function"==typeof ct?(0,O.k9)(ct(et)):et;const nt=function Be(ht){const et={};return ht.forEach(ct=>{const{name:Ue}=ct,nt=et[Ue];nt&&!nt.isDefaultInstance&&ct.isDefaultInstance||(et[Ue]=ct)}),Object.keys(et).map(ct=>et[ct])}(Ue),Xe=function qe(ht,et){for(let ct=0;ct<ht.length;ct++)if(!0===et(ht[ct]))return ct;return-1}(nt,Le=>"Debug"===Le.name);if(-1!==Xe){const[Le]=nt.splice(Xe,1);nt.push(Le)}return nt}function xe(ht,et){const ct={};return et.forEach(Ue=>{Ue&&me(ht,Ue,ct)}),ct}function se(ht,et){for(const ct of et)ct&&ct.afterAllSetup&&ct.afterAllSetup(ht)}function me(ht,et,ct){if(ct[et.name])ye.T&&z.vF.log(`Integration skipped because it was already installed: ${et.name}`);else{if(ct[et.name]=et,-1===De.indexOf(et.name)&&(et.setupOnce(m.lb,ae.BF),De.push(et.name)),et.setup&&"function"==typeof et.setup&&et.setup(ht),ht.on&&"function"==typeof et.preprocessEvent){const Ue=et.preprocessEvent.bind(et);ht.on("preprocessEvent",(nt,Xe)=>Ue(nt,Xe,ht))}if(ht.addEventProcessor&&"function"==typeof et.processEvent){const Ue=et.processEvent.bind(et),nt=Object.assign((Xe,Le)=>Ue(Xe,Le,ht),{id:et.name});ht.addEventProcessor(nt)}ye.T&&z.vF.log(`Integration installed: ${et.name}`)}}function Oe(ht,et){return Object.assign(function(...Ue){return et(...Ue)},{id:ht})}function je(ht){return ht}},647:(An,xt,H)=>{"use strict";H.d(xt,{HG:()=>se,m6:()=>me});var O=H(5801),z=H(5800),ye=H(781),m=H(1769),ae=H(7266),De=H(9439),Be=H(186);let xe;class se{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=qe()}static clone(je){return je?je.clone():new se}clone(){const je=new se;return je._breadcrumbs=[...this._breadcrumbs],je._tags={...this._tags},je._extra={...this._extra},je._contexts={...this._contexts},je._user=this._user,je._level=this._level,je._span=this._span,je._session=this._session,je._transactionName=this._transactionName,je._fingerprint=this._fingerprint,je._eventProcessors=[...this._eventProcessors],je._requestSession=this._requestSession,je._attachments=[...this._attachments],je._sdkProcessingMetadata={...this._sdkProcessingMetadata},je._propagationContext={...this._propagationContext},je._client=this._client,je}setClient(je){this._client=je}getClient(){return this._client}addScopeListener(je){this._scopeListeners.push(je)}addEventProcessor(je){return this._eventProcessors.push(je),this}setUser(je){return this._user=je||{email:void 0,id:void 0,ip_address:void 0,segment:void 0,username:void 0},this._session&&(0,De.qO)(this._session,{user:je}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(je){return this._requestSession=je,this}setTags(je){return this._tags={...this._tags,...je},this._notifyScopeListeners(),this}setTag(je,ht){return this._tags={...this._tags,[je]:ht},this._notifyScopeListeners(),this}setExtras(je){return this._extra={...this._extra,...je},this._notifyScopeListeners(),this}setExtra(je,ht){return this._extra={...this._extra,[je]:ht},this._notifyScopeListeners(),this}setFingerprint(je){return this._fingerprint=je,this._notifyScopeListeners(),this}setLevel(je){return this._level=je,this._notifyScopeListeners(),this}setTransactionName(je){return this._transactionName=je,this._notifyScopeListeners(),this}setContext(je,ht){return null===ht?delete this._contexts[je]:this._contexts[je]=ht,this._notifyScopeListeners(),this}setSpan(je){return this._span=je,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const je=this._span;return je&&je.transaction}setSession(je){return je?this._session=je:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(je){if(!je)return this;const ht="function"==typeof je?je(this):je;if(ht instanceof se){const et=ht.getScopeData();this._tags={...this._tags,...et.tags},this._extra={...this._extra,...et.extra},this._contexts={...this._contexts,...et.contexts},et.user&&Object.keys(et.user).length&&(this._user=et.user),et.level&&(this._level=et.level),et.fingerprint.length&&(this._fingerprint=et.fingerprint),ht.getRequestSession()&&(this._requestSession=ht.getRequestSession()),et.propagationContext&&(this._propagationContext=et.propagationContext)}else if((0,O.Qd)(ht)){const et=je;this._tags={...this._tags,...et.tags},this._extra={...this._extra,...et.extra},this._contexts={...this._contexts,...et.contexts},et.user&&(this._user=et.user),et.level&&(this._level=et.level),et.fingerprint&&(this._fingerprint=et.fingerprint),et.requestSession&&(this._requestSession=et.requestSession),et.propagationContext&&(this._propagationContext=et.propagationContext)}return this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this._propagationContext=qe(),this}addBreadcrumb(je,ht){const et="number"==typeof ht?ht:100;if(et<=0)return this;const ct={timestamp:(0,z.lu)(),...je},Ue=this._breadcrumbs;return Ue.push(ct),this._breadcrumbs=Ue.length>et?Ue.slice(-et):Ue,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(je){return this._attachments.push(je),this}getAttachments(){return this.getScopeData().attachments}clearAttachments(){return this._attachments=[],this}getScopeData(){const{_breadcrumbs:je,_attachments:ht,_contexts:et,_tags:ct,_extra:Ue,_user:nt,_level:Xe,_fingerprint:Le,_eventProcessors:Te,_propagationContext:at,_sdkProcessingMetadata:Ze,_transactionName:it,_span:Ge}=this;return{breadcrumbs:je,attachments:ht,contexts:et,tags:ct,extra:Ue,user:nt,level:Xe,fingerprint:Le||[],eventProcessors:Te,propagationContext:at,sdkProcessingMetadata:Ze,transactionName:it,span:Ge}}applyToEvent(je,ht={},et=[]){(0,Be.e2)(je,this.getScopeData());const ct=[...et,...(0,ae.lG)(),...this._eventProcessors];return(0,ae.jB)(ct,je,ht)}setSDKProcessingMetadata(je){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...je},this}setPropagationContext(je){return this._propagationContext=je,this}getPropagationContext(){return this._propagationContext}captureException(je,ht){const et=ht&&ht.event_id?ht.event_id:(0,ye.eJ)();if(!this._client)return m.vF.warn("No client configured on scope - will not capture exception!"),et;const ct=new Error("Sentry syntheticException");return this._client.captureException(je,{originalException:je,syntheticException:ct,...ht,event_id:et},this),et}captureMessage(je,ht,et){const ct=et&&et.event_id?et.event_id:(0,ye.eJ)();if(!this._client)return m.vF.warn("No client configured on scope - will not capture message!"),ct;const Ue=new Error(je);return this._client.captureMessage(je,ht,{originalException:je,syntheticException:Ue,...et,event_id:ct},this),ct}captureEvent(je,ht){const et=ht&&ht.event_id?ht.event_id:(0,ye.eJ)();return this._client?(this._client.captureEvent(je,{...ht,event_id:et},this),et):(m.vF.warn("No client configured on scope - will not capture event!"),et)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(je=>{je(this)}),this._notifyingListeners=!1)}}function me(){return xe||(xe=new se),xe}function qe(){return{traceId:(0,ye.eJ)(),spanId:(0,ye.eJ)().substring(16)}}},962:(An,xt,H)=>{"use strict";H.d(xt,{E1:()=>ae,JD:()=>m,i_:()=>O,sy:()=>z,uT:()=>ye});const O="sentry.source",z="sentry.sample_rate",ye="sentry.op",m="sentry.origin",ae="profile_id"},9439:(An,xt,H)=>{"use strict";H.d(xt,{Vu:()=>De,fj:()=>m,qO:()=>ae});var O=H(5800),z=H(781),ye=H(7474);function m(Ve){const xe=(0,O.zf)(),se={sid:(0,z.eJ)(),init:!0,timestamp:xe,started:xe,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function Be(Ve){return(0,ye.Ce)({sid:`${Ve.sid}`,init:Ve.init,started:new Date(1e3*Ve.started).toISOString(),timestamp:new Date(1e3*Ve.timestamp).toISOString(),status:Ve.status,errors:Ve.errors,did:"number"==typeof Ve.did||"string"==typeof Ve.did?`${Ve.did}`:void 0,duration:Ve.duration,abnormal_mechanism:Ve.abnormal_mechanism,attrs:{release:Ve.release,environment:Ve.environment,ip_address:Ve.ipAddress,user_agent:Ve.userAgent}})}(se)};return Ve&&ae(se,Ve),se}function ae(Ve,xe={}){if(xe.user&&(!Ve.ipAddress&&xe.user.ip_address&&(Ve.ipAddress=xe.user.ip_address),!Ve.did&&!xe.did&&(Ve.did=xe.user.id||xe.user.email||xe.user.username)),Ve.timestamp=xe.timestamp||(0,O.zf)(),xe.abnormal_mechanism&&(Ve.abnormal_mechanism=xe.abnormal_mechanism),xe.ignoreDuration&&(Ve.ignoreDuration=xe.ignoreDuration),xe.sid&&(Ve.sid=32===xe.sid.length?xe.sid:(0,z.eJ)()),void 0!==xe.init&&(Ve.init=xe.init),!Ve.did&&xe.did&&(Ve.did=`${xe.did}`),"number"==typeof xe.started&&(Ve.started=xe.started),Ve.ignoreDuration)Ve.duration=void 0;else if("number"==typeof xe.duration)Ve.duration=xe.duration;else{const se=Ve.timestamp-Ve.started;Ve.duration=se>=0?se:0}xe.release&&(Ve.release=xe.release),xe.environment&&(Ve.environment=xe.environment),!Ve.ipAddress&&xe.ipAddress&&(Ve.ipAddress=xe.ipAddress),!Ve.userAgent&&xe.userAgent&&(Ve.userAgent=xe.userAgent),"number"==typeof xe.errors&&(Ve.errors=xe.errors),xe.status&&(Ve.status=xe.status)}function De(Ve,xe){let se={};xe?se={status:xe}:"ok"===Ve.status&&(se={status:"exited"}),ae(Ve,se)}},3787:(An,xt,H)=>{"use strict";H.d(xt,{k:()=>Be,l:()=>De});var O=H(7474),z=H(6754),ye=H(2248),m=H(1477),ae=H(3308);function De(Ve,xe,se){const me=xe.getOptions(),{publicKey:He}=xe.getDsn()||{},{segment:qe}=se&&se.getUser()||{},Oe=(0,O.Ce)({environment:me.environment||z.U,release:me.release,user_segment:qe,public_key:He,trace_id:Ve});return xe.emit&&xe.emit("createDsc",Oe),Oe}function Be(Ve){const xe=(0,ye.KU)();if(!xe)return{};const se=De((0,ae.et)(Ve).trace_id||"",xe,(0,ye.o5)()),me=(0,m.z)(Ve);if(!me)return se;const He=me&&me._frozenDynamicSamplingContext;if(He)return He;const{sampleRate:qe,source:Oe}=me.metadata;null!=qe&&(se.sample_rate=`${qe}`);const je=(0,ae.et)(me);return Oe&&"url"!==Oe&&(se.transaction=je.description),se.sampled=String((0,ae.pK)(me)),xe.emit&&xe.emit("createDsc",se),se}},186:(An,xt,H)=>{"use strict";H.d(xt,{Rg:()=>Be,e2:()=>De});var O=H(7474),z=H(781),ye=H(3787),m=H(1477),ae=H(3308);function De(Oe,je){const{fingerprint:ht,span:et,breadcrumbs:ct,sdkProcessingMetadata:Ue}=je;(function xe(Oe,je){const{extra:ht,tags:et,user:ct,contexts:Ue,level:nt,transactionName:Xe}=je,Le=(0,O.Ce)(ht);Le&&Object.keys(Le).length&&(Oe.extra={...Le,...Oe.extra});const Te=(0,O.Ce)(et);Te&&Object.keys(Te).length&&(Oe.tags={...Te,...Oe.tags});const at=(0,O.Ce)(ct);at&&Object.keys(at).length&&(Oe.user={...at,...Oe.user});const Ze=(0,O.Ce)(Ue);Ze&&Object.keys(Ze).length&&(Oe.contexts={...Ze,...Oe.contexts}),nt&&(Oe.level=nt),Xe&&(Oe.transaction=Xe)})(Oe,je),et&&function He(Oe,je){Oe.contexts={trace:(0,ae.kX)(je),...Oe.contexts};const ht=(0,m.z)(je);if(ht){Oe.sdkProcessingMetadata={dynamicSamplingContext:(0,ye.k)(je),...Oe.sdkProcessingMetadata};const et=(0,ae.et)(ht).description;et&&(Oe.tags={transaction:et,...Oe.tags})}}(Oe,et),function qe(Oe,je){Oe.fingerprint=Oe.fingerprint?(0,z.k9)(Oe.fingerprint):[],je&&(Oe.fingerprint=Oe.fingerprint.concat(je)),Oe.fingerprint&&!Oe.fingerprint.length&&delete Oe.fingerprint}(Oe,ht),function se(Oe,je){const ht=[...Oe.breadcrumbs||[],...je];Oe.breadcrumbs=ht.length?ht:void 0}(Oe,ct),function me(Oe,je){Oe.sdkProcessingMetadata={...Oe.sdkProcessingMetadata,...je}}(Oe,Ue)}function Be(Oe,je){const{extra:ht,tags:et,user:ct,contexts:Ue,level:nt,sdkProcessingMetadata:Xe,breadcrumbs:Le,fingerprint:Te,eventProcessors:at,attachments:Ze,propagationContext:it,transactionName:Ge,span:nn}=je;Ve(Oe,"extra",ht),Ve(Oe,"tags",et),Ve(Oe,"user",ct),Ve(Oe,"contexts",Ue),Ve(Oe,"sdkProcessingMetadata",Xe),nt&&(Oe.level=nt),Ge&&(Oe.transactionName=Ge),nn&&(Oe.span=nn),Le.length&&(Oe.breadcrumbs=[...Oe.breadcrumbs,...Le]),Te.length&&(Oe.fingerprint=[...Oe.fingerprint,...Te]),at.length&&(Oe.eventProcessors=[...Oe.eventProcessors,...at]),Ze.length&&(Oe.attachments=[...Oe.attachments,...Ze]),Oe.propagationContext={...Oe.propagationContext,...it}}function Ve(Oe,je,ht){if(ht&&Object.keys(ht).length){Oe[je]={...Oe[je]};for(const et in ht)Object.prototype.hasOwnProperty.call(ht,et)&&(Oe[je][et]=ht[et])}}},1477:(An,xt,H)=>{"use strict";function O(z){return z.transaction}H.d(xt,{z:()=>O})},3400:(An,xt,H)=>{"use strict";H.d(xt,{li:()=>Ue,mG:()=>me});var O=H(781),z=H(5800),ye=H(2064),m=H(7018),ae=H(5433),De=H(6754),Be=H(7266),Ve=H(647),xe=H(186),se=H(3308);function me(Te,at,Ze,it,Ge,nn){const{normalizeDepth:bn=3,normalizeMaxBreadth:Cn=1e3}=Te,qt={...at,event_id:at.event_id||Ze.event_id||(0,O.eJ)(),timestamp:at.timestamp||(0,z.lu)()},Ht=Ze.integrations||Te.integrations.map(Qt=>Qt.name);(function He(Te,at){const{environment:Ze,release:it,dist:Ge,maxValueLength:nn=250}=at;"environment"in Te||(Te.environment="environment"in at?Ze:De.U),void 0===Te.release&&void 0!==it&&(Te.release=it),void 0===Te.dist&&void 0!==Ge&&(Te.dist=Ge),Te.message&&(Te.message=(0,ye.xv)(Te.message,nn));const bn=Te.exception&&Te.exception.values&&Te.exception.values[0];bn&&bn.value&&(bn.value=(0,ye.xv)(bn.value,nn));const Cn=Te.request;Cn&&Cn.url&&(Cn.url=(0,ye.xv)(Cn.url,nn))})(qt,Te),function ht(Te,at){at.length>0&&(Te.sdk=Te.sdk||{},Te.sdk.integrations=[...Te.sdk.integrations||[],...at])}(qt,Ht),void 0===at.type&&function Oe(Te,at){const Ze=m.OW._sentryDebugIds;if(!Ze)return;let it;const Ge=qe.get(at);Ge?it=Ge:(it=new Map,qe.set(at,it));const nn=Object.keys(Ze).reduce((bn,Cn)=>{let qt;const Ht=it.get(Cn);Ht?qt=Ht:(qt=at(Cn),it.set(Cn,qt));for(let lt=qt.length-1;lt>=0;lt--){const Ct=qt[lt];if(Ct.filename){bn[Ct.filename]=Ze[Cn];break}}return bn},{});try{Te.exception.values.forEach(bn=>{bn.stacktrace.frames.forEach(Cn=>{Cn.filename&&(Cn.debug_id=nn[Cn.filename])})})}catch{}}(qt,Te.stackParser);const lt=function ct(Te,at){if(!at)return Te;const Ze=Te?Te.clone():new Ve.HG;return Ze.update(at),Ze}(it,Ze.captureContext);Ze.mechanism&&(0,O.M6)(qt,Ze.mechanism);const Ct=Ge&&Ge.getEventProcessors?Ge.getEventProcessors():[],Pt=(0,Ve.m6)().getScopeData();if(nn){const Qt=nn.getScopeData();(0,xe.Rg)(Pt,Qt)}if(lt){const Qt=lt.getScopeData();(0,xe.Rg)(Pt,Qt)}const Qe=[...Ze.attachments||[],...Pt.attachments];Qe.length&&(Ze.attachments=Qe),(0,xe.e2)(qt,Pt);const Tt=[...Ct,...(0,Be.lG)(),...Pt.eventProcessors];return(0,Be.jB)(Tt,qt,Ze).then(Qt=>(Qt&&function je(Te){const at={};try{Te.exception.values.forEach(it=>{it.stacktrace.frames.forEach(Ge=>{Ge.debug_id&&(Ge.abs_path?at[Ge.abs_path]=Ge.debug_id:Ge.filename&&(at[Ge.filename]=Ge.debug_id),delete Ge.debug_id)})})}catch{}if(0===Object.keys(at).length)return;Te.debug_meta=Te.debug_meta||{},Te.debug_meta.images=Te.debug_meta.images||[];const Ze=Te.debug_meta.images;Object.keys(at).forEach(it=>{Ze.push({type:"sourcemap",code_file:it,debug_id:at[it]})})}(Qt),"number"==typeof bn&&bn>0?function et(Te,at,Ze){if(!Te)return null;const it={...Te,...Te.breadcrumbs&&{breadcrumbs:Te.breadcrumbs.map(Ge=>({...Ge,...Ge.data&&{data:(0,ae.S8)(Ge.data,at,Ze)}}))},...Te.user&&{user:(0,ae.S8)(Te.user,at,Ze)},...Te.contexts&&{contexts:(0,ae.S8)(Te.contexts,at,Ze)},...Te.extra&&{extra:(0,ae.S8)(Te.extra,at,Ze)}};return Te.contexts&&Te.contexts.trace&&it.contexts&&(it.contexts.trace=Te.contexts.trace,Te.contexts.trace.data&&(it.contexts.trace.data=(0,ae.S8)(Te.contexts.trace.data,at,Ze))),Te.spans&&(it.spans=Te.spans.map(Ge=>{const nn=(0,se.et)(Ge).data;return nn&&(Ge.data=(0,ae.S8)(nn,at,Ze)),Ge})),it}(Qt,bn,Cn):Qt))}const qe=new WeakMap;function Ue(Te){if(Te)return function nt(Te){return Te instanceof Ve.HG||"function"==typeof Te}(Te)||function Le(Te){return Object.keys(Te).some(at=>Xe.includes(at))}(Te)?{captureContext:Te}:Te}const Xe=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"]},3308:(An,xt,H)=>{"use strict";H.d(xt,{CC:()=>m,Qh:()=>Be,aO:()=>ae,cI:()=>Ve,et:()=>se,kX:()=>De,pK:()=>He});var O=H(7474),z=H(8399),ye=H(5800);const m=0,ae=1;function De(qe){const{spanId:Oe,traceId:je}=qe.spanContext(),{data:ht,op:et,parent_span_id:ct,status:Ue,tags:nt,origin:Xe}=se(qe);return(0,O.Ce)({data:ht,op:et,parent_span_id:ct,span_id:Oe,status:Ue,tags:nt,trace_id:je,origin:Xe})}function Be(qe){const{traceId:Oe,spanId:je}=qe.spanContext(),ht=He(qe);return(0,z.TC)(Oe,je,ht)}function Ve(qe){return"number"==typeof qe?xe(qe):Array.isArray(qe)?qe[0]+qe[1]/1e9:qe instanceof Date?xe(qe.getTime()):(0,ye.zf)()}function xe(qe){return qe>9999999999?qe/1e3:qe}function se(qe){return function me(qe){return"function"==typeof qe.getSpanJSON}(qe)?qe.getSpanJSON():"function"==typeof qe.toJSON?qe.toJSON():{}}function He(qe){const{traceFlags:Oe}=qe.spanContext();return!!(Oe&ae)}},7199:(An,xt,H)=>{"use strict";H.d(xt,{M:()=>O});const O="7.108.0"},8909:(An,xt,H)=>{"use strict";H.d(xt,{w5:()=>Wn});var O=H(467);function ye(R){let L,$=R[0],ee=1;for(;ee<R.length;){const Ee=R[ee],st=R[ee+1];if(ee+=2,("optionalAccess"===Ee||"optionalCall"===Ee)&&null==$)return;"access"===Ee||"optionalAccess"===Ee?(L=$,$=st($)):("call"===Ee||"optionalCall"===Ee)&&($=st((...Et)=>$.call(L,...Et)),L=void 0)}return $}var m=H(2248);function Ve(R){return"/"===R[R.length-1]?R.slice(0,-1):R}var se=H(5948),me=H(3400),He=H(5560),qe=H(3308),Oe=H(962),je=H(7018),ht=H(5433),et=H(7474),ct=H(8617),Ue=H(5800),nt=H(1769),Xe=H(781),Le=H(5429),Te=H(2064),at=H(8603),Ze=H(6084),it=H(6597),Ge=H(4965),nn=H(3200),bn=H(2657);function Cn(){return typeof window<"u"&&(!(0,bn.wD)()||function qt(){return void 0!==je.OW.process&&"renderer"===je.OW.process.type}())}var Ht=H(2373);const lt=je.OW,Ct="sentryReplaySession",Pt="replay_event",Qe="Unable to send Replay",Vn=5e3,Fr=3,Ot=15e4,ur=2e7;function Er(R){let L,$=R[0],ee=1;for(;ee<R.length;){const Ee=R[ee],st=R[ee+1];if(ee+=2,("optionalAccess"===Ee||"optionalCall"===Ee)&&null==$)return;"access"===Ee||"optionalAccess"===Ee?(L=$,$=st($)):("call"===Ee||"optionalCall"===Ee)&&($=st((...Et)=>$.call(L,...Et)),L=void 0)}return $}var Zn=function(R){return R[R.Document=0]="Document",R[R.DocumentType=1]="DocumentType",R[R.Element=2]="Element",R[R.Text=3]="Text",R[R.CDATA=4]="CDATA",R[R.Comment=5]="Comment",R}(Zn||{});function Hn(R){const L=Er([R,"optionalAccess",$=>$.host]);return Er([L,"optionalAccess",$=>$.shadowRoot])===R}function Sr(R){return"[object ShadowRoot]"===Object.prototype.toString.call(R)}function Bt(R){try{const L=R.rules||R.cssRules;return L?function kr(R){return R.includes(" background-clip: text;")&&!R.includes(" -webkit-background-clip: text;")&&(R=R.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),R}(Array.from(L,Ce).join("")):null}catch{return null}}function Ce(R){let L;if(function Mt(R){return"styleSheet"in R}(R))try{L=Bt(R.styleSheet)||function Gt(R){const{cssText:L}=R;if(L.split('"').length<3)return L;const $=["@import",`url(${JSON.stringify(R.href)})`];return""===R.layerName?$.push("layer"):R.layerName&&$.push(`layer(${R.layerName})`),R.supportsText&&$.push(`supports(${R.supportsText})`),R.media.length&&$.push(R.media.mediaText),$.join(" ")+";"}(R)}catch{}else if(function hn(R){return"selectorText"in R}(R)&&R.selectorText.includes(":"))return function pt(R){return R.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2")}(R.cssText);return L||R.cssText}class Ur{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(L){return L?function mr(R,L){return R??L()}(Er([this,"access",ee=>ee.getMeta,"call",ee=>ee(L),"optionalAccess",ee=>ee.id]),()=>-1):-1}getNode(L){return this.idNodeMap.get(L)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(L){return this.nodeMetaMap.get(L)||null}removeNodeFromMap(L){const $=this.getId(L);this.idNodeMap.delete($),L.childNodes&&L.childNodes.forEach(ee=>this.removeNodeFromMap(ee))}has(L){return this.idNodeMap.has(L)}hasNode(L){return this.nodeMetaMap.has(L)}add(L,$){this.idNodeMap.set($.id,L),this.nodeMetaMap.set(L,$)}replace(L,$){const ee=this.getNode(L);if(ee){const Ee=this.nodeMetaMap.get(ee);Ee&&this.nodeMetaMap.set($,Ee)}this.idNodeMap.set(L,$)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function $r({maskInputOptions:R,tagName:L,type:$}){return"OPTION"===L&&(L="SELECT"),!!(R[L.toLowerCase()]||$&&R[$]||"password"===$||"INPUT"===L&&!$&&R.text)}function ci({isMasked:R,element:L,value:$,maskInputFn:ee}){let Ee=$||"";return R?(ee&&(Ee=ee(Ee,L)),"*".repeat(Ee.length)):Ee}function qn(R){return R.toLowerCase()}function Fs(R){return R.toUpperCase()}const Zt="__rrweb_original__";function re(R){const L=R.type;return R.hasAttribute("data-rr-is-password")?"password":L?qn(L):null}function Q(R,L,$){return"INPUT"!==L||"radio"!==$&&"checkbox"!==$?R.value:R.getAttribute("value")||""}let oe=1;const ge=new RegExp("[^a-z0-9-_:]"),Me=-2;function $e(){return oe++}let we,Je;const Ae=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,Ne=/^(?:[a-z+]+:)?\/\//i,ft=/^www\..*/i,Vt=/^(data:)([^,]*),(.*)/i;function Rt(R,L){return(R||"").replace(Ae,($,ee,Ee,st,Et,en)=>{const Lt=Ee||Et||en,gn=ee||st||"";if(!Lt)return $;if(Ne.test(Lt)||ft.test(Lt))return`url(${gn}${Lt}${gn})`;if(Vt.test(Lt))return`url(${gn}${Lt}${gn})`;if("/"===Lt[0])return`url(${gn}${function Ie(R){let L="";return L=R.indexOf("//")>-1?R.split("/").slice(0,3).join("/"):R.split("/")[0],L=L.split("?")[0],L}(L)+Lt}${gn})`;const Rn=L.split("/"),kn=Lt.split("/");Rn.pop();for(const Bn of kn)"."!==Bn&&(".."===Bn?Rn.pop():Rn.push(Bn));return`url(${gn}${Rn.join("/")}${gn})`})}const Mn=/^[^ \t\n\r\u000c]+/,ar=/^[, \t\n\r\u000c]+/;function Hr(R,L){if(!L||""===L.trim())return L;const $=R.createElement("a");return $.href=L,$.href}function Li(R){return!("svg"!==R.tagName&&!R.ownerSVGElement)}function $i(){const R=document.createElement("a");return R.href="",R.href}function Wr(R,L,$,ee,Ee,st){return ee&&("src"===$||"href"===$&&("use"!==L||"#"!==ee[0])||"xlink:href"===$&&"#"!==ee[0]||"background"===$&&("table"===L||"td"===L||"th"===L)?Hr(R,ee):"srcset"===$?function wr(R,L){if(""===L.trim())return L;let $=0;function ee(st){let Et;const en=st.exec(L.substring($));return en?(Et=en[0],$+=Et.length,Et):""}const Ee=[];for(;ee(ar),!($>=L.length);){let st=ee(Mn);if(","===st.slice(-1))st=Hr(R,st.substring(0,st.length-1)),Ee.push(st);else{let Et="";st=Hr(R,st);let en=!1;for(;;){const Lt=L.charAt($);if(""===Lt){Ee.push((st+Et).trim());break}if(en)")"===Lt&&(en=!1);else{if(","===Lt){$+=1,Ee.push((st+Et).trim());break}"("===Lt&&(en=!0)}Et+=Lt,$+=1}}}return Ee.join(", ")}(R,ee):"style"===$?Rt(ee,$i()):"object"===L&&"data"===$?Hr(R,ee):"function"==typeof st?st($,ee,Ee):ee)}function _r(R,L,$){return("video"===R||"audio"===R)&&"autoplay"===L}function wa(R,L,$=1/0,ee=0){return!R||R.nodeType!==R.ELEMENT_NODE||ee>$?-1:L(R)?ee:wa(R.parentNode,L,$,ee+1)}function In(R,L){return $=>{const ee=$;if(null===ee)return!1;try{if(R)if("string"==typeof R){if(ee.matches(`.${R}`))return!0}else if(function ra(R,L){for(let $=R.classList.length;$--;)if(L.test(R.classList[$]))return!0;return!1}(ee,R))return!0;return!(!L||!ee.matches(L))}catch{return!1}}}function Jt(R,L,$,ee,Ee,st){try{const Et=R.nodeType===R.ELEMENT_NODE?R:R.parentElement;if(null===Et)return!1;if("INPUT"===Et.tagName){const gn=Et.getAttribute("autocomplete");if(["current-password","new-password","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc"].includes(gn))return!0}let en=-1,Lt=-1;if(st){if(Lt=wa(Et,In(ee,Ee)),Lt<0)return!0;en=wa(Et,In(L,$),Lt>=0?Lt:1/0)}else{if(en=wa(Et,In(L,$)),en<0)return!1;Lt=wa(Et,In(ee,Ee),en>=0?en:1/0)}return en>=0?!(Lt>=0)||en<=Lt:!(Lt>=0||!st)}catch{}return!!st}function _i(R){return null==R?"":R.toLowerCase()}function Dt(R,L){const{doc:$,mirror:ee,blockClass:Ee,blockSelector:st,unblockSelector:Et,maskAllText:en,maskTextClass:Lt,unmaskTextClass:gn,maskTextSelector:Rn,unmaskTextSelector:kn,skipChild:Bn=!1,inlineStylesheet:Jn=!0,maskInputOptions:er={},maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,slimDOMOptions:Tr,dataURLOptions:Hs={},inlineImages:Ms=!1,recordCanvas:mi=!1,onSerialize:Yr,onIframeLoad:ri,iframeLoadTimeout:Mi=5e3,onStylesheetLoad:po,stylesheetLoadTimeout:Rr=5e3,keepIframeSrcFn:ls=(()=>!1),newlyAddedElement:Rs=!1}=L;let{preserveWhiteSpace:Yi=!0}=L;const Qs=function gi(R,L){const{doc:$,mirror:ee,blockClass:Ee,blockSelector:st,unblockSelector:Et,maskAllText:en,maskAttributeFn:Lt,maskTextClass:gn,unmaskTextClass:Rn,maskTextSelector:kn,unmaskTextSelector:Bn,inlineStylesheet:Jn,maskInputOptions:er={},maskTextFn:Vr,maskInputFn:ui,dataURLOptions:Yt={},inlineImages:Tr,recordCanvas:Hs,keepIframeSrcFn:Ms,newlyAddedElement:mi=!1}=L,Yr=function Ii(R,L){if(!L.hasNode(R))return;const $=L.getId(R);return 1===$?void 0:$}($,ee);switch(R.nodeType){case R.DOCUMENT_NODE:return"CSS1Compat"!==R.compatMode?{type:Zn.Document,childNodes:[],compatMode:R.compatMode}:{type:Zn.Document,childNodes:[]};case R.DOCUMENT_TYPE_NODE:return{type:Zn.DocumentType,name:R.name,publicId:R.publicId,systemId:R.systemId,rootId:Yr};case R.ELEMENT_NODE:return function ws(R,L){const{doc:$,blockClass:ee,blockSelector:Ee,unblockSelector:st,inlineStylesheet:Et,maskInputOptions:en={},maskAttributeFn:Lt,maskInputFn:gn,dataURLOptions:Rn={},inlineImages:kn,recordCanvas:Bn,keepIframeSrcFn:Jn,newlyAddedElement:er=!1,rootId:Vr,maskTextClass:Yt,unmaskTextClass:Tr,maskTextSelector:Hs,unmaskTextSelector:Ms}=L,mi=function Bs(R,L,$,ee){try{if(ee&&R.matches(ee))return!1;if("string"==typeof L){if(R.classList.contains(L))return!0}else for(let Ee=R.classList.length;Ee--;)if(L.test(R.classList[Ee]))return!0;if($)return R.matches($)}catch{}return!1}(R,ee,Ee,st),Yr=function Re(R){if(R instanceof HTMLFormElement)return"form";const L=qn(R.tagName);return ge.test(L)?"div":L}(R);let ri={};const Mi=R.attributes.length;for(let Rr=0;Rr<Mi;Rr++){const ls=R.attributes[Rr];ls.name&&!_r(Yr,ls.name)&&(ri[ls.name]=Wr($,Yr,qn(ls.name),ls.value,R,Lt))}if("link"===Yr&&Et){const Rr=Array.from($.styleSheets).find(Rs=>Rs.href===R.href);let ls=null;Rr&&(ls=Bt(Rr)),ls&&(delete ri.rel,delete ri.href,ri._cssText=Rt(ls,Rr.href))}if("style"===Yr&&R.sheet&&!(R.innerText||R.textContent||"").trim().length){const Rr=Bt(R.sheet);Rr&&(ri._cssText=Rt(Rr,$i()))}if("input"===Yr||"textarea"===Yr||"select"===Yr||"option"===Yr){const Rr=R,ls=re(Rr),Rs=Q(Rr,Fs(Yr),ls),Yi=Rr.checked;if("submit"!==ls&&"button"!==ls&&Rs){const Qs=Jt(Rr,Yt,Hs,Tr,Ms,$r({type:ls,tagName:Fs(Yr),maskInputOptions:en}));ri.value=ci({isMasked:Qs,element:Rr,value:Rs,maskInputFn:gn})}Yi&&(ri.checked=Yi)}if("option"===Yr&&(R.selected&&!en.select?ri.selected=!0:delete ri.selected),"canvas"===Yr&&Bn)if("2d"===R.__context)(function ve(R){const L=R.getContext("2d");if(!L)return!0;for(let ee=0;ee<R.width;ee+=50)for(let Ee=0;Ee<R.height;Ee+=50){const st=L.getImageData;if(new Uint32Array((Zt in st?st[Zt]:st).call(L,ee,Ee,Math.min(50,R.width-ee),Math.min(50,R.height-Ee)).data.buffer).some(Lt=>0!==Lt))return!1}return!0})(R)||(ri.rr_dataURL=R.toDataURL(Rn.type,Rn.quality));else if(!("__context"in R)){const Rr=R.toDataURL(Rn.type,Rn.quality),ls=document.createElement("canvas");ls.width=R.width,ls.height=R.height,Rr!==ls.toDataURL(Rn.type,Rn.quality)&&(ri.rr_dataURL=Rr)}if("img"===Yr&&kn){we||(we=$.createElement("canvas"),Je=we.getContext("2d"));const Rr=R,ls=Rr.crossOrigin;Rr.crossOrigin="anonymous";const Rs=()=>{Rr.removeEventListener("load",Rs);try{we.width=Rr.naturalWidth,we.height=Rr.naturalHeight,Je.drawImage(Rr,0,0),ri.rr_dataURL=we.toDataURL(Rn.type,Rn.quality)}catch(Yi){console.warn(`Cannot inline img src=${Rr.currentSrc}! Error: ${Yi}`)}ls?ri.crossOrigin=ls:Rr.removeAttribute("crossorigin")};Rr.complete&&0!==Rr.naturalWidth?Rs():Rr.addEventListener("load",Rs)}if(("audio"===Yr||"video"===Yr)&&(ri.rr_mediaState=R.paused?"paused":"played",ri.rr_mediaCurrentTime=R.currentTime),er||(R.scrollLeft&&(ri.rr_scrollLeft=R.scrollLeft),R.scrollTop&&(ri.rr_scrollTop=R.scrollTop)),mi){const{width:Rr,height:ls}=R.getBoundingClientRect();ri={class:ri.class,rr_width:`${Rr}px`,rr_height:`${ls}px`}}let po;"iframe"===Yr&&!Jn(ri.src)&&(R.contentDocument||(ri.rr_src=ri.src),delete ri.src);try{customElements.get(Yr)&&(po=!0)}catch{}return{type:Zn.Element,tagName:Yr,attributes:ri,childNodes:[],isSVG:Li(R)||void 0,needBlock:mi,rootId:Vr,isCustom:po}}(R,{doc:$,blockClass:Ee,blockSelector:st,unblockSelector:Et,inlineStylesheet:Jn,maskAttributeFn:Lt,maskInputOptions:er,maskInputFn:ui,dataURLOptions:Yt,inlineImages:Tr,recordCanvas:Hs,keepIframeSrcFn:Ms,newlyAddedElement:mi,rootId:Yr,maskAllText:en,maskTextClass:gn,unmaskTextClass:Rn,maskTextSelector:kn,unmaskTextSelector:Bn});case R.TEXT_NODE:return function ki(R,L){const{maskAllText:$,maskTextClass:ee,unmaskTextClass:Ee,maskTextSelector:st,unmaskTextSelector:Et,maskTextFn:en,maskInputOptions:Lt,maskInputFn:gn,rootId:Rn}=L,kn=R.parentNode&&R.parentNode.tagName;let Bn=R.textContent;const Jn="STYLE"===kn||void 0,er="SCRIPT"===kn||void 0,Vr="TEXTAREA"===kn||void 0;if(Jn&&Bn){try{R.nextSibling||R.previousSibling||Er([R,"access",Yt=>Yt.parentNode,"access",Yt=>Yt.sheet,"optionalAccess",Yt=>Yt.cssRules])&&(Bn=Bt(R.parentNode.sheet))}catch(Yt){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${Yt}`,R)}Bn=Rt(Bn,$i())}er&&(Bn="SCRIPT_PLACEHOLDER");const ui=Jt(R,ee,st,Ee,Et,$);return!Jn&&!er&&!Vr&&Bn&&ui&&(Bn=en?en(Bn):Bn.replace(/[\S]/g,"*")),Vr&&Bn&&(Lt.textarea||ui)&&(Bn=gn?gn(Bn,R.parentNode):Bn.replace(/[\S]/g,"*")),"OPTION"===kn&&Bn&&(Bn=ci({isMasked:Jt(R,ee,st,Ee,Et,$r({type:null,tagName:kn,maskInputOptions:Lt})),element:R,value:Bn,maskInputFn:gn})),{type:Zn.Text,textContent:Bn||"",isStyle:Jn,rootId:Rn}}(R,{maskAllText:en,maskTextClass:gn,unmaskTextClass:Rn,maskTextSelector:kn,unmaskTextSelector:Bn,maskTextFn:Vr,maskInputOptions:er,maskInputFn:ui,rootId:Yr});case R.CDATA_SECTION_NODE:return{type:Zn.CDATA,textContent:"",rootId:Yr};case R.COMMENT_NODE:return{type:Zn.Comment,textContent:R.textContent||"",rootId:Yr};default:return!1}}(R,{doc:$,mirror:ee,blockClass:Ee,blockSelector:st,maskAllText:en,unblockSelector:Et,maskTextClass:Lt,unmaskTextClass:gn,maskTextSelector:Rn,unmaskTextSelector:kn,inlineStylesheet:Jn,maskInputOptions:er,maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,dataURLOptions:Hs,inlineImages:Ms,recordCanvas:mi,keepIframeSrcFn:ls,newlyAddedElement:Rs});if(!Qs)return console.warn(R,"not serialized"),null;let ko;ko=ee.hasNode(R)?ee.getId(R):function ut(R,L){if(L.comment&&R.type===Zn.Comment)return!0;if(R.type===Zn.Element){if(L.script&&("script"===R.tagName||"link"===R.tagName&&("preload"===R.attributes.rel||"modulepreload"===R.attributes.rel)&&"script"===R.attributes.as||"link"===R.tagName&&"prefetch"===R.attributes.rel&&"string"==typeof R.attributes.href&&R.attributes.href.endsWith(".js")))return!0;if(L.headFavicon&&("link"===R.tagName&&"shortcut icon"===R.attributes.rel||"meta"===R.tagName&&(_i(R.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===_i(R.attributes.name)||"icon"===_i(R.attributes.rel)||"apple-touch-icon"===_i(R.attributes.rel)||"shortcut icon"===_i(R.attributes.rel))))return!0;if("meta"===R.tagName){if(L.headMetaDescKeywords&&_i(R.attributes.name).match(/^description|keywords$/))return!0;if(L.headMetaSocial&&(_i(R.attributes.property).match(/^(og|twitter|fb):/)||_i(R.attributes.name).match(/^(og|twitter):/)||"pinterest"===_i(R.attributes.name)))return!0;if(L.headMetaRobots&&("robots"===_i(R.attributes.name)||"googlebot"===_i(R.attributes.name)||"bingbot"===_i(R.attributes.name)))return!0;if(L.headMetaHttpEquiv&&void 0!==R.attributes["http-equiv"])return!0;if(L.headMetaAuthorship&&("author"===_i(R.attributes.name)||"generator"===_i(R.attributes.name)||"framework"===_i(R.attributes.name)||"publisher"===_i(R.attributes.name)||"progid"===_i(R.attributes.name)||_i(R.attributes.property).match(/^article:/)||_i(R.attributes.property).match(/^product:/)))return!0;if(L.headMetaVerification&&("google-site-verification"===_i(R.attributes.name)||"yandex-verification"===_i(R.attributes.name)||"csrf-token"===_i(R.attributes.name)||"p:domain_verify"===_i(R.attributes.name)||"verify-v1"===_i(R.attributes.name)||"verification"===_i(R.attributes.name)||"shopify-checkout-api-token"===_i(R.attributes.name)))return!0}}return!1}(Qs,Tr)||!Yi&&Qs.type===Zn.Text&&!Qs.isStyle&&!Qs.textContent.replace(/^\s+|\s+$/gm,"").length?Me:$e();const ps=Object.assign(Qs,{id:ko});if(ee.add(R,ps),ko===Me)return null;Yr&&Yr(R);let Ma=!Bn;if(ps.type===Zn.Element){Ma=Ma&&!ps.needBlock,delete ps.needBlock;const xo=R.shadowRoot;xo&&Sr(xo)&&(ps.isShadowHost=!0)}if((ps.type===Zn.Document||ps.type===Zn.Element)&&Ma){Tr.headWhitespace&&ps.type===Zn.Element&&"head"===ps.tagName&&(Yi=!1);const xo={doc:$,mirror:ee,blockClass:Ee,blockSelector:st,maskAllText:en,unblockSelector:Et,maskTextClass:Lt,unmaskTextClass:gn,maskTextSelector:Rn,unmaskTextSelector:kn,skipChild:Bn,inlineStylesheet:Jn,maskInputOptions:er,maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,slimDOMOptions:Tr,dataURLOptions:Hs,inlineImages:Ms,recordCanvas:mi,preserveWhiteSpace:Yi,onSerialize:Yr,onIframeLoad:ri,iframeLoadTimeout:Mi,onStylesheetLoad:po,stylesheetLoadTimeout:Rr,keepIframeSrcFn:ls};for(const oo of Array.from(R.childNodes)){const Ha=Dt(oo,xo);Ha&&ps.childNodes.push(Ha)}if(function us(R){return R.nodeType===R.ELEMENT_NODE}(R)&&R.shadowRoot)for(const oo of Array.from(R.shadowRoot.childNodes)){const Ha=Dt(oo,xo);Ha&&(Sr(R.shadowRoot)&&(Ha.isShadow=!0),ps.childNodes.push(Ha))}}return R.parentNode&&Hn(R.parentNode)&&Sr(R.parentNode)&&(ps.isShadow=!0),ps.type===Zn.Element&&"iframe"===ps.tagName&&function Sn(R,L,$){const ee=R.contentWindow;if(!ee)return;let st,Ee=!1;try{st=ee.document.readyState}catch{return}if("complete"!==st){const en=setTimeout(()=>{Ee||(L(),Ee=!0)},$);return void R.addEventListener("load",()=>{clearTimeout(en),Ee=!0,L()})}const Et="about:blank";if(ee.location.href!==Et||R.src===Et||""===R.src)return setTimeout(L,0),R.addEventListener("load",L);R.addEventListener("load",L)}(R,()=>{const xo=R.contentDocument;if(xo&&ri){const oo=Dt(xo,{doc:xo,mirror:ee,blockClass:Ee,blockSelector:st,unblockSelector:Et,maskAllText:en,maskTextClass:Lt,unmaskTextClass:gn,maskTextSelector:Rn,unmaskTextSelector:kn,skipChild:!1,inlineStylesheet:Jn,maskInputOptions:er,maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,slimDOMOptions:Tr,dataURLOptions:Hs,inlineImages:Ms,recordCanvas:mi,preserveWhiteSpace:Yi,onSerialize:Yr,onIframeLoad:ri,iframeLoadTimeout:Mi,onStylesheetLoad:po,stylesheetLoadTimeout:Rr,keepIframeSrcFn:ls});oo&&ri(R,oo)}},Mi),ps.type===Zn.Element&&"link"===ps.tagName&&"stylesheet"===ps.attributes.rel&&function Gr(R,L,$){let Ee,ee=!1;try{Ee=R.sheet}catch{return}if(Ee)return;const st=setTimeout(()=>{ee||(L(),ee=!0)},$);R.addEventListener("load",()=>{clearTimeout(st),ee=!0,L()})}(R,()=>{if(po){const xo=Dt(R,{doc:$,mirror:ee,blockClass:Ee,blockSelector:st,unblockSelector:Et,maskAllText:en,maskTextClass:Lt,unmaskTextClass:gn,maskTextSelector:Rn,unmaskTextSelector:kn,skipChild:!1,inlineStylesheet:Jn,maskInputOptions:er,maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,slimDOMOptions:Tr,dataURLOptions:Hs,inlineImages:Ms,recordCanvas:mi,preserveWhiteSpace:Yi,onSerialize:Yr,onIframeLoad:ri,iframeLoadTimeout:Mi,onStylesheetLoad:po,stylesheetLoadTimeout:Rr,keepIframeSrcFn:ls});xo&&po(R,xo)}},Rr),ps}function wn(R){let L,$=R[0],ee=1;for(;ee<R.length;){const Ee=R[ee],st=R[ee+1];if(ee+=2,("optionalAccess"===Ee||"optionalCall"===Ee)&&null==$)return;"access"===Ee||"optionalAccess"===Ee?(L=$,$=st($)):("call"===Ee||"optionalCall"===Ee)&&($=st((...Et)=>$.call(L,...Et)),L=void 0)}return $}function bt(R,L,$=document){const ee={capture:!0,passive:!0};return $.addEventListener(R,L,ee),()=>$.removeEventListener(R,L,ee)}const On="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let sr={map:{},getId:()=>(console.error(On),-1),getNode:()=>(console.error(On),null),removeNodeFromMap(){console.error(On)},has:()=>(console.error(On),!1),reset(){console.error(On)}};function ei(R,L,$={}){let ee=null,Ee=0;return function(...st){const Et=Date.now();!Ee&&!1===$.leading&&(Ee=Et);const en=L-(Et-Ee),Lt=this;en<=0||en>L?(ee&&(clearTimeout(ee),ee=null),Ee=Et,R.apply(Lt,st)):!ee&&!1!==$.trailing&&(ee=setTimeout(()=>{Ee=!1===$.leading?0:Date.now(),ee=null,R.apply(Lt,st)},en))}}function Mr(R,L,$,ee,Ee=window){const st=Ee.Object.getOwnPropertyDescriptor(R,L);return Ee.Object.defineProperty(R,L,ee?$:{set(Et){setTimeout(()=>{$.set.call(this,Et)},0),st&&st.set&&st.set.call(this,Et)}}),()=>Mr(R,L,st||{},!0)}function li(R,L,$){try{if(!(L in R))return()=>{};const ee=R[L],Ee=$(ee);return"function"==typeof Ee&&(Ee.prototype=Ee.prototype||{},Object.defineProperties(Ee,{__rrweb_original__:{enumerable:!1,value:ee}})),R[L]=Ee,()=>{R[L]=ee}}catch{return()=>{}}}typeof window<"u"&&window.Proxy&&window.Reflect&&(sr=new Proxy(sr,{get:(R,L,$)=>("map"===L&&console.error(On),Reflect.get(R,L,$))}));let gc,xi=Date.now;function Ds(R){const L=R.document;return{left:L.scrollingElement?L.scrollingElement.scrollLeft:void 0!==R.pageXOffset?R.pageXOffset:wn([L,"optionalAccess",$=>$.documentElement,"access",$=>$.scrollLeft])||wn([L,"optionalAccess",$=>$.body,"optionalAccess",$=>$.parentElement,"optionalAccess",$=>$.scrollLeft])||wn([L,"optionalAccess",$=>$.body,"optionalAccess",$=>$.scrollLeft])||0,top:L.scrollingElement?L.scrollingElement.scrollTop:void 0!==R.pageYOffset?R.pageYOffset:wn([L,"optionalAccess",$=>$.documentElement,"access",$=>$.scrollTop])||wn([L,"optionalAccess",$=>$.body,"optionalAccess",$=>$.parentElement,"optionalAccess",$=>$.scrollTop])||wn([L,"optionalAccess",$=>$.body,"optionalAccess",$=>$.scrollTop])||0}}function Vs(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function gr(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function ti(R,L,$,ee,Ee){if(!R)return!1;const st=R.nodeType===R.ELEMENT_NODE?R:R.parentElement;if(!st)return!1;const Et=In(L,$);if(!Ee){const gn=ee&&st.matches(ee);return Et(st)&&!gn}const en=wa(st,Et);let Lt=-1;return!(en<0)&&(ee&&(Lt=wa(st,In(null,ee))),en>-1&&Lt<0||en<Lt)}function Ci(R,L){return L.getId(R)===Me}function _s(R,L){if(Hn(R))return!1;const $=L.getId(R);return!L.has($)||(!R.parentNode||R.parentNode.nodeType!==R.DOCUMENT_NODE)&&(!R.parentNode||_s(R.parentNode,L))}function br(R){return!!R.changedTouches}function Mo(R,L){return!("IFRAME"!==R.nodeName||!L.getMeta(R))}function bs(R,L){return!("LINK"!==R.nodeName||R.nodeType!==R.ELEMENT_NODE||!R.getAttribute||"stylesheet"!==R.getAttribute("rel")||!L.getMeta(R))}function Gi(R){return!!wn([R,"optionalAccess",L=>L.shadowRoot])}/[1-9][0-9]{12}/.test(Date.now().toString())||(xi=()=>(new Date).getTime());class ys{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(L){return function z(R,L){return R??L()}(this.styleIDMap.get(L),()=>-1)}has(L){return this.styleIDMap.has(L)}add(L,$){if(this.has(L))return this.getId(L);let ee;return ee=void 0===$?this.id++:$,this.styleIDMap.set(L,ee),this.idStyleMap.set(ee,L),ee}getStyle(L){return this.idStyleMap.get(L)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function fi(R){let L=null;return wn([R,"access",$=>$.getRootNode,"optionalCall",$=>$(),"optionalAccess",$=>$.nodeType])===Node.DOCUMENT_FRAGMENT_NODE&&R.getRootNode().host&&(L=R.getRootNode().host),L}function Wo(R){const L=R.ownerDocument;return!!L&&(L.contains(R)||function Fl(R){const L=R.ownerDocument;if(!L)return!1;const $=function Pi(R){let $,L=R;for(;$=fi(L);)L=$;return L}(R);return L.contains($)}(R))}var Fi=(R=>(R[R.DomContentLoaded=0]="DomContentLoaded",R[R.Load=1]="Load",R[R.FullSnapshot=2]="FullSnapshot",R[R.IncrementalSnapshot=3]="IncrementalSnapshot",R[R.Meta=4]="Meta",R[R.Custom=5]="Custom",R[R.Plugin=6]="Plugin",R))(Fi||{}),Nr=(R=>(R[R.Mutation=0]="Mutation",R[R.MouseMove=1]="MouseMove",R[R.MouseInteraction=2]="MouseInteraction",R[R.Scroll=3]="Scroll",R[R.ViewportResize=4]="ViewportResize",R[R.Input=5]="Input",R[R.TouchMove=6]="TouchMove",R[R.MediaInteraction=7]="MediaInteraction",R[R.StyleSheetRule=8]="StyleSheetRule",R[R.CanvasMutation=9]="CanvasMutation",R[R.Font=10]="Font",R[R.Log=11]="Log",R[R.Drag=12]="Drag",R[R.StyleDeclaration=13]="StyleDeclaration",R[R.Selection=14]="Selection",R[R.AdoptedStyleSheet=15]="AdoptedStyleSheet",R[R.CustomElement=16]="CustomElement",R))(Nr||{}),eo=(R=>(R[R.MouseUp=0]="MouseUp",R[R.MouseDown=1]="MouseDown",R[R.Click=2]="Click",R[R.ContextMenu=3]="ContextMenu",R[R.DblClick=4]="DblClick",R[R.Focus=5]="Focus",R[R.Blur=6]="Blur",R[R.TouchStart=7]="TouchStart",R[R.TouchMove_Departed=8]="TouchMove_Departed",R[R.TouchEnd=9]="TouchEnd",R[R.TouchCancel=10]="TouchCancel",R))(eo||{}),to=(R=>(R[R.Mouse=0]="Mouse",R[R.Pen=1]="Pen",R[R.Touch=2]="Touch",R))(to||{});function ds(R){let L,$=R[0],ee=1;for(;ee<R.length;){const Ee=R[ee],st=R[ee+1];if(ee+=2,("optionalAccess"===Ee||"optionalCall"===Ee)&&null==$)return;"access"===Ee||"optionalAccess"===Ee?(L=$,$=st($)):("call"===Ee||"optionalCall"===Ee)&&($=st((...Et)=>$.call(L,...Et)),L=void 0)}return $}function Bc(R){return"__ln"in R}class Tl{constructor(){this.length=0,this.head=null,this.tail=null}get(L){if(L>=this.length)throw new Error("Position outside of list range");let $=this.head;for(let ee=0;ee<L;ee++)$=ds([$,"optionalAccess",Ee=>Ee.next])||null;return $}addNode(L){const $={value:L,previous:null,next:null};if(L.__ln=$,L.previousSibling&&Bc(L.previousSibling)){const ee=L.previousSibling.__ln.next;$.next=ee,$.previous=L.previousSibling.__ln,L.previousSibling.__ln.next=$,ee&&(ee.previous=$)}else if(L.nextSibling&&Bc(L.nextSibling)&&L.nextSibling.__ln.previous){const ee=L.nextSibling.__ln.previous;$.previous=ee,$.next=L.nextSibling.__ln,L.nextSibling.__ln.previous=$,ee&&(ee.next=$)}else this.head&&(this.head.previous=$),$.next=this.head,this.head=$;null===$.next&&(this.tail=$),this.length++}removeNode(L){const $=L.__ln;this.head&&($.previous?($.previous.next=$.next,$.next?$.next.previous=$.previous:this.tail=$.previous):(this.head=$.next,this.head?this.head.previous=null:this.tail=null),L.__ln&&delete L.__ln,this.length--)}}const ba=(R,L)=>`${R}@${L}`;class Ro{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=L=>{L.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const L=[],$=new Set,ee=new Tl,Ee=Lt=>{let gn=Lt,Rn=Me;for(;Rn===Me;)gn=gn&&gn.nextSibling,Rn=gn&&this.mirror.getId(gn);return Rn},st=Lt=>{if(!Lt.parentNode||!Wo(Lt))return;const gn=Hn(Lt.parentNode)?this.mirror.getId(fi(Lt)):this.mirror.getId(Lt.parentNode),Rn=Ee(Lt);if(-1===gn||-1===Rn)return ee.addNode(Lt);const kn=Dt(Lt,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:Bn=>{Mo(Bn,this.mirror)&&this.iframeManager.addIframe(Bn),bs(Bn,this.mirror)&&this.stylesheetManager.trackLinkElement(Bn),Gi(Lt)&&this.shadowDomManager.addShadowRoot(Lt.shadowRoot,this.doc)},onIframeLoad:(Bn,Jn)=>{this.iframeManager.attachIframe(Bn,Jn),this.shadowDomManager.observeAttachShadow(Bn)},onStylesheetLoad:(Bn,Jn)=>{this.stylesheetManager.attachLinkElement(Bn,Jn)}});kn&&(L.push({parentId:gn,nextId:Rn,node:kn}),$.add(kn.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const Lt of this.movedSet)al(this.removes,Lt,this.mirror)&&!this.movedSet.has(Lt.parentNode)||st(Lt);for(const Lt of this.addedSet)!Xo(this.droppedSet,Lt)&&!al(this.removes,Lt,this.mirror)||Xo(this.movedSet,Lt)?st(Lt):this.droppedSet.add(Lt);let Et=null;for(;ee.length;){let Lt=null;if(Et){const gn=this.mirror.getId(Et.value.parentNode),Rn=Ee(Et.value);-1!==gn&&-1!==Rn&&(Lt=Et)}if(!Lt){let gn=ee.tail;for(;gn;){const Rn=gn;if(gn=gn.previous,Rn){const kn=this.mirror.getId(Rn.value.parentNode);if(-1===Ee(Rn.value))continue;if(-1!==kn){Lt=Rn;break}{const Jn=Rn.value;if(Jn.parentNode&&Jn.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&-1!==this.mirror.getId(Jn.parentNode.host)){Lt=Rn;break}}}}}if(!Lt){for(;ee.head;)ee.removeNode(ee.head.value);break}Et=Lt.previous,ee.removeNode(Lt.value),st(Lt.value)}const en={texts:this.texts.map(Lt=>({id:this.mirror.getId(Lt.node),value:Lt.value})).filter(Lt=>!$.has(Lt.id)).filter(Lt=>this.mirror.has(Lt.id)),attributes:this.attributes.map(Lt=>{const{attributes:gn}=Lt;if("string"==typeof gn.style){const Rn=JSON.stringify(Lt.styleDiff),kn=JSON.stringify(Lt._unchangedStyles);Rn.length<gn.style.length&&(Rn+kn).split("var(").length===gn.style.split("var(").length&&(gn.style=Lt.styleDiff)}return{id:this.mirror.getId(Lt.node),attributes:gn}}).filter(Lt=>!$.has(Lt.id)).filter(Lt=>this.mirror.has(Lt.id)),removes:this.removes,adds:L};!en.texts.length&&!en.attributes.length&&!en.removes.length&&!en.adds.length||(this.texts=[],this.attributes=[],this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(en))},this.processMutation=L=>{if(Ci(L.target,this.mirror))return;let $;try{$=document.implementation.createHTMLDocument()}catch{$=this.doc}switch(L.type){case"characterData":{const ee=L.target.textContent;!ti(L.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)&&ee!==L.oldValue&&this.texts.push({value:Jt(L.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&ee?this.maskTextFn?this.maskTextFn(ee):ee.replace(/[\S]/g,"*"):ee,node:L.target});break}case"attributes":{const ee=L.target;let Ee=L.attributeName,st=L.target.getAttribute(Ee);if("value"===Ee){const en=re(ee),Lt=ee.tagName;st=Q(ee,Lt,en);const gn=$r({maskInputOptions:this.maskInputOptions,tagName:Lt,type:en});st=ci({isMasked:Jt(L.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,gn),element:ee,value:st,maskInputFn:this.maskInputFn})}if(ti(L.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||st===L.oldValue)return;let Et=this.attributes.find(en=>en.node===L.target);if("IFRAME"===ee.tagName&&"src"===Ee&&!this.keepIframeSrcFn(st)){if(ee.contentDocument)return;Ee="rr_src"}if(Et||(Et={node:L.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(Et)),"type"===Ee&&"INPUT"===ee.tagName&&"password"===(L.oldValue||"").toLowerCase()&&ee.setAttribute("data-rr-is-password","true"),!_r(ee.tagName,Ee)&&(Et.attributes[Ee]=Wr(this.doc,qn(ee.tagName),qn(Ee),st,ee,this.maskAttributeFn),"style"===Ee)){const en=$.createElement("span");L.oldValue&&en.setAttribute("style",L.oldValue);for(const Lt of Array.from(ee.style)){const gn=ee.style.getPropertyValue(Lt),Rn=ee.style.getPropertyPriority(Lt);gn!==en.style.getPropertyValue(Lt)||Rn!==en.style.getPropertyPriority(Lt)?Et.styleDiff[Lt]=""===Rn?gn:[gn,Rn]:Et._unchangedStyles[Lt]=[gn,Rn]}for(const Lt of Array.from(en.style))""===ee.style.getPropertyValue(Lt)&&(Et.styleDiff[Lt]=!1)}break}case"childList":if(ti(L.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;L.addedNodes.forEach(ee=>this.genAdds(ee,L.target)),L.removedNodes.forEach(ee=>{const Ee=this.mirror.getId(ee),st=Hn(L.target)?this.mirror.getId(L.target.host):this.mirror.getId(L.target);ti(L.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||Ci(ee,this.mirror)||!function qr(R,L){return-1!==L.getId(R)}(ee,this.mirror)||(this.addedSet.has(ee)?(Ta(this.addedSet,ee),this.droppedSet.add(ee)):this.addedSet.has(L.target)&&-1===Ee||_s(L.target,this.mirror)||(this.movedSet.has(ee)&&this.movedMap[ba(Ee,st)]?Ta(this.movedSet,ee):this.removes.push({parentId:st,id:Ee,isShadow:!(!Hn(L.target)||!Sr(L.target))||void 0})),this.mapRemoves.push(ee))})}},this.genAdds=(L,$)=>{if(!this.processedNodeManager.inOtherBuffer(L,this)&&!this.addedSet.has(L)&&!this.movedSet.has(L)){if(this.mirror.hasNode(L)){if(Ci(L,this.mirror))return;this.movedSet.add(L);let ee=null;$&&this.mirror.hasNode($)&&(ee=this.mirror.getId($)),ee&&-1!==ee&&(this.movedMap[ba(this.mirror.getId(L),ee)]=!0)}else this.addedSet.add(L),this.droppedSet.delete(L);ti(L,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(L.childNodes.forEach(ee=>this.genAdds(ee)),Gi(L)&&L.shadowRoot.childNodes.forEach(ee=>{this.processedNodeManager.add(ee,this),this.genAdds(ee,L)}))}}}init(L){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach($=>{this[$]=L[$]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function Ta(R,L){R.delete(L),L.childNodes.forEach($=>Ta(R,$))}function al(R,L,$){return 0!==R.length&&no(R,L,$)}function no(R,L,$){const{parentNode:ee}=L;if(!ee)return!1;const Ee=$.getId(ee);return!!R.some(st=>st.id===Ee)||no(R,ee,$)}function Xo(R,L){return 0!==R.size&&Za(R,L)}function Za(R,L){const{parentNode:$}=L;return!!$&&(!!R.has($)||Za(R,$))}let ia;const wi=R=>ia?(...$)=>{try{return R(...$)}catch(ee){if(ia&&!0===ia(ee))return()=>{};throw ee}}:R;function Zs(R){let L,$=R[0],ee=1;for(;ee<R.length;){const Ee=R[ee],st=R[ee+1];if(ee+=2,("optionalAccess"===Ee||"optionalCall"===Ee)&&null==$)return;"access"===Ee||"optionalAccess"===Ee?(L=$,$=st($)):("call"===Ee||"optionalCall"===Ee)&&($=st((...Et)=>$.call(L,...Et)),L=void 0)}return $}const Us=[];function ga(R){try{if("composedPath"in R){const L=R.composedPath();if(L.length)return L[0]}else if("path"in R&&R.path.length)return R.path[0]}catch{}return R&&R.target}function Ei(R,L){const $=new Ro;Us.push($),$.init(R);let ee=window.MutationObserver||window.__rrMutationObserver;const Ee=Zs([window,"optionalAccess",Et=>Et.Zone,"optionalAccess",Et=>Et.__symbol__,"optionalCall",Et=>Et("MutationObserver")]);Ee&&window[Ee]&&(ee=window[Ee]);const st=new ee(wi(Et=>{R.onMutation&&!1===R.onMutation(Et)||$.processMutations.bind($)(Et)}));return st.observe(L,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),st}function Bo({scrollCb:R,doc:L,mirror:$,blockClass:ee,blockSelector:Ee,unblockSelector:st,sampling:Et}){return bt("scroll",wi(ei(wi(Lt=>{const gn=ga(Lt);if(!gn||ti(gn,ee,Ee,st,!0))return;const Rn=$.getId(gn);if(gn===L&&L.defaultView){const kn=Ds(L.defaultView);R({id:Rn,x:kn.left,y:kn.top})}else R({id:Rn,x:gn.scrollLeft,y:gn.scrollTop})}),Et.scroll||100)),L)}const Xa=["INPUT","TEXTAREA","SELECT"],qo=new WeakMap;function Qo({inputCb:R,doc:L,mirror:$,blockClass:ee,blockSelector:Ee,unblockSelector:st,ignoreClass:Et,ignoreSelector:en,maskInputOptions:Lt,maskInputFn:gn,sampling:Rn,userTriggeredOnInput:kn,maskTextClass:Bn,unmaskTextClass:Jn,maskTextSelector:er,unmaskTextSelector:Vr}){function ui(ri){let Mi=ga(ri);const po=ri.isTrusted,Rr=Mi&&Fs(Mi.tagName);if("OPTION"===Rr&&(Mi=Mi.parentElement),!Mi||!Rr||Xa.indexOf(Rr)<0||ti(Mi,ee,Ee,st,!0))return;const ls=Mi;if(ls.classList.contains(Et)||en&&ls.matches(en))return;const Rs=re(Mi);let Yi=Q(ls,Rr,Rs),Qs=!1;const ko=$r({maskInputOptions:Lt,tagName:Rr,type:Rs}),ps=Jt(Mi,Bn,er,Jn,Vr,ko);("radio"===Rs||"checkbox"===Rs)&&(Qs=Mi.checked),Yi=ci({isMasked:ps,element:Mi,value:Yi,maskInputFn:gn}),Yt(Mi,kn?{text:Yi,isChecked:Qs,userTriggered:po}:{text:Yi,isChecked:Qs});const Ma=Mi.name;"radio"===Rs&&Ma&&Qs&&L.querySelectorAll(`input[type="radio"][name="${Ma}"]`).forEach(xo=>{if(xo!==Mi){const oo=ci({isMasked:ps,element:xo,value:Q(xo,Rr,Rs),maskInputFn:gn});Yt(xo,kn?{text:oo,isChecked:!Qs,userTriggered:!1}:{text:oo,isChecked:!Qs})}})}function Yt(ri,Mi){const po=qo.get(ri);if(!po||po.text!==Mi.text||po.isChecked!==Mi.isChecked){qo.set(ri,Mi);const Rr=$.getId(ri);wi(R)({...Mi,id:Rr})}}const Hs=("last"===Rn.input?["change"]:["input","change"]).map(ri=>bt(ri,wi(ui),L)),Ms=L.defaultView;if(!Ms)return()=>{Hs.forEach(ri=>ri())};const mi=Ms.Object.getOwnPropertyDescriptor(Ms.HTMLInputElement.prototype,"value");return mi&&mi.set&&Hs.push(...[[Ms.HTMLInputElement.prototype,"value"],[Ms.HTMLInputElement.prototype,"checked"],[Ms.HTMLSelectElement.prototype,"value"],[Ms.HTMLTextAreaElement.prototype,"value"],[Ms.HTMLSelectElement.prototype,"selectedIndex"],[Ms.HTMLOptionElement.prototype,"selected"]].map(ri=>Mr(ri[0],ri[1],{set(){wi(ui)({target:this,isTrusted:!1})}},!1,Ms))),wi(()=>{Hs.forEach(ri=>ri())})}function Ko(R){return function $(ee,Ee){if(zl("CSSGroupingRule")&&ee.parentRule instanceof CSSGroupingRule||zl("CSSMediaRule")&&ee.parentRule instanceof CSSMediaRule||zl("CSSSupportsRule")&&ee.parentRule instanceof CSSSupportsRule||zl("CSSConditionRule")&&ee.parentRule instanceof CSSConditionRule){const Et=Array.from(ee.parentRule.cssRules).indexOf(ee);Ee.unshift(Et)}else if(ee.parentStyleSheet){const Et=Array.from(ee.parentStyleSheet.cssRules).indexOf(ee);Ee.unshift(Et)}return Ee}(R,[])}function Fa(R,L,$){let ee,Ee;return R?(R.ownerNode?ee=L.getId(R.ownerNode):Ee=$.getId(R),{styleId:Ee,id:ee}):{}}function Bl({mirror:R,stylesheetManager:L},$){let ee=null;ee=R.getId("#document"===$.nodeName?$:$.host);const Ee=Zs("#document"===$.nodeName?[$,"access",Et=>Et.defaultView,"optionalAccess",Et=>Et.Document]:[$,"access",Et=>Et.ownerDocument,"optionalAccess",Et=>Et.defaultView,"optionalAccess",Et=>Et.ShadowRoot]),st=Zs([Ee,"optionalAccess",Et=>Et.prototype])?Object.getOwnPropertyDescriptor(Zs([Ee,"optionalAccess",Et=>Et.prototype]),"adoptedStyleSheets"):void 0;return null!==ee&&-1!==ee&&Ee&&st?(Object.defineProperty($,"adoptedStyleSheets",{configurable:st.configurable,enumerable:st.enumerable,get(){return Zs([st,"access",Et=>Et.get,"optionalAccess",Et=>Et.call,"call",Et=>Et(this)])},set(Et){const en=Zs([st,"access",Lt=>Lt.set,"optionalAccess",Lt=>Lt.call,"call",Lt=>Lt(this,Et)]);if(null!==ee&&-1!==ee)try{L.adoptStyleSheets(Et,ee)}catch{}return en}}),wi(()=>{Object.defineProperty($,"adoptedStyleSheets",{configurable:st.configurable,enumerable:st.enumerable,get:st.get,set:st.set})})):()=>{}}function Ki(R,L={}){const $=R.doc.defaultView;if(!$)return()=>{};const ee=Ei(R,R.doc),Ee=function Il({mousemoveCb:R,sampling:L,doc:$,mirror:ee}){if(!1===L.mousemove)return()=>{};const Ee="number"==typeof L.mousemove?L.mousemove:50,st="number"==typeof L.mousemoveCallback?L.mousemoveCallback:500;let en,Et=[];const Lt=ei(wi(kn=>{const Bn=Date.now()-en;R(Et.map(Jn=>(Jn.timeOffset-=Bn,Jn)),kn),Et=[],en=null}),st),gn=wi(ei(wi(kn=>{const Bn=ga(kn),{clientX:Jn,clientY:er}=br(kn)?kn.changedTouches[0]:kn;en||(en=xi()),Et.push({x:Jn,y:er,id:ee.getId(Bn),timeOffset:xi()-en}),Lt(typeof DragEvent<"u"&&kn instanceof DragEvent?Nr.Drag:kn instanceof MouseEvent?Nr.MouseMove:Nr.TouchMove)}),Ee,{trailing:!1})),Rn=[bt("mousemove",gn,$),bt("touchmove",gn,$),bt("drag",gn,$)];return wi(()=>{Rn.forEach(kn=>kn())})}(R),st=function La({mouseInteractionCb:R,doc:L,mirror:$,blockClass:ee,blockSelector:Ee,unblockSelector:st,sampling:Et}){if(!1===Et.mouseInteraction)return()=>{};const en=!0===Et.mouseInteraction||void 0===Et.mouseInteraction?{}:Et.mouseInteraction,Lt=[];let gn=null;return Object.keys(eo).filter(kn=>Number.isNaN(Number(kn))&&!kn.endsWith("_Departed")&&!1!==en[kn]).forEach(kn=>{let Bn=qn(kn);const Jn=(kn=>Bn=>{const Jn=ga(Bn);if(ti(Jn,ee,Ee,st,!0))return;let er=null,Vr=kn;if("pointerType"in Bn){switch(Bn.pointerType){case"mouse":er=to.Mouse;break;case"touch":er=to.Touch;break;case"pen":er=to.Pen}er===to.Touch&&(eo[kn]===eo.MouseDown?Vr="TouchStart":eo[kn]===eo.MouseUp&&(Vr="TouchEnd"))}else br(Bn)&&(er=to.Touch);null!==er?(gn=er,(Vr.startsWith("Touch")&&er===to.Touch||Vr.startsWith("Mouse")&&er===to.Mouse)&&(er=null)):eo[kn]===eo.Click&&(er=gn,gn=null);const ui=br(Bn)?Bn.changedTouches[0]:Bn;if(!ui)return;const Yt=$.getId(Jn),{clientX:Tr,clientY:Hs}=ui;wi(R)({type:eo[Vr],id:Yt,x:Tr,y:Hs,...null!==er&&{pointerType:er}})})(kn);if(window.PointerEvent)switch(eo[kn]){case eo.MouseDown:case eo.MouseUp:Bn=Bn.replace("mouse","pointer");break;case eo.TouchStart:case eo.TouchEnd:return}Lt.push(bt(Bn,Jn,L))}),wi(()=>{Lt.forEach(kn=>kn())})}(R),Et=Bo(R),en=function _c({viewportResizeCb:R},{win:L}){let $=-1,ee=-1;return bt("resize",wi(ei(wi(()=>{const st=Vs(),Et=gr();($!==st||ee!==Et)&&(R({width:Number(Et),height:Number(st)}),$=st,ee=Et)}),200)),L)}(R,{win:$}),Lt=Qo(R),gn=function Yc({mediaInteractionCb:R,blockClass:L,blockSelector:$,unblockSelector:ee,mirror:Ee,sampling:st,doc:Et}){const en=wi(gn=>ei(wi(Rn=>{const kn=ga(Rn);if(!kn||ti(kn,L,$,ee,!0))return;const{currentTime:Bn,volume:Jn,muted:er,playbackRate:Vr}=kn;R({type:gn,id:Ee.getId(kn),currentTime:Bn,volume:Jn,muted:er,playbackRate:Vr})}),st.media||500)),Lt=[bt("play",en(0),Et),bt("pause",en(1),Et),bt("seeked",en(2),Et),bt("volumechange",en(3),Et),bt("ratechange",en(4),Et)];return wi(()=>{Lt.forEach(gn=>gn())})}(R),Rn=function oa({styleSheetRuleCb:R,mirror:L,stylesheetManager:$},{win:ee}){if(!ee.CSSStyleSheet||!ee.CSSStyleSheet.prototype)return()=>{};const Ee=ee.CSSStyleSheet.prototype.insertRule;ee.CSSStyleSheet.prototype.insertRule=new Proxy(Ee,{apply:wi((Rn,kn,Bn)=>{const[Jn,er]=Bn,{id:Vr,styleId:ui}=Fa(kn,L,$.styleMirror);return(Vr&&-1!==Vr||ui&&-1!==ui)&&R({id:Vr,styleId:ui,adds:[{rule:Jn,index:er}]}),Rn.apply(kn,Bn)})});const st=ee.CSSStyleSheet.prototype.deleteRule;let Et,en;ee.CSSStyleSheet.prototype.deleteRule=new Proxy(st,{apply:wi((Rn,kn,Bn)=>{const[Jn]=Bn,{id:er,styleId:Vr}=Fa(kn,L,$.styleMirror);return(er&&-1!==er||Vr&&-1!==Vr)&&R({id:er,styleId:Vr,removes:[{index:Jn}]}),Rn.apply(kn,Bn)})}),ee.CSSStyleSheet.prototype.replace&&(Et=ee.CSSStyleSheet.prototype.replace,ee.CSSStyleSheet.prototype.replace=new Proxy(Et,{apply:wi((Rn,kn,Bn)=>{const[Jn]=Bn,{id:er,styleId:Vr}=Fa(kn,L,$.styleMirror);return(er&&-1!==er||Vr&&-1!==Vr)&&R({id:er,styleId:Vr,replace:Jn}),Rn.apply(kn,Bn)})})),ee.CSSStyleSheet.prototype.replaceSync&&(en=ee.CSSStyleSheet.prototype.replaceSync,ee.CSSStyleSheet.prototype.replaceSync=new Proxy(en,{apply:wi((Rn,kn,Bn)=>{const[Jn]=Bn,{id:er,styleId:Vr}=Fa(kn,L,$.styleMirror);return(er&&-1!==er||Vr&&-1!==Vr)&&R({id:er,styleId:Vr,replaceSync:Jn}),Rn.apply(kn,Bn)})}));const Lt={};aa("CSSGroupingRule")?Lt.CSSGroupingRule=ee.CSSGroupingRule:(aa("CSSMediaRule")&&(Lt.CSSMediaRule=ee.CSSMediaRule),aa("CSSConditionRule")&&(Lt.CSSConditionRule=ee.CSSConditionRule),aa("CSSSupportsRule")&&(Lt.CSSSupportsRule=ee.CSSSupportsRule));const gn={};return Object.entries(Lt).forEach(([Rn,kn])=>{gn[Rn]={insertRule:kn.prototype.insertRule,deleteRule:kn.prototype.deleteRule},kn.prototype.insertRule=new Proxy(gn[Rn].insertRule,{apply:wi((Bn,Jn,er)=>{const[Vr,ui]=er,{id:Yt,styleId:Tr}=Fa(Jn.parentStyleSheet,L,$.styleMirror);return(Yt&&-1!==Yt||Tr&&-1!==Tr)&&R({id:Yt,styleId:Tr,adds:[{rule:Vr,index:[...Ko(Jn),ui||0]}]}),Bn.apply(Jn,er)})}),kn.prototype.deleteRule=new Proxy(gn[Rn].deleteRule,{apply:wi((Bn,Jn,er)=>{const[Vr]=er,{id:ui,styleId:Yt}=Fa(Jn.parentStyleSheet,L,$.styleMirror);return(ui&&-1!==ui||Yt&&-1!==Yt)&&R({id:ui,styleId:Yt,removes:[{index:[...Ko(Jn),Vr]}]}),Bn.apply(Jn,er)})})}),wi(()=>{ee.CSSStyleSheet.prototype.insertRule=Ee,ee.CSSStyleSheet.prototype.deleteRule=st,Et&&(ee.CSSStyleSheet.prototype.replace=Et),en&&(ee.CSSStyleSheet.prototype.replaceSync=en),Object.entries(Lt).forEach(([Rn,kn])=>{kn.prototype.insertRule=gn[Rn].insertRule,kn.prototype.deleteRule=gn[Rn].deleteRule})})}(R,{win:$}),kn=Bl(R,R.doc),Bn=function Qa({styleDeclarationCb:R,mirror:L,ignoreCSSAttributes:$,stylesheetManager:ee},{win:Ee}){const st=Ee.CSSStyleDeclaration.prototype.setProperty;Ee.CSSStyleDeclaration.prototype.setProperty=new Proxy(st,{apply:wi((en,Lt,gn)=>{const[Rn,kn,Bn]=gn;if($.has(Rn))return st.apply(Lt,[Rn,kn,Bn]);const{id:Jn,styleId:er}=Fa(Zs([Lt,"access",Vr=>Vr.parentRule,"optionalAccess",Vr=>Vr.parentStyleSheet]),L,ee.styleMirror);return(Jn&&-1!==Jn||er&&-1!==er)&&R({id:Jn,styleId:er,set:{property:Rn,value:kn,priority:Bn},index:Ko(Lt.parentRule)}),en.apply(Lt,gn)})});const Et=Ee.CSSStyleDeclaration.prototype.removeProperty;return Ee.CSSStyleDeclaration.prototype.removeProperty=new Proxy(Et,{apply:wi((en,Lt,gn)=>{const[Rn]=gn;if($.has(Rn))return Et.apply(Lt,[Rn]);const{id:kn,styleId:Bn}=Fa(Zs([Lt,"access",Jn=>Jn.parentRule,"optionalAccess",Jn=>Jn.parentStyleSheet]),L,ee.styleMirror);return(kn&&-1!==kn||Bn&&-1!==Bn)&&R({id:kn,styleId:Bn,remove:{property:Rn},index:Ko(Lt.parentRule)}),en.apply(Lt,gn)})}),wi(()=>{Ee.CSSStyleDeclaration.prototype.setProperty=st,Ee.CSSStyleDeclaration.prototype.removeProperty=Et})}(R,{win:$}),Jn=R.collectFonts?function So({fontCb:R,doc:L}){const $=L.defaultView;if(!$)return()=>{};const ee=[],Ee=new WeakMap,st=$.FontFace;$.FontFace=function(Lt,gn,Rn){const kn=new st(Lt,gn,Rn);return Ee.set(kn,{family:Lt,buffer:"string"!=typeof gn,descriptors:Rn,fontSource:"string"==typeof gn?gn:JSON.stringify(Array.from(new Uint8Array(gn)))}),kn};const Et=li(L.fonts,"add",function(en){return function(Lt){return setTimeout(wi(()=>{const gn=Ee.get(Lt);gn&&(R(gn),Ee.delete(Lt))}),0),en.apply(this,[Lt])}});return ee.push(()=>{$.FontFace=st}),ee.push(Et),wi(()=>{ee.forEach(en=>en())})}(R):()=>{},er=function Vl(R){const{doc:L,mirror:$,blockClass:ee,blockSelector:Ee,unblockSelector:st,selectionCb:Et}=R;let en=!0;const Lt=wi(()=>{const gn=L.getSelection();if(!gn||en&&Zs([gn,"optionalAccess",Bn=>Bn.isCollapsed]))return;en=gn.isCollapsed||!1;const Rn=[],kn=gn.rangeCount||0;for(let Bn=0;Bn<kn;Bn++){const Jn=gn.getRangeAt(Bn),{startContainer:er,startOffset:Vr,endContainer:ui,endOffset:Yt}=Jn;ti(er,ee,Ee,st,!0)||ti(ui,ee,Ee,st,!0)||Rn.push({start:$.getId(er),startOffset:Vr,end:$.getId(ui),endOffset:Yt})}Et({ranges:Rn})});return Lt(),bt("selectionchange",Lt)}(R),Vr=function Ul({doc:R,customElementCb:L}){const $=R.defaultView;return $&&$.customElements?li($.customElements,"define",function(Ee){return function(st,Et,en){try{L({define:{name:st}})}catch{}return Ee.apply(this,[st,Et,en])}}):()=>{}}(R),ui=[];for(const Yt of R.plugins)ui.push(Yt.observer(Yt.callback,$,Yt.options));return wi(()=>{Us.forEach(Yt=>Yt.reset()),ee.disconnect(),Ee(),st(),Et(),en(),Lt(),gn(),Rn(),kn(),Bn(),Jn(),er(),Vr(),ui.forEach(Yt=>Yt())})}function zl(R){return typeof window[R]<"u"}function aa(R){return!!(typeof window[R]<"u"&&window[R].prototype&&"insertRule"in window[R].prototype&&"deleteRule"in window[R].prototype)}class Ba{constructor(L){this.generateIdFn=L,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(L,$,ee,Ee){const st=ee||this.getIdToRemoteIdMap(L),Et=Ee||this.getRemoteIdToIdMap(L);let en=st.get($);return en||(en=this.generateIdFn(),st.set($,en),Et.set(en,$)),en}getIds(L,$){const ee=this.getIdToRemoteIdMap(L),Ee=this.getRemoteIdToIdMap(L);return $.map(st=>this.getId(L,st,ee,Ee))}getRemoteId(L,$,ee){const Ee=ee||this.getRemoteIdToIdMap(L);return"number"!=typeof $?$:Ee.get($)||-1}getRemoteIds(L,$){const ee=this.getRemoteIdToIdMap(L);return $.map(Ee=>this.getRemoteId(L,Ee,ee))}reset(L){if(!L)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(L),this.iframeRemoteIdToIdMap.delete(L)}getIdToRemoteIdMap(L){let $=this.iframeIdToRemoteIdMap.get(L);return $||($=new Map,this.iframeIdToRemoteIdMap.set(L,$)),$}getRemoteIdToIdMap(L){let $=this.iframeRemoteIdToIdMap.get(L);return $||($=new Map,this.iframeRemoteIdToIdMap.set(L,$)),$}}function Va(R){let L,$=R[0],ee=1;for(;ee<R.length;){const Ee=R[ee],st=R[ee+1];if(ee+=2,("optionalAccess"===Ee||"optionalCall"===Ee)&&null==$)return;"access"===Ee||"optionalAccess"===Ee?(L=$,$=st($)):("call"===Ee||"optionalCall"===Ee)&&($=st((...Et)=>$.call(L,...Et)),L=void 0)}return $}class Vc{constructor(){this.crossOriginIframeMirror=new Ba($e),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}}class Vo{constructor(L){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Ba($e),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=L.mutationCb,this.wrappedEmit=L.wrappedEmit,this.stylesheetManager=L.stylesheetManager,this.recordCrossOriginIframes=L.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Ba(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=L.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(L){this.iframes.set(L,!0),L.contentWindow&&this.crossOriginIframeMap.set(L.contentWindow,L)}addLoadListener(L){this.loadListener=L}attachIframe(L,$){this.mutationCb({adds:[{parentId:this.mirror.getId(L),nextId:null,node:$}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),Va([this,"access",ee=>ee.loadListener,"optionalCall",ee=>ee(L)]),L.contentDocument&&L.contentDocument.adoptedStyleSheets&&L.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(L.contentDocument.adoptedStyleSheets,this.mirror.getId(L.contentDocument))}handleMessage(L){const $=L;if("rrweb"!==$.data.type||$.origin!==$.data.origin||!L.source)return;const Ee=this.crossOriginIframeMap.get(L.source);if(!Ee)return;const st=this.transformCrossOriginEvent(Ee,$.data.event);st&&this.wrappedEmit(st,$.data.isCheckout)}transformCrossOriginEvent(L,$){switch($.type){case Fi.FullSnapshot:{this.crossOriginIframeMirror.reset(L),this.crossOriginIframeStyleMirror.reset(L),this.replaceIdOnNode($.data.node,L);const ee=$.data.node.id;return this.crossOriginIframeRootIdMap.set(L,ee),this.patchRootIdOnNode($.data.node,ee),{timestamp:$.timestamp,type:Fi.IncrementalSnapshot,data:{source:Nr.Mutation,adds:[{parentId:this.mirror.getId(L),nextId:null,node:$.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case Fi.Meta:case Fi.Load:case Fi.DomContentLoaded:return!1;case Fi.Plugin:return $;case Fi.Custom:return this.replaceIds($.data.payload,L,["id","parentId","previousId","nextId"]),$;case Fi.IncrementalSnapshot:switch($.data.source){case Nr.Mutation:return $.data.adds.forEach(ee=>{this.replaceIds(ee,L,["parentId","nextId","previousId"]),this.replaceIdOnNode(ee.node,L);const Ee=this.crossOriginIframeRootIdMap.get(L);Ee&&this.patchRootIdOnNode(ee.node,Ee)}),$.data.removes.forEach(ee=>{this.replaceIds(ee,L,["parentId","id"])}),$.data.attributes.forEach(ee=>{this.replaceIds(ee,L,["id"])}),$.data.texts.forEach(ee=>{this.replaceIds(ee,L,["id"])}),$;case Nr.Drag:case Nr.TouchMove:case Nr.MouseMove:return $.data.positions.forEach(ee=>{this.replaceIds(ee,L,["id"])}),$;case Nr.ViewportResize:return!1;case Nr.MediaInteraction:case Nr.MouseInteraction:case Nr.Scroll:case Nr.CanvasMutation:case Nr.Input:return this.replaceIds($.data,L,["id"]),$;case Nr.StyleSheetRule:case Nr.StyleDeclaration:return this.replaceIds($.data,L,["id"]),this.replaceStyleIds($.data,L,["styleId"]),$;case Nr.Font:return $;case Nr.Selection:return $.data.ranges.forEach(ee=>{this.replaceIds(ee,L,["start","end"])}),$;case Nr.AdoptedStyleSheet:return this.replaceIds($.data,L,["id"]),this.replaceStyleIds($.data,L,["styleIds"]),Va([$,"access",ee=>ee.data,"access",ee=>ee.styles,"optionalAccess",ee=>ee.forEach,"call",ee=>ee(Ee=>{this.replaceStyleIds(Ee,L,["styleId"])})]),$}}return!1}replace(L,$,ee,Ee){for(const st of Ee)!Array.isArray($[st])&&"number"!=typeof $[st]||($[st]=Array.isArray($[st])?L.getIds(ee,$[st]):L.getId(ee,$[st]));return $}replaceIds(L,$,ee){return this.replace(this.crossOriginIframeMirror,L,$,ee)}replaceStyleIds(L,$,ee){return this.replace(this.crossOriginIframeStyleMirror,L,$,ee)}replaceIdOnNode(L,$){this.replaceIds(L,$,["id","rootId"]),"childNodes"in L&&L.childNodes.forEach(ee=>{this.replaceIdOnNode(ee,$)})}patchRootIdOnNode(L,$){L.type!==Zn.Document&&!L.rootId&&(L.rootId=$),"childNodes"in L&&L.childNodes.forEach(ee=>{this.patchRootIdOnNode(ee,$)})}}class Ia{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}}class Ya{constructor(L){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=L.mutationCb,this.scrollCb=L.scrollCb,this.bypassOptions=L.bypassOptions,this.mirror=L.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(L,$){if(!Sr(L)||this.shadowDoms.has(L))return;this.shadowDoms.add(L);const ee=Ei({...this.bypassOptions,doc:$,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},L);this.restoreHandlers.push(()=>ee.disconnect()),this.restoreHandlers.push(Bo({...this.bypassOptions,scrollCb:this.scrollCb,doc:L,mirror:this.mirror})),setTimeout(()=>{L.adoptedStyleSheets&&L.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(L.adoptedStyleSheets,this.mirror.getId(L.host)),this.restoreHandlers.push(Bl({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},L))},0)}observeAttachShadow(L){!L.contentWindow||!L.contentDocument||this.patchAttachShadow(L.contentWindow.Element,L.contentDocument)}patchAttachShadow(L,$){const ee=this;this.restoreHandlers.push(li(L.prototype,"attachShadow",function(Ee){return function(st){const Et=Ee.call(this,st);return this.shadowRoot&&Wo(this)&&ee.addShadowRoot(this.shadowRoot,$),Et}}))}reset(){this.restoreHandlers.forEach(L=>{try{L()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}}class Ua{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}snapshot(){}}class Sa{constructor(L){this.trackedLinkElements=new WeakSet,this.styleMirror=new ys,this.mutationCb=L.mutationCb,this.adoptedStyleSheetCb=L.adoptedStyleSheetCb}attachLinkElement(L,$){"_cssText"in $.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:$.id,attributes:$.attributes}]}),this.trackLinkElement(L)}trackLinkElement(L){this.trackedLinkElements.has(L)||(this.trackedLinkElements.add(L),this.trackStylesheetInLinkElement(L))}adoptStyleSheets(L,$){if(0===L.length)return;const ee={id:$,styleIds:[]},Ee=[];for(const st of L){let Et;this.styleMirror.has(st)?Et=this.styleMirror.getId(st):(Et=this.styleMirror.add(st),Ee.push({styleId:Et,rules:Array.from(st.rules||CSSRule,(en,Lt)=>({rule:Ce(en),index:Lt}))})),ee.styleIds.push(Et)}Ee.length>0&&(ee.styles=Ee),this.adoptedStyleSheetCb(ee)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(L){}}class ro{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){!function bl(...R){return function Iu(){if(gc)return gc;const R=window.document;let L=window.requestAnimationFrame;if(R&&"function"==typeof R.createElement)try{const $=R.createElement("iframe");$.hidden=!0,R.head.appendChild($);const ee=$.contentWindow;ee&&ee.requestAnimationFrame&&(L=ee.requestAnimationFrame),R.head.removeChild($)}catch{}return gc=L.bind(window)}()(...R)}(()=>{this.clear(),this.loop&&this.periodicallyClear()})}inOtherBuffer(L,$){const ee=this.nodeMap.get(L);return ee&&Array.from(ee).some(Ee=>Ee!==$)}add(L,$){this.nodeMap.set(L,(this.nodeMap.get(L)||new Set).add($))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}}function si(R){const L=R;return L.timestamp=xi(),L}let Aa;const Po=function vi(){return new Ur}();function _a(R={}){const{emit:L,checkoutEveryNms:$,checkoutEveryNth:ee,blockClass:Ee="rr-block",blockSelector:st=null,unblockSelector:Et=null,ignoreClass:en="rr-ignore",ignoreSelector:Lt=null,maskAllText:gn=!1,maskTextClass:Rn="rr-mask",unmaskTextClass:kn=null,maskTextSelector:Bn=null,unmaskTextSelector:Jn=null,inlineStylesheet:er=!0,maskAllInputs:Vr,maskInputOptions:ui,slimDOMOptions:Yt,maskAttributeFn:Tr,maskInputFn:Hs,maskTextFn:Ms,packFn:mi,sampling:Yr={},dataURLOptions:ri={},mousemoveWait:Mi,recordCanvas:po=!1,recordCrossOriginIframes:Rr=!1,recordAfter:ls=("DOMContentLoaded"===R.recordAfter?R.recordAfter:"load"),userTriggeredOnInput:Rs=!1,collectFonts:Yi=!1,inlineImages:Qs=!1,plugins:ko,keepIframeSrcFn:ps=(()=>!1),ignoreCSSAttributes:Ma=new Set([]),errorHandler:xo,onMutation:oo,getCanvasManager:Ha}=R;!function hs(R){ia=R}(xo);const Tc=!Rr||window.parent===window;let No=!1;if(!Tc)try{window.parent.document&&(No=!1)}catch{No=!0}if(Tc&&!L)throw new Error("emit function is required");void 0!==Mi&&void 0===Yr.mousemove&&(Yr.mousemove=Mi),Po.reset();const fl=!0===Vr?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==ui?ui:{},mu=!0===Yt||"all"===Yt?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===Yt,headMetaDescKeywords:"all"===Yt}:Yt||{};!function Ui(R=window){"NodeList"in R&&!R.NodeList.prototype.forEach&&(R.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in R&&!R.DOMTokenList.prototype.forEach&&(R.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...L)=>{let $=L[0];if(!(0 in L))throw new TypeError("1 argument is required");do{if(this===$)return!0}while($=$&&$.parentNode);return!1})}();let tu,Cu=0;const Nh=es=>{for(const Ic of ko||[])Ic.eventProcessor&&(es=Ic.eventProcessor(es));return mi&&!No&&(es=mi(es)),es},mo=(es,Ic)=>{if(ye([Us,"access",rs=>rs[0],"optionalAccess",rs=>rs.isFrozen,"call",rs=>rs()])&&es.type!==Fi.FullSnapshot&&!(es.type===Fi.IncrementalSnapshot&&es.data.source===Nr.Mutation)&&Us.forEach(rs=>rs.unfreeze()),Tc)ye([L,"optionalCall",rs=>rs(Nh(es),Ic)]);else if(No){const rs={type:"rrweb",event:Nh(es),origin:window.location.origin,isCheckout:Ic};window.parent.postMessage(rs,"*")}if(es.type===Fi.FullSnapshot)tu=es,Cu=0;else if(es.type===Fi.IncrementalSnapshot){if(es.data.source===Nr.Mutation&&es.data.isAttachIframe)return;Cu++,(ee&&Cu>=ee||$&&es.timestamp-tu.timestamp>$)&&bo(!0)}},kl=es=>{mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.Mutation,...es}}))},Oc=es=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.Scroll,...es}})),pl=es=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.CanvasMutation,...es}})),ml=new Sa({mutationCb:kl,adoptedStyleSheetCb:es=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.AdoptedStyleSheet,...es}}))}),pa="boolean"==typeof __RRWEB_EXCLUDE_IFRAME__&&__RRWEB_EXCLUDE_IFRAME__?new Vc:new Vo({mirror:Po,mutationCb:kl,stylesheetManager:ml,recordCrossOriginIframes:Rr,wrappedEmit:mo});for(const es of ko||[])es.getMirror&&es.getMirror({nodeMirror:Po,crossOriginIframeMirror:pa.crossOriginIframeMirror,crossOriginIframeStyleMirror:pa.crossOriginIframeStyleMirror});const Lh=new ro,Ra=function tc(R,L){try{return R?R(L):new Ua}catch{return console.warn("Unable to initialize CanvasManager"),new Ua}}(Ha,{mirror:Po,win:window,mutationCb:es=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.CanvasMutation,...es}})),recordCanvas:po,blockClass:Ee,blockSelector:st,unblockSelector:Et,sampling:Yr.canvas,dataURLOptions:ri,errorHandler:xo}),nu="boolean"==typeof __RRWEB_EXCLUDE_SHADOW_DOM__&&__RRWEB_EXCLUDE_SHADOW_DOM__?new Ia:new Ya({mutationCb:kl,scrollCb:Oc,bypassOptions:{onMutation:oo,blockClass:Ee,blockSelector:st,unblockSelector:Et,maskAllText:gn,maskTextClass:Rn,unmaskTextClass:kn,maskTextSelector:Bn,unmaskTextSelector:Jn,inlineStylesheet:er,maskInputOptions:fl,dataURLOptions:ri,maskAttributeFn:Tr,maskTextFn:Ms,maskInputFn:Hs,recordCanvas:po,inlineImages:Qs,sampling:Yr,slimDOMOptions:mu,iframeManager:pa,stylesheetManager:ml,canvasManager:Ra,keepIframeSrcFn:ps,processedNodeManager:Lh},mirror:Po}),bo=(es=!1)=>{mo(si({type:Fi.Meta,data:{href:window.location.href,width:gr(),height:Vs()}}),es),ml.reset(),nu.init(),Us.forEach(rs=>rs.lock());const Ic=function Nt(R,L){const{mirror:$=new Ur,blockClass:ee="rr-block",blockSelector:Ee=null,unblockSelector:st=null,maskAllText:Et=!1,maskTextClass:en="rr-mask",unmaskTextClass:Lt=null,maskTextSelector:gn=null,unmaskTextSelector:Rn=null,inlineStylesheet:kn=!0,inlineImages:Bn=!1,recordCanvas:Jn=!1,maskAllInputs:er=!1,maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,slimDOM:Tr=!1,dataURLOptions:Hs,preserveWhiteSpace:Ms,onSerialize:mi,onIframeLoad:Yr,iframeLoadTimeout:ri,onStylesheetLoad:Mi,stylesheetLoadTimeout:po,keepIframeSrcFn:Rr=(()=>!1)}=L||{};return Dt(R,{doc:R,mirror:$,blockClass:ee,blockSelector:Ee,unblockSelector:st,maskAllText:Et,maskTextClass:en,unmaskTextClass:Lt,maskTextSelector:gn,unmaskTextSelector:Rn,skipChild:!1,inlineStylesheet:kn,maskInputOptions:!0===er?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===er?{}:er,maskAttributeFn:Vr,maskTextFn:ui,maskInputFn:Yt,slimDOMOptions:!0===Tr||"all"===Tr?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===Tr,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===Tr?{}:Tr,dataURLOptions:Hs,inlineImages:Bn,recordCanvas:Jn,preserveWhiteSpace:Ms,onSerialize:mi,onIframeLoad:Yr,iframeLoadTimeout:ri,onStylesheetLoad:Mi,stylesheetLoadTimeout:po,keepIframeSrcFn:Rr,newlyAddedElement:!1})}(document,{mirror:Po,blockClass:Ee,blockSelector:st,unblockSelector:Et,maskAllText:gn,maskTextClass:Rn,unmaskTextClass:kn,maskTextSelector:Bn,unmaskTextSelector:Jn,inlineStylesheet:er,maskAllInputs:fl,maskAttributeFn:Tr,maskInputFn:Hs,maskTextFn:Ms,slimDOM:mu,dataURLOptions:ri,recordCanvas:po,inlineImages:Qs,onSerialize:rs=>{Mo(rs,Po)&&pa.addIframe(rs),bs(rs,Po)&&ml.trackLinkElement(rs),Gi(rs)&&nu.addShadowRoot(rs.shadowRoot,document)},onIframeLoad:(rs,ru)=>{pa.attachIframe(rs,ru),nu.observeAttachShadow(rs)},onStylesheetLoad:(rs,ru)=>{ml.attachLinkElement(rs,ru)},keepIframeSrcFn:ps});if(!Ic)return console.warn("Failed to snapshot the document");mo(si({type:Fi.FullSnapshot,data:{node:Ic,initialOffset:Ds(window)}})),Us.forEach(rs=>rs.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&ml.adoptStyleSheets(document.adoptedStyleSheets,Po.getId(document))};Aa=bo;try{const es=[],Ic=ru=>wi(Ki)({onMutation:oo,mutationCb:kl,mousemoveCb:(To,go)=>mo(si({type:Fi.IncrementalSnapshot,data:{source:go,positions:To}})),mouseInteractionCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.MouseInteraction,...To}})),scrollCb:Oc,viewportResizeCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.ViewportResize,...To}})),inputCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.Input,...To}})),mediaInteractionCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.MediaInteraction,...To}})),styleSheetRuleCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.StyleSheetRule,...To}})),styleDeclarationCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.StyleDeclaration,...To}})),canvasMutationCb:pl,fontCb:To=>mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.Font,...To}})),selectionCb:To=>{mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.Selection,...To}}))},customElementCb:To=>{mo(si({type:Fi.IncrementalSnapshot,data:{source:Nr.CustomElement,...To}}))},blockClass:Ee,ignoreClass:en,ignoreSelector:Lt,maskAllText:gn,maskTextClass:Rn,unmaskTextClass:kn,maskTextSelector:Bn,unmaskTextSelector:Jn,maskInputOptions:fl,inlineStylesheet:er,sampling:Yr,recordCanvas:po,inlineImages:Qs,userTriggeredOnInput:Rs,collectFonts:Yi,doc:ru,maskAttributeFn:Tr,maskInputFn:Hs,maskTextFn:Ms,keepIframeSrcFn:ps,blockSelector:st,unblockSelector:Et,slimDOMOptions:mu,dataURLOptions:ri,mirror:Po,iframeManager:pa,stylesheetManager:ml,shadowDomManager:nu,processedNodeManager:Lh,canvasManager:Ra,ignoreCSSAttributes:Ma,plugins:ye([ko,"optionalAccess",To=>To.filter,"call",To=>To(go=>go.observer),"optionalAccess",To=>To.map,"call",To=>To(go=>({observer:go.observer,options:go.options,callback:ii=>mo(si({type:Fi.Plugin,data:{plugin:go.name,payload:ii}}))}))])||[]},{});pa.addLoadListener(ru=>{try{es.push(Ic(ru.contentDocument))}catch(To){console.warn(To)}});const rs=()=>{bo(),es.push(Ic(document))};return"interactive"===document.readyState||"complete"===document.readyState?rs():(es.push(bt("DOMContentLoaded",()=>{mo(si({type:Fi.DomContentLoaded,data:{}})),"DOMContentLoaded"===ls&&rs()})),es.push(bt("load",()=>{mo(si({type:Fi.Load,data:{}})),"load"===ls&&rs()},window))),()=>{es.forEach(ru=>ru()),Lh.destroy(),Aa=void 0,function sa(){ia=void 0}()}}catch(es){console.warn(es)}}_a.mirror=Po,_a.takeFullSnapshot=function zi(R){if(!Aa)throw new Error("please take full snapshot after start recording");Aa(R)};const Uo=3;function ns(R){return R>9999999999?R:1e3*R}function ll(R){return R>9999999999?R/1e3:R}function Hi(R,L){"sentry.transaction"!==L.category&&(["ui.click","ui.input"].includes(L.category)?R.triggerUserActivity():R.checkAndHandleExpiredSession(),R.addUpdate(()=>(R.throttledAddEvent({type:Fi.Custom,timestamp:1e3*(L.timestamp||0),data:{tag:"breadcrumb",payload:(0,ht.S8)(L,10,1e3)}}),"console"===L.category)))}const cl="button,a";function nc(R){return R.closest(cl)||R}function Ja(R){const L=da(R);return L&&L instanceof Element?nc(L):L}function da(R){return function vs(R){return"object"==typeof R&&!!R&&"target"in R}(R)?R.target:R}let el;class Mc{constructor(L,$,ee=Hi){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=$.timeout/1e3,this._threshold=$.threshold/1e3,this._scollTimeout=$.scrollTimeout/1e3,this._replay=L,this._ignoreSelector=$.ignoreSelector,this._addBreadcrumbEvent=ee}addListeners(){const L=function uu(R){return el||(el=[],function Sl(){(0,et.GS)(lt,"open",function(R){return function(...L){if(el)try{el.forEach($=>$())}catch{}return R.apply(lt,L)}})}()),el.push(R),()=>{const L=el?el.indexOf(R):-1;L>-1&&el.splice(L,1)}}(()=>{this._lastMutation=jl()});this._teardown=()=>{L(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(L,$){if(function rc(R,L){return!!(!Al.includes(R.tagName)||"INPUT"===R.tagName&&!["submit","button"].includes(R.getAttribute("type")||"")||"A"===R.tagName&&(R.hasAttribute("download")||R.hasAttribute("target")&&"_self"!==R.getAttribute("target"))||L&&R.matches(L))}($,this._ignoreSelector)||!function Ts(R){return!(!R.data||"number"!=typeof R.data.nodeId||!R.timestamp)}(L))return;const ee={timestamp:ll(L.timestamp),clickBreadcrumb:L,clickCount:0,node:$};this._clicks.some(Ee=>Ee.node===ee.node&&Math.abs(Ee.timestamp-ee.timestamp)<1)||(this._clicks.push(ee),1===this._clicks.length&&this._scheduleCheckClicks())}registerMutation(L=Date.now()){this._lastMutation=ll(L)}registerScroll(L=Date.now()){this._lastScroll=ll(L)}registerClick(L){const $=nc(L);this._handleMultiClick($)}_handleMultiClick(L){this._getClicks(L).forEach($=>{$.clickCount++})}_getClicks(L){return this._clicks.filter($=>$.node===L)}_checkClicks(){const L=[],$=jl();this._clicks.forEach(ee=>{!ee.mutationAfter&&this._lastMutation&&(ee.mutationAfter=ee.timestamp<=this._lastMutation?this._lastMutation-ee.timestamp:void 0),!ee.scrollAfter&&this._lastScroll&&(ee.scrollAfter=ee.timestamp<=this._lastScroll?this._lastScroll-ee.timestamp:void 0),ee.timestamp+this._timeout<=$&&L.push(ee)});for(const ee of L){const Ee=this._clicks.indexOf(ee);Ee>-1&&(this._generateBreadcrumbs(ee),this._clicks.splice(Ee,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(L){const $=this._replay,st=!(L.scrollAfter&&L.scrollAfter<=this._scollTimeout||L.mutationAfter&&L.mutationAfter<=this._threshold),{clickCount:Et,clickBreadcrumb:en}=L;if(st){const Lt=1e3*Math.min(L.mutationAfter||this._timeout,this._timeout),gn=Lt<1e3*this._timeout?"mutation":"timeout",Rn={type:"default",message:en.message,timestamp:en.timestamp,category:"ui.slowClickDetected",data:{...en.data,url:lt.location.href,route:$.getCurrentRoute(),timeAfterClickMs:Lt,endReason:gn,clickCount:Et||1}};this._addBreadcrumbEvent($,Rn)}else if(Et>1){const Lt={type:"default",message:en.message,timestamp:en.timestamp,category:"ui.multiClick",data:{...en.data,url:lt.location.href,route:$.getCurrentRoute(),clickCount:Et,metric:!0}};this._addBreadcrumbEvent($,Lt)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=setTimeout(()=>this._checkClicks(),1e3)}}const Al=["A","BUTTON","INPUT"];function jl(){return Date.now()/1e3}function zo(R){return{timestamp:Date.now()/1e3,type:"default",...R}}var yc=function(R){return R[R.Document=0]="Document",R[R.DocumentType=1]="DocumentType",R[R.Element=2]="Element",R[R.Text=3]="Text",R[R.CDATA=4]="CDATA",R[R.Comment=5]="Comment",R}(yc||{});const Ca=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled","data-sentry-component"]);function Jc(R){const L={};for(const $ in R)if(Ca.has($)){let ee=$;("data-testid"===$||"data-test-id"===$)&&(ee="testId"),L[ee]=R[$]}return L}function Gl(R,L){const $=_a.mirror.getId(R),ee=$&&_a.mirror.getNode($),Ee=ee&&_a.mirror.getMeta(ee),st=Ee&&function xc(R){return R.type===yc.Element}(Ee)?Ee:null;return{message:L,data:st?{nodeId:$,node:{id:$,tagName:st.tagName,textContent:Array.from(st.childNodes).map(Et=>Et.type===yc.Text&&Et.textContent).filter(Boolean).map(Et=>Et.trim()).join(""),attributes:Jc(st.attributes)}}:{}}}const Yo={resource:function eu(R){const{entryType:L,initiatorType:$,name:ee,responseEnd:Ee,startTime:st,decodedBodySize:Et,encodedBodySize:en,responseStatus:Lt,transferSize:gn}=R;return["fetch","xmlhttprequest"].includes($)?null:{type:`${L}.${$}`,start:Ml(st),end:Ml(Ee),name:ee,data:{size:gn,statusCode:Lt,decodedBodySize:Et,encodedBodySize:en}}},paint:function tl(R){const{duration:L,entryType:$,name:ee,startTime:Ee}=R,st=Ml(Ee);return{type:$,name:ee,start:st,end:st+L,data:void 0}},navigation:function du(R){const{entryType:L,name:$,decodedBodySize:ee,duration:Ee,domComplete:st,encodedBodySize:Et,domContentLoadedEventStart:en,domContentLoadedEventEnd:Lt,domInteractive:gn,loadEventStart:Rn,loadEventEnd:kn,redirectCount:Bn,startTime:Jn,transferSize:er,type:Vr}=R;return 0===Ee?null:{type:`${L}.${Vr}`,start:Ml(Jn),end:Ml(st),name:$,data:{size:er,decodedBodySize:ee,encodedBodySize:Et,duration:Ee,domInteractive:gn,domContentLoadedEventStart:en,domContentLoadedEventEnd:Lt,loadEventStart:Rn,loadEventEnd:kn,domComplete:st,redirectCount:Bn}}}};function Ns(R){return Yo[R.entryType]?Yo[R.entryType](R):null}function Ml(R){return((Ue.k3||lt.performance.timeOrigin)+R)/1e3}const os=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function yo(R,L){os&&(nt.vF.info(R),L&&hu(R))}function Hl(R,L){os&&(nt.vF.info(R),L&&setTimeout(()=>{hu(R)},0))}function hu(R){(0,m.ZQ)({category:"console",data:{logger:"replay"},level:"info",message:R},{level:"info"})}class oc extends Error{constructor(){super(`Event buffer exceeded maximum size of ${ur}.`)}}class Ps{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}addEvent(L){var $=this;return(0,O.A)(function*(){const ee=JSON.stringify(L).length;if($._totalSize+=ee,$._totalSize>ur)throw new oc;$.events.push(L)})()}finish(){return new Promise(L=>{const $=this.events;this.clear(),L(JSON.stringify($))})}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){const L=this.events.map($=>$.timestamp).sort()[0];return L?ns(L):null}}class gs{constructor(L){this._worker=L,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise((L,$)=>{this._worker.addEventListener("message",({data:ee})=>{ee.success?L():$()},{once:!0}),this._worker.addEventListener("error",ee=>{$(ee)},{once:!0})})),this._ensureReadyPromise}destroy(){yo("[Replay] Destroying compression worker"),this._worker.terminate()}postMessage(L,$){const ee=this._getAndIncrementId();return new Promise((Ee,st)=>{const Et=({data:en})=>{const Lt=en;if(Lt.method===L&&Lt.id===ee){if(this._worker.removeEventListener("message",Et),!Lt.success)return os&&nt.vF.error("[Replay]",Lt.response),void st(new Error("Error in compression worker"));Ee(Lt.response)}};this._worker.addEventListener("message",Et),this._worker.postMessage({id:ee,method:L,arg:$})})}_getAndIncrementId(){return this._id++}}class Wl{constructor(L){this._worker=new gs(L),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(L){const $=ns(L.timestamp);(!this._earliestTimestamp||$<this._earliestTimestamp)&&(this._earliestTimestamp=$);const ee=JSON.stringify(L);return this._totalSize+=ee.length,this._totalSize>ur?Promise.reject(new oc):this._sendEventToWorker(ee)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear").then(null,L=>{os&&nt.vF.warn('[Replay] Sending "clear" message to worker failed',L)})}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(L){return this._worker.postMessage("addEvent",L)}_finishRequest(){var L=this;return(0,O.A)(function*(){const $=yield L._worker.postMessage("finish");return L._earliestTimestamp=null,L._totalSize=0,$})()}}class ja{constructor(L){this._fallback=new Ps,this._compression=new Wl(L),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(L){this._used.hasCheckout=L}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(L){return this._used.addEvent(L)}finish(){var L=this;return(0,O.A)(function*(){return yield L.ensureWorkerIsLoaded(),L._used.finish()})()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}_ensureWorkerIsLoaded(){var L=this;return(0,O.A)(function*(){try{yield L._compression.ensureReady()}catch{return void yo("[Replay] Failed to load the compression worker, falling back to simple buffer")}yield L._switchToCompressionWorker()})()}_switchToCompressionWorker(){var L=this;return(0,O.A)(function*(){const{events:$,hasCheckout:ee}=L._fallback,Ee=[];for(const st of $)Ee.push(L._compression.addEvent(st));L._compression.hasCheckout=ee,L._used=L._compression;try{yield Promise.all(Ee)}catch(st){os&&nt.vF.warn("[Replay] Failed to add events when switching buffers.",st)}})()}}function ql(){try{return"sessionStorage"in lt&&!!lt.sessionStorage}catch{return!1}}function $a(R){return void 0!==R&&Math.random()<R}function wc(R){const L=Date.now();return{id:R.id||(0,Xe.eJ)(),started:R.started||L,lastActivity:R.lastActivity||L,segmentId:R.segmentId||0,sampled:R.sampled,previousSessionId:R.previousSessionId}}function io(R){if(ql())try{lt.sessionStorage.setItem(Ct,JSON.stringify(R))}catch{}}function Pl({sessionSampleRate:R,allowBuffering:L,stickySession:$=!1},{previousSessionId:ee}={}){const Ee=function as(R,L){return $a(R)?"session":!!L&&"buffer"}(R,L),st=wc({sampled:Ee,previousSessionId:ee});return $&&io(st),st}function la(R,L,$=+new Date){return null===R||void 0===L||L<0||0!==L&&R+L<=$}function ul(R,{maxReplayDuration:L,sessionIdleExpire:$,targetTime:ee=Date.now()}){return la(R.started,L,ee)||la(R.lastActivity,$,ee)}function lc(R,{sessionIdleExpire:L,maxReplayDuration:$}){return!(!ul(R,{sessionIdleExpire:L,maxReplayDuration:$})||"buffer"===R.sampled&&0===R.segmentId)}function va({traceInternals:R,sessionIdleExpire:L,maxReplayDuration:$,previousSessionId:ee},Ee){const st=Ee.stickySession&&function Ls(R){if(!ql())return null;try{const L=lt.sessionStorage.getItem(Ct);if(!L)return null;const $=JSON.parse(L);return Hl("[Replay] Loading existing session",R),wc($)}catch{return null}}(R);return st?lc(st,{sessionIdleExpire:L,maxReplayDuration:$})?(Hl("[Replay] Session in sessionStorage is expired, creating new one..."),Pl(Ee,{previousSessionId:st.id})):st:(Hl("[Replay] Creating new session",R),Pl(Ee,{previousSessionId:ee}))}function jc(R,L,$){return!!be(R,L)&&(ke(R,L,$),!0)}function ke(R,L,$){return ie.apply(this,arguments)}function ie(){return(ie=(0,O.A)(function*(R,L,$){if(!R.eventBuffer)return null;try{$&&"buffer"===R.recordingMode&&R.eventBuffer.clear(),$&&(R.eventBuffer.hasCheckout=!0);const Ee=function wt(R,L){try{if("function"==typeof L&&function Da(R){return R.type===Fi.Custom}(R))return L(R)}catch($){return os&&nt.vF.error("[Replay] An error occured in the `beforeAddRecordingEvent` callback, skipping the event...",$),null}return R}(L,R.getOptions().beforeAddRecordingEvent);return Ee?yield R.eventBuffer.addEvent(Ee):void 0}catch(ee){const Ee=ee&&ee instanceof oc?"addEventSizeExceeded":"addEvent";os&&nt.vF.error(ee),yield R.stop({reason:Ee});const st=(0,m.KU)();st&&st.recordDroppedEvent("internal_sdk_error","replay")}})).apply(this,arguments)}function be(R,L){if(!R.eventBuffer||R.isPaused()||!R.isEnabled())return!1;const $=ns(L.timestamp);return!($+R.timeouts.sessionIdlePause<Date.now()||$>R.getContext().initialTimestamp+R.getOptions().maxReplayDuration&&(yo(`[Replay] Skipping event with timestamp ${$} because it is after maxReplayDuration`,R.getOptions()._experiments.traceInternals),1))}function _n(R){return!R.type}function Gn(R){return"transaction"===R.type}function Xn(R){return"feedback"===R.type}function Qr(R){const L=function fs(){const R=(0,m.KU)();if(!R)return!1;const L=R.getTransport();return L&&L.send.__sentry__baseTransport__||!1}();return($,ee)=>{if(!R.isEnabled()||!_n($)&&!Gn($))return;const Ee=ee&&ee.statusCode;if(!L||!(!Ee||Ee<200||Ee>=300)){if(Gn($))return void function zs(R,L){const $=R.getContext();L.contexts&&L.contexts.trace&&L.contexts.trace.trace_id&&$.traceIds.size<100&&$.traceIds.add(L.contexts.trace.trace_id)}(R,$);!function Wi(R,L){const $=R.getContext();if(L.event_id&&$.errorIds.size<100&&$.errorIds.add(L.event_id),"buffer"!==R.recordingMode||!L.tags||!L.tags.replayId)return;const{beforeErrorSampling:ee}=R.getOptions();"function"==typeof ee&&!ee(L)||setTimeout(()=>{R.sendBufferedReplayOrFlush()})}(R,$)}}}function Di(R,L){return L.map(({type:$,start:ee,end:Ee,name:st,data:Et})=>{const en=R.throttledAddEvent({type:Fi.Custom,timestamp:ee,data:{tag:"performanceSpan",payload:{op:$,description:st,startTimestamp:ee,endTimestamp:Ee,data:Et}}});return"string"==typeof en?Promise.resolve(null):en})}function rl(R,L){R.isEnabled()&&null!==L&&(function ea(R,L){return(!os||!R.getOptions()._experiments.traceInternals)&&function ae(R,L){const $=L&&function xe(R){return void 0!==R.getClient}(L)?L.getClient():L,ee=$&&$.getDsn(),Ee=$&&$.getOptions().tunnel;return function Be(R,L){return!!L&&R.includes(L.host)}(R,ee)||function De(R,L){return!!L&&Ve(R)===Ve(L)}(R,Ee)}(L,(0,m.KU)())}(R,L.name)||R.addUpdate(()=>(Di(R,[L]),!0)))}function dl(R,L){if(R)try{if("string"==typeof R)return L.encode(R).length;if(R instanceof URLSearchParams)return L.encode(R.toString()).length;if(R instanceof FormData){const $=ju(R);return L.encode($).length}if(R instanceof Blob)return R.size;if(R instanceof ArrayBuffer)return R.byteLength}catch{}}function Kl(R){if(!R)return;const L=parseInt(R,10);return isNaN(L)?void 0:L}function Ol(R){try{if("string"==typeof R)return[R];if(R instanceof URLSearchParams)return[R.toString()];if(R instanceof FormData)return[ju(R)];if(!R)return[void 0]}catch{return os&&nt.vF.warn("[Replay] Failed to serialize body",R),[void 0,"BODY_PARSE_ERROR"]}return os&&nt.vF.info("[Replay] Skipping network body because of body type",R),[void 0,"UNPARSEABLE_BODY_TYPE"]}function Xs(R,L){if(!R)return{headers:{},size:void 0,_meta:{warnings:[L]}};const $={...R._meta};return $.warnings=[...$.warnings||[],L],R._meta=$,R}function Rc(R,L){if(!L)return null;const{startTimestamp:$,endTimestamp:ee,url:Ee,method:st,statusCode:Et,request:en,response:Lt}=L;return{type:R,start:$/1e3,end:ee/1e3,name:Ee,data:(0,et.Ce)({method:st,statusCode:Et,request:en,response:Lt})}}function Zl(R){return{headers:{},size:R,_meta:{warnings:["URL_SKIPPED"]}}}function jo(R,L,$){if(!L&&0===Object.keys(R).length)return;if(!L)return{headers:R};if(!$)return{headers:R,size:L};const ee={headers:R,size:L},{body:Ee,warnings:st}=function fa(R){if(!R||"string"!=typeof R)return{body:R};const L=R.length>Ot,$=function hl(R){const L=R[0],$=R[R.length-1];return"["===L&&"]"===$||"{"===L&&"}"===$}(R);if(L){const ee=R.slice(0,Ot);return $?{body:ee,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${ee}\u2026`,warnings:["TEXT_TRUNCATED"]}}if($)try{return{body:JSON.parse(R)}}catch{}return{body:R}}($);return ee.body=Ee,st&&st.length>0&&(ee._meta={warnings:st}),ee}function Ga(R,L){return Object.keys(R).reduce(($,ee)=>{const Ee=ee.toLowerCase();return L.includes(Ee)&&R[ee]&&($[Ee]=R[ee]),$},{})}function ju(R){return new URLSearchParams(R).toString()}function Ss(R,L){const $=function Oi(R,L=lt.document.baseURI){if(R.startsWith("http://")||R.startsWith("https://")||R.startsWith(lt.location.origin))return R;const $=new URL(R,L);if($.origin!==new URL(L).origin)return R;const ee=$.href;return!R.endsWith("/")&&ee.endsWith("/")?ee.slice(0,-1):ee}(R);return(0,Te.Xr)($,L)}function ta(){return ta=(0,O.A)(function*(R,L,$){try{const ee=yield function zn(R,L,$){return Gs.apply(this,arguments)}(R,L,$),Ee=Rc("resource.fetch",ee);rl($.replay,Ee)}catch(ee){os&&nt.vF.error("[Replay] Failed to capture fetch breadcrumb",ee)}}),ta.apply(this,arguments)}function Gs(){return Gs=(0,O.A)(function*(R,L,$){const ee=Date.now(),{startTimestamp:Ee=ee,endTimestamp:st=ee}=L,{url:Et,method:en,status_code:Lt=0,request_body_size:gn,response_body_size:Rn}=R.data,kn=Ss(Et,$.networkDetailAllowUrls)&&!Ss(Et,$.networkDetailDenyUrls),Bn=kn?function As({networkCaptureBodies:R,networkRequestHeaders:L},$,ee){const Ee=$?function Ao(R,L){return 1===R.length&&"string"!=typeof R[0]?Cr(R[0],L):2===R.length?Cr(R[1],L):{}}($,L):{};if(!R)return jo(Ee,ee,void 0);const st=xn($),[Et,en]=Ol(st),Lt=jo(Ee,ee,Et);return en?Xs(Lt,en):Lt}($,L.input,gn):Zl(gn),Jn=yield function fu(R,L,$,ee){return pr.apply(this,arguments)}(kn,$,L.response,Rn);return{startTimestamp:Ee,endTimestamp:st,url:Et,method:en,statusCode:Lt,request:Bn,response:Jn}}),Gs.apply(this,arguments)}function pr(){return pr=(0,O.A)(function*(R,{networkCaptureBodies:L,textEncoder:$,networkResponseHeaders:ee},Ee,st){if(!R&&void 0!==st)return Zl(st);const Et=Ee?Un(Ee.headers,ee):{};if(!Ee||!L&&void 0!==st)return jo(Et,st,void 0);const[en,Lt]=yield function $u(R){return dr.apply(this,arguments)}(Ee),gn=function zr(R,{networkCaptureBodies:L,textEncoder:$,responseBodySize:ee,captureDetails:Ee,headers:st}){try{const Et=R&&R.length&&void 0===ee?dl(R,$):ee;return Ee?jo(st,Et,L?R:void 0):Zl(Et)}catch(Et){return os&&nt.vF.warn("[Replay] Failed to serialize response body",Et),jo(st,ee,void 0)}}(en,{networkCaptureBodies:L,textEncoder:$,responseBodySize:st,captureDetails:R,headers:Et});return Lt?Xs(gn,Lt):gn}),pr.apply(this,arguments)}function dr(){return(dr=(0,O.A)(function*(R){const L=function pu(R){try{return R.clone()}catch(L){os&&nt.vF.warn("[Replay] Failed to clone response body",L)}}(R);if(!L)return[void 0,"BODY_PARSE_ERROR"];try{return[yield $c(L)]}catch($){return os&&nt.vF.warn("[Replay] Failed to get text body from response",$),[void 0,"BODY_PARSE_ERROR"]}})).apply(this,arguments)}function xn(R=[]){if(2===R.length&&"object"==typeof R[1])return R[1].body}function Un(R,L){const $={};return L.forEach(ee=>{R.get(ee)&&($[ee]=R.get(ee))}),$}function Cr(R,L){if(!R)return{};const $=R.headers;return $?$ instanceof Headers?Un($,L):Array.isArray($)?{}:Ga($,L):{}}function $c(R){return new Promise((L,$)=>{const ee=setTimeout(()=>$(new Error("Timeout while trying to read response body")),500);(function bc(R){return uc.apply(this,arguments)})(R).then(Ee=>L(Ee),Ee=>$(Ee)).finally(()=>clearTimeout(ee))})}function uc(){return(uc=(0,O.A)(function*(R){return yield R.text()})).apply(this,arguments)}function Su(){return(Su=(0,O.A)(function*(R,L,$){try{const ee=function yd(R,L,$){const ee=Date.now(),{startTimestamp:Ee=ee,endTimestamp:st=ee,input:Et,xhr:en}=L,{url:Lt,method:gn,status_code:Rn=0,request_body_size:kn,response_body_size:Bn}=R.data;if(!Lt)return null;if(!en||!Ss(Lt,$.networkDetailAllowUrls)||Ss(Lt,$.networkDetailDenyUrls))return{startTimestamp:Ee,endTimestamp:st,url:Lt,method:gn,statusCode:Rn,request:Zl(kn),response:Zl(Bn)};const Jn=en[Le.Er],er=Jn?Ga(Jn.request_headers,$.networkRequestHeaders):{},Vr=Ga(function Gu(R){const L=R.getAllResponseHeaders();return L?L.split("\r\n").reduce(($,ee)=>{const[Ee,st]=ee.split(": ");return $[Ee.toLowerCase()]=st,$},{}):{}}(en),$.networkResponseHeaders),[ui,Yt]=$.networkCaptureBodies?Ol(Et):[void 0],[Tr,Hs]=$.networkCaptureBodies?function td(R){const L=[];try{return[R.responseText]}catch($){L.push($)}try{return function Qi(R,L){try{if("string"==typeof R)return[R];if(R instanceof Document)return[R.body.outerHTML];if("json"===L&&R&&"object"==typeof R)return[JSON.stringify(R)];if(!R)return[void 0]}catch{return os&&nt.vF.warn("[Replay] Failed to serialize body",R),[void 0,"BODY_PARSE_ERROR"]}return os&&nt.vF.info("[Replay] Skipping network body because of body type",R),[void 0,"UNPARSEABLE_BODY_TYPE"]}(R.response,R.responseType)}catch($){L.push($)}return os&&nt.vF.warn("[Replay] Failed to get xhr response body",...L),[void 0]}(en):[void 0],Ms=jo(er,kn,ui),mi=jo(Vr,Bn,Tr);return{startTimestamp:Ee,endTimestamp:st,url:Lt,method:gn,statusCode:Rn,request:Yt?Xs(Ms,Yt):Ms,response:Hs?Xs(mi,Hs):mi}}(R,L,$),Ee=Rc("resource.xhr",ee);rl($.replay,Ee)}catch(ee){os&&nt.vF.error("[Replay] Failed to capture xhr breadcrumb",ee)}})).apply(this,arguments)}function nh(R){const L=(0,m.KU)();try{const $=new TextEncoder,{networkDetailAllowUrls:ee,networkDetailDenyUrls:Ee,networkCaptureBodies:st,networkRequestHeaders:Et,networkResponseHeaders:en}=R.getOptions(),Lt={replay:R,textEncoder:$,networkDetailAllowUrls:ee,networkDetailDenyUrls:Ee,networkCaptureBodies:st,networkRequestHeaders:Et,networkResponseHeaders:en};L&&L.on?L.on("beforeAddBreadcrumb",(gn,Rn)=>function Oo(R,L,$){if(L.data)try{(function pi(R){return"xhr"===R.category})(L)&&function Z(R){return R&&R.xhr}($)&&(function _d(R,L,$){const{xhr:ee,input:Ee}=L;if(!ee)return;const st=dl(Ee,$.textEncoder),Et=ee.getResponseHeader("content-length")?Kl(ee.getResponseHeader("content-length")):function Pc(R,L,$){try{return dl("json"===L&&R&&"object"==typeof R?JSON.stringify(R):R,$)}catch{return}}(ee.response,ee.responseType,$.textEncoder);void 0!==st&&(R.data.request_body_size=st),void 0!==Et&&(R.data.response_body_size=Et)}(L,$,R),function vr(R,L,$){Su.apply(this,arguments)}(L,$,R)),function Au(R){return"fetch"===R.category}(L)&&function c(R){return R&&R.response}($)&&(function vo(R,L,$){const{input:ee,response:Ee}=L,Et=dl(ee?xn(ee):void 0,$.textEncoder),en=Ee?Kl(Ee.headers.get("content-length")):void 0;void 0!==Et&&(R.data.request_body_size=Et),void 0!==en&&(R.data.response_body_size=en)}(L,$,R),function cc(R,L,$){ta.apply(this,arguments)}(L,$,R))}catch{os&&nt.vF.warn("Error when enriching network breadcrumb")}}(Lt,gn,Rn)):((0,at.u)(function ca(R){return L=>{if(!R.isEnabled())return;const $=function qi(R){const{startTimestamp:L,endTimestamp:$,fetchData:ee,response:Ee}=R;if(!$)return null;const{method:st,url:Et}=ee;return{type:"resource.fetch",start:L/1e3,end:$/1e3,name:Et,data:{method:st,statusCode:Ee?Ee.status:void 0}}}(L);rl(R,$)}}(R)),(0,Le.Mn)(function Si(R){return L=>{if(!R.isEnabled())return;const $=function fo(R){const{startTimestamp:L,endTimestamp:$,xhr:ee}=R,Ee=ee[Le.Er];if(!L||!$||!Ee)return null;const{method:st,url:Et,status_code:en}=Ee;return void 0===Et?null:{type:"resource.xhr",name:Et,start:L/1e3,end:$/1e3,data:{method:st,statusCode:en}}}(L);rl(R,$)}}(R)))}catch{}}let n=null;function P(R){return!(!R||!R.on)}function K(){return(K=(0,O.A)(function*(R){try{return Promise.all(Di(R,[Y(lt.performance.memory)]))}catch{return[]}})).apply(this,arguments)}function Y(R){const{jsHeapSizeLimit:L,totalJSHeapSize:$,usedJSHeapSize:ee}=R,Ee=Date.now()/1e3;return{type:"memory",name:"memory",start:Ee,end:Ee,data:{memory:{jsHeapSizeLimit:L,totalJSHeapSize:$,usedJSHeapSize:ee}}}}function Pe(R){let L=!1;return($,ee)=>{if(!R.checkAndHandleExpiredSession())return void(os&&nt.vF.warn("[Replay] Received replay event after session expired."));const Ee=ee||!L;L=!0,R.clickDetector&&function Uc(R,L){try{if(!function Cl(R){return R.type===Uo}(L))return;const{source:$}=L.data;if($===Nr.Mutation&&R.registerMutation(L.timestamp),$===Nr.Scroll&&R.registerScroll(L.timestamp),function $l(R){return R.data.source===Nr.MouseInteraction}(L)){const{type:ee,id:Ee}=L.data,st=_a.mirror.getNode(Ee);st instanceof HTMLElement&&ee===eo.Click&&R.registerClick(st)}}catch{}}(R.clickDetector,$),R.addUpdate(()=>{if("buffer"===R.recordingMode&&Ee&&R.setInitialState(),!jc(R,$,Ee))return!0;if(!Ee)return!1;if(function Ye(R,L){!L||!R.session||0!==R.session.segmentId||jc(R,function Ke(R){const L=R.getOptions();return{type:Fi.Custom,timestamp:Date.now(),data:{tag:"options",payload:{shouldRecordCanvas:R.isRecordingCanvas(),sessionSampleRate:L.sessionSampleRate,errorSampleRate:L.errorSampleRate,useCompressionOption:L.useCompression,blockAllMedia:L.blockAllMedia,maskAllText:L.maskAllText,maskAllInputs:L.maskAllInputs,useCompression:!!R.eventBuffer&&"worker"===R.eventBuffer.type,networkDetailHasUrls:L.networkDetailAllowUrls.length>0,networkCaptureBodies:L.networkCaptureBodies,networkRequestHasHeaders:L.networkRequestHeaders.length>0,networkResponseHasHeaders:L.networkResponseHeaders.length>0}}}}(R),!1)}(R,Ee),R.session&&R.session.previousSessionId)return!0;if("buffer"===R.recordingMode&&R.session&&R.eventBuffer){const st=R.eventBuffer.getEarliestTimestamp();st&&(yo(`[Replay] Updating session start time to earliest event in buffer to ${new Date(st)}`,R.getOptions()._experiments.traceInternals),R.session.started=st,R.getOptions().stickySession&&io(R.session))}return"session"===R.recordingMode&&R.flush(),!0})}}function he(){return(he=(0,O.A)(function*({client:R,scope:L,replayId:$,event:ee}){const st={event_id:$,integrations:"object"!=typeof R._integrations||null===R._integrations||Array.isArray(R._integrations)?void 0:Object.keys(R._integrations)};R.emit&&R.emit("preprocessEvent",ee,st);const Et=yield(0,me.mG)(R.getOptions(),ee,st,L,R,(0,He.rm)());if(!Et)return null;Et.platform=Et.platform||"javascript";const en=R.getSdkMetadata&&R.getSdkMetadata(),{name:Lt,version:gn}=en&&en.sdk||{};return Et.sdk={...Et.sdk,name:Lt||"sentry.javascript.unknown",version:gn||"0.0.0"},Et})).apply(this,arguments)}function mt(){return mt=(0,O.A)(function*({recordingData:R,replayId:L,segmentId:$,eventContext:ee,timestamp:Ee,session:st}){const Et=function ot({recordingData:R,headers:L}){let $;const ee=`${JSON.stringify(L)}\n`;if("string"==typeof R)$=`${ee}${R}`;else{const st=(new TextEncoder).encode(ee);$=new Uint8Array(st.length+R.length),$.set(st),$.set(R,st.length)}return $}({recordingData:R,headers:{segment_id:$}}),{urls:en,errorIds:Lt,traceIds:gn,initialTimestamp:Rn}=ee,kn=(0,m.KU)(),Bn=(0,m.o5)(),Jn=kn&&kn.getTransport(),er=kn&&kn.getDsn();if(!(kn&&Jn&&er&&st.sampled))return;const Vr={type:Pt,replay_start_timestamp:Rn/1e3,timestamp:Ee/1e3,error_ids:Lt,trace_ids:gn,urls:en,replay_id:L,segment_id:$,replay_type:st.sampled},ui=yield function pe(R){return he.apply(this,arguments)}({scope:Bn,client:kn,replayId:L,event:Vr});if(!ui)return kn.recordDroppedEvent("event_processor","replay",Vr),void yo("An event processor returned `null`, will not send event.");delete ui.sdkProcessingMetadata;const Yt=function rt(R,L,$,ee){return(0,Ge.h4)((0,Ge.n2)(R,(0,Ge.Cj)(R),ee,$),[[{type:"replay_event"},R],[{type:"replay_recording",length:"string"==typeof L?(new TextEncoder).encode(L).length:L.length},L]])}(ui,Et,er,kn.getOptions().tunnel);let Tr;try{Tr=yield Jn.send(Yt)}catch(Ms){const mi=new Error(Qe);try{mi.cause=Ms}catch{}throw mi}if(!Tr)return Tr;if("number"==typeof Tr.statusCode&&(Tr.statusCode<200||Tr.statusCode>=300))throw new Ut(Tr.statusCode);const Hs=(0,nn.wq)({},Tr);if((0,nn.Jz)(Hs,"replay"))throw new jt(Hs);return Tr}),mt.apply(this,arguments)}class Ut extends Error{constructor(L){super(`Transport returned status code ${L}`)}}class jt extends Error{constructor(L){super("Rate limit hit"),this.rateLimits=L}}function It(R){return tn.apply(this,arguments)}function tn(){return tn=(0,O.A)(function*(R,L={count:0,interval:Vn}){const{recordingData:$,options:ee}=R;if($.length)try{return yield function gt(R){return mt.apply(this,arguments)}(R),!0}catch(Ee){if(Ee instanceof Ut||Ee instanceof jt)throw Ee;if((0,m.o)("Replays",{_retryCount:L.count}),os&&ee._experiments&&ee._experiments.captureExceptions&&(0,m.Cp)(Ee),L.count>=Fr){const st=new Error(`${Qe} - max retries exceeded`);try{st.cause=Ee}catch{}throw st}return L.interval*=++L.count,new Promise((st,Et)=>{setTimeout((0,O.A)(function*(){try{yield It(R,L),st(!0)}catch(en){Et(en)}}),L.interval)})}}),tn.apply(this,arguments)}const Kt="__THROTTLED";class cn{constructor({options:L,recordingOptions:$}){cn.prototype.__init.call(this),cn.prototype.__init2.call(this),cn.prototype.__init3.call(this),cn.prototype.__init4.call(this),cn.prototype.__init5.call(this),cn.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:3e5,sessionIdleExpire:9e5},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=$,this._options=L,this._debouncedFlush=function ce(R,L,$){let ee,Ee,st;const Et=$&&$.maxWait?Math.max($.maxWait,L):0;function en(){return Lt(),ee=R(),ee}function Lt(){void 0!==Ee&&clearTimeout(Ee),void 0!==st&&clearTimeout(st),Ee=st=void 0}function Rn(){return Ee&&clearTimeout(Ee),Ee=setTimeout(en,L),Et&&void 0===st&&(st=setTimeout(en,Et)),ee}return Rn.cancel=Lt,Rn.flush=function gn(){return void 0!==Ee||void 0!==st?en():ee},Rn}(()=>this._flush(),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=function rr(R,L,$){const ee=new Map;let Et=!1;return(...en)=>{const Lt=Math.floor(Date.now()/1e3);if((en=>{const Lt=en-$;ee.forEach((gn,Rn)=>{Rn<Lt&&ee.delete(Rn)})})(Lt),[...ee.values()].reduce((en,Lt)=>en+Lt,0)>=L){const Rn=Et;return Et=!0,Rn?"__SKIPPED":Kt}Et=!1;const gn=ee.get(Lt)||0;return ee.set(Lt,gn+1),R(...en)}}((Et,en)=>function W(R,L,$){return be(R,L)?ke(R,L,$):Promise.resolve(null)}(this,Et,en),300,5);const{slowClickTimeout:ee,slowClickIgnoreSelectors:Ee}=this.getOptions(),st=ee?{threshold:Math.min(3e3,ee),timeout:ee,scrollTimeout:300,ignoreSelector:Ee?Ee.join(","):""}:void 0;st&&(this.clickDetector=new Mc(this,st))}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}isRecordingCanvas(){return!!this._canvas}getOptions(){return this._options}initializeSampling(L){const{errorSampleRate:$,sessionSampleRate:ee}=this._options;if(!($<=0&&ee<=0)){if(this._initializeSessionForSampling(L),!this.session)return void this._handleException(new Error("Unable to initialize and create session"));!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",Hl(`[Replay] Starting replay in ${this.recordingMode} mode`,this._options._experiments.traceInternals),this._initializeRecording())}}start(){if(this._isEnabled&&"session"===this.recordingMode)throw new Error("Replay recording is already in progress");if(this._isEnabled&&"buffer"===this.recordingMode)throw new Error("Replay buffering is in progress, call `flush()` to save the replay");Hl("[Replay] Starting replay in session mode",this._options._experiments.traceInternals);const L=va({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=L,this._initializeRecording()}startBuffering(){if(this._isEnabled)throw new Error("Replay recording is already in progress");Hl("[Replay] Starting replay in buffer mode",this._options._experiments.traceInternals);const L=va({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=L,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{const L=this._canvas;this._stopRecording=_a({...this._recordingOptions,..."buffer"===this.recordingMode&&{checkoutEveryNms:6e4},emit:Pe(this),onMutation:this._onMutationHandler,...L?{recordCanvas:L.recordCanvas,getCanvasManager:L.getCanvasManager,sampling:L.sampling,dataURLOptions:L.dataURLOptions}:{}})}catch(L){this._handleException(L)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(L){return this._handleException(L),!1}}stop({forceFlush:L=!1,reason:$}={}){var ee=this;return(0,O.A)(function*(){if(ee._isEnabled){ee._isEnabled=!1;try{yo("[Replay] Stopping Replay"+($?` triggered by ${$}`:""),ee._options._experiments.traceInternals),ee._removeListeners(),ee.stopRecording(),ee._debouncedFlush.cancel(),L&&(yield ee._flush({force:!0})),ee.eventBuffer&&ee.eventBuffer.destroy(),ee.eventBuffer=null,function Rl(R){(function ho(){if(ql())try{lt.sessionStorage.removeItem(Ct)}catch{}})(),R.session=void 0}(ee)}catch(Ee){ee._handleException(Ee)}}})()}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),yo("[Replay] Pausing replay",this._options._experiments.traceInternals))}resume(){!this._isPaused||!this._checkSession()||(this._isPaused=!1,this.startRecording(),yo("[Replay] Resuming replay",this._options._experiments.traceInternals))}sendBufferedReplayOrFlush({continueRecording:L=!0}={}){var $=this;return(0,O.A)(function*(){if("session"===$.recordingMode)return $.flushImmediate();const ee=Date.now();yo("[Replay] Converting buffer to session",$._options._experiments.traceInternals),yield $.flushImmediate();const Ee=$.stopRecording();!L||!Ee||"session"!==$.recordingMode&&($.recordingMode="session",$.session&&($._updateUserActivity(ee),$._updateSessionActivity(ee),$._maybeSaveSession()),$.startRecording())})()}addUpdate(L){const $=L();"buffer"!==this.recordingMode&&!0!==$&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),this._stopRecording)this.checkAndHandleExpiredSession(),this._updateSessionActivity();else{if(!this._checkSession())return;this.resume()}}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){if(!(this._lastActivity&&la(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled))return!!this._checkSession();this.pause()}setInitialState(){const $=`${lt.location.origin}${lt.location.pathname}${lt.location.hash}${lt.location.search}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=$,this._context.initialTimestamp=Date.now(),this._context.urls.push($)}throttledAddEvent(L,$){const ee=this._throttledAddEvent(L,$);if(ee===Kt){const Ee=zo({category:"replay.throttled"});this.addUpdate(()=>!jc(this,{type:5,timestamp:Ee.timestamp||0,data:{tag:"breadcrumb",payload:Ee,metric:!0}}))}return ee}getCurrentRoute(){const L=this.lastTransaction||(0,m.o5)().getTransaction(),ee=(L&&(0,qe.et)(L).data||{})[Oe.i_];if(L&&ee&&["route","custom"].includes(ee))return(0,qe.et)(L).description}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=function ya({useCompression:R,workerUrl:L}){if(R&&window.Worker){const $=function ac(R){try{const L=R||function ha(){return typeof __SENTRY_EXCLUDE_REPLAY_WORKER__>"u"||!__SENTRY_EXCLUDE_REPLAY_WORKER__?function zc(){const R=new Blob(['var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),a=0;a<31;++a)i[a]=e+=1<<t[a-1];var s=new r(i[30]);for(a=1;a<30;++a)for(var o=i[a];o<i[a+1];++o)s[o]=o-i[a]<<5|a;return{b:i,r:s}},o=s(e,2),f=o.b,h=o.r;f[28]=258,h[258]=28;for(var l=s(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,a=0,s=new n(r);a<i;++a)t[a]&&++s[t[a]-1];var o,f=new n(r);for(a=1;a<r;++a)f[a]=f[a-1]+s[a-1]<<1;if(e){o=new n(1<<r);var h=15-r;for(a=0;a<i;++a)if(t[a])for(var l=a<<4|t[a],c=r-t[a],v=f[t[a]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>h]=l}else for(o=new n(i),a=0;a<i;++a)t[a]&&(o[a]=u[f[t[a]-1]++]>>15-t[a]);return o},g=new t(288);for(c=0;c<144;++c)g[c]=8;for(c=144;c<256;++c)g[c]=9;for(c=256;c<280;++c)g[c]=7;for(c=280;c<288;++c)g[c]=8;var w=new t(32);for(c=0;c<32;++c)w[c]=5;var p=d(g,9,0),y=d(w,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==r||r<0)&&(r=0),(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},A=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},_=function(r,e){for(var i=[],a=0;a<r.length;++a)r[a]&&i.push({s:a,f:r[a]});var s=i.length,o=i.slice();if(!s)return{t:F,l:0};if(1==s){var f=new t(i[0].s+1);return f[i[0].s]=1,{t:f,l:1}}i.sort((function(t,n){return t.f-n.f})),i.push({s:-1,f:25001});var h=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:h.f+l.f,l:h,r:l};c!=s-1;)h=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:h.f+l.f,l:h,r:l};var d=o[0].s;for(a=1;a<s;++a)o[a].s>d&&(d=o[a].s);var g=new n(d+1),w=x(i[c-1],g,0);if(w>e){a=0;var p=0,y=w-e,m=1<<y;for(o.sort((function(t,n){return g[n.s]-g[t.s]||t.f-n.f}));a<s;++a){var b=o[a].s;if(!(g[b]>e))break;p+=m-(1<<w-g[b]),g[b]=e}for(p>>=y;p>0;){var M=o[a].s;g[M]<e?p-=1<<e-g[M]++-1:++a}for(;a>=0&&p;--a){var E=o[a].s;g[E]==e&&(--g[E],++p)}w=e}return{t:new t(g),l:w}},x=function(t,n,r){return-1==t.s?Math.max(x(t.l,n,r+1),x(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,a=t[0],s=1,o=function(t){e[i++]=t},f=1;f<=r;++f)if(t[f]==a&&f!=r)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=t[f]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<e;++a)t[i+a+4]=r[a];return 8*(i+4+e)},C=function(t,r,s,o,f,h,l,u,c,v,m){z(r,m++,s),++f[256];for(var b=_(f,15),M=b.t,E=b.l,x=_(h,15),C=x.t,U=x.l,F=D(M),I=F.c,S=F.n,L=D(C),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=_(q,7),H=G.t,J=G.l,K=19;K>4&&!H[a[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(f,g)+T(h,w)+l,X=T(f,M)+T(h,C)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(C,U,0),R=C;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[a[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=p,P=g,Q=y,R=w;for(B=0;B<u;++B){var rt=o[B];if(rt>255){A(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;A(r,m,Q[et]),m+=R[et],et>3&&(A(r,m,rt>>5&8191),m+=i[et])}else A(r,m,N[rt]),m+=P[rt]}return A(r,m,N[256]),m+P[256]},U=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,a=0|r.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=e+=r[s];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},L=function(a,s,o,f,u){if(!u&&(u={l:1},s.dictionary)){var c=s.dictionary.subarray(-32768),v=new t(c.length+a.length);v.set(c),v.set(a,c.length),a=v,u.w=c.length}return function(a,s,o,f,u,c){var v=c.z||a.length,d=new t(f+v+5*(1+Math.ceil(v/7e3))+u),g=d.subarray(f,d.length-u),w=c.l,p=7&(c.r||0);if(s){p&&(g[0]=c.r>>3);for(var y=U[s-1],M=y>>13,E=8191&y,z=(1<<o)-1,A=c.p||new n(32768),_=c.h||new n(z+1),x=Math.ceil(o/3),D=2*x,T=function(t){return(a[t]^a[t+1]<<x^a[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=_[H];if(A[J]=K,_[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!w)){p=C(a,g,0,F,I,S,O,q,G,j-G,p),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(a[j+Q]==a[j+Q-W]){for(var $=0;$<Z&&a[j+$]==a[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-A[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=A[J])&32767}if(R){F[q++]=268435456|h[Q]<<18|l[R];var it=31&h[Q],at=31&l[R];O+=e[it]+i[at],++I[257+it],++S[at],B=j+Q,++L}else F[q++]=a[j],++I[a[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=a[j],++I[a[j]];p=C(a,g,w,F,I,S,O,q,G,j-G,p),w||(c.r=7&p|g[p/8|0]<<3,p-=7,c.h=_,c.p=A,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+w;j+=65535){var st=j+65535;st>=v&&(g[p/8|0]=w,st=v),p=k(g,p+1,a.subarray(j,st))}c.i=v}return b(d,0,f+m(p)+u)}(a,null==s.level?6:s.level,null==s.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+s.mem,o,f,u)},O=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},j=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(L(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var a=this.b.length-this.s.z;a&&(this.b.set(n.subarray(0,a),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(a),32768),this.s.z=n.length-a+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n}();function q(t,n){n||(n={});var r=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}}(),e=t.length;r.p(t);var i,a=L(t,n,10+((i=n).filename?i.filename.length+1:0),8),s=a.length;return function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&O(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}}(a,n),O(a,s-8,r.d()),O(a,s-4,e),a}var B=function(){function t(t,n){this.c=S(),this.v=1,j.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),j.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=L(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=S();i.p(n.dictionary),O(t,2,i.d())}}(r,this.o),this.v=0),n&&O(r,r.length-4,this.c.d()),this.ondata(r,n)},t}(),G="undefined"!=typeof TextEncoder&&new TextEncoder,H="undefined"!=typeof TextDecoder&&new TextDecoder;try{H.decode(F,{stream:!0})}catch(t){}var J=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(K(t),this.d=n||!1)},t}();function K(n,r){if(r){for(var e=new t(n.length),i=0;i<n.length;++i)e[i]=n.charCodeAt(i);return e}if(G)return G.encode(n);var a=n.length,s=new t(n.length+(n.length>>1)),o=0,f=function(t){s[o++]=t};for(i=0;i<a;++i){if(o+5>s.length){var h=new t(o+8+(a-i<<1));h.set(s),s=h}var l=n.charCodeAt(i);l<128||r?f(l):l<2048?(f(192|l>>6),f(128|63&l)):l>55295&&l<57344?(f(240|(l=65536+(1047552&l)|1023&n.charCodeAt(++i))>>18),f(128|l>>12&63),f(128|l>>6&63),f(128|63&l)):(f(224|l>>12),f(128|l>>6&63),f(128|63&l))}return b(s,0,o)}const N=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(let r=0,e=t.length;r<e;r++)n+=t[r].length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new B,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new J(((t,n)=>{this.deflate.push(t,n)})),this.stream.push("[")}},P={clear:()=>{N.clear()},addEvent:t=>N.addEvent(t),finish:()=>N.finish(),compress:t=>function(t){return q(K(t))}(t)};addEventListener("message",(function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in P&&"function"==typeof P[n])try{const t=P[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});']);return URL.createObjectURL(R)}():""}();if(!L)return;yo("[Replay] Using compression worker"+(R?` from ${R}`:""));const $=new Worker(L);return new ja($)}catch{yo("[Replay] Failed to create compression worker")}}(L);if($)return $}return yo("[Replay] Using simple buffer"),new Ps}({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_handleException(L){os&&nt.vF.error("[Replay]",L),os&&this._options._experiments&&this._options._experiments.captureExceptions&&(0,m.Cp)(L)}_initializeSessionForSampling(L){const ee=va({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,traceInternals:this._options._experiments.traceInternals,previousSessionId:L},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:this._options.errorSampleRate>0});this.session=ee}_checkSession(){if(!this.session)return!1;const L=this.session;return!lc(L,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})||(this._refreshSession(L),!1)}_refreshSession(L){var $=this;return(0,O.A)(function*(){$._isEnabled&&(yield $.stop({reason:"refresh session"}),$.initializeSampling(L.id))})()}_addListeners(){try{lt.document.addEventListener("visibilitychange",this._handleVisibilityChange),lt.addEventListener("blur",this._handleWindowBlur),lt.addEventListener("focus",this._handleWindowFocus),lt.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(function C(R){const L=(0,m.o5)(),$=(0,m.KU)();L.addScopeListener((R=>L=>{if(!R.isEnabled())return;const $=function y(R){const L=R.getLastBreadcrumb&&R.getLastBreadcrumb();return n===L||!L||(n=L,!function a(R){return!!R.category}(L)||["fetch","xhr","sentry.event","sentry.transaction"].includes(L.category)||L.category.startsWith("ui."))?null:"console"===L.category?function w(R){const L=R.data&&R.data.arguments;if(!Array.isArray(L)||0===L.length)return zo(R);let $=!1;const ee=L.map(Ee=>{if(!Ee)return Ee;if("string"==typeof Ee)return Ee.length>5e3?($=!0,`${Ee.slice(0,5e3)}\u2026`):Ee;if("object"==typeof Ee)try{const st=(0,ht.S8)(Ee,7);return JSON.stringify(st).length>5e3?($=!0,`${JSON.stringify(st,null,2).slice(0,5e3)}\u2026`):st}catch{}return Ee});return zo({...R,data:{...R.data,arguments:ee,...$?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}(L):zo(L)}(L);$&&Hi(R,$)})(R)),(0,Ze.i)((R=>L=>{if(!R.isEnabled())return;const $=function ic(R){const{target:L,message:$}=function Dl(R){const L="click"===R.name;let $,ee=null;try{ee=L?Ja(R.event):da(R.event),$=(0,ct.Hd)(ee,{maxStringLength:200})||"<unknown>"}catch{$="<unknown>"}return{target:ee,message:$}}(R);return zo({category:`ui.${R.name}`,...Gl(L,$)})}(L);if(!$)return;const ee="click"===L.name,Ee=ee?L.event:void 0;ee&&R.clickDetector&&Ee&&Ee.target&&!Ee.altKey&&!Ee.metaKey&&!Ee.ctrlKey&&!Ee.shiftKey&&function wo(R,L,$){R.handleClick(L,$)}(R.clickDetector,$,Ja(L.event)),Hi(R,$)})(R)),(0,it._)(function js(R){return L=>{if(!R.isEnabled())return;const $=function Ni(R){const{from:L,to:$}=R,ee=Date.now()/1e3;return{type:"navigation.push",start:ee,end:ee,name:$,data:{previous:L}}}(L);null!==$&&(R.getContext().urls.push($.name),R.triggerUserActivity(),R.addUpdate(()=>(Di(R,[$]),!1)))}}(R)),nh(R);const ee=function Kr(R,L=!1){const $=L?Qr(R):void 0;return Object.assign((ee,Ee)=>R.isEnabled()?function Ar(R){return"replay_event"===R.type}(ee)?(delete ee.breadcrumbs,ee):(_n(ee)||Gn(ee)||Xn(ee))&&R.checkAndHandleExpiredSession()?Xn(ee)?(R.flush(),ee.contexts.feedback.replay_id=R.getSessionId(),function xs(R,L){R.triggerUserActivity(),R.addUpdate(()=>!L.timestamp||(R.throttledAddEvent({type:Fi.Custom,timestamp:1e3*L.timestamp,data:{tag:"breadcrumb",payload:{timestamp:L.timestamp,type:"default",category:"sentry.feedback",data:{feedbackId:L.event_id}}}}),!1))}(R,ee),ee):function Jo(R,L){return!(R.type||!R.exception||!R.exception.values||!R.exception.values.length||!L.originalException||!L.originalException.__rrweb__)}(ee,Ee)&&!R.getOptions()._experiments.captureExceptions?(os&&nt.vF.log("[Replay] Ignoring error from rrweb internals",ee),null):((function lr(R,L){return!("buffer"!==R.recordingMode||L.message===Qe||!L.exception||L.type)&&$a(R.getOptions().errorSampleRate)}(R,ee)||"session"===R.recordingMode)&&(ee.tags={...ee.tags,replayId:R.getSessionId()}),$&&$(ee,{statusCode:200}),ee):ee:ee,{id:"Replay"})}(R,!P($));$&&$.addEventProcessor?$.addEventProcessor(ee):(0,se.S)(ee),P($)&&($.on("beforeSendEvent",function ji(R){return L=>{!R.isEnabled()||!_n(L)||function so(R,L){const $=L.exception&&L.exception.values&&L.exception.values[0].value;"string"==typeof $&&($.match(/reactjs\.org\/docs\/error-decoder\.html\?invariant=(418|419|422|423|425)/)||$.match(/(does not match server-rendered HTML|Hydration failed because)/i))&&Hi(R,zo({category:"replay.hydrate-error"}))}(R,L)}}(R)),$.on("afterSendEvent",Qr(R)),$.on("createDsc",Ee=>{const st=R.getSessionId();st&&R.isEnabled()&&"session"===R.recordingMode&&R.checkAndHandleExpiredSession()&&(Ee.replay_id=st)}),$.on("startTransaction",Ee=>{R.lastTransaction=Ee}),$.on("finishTransaction",Ee=>{R.lastTransaction=Ee}),$.on("beforeSendFeedback",(Ee,st)=>{const Et=R.getSessionId();st&&st.includeReplay&&R.isEnabled()&&Et&&Ee.contexts&&Ee.contexts.feedback&&(Ee.contexts.feedback.replay_id=Et)}))}(this),this._hasInitializedCoreListeners=!0)}catch(L){this._handleException(L)}this._performanceCleanupCallback=function sc(R){function L(Ee){R.performanceEntries.includes(Ee)||R.performanceEntries.push(Ee)}function $({entries:Ee}){Ee.forEach(L)}const ee=[];return["navigation","paint","resource"].forEach(Ee=>{ee.push((0,Ht.wv)(Ee,$))}),ee.push((0,Ht.Pt)(({metric:Ee})=>{R.replayPerformanceEntries.push(function nl(R){const L=R.entries,$=L[L.length-1],ee=$?$.element:void 0,Ee=R.value,st=Ml(Ee);return{type:"largest-contentful-paint",name:"largest-contentful-paint",start:st,end:st,data:{value:Ee,size:Ee,nodeId:ee?_a.mirror.getId(ee):void 0}}}(Ee))})),()=>{ee.forEach(Ee=>Ee())}}(this)}_removeListeners(){try{lt.document.removeEventListener("visibilitychange",this._handleVisibilityChange),lt.removeEventListener("blur",this._handleWindowBlur),lt.removeEventListener("focus",this._handleWindowFocus),lt.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(L){this._handleException(L)}}__init(){this._handleVisibilityChange=()=>{"visible"===lt.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{const L=zo({category:"ui.blur"});this._doChangeToBackgroundTasks(L)}}__init3(){this._handleWindowFocus=()=>{const L=zo({category:"ui.focus"});this._doChangeToForegroundTasks(L)}}__init4(){this._handleKeyboardEvent=L=>{!function Bi(R,L){if(!R.isEnabled())return;R.updateUserActivity();const $=function $s(R){const{metaKey:L,shiftKey:$,ctrlKey:ee,altKey:Ee,key:st,target:Et}=R;if(!Et||function Is(R){return"INPUT"===R.tagName||"TEXTAREA"===R.tagName||R.isContentEditable}(Et)||!st)return null;if(!(L||ee||Ee)&&1===st.length)return null;const gn=(0,ct.Hd)(Et,{maxStringLength:200})||"<unknown>";return zo({category:"ui.keyDown",message:gn,data:{...Gl(Et,gn).data,metaKey:L,shiftKey:$,ctrlKey:ee,altKey:Ee,key:st}})}(L);$&&Hi(R,$)}(this,L)}}_doChangeToBackgroundTasks(L){!this.session||ul(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire})||(L&&this._createCustomBreadcrumb(L),this.conditionalFlush())}_doChangeToForegroundTasks(L){this.session&&(this.checkAndHandleExpiredSession()?L&&this._createCustomBreadcrumb(L):yo("[Replay] Document has become active, but session has expired"))}_updateUserActivity(L=Date.now()){this._lastActivity=L}_updateSessionActivity(L=Date.now()){this.session&&(this.session.lastActivity=L,this._maybeSaveSession())}_createCustomBreadcrumb(L){this.addUpdate(()=>{this.throttledAddEvent({type:Fi.Custom,timestamp:L.timestamp||0,data:{tag:"breadcrumb",payload:L}})})}_addPerformanceEntries(){const L=function uo(R){return R.map(Ns).filter(Boolean)}(this.performanceEntries).concat(this.replayPerformanceEntries);return this.performanceEntries=[],this.replayPerformanceEntries=[],Promise.all(Di(this,L))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:L,eventBuffer:$}=this;if(!L||!$||L.segmentId)return;const ee=$.getEarliestTimestamp();ee&&ee<this._context.initialTimestamp&&(this._context.initialTimestamp=ee)}_popEventContext(){const L={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),L}_runFlush(){var L=this;return(0,O.A)(function*(){const $=L.getSessionId();if(L.session&&L.eventBuffer&&$){if(yield L._addPerformanceEntries(),L.eventBuffer&&L.eventBuffer.hasEvents&&(yield function V(R){return K.apply(this,arguments)}(L),L.eventBuffer&&$===L.getSessionId()))try{L._updateInitialTimestampFromEventBuffer();const ee=Date.now();if(ee-L._context.initialTimestamp>L._options.maxReplayDuration+3e4)throw new Error("Session is too long, not sending replay");const Ee=L._popEventContext(),st=L.session.segmentId++;L._maybeSaveSession();const Et=yield L.eventBuffer.finish();yield It({replayId:$,recordingData:Et,segmentId:st,eventContext:Ee,session:L.session,options:L.getOptions(),timestamp:ee})}catch(ee){L._handleException(ee),L.stop({reason:"sendReplay"});const Ee=(0,m.KU)();Ee&&Ee.recordDroppedEvent("send_error","replay")}}else os&&nt.vF.error("[Replay] No session or eventBuffer found to flush.")})()}__init5(){var L=this;this._flush=(0,O.A)(function*({force:$=!1}={}){if(!L._isEnabled&&!$)return;if(!L.checkAndHandleExpiredSession())return void(os&&nt.vF.error("[Replay] Attempting to finish replay event after session expired."));if(!L.session)return;const ee=L.session.started,st=Date.now()-ee;L._debouncedFlush.cancel();const Et=st<L._options.minReplayDuration;if(Et||st>L._options.maxReplayDuration+5e3)return yo(`[Replay] Session duration (${Math.floor(st/1e3)}s) is too ${Et?"short":"long"}, not sending replay.`,L._options._experiments.traceInternals),void(Et&&L._debouncedFlush());const Lt=L.eventBuffer;if(Lt&&0===L.session.segmentId&&!Lt.hasCheckout&&yo("[Replay] Flushing initial segment without checkout.",L._options._experiments.traceInternals),!L._flushLock)return L._flushLock=L._runFlush(),yield L._flushLock,void(L._flushLock=void 0);try{yield L._flushLock}catch(gn){os&&nt.vF.error(gn)}finally{L._debouncedFlush()}})}_maybeSaveSession(){this.session&&this._options.stickySession&&io(this.session)}__init6(){this._onMutationHandler=L=>{const $=L.length,ee=this._options.mutationLimit,st=ee&&$>ee;if($>this._options.mutationBreadcrumbLimit||st){const Et=zo({category:"replay.mutations",data:{count:$,limit:st}});this._createCustomBreadcrumb(Et)}return!st||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}}function Dn(R,L,$,ee){const st=[...R,..."string"==typeof ee?ee.split(","):[],...L];return typeof $<"u"&&("string"==typeof $&&st.push(`.${$}`),(0,nt.pq)(()=>{console.warn("[Replay] You are using a deprecated configuration item for privacy. Read the documentation on how to use the new privacy configuration.")})),st.join(",")}const dn='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',Ln=["content-length","content-type","accept"];let Nn=!1;const Wn=R=>new Yn(R);class Yn{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:L=5e3,flushMaxDelay:$=5500,minReplayDuration:ee=4999,maxReplayDuration:Ee=36e5,stickySession:st=!0,useCompression:Et=!0,workerUrl:en,_experiments:Lt={},sessionSampleRate:gn,errorSampleRate:Rn,maskAllText:kn=!0,maskAllInputs:Bn=!0,blockAllMedia:Jn=!0,mutationBreadcrumbLimit:er=750,mutationLimit:Vr=1e4,slowClickTimeout:ui=7e3,slowClickIgnoreSelectors:Yt=[],networkDetailAllowUrls:Tr=[],networkDetailDenyUrls:Hs=[],networkCaptureBodies:Ms=!0,networkRequestHeaders:mi=[],networkResponseHeaders:Yr=[],mask:ri=[],maskAttributes:Mi=["title","placeholder"],unmask:po=[],block:Rr=[],unblock:ls=[],ignore:Rs=[],maskFn:Yi,beforeAddRecordingEvent:Qs,beforeErrorSampling:ko,blockClass:ps,blockSelector:Ma,maskInputOptions:xo,maskTextClass:oo,maskTextSelector:Ha,ignoreClass:Tc}={}){this.name=Yn.id;const No=function an({mask:R,unmask:L,block:$,unblock:ee,ignore:Ee,blockClass:st,blockSelector:Et,maskTextClass:en,maskTextSelector:Lt,ignoreClass:gn}){const Jn={maskTextSelector:Dn(R,[".sentry-mask","[data-sentry-mask]"],en,Lt),unmaskTextSelector:Dn(L,[".sentry-unmask","[data-sentry-unmask]"]),blockSelector:Dn($,[".sentry-block","[data-sentry-block]",'base[href="/"]'],st,Et),unblockSelector:Dn(ee,[".sentry-unblock","[data-sentry-unblock]"]),ignoreSelector:Dn(Ee,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'],gn)};return st instanceof RegExp&&(Jn.blockClass=st),en instanceof RegExp&&(Jn.maskTextClass=en),Jn}({mask:ri,unmask:po,block:Rr,unblock:ls,ignore:Rs,blockClass:ps,blockSelector:Ma,maskTextClass:oo,maskTextSelector:Ha,ignoreClass:Tc});if(this._recordingOptions={maskAllInputs:Bn,maskAllText:kn,maskInputOptions:{...xo||{},password:!0},maskTextFn:Yi,maskInputFn:Yi,maskAttributeFn:(fl,mu,tu)=>function Kn({el:R,key:L,maskAttributes:$,maskAllText:ee,privacyOptions:Ee,value:st}){return!ee||Ee.unmaskTextSelector&&R.matches(Ee.unmaskTextSelector)?st:$.includes(L)||"value"===L&&"INPUT"===R.tagName&&["submit","button"].includes(R.getAttribute("type")||"")?st.replace(/[\S]/g,"*"):st}({maskAttributes:Mi,maskAllText:kn,privacyOptions:No,key:fl,value:mu,el:tu}),...No,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:fl=>{try{fl.__rrweb__=!0}catch{}}},this._initialOptions={flushMinDelay:L,flushMaxDelay:$,minReplayDuration:Math.min(ee,15e3),maxReplayDuration:Math.min(Ee,36e5),stickySession:st,sessionSampleRate:gn,errorSampleRate:Rn,useCompression:Et,workerUrl:en,blockAllMedia:Jn,maskAllInputs:Bn,maskAllText:kn,mutationBreadcrumbLimit:er,mutationLimit:Vr,slowClickTimeout:ui,slowClickIgnoreSelectors:Yt,networkDetailAllowUrls:Tr,networkDetailDenyUrls:Hs,networkCaptureBodies:Ms,networkRequestHeaders:bi(mi),networkResponseHeaders:bi(Yr),beforeAddRecordingEvent:Qs,beforeErrorSampling:ko,_experiments:Lt},"number"==typeof gn&&(console.warn(`[Replay] You are passing \`sessionSampleRate\` to the Replay integration.\nThis option is deprecated and will be removed soon.\nInstead, configure \`replaysSessionSampleRate\` directly in the SDK init options, e.g.:\nSentry.init({ replaysSessionSampleRate: ${gn} })`),this._initialOptions.sessionSampleRate=gn),"number"==typeof Rn&&(console.warn(`[Replay] You are passing \`errorSampleRate\` to the Replay integration.\nThis option is deprecated and will be removed soon.\nInstead, configure \`replaysOnErrorSampleRate\` directly in the SDK init options, e.g.:\nSentry.init({ replaysOnErrorSampleRate: ${Rn} })`),this._initialOptions.errorSampleRate=Rn),this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${dn}`:dn),this._isInitialized&&Cn())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return Nn}set _isInitialized(L){Nn=L}setupOnce(){Cn()&&(this._setup(),setTimeout(()=>this._initialize()))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(L){return this._replay&&this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(L):Promise.resolve()}getReplayId(){if(this._replay&&this._replay.isEnabled())return this._replay.getSessionId()}_initialize(){this._replay&&(this._maybeLoadFromReplayCanvasIntegration(),this._replay.initializeSampling())}_setup(){const L=function Xr(R){const L=(0,m.KU)(),$=L&&L.getOptions(),ee={sessionSampleRate:0,errorSampleRate:0,...(0,et.Ce)(R)};return $?(null==R.sessionSampleRate&&null==R.errorSampleRate&&null==$.replaysSessionSampleRate&&null==$.replaysOnErrorSampleRate&&(0,nt.pq)(()=>{console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set.")}),"number"==typeof $.replaysSessionSampleRate&&(ee.sessionSampleRate=$.replaysSessionSampleRate),"number"==typeof $.replaysOnErrorSampleRate&&(ee.errorSampleRate=$.replaysOnErrorSampleRate),ee):((0,nt.pq)(()=>{console.warn("SDK client is not available.")}),ee)}(this._initialOptions);this._replay=new cn({options:L,recordingOptions:this._recordingOptions})}_maybeLoadFromReplayCanvasIntegration(){try{const $=(0,m.KU)().getIntegrationByName("ReplayCanvas");if(!$)return;this._replay._canvas=$.getOptions()}catch{}}}function bi(R){return[...Ln,...R.map(L=>L.toLowerCase())]}Yn.__initStatic()},8095:(An,xt,H)=>{"use strict";H.d(xt,{De:()=>xe,hF:()=>m,yD:()=>Ve});var O=H(3447),z=H(5801),ye=H(1769);const m="baggage",ae="sentry-",De=/^sentry-/,Be=8192;function Ve(He){if(!(0,z.Kg)(He)&&!Array.isArray(He))return;let qe={};if(Array.isArray(He))qe=He.reduce((je,ht)=>{const et=se(ht);for(const ct of Object.keys(et))je[ct]=et[ct];return je},{});else{if(!He)return;qe=se(He)}const Oe=Object.entries(qe).reduce((je,[ht,et])=>(ht.match(De)&&(je[ht.slice(ae.length)]=et),je),{});return Object.keys(Oe).length>0?Oe:void 0}function xe(He){if(He)return function me(He){if(0!==Object.keys(He).length)return Object.entries(He).reduce((qe,[Oe,je],ht)=>{const et=`${encodeURIComponent(Oe)}=${encodeURIComponent(je)}`,ct=0===ht?et:`${qe},${et}`;return ct.length>Be?(O.T&&ye.vF.warn(`Not adding key: ${Oe} with val: ${je} to baggage header due to exceeding baggage size limits.`),qe):ct},"")}(Object.entries(He).reduce((Oe,[je,ht])=>(ht&&(Oe[`${ae}${je}`]=ht),Oe),{}))}function se(He){return He.split(",").map(qe=>qe.split("=").map(Oe=>decodeURIComponent(Oe.trim()))).reduce((qe,[Oe,je])=>(qe[Oe]=je,qe),{})}},8617:(An,xt,H)=>{"use strict";H.d(xt,{$N:()=>Be,Hd:()=>ae,NX:()=>Ve,xE:()=>xe});var O=H(5801);const ye=(0,H(7018).VZ)(),m=80;function ae(se,me={}){if(!se)return"<unknown>";try{let He=se;const qe=5,Oe=[];let je=0,ht=0;const et=" > ",ct=et.length;let Ue;const nt=Array.isArray(me)?me:me.keyAttrs,Xe=!Array.isArray(me)&&me.maxStringLength||m;for(;He&&je++<qe&&(Ue=De(He,nt),!("html"===Ue||je>1&&ht+Oe.length*ct+Ue.length>=Xe));)Oe.push(Ue),ht+=Ue.length,He=He.parentNode;return Oe.reverse().join(et)}catch{return"<unknown>"}}function De(se,me){const He=se,qe=[];let Oe,je,ht,et,ct;if(!He||!He.tagName)return"";if(ye.HTMLElement&&He instanceof HTMLElement&&He.dataset&&He.dataset.sentryComponent)return He.dataset.sentryComponent;qe.push(He.tagName.toLowerCase());const Ue=me&&me.length?me.filter(Xe=>He.getAttribute(Xe)).map(Xe=>[Xe,He.getAttribute(Xe)]):null;if(Ue&&Ue.length)Ue.forEach(Xe=>{qe.push(`[${Xe[0]}="${Xe[1]}"]`)});else if(He.id&&qe.push(`#${He.id}`),Oe=He.className,Oe&&(0,O.Kg)(Oe))for(je=Oe.split(/\s+/),ct=0;ct<je.length;ct++)qe.push(`.${je[ct]}`);const nt=["aria-label","type","name","title","alt"];for(ct=0;ct<nt.length;ct++)ht=nt[ct],et=He.getAttribute(ht),et&&qe.push(`[${ht}="${et}"]`);return qe.join("")}function Be(){try{return ye.document.location.href}catch{return""}}function Ve(se){return ye.document&&ye.document.querySelector?ye.document.querySelector(se):null}function xe(se){if(!ye.HTMLElement)return null;let me=se;for(let qe=0;qe<5;qe++){if(!me)return null;if(me instanceof HTMLElement&&me.dataset.sentryComponent)return me.dataset.sentryComponent;me=me.parentNode}return null}},3447:(An,xt,H)=>{"use strict";H.d(xt,{T:()=>O});const O=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__},3892:(An,xt,H)=>{"use strict";H.d(xt,{AD:()=>xe,SB:()=>ae});var O=H(3447),z=H(1769);const ye=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function ae(se,me=!1){const{host:He,path:qe,pass:Oe,port:je,projectId:ht,protocol:et,publicKey:ct}=se;return`${et}://${ct}${me&&Oe?`:${Oe}`:""}@${He}${je?`:${je}`:""}/${qe&&`${qe}/`}${ht}`}function Be(se){return{protocol:se.protocol,publicKey:se.publicKey||"",pass:se.pass||"",host:se.host,port:se.port||"",path:se.path||"",projectId:se.projectId}}function xe(se){const me="string"==typeof se?function De(se){const me=ye.exec(se);if(!me)return void(0,z.pq)(()=>{console.error(`Invalid Sentry Dsn: ${se}`)});const[He,qe,Oe="",je,ht="",et]=me.slice(1);let ct="",Ue=et;const nt=Ue.split("/");if(nt.length>1&&(ct=nt.slice(0,-1).join("/"),Ue=nt.pop()),Ue){const Xe=Ue.match(/^\d+/);Xe&&(Ue=Xe[0])}return Be({host:je,pass:Oe,path:ct,projectId:Ue,port:ht,protocol:He,publicKey:qe})}(se):Be(se);if(me&&function Ve(se){if(!O.T)return!0;const{port:me,projectId:He,protocol:qe}=se;return!(["protocol","publicKey","host","projectId"].find(ht=>!se[ht]&&(z.vF.error(`Invalid Sentry Dsn: ${ht} missing`),!0))||(He.match(/^\d+$/)?function m(se){return"http"===se||"https"===se}(qe)?me&&isNaN(parseInt(me,10))&&(z.vF.error(`Invalid Sentry Dsn: Invalid port ${me}`),1):(z.vF.error(`Invalid Sentry Dsn: Invalid protocol ${qe}`),1):(z.vF.error(`Invalid Sentry Dsn: Invalid projectId ${He}`),1)))}(me))return me}},286:(An,xt,H)=>{"use strict";function O(){return typeof __SENTRY_BROWSER_BUNDLE__<"u"&&!!__SENTRY_BROWSER_BUNDLE__}function z(){return"npm"}H.d(xt,{Z:()=>O,e:()=>z})},4965:(An,xt,H)=>{"use strict";H.d(xt,{Cj:()=>je,W3:()=>ae,bN:()=>xe,bm:()=>He,h4:()=>m,n2:()=>ht,yH:()=>De,zk:()=>Oe});var O=H(3892),z=H(5433),ye=H(7474);function m(et,ct=[]){return[et,ct]}function ae(et,ct){const[Ue,nt]=et;return[Ue,[...nt,ct]]}function De(et,ct){const Ue=et[1];for(const nt of Ue)if(ct(nt,nt[0].type))return!0;return!1}function Ve(et,ct){return(ct||new TextEncoder).encode(et)}function xe(et,ct){const[Ue,nt]=et;let Xe=JSON.stringify(Ue);function Le(Te){"string"==typeof Xe?Xe="string"==typeof Te?Xe+Te:[Ve(Xe,ct),Te]:Xe.push("string"==typeof Te?Ve(Te,ct):Te)}for(const Te of nt){const[at,Ze]=Te;if(Le(`\n${JSON.stringify(at)}\n`),"string"==typeof Ze||Ze instanceof Uint8Array)Le(Ze);else{let it;try{it=JSON.stringify(Ze)}catch{it=JSON.stringify((0,z.S8)(Ze))}Le(it)}}return"string"==typeof Xe?Xe:function se(et){const ct=et.reduce((Xe,Le)=>Xe+Le.length,0),Ue=new Uint8Array(ct);let nt=0;for(const Xe of et)Ue.set(Xe,nt),nt+=Xe.length;return Ue}(Xe)}function He(et,ct){const Ue="string"==typeof et.data?Ve(et.data,ct):et.data;return[(0,ye.Ce)({type:"attachment",length:Ue.length,filename:et.filename,content_type:et.contentType,attachment_type:et.attachmentType}),Ue]}const qe={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"statsd"};function Oe(et){return qe[et]}function je(et){if(!et||!et.sdk)return;const{name:ct,version:Ue}=et.sdk;return{name:ct,version:Ue}}function ht(et,ct,Ue,nt){const Xe=et.sdkProcessingMetadata&&et.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:et.event_id,sent_at:(new Date).toISOString(),...ct&&{sdk:ct},...!!Ue&&nt&&{dsn:(0,O.SB)(nt)},...Xe&&{trace:(0,ye.Ce)({...Xe})}}}},6619:(An,xt,H)=>{"use strict";H.d(xt,{U:()=>O});class O extends Error{constructor(ye,m="warn"){super(ye),this.message=ye,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=m}}},9243:(An,xt,H)=>{"use strict";H.d(xt,{AS:()=>Ve,aj:()=>xe,s5:()=>De});var O=H(3447),z=H(1769),ye=H(9868);const m={},ae={};function De(se,me){m[se]=m[se]||[],m[se].push(me)}function Ve(se,me){ae[se]||(me(),ae[se]=!0)}function xe(se,me){const He=se&&m[se];if(He)for(const qe of He)try{qe(me)}catch(Oe){O.T&&z.vF.error(`Error while triggering instrumentation handler.\nType: ${se}\nName: ${(0,ye.qQ)(qe)}\nError:`,Oe)}}},6084:(An,xt,H)=>{"use strict";H.d(xt,{i:()=>se});var O=H(781),z=H(7474),ye=H(7018),m=H(9243);const ae=ye.OW,De=1e3;let Be,Ve,xe;function se(ht){(0,m.s5)("dom",ht),(0,m.AS)("dom",me)}function me(){if(!ae.document)return;const ht=m.aj.bind(null,"dom"),et=Oe(ht,!0);ae.document.addEventListener("click",et,!1),ae.document.addEventListener("keypress",et,!1),["EventTarget","Node"].forEach(ct=>{const Ue=ae[ct]&&ae[ct].prototype;!Ue||!Ue.hasOwnProperty||!Ue.hasOwnProperty("addEventListener")||((0,z.GS)(Ue,"addEventListener",function(nt){return function(Xe,Le,Te){if("click"===Xe||"keypress"==Xe)try{const at=this,Ze=at.__sentry_instrumentation_handlers__=at.__sentry_instrumentation_handlers__||{},it=Ze[Xe]=Ze[Xe]||{refCount:0};if(!it.handler){const Ge=Oe(ht);it.handler=Ge,nt.call(this,Xe,Ge,Te)}it.refCount++}catch{}return nt.call(this,Xe,Le,Te)}}),(0,z.GS)(Ue,"removeEventListener",function(nt){return function(Xe,Le,Te){if("click"===Xe||"keypress"==Xe)try{const at=this,Ze=at.__sentry_instrumentation_handlers__||{},it=Ze[Xe];it&&(it.refCount--,it.refCount<=0&&(nt.call(this,Xe,it.handler,Te),it.handler=void 0,delete Ze[Xe]),0===Object.keys(Ze).length&&delete at.__sentry_instrumentation_handlers__)}catch{}return nt.call(this,Xe,Le,Te)}}))})}function Oe(ht,et=!1){return ct=>{if(!ct||ct._sentryCaptured)return;const Ue=function je(ht){try{return ht.target}catch{return null}}(ct);if(function qe(ht,et){return!("keypress"!==ht||et&&et.tagName&&("INPUT"===et.tagName||"TEXTAREA"===et.tagName||et.isContentEditable))}(ct.type,Ue))return;(0,z.my)(ct,"_sentryCaptured",!0),Ue&&!Ue._sentryId&&(0,z.my)(Ue,"_sentryId",(0,O.eJ)());const nt="keypress"===ct.type?"input":ct.type;(function He(ht){if(ht.type!==Ve)return!1;try{if(!ht.target||ht.target._sentryId!==xe)return!1}catch{}return!0})(ct)||(ht({event:ct,name:nt,global:et}),Ve=ct.type,xe=Ue?Ue._sentryId:void 0),clearTimeout(Be),Be=ae.setTimeout(()=>{xe=void 0,Ve=void 0},De)}}},8603:(An,xt,H)=>{"use strict";H.d(xt,{u:()=>ae});var O=H(7474),z=H(5953),ye=H(7018),m=H(9243);function ae(se){(0,m.s5)("fetch",se),(0,m.AS)("fetch",De)}function De(){(0,z.m7)()&&(0,O.GS)(ye.OW,"fetch",function(se){return function(...me){const{method:He,url:qe}=function xe(se){if(0===se.length)return{method:"GET",url:""};if(2===se.length){const[He,qe]=se;return{url:Ve(He),method:Be(qe,"method")?String(qe.method).toUpperCase():"GET"}}const me=se[0];return{url:Ve(me),method:Be(me,"method")?String(me.method).toUpperCase():"GET"}}(me),Oe={args:me,fetchData:{method:He,url:qe},startTimestamp:Date.now()};return(0,m.aj)("fetch",{...Oe}),se.apply(ye.OW,me).then(je=>{const ht={...Oe,endTimestamp:Date.now(),response:je};return(0,m.aj)("fetch",ht),je},je=>{const ht={...Oe,endTimestamp:Date.now(),error:je};throw(0,m.aj)("fetch",ht),je})}})}function Be(se,me){return!!se&&"object"==typeof se&&!!se[me]}function Ve(se){return"string"==typeof se?se:se?Be(se,"url")?se.url:se.toString?se.toString():"":""}},6597:(An,xt,H)=>{"use strict";H.d(xt,{_:()=>Ve});var O=H(7474),z=H(7018);const ye=(0,z.VZ)();var ae=H(9243);const De=z.OW;let Be;function Ve(se){const me="history";(0,ae.s5)(me,se),(0,ae.AS)(me,xe)}function xe(){if(!function m(){const se=ye.chrome;return!(se&&se.app&&se.app.runtime||!("history"in ye)||!ye.history.pushState||!ye.history.replaceState)}())return;const se=De.onpopstate;function me(He){return function(...qe){const Oe=qe.length>2?qe[2]:void 0;if(Oe){const je=Be,ht=String(Oe);Be=ht,(0,ae.aj)("history",{from:je,to:ht})}return He.apply(this,qe)}}De.onpopstate=function(...He){const qe=De.location.href,Oe=Be;if(Be=qe,(0,ae.aj)("history",{from:Oe,to:qe}),se)try{return se.apply(this,He)}catch{}},(0,O.GS)(De.history,"pushState",me),(0,O.GS)(De.history,"replaceState",me)}},5429:(An,xt,H)=>{"use strict";H.d(xt,{Er:()=>De,Mn:()=>Be});var O=H(5801),z=H(7474),ye=H(7018),m=H(9243);const ae=ye.OW,De="__sentry_xhr_v3__";function Be(se){(0,m.s5)("xhr",se),(0,m.AS)("xhr",Ve)}function Ve(){if(!ae.XMLHttpRequest)return;const se=XMLHttpRequest.prototype;(0,z.GS)(se,"open",function(me){return function(...He){const qe=Date.now(),Oe=(0,O.Kg)(He[0])?He[0].toUpperCase():void 0,je=function xe(se){if((0,O.Kg)(se))return se;try{return se.toString()}catch{}}(He[1]);if(!Oe||!je)return me.apply(this,He);this[De]={method:Oe,url:je,request_headers:{}},"POST"===Oe&&je.match(/sentry_key/)&&(this.__sentry_own_request__=!0);const ht=()=>{const et=this[De];if(et&&4===this.readyState){try{et.status_code=this.status}catch{}const ct={args:[Oe,je],endTimestamp:Date.now(),startTimestamp:qe,xhr:this};(0,m.aj)("xhr",ct)}};return"onreadystatechange"in this&&"function"==typeof this.onreadystatechange?(0,z.GS)(this,"onreadystatechange",function(et){return function(...ct){return ht(),et.apply(this,ct)}}):this.addEventListener("readystatechange",ht),(0,z.GS)(this,"setRequestHeader",function(et){return function(...ct){const[Ue,nt]=ct,Xe=this[De];return Xe&&(0,O.Kg)(Ue)&&(0,O.Kg)(nt)&&(Xe.request_headers[Ue.toLowerCase()]=nt),et.apply(this,ct)}}),me.apply(this,He)}}),(0,z.GS)(se,"send",function(me){return function(...He){const qe=this[De];if(!qe)return me.apply(this,He);void 0!==He[0]&&(qe.body=He[0]);const Oe={args:[qe.method,qe.url],startTimestamp:Date.now(),xhr:this};return(0,m.aj)("xhr",Oe),me.apply(this,He)}})}},5801:(An,xt,H)=>{"use strict";H.d(xt,{BD:()=>ae,Kg:()=>Be,L2:()=>ct,NF:()=>Ve,Qd:()=>se,Qg:()=>Oe,T2:()=>m,W6:()=>De,bJ:()=>z,gd:()=>qe,mE:()=>je,sO:()=>xe,tH:()=>et,vq:()=>He,xH:()=>me,yr:()=>ht});const O=Object.prototype.toString;function z(Ue){switch(O.call(Ue)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return et(Ue,Error)}}function ye(Ue,nt){return O.call(Ue)===`[object ${nt}]`}function m(Ue){return ye(Ue,"ErrorEvent")}function ae(Ue){return ye(Ue,"DOMError")}function De(Ue){return ye(Ue,"DOMException")}function Be(Ue){return ye(Ue,"String")}function Ve(Ue){return"object"==typeof Ue&&null!==Ue&&"__sentry_template_string__"in Ue&&"__sentry_template_values__"in Ue}function xe(Ue){return null===Ue||Ve(Ue)||"object"!=typeof Ue&&"function"!=typeof Ue}function se(Ue){return ye(Ue,"Object")}function me(Ue){return typeof Event<"u"&&et(Ue,Event)}function He(Ue){return typeof Element<"u"&&et(Ue,Element)}function qe(Ue){return ye(Ue,"RegExp")}function Oe(Ue){return!(!Ue||!Ue.then||"function"!=typeof Ue.then)}function je(Ue){return se(Ue)&&"nativeEvent"in Ue&&"preventDefault"in Ue&&"stopPropagation"in Ue}function ht(Ue){return"number"==typeof Ue&&Ue!=Ue}function et(Ue,nt){try{return Ue instanceof nt}catch{return!1}}function ct(Ue){return!("object"!=typeof Ue||null===Ue||!Ue.__isVue&&!Ue._isVue)}},1769:(An,xt,H)=>{"use strict";H.d(xt,{Ow:()=>m,Z9:()=>ae,pq:()=>De,vF:()=>Ve});var O=H(3447),z=H(7018);const m=["debug","info","warn","error","log","assert","trace"],ae={};function De(xe){if(!("console"in z.OW))return xe();const se=z.OW.console,me={},He=Object.keys(ae);He.forEach(qe=>{const Oe=ae[qe];me[qe]=se[qe],se[qe]=Oe});try{return xe()}finally{He.forEach(qe=>{se[qe]=me[qe]})}}const Ve=function Be(){let xe=!1;const se={enable:()=>{xe=!0},disable:()=>{xe=!1},isEnabled:()=>xe};return m.forEach(O.T?me=>{se[me]=(...He)=>{xe&&De(()=>{z.OW.console[me](`Sentry Logger [${me}]:`,...He)})}}:me=>{se[me]=()=>{}}),se}()},781:(An,xt,H)=>{"use strict";H.d(xt,{$X:()=>ae,GR:()=>me,M6:()=>Be,eJ:()=>ye,gO:()=>De,k9:()=>He});var O=H(7474),z=H(7018);function ye(){const qe=z.OW,Oe=qe.crypto||qe.msCrypto;let je=()=>16*Math.random();try{if(Oe&&Oe.randomUUID)return Oe.randomUUID().replace(/-/g,"");Oe&&Oe.getRandomValues&&(je=()=>{const ht=new Uint8Array(1);return Oe.getRandomValues(ht),ht[0]})}catch{}return"10000000100040008000100000000000".replace(/[018]/g,ht=>(ht^(15&je())>>ht/4).toString(16))}function m(qe){return qe.exception&&qe.exception.values?qe.exception.values[0]:void 0}function ae(qe){const{message:Oe,event_id:je}=qe;if(Oe)return Oe;const ht=m(qe);return ht?ht.type&&ht.value?`${ht.type}: ${ht.value}`:ht.type||ht.value||je||"<unknown>":je||"<unknown>"}function De(qe,Oe,je){const ht=qe.exception=qe.exception||{},et=ht.values=ht.values||[],ct=et[0]=et[0]||{};ct.value||(ct.value=Oe||""),ct.type||(ct.type=je||"Error")}function Be(qe,Oe){const je=m(qe);if(!je)return;const et=je.mechanism;if(je.mechanism={type:"generic",handled:!0,...et,...Oe},Oe&&"data"in Oe){const ct={...et&&et.data,...Oe.data};je.mechanism.data=ct}}function me(qe){if(qe&&qe.__sentry_captured__)return!0;try{(0,O.my)(qe,"__sentry_captured__",!0)}catch{}return!1}function He(qe){return Array.isArray(qe)?qe:[qe]}},2657:(An,xt,H)=>{"use strict";H.d(xt,{wD:()=>z});var O=H(286);function z(){return!(0,O.Z)()&&"[object process]"===Object.prototype.toString.call(typeof process<"u"?process:0)}An=H.hmd(An)},5433:(An,xt,H)=>{"use strict";H.d(xt,{S8:()=>ae,cd:()=>De});var O=H(5801),ye=H(7474),m=H(9868);function ae(qe,Oe=100,je=1/0){try{return Be("",qe,Oe,je)}catch(ht){return{ERROR:`**non-serializable** (${ht})`}}}function De(qe,Oe=3,je=102400){const ht=ae(qe,Oe);return function me(qe){return function se(qe){return~-encodeURI(qe).split(/%..|./).length}(JSON.stringify(qe))}(ht)>je?De(qe,Oe-1,je):ht}function Be(qe,Oe,je=1/0,ht=1/0,et=function z(){const qe="function"==typeof WeakSet,Oe=qe?new WeakSet:[];return[function je(et){if(qe)return!!Oe.has(et)||(Oe.add(et),!1);for(let ct=0;ct<Oe.length;ct++)if(Oe[ct]===et)return!0;return Oe.push(et),!1},function ht(et){if(qe)Oe.delete(et);else for(let ct=0;ct<Oe.length;ct++)if(Oe[ct]===et){Oe.splice(ct,1);break}}]}()){const[ct,Ue]=et;if(null==Oe||["number","boolean","string"].includes(typeof Oe)&&!(0,O.yr)(Oe))return Oe;const nt=function Ve(qe,Oe){try{if("domain"===qe&&Oe&&"object"==typeof Oe&&Oe._events)return"[Domain]";if("domainEmitter"===qe)return"[DomainEmitter]";if(typeof global<"u"&&Oe===global)return"[Global]";if(typeof window<"u"&&Oe===window)return"[Window]";if(typeof document<"u"&&Oe===document)return"[Document]";if((0,O.L2)(Oe))return"[VueViewModel]";if((0,O.mE)(Oe))return"[SyntheticEvent]";if("number"==typeof Oe&&Oe!=Oe)return"[NaN]";if("function"==typeof Oe)return`[Function: ${(0,m.qQ)(Oe)}]`;if("symbol"==typeof Oe)return`[${String(Oe)}]`;if("bigint"==typeof Oe)return`[BigInt: ${String(Oe)}]`;const je=function xe(qe){const Oe=Object.getPrototypeOf(qe);return Oe?Oe.constructor.name:"null prototype"}(Oe);return/^HTML(\w*)Element$/.test(je)?`[HTMLElement: ${je}]`:`[object ${je}]`}catch(je){return`**non-serializable** (${je})`}}(qe,Oe);if(!nt.startsWith("[object "))return nt;if(Oe.__sentry_skip_normalization__)return Oe;const Xe="number"==typeof Oe.__sentry_override_normalization_depth__?Oe.__sentry_override_normalization_depth__:je;if(0===Xe)return nt.replace("object ","");if(ct(Oe))return"[Circular ~]";const Le=Oe;if(Le&&"function"==typeof Le.toJSON)try{return Be("",Le.toJSON(),Xe-1,ht,et)}catch{}const Te=Array.isArray(Oe)?[]:{};let at=0;const Ze=(0,ye.W4)(Oe);for(const it in Ze)if(Object.prototype.hasOwnProperty.call(Ze,it)){if(at>=ht){Te[it]="[MaxProperties ~]";break}Te[it]=Be(it,Ze[it],Xe-1,ht,et),at++}return Ue(Oe),Te}},7474:(An,xt,H)=>{"use strict";H.d(xt,{Ce:()=>je,GS:()=>De,HF:()=>Oe,W4:()=>me,my:()=>Be,pO:()=>Ve,sp:()=>xe,u4:()=>se});var O=H(8617),z=H(3447),ye=H(5801),m=H(1769),ae=H(2064);function De(Ue,nt,Xe){if(!(nt in Ue))return;const Le=Ue[nt],Te=Xe(Le);"function"==typeof Te&&Ve(Te,Le),Ue[nt]=Te}function Be(Ue,nt,Xe){try{Object.defineProperty(Ue,nt,{value:Xe,writable:!0,configurable:!0})}catch{z.T&&m.vF.log(`Failed to add non-enumerable property "${nt}" to object`,Ue)}}function Ve(Ue,nt){try{Ue.prototype=nt.prototype=nt.prototype||{},Be(Ue,"__sentry_original__",nt)}catch{}}function xe(Ue){return Ue.__sentry_original__}function se(Ue){return Object.keys(Ue).map(nt=>`${encodeURIComponent(nt)}=${encodeURIComponent(Ue[nt])}`).join("&")}function me(Ue){if((0,ye.bJ)(Ue))return{message:Ue.message,name:Ue.name,stack:Ue.stack,...qe(Ue)};if((0,ye.xH)(Ue)){const nt={type:Ue.type,target:He(Ue.target),currentTarget:He(Ue.currentTarget),...qe(Ue)};return typeof CustomEvent<"u"&&(0,ye.tH)(Ue,CustomEvent)&&(nt.detail=Ue.detail),nt}return Ue}function He(Ue){try{return(0,ye.vq)(Ue)?(0,O.Hd)(Ue):Object.prototype.toString.call(Ue)}catch{return"<unknown>"}}function qe(Ue){if("object"==typeof Ue&&null!==Ue){const nt={};for(const Xe in Ue)Object.prototype.hasOwnProperty.call(Ue,Xe)&&(nt[Xe]=Ue[Xe]);return nt}return{}}function Oe(Ue,nt=40){const Xe=Object.keys(me(Ue));if(Xe.sort(),!Xe.length)return"[object has no keys]";if(Xe[0].length>=nt)return(0,ae.xv)(Xe[0],nt);for(let Le=Xe.length;Le>0;Le--){const Te=Xe.slice(0,Le).join(", ");if(!(Te.length>nt))return Le===Xe.length?Te:(0,ae.xv)(Te,nt)}return""}function je(Ue){return ht(Ue,new Map)}function ht(Ue,nt){if(function et(Ue){if(!(0,ye.Qd)(Ue))return!1;try{const nt=Object.getPrototypeOf(Ue).constructor.name;return!nt||"Object"===nt}catch{return!0}}(Ue)){const Xe=nt.get(Ue);if(void 0!==Xe)return Xe;const Le={};nt.set(Ue,Le);for(const Te of Object.keys(Ue))typeof Ue[Te]<"u"&&(Le[Te]=ht(Ue[Te],nt));return Le}if(Array.isArray(Ue)){const Xe=nt.get(Ue);if(void 0!==Xe)return Xe;const Le=[];return nt.set(Ue,Le),Ue.forEach(Te=>{Le.push(ht(Te,nt))}),Le}return Ue}},3200:(An,xt,H)=>{"use strict";H.d(xt,{Jz:()=>m,wq:()=>ae});const O=6e4;function m(De,Be,Ve=Date.now()){return function ye(De,Be){return De[Be]||De.all||0}(De,Be)>Ve}function ae(De,{statusCode:Be,headers:Ve},xe=Date.now()){const se={...De},me=Ve&&Ve["x-sentry-rate-limits"],He=Ve&&Ve["retry-after"];if(me)for(const qe of me.trim().split(",")){const[Oe,je]=qe.split(":",2),ht=parseInt(Oe,10),et=1e3*(isNaN(ht)?60:ht);if(je)for(const ct of je.split(";"))se[ct]=xe+et;else se.all=xe+et}else He?se.all=xe+function z(De,Be=Date.now()){const Ve=parseInt(`${De}`,10);if(!isNaN(Ve))return 1e3*Ve;const xe=Date.parse(`${De}`);return isNaN(xe)?O:xe-Be}(He,xe):429===Be&&(se.all=xe+6e4);return se}},9868:(An,xt,H)=>{"use strict";H.d(xt,{gd:()=>m,qQ:()=>Ve,vk:()=>ae});const O=50,z=/\(error: (.*)\)/,ye=/captureMessage|captureException/;function m(...se){const me=se.sort((He,qe)=>He[0]-qe[0]).map(He=>He[1]);return(He,qe=0)=>{const Oe=[],je=He.split("\n");for(let ht=qe;ht<je.length;ht++){const et=je[ht];if(et.length>1024)continue;const ct=z.test(et)?et.replace(z,"$1"):et;if(!ct.match(/\S*Error: /)){for(const Ue of me){const nt=Ue(ct);if(nt){Oe.push(nt);break}}if(Oe.length>=O)break}}return function De(se){if(!se.length)return[];const me=Array.from(se);return/sentryWrapped/.test(me[me.length-1].function||"")&&me.pop(),me.reverse(),ye.test(me[me.length-1].function||"")&&(me.pop(),ye.test(me[me.length-1].function||"")&&me.pop()),me.slice(0,O).map(He=>({...He,filename:He.filename||me[me.length-1].filename,function:He.function||"?"}))}(Oe)}}function ae(se){return Array.isArray(se)?m(...se):se}const Be="<anonymous>";function Ve(se){try{return se&&"function"==typeof se&&se.name||Be}catch{return Be}}},2064:(An,xt,H)=>{"use strict";H.d(xt,{Xr:()=>De,gt:()=>m,xv:()=>z});var O=H(5801);function z(Be,Ve=0){return"string"!=typeof Be||0===Ve||Be.length<=Ve?Be:`${Be.slice(0,Ve)}...`}function m(Be,Ve){if(!Array.isArray(Be))return"";const xe=[];for(let se=0;se<Be.length;se++){const me=Be[se];try{(0,O.L2)(me)?xe.push("[VueViewModel]"):xe.push(String(me))}catch{xe.push("[value cannot be serialized]")}}return xe.join(Ve)}function De(Be,Ve=[],xe=!1){return Ve.some(se=>function ae(Be,Ve,xe=!1){return!!(0,O.Kg)(Be)&&((0,O.gd)(Ve)?Ve.test(Be):!!(0,O.Kg)(Ve)&&(xe?Be===Ve:Be.includes(Ve)))}(Be,se,xe))}},5953:(An,xt,H)=>{"use strict";H.d(xt,{ap:()=>xe,m7:()=>se,vm:()=>Ve});var O=H(3447),z=H(1769);const m=(0,H(7018).VZ)();function Ve(){if(!("fetch"in m))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function xe(qe){return qe&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(qe.toString())}function se(){if("string"==typeof EdgeRuntime)return!0;if(!Ve())return!1;if(xe(m.fetch))return!0;let qe=!1;const Oe=m.document;if(Oe&&"function"==typeof Oe.createElement)try{const je=Oe.createElement("iframe");je.hidden=!0,Oe.head.appendChild(je),je.contentWindow&&je.contentWindow.fetch&&(qe=xe(je.contentWindow.fetch)),Oe.head.removeChild(je)}catch(je){O.T&&z.vF.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",je)}return qe}},7473:(An,xt,H)=>{"use strict";H.d(xt,{T2:()=>ae,XW:()=>ye,xg:()=>m});var z,De,O=H(5801);function ye(De){return new ae(Be=>{Be(De)})}function m(De){return new ae((Be,Ve)=>{Ve(De)})}(De=z||(z={}))[De.PENDING=0]="PENDING",De[De.RESOLVED=1]="RESOLVED",De[De.REJECTED=2]="REJECTED";class ae{constructor(Be){ae.prototype.__init.call(this),ae.prototype.__init2.call(this),ae.prototype.__init3.call(this),ae.prototype.__init4.call(this),this._state=z.PENDING,this._handlers=[];try{Be(this._resolve,this._reject)}catch(Ve){this._reject(Ve)}}then(Be,Ve){return new ae((xe,se)=>{this._handlers.push([!1,me=>{if(Be)try{xe(Be(me))}catch(He){se(He)}else xe(me)},me=>{if(Ve)try{xe(Ve(me))}catch(He){se(He)}else se(me)}]),this._executeHandlers()})}catch(Be){return this.then(Ve=>Ve,Be)}finally(Be){return new ae((Ve,xe)=>{let se,me;return this.then(He=>{me=!1,se=He,Be&&Be()},He=>{me=!0,se=He,Be&&Be()}).then(()=>{me?xe(se):Ve(se)})})}__init(){this._resolve=Be=>{this._setResult(z.RESOLVED,Be)}}__init2(){this._reject=Be=>{this._setResult(z.REJECTED,Be)}}__init3(){this._setResult=(Be,Ve)=>{if(this._state===z.PENDING){if((0,O.Qg)(Ve))return void Ve.then(this._resolve,this._reject);this._state=Be,this._value=Ve,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===z.PENDING)return;const Be=this._handlers.slice();this._handlers=[],Be.forEach(Ve=>{Ve[0]||(this._state===z.RESOLVED&&Ve[1](this._value),this._state===z.REJECTED&&Ve[2](this._value),Ve[0]=!0)})}}}},5800:(An,xt,H)=>{"use strict";H.d(xt,{k3:()=>Ve,lu:()=>ye,zf:()=>ae});var O=H(7018);const z=1e3;function ye(){return Date.now()/z}const ae=function m(){const{performance:xe}=O.OW;if(!xe||!xe.now)return ye;const se=Date.now()-xe.now(),me=null==xe.timeOrigin?se:xe.timeOrigin;return()=>(me+xe.now())/z}();let Be;const Ve=(()=>{const{performance:xe}=O.OW;if(!xe||!xe.now)return void(Be="none");const se=36e5,me=xe.now(),He=Date.now(),qe=xe.timeOrigin?Math.abs(xe.timeOrigin+me-He):se,Oe=qe<se,je=xe.timing&&xe.timing.navigationStart,et="number"==typeof je?Math.abs(je+me-He):se;return Oe||et<se?qe<=et?(Be="timeOrigin",xe.timeOrigin):(Be="navigationStart",je):(Be="dateNow",He)})()},8399:(An,xt,H)=>{"use strict";H.d(xt,{TC:()=>Be,kM:()=>De});var O=H(8095),z=H(781);const ye=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function De(Ve,xe){const se=function m(Ve){if(!Ve)return;const xe=Ve.match(ye);if(!xe)return;let se;return"1"===xe[3]?se=!0:"0"===xe[3]&&(se=!1),{traceId:xe[1],parentSampled:se,parentSpanId:xe[2]}}(Ve),me=(0,O.yD)(xe),{traceId:He,parentSpanId:qe,parentSampled:Oe}=se||{};return se?{traceId:He||(0,z.eJ)(),parentSpanId:qe||(0,z.eJ)().substring(16),spanId:(0,z.eJ)().substring(16),sampled:Oe,dsc:me||{}}:{traceId:He||(0,z.eJ)(),spanId:(0,z.eJ)().substring(16)}}function Be(Ve=(0,z.eJ)(),xe=(0,z.eJ)().substring(16),se){let me="";return void 0!==se&&(me=se?"-1":"-0"),`${Ve}-${xe}${me}`}},7018:(An,xt,H)=>{"use strict";function O(ae){return ae&&ae.Math==Math?ae:void 0}H.d(xt,{BY:()=>m,OW:()=>z,VZ:()=>ye});const z="object"==typeof globalThis&&O(globalThis)||"object"==typeof window&&O(window)||"object"==typeof self&&O(self)||"object"==typeof global&&O(global)||function(){return this}()||{};function ye(){return z}function m(ae,De,Be){const Ve=Be||z,xe=Ve.__SENTRY__=Ve.__SENTRY__||{};return xe[ae]||(xe[ae]=De())}},1247:function(An){An.exports=function(){"use strict";var xt,H,O;function z(m,ae){if(xt)if(H){var De="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+xt+")(sharedChunk); ("+H+")(sharedChunk); self.onerror = null;",Be={};xt(Be),O=ae(Be),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(O.workerUrl=window.URL.createObjectURL(new Blob([De],{type:"text/javascript"})))}else H=ae;else xt=ae}return z(0,function(m){var ae=typeof self<"u"?self:{},De="2.15.0";let Be;const Ve={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Be){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Be=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{Be=o}}return Be},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ve.API_URL)return null;try{const o=new URL(Ve.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xe={supported:!1,testSupport:function(o){!He&&me&&(qe?Oe(o):se=o)}};let se,me,He=!1,qe=!1;function Oe(o){const t=o.createTexture();o.bindTexture(o.TEXTURE_2D,t);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,me),o.isContextLost())return;xe.supported=!0}catch{}o.deleteTexture(t),He=!0}ae.document&&(me=ae.document.createElement("img"),me.onload=function(){se&&Oe(se),se=null,qe=!0},me.onerror=function(){He=!0,se=null},me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const je="01";function ht(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var et=ct;function ct(o,t,l,f){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=t,this.p2x=l,this.p2y=f}ct.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,t){if(void 0===t&&(t=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,f=0;f<8;f++){var _=this.sampleCurveX(l)-o;if(Math.abs(_)<t)return l;var E=this.sampleCurveDerivativeX(l);if(Math.abs(E)<1e-6)break;l-=_/E}var b=0,A=1;for(l=o,f=0;f<20&&(_=this.sampleCurveX(l),!(Math.abs(_-o)<t));f++)o>_?b=l:A=l,l=.5*(A-b)+b;return l},solve:function(o,t){return this.sampleCurveY(this.solveCurveX(o,t))}};var Ue=ht(et),nt=Xe;function Xe(o,t){this.x=o,this.y=t}Xe.prototype={clone:function(){return new Xe(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,t){return this.clone()._rotateAround(o,t)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var t=o.x-this.x,l=o.y-this.y;return t*t+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,t){return Math.atan2(this.x*t-this.y*o,this.x*o+this.y*t)},_matMult:function(o){var t=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=t,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var t=Math.cos(o),l=Math.sin(o),f=l*this.x+t*this.y;return this.x=t*this.x-l*this.y,this.y=f,this},_rotateAround:function(o,t){var l=Math.cos(o),f=Math.sin(o),_=t.y+f*(this.x-t.x)+l*(this.y-t.y);return this.x=t.x+l*(this.x-t.x)-f*(this.y-t.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Xe.convert=function(o){return o instanceof Xe?o:Array.isArray(o)?new Xe(o[0],o[1]):o};var Le=ht(nt);const Te=Math.PI/180,at=180/Math.PI;function Ze(o){return o*Te}function it(o){return o*at}const Ge=[[0,0],[1,0],[1,1],[0,1]];function nn(o){if(o<=0)return 0;if(o>=1)return 1;const t=o*o,l=t*o;return 4*(o<.5?l:3*(o-t)+l-.75)}function bn(o,t,l,f){const _=new Ue(o,t,l,f);return function(E){return _.solve(E)}}const Cn=bn(.25,.1,.25,1);function qt(o,t,l){return Math.min(l,Math.max(t,o))}function Ht(o,t,l){return(l=qt((l-o)/(t-o),0,1))*l*(3-2*l)}function lt(o,t,l){const f=l-t,_=((o-t)%f+f)%f+t;return _===t?l:_}function Ct(o,t,l){if(!o.length)return l(null,[]);let f=o.length;const _=new Array(o.length);let E=null;o.forEach((b,A)=>{t(b,(k,F)=>{k&&(E=k),_[A]=F,0==--f&&l(E,_)})})}function Pt(o){const t=[];for(const l in o)t.push(o[l]);return t}function Qe(o,...t){for(const l of t)for(const f in l)o[f]=l[f];return o}let Tt=1;function $t(){return Tt++}function Qt(){return function o(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function sn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function mn(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Vn(o,t){o.forEach(l=>{t[l]&&(t[l]=t[l].bind(t))})}function Fr(o,t){return-1!==o.indexOf(t,o.length-t.length)}function Ot(o,t,l){const f={};for(const _ in o)f[_]=t.call(l||this,o[_],_,o);return f}function on(o,t,l){const f={};for(const _ in o)t.call(l||this,o[_],_,o)&&(f[_]=o[_]);return f}function Or(o){return Array.isArray(o)?o.map(Or):"object"==typeof o&&o?Ot(o,Or):o}const jr={};function ur(o){jr[o]||(typeof console<"u"&&console.warn(o),jr[o]=!0)}function Ai(o,t,l){return(l.y-o.y)*(t.x-o.x)>(t.y-o.y)*(l.x-o.x)}function Ri(o){let t=0;for(let l,f,_=0,E=o.length,b=E-1;_<E;b=_++)l=o[_],f=o[b],t+=(f.x-l.x)*(l.y+f.y);return t}function nr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function mr(o){const t={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,_,E)=>{const b=_||E;return t[f]=!b||b.toLowerCase(),""}),t["max-age"]){const l=parseInt(t["max-age"],10);isNaN(l)?delete t["max-age"]:t["max-age"]=l}return t}let Er=null;function Zn(o){if(null==Er){const t=o.navigator?o.navigator.userAgent:null;Er=!!o.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Er}function us(o){try{const t=ae[o];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Hn(o,t){return[o[4*t],o[4*t+1],o[4*t+2],o[4*t+3]]}const Sr="mapbox-tiles";let Bt,Ce,kr=500,Gt=50;function pt(){try{return ae.caches}catch{}}function Mt(){pt()&&!Bt&&(Bt=ae.caches.open(Sr))}function hn(o){const t=o.indexOf("?");if(t<0)return o;const f=function(_){const E=_.indexOf("?");return E>0?_.slice(E+1).split("&"):[]}(o).filter(_=>{const E=_.split("=");return"language"===E[0]||"worldview"===E[0]});return f.length?`${o.slice(0,t)}?${f.join("&")}`:o.slice(0,t)}let Ur=1/0;const vi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(vi);class $r extends Error{constructor(t,l,f){401===l&&$e(f)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=l,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ci=nr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ae.location.protocol?ae.parent:ae).location.href,qn=function(o,t){if(!(/^file:/.test(l=o.url)||/^file:/.test(ci())&&!/^\w+:/.test(l))){if(ae.fetch&&ae.Request&&ae.AbortController&&ae.Request.prototype.hasOwnProperty("signal"))return function(f,_){const E=new ae.AbortController,b=new ae.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:ci(),referrerPolicy:f.referrerPolicy,signal:E.signal});let A=!1,k=!1;const F=(G=b.url).indexOf("sku=")>0&&$e(G);var G;"json"===f.type&&b.headers.set("Accept","application/json");const J=(le,de,Se)=>{if(k)return;if(le&&"SecurityError"!==le.message&&ur(le.toString()),de&&Se)return ne(de);const tt=Date.now();ae.fetch(b).then(_t=>{if(_t.ok){const At=F?_t.clone():null;return ne(_t,At,tt)}return _(new $r(_t.statusText,_t.status,f.url))}).catch(_t=>{"AbortError"!==_t.name&&_(new Error(`${_t.message} ${f.url}`))})},ne=(le,de,Se)=>{("arrayBuffer"===f.type?le.arrayBuffer():"json"===f.type?le.json():le.text()).then(tt=>{k||(de&&Se&&function(_t,At,yt){if(Mt(),!Bt)return;const St={status:At.status,statusText:At.statusText,headers:new ae.Headers};At.headers.forEach((yn,pn)=>St.headers.set(pn,yn));const Ft=mr(At.headers.get("Cache-Control")||"");if(Ft["no-store"])return;Ft["max-age"]&&St.headers.set("Expires",new Date(yt+1e3*Ft["max-age"]).toUTCString());const kt=St.headers.get("Expires");kt&&(new Date(kt).getTime()-yt<42e4||function(yn,pn){if(void 0===Ce)try{new Response(new ReadableStream),Ce=!0}catch{Ce=!1}Ce?pn(yn.body):yn.blob().then(pn)}(At,yn=>{const pn=new ae.Response(yn,St);Mt(),Bt&&Bt.then(Fn=>Fn.put(hn(_t.url),pn)).catch(Fn=>ur(Fn.message))}))}(b,de,Se),A=!0,_(null,tt,le.headers.get("Cache-Control"),le.headers.get("Expires")))}).catch(tt=>{k||_(new Error(tt.message))})};return F?function(le,de){if(Mt(),!Bt)return de(null);const Se=hn(le.url);Bt.then(tt=>{tt.match(Se).then(_t=>{const At=function(yt){if(!yt)return!1;const St=new Date(yt.headers.get("Expires")||0),Ft=mr(yt.headers.get("Cache-Control")||"");return St>Date.now()&&!Ft["no-cache"]}(_t);tt.delete(Se),At&&tt.put(Se,_t.clone()),de(null,_t,At)}).catch(de)}).catch(de)}(b,J):J(null,null),{cancel:()=>{k=!0,A||E.abort()}}}(o,t);if(nr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,t,void 0,!0)}var l;return function(f,_){const E=new ae.XMLHttpRequest;E.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(E.responseType="arraybuffer");for(const b in f.headers)E.setRequestHeader(b,f.headers[b]);return"json"===f.type&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials="include"===f.credentials,E.onerror=()=>{_(new Error(E.statusText))},E.onload=()=>{if((E.status>=200&&E.status<300||0===E.status)&&null!==E.response){let b=E.response;if("json"===f.type)try{b=JSON.parse(E.response)}catch(A){return _(A)}_(null,b,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else _(new $r(E.statusText,E.status,f.url))},E.send(f.body),{cancel:()=>E.abort()}}(o,t)},Fs=function(o,t){return qn(Qe(o,{type:"arrayBuffer"}),t)};function Zt(o){const t=ae.document.createElement("a");return t.href=o,t.protocol===ae.document.location.protocol&&t.host===ae.document.location.host}const ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let re,Q;re=[],Q=0;const oe=function(o,t){if(xe.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Q>=Ve.MAX_PARALLEL_IMAGE_REQUESTS){const E={requestParameters:o,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return re.push(E),E}Q++;let l=!1;const f=()=>{if(!l)for(l=!0,Q--;re.length&&Q<Ve.MAX_PARALLEL_IMAGE_REQUESTS;){const E=re.shift(),{requestParameters:b,callback:A,cancelled:k}=E;k||(E.cancel=oe(b,A).cancel)}},_=Fs(o,(E,b,A,k)=>{f(),E?t(E):b&&(ae.createImageBitmap?function(F,G){const J=new ae.Blob([new Uint8Array(F)],{type:"image/png"});ae.createImageBitmap(J).then(ne=>{G(null,ne)}).catch(ne=>{G(new Error(`Could not load image because of ${ne.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(F,G)=>t(F,G,A,k)):function(F,G){const J=new ae.Image,ne=ae.URL;J.onload=()=>{G(null,J),ne.revokeObjectURL(J.src),J.onload=null,ae.requestAnimationFrame(()=>{J.src=ve})},J.onerror=()=>G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const le=new ae.Blob([new Uint8Array(F)],{type:"image/png"});J.src=F.byteLength?ne.createObjectURL(le):ve}(b,(F,G)=>t(F,G,A,k)))});return{cancel:()=>{_.cancel(),f()}}},ge="NO_ACCESS_TOKEN";function Me(o){return 0===o.indexOf("mapbox:")}function $e(o){return Ve.API_URL_REGEX.test(o)}function Re(o){return Ve.API_CDN_URL_REGEX.test(o)}function Ie(o){return Ve.API_STYLE_REGEX.test(o)&&!we(o)}function we(o){return Ve.API_SPRITE_REGEX.test(o)}const Je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ae(o){const t=o.match(Je);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ne(o){const t=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${t}`}const ft="mapbox.eventData";function Vt(o){if(!o)return null;const t=o.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(ae.atob(t[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Rt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const l=Vt(Ve.ACCESS_TOKEN);let f="";return f=l&&l.u?ae.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(_,E)=>String.fromCharCode(+("0x"+E)))):Ve.ACCESS_TOKEN||"",t?`${ft}.${t}:${f}`:`${ft}:${f}`}fetchEventData(){const t=us("localStorage"),l=this.getStorageKey(),f=this.getStorageKey("uuid");if(t)try{const _=ae.localStorage.getItem(l);_&&(this.eventData=JSON.parse(_));const E=ae.localStorage.getItem(f);E&&(this.anonId=E)}catch{ur("Unable to read from LocalStorage")}}saveEventData(){const t=us("localStorage"),l=this.getStorageKey(),f=this.getStorageKey("uuid");if(t)try{ae.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&ae.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{ur("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,l,f,_){if(!Ve.EVENTS_URL)return;const E=Ae(Ve.EVENTS_URL);E.params.push(`access_token=${_||Ve.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(t).toISOString()},A=l?Qe(b,l):b,k={url:Ne(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};var G;this.pendingRequest=(G=F=>{this.pendingRequest=null,f(F),this.saveEventData(),this.processRequests(_)},qn(Qe(k,{method:"POST"}),G))}queueRequest(t,l){this.queue.push(t),this.processRequests(l)}}const Mn=new class extends Rt{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,t){Ve.EVENTS_URL&&Ve.ACCESS_TOKEN&&Array.isArray(o)&&o.some(l=>Me(l)||$e(l))&&this.queueRequest(Date.now(),t)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Vt(Ve.ACCESS_TOKEN),l=t?t.u:Ve.ACCESS_TOKEN;let f=l!==this.eventData.tokenU;mn(this.anonId)||(this.anonId=Qt(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),b=new Date(_),A=(_-this.eventData.lastSuccess)/864e5;f=f||A>=1||A<-1||E.getDate()!==b.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:De,skuId:je,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=_,this.eventData.tokenU=l)},o):this.processRequests()}},ar=Mn.postTurnstileEvent.bind(Mn),wr=new class extends Rt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,t,l,f){this.skuToken=t,this.errorCb=f,Ve.EVENTS_URL&&(l||Ve.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},l):this.errorCb(new Error(ge)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:l}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),mn(this.anonId)||(this.anonId=Qt()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:De,skuId:je,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},o))}},Hr=wr.postMapLoadEvent.bind(wr),Li=new class extends Rt{constructor(){super("gljs.performance")}postPerformanceEvent(o,t){Ve.EVENTS_URL&&(o||Ve.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:l}=this.queue.shift(),f=function(_){const E=ae.performance.getEntriesByType("resource"),b=ae.performance.getEntriesByType("mark"),A=function(ne){const le={};if(ne)for(const de in ne)if("other"!==de)for(const Se of ne[de]){const tt=`${de}ResolveRangeMin`,_t=`${de}ResolveRangeMax`,At=`${de}RequestCount`,yt=`${de}RequestCachedCount`;le[tt]=Math.min(le[tt]||1/0,Se.startTime),le[_t]=Math.max(le[_t]||-1/0,Se.responseEnd);const St=Ft=>{void 0===le[Ft]&&(le[Ft]=0),++le[Ft]};void 0!==Se.transferSize&&0===Se.transferSize&&St(yt),St(At)}return le}(function(ne,le){const de={};if(ne)for(const Se of ne){const tt=le(Se);void 0===de[tt]&&(de[tt]=[]),de[tt].push(Se)}return de}(E,In)),k=ae.devicePixelRatio,F=ae.navigator.connection||ae.navigator.mozConnection||ae.navigator.webkitConnection,G={counters:[],metadata:[],attributes:[]},J=(ne,le,de)=>{null!=de&&ne.push({name:le,value:de.toString()})};for(const ne in A)J(G.counters,ne,A[ne]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(J(G.counters,"interactionRangeMin",_.interactionRange[0]),J(G.counters,"interactionRangeMax",_.interactionRange[1])),b)for(const ne of Object.keys(ra)){const le=ra[ne],de=b.find(Se=>Se.name===le);de&&J(G.counters,le,de.startTime)}return J(G.counters,"visibilityHidden",_.visibilityHidden),J(G.attributes,"style",function(ne){if(ne)for(const le of ne){const de=le.name.split("?")[0];if(Ie(de)){const Se=de.split("/").slice(-2);if(2===Se.length)return`mapbox://styles/${Se[0]}/${Se[1]}`}}}(E)),J(G.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),J(G.attributes,"fogEnabled",_.fogEnabled?"true":"false"),J(G.attributes,"projection",_.projection),J(G.attributes,"zoom",_.zoom),J(G.metadata,"devicePixelRatio",k),J(G.metadata,"connectionEffectiveType",F?F.effectiveType:void 0),J(G.metadata,"navigatorUserAgent",ae.navigator.userAgent),J(G.metadata,"screenWidth",ae.screen.width),J(G.metadata,"screenHeight",ae.screen.height),J(G.metadata,"windowWidth",ae.innerWidth),J(G.metadata,"windowHeight",ae.innerHeight),J(G.metadata,"mapWidth",_.width/k),J(G.metadata,"mapHeight",_.height/k),J(G.metadata,"webglRenderer",_.renderer),J(G.metadata,"webglVendor",_.vendor),J(G.metadata,"sdkVersion",De),J(G.metadata,"sdkIdentifier","mapbox-gl-js"),G}(l);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(t,f,()=>{},o)}},$i=Li.postPerformanceEvent.bind(Li),Wr=new class extends Rt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,t,l,f){if(!Ve.API_URL||!Ve.SESSION_PATH)return;const _=Ae(Ve.API_URL+Ve.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${f||Ve.ACCESS_TOKEN||""}`);const E={url:Ne(_),headers:{"Content-Type":"text/plain"}};var A;this.pendingRequest=(A=b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(f)},qn(Qe(E,{method:"GET"}),A))}getSessionAPI(o,t,l,f){this.skuToken=t,this.errorCb=f,Ve.SESSION_PATH&&Ve.API_URL&&(l||Ve.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},l):this.errorCb(new Error(ge)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:l}=this.queue.shift();t&&this.success[t]||this.getSession(l,this.skuToken,f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},o)}},_r=Wr.getSessionAPI.bind(Wr),Bs=new Set,ra={create:"create",load:"load",fullLoad:"fullLoad"},wa={mark(o){ae.performance.mark(o)},measure(o,t,l){ae.performance.measure(o,t,l)}};function In(o){const t=o.name.split("?")[0];return Re(t)&&t.includes("mapbox-gl.js")?"javascript":Re(t)&&t.includes("mapbox-gl.css")?"css":Ve.API_FONTS_REGEX.test(t)?"fontRange":we(t)?"sprite":Ie(t)?"style":Ve.API_TILEJSON_REGEX.test(t)?"tilejson":"other"}const Jt=ae.performance;function Sn(o){const t=o?o.url.toString():void 0;return Jt.getEntriesByName(t)}let Gr,gi,Ii,ki;const ws={now:()=>void 0!==Ii?Ii:ae.performance.now(),setNow(o){Ii=o},restoreNow(){Ii=void 0},frame(o){const t=ae.requestAnimationFrame(o);return{cancel:()=>ae.cancelAnimationFrame(t)}},getImageData(o,t=0){const{width:l,height:f}=o;ki||(ki=ae.document.createElement("canvas"));const _=ki.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(l>ki.width||f>ki.height)&&(ki.width=l,ki.height=f),_.clearRect(-t,-t,l+2*t,f+2*t),_.drawImage(o,0,0,l,f),_.getImageData(-t,-t,l+2*t,f+2*t)},resolveURL:o=>(Gr||(Gr=ae.document.createElement("a")),Gr.href=o,Gr.href),get devicePixelRatio(){return ae.devicePixelRatio},get prefersReducedMotion(){return!!ae.matchMedia&&(null==gi&&(gi=ae.matchMedia("(prefers-reduced-motion: reduce)")),gi.matches)}};function _i(o,t,l){l[o]&&-1!==l[o].indexOf(t)||(l[o]=l[o]||[],l[o].push(t))}function ut(o,t,l){if(l&&l[o]){const f=l[o].indexOf(t);-1!==f&&l[o].splice(f,1)}}class Dt{constructor(t,l={}){Qe(this,l),this.type=t}}class Nt extends Dt{constructor(t,l={}){super("error",Qe({error:t},l))}}class wn{on(t,l){return this._listeners=this._listeners||{},_i(t,l,this._listeners),this}off(t,l){return ut(t,l,this._listeners),ut(t,l,this._oneTimeListeners),this}once(t,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},_i(t,l,this._oneTimeListeners),this):new Promise(f=>this.once(t,f))}fire(t,l){"string"==typeof t&&(t=new Dt(t,l||{}));const f=t.type;if(this.listens(f)){t.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of _)A.call(this,t);const E=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of E)ut(f,A,this._oneTimeListeners),A.call(this,t);const b=this._eventedParent;b&&(Qe(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof Nt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,l){return this._eventedParent=t,this._eventedParentData=l,this}}var bt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function On(o,...t){for(const l of t)for(const f in l)o[f]=l[f];return o}function sr(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function ei(o){if(Array.isArray(o))return o.map(ei);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const t={};for(const l in o)t[l]=ei(o[l]);return t}return sr(o)}class Mr extends Error{constructor(t,l){super(l),this.message=l,this.key=t}}var li=Mr;class xi{constructor(t,l=[]){this.parent=t,this.bindings={};for(const[f,_]of l)this.bindings[f]=_}concat(t){return new xi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Ds=xi;const Vs={kind:"null"},gr={kind:"number"},ti={kind:"string"},qr={kind:"boolean"},Ci={kind:"color"},_s={kind:"object"},br={kind:"value"},Ui={kind:"collator"},Mo={kind:"formatted"},bs={kind:"resolvedImage"};function Gi(o,t){return{kind:"array",itemType:o,N:t}}function ys(o){if("array"===o.kind){const t=ys(o.itemType);return"number"==typeof o.N?`array<${t}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${t}>`}return o.kind}const fi=[Vs,gr,ti,qr,Ci,Mo,_s,Gi(br),bs];function Pi(o,t){if("error"===t.kind)return null;if("array"===o.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Pi(o.itemType,t.itemType))&&("number"!=typeof o.N||o.N===t.N))return null}else{if(o.kind===t.kind)return null;if("value"===o.kind)for(const l of fi)if(!Pi(l,t))return null}return`Expected ${ys(o)} but found ${ys(t)} instead.`}function Fl(o,t){return t.some(l=>l.kind===o.kind)}function Wo(o,t){return t.some(l=>"null"===l?null===o:"array"===l?Array.isArray(o):"object"===l?o&&!Array.isArray(o)&&"object"==typeof o:l===typeof o)}var gc,Iu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function bl(o){return(o=Math.round(o))<0?0:o>255?255:o}function Fi(o){return bl("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function Nr(o){return(t="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:t>1?1:t;var t}function eo(o,t,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?o+(t-o)*l*6:2*l<1?t:3*l<2?o+(t-o)*(2/3-l)*6:o}try{gc={}.parseCSSColor=function(o){var t,l=o.replace(/ /g,"").toLowerCase();if(l in Iu)return Iu[l].slice();if("#"===l[0])return 4===l.length?(t=parseInt(l.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===l.length&&(t=parseInt(l.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var f=l.indexOf("("),_=l.indexOf(")");if(-1!==f&&_+1===l.length){var E=l.substr(0,f),b=l.substr(f+1,_-(f+1)).split(","),A=1;switch(E){case"rgba":if(4!==b.length)return null;A=Nr(b.pop());case"rgb":return 3!==b.length?null:[Fi(b[0]),Fi(b[1]),Fi(b[2]),A];case"hsla":if(4!==b.length)return null;A=Nr(b.pop());case"hsl":if(3!==b.length)return null;var k=(parseFloat(b[0])%360+360)%360/360,F=Nr(b[1]),G=Nr(b[2]),J=G<=.5?G*(F+1):G+F-G*F,ne=2*G-J;return[bl(255*eo(ne,J,k+1/3)),bl(255*eo(ne,J,k)),bl(255*eo(ne,J,k-1/3)),A];default:return null}}return null}}catch{}class to{constructor(t,l,f,_=1){this.r=t,this.g=l,this.b=f,this.a=_}static parse(t){if(!t)return;if(t instanceof to)return t;if("string"!=typeof t)return;const l=gc(t);return l?new to(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[t,l,f,_]=this.toArray();return`rgba(${Math.round(t)},${Math.round(l)},${Math.round(f)},${_})`}toArray(){const{r:t,g:l,b:f,a:_}=this;return 0===_?[0,0,0,0]:[255*t/_,255*l/_,255*f/_,_]}toArray01(){const{r:t,g:l,b:f,a:_}=this;return 0===_?[0,0,0,0]:[t/_,l/_,f/_,_]}toArray01PremultipliedAlpha(){const{r:t,g:l,b:f,a:_}=this;return[t,l,f,_]}}to.black=new to(0,0,0,1),to.white=new to(1,1,1,1),to.transparent=new to(0,0,0,0),to.red=new to(1,0,0,1),to.blue=new to(0,0,1,1);var ds=to;class Bc{constructor(t,l,f){this.sensitivity=t?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,l){return this.collator.compare(t,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tl{constructor(t,l,f,_,E){this.text=t.normalize?t.normalize():t,this.image=l,this.scale=f,this.fontStack=_,this.textColor=E}}class ba{constructor(t){this.sections=t}static fromString(t){return new ba([new Tl(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof ba?t:ba.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const l of this.sections){if(l.image){t.push(["image",l.image.name]);continue}t.push(l.text);const f={};l.fontStack&&(f["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(f["font-scale"]=l.scale),l.textColor&&(f["text-color"]=["rgba"].concat(l.textColor.toArray())),t.push(f)}return t}}class Ro{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Ro({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Ta(o,t,l,f){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[o,t,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[o,t,l,f]:[o,t,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function al(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof ds||o instanceof Bc||o instanceof ba||o instanceof Ro)return!0;if(Array.isArray(o)){for(const t of o)if(!al(t))return!1;return!0}if("object"==typeof o){for(const t in o)if(!al(o[t]))return!1;return!0}return!1}function no(o){if(null===o)return Vs;if("string"==typeof o)return ti;if("boolean"==typeof o)return qr;if("number"==typeof o)return gr;if(o instanceof ds)return Ci;if(o instanceof Bc)return Ui;if(o instanceof ba)return Mo;if(o instanceof Ro)return bs;if(Array.isArray(o)){const t=o.length;let l;for(const f of o){const _=no(f);if(l){if(l===_)continue;l=br;break}l=_}return Gi(l||br,t)}return _s}function Xo(o){const t=typeof o;return null===o?"":"string"===t||"number"===t||"boolean"===t?String(o):o instanceof ds||o instanceof ba||o instanceof Ro?o.toString():JSON.stringify(o)}class Za{constructor(t,l){this.type=t,this.value=l}static parse(t,l){if(2!==t.length)return l.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!al(t[1]))return l.error("invalid value");const f=t[1];let _=no(f);const E=l.expectedType;return"array"!==_.kind||0!==_.N||!E||"array"!==E.kind||"number"==typeof E.N&&0!==E.N||(_=E),new Za(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ds?["rgba"].concat(this.value.toArray()):this.value instanceof ba?this.value.serialize():this.value}}var ia=Za,hs=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const sa={string:ti,number:gr,boolean:qr,object:_s};class wi{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");let f,_=1;const E=t[0];if("array"===E){let A,k;if(t.length>2){const F=t[1];if("string"!=typeof F||!(F in sa)||"object"===F)return l.error('The item type argument of "array" must be one of string, number, boolean',1);A=sa[F],_++}else A=br;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return l.error('The length argument to "array" must be a positive integer literal',2);k=t[2],_++}f=Gi(A,k)}else f=sa[E];const b=[];for(;_<t.length;_++){const A=l.parse(t[_],_,br);if(!A)return null;b.push(A)}return new wi(f,b)}evaluate(t){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(t);if(!Pi(this.type,no(f)))return f;if(l===this.args.length-1)throw new hs(`Expected value to be of type ${ys(this.type)}, but found ${ys(no(f))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,l=[t.kind];if("array"===t.kind){const f=t.itemType;if("string"===f.kind||"number"===f.kind||"boolean"===f.kind){l.push(f.kind);const _=t.N;("number"==typeof _||this.args.length>1)&&l.push(_)}}return l.concat(this.args.map(f=>f.serialize()))}}var Zs=wi;class Us{constructor(t){this.type=Mo,this.sections=t}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const f=t[1];if(!Array.isArray(f)&&"object"==typeof f)return l.error("First argument must be an image or text section.");const _=[];let E=!1;for(let b=1;b<=t.length-1;++b){const A=t[b];if(E&&"object"==typeof A&&!Array.isArray(A)){E=!1;let k=null;if(A["font-scale"]&&(k=l.parse(A["font-scale"],1,gr),!k))return null;let F=null;if(A["text-font"]&&(F=l.parse(A["text-font"],1,Gi(ti)),!F))return null;let G=null;if(A["text-color"]&&(G=l.parse(A["text-color"],1,Ci),!G))return null;const J=_[_.length-1];J.scale=k,J.font=F,J.textColor=G}else{const k=l.parse(t[b],1,br);if(!k)return null;const F=k.type.kind;if("string"!==F&&"value"!==F&&"null"!==F&&"resolvedImage"!==F)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,_.push({content:k,scale:null,font:null,textColor:null})}}return new Us(_)}evaluate(t){return new ba(this.sections.map(l=>{const f=l.content.evaluate(t);return no(f)===bs?new Tl("",f,null,null,null):new Tl(Xo(f),null,l.scale?l.scale.evaluate(t):null,l.font?l.font.evaluate(t).join(","):null,l.textColor?l.textColor.evaluate(t):null)}))}eachChild(t){for(const l of this.sections)t(l.content),l.scale&&t(l.scale),l.font&&t(l.font),l.textColor&&t(l.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const l of this.sections){t.push(l.content.serialize());const f={};l.scale&&(f["font-scale"]=l.scale.serialize()),l.font&&(f["text-font"]=l.font.serialize()),l.textColor&&(f["text-color"]=l.textColor.serialize()),t.push(f)}return t}}class ga{constructor(t){this.type=bs,this.input=t}static parse(t,l){if(2!==t.length)return l.error("Expected two arguments.");const f=l.parse(t[1],1,ti);return f?new ga(f):l.error("No image name provided.")}evaluate(t){const l=this.input.evaluate(t),f=Ro.fromString(l);return f&&t.availableImages&&(f.available=t.availableImages.indexOf(l)>-1),f}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ei={"to-boolean":qr,"to-color":Ci,"to-number":gr,"to-string":ti};class Il{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expected at least one argument.");const f=t[0];if(("to-boolean"===f||"to-string"===f)&&2!==t.length)return l.error("Expected one argument.");const _=Ei[f],E=[];for(let b=1;b<t.length;b++){const A=l.parse(t[b],b,br);if(!A)return null;E.push(A)}return new Il(_,E)}evaluate(t){if("boolean"===this.type.kind)return!!this.args[0].evaluate(t);if("color"===this.type.kind){let l,f;for(const _ of this.args){if(l=_.evaluate(t),f=null,l instanceof ds)return l;if("string"==typeof l){const E=t.parseColor(l);if(E)return E}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ta(l[0],l[1],l[2],l[3]),!f))return new ds(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new hs(f||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const f of this.args){if(l=f.evaluate(t),null===l)return 0;const _=Number(l);if(!isNaN(_))return _}throw new hs(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?ba.fromString(Xo(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Ro.fromString(Xo(this.args[0].evaluate(t))):Xo(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Us([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ga(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(l=>{t.push(l.serialize())}),t}}var La=Il;const Bo=["Unknown","Point","LineString","Polygon"];var _c=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Bo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:l,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*t-o[0])+this.featureDistanceData.bearing[1]*(f*t-o[1])}return 0}parseColor(o){let t=this._parseColorCache[o];return t||(t=this._parseColorCache[o]=ds.parse(o)),t}};class Xa{constructor(t,l,f,_){this.name=t,this.type=l,this._evaluate=f,this.args=_}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,l){const f=t[0],_=Xa.definitions[f];if(!_)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(_)?_[0]:_.type,b=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,A=b.filter(([F])=>!Array.isArray(F)||F.length===t.length-1);let k=null;for(const[F,G]of A){k=new _a(l.registry,l.path,null,l.scope);const J=[];let ne=!1;for(let le=1;le<t.length;le++){const de=t[le],Se=Array.isArray(F)?F[le-1]:F.type,tt=k.parse(de,1+J.length,Se);if(!tt){ne=!0;break}J.push(tt)}if(!ne)if(Array.isArray(F)&&F.length!==J.length)k.error(`Expected ${F.length} arguments, but found ${J.length} instead.`);else{for(let le=0;le<J.length;le++){const de=Array.isArray(F)?F[le]:F.type,Se=J[le];k.concat(le+1).checkSubtype(de,Se.type)}if(0===k.errors.length)return new Xa(f,E,G,J)}}if(1===A.length)l.errors.push(...k.errors);else{const F=(A.length?A:b).map(([J])=>{return ne=J,Array.isArray(ne)?`(${ne.map(ys).join(", ")})`:`(${ys(ne.type)}...)`;var ne}).join(" | "),G=[];for(let J=1;J<t.length;J++){const ne=l.parse(t[J],1+G.length);if(!ne)return null;G.push(ys(ne.type))}l.error(`Expected arguments of type ${F}, but found (${G.join(", ")}) instead.`)}return null}static register(t,l){Xa.definitions=l;for(const f in l)t[f]=Xa}}var qo=Xa;class Qo{constructor(t,l,f){this.type=Ui,this.locale=f,this.caseSensitive=t,this.diacriticSensitive=l}static parse(t,l){if(2!==t.length)return l.error("Expected one argument.");const f=t[1];if("object"!=typeof f||Array.isArray(f))return l.error("Collator options argument must be an object.");const _=l.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,qr);if(!_)return null;const E=l.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,qr);if(!E)return null;let b=null;return f.locale&&(b=l.parse(f.locale,1,ti),!b)?null:new Qo(_,E,b)}evaluate(t){return new Bc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Ko=8192;function Fa(o,t){o[0]=Math.min(o[0],t[0]),o[1]=Math.min(o[1],t[1]),o[2]=Math.max(o[2],t[0]),o[3]=Math.max(o[3],t[1])}function oa(o,t){return!(o[0]<=t[0]||o[2]>=t[2]||o[1]<=t[1]||o[3]>=t[3])}function Bl(o,t){const l=(180+o[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,_=Math.pow(2,t.z);return[Math.round(l*_*Ko),Math.round(f*_*Ko)]}function Qa(o,t,l){const f=o[0]-t[0],_=o[1]-t[1],E=o[0]-l[0],b=o[1]-l[1];return f*b-E*_==0&&f*E<=0&&_*b<=0}function Yc(o,t){let l=!1;for(let b=0,A=t.length;b<A;b++){const k=t[b];for(let F=0,G=k.length;F<G-1;F++){if(Qa(o,k[F],k[F+1]))return!1;(_=k[F])[1]>(f=o)[1]!=(E=k[F+1])[1]>f[1]&&f[0]<(E[0]-_[0])*(f[1]-_[1])/(E[1]-_[1])+_[0]&&(l=!l)}}var f,_,E;return l}function So(o,t){for(let l=0;l<t.length;l++)if(Yc(o,t[l]))return!0;return!1}function Vl(o,t,l,f){const _=f[0]-l[0],E=f[1]-l[1],b=(o[0]-l[0])*E-_*(o[1]-l[1]),A=(t[0]-l[0])*E-_*(t[1]-l[1]);return b>0&&A<0||b<0&&A>0}function Ul(o,t,l){for(const F of l)for(let G=0;G<F.length-1;++G)if((A=[(b=F[G+1])[0]-(E=F[G])[0],b[1]-E[1]])[0]*(k=[(_=t)[0]-(f=o)[0],_[1]-f[1]])[1]-A[1]*k[0]!=0&&Vl(f,_,E,b)&&Vl(E,b,f,_))return!0;var f,_,E,b,A,k;return!1}function Ki(o,t){for(let l=0;l<o.length;++l)if(!Yc(o[l],t))return!1;for(let l=0;l<o.length-1;++l)if(Ul(o[l],o[l+1],t))return!1;return!0}function zl(o,t){for(let l=0;l<t.length;l++)if(Ki(o,t[l]))return!0;return!1}function aa(o,t,l){const f=[];for(let _=0;_<o.length;_++){const E=[];for(let b=0;b<o[_].length;b++){const A=Bl(o[_][b],l);Fa(t,A),E.push(A)}f.push(E)}return f}function Ba(o,t,l){const f=[];for(let _=0;_<o.length;_++){const E=aa(o[_],t,l);f.push(E)}return f}function Va(o,t,l,f){if(o[0]<l[0]||o[0]>l[2]){const _=.5*f;let E=o[0]-l[0]>_?-f:l[0]-o[0]>_?f:0;0===E&&(E=o[0]-l[2]>_?-f:l[2]-o[0]>_?f:0),o[0]+=E}Fa(t,o)}function Vc(o,t,l,f){const _=Math.pow(2,f.z)*Ko,E=[f.x*Ko,f.y*Ko],b=[];if(!o)return b;for(const A of o)for(const k of A){const F=[k.x+E[0],k.y+E[1]];Va(F,t,l,_),b.push(F)}return b}function Vo(o,t,l,f){const _=Math.pow(2,f.z)*Ko,E=[f.x*Ko,f.y*Ko],b=[];if(!o)return b;for(const k of o){const F=[];for(const G of k){const J=[G.x+E[0],G.y+E[1]];Fa(t,J),F.push(J)}b.push(F)}if(t[2]-t[0]<=_/2){(A=t)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const k of b)for(const F of k)Va(F,t,l,_)}var A;return b}class Ia{constructor(t,l){this.type=qr,this.geojson=t,this.geometries=l}static parse(t,l){if(2!==t.length)return l.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(al(t[1])){const f=t[1];if("FeatureCollection"===f.type)for(let _=0;_<f.features.length;++_){const E=f.features[_].geometry.type;if("Polygon"===E||"MultiPolygon"===E)return new Ia(f,f.features[_].geometry)}else if("Feature"===f.type){const _=f.geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Ia(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new Ia(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(l,f){const _=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===f.type){const A=aa(f.coordinates,E,b),k=Vc(l.geometry(),_,E,b);if(!oa(_,E))return!1;for(const F of k)if(!Yc(F,A))return!1}if("MultiPolygon"===f.type){const A=Ba(f.coordinates,E,b),k=Vc(l.geometry(),_,E,b);if(!oa(_,E))return!1;for(const F of k)if(!So(F,A))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(l,f){const _=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===f.type){const A=aa(f.coordinates,E,b),k=Vo(l.geometry(),_,E,b);if(!oa(_,E))return!1;for(const F of k)if(!Ki(F,A))return!1}if("MultiPolygon"===f.type){const A=Ba(f.coordinates,E,b),k=Vo(l.geometry(),_,E,b);if(!oa(_,E))return!1;for(const F of k)if(!zl(F,A))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ya=Ia;function Ua(o){if(o instanceof qo&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof Ya)return!1;let t=!0;return o.eachChild(l=>{t&&!Ua(l)&&(t=!1)}),t}function Sa(o){if(o instanceof qo&&"feature-state"===o.name)return!1;let t=!0;return o.eachChild(l=>{t&&!Sa(l)&&(t=!1)}),t}function ro(o,t){if(o instanceof qo&&t.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(f=>{l&&!ro(f,t)&&(l=!1)}),l}class si{constructor(t,l){this.type=l.type,this.name=t,this.boundExpression=l}static parse(t,l){if(2!==t.length||"string"!=typeof t[1])return l.error("'var' expression requires exactly one string literal argument.");const f=t[1];return l.scope.has(f)?new si(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Aa=si;class Po{constructor(t,l=[],f,_=new Ds,E=[]){this.registry=t,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=E,this.expectedType=f}parse(t,l,f,_,E={}){return l?this.concat(l,f,_)._parse(t,E):this._parse(t,E)}_parse(t,l){function f(_,E,b){return"assert"===b?new Zs(E,[_]):"coerce"===b?new La(E,[_]):_}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=t[0];if("string"!=typeof _)return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[_];if(E){let b=E.parse(t,this);if(!b)return null;if(this.expectedType){const A=this.expectedType,k=b.type;if("string"!==A.kind&&"number"!==A.kind&&"boolean"!==A.kind&&"object"!==A.kind&&"array"!==A.kind||"value"!==k.kind)if("color"!==A.kind&&"formatted"!==A.kind&&"resolvedImage"!==A.kind||"value"!==k.kind&&"string"!==k.kind){if(this.checkSubtype(A,k))return null}else b=f(b,A,l.typeAnnotation||"coerce");else b=f(b,A,l.typeAnnotation||"assert")}if(!(b instanceof ia)&&"resolvedImage"!==b.type.kind&&zi(b)){const A=new _c;try{b=new ia(b.type,b.evaluate(A))}catch(k){return this.error(k.message),null}}return b}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,l,f){const _="number"==typeof t?this.path.concat(t):this.path,E=f?this.scope.concat(f):this.scope;return new Po(this.registry,_,l||null,E,this.errors)}error(t,...l){const f=`${this.key}${l.map(_=>`[${_}]`).join("")}`;this.errors.push(new li(f,t))}checkSubtype(t,l){const f=Pi(t,l);return f&&this.error(f),f}}var _a=Po;function zi(o){if(o instanceof Aa)return zi(o.boundExpression);if(o instanceof qo&&"error"===o.name||o instanceof Qo||o instanceof Ya)return!1;const t=o instanceof La||o instanceof Zs;let l=!0;return o.eachChild(f=>{l=t?l&&zi(f):l&&f instanceof ia}),!!l&&Ua(o)&&ro(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function tc(o,t){const l=o.length-1;let f,_,E=0,b=l,A=0;for(;E<=b;)if(A=Math.floor((E+b)/2),f=o[A],_=o[A+1],f<=t){if(A===l||t<_)return A;E=A+1}else{if(!(f>t))throw new hs("Input is not a number.");b=A-1}return 0}class Uo{constructor(t,l,f){this.type=t,this.input=l,this.labels=[],this.outputs=[];for(const[_,E]of f)this.labels.push(_),this.outputs.push(E)}static parse(t,l){if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(t[1],1,gr);if(!f)return null;const _=[];let E=null;l.expectedType&&"value"!==l.expectedType.kind&&(E=l.expectedType);for(let b=1;b<t.length;b+=2){const A=1===b?-1/0:t[b],k=t[b+1],F=b,G=b+1;if("number"!=typeof A)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(_.length&&_[_.length-1][0]>=A)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const J=l.parse(k,G,E);if(!J)return null;E=E||J.type,_.push([A,J])}return new Uo(E,f,_)}evaluate(t){const l=this.labels,f=this.outputs;if(1===l.length)return f[0].evaluate(t);const _=this.input.evaluate(t);if(_<=l[0])return f[0].evaluate(t);const E=l.length;return _>=l[E-1]?f[E-1].evaluate(t):f[tc(l,_)].evaluate(t)}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&t.push(this.labels[l]),t.push(this.outputs[l].serialize());return t}}var za=Uo;function ns(o,t,l){return o*(1-l)+t*l}var ll=Object.freeze({__proto__:null,array:function(o,t,l){return o.map((f,_)=>ns(f,t[_],l))},color:function(o,t,l){return new ds(ns(o.r,t.r,l),ns(o.g,t.g,l),ns(o.b,t.b,l),ns(o.a,t.a,l))},number:ns});const nc=4/29,Ja=6/29,da=3*Ja*Ja,vs=Ja*Ja*Ja,el=Math.PI/180,uu=180/Math.PI;function Sl(o){return o>vs?Math.pow(o,1/3):o/da+nc}function wo(o){return o>Ja?o*o*o:da*(o-nc)}function Mc(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Al(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function rc(o){const t=Al(o.r),l=Al(o.g),f=Al(o.b),_=Sl((.4124564*t+.3575761*l+.1804375*f)/.95047),E=Sl((.2126729*t+.7151522*l+.072175*f)/1);return{l:116*E-16,a:500*(_-E),b:200*(E-Sl((.0193339*t+.119192*l+.9503041*f)/1.08883)),alpha:o.a}}function Ts(o){let t=(o.l+16)/116,l=isNaN(o.a)?t:t+o.a/500,f=isNaN(o.b)?t:t-o.b/200;return t=1*wo(t),l=.95047*wo(l),f=1.08883*wo(f),new ds(Mc(3.2404542*l-1.5371385*t-.4985314*f),Mc(-.969266*l+1.8760108*t+.041556*f),Mc(.0556434*l-.2040259*t+1.0572252*f),o.alpha)}function jl(o,t,l){const f=t-o;return o+l*(f>180||f<-180?f-360*Math.round(f/360):f)}const Uc={forward:rc,reverse:Ts,interpolate:function(o,t,l){return{l:ns(o.l,t.l,l),a:ns(o.a,t.a,l),b:ns(o.b,t.b,l),alpha:ns(o.alpha,t.alpha,l)}}},Cl={forward:function(o){const{l:t,a:l,b:f}=rc(o),_=Math.atan2(f,l)*uu;return{h:_<0?_+360:_,c:Math.sqrt(l*l+f*f),l:t,alpha:o.a}},reverse:function(o){const t=o.h*el,l=o.c;return Ts({l:o.l,a:Math.cos(t)*l,b:Math.sin(t)*l,alpha:o.alpha})},interpolate:function(o,t,l){return{h:jl(o.h,t.h,l),c:ns(o.c,t.c,l),l:ns(o.l,t.l,l),alpha:ns(o.alpha,t.alpha,l)}}};var $l=Object.freeze({__proto__:null,hcl:Cl,lab:Uc});class zo{constructor(t,l,f,_,E){this.type=t,this.operator=l,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[b,A]of E)this.labels.push(b),this.outputs.push(A)}static interpolationFactor(t,l,f,_){let E=0;if("exponential"===t.name)E=yc(l,t.base,f,_);else if("linear"===t.name)E=yc(l,1,f,_);else if("cubic-bezier"===t.name){const b=t.controlPoints;E=new Ue(b[0],b[1],b[2],b[3]).solve(yc(l,1,f,_))}return E}static parse(t,l){let[f,_,E,...b]=t;if(!Array.isArray(_)||0===_.length)return l.error("Expected an interpolation type expression.",1);if("linear"===_[0])_={name:"linear"};else if("exponential"===_[0]){const F=_[1];if("number"!=typeof F)return l.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:F}}else{if("cubic-bezier"!==_[0])return l.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const F=_.slice(1);if(4!==F.length||F.some(G=>"number"!=typeof G||G<0||G>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:F}}}if(t.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(E=l.parse(E,2,gr),!E)return null;const A=[];let k=null;"interpolate-hcl"===f||"interpolate-lab"===f?k=Ci:l.expectedType&&"value"!==l.expectedType.kind&&(k=l.expectedType);for(let F=0;F<b.length;F+=2){const G=b[F],J=b[F+1],ne=F+3,le=F+4;if("number"!=typeof G)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(A.length&&A[A.length-1][0]>=G)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);const de=l.parse(J,le,k);if(!de)return null;k=k||de.type,A.push([G,de])}return"number"===k.kind||"color"===k.kind||"array"===k.kind&&"number"===k.itemType.kind&&"number"==typeof k.N?new zo(k,f,_,E,A):l.error(`Type ${ys(k)} is not interpolatable.`)}evaluate(t){const l=this.labels,f=this.outputs;if(1===l.length)return f[0].evaluate(t);const _=this.input.evaluate(t);if(_<=l[0])return f[0].evaluate(t);const E=l.length;if(_>=l[E-1])return f[E-1].evaluate(t);const b=tc(l,_),A=zo.interpolationFactor(this.interpolation,_,l[b],l[b+1]),k=f[b].evaluate(t),F=f[b+1].evaluate(t);return"interpolate"===this.operator?ll[this.type.kind.toLowerCase()](k,F,A):"interpolate-hcl"===this.operator?Cl.reverse(Cl.interpolate(Cl.forward(k),Cl.forward(F),A)):Uc.reverse(Uc.interpolate(Uc.forward(k),Uc.forward(F),A))}eachChild(t){t(this.input);for(const l of this.outputs)t(l)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,t,this.input.serialize()];for(let f=0;f<this.labels.length;f++)l.push(this.labels[f],this.outputs[f].serialize());return l}}function yc(o,t,l,f){const _=f-l,E=o-l;return 0===_?0:1===t?E/_:(Math.pow(t,E)-1)/(Math.pow(t,_)-1)}var Ca=zo;class Jc{constructor(t,l){this.type=t,this.args=l}static parse(t,l){if(t.length<2)return l.error("Expectected at least one argument.");let f=null;const _=l.expectedType;_&&"value"!==_.kind&&(f=_);const E=[];for(const A of t.slice(1)){const k=l.parse(A,1+E.length,f,void 0,{typeAnnotation:"omit"});if(!k)return null;f=f||k.type,E.push(k)}const b=_&&E.some(A=>Pi(_,A.type));return new Jc(b?br:f,E)}evaluate(t){let l,f=null,_=0;for(const E of this.args){if(_++,f=E.evaluate(t),f&&f instanceof Ro&&!f.available&&(l||(l=f),f=null,_===this.args.length))return l;if(null!==f)break}return f}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(l=>{t.push(l.serialize())}),t}}var vc=Jc;class Gl{constructor(t,l){this.type=l.type,this.bindings=[].concat(t),this.result=l}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const l of this.bindings)t(l[1]);t(this.result)}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const f=[];for(let E=1;E<t.length-1;E+=2){const b=t[E];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,E);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",E);const A=l.parse(t[E+1],E+1);if(!A)return null;f.push([b,A])}const _=l.parse(t[t.length-1],t.length-1,l.expectedType,f);return _?new Gl(f,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[l,f]of this.bindings)t.push(l,f.serialize());return t.push(this.result.serialize()),t}}var ic=Gl;class Dl{constructor(t,l,f){this.type=t,this.index=l,this.input=f}static parse(t,l){if(3!==t.length)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const f=l.parse(t[1],1,gr),_=l.parse(t[2],2,Gi(l.expectedType||br));return f&&_?new Dl(_.type.itemType,f,_):null}evaluate(t){const l=this.index.evaluate(t),f=this.input.evaluate(t);if(l<0)throw new hs(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new hs(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new hs(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var xc=Dl;class Bi{constructor(t,l){this.type=qr,this.needle=t,this.haystack=l}static parse(t,l){if(3!==t.length)return l.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const f=l.parse(t[1],1,br),_=l.parse(t[2],2,br);return f&&_?Fl(f.type,[qr,ti,gr,Vs,br])?new Bi(f,_):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ys(f.type)} instead`):null}evaluate(t){const l=this.needle.evaluate(t),f=this.haystack.evaluate(t);if(null==f)return!1;if(!Wo(l,["boolean","string","number","null"]))throw new hs(`Expected first argument to be of type boolean, string, number or null, but found ${ys(no(l))} instead.`);if(!Wo(f,["string","array"]))throw new hs(`Expected second argument to be of type array or string, but found ${ys(no(f))} instead.`);return f.indexOf(l)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var $s=Bi;class Is{constructor(t,l,f){this.type=gr,this.needle=t,this.haystack=l,this.fromIndex=f}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const f=l.parse(t[1],1,br),_=l.parse(t[2],2,br);if(!f||!_)return null;if(!Fl(f.type,[qr,ti,gr,Vs,br]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ys(f.type)} instead`);if(4===t.length){const E=l.parse(t[3],3,gr);return E?new Is(f,_,E):null}return new Is(f,_)}evaluate(t){const l=this.needle.evaluate(t),f=this.haystack.evaluate(t);if(!Wo(l,["boolean","string","number","null"]))throw new hs(`Expected first argument to be of type boolean, string, number or null, but found ${ys(no(l))} instead.`);if(!Wo(f,["string","array"]))throw new hs(`Expected second argument to be of type array or string, but found ${ys(no(f))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(t);return f.indexOf(l,_)}return f.indexOf(l)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Yo=Is;class uo{constructor(t,l,f,_,E,b){this.inputType=t,this.type=l,this.input=f,this.cases=_,this.outputs=E,this.otherwise=b}static parse(t,l){if(t.length<5)return l.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return l.error("Expected an even number of arguments.");let f,_;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);const E={},b=[];for(let F=2;F<t.length-1;F+=2){let G=t[F];const J=t[F+1];Array.isArray(G)||(G=[G]);const ne=l.concat(F);if(0===G.length)return ne.error("Expected at least one branch label.");for(const de of G){if("number"!=typeof de&&"string"!=typeof de)return ne.error("Branch labels must be numbers or strings.");if("number"==typeof de&&Math.abs(de)>Number.MAX_SAFE_INTEGER)return ne.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof de&&Math.floor(de)!==de)return ne.error("Numeric branch labels must be integer values.");if(f){if(ne.checkSubtype(f,no(de)))return null}else f=no(de);if(void 0!==E[String(de)])return ne.error("Branch labels must be unique.");E[String(de)]=b.length}const le=l.parse(J,F,_);if(!le)return null;_=_||le.type,b.push(le)}const A=l.parse(t[1],1,br);if(!A)return null;const k=l.parse(t[t.length-1],t.length-1,_);return k?"value"!==A.type.kind&&l.concat(1).checkSubtype(f,A.type)?null:new uo(f,_,A,E,b,k):null}evaluate(t){const l=this.input.evaluate(t);return(no(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),f=[],_={};for(const b of l){const A=_[this.cases[b]];void 0===A?(_[this.cases[b]]=f.length,f.push([this.cases[b],[b]])):f[A][1].push(b)}const E=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,A]of f)t.push(1===A.length?E(A[0]):A.map(E)),t.push(this.outputs[b].serialize());return t.push(this.otherwise.serialize()),t}}var Ns=uo;class Ml{constructor(t,l,f){this.type=t,this.branches=l,this.otherwise=f}static parse(t,l){if(t.length<4)return l.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const _=[];for(let b=1;b<t.length-1;b+=2){const A=l.parse(t[b],b,qr);if(!A)return null;const k=l.parse(t[b+1],b+1,f);if(!k)return null;_.push([A,k]),f=f||k.type}const E=l.parse(t[t.length-1],t.length-1,f);return E?new Ml(f,_,E):null}evaluate(t){for(const[l,f]of this.branches)if(l.evaluate(t))return f.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[l,f]of this.branches)t(l),t(f);t(this.otherwise)}outputDefined(){return this.branches.every(([t,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(l=>{t.push(l.serialize())}),t}}var tl=Ml;class du{constructor(t,l,f,_){this.type=t,this.input=l,this.beginIndex=f,this.endIndex=_}static parse(t,l){if(t.length<=2||t.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const f=l.parse(t[1],1,br),_=l.parse(t[2],2,gr);if(!f||!_)return null;if(!Fl(f.type,[Gi(br),ti,br]))return l.error(`Expected first argument to be of type array or string, but found ${ys(f.type)} instead`);if(4===t.length){const E=l.parse(t[3],3,gr);return E?new du(f.type,f,_,E):null}return new du(f.type,f,_)}evaluate(t){const l=this.input.evaluate(t),f=this.beginIndex.evaluate(t);if(!Wo(l,["string","array"]))throw new hs(`Expected first argument to be of type array or string, but found ${ys(no(l))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(t);return l.slice(f,_)}return l.slice(f)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var eu=du;function nl(o,t){return"=="===o||"!="===o?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function sc(o,t,l,f){return 0===f.compare(t,l)}function os(o,t,l){const f="=="!==o&&"!="!==o;return class l1{constructor(E,b,A){this.type=qr,this.lhs=E,this.rhs=b,this.collator=A,this.hasUntypedArgument="value"===E.type.kind||"value"===b.type.kind}static parse(E,b){if(3!==E.length&&4!==E.length)return b.error("Expected two or three arguments.");const A=E[0];let k=b.parse(E[1],1,br);if(!k)return null;if(!nl(A,k.type))return b.concat(1).error(`"${A}" comparisons are not supported for type '${ys(k.type)}'.`);let F=b.parse(E[2],2,br);if(!F)return null;if(!nl(A,F.type))return b.concat(2).error(`"${A}" comparisons are not supported for type '${ys(F.type)}'.`);if(k.type.kind!==F.type.kind&&"value"!==k.type.kind&&"value"!==F.type.kind)return b.error(`Cannot compare types '${ys(k.type)}' and '${ys(F.type)}'.`);f&&("value"===k.type.kind&&"value"!==F.type.kind?k=new Zs(F.type,[k]):"value"!==k.type.kind&&"value"===F.type.kind&&(F=new Zs(k.type,[F])));let G=null;if(4===E.length){if("string"!==k.type.kind&&"string"!==F.type.kind&&"value"!==k.type.kind&&"value"!==F.type.kind)return b.error("Cannot use collator to compare non-string types.");if(G=b.parse(E[3],3,Ui),!G)return null}return new l1(k,F,G)}evaluate(E){const b=this.lhs.evaluate(E),A=this.rhs.evaluate(E);if(f&&this.hasUntypedArgument){const k=no(b),F=no(A);if(k.kind!==F.kind||"string"!==k.kind&&"number"!==k.kind)throw new hs(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${k.kind}, ${F.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const k=no(b),F=no(A);if("string"!==k.kind||"string"!==F.kind)return t(E,b,A)}return this.collator?l(E,b,A,this.collator.evaluate(E)):t(E,b,A)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}serialize(){const E=[o];return this.eachChild(b=>{E.push(b.serialize())}),E}}}const Ec=os("==",function(o,t,l){return t===l},sc),zc=os("!=",function(o,t,l){return t!==l},function(o,t,l,f){return!sc(0,t,l,f)}),yo=os("<",function(o,t,l){return t<l},function(o,t,l,f){return f.compare(t,l)<0}),Hl=os(">",function(o,t,l){return t>l},function(o,t,l,f){return f.compare(t,l)>0}),hu=os("<=",function(o,t,l){return t<=l},function(o,t,l,f){return f.compare(t,l)<=0}),oc=os(">=",function(o,t,l){return t>=l},function(o,t,l,f){return f.compare(t,l)>=0});class Ps{constructor(t,l,f,_,E,b){this.type=ti,this.number=t,this.locale=l,this.currency=f,this.unit=_,this.minFractionDigits=E,this.maxFractionDigits=b}static parse(t,l){if(3!==t.length)return l.error("Expected two arguments.");const f=l.parse(t[1],1,gr);if(!f)return null;const _=t[2];if("object"!=typeof _||Array.isArray(_))return l.error("NumberFormat options argument must be an object.");let E=null;if(_.locale&&(E=l.parse(_.locale,1,ti),!E))return null;let b=null;if(_.currency&&(b=l.parse(_.currency,1,ti),!b))return null;let A=null;if(_.unit&&(A=l.parse(_.unit,1,ti),!A))return null;let k=null;if(_["min-fraction-digits"]&&(k=l.parse(_["min-fraction-digits"],1,gr),!k))return null;let F=null;return _["max-fraction-digits"]&&(F=l.parse(_["max-fraction-digits"],1,gr),!F)?null:new Ps(f,E,b,A,k,F)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class gs{constructor(t){this.type=gr,this.input=t}static parse(t,l){if(2!==t.length)return l.error(`Expected 1 argument, but found ${t.length-1} instead.`);const f=l.parse(t[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?l.error(`Expected argument of type string or array, but found ${ys(f.type)} instead.`):new gs(f):null}evaluate(t){const l=this.input.evaluate(t);if("string"==typeof l||Array.isArray(l))return l.length;throw new hs(`Expected value to be of type string or array, but found ${ys(no(l))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(l=>{t.push(l.serialize())}),t}}const Wl={"==":Ec,"!=":zc,">":Hl,"<":yo,">=":oc,"<=":hu,array:Zs,at:xc,boolean:Zs,case:tl,coalesce:vc,collator:Qo,format:Us,image:ga,in:$s,"index-of":Yo,interpolate:Ca,"interpolate-hcl":Ca,"interpolate-lab":Ca,length:gs,let:ic,literal:ia,match:Ns,number:Zs,"number-format":Ps,object:Zs,slice:eu,step:za,string:Zs,"to-boolean":La,"to-color":La,"to-number":La,"to-string":La,var:Aa,within:Ya};function ja(o,[t,l,f,_]){t=t.evaluate(o),l=l.evaluate(o),f=f.evaluate(o);const E=_?_.evaluate(o):1,b=Ta(t,l,f,E);if(b)throw new hs(b);return new ds(t/255*E,l/255*E,f/255*E,E)}function ya(o,t){return o in t}function ac(o,t){const l=t[o];return void 0===l?null:l}function ha(o){return{type:o}}qo.register(Wl,{error:[{kind:"error"},[ti],(o,[t])=>{throw new hs(t.evaluate(o))}],typeof:[ti,[br],(o,[t])=>ys(no(t.evaluate(o)))],"to-rgba":[Gi(gr,4),[Ci],(o,[t])=>t.evaluate(o).toArray()],rgb:[Ci,[gr,gr,gr],ja],rgba:[Ci,[gr,gr,gr,gr],ja],has:{type:qr,overloads:[[[ti],(o,[t])=>ya(t.evaluate(o),o.properties())],[[ti,_s],(o,[t,l])=>ya(t.evaluate(o),l.evaluate(o))]]},get:{type:br,overloads:[[[ti],(o,[t])=>ac(t.evaluate(o),o.properties())],[[ti,_s],(o,[t,l])=>ac(t.evaluate(o),l.evaluate(o))]]},"feature-state":[br,[ti],(o,[t])=>ac(t.evaluate(o),o.featureState||{})],properties:[_s,[],o=>o.properties()],"geometry-type":[ti,[],o=>o.geometryType()],id:[br,[],o=>o.id()],zoom:[gr,[],o=>o.globals.zoom],pitch:[gr,[],o=>o.globals.pitch||0],"distance-from-center":[gr,[],o=>o.distanceFromCenter()],"heatmap-density":[gr,[],o=>o.globals.heatmapDensity||0],"line-progress":[gr,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[gr,[],o=>o.globals.skyRadialProgress||0],accumulated:[br,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[gr,ha(gr),(o,t)=>{let l=0;for(const f of t)l+=f.evaluate(o);return l}],"*":[gr,ha(gr),(o,t)=>{let l=1;for(const f of t)l*=f.evaluate(o);return l}],"-":{type:gr,overloads:[[[gr,gr],(o,[t,l])=>t.evaluate(o)-l.evaluate(o)],[[gr],(o,[t])=>-t.evaluate(o)]]},"/":[gr,[gr,gr],(o,[t,l])=>t.evaluate(o)/l.evaluate(o)],"%":[gr,[gr,gr],(o,[t,l])=>t.evaluate(o)%l.evaluate(o)],ln2:[gr,[],()=>Math.LN2],pi:[gr,[],()=>Math.PI],e:[gr,[],()=>Math.E],"^":[gr,[gr,gr],(o,[t,l])=>Math.pow(t.evaluate(o),l.evaluate(o))],sqrt:[gr,[gr],(o,[t])=>Math.sqrt(t.evaluate(o))],log10:[gr,[gr],(o,[t])=>Math.log(t.evaluate(o))/Math.LN10],ln:[gr,[gr],(o,[t])=>Math.log(t.evaluate(o))],log2:[gr,[gr],(o,[t])=>Math.log(t.evaluate(o))/Math.LN2],sin:[gr,[gr],(o,[t])=>Math.sin(t.evaluate(o))],cos:[gr,[gr],(o,[t])=>Math.cos(t.evaluate(o))],tan:[gr,[gr],(o,[t])=>Math.tan(t.evaluate(o))],asin:[gr,[gr],(o,[t])=>Math.asin(t.evaluate(o))],acos:[gr,[gr],(o,[t])=>Math.acos(t.evaluate(o))],atan:[gr,[gr],(o,[t])=>Math.atan(t.evaluate(o))],min:[gr,ha(gr),(o,t)=>Math.min(...t.map(l=>l.evaluate(o)))],max:[gr,ha(gr),(o,t)=>Math.max(...t.map(l=>l.evaluate(o)))],abs:[gr,[gr],(o,[t])=>Math.abs(t.evaluate(o))],round:[gr,[gr],(o,[t])=>{const l=t.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[gr,[gr],(o,[t])=>Math.floor(t.evaluate(o))],ceil:[gr,[gr],(o,[t])=>Math.ceil(t.evaluate(o))],"filter-==":[qr,[ti,br],(o,[t,l])=>o.properties()[t.value]===l.value],"filter-id-==":[qr,[br],(o,[t])=>o.id()===t.value],"filter-type-==":[qr,[ti],(o,[t])=>o.geometryType()===t.value],"filter-<":[qr,[ti,br],(o,[t,l])=>{const f=o.properties()[t.value],_=l.value;return typeof f==typeof _&&f<_}],"filter-id-<":[qr,[br],(o,[t])=>{const l=o.id(),f=t.value;return typeof l==typeof f&&l<f}],"filter->":[qr,[ti,br],(o,[t,l])=>{const f=o.properties()[t.value],_=l.value;return typeof f==typeof _&&f>_}],"filter-id->":[qr,[br],(o,[t])=>{const l=o.id(),f=t.value;return typeof l==typeof f&&l>f}],"filter-<=":[qr,[ti,br],(o,[t,l])=>{const f=o.properties()[t.value],_=l.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[qr,[br],(o,[t])=>{const l=o.id(),f=t.value;return typeof l==typeof f&&l<=f}],"filter->=":[qr,[ti,br],(o,[t,l])=>{const f=o.properties()[t.value],_=l.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[qr,[br],(o,[t])=>{const l=o.id(),f=t.value;return typeof l==typeof f&&l>=f}],"filter-has":[qr,[br],(o,[t])=>t.value in o.properties()],"filter-has-id":[qr,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[qr,[Gi(ti)],(o,[t])=>t.value.indexOf(o.geometryType())>=0],"filter-id-in":[qr,[Gi(br)],(o,[t])=>t.value.indexOf(o.id())>=0],"filter-in-small":[qr,[ti,Gi(br)],(o,[t,l])=>l.value.indexOf(o.properties()[t.value])>=0],"filter-in-large":[qr,[ti,Gi(br)],(o,[t,l])=>function(f,_,E,b){for(;E<=b;){const A=E+b>>1;if(_[A]===f)return!0;_[A]>f?b=A-1:E=A+1}return!1}(o.properties()[t.value],l.value,0,l.value.length-1)],all:{type:qr,overloads:[[[qr,qr],(o,[t,l])=>t.evaluate(o)&&l.evaluate(o)],[ha(qr),(o,t)=>{for(const l of t)if(!l.evaluate(o))return!1;return!0}]]},any:{type:qr,overloads:[[[qr,qr],(o,[t,l])=>t.evaluate(o)||l.evaluate(o)],[ha(qr),(o,t)=>{for(const l of t)if(l.evaluate(o))return!0;return!1}]]},"!":[qr,[qr],(o,[t])=>!t.evaluate(o)],"is-supported-script":[qr,[ti],(o,[t])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(t.evaluate(o))}],upcase:[ti,[ti],(o,[t])=>t.evaluate(o).toUpperCase()],downcase:[ti,[ti],(o,[t])=>t.evaluate(o).toLowerCase()],concat:[ti,ha(br),(o,t)=>t.map(l=>Xo(l.evaluate(o))).join("")],"resolved-locale":[ti,[Ui],(o,[t])=>t.evaluate(o).resolvedLocale()]});var ql=Wl;function Rl(o){return{result:"success",value:o}}function ho(o){return{result:"error",value:o}}function $a(o){return"data-driven"===o["property-type"]}function wc(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function io(o){return!!o.expression&&o.expression.interpolated}function as(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Pl(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Ls(o){return o}function la(o,t){const l="color"===t.type,f=o.stops&&"object"==typeof o.stops[0][0],_=f||!(f||void 0!==o.property),E=o.type||(io(t)?"exponential":"interval");if(l&&((o=On({},o)).stops&&(o.stops=o.stops.map(F=>[F[0],ds.parse(F[1])])),o.default=ds.parse(o.default?o.default:t.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!$l[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let b,A,k;if("exponential"===E)b=Da;else if("interval"===E)b=va;else if("categorical"===E){b=lc,A=Object.create(null);for(const F of o.stops)A[F[0]]=F[1];k=typeof o.stops[0][0]}else{if("identity"!==E)throw new Error(`Unknown function type "${E}"`);b=jc}if(f){const F={},G=[];for(let le=0;le<o.stops.length;le++){const de=o.stops[le],Se=de[0].zoom;void 0===F[Se]&&(F[Se]={zoom:Se,type:o.type,property:o.property,default:o.default,stops:[]},G.push(Se)),F[Se].stops.push([de[0].value,de[1]])}const J=[];for(const le of G)J.push([F[le].zoom,la(F[le],t)]);const ne={name:"linear"};return{kind:"composite",interpolationType:ne,interpolationFactor:Ca.interpolationFactor.bind(void 0,ne),zoomStops:J.map(le=>le[0]),evaluate:({zoom:le},de)=>Da({stops:J,base:o.base},t,le).evaluate(le,de)}}if(_){const F="exponential"===E?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Ca.interpolationFactor.bind(void 0,F),zoomStops:o.stops.map(G=>G[0]),evaluate:({zoom:G})=>b(o,t,G,A,k)}}return{kind:"source",evaluate(F,G){const J=G&&G.properties?G.properties[o.property]:void 0;return void 0===J?ul(o.default,t.default):b(o,t,J,A,k)}}}function ul(o,t,l){return void 0!==o?o:void 0!==t?t:void 0!==l?l:void 0}function lc(o,t,l,f,_){return ul(typeof l===_?f[l]:void 0,o.default,t.default)}function va(o,t,l){if("number"!==as(l))return ul(o.default,t.default);const f=o.stops.length;if(1===f||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[f-1][0])return o.stops[f-1][1];const _=tc(o.stops.map(E=>E[0]),l);return o.stops[_][1]}function Da(o,t,l){const f=void 0!==o.base?o.base:1;if("number"!==as(l))return ul(o.default,t.default);const _=o.stops.length;if(1===_||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[_-1][0])return o.stops[_-1][1];const E=tc(o.stops.map(G=>G[0]),l),b=function(G,J,ne,le){const de=le-ne,Se=G-ne;return 0===de?0:1===J?Se/de:(Math.pow(J,Se)-1)/(Math.pow(J,de)-1)}(l,f,o.stops[E][0],o.stops[E+1][0]),A=o.stops[E][1],k=o.stops[E+1][1];let F=ll[t.type]||Ls;if(o.colorSpace&&"rgb"!==o.colorSpace){const G=$l[o.colorSpace];F=(J,ne)=>G.reverse(G.interpolate(G.forward(J),G.forward(ne),b))}return"function"==typeof A.evaluate?{evaluate(...G){const J=A.evaluate.apply(void 0,G),ne=k.evaluate.apply(void 0,G);if(void 0!==J&&void 0!==ne)return F(J,ne,b)}}:F(A,k,b)}function jc(o,t,l){return"color"===t.type?l=ds.parse(l):"formatted"===t.type?l=ba.fromString(l.toString()):"resolvedImage"===t.type?l=Ro.fromString(l.toString()):as(l)===t.type||"enum"===t.type&&t.values[l]||(l=void 0),ul(l,o.default,t.default)}class W{constructor(t,l){var f;this.expression=t,this._warningHistory={},this._evaluator=new _c,this._defaultValue=l?"color"===(f=l).type&&(Pl(f.default)||Array.isArray(f.default))?new ds(0,0,0,0):"color"===f.type?ds.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(t,l,f,_,E,b,A,k){return this._evaluator.globals=t,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=_||null,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=k||null,this.expression.evaluate(this._evaluator)}evaluate(t,l,f,_,E,b,A,k){this._evaluator.globals=t,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=k||null;try{const F=this.expression.evaluate(this._evaluator);if(null==F||"number"==typeof F&&F!=F)return this._defaultValue;if(this._enumValues&&!(F in this._enumValues))throw new hs(`Expected value to be one of ${Object.keys(this._enumValues).map(G=>JSON.stringify(G)).join(", ")}, but found ${JSON.stringify(F)} instead.`);return F}catch(F){return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(F.message)),this._defaultValue}}}function ke(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in ql}function ie(o,t){const l=new _a(ql,[],t?function(_){const E={color:Ci,string:ti,number:gr,enum:ti,boolean:qr,formatted:Mo,resolvedImage:bs};return"array"===_.type?Gi(E[_.value]||br,_.length):E[_.type]}(t):void 0),f=l.parse(o,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return f?Rl(new W(f,t)):ho(l.errors)}class be{constructor(t,l){this.kind=t,this._styleExpression=l,this.isStateDependent="constant"!==t&&!Sa(l.expression)}evaluateWithoutErrorHandling(t,l,f,_,E,b){return this._styleExpression.evaluateWithoutErrorHandling(t,l,f,_,E,b)}evaluate(t,l,f,_,E,b){return this._styleExpression.evaluate(t,l,f,_,E,b)}}class wt{constructor(t,l,f,_){this.kind=t,this.zoomStops=f,this._styleExpression=l,this.isStateDependent="camera"!==t&&!Sa(l.expression),this.interpolationType=_}evaluateWithoutErrorHandling(t,l,f,_,E,b){return this._styleExpression.evaluateWithoutErrorHandling(t,l,f,_,E,b)}evaluate(t,l,f,_,E,b){return this._styleExpression.evaluate(t,l,f,_,E,b)}interpolationFactor(t,l,f){return this.interpolationType?Ca.interpolationFactor(this.interpolationType,t,l,f):0}}function _n(o,t){if("error"===(o=ie(o,t)).result)return o;const l=o.value.expression,f=Ua(l);if(!f&&!$a(t))return ho([new li("","data expressions not supported")]);const _=ro(l,["zoom","pitch","distance-from-center"]);if(!_&&!wc(t))return ho([new li("","zoom expressions not supported")]);const E=Ar(l);return E||_?E instanceof li?ho([E]):E instanceof Ca&&!io(t)?ho([new li("",'"interpolate" expressions cannot be used with this property')]):Rl(E?new wt(f?"camera":"composite",o.value,E.labels,E instanceof Ca?E.interpolation:void 0):new be(f?"constant":"source",o.value)):ho([new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Gn{constructor(t,l){this._parameters=t,this._specification=l,On(this,la(this._parameters,this._specification))}static deserialize(t){return new Gn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Ar(o){let t=null;if(o instanceof ic)t=Ar(o.result);else if(o instanceof vc){for(const l of o.args)if(t=Ar(l),t)break}else(o instanceof za||o instanceof Ca)&&o.input instanceof qo&&"zoom"===o.input.name&&(t=o);return t instanceof li||o.eachChild(l=>{const f=Ar(l);f instanceof li?t=f:!t&&f?t=new li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&f&&t!==f&&(t=new li("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class Xn{constructor(t,l,f,_){this.message=(t?`${t}: `:"")+f,_&&(this.identifier=_),null!=l&&l.__line__&&(this.line=l.__line__)}}function Qr(o){const t=o.key,l=o.value,f=o.valueSpec||{},_=o.objectElementValidators||{},E=o.style,b=o.styleSpec;let A=[];const k=as(l);if("object"!==k)return[new Xn(t,l,`object expected, ${k} found`)];for(const F in l){const G=F.split(".")[0];let J;_[G]?J=_[G]:f[G]?J=vo:_["*"]?J=_["*"]:f["*"]&&(J=vo),J?A=A.concat(J({key:(t&&`${t}.`)+F,value:l[F],valueSpec:f[G]||f["*"],style:E,styleSpec:b,object:l,objectKey:F},l)):A.push(new Xn(t,l[F],`unknown property "${F}"`))}for(const F in f)_[F]||f[F].required&&void 0===f[F].default&&void 0===l[F]&&A.push(new Xn(t,l,`missing required property "${F}"`));return A}function zs(o){const t=o.value,l=o.valueSpec,f=o.style,_=o.styleSpec,E=o.key,b=o.arrayElementValidator||vo;if("array"!==as(t))return[new Xn(E,t,`array expected, ${as(t)} found`)];if(l.length&&t.length!==l.length)return[new Xn(E,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new Xn(E,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};_.$version<7&&(A.function=l.function),"object"===as(l.value)&&(A=l.value);let k=[];for(let F=0;F<t.length;F++)k=k.concat(b({array:t,arrayIndex:F,value:t[F],valueSpec:A,style:f,styleSpec:_,key:`${E}[${F}]`}));return k}function Wi(o){const t=o.key,l=o.value,f=o.valueSpec;let _=as(l);if("number"===_&&l!=l&&(_="NaN"),"number"!==_)return[new Xn(t,l,`number expected, ${_} found`)];if("minimum"in f){let E=f.minimum;if("array"===as(f.minimum)&&(E=f.minimum[o.arrayIndex]),l<E)return[new Xn(t,l,`${l} is less than the minimum value ${E}`)]}if("maximum"in f){let E=f.maximum;if("array"===as(f.maximum)&&(E=f.maximum[o.arrayIndex]),l>E)return[new Xn(t,l,`${l} is greater than the maximum value ${E}`)]}return[]}function fs(o){const t=o.valueSpec,l=sr(o.value.type);let f,_,E,b={};const A="categorical"!==l&&void 0===o.value.property,k=!A,F="array"===as(o.value.stops)&&"array"===as(o.value.stops[0])&&"object"===as(o.value.stops[0][0]),G=Qr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(le){if("identity"===l)return[new Xn(le.key,le.value,'identity function may not have a "stops" property')];let de=[];const Se=le.value;return de=de.concat(zs({key:le.key,value:Se,valueSpec:le.valueSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:J})),"array"===as(Se)&&0===Se.length&&de.push(new Xn(le.key,Se,"array must have at least one stop")),de},default:function(le){return vo({key:le.key,value:le.value,valueSpec:t,style:le.style,styleSpec:le.styleSpec})}}});return"identity"===l&&A&&G.push(new Xn(o.key,o.value,'missing required property "property"')),"identity"===l||o.value.stops||G.push(new Xn(o.key,o.value,'missing required property "stops"')),"exponential"===l&&o.valueSpec.expression&&!io(o.valueSpec)&&G.push(new Xn(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(k&&!$a(o.valueSpec)?G.push(new Xn(o.key,o.value,"property functions not supported")):A&&!wc(o.valueSpec)&&G.push(new Xn(o.key,o.value,"zoom functions not supported"))),"categorical"!==l&&!F||void 0!==o.value.property||G.push(new Xn(o.key,o.value,'"property" property is required')),G;function J(le){let de=[];const Se=le.value,tt=le.key;if("array"!==as(Se))return[new Xn(tt,Se,`array expected, ${as(Se)} found`)];if(2!==Se.length)return[new Xn(tt,Se,`array length 2 expected, length ${Se.length} found`)];if(F){if("object"!==as(Se[0]))return[new Xn(tt,Se,`object expected, ${as(Se[0])} found`)];if(void 0===Se[0].zoom)return[new Xn(tt,Se,"object stop key must have zoom")];if(void 0===Se[0].value)return[new Xn(tt,Se,"object stop key must have value")];const _t=sr(Se[0].zoom);if("number"!=typeof _t)return[new Xn(tt,Se[0].zoom,"stop zoom values must be numbers")];if(E&&E>_t)return[new Xn(tt,Se[0].zoom,"stop zoom values must appear in ascending order")];_t!==E&&(E=_t,_=void 0,b={}),de=de.concat(Qr({key:`${tt}[0]`,value:Se[0],valueSpec:{zoom:{}},style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:Wi,value:ne}}))}else de=de.concat(ne({key:`${tt}[0]`,value:Se[0],valueSpec:{},style:le.style,styleSpec:le.styleSpec},Se));return ke(ei(Se[1]))?de.concat([new Xn(`${tt}[1]`,Se[1],"expressions are not allowed in function stops.")]):de.concat(vo({key:`${tt}[1]`,value:Se[1],valueSpec:t,style:le.style,styleSpec:le.styleSpec}))}function ne(le,de){const Se=as(le.value),tt=sr(le.value),_t=null!==le.value?le.value:de;if(f){if(Se!==f)return[new Xn(le.key,_t,`${Se} stop domain type must match previous stop domain type ${f}`)]}else f=Se;if("number"!==Se&&"string"!==Se&&"boolean"!==Se&&"number"!=typeof tt&&"string"!=typeof tt&&"boolean"!=typeof tt)return[new Xn(le.key,_t,"stop domain value must be a number, string, or boolean")];if("number"!==Se&&"categorical"!==l){let At=`number expected, ${Se} found`;return $a(t)&&void 0===l&&(At+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xn(le.key,_t,At)]}return"categorical"!==l||"number"!==Se||"number"==typeof tt&&isFinite(tt)&&Math.floor(tt)===tt?"categorical"!==l&&"number"===Se&&"number"==typeof tt&&"number"==typeof _&&void 0!==_&&tt<_?[new Xn(le.key,_t,"stop domain values must appear in ascending order")]:(_=tt,"categorical"===l&&tt in b?[new Xn(le.key,_t,"stop domain values must be unique")]:(b[tt]=!0,[])):[new Xn(le.key,_t,`integer expected, found ${String(tt)}`)]}}function ji(o){const t=("property"===o.expressionContext?_n:ie)(ei(o.value),o.valueSpec);if("error"===t.result)return t.value.map(f=>new Xn(`${o.key}${f.key}`,o.value,f.message));const l=t.value.expression||t.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!l.outputDefined())return[new Xn(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Sa(l))return[new Xn(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return so(l,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!ro(l,["zoom","feature-state"]))return[new Xn(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!Ua(l))return[new Xn(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function so(o,t){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)l.delete(_);if(0===l.size)return[];const f=[];return o instanceof qo&&l.has(o.name)?[new Xn(t.key,t.value,`["${o.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(o.eachChild(_=>{f.push(...so(_,t))}),f)}function Jo(o){const t=o.key,l=o.value,f=o.valueSpec,_=[];return Array.isArray(f.values)?-1===f.values.indexOf(sr(l))&&_.push(new Xn(t,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(f.values).indexOf(sr(l))&&_.push(new Xn(t,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function xs(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const t of o.slice(1))if(!xs(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function lr(o,t="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xs(o)||(o=qi(o));const l=o;let f=!0;try{f=function(F){if(!Ni(F))return F;let G=ei(F);return Di(G),G=Kr(G),G}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const _=bt[`filter_${t}`],E=ie(f,_);let b=null;if("error"===E.result)throw new Error(E.value.map(F=>`${F.key}: ${F.message}`).join(", "));b=(F,G,J)=>E.value.evaluate(F,G,{},J);let A=null,k=null;if(f!==l){const F=ie(l,_);if("error"===F.result)throw new Error(F.value.map(G=>`${G.key}: ${G.message}`).join(", "));A=(G,J,ne,le,de)=>F.value.evaluate(G,J,{},ne,void 0,void 0,le,de),k=!Ua(F.value.expression)}return{filter:b,dynamicFilter:A||void 0,needGeometry:rl(f),needFeature:!!k}}function Kr(o){if(!Array.isArray(o))return o;const t=function(l){if(js.has(l[0]))for(let f=1;f<l.length;f++)if(Ni(l[f]))return!0;return l}(o);return!0===t?t:t.map(l=>Kr(l))}function Di(o){let t=!1;const l=[];if("case"===o[0]){for(let f=1;f<o.length-1;f+=2)t=t||Ni(o[f]),l.push(o[f+1]);l.push(o[o.length-1])}else if("match"===o[0]){t=t||Ni(o[1]);for(let f=2;f<o.length-1;f+=2)l.push(o[f+1]);l.push(o[o.length-1])}else if("step"===o[0]){t=t||Ni(o[1]);for(let f=1;f<o.length-1;f+=2)l.push(o[f+1])}t&&(o.length=0,o.push("any",...l));for(let f=1;f<o.length;f++)Di(o[f])}function Ni(o){if(!Array.isArray(o))return!1;if("pitch"===(t=o[0])||"distance-from-center"===t)return!0;var t;for(let l=1;l<o.length;l++)if(Ni(o[l]))return!0;return!1}const js=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ea(o,t){return o<t?-1:o>t?1:0}function rl(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let t=1;t<o.length;t++)if(rl(o[t]))return!0;return!1}function qi(o){if(!o)return!0;const t=o[0];return o.length<=1?"any"!==t:"=="===t?ca(o[1],o[2],"=="):"!="===t?dl(ca(o[1],o[2],"==")):"<"===t||">"===t||"<="===t||">="===t?ca(o[1],o[2],t):"any"===t?(l=o.slice(1),["any"].concat(l.map(qi))):"all"===t?["all"].concat(o.slice(1).map(qi)):"none"===t?["all"].concat(o.slice(1).map(qi).map(dl)):"in"===t?fo(o[1],o.slice(2)):"!in"===t?dl(fo(o[1],o.slice(2))):"has"===t?Si(o[1]):"!has"===t?dl(Si(o[1])):"within"!==t||o;var l}function ca(o,t,l){switch(o){case"$type":return[`filter-type-${l}`,t];case"$id":return[`filter-id-${l}`,t];default:return[`filter-${l}`,o,t]}}function fo(o,t){if(0===t.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(l=>typeof l!=typeof t[0])?["filter-in-large",o,["literal",t.sort(ea)]]:["filter-in-small",o,["literal",t]]}}function Si(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function dl(o){return["!",o]}function Kl(o){return xs(ei(o.value))?ji(On({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):Ol(o)}function Ol(o){const t=o.value,l=o.key;if("array"!==as(t))return[new Xn(l,t,`array expected, ${as(t)} found`)];const f=o.styleSpec;let _,E=[];if(t.length<1)return[new Xn(l,t,"filter array must have at least 1 element")];switch(E=E.concat(Jo({key:`${l}[0]`,value:t[0],valueSpec:f.filter_operator,style:o.style,styleSpec:o.styleSpec})),sr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===sr(t[1])&&E.push(new Xn(l,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&E.push(new Xn(l,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(_=as(t[1]),"string"!==_&&E.push(new Xn(`${l}[1]`,t[1],`string expected, ${_} found`)));for(let b=2;b<t.length;b++)_=as(t[b]),"$type"===sr(t[1])?E=E.concat(Jo({key:`${l}[${b}]`,value:t[b],valueSpec:f.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==_&&"number"!==_&&"boolean"!==_&&E.push(new Xn(`${l}[${b}]`,t[b],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)E=E.concat(Ol({key:`${l}[${b}]`,value:t[b],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":_=as(t[1]),2!==t.length?E.push(new Xn(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==_&&E.push(new Xn(`${l}[1]`,t[1],`string expected, ${_} found`));break;case"within":_=as(t[1]),2!==t.length?E.push(new Xn(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==_&&E.push(new Xn(`${l}[1]`,t[1],`object expected, ${_} found`))}return E}function Xs(o,t){const l=o.key,f=o.style,_=o.styleSpec,E=o.value,b=o.objectKey,A=_[`${t}_${o.layerType}`];if(!A)return[];const k=b.match(/^(.*)-transition$/);if("paint"===t&&k&&A[k[1]]&&A[k[1]].transition)return vo({key:l,value:E,valueSpec:_.transition,style:f,styleSpec:_});const F=o.valueSpec||A[b];if(!F)return[new Xn(l,E,`unknown property "${b}"`)];let G;if("string"===as(E)&&$a(F)&&!F.tokens&&(G=/^{([^}]+)}$/.exec(E))){const ne=`\`{ "type": "identity", "property": ${G?JSON.stringify(G[1]):'"_"'} }\``;return[new Xn(l,E,`"${b}" does not support interpolation syntax\nUse an identity property function instead: ${ne}.`)]}const J=[];return"symbol"===o.layerType&&("text-field"===b&&f&&!f.glyphs&&J.push(new Xn(l,E,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&Pl(ei(E))&&"identity"===sr(E.type)&&J.push(new Xn(l,E,'"text-font" does not support identity functions'))),J.concat(vo({key:o.key,value:E,valueSpec:F,style:f,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:b}))}function Rc(o){return Xs(o,"paint")}function Zl(o){return Xs(o,"layout")}function jo(o){let t=[];const l=o.value,f=o.key,_=o.style,E=o.styleSpec;l.type||l.ref||t.push(new Xn(f,l,'either "type" or "ref" is required'));let b=sr(l.type);const A=sr(l.ref);if(l.id){const k=sr(l.id);for(let F=0;F<o.arrayIndex;F++){const G=_.layers[F];sr(G.id)===k&&t.push(new Xn(f,l.id,`duplicate layer id "${l.id}", previously used at line ${G.id.__line__}`))}}if("ref"in l){let k;["type","source","source-layer","filter","layout"].forEach(F=>{F in l&&t.push(new Xn(f,l[F],`"${F}" is prohibited for ref layers`))}),_.layers.forEach(F=>{sr(F.id)===A&&(k=F)}),k?k.ref?t.push(new Xn(f,l.ref,"ref cannot reference another ref layer")):b=sr(k.type):"string"==typeof A&&t.push(new Xn(f,l.ref,`ref layer "${A}" not found`))}else if("background"!==b&&"sky"!==b)if(l.source){const k=_.sources&&_.sources[l.source],F=k&&sr(k.type);k?"vector"===F&&"raster"===b?t.push(new Xn(f,l.source,`layer "${l.id}" requires a raster source`)):"raster"===F&&"raster"!==b?t.push(new Xn(f,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==F||l["source-layer"]?"raster-dem"===F&&"hillshade"!==b?t.push(new Xn(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===F&&k.lineMetrics||t.push(new Xn(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Xn(f,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new Xn(f,l.source,`source "${l.source}" not found`))}else t.push(new Xn(f,l,'missing required property "source"'));return t=t.concat(Qr({key:f,value:l,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>vo({key:`${f}.type`,value:l.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:l,objectKey:"type"}),filter:k=>Kl(On({layerType:b},k)),layout:k=>Qr({layer:l,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":F=>Zl(On({layerType:b},F))}}),paint:k=>Qr({layer:l,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":F=>Rc(On({layerType:b},F))}})}})),t}function Ga(o){const t=o.value,l=o.key,f=as(t);return"string"!==f?[new Xn(l,t,`string expected, ${f} found`)]:[]}const ju={promoteId:function({key:o,value:t}){if("string"===as(t))return Ga({key:o,value:t});{const l=[];for(const f in t)l.push(...Ga({key:`${o}.${f}`,value:t[f]}));return l}}};function fa(o){const t=o.value,l=o.key,f=o.styleSpec,_=o.style;if(!t.type)return[new Xn(l,t,'"type" is required')];const E=sr(t.type);let b;switch(E){case"vector":case"raster":case"raster-dem":return b=Qr({key:l,value:t,valueSpec:f[`source_${E.replace("-","_")}`],style:o.style,styleSpec:f,objectElementValidators:ju}),b;case"geojson":if(b=Qr({key:l,value:t,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:ju}),t.cluster)for(const A in t.clusterProperties){const[k,F]=t.clusterProperties[A],G="string"==typeof k?[k,["accumulated"],["get",A]]:k;b.push(...ji({key:`${l}.${A}.map`,value:F,expressionContext:"cluster-map"})),b.push(...ji({key:`${l}.${A}.reduce`,value:G,expressionContext:"cluster-reduce"}))}return b;case"video":return Qr({key:l,value:t,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return Qr({key:l,value:t,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new Xn(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jo({key:`${l}.type`,value:t.type,valueSpec:{values:hl(f)},style:_,styleSpec:f})}}function hl(o){return o.source.reduce((t,l)=>{const f=o[l];return"enum"===f.type.type&&(t=t.concat(Object.keys(f.type.values))),t},[])}function Ss(o){const t=o.value,l=o.styleSpec,f=l.light,_=o.style;let E=[];const b=as(t);if(void 0===t)return E;if("object"!==b)return E=E.concat([new Xn("light",t,`object expected, ${b} found`)]),E;for(const A in t){const k=A.match(/^(.*)-transition$/);E=E.concat(k&&f[k[1]]&&f[k[1]].transition?vo({key:A,value:t[A],valueSpec:l.transition,style:_,styleSpec:l}):f[A]?vo({key:A,value:t[A],valueSpec:f[A],style:_,styleSpec:l}):[new Xn(A,t[A],`unknown property "${A}"`)])}return E}function Oi(o){const t=o.value,l=o.key,f=o.style,_=o.styleSpec,E=_.terrain;let b=[];const A=as(t);if(void 0===t)return b;if("object"!==A)return b=b.concat([new Xn("terrain",t,`object expected, ${A} found`)]),b;for(const k in t){const F=k.match(/^(.*)-transition$/);b=b.concat(F&&E[F[1]]&&E[F[1]].transition?vo({key:k,value:t[k],valueSpec:_.transition,style:f,styleSpec:_}):E[k]?vo({key:k,value:t[k],valueSpec:E[k],style:f,styleSpec:_}):[new Xn(k,t[k],`unknown property "${k}"`)])}if(t.source){const k=f.sources&&f.sources[t.source],F=k&&sr(k.type);k?"raster-dem"!==F&&b.push(new Xn(l,t.source,`terrain cannot be used with a source of type ${String(F)}, it only be used with a "raster-dem" source type`)):b.push(new Xn(l,t.source,`source "${t.source}" not found`))}else b.push(new Xn(l,t,'terrain is missing required property "source"'));return b}function cc(o){const t=o.value,l=o.style,f=o.styleSpec,_=f.fog;let E=[];const b=as(t);if(void 0===t)return E;if("object"!==b)return E=E.concat([new Xn("fog",t,`object expected, ${b} found`)]),E;for(const A in t){const k=A.match(/^(.*)-transition$/);E=E.concat(k&&_[k[1]]&&_[k[1]].transition?vo({key:A,value:t[A],valueSpec:f.transition,style:l,styleSpec:f}):_[A]?vo({key:A,value:t[A],valueSpec:_[A],style:l,styleSpec:f}):[new Xn(A,t[A],`unknown property "${A}"`)])}return E}const ta={"*":()=>[],array:zs,boolean:function(o){const t=o.value,l=o.key,f=as(t);return"boolean"!==f?[new Xn(l,t,`boolean expected, ${f} found`)]:[]},number:Wi,color:function(o){const t=o.key,l=o.value,f=as(l);return"string"!==f?[new Xn(t,l,`color expected, ${f} found`)]:null===gc(l)?[new Xn(t,l,`color expected, "${l}" found`)]:[]},enum:Jo,filter:Kl,function:fs,layer:jo,object:Qr,source:fa,light:Ss,terrain:Oi,fog:cc,string:Ga,formatted:function(o){return 0===Ga(o).length?[]:ji(o)},resolvedImage:function(o){return 0===Ga(o).length?[]:ji(o)},projection:function(o){const t=o.value,l=o.styleSpec,f=l.projection,_=o.style;let E=[];const b=as(t);if("object"===b)for(const A in t)E=E.concat(vo({key:A,value:t[A],valueSpec:f[A],style:_,styleSpec:l}));else"string"!==b&&(E=E.concat([new Xn("projection",t,`object or string expected, ${b} found`)]));return E}};function vo(o){const t=o.value,l=o.valueSpec,f=o.styleSpec;return l.expression&&Pl(sr(t))?fs(o):l.expression&&ke(ei(t))?ji(o):l.type&&ta[l.type]?ta[l.type](o):Qr(On({},o,{valueSpec:l.type?f[l.type]:l}))}function zn(o){const t=o.value,l=o.key,f=Ga(o);return f.length||(-1===t.indexOf("{fontstack}")&&f.push(new Xn(l,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&f.push(new Xn(l,t,'"glyphs" url must include a "{range}" token'))),f}function Gs(o,t=bt){return pr(vo({key:"",value:o,valueSpec:t.$root,styleSpec:t,style:o,objectElementValidators:{glyphs:zn,"*":()=>[]}}))}const As=o=>pr(Rc(o)),fu=o=>pr(Zl(o));function pr(o){return o.slice().sort((t,l)=>t.line&&l.line?t.line-l.line:0)}function zr(o,t){let l=!1;if(t&&t.length)for(const f of t)o.fire(new Nt(new Error(f.message))),l=!0;return l}var $u=xn,dr=3;function xn(o,t,l){var f=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var _=new Int32Array(this.arrayBuffer);o=_[0],this.d=(t=_[1])+2*(l=_[2]);for(var E=0;E<this.d*this.d;E++){var b=_[dr+E],A=_[dr+E+1];f.push(b===A?null:_.subarray(b,A))}var k=_[dr+f.length+1];this.keys=_.subarray(_[dr+f.length],k),this.bboxes=_.subarray(k),this.insert=this._insertReadonly}else{this.d=t+2*l;for(var F=0;F<this.d*this.d;F++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=o,this.padding=l,this.scale=t/o,this.uid=0;var G=l/t*o;this.min=-G,this.max=o+G}xn.prototype.insert=function(o,t,l,f,_){this._forEachCell(t,l,f,_,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(t),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(_)},xn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xn.prototype._insertCell=function(o,t,l,f,_,E){this.cells[_].push(E)},xn.prototype.query=function(o,t,l,f,_){var E=this.min,b=this.max;if(o<=E&&t<=E&&b<=l&&b<=f&&!_)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(o,t,l,f,this._queryCell,A,{},_),A},xn.prototype._queryCell=function(o,t,l,f,_,E,b,A){var k=this.cells[_];if(null!==k)for(var F=this.keys,G=this.bboxes,J=0;J<k.length;J++){var ne=k[J];if(void 0===b[ne]){var le=4*ne;(A?A(G[le+0],G[le+1],G[le+2],G[le+3]):o<=G[le+2]&&t<=G[le+3]&&l>=G[le+0]&&f>=G[le+1])?(b[ne]=!0,E.push(F[ne])):b[ne]=!1}}},xn.prototype._forEachCell=function(o,t,l,f,_,E,b,A){for(var k=this._convertToCellCoord(o),F=this._convertToCellCoord(t),G=this._convertToCellCoord(l),J=this._convertToCellCoord(f),ne=k;ne<=G;ne++)for(var le=F;le<=J;le++){var de=this.d*le+ne;if((!A||A(this._convertFromCellCoord(ne),this._convertFromCellCoord(le),this._convertFromCellCoord(ne+1),this._convertFromCellCoord(le+1)))&&_.call(this,o,t,l,f,de,E,b,A))return}},xn.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},xn.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},xn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,t=dr+this.cells.length+1+1,l=0,f=0;f<this.cells.length;f++)l+=this.cells[f].length;var _=new Int32Array(t+l+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var E=t,b=0;b<o.length;b++){var A=o[b];_[dr+b]=E,_.set(A,E),E+=A.length}return _[dr+o.length]=E,_.set(this.keys,E),_[dr+o.length+1]=E+=this.keys.length,_.set(this.bboxes,E),E+=this.bboxes.length,_.buffer};var Un=ht($u);const Ao={};function Cr(o,t,l={}){Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Ao[t]={klass:o,omit:l.omit||[]}}Cr(Object,"Object"),Un.serialize=function(o,t){const l=o.toArrayBuffer();return t&&t.push(l),{buffer:l}},Un.deserialize=function(o){return new Un(o.buffer)},Object.defineProperty(Un,"name",{value:"Grid"}),Cr(Un,"Grid"),Cr(ds,"Color"),Cr(Error,"Error"),Cr($r,"AJAXError"),Cr(Ro,"ResolvedImage"),Cr(Gn,"StylePropertyFunction"),Cr(W,"StyleExpression",{omit:["_evaluator"]}),Cr(wt,"ZoomDependentExpression"),Cr(be,"ZoomConstantExpression"),Cr(qo,"CompoundExpression",{omit:["_evaluate"]});for(const o in ql)Ao[ql[o]._classRegistryKey]||Cr(ql[o],`Expression${o}`);function pu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function $c(o){return ae.ImageBitmap&&o instanceof ae.ImageBitmap}function bc(o,t){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(pu(o)||$c(o))return t&&t.push(o),o;if(ArrayBuffer.isView(o)){const l=o;return t&&t.push(l.buffer),l}if(o instanceof ae.ImageData)return t&&t.push(o.data.buffer),o;if(Array.isArray(o)){const l=[];for(const f of o)l.push(bc(f,t));return l}if("object"==typeof o){const l=o.constructor,f=l._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const _=l.serialize?l.serialize(o,t):{};if(!l.serialize){for(const E in o)o.hasOwnProperty(E)&&(Ao[f].omit.indexOf(E)>=0||(_[E]=bc(o[E],t)));o instanceof Error&&(_.message=o.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(_.$name=f),_}throw new Error("can't serialize object of type "+typeof o)}function uc(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||pu(o)||$c(o)||ArrayBuffer.isView(o)||o instanceof ae.ImageData)return o;if(Array.isArray(o))return o.map(uc);if("object"==typeof o){const t=o.$name||"Object",{klass:l}=Ao[t];if(!l)throw new Error(`can't deserialize unregistered class ${t}`);if(l.deserialize)return l.deserialize(o);const f=Object.create(l.prototype);for(const _ of Object.keys(o))"$name"!==_&&(f[_]=uc(o[_]));return f}throw new Error("can't deserialize object of type "+typeof o)}const vr={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Su(o){for(const t of o)if(Gu(t.charCodeAt(0)))return!0;return!1}function _d(o){for(const t of o)if(!yd(t.charCodeAt(0)))return!1;return!0}function yd(o){return!(vr.Arabic(o)||vr["Arabic Supplement"](o)||vr["Arabic Extended-A"](o)||vr["Arabic Presentation Forms-A"](o)||vr["Arabic Presentation Forms-B"](o))}function Gu(o){return!(746!==o&&747!==o&&(o<4352||!(vr["Bopomofo Extended"](o)||vr.Bopomofo(o)||vr["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||vr["CJK Compatibility Ideographs"](o)||vr["CJK Compatibility"](o)||vr["CJK Radicals Supplement"](o)||vr["CJK Strokes"](o)||!(!vr["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||vr["CJK Unified Ideographs Extension A"](o)||vr["CJK Unified Ideographs"](o)||vr["Enclosed CJK Letters and Months"](o)||vr["Hangul Compatibility Jamo"](o)||vr["Hangul Jamo Extended-A"](o)||vr["Hangul Jamo Extended-B"](o)||vr["Hangul Jamo"](o)||vr["Hangul Syllables"](o)||vr.Hiragana(o)||vr["Ideographic Description Characters"](o)||vr.Kanbun(o)||vr["Kangxi Radicals"](o)||vr["Katakana Phonetic Extensions"](o)||vr.Katakana(o)&&12540!==o||!(!vr["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!vr["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||vr["Unified Canadian Aboriginal Syllabics"](o)||vr["Unified Canadian Aboriginal Syllabics Extended"](o)||vr["Vertical Forms"](o)||vr["Yijing Hexagram Symbols"](o)||vr["Yi Syllables"](o)||vr["Yi Radicals"](o))))}function td(o){return!(Gu(o)||(t=o,vr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||vr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||vr["Letterlike Symbols"](t)||vr["Number Forms"](t)||vr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||vr["Control Pictures"](t)&&9251!==t||vr["Optical Character Recognition"](t)||vr["Enclosed Alphanumerics"](t)||vr["Geometric Shapes"](t)||vr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||vr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vr["CJK Symbols and Punctuation"](t)||vr.Katakana(t)||vr["Private Use Area"](t)||vr["CJK Compatibility Forms"](t)||vr["Small Form Variants"](t)||vr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t));var t}function Qi(o){return o>=1424&&o<=2303||vr["Arabic Presentation Forms-A"](o)||vr["Arabic Presentation Forms-B"](o)}function Pc(o,t){return!(!t&&Qi(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||vr.Khmer(o))}function nh(o){for(const t of o)if(Qi(t.charCodeAt(0)))return!0;return!1}const Oo="deferred",pi="loading",Au="loaded";let Z=null,c="unavailable",n=null;const a=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(c="error"),Z&&Z(o)};function p(){y.fire(new Dt("pluginStateChange",{pluginStatus:c,pluginURL:n}))}const y=new wn,w=function(){return c},C=function(){if(c!==Oo||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");c=pi,p(),n&&Fs({url:n},o=>{o?a(o):(c=Au,p())})},P={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>c===Au||null!=P.applyArabicShaping,isLoading:()=>c===pi,setState(o){c=o.pluginStatus,n=o.pluginURL},isParsed:()=>null!=P.applyArabicShaping&&null!=P.processBidirectionalText&&null!=P.processStyledBidirectionalText,getPluginURL:()=>n};class V{constructor(t,l){this.zoom=t,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(l,f){for(const _ of l)if(!Pc(_.charCodeAt(0),f))return!1;return!0}(t,P.isLoaded())}}class K{constructor(t,l){this.property=t,this.value=l,this.expression=function(f,_){if(Pl(f))return new Gn(f,_);if(ke(f)){const E=_n(f,_);if("error"===E.result)throw new Error(E.value.map(b=>`${b.key}: ${b.message}`).join(", "));return E.value}{let E=f;return"string"==typeof f&&"color"===_.type&&(E=ds.parse(f)),{kind:"constant",evaluate:()=>E}}}(void 0===l?t.specification.default:l,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,l,f){return this.property.possiblyEvaluate(this,t,l,f)}}class Y{constructor(t){this.property=t,this.value=new K(t,void 0)}transitioned(t,l){return new Pe(this.property,this.value,l,Qe({},t.transition,this.transition),t.now)}untransitioned(){return new Pe(this.property,this.value,null,{},0)}}class ce{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Or(this._values[t].value.value)}setValue(t,l){this._values.hasOwnProperty(t)||(this._values[t]=new Y(this._values[t].property)),this._values[t].value=new K(this._values[t].property,null===l?void 0:Or(l))}getTransition(t){return Or(this._values[t].transition)}setTransition(t,l){this._values.hasOwnProperty(t)||(this._values[t]=new Y(this._values[t].property)),this._values[t].transition=Or(l)||void 0}serialize(){const t={};for(const l of Object.keys(this._values)){const f=this.getValue(l);void 0!==f&&(t[l]=f);const _=this.getTransition(l);void 0!==_&&(t[`${l}-transition`]=_)}return t}transitioned(t,l){const f=new Ke(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(t,l._values[_]);return f}untransitioned(){const t=new Ke(this._properties);for(const l of Object.keys(this._values))t._values[l]=this._values[l].untransitioned();return t}}class Pe{constructor(t,l,f,_,E){const b=_.delay||0,A=_.duration||0;E=E||0,this.property=t,this.value=l,this.begin=E+b,this.end=this.begin+A,t.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(t,l,f){const _=t.now||0,E=this.value.possiblyEvaluate(t,l,f),b=this.prior;if(b){if(_>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(_<this.begin)return b.possiblyEvaluate(t,l,f);{const A=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,l,f),E,nn(A))}}return E}}class Ke{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,l,f){const _=new ot(this._properties);for(const E of Object.keys(this._values))_._values[E]=this._values[E].possiblyEvaluate(t,l,f);return _}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ye{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Or(this._values[t].value)}setValue(t,l){this._values[t]=new K(this._values[t].property,null===l?void 0:Or(l))}serialize(){const t={};for(const l of Object.keys(this._values)){const f=this.getValue(l);void 0!==f&&(t[l]=f)}return t}possiblyEvaluate(t,l,f){const _=new ot(this._properties);for(const E of Object.keys(this._values))_._values[E]=this._values[E].possiblyEvaluate(t,l,f);return _}}class rt{constructor(t,l,f){this.property=t,this.value=l,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,l,f,_){return this.property.evaluate(this.value,this.parameters,t,l,f,_)}}class ot{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class pe{constructor(t){this.specification=t}possiblyEvaluate(t,l){return t.expression.evaluate(l)}interpolate(t,l,f){const _=ll[this.specification.type];return _?_(t,l,f):t}}class he{constructor(t,l){this.specification=t,this.overrides=l}possiblyEvaluate(t,l,f,_){return new rt(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(l,null,{},f,_)}:t.expression,l)}interpolate(t,l,f){if("constant"!==t.value.kind||"constant"!==l.value.kind)return t;if(void 0===t.value.value||void 0===l.value.value)return new rt(this,{kind:"constant",value:void 0},t.parameters);const _=ll[this.specification.type];return _?new rt(this,{kind:"constant",value:_(t.value.value,l.value.value,f)},t.parameters):t}evaluate(t,l,f,_,E,b){return"constant"===t.kind?t.value:t.evaluate(l,f,_,E,b)}}class gt{constructor(t){this.specification=t}possiblyEvaluate(t,l,f,_){return!!t.expression.evaluate(l,null,{},f,_)}interpolate(){return!1}}class mt{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new V(0,{});for(const f in t){const _=t[f];_.specification.overridable&&this.overridableProperties.push(f);const E=this.defaultPropertyValues[f]=new K(_,void 0),b=this.defaultTransitionablePropertyValues[f]=new Y(_);this.defaultTransitioningPropertyValues[f]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=E.possiblyEvaluate(l)}}}function Ut(o,t){return 256*(o=qt(Math.floor(o),0,255))+qt(Math.floor(t),0,255)}Cr(he,"DataDrivenProperty"),Cr(pe,"DataConstantProperty"),Cr(gt,"ColorRampProperty");const jt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class It{constructor(t,l){this._structArray=t,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class tn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,l){return t._trim(),l&&(t.isTransferred=!0,l.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const l=Object.create(this.prototype);return l.arrayBuffer=t.arrayBuffer,l.length=t.length,l.capacity=t.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Kt(o,t=1){let l=0,f=0;return{members:o.map(_=>{const E=jt[_.type].BYTES_PER_ELEMENT,b=l=ln(l,Math.max(t,E)),A=_.components||1;return f=Math.max(f,E),l+=E*A,{name:_.name,type:_.type,components:A,offset:b}}),size:ln(l,Math.max(f,t)),alignment:t}}function ln(o,t){return Math.ceil(o/t)*t}class rr extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,l)}emplace(t,l,f){const _=2*t;return this.int16[_+0]=l,this.int16[_+1]=f,t}}rr.prototype.bytesPerElement=4,Cr(rr,"StructArrayLayout2i4");class cn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,l,f)}emplace(t,l,f,_){const E=3*t;return this.int16[E+0]=l,this.int16[E+1]=f,this.int16[E+2]=_,t}}cn.prototype.bytesPerElement=6,Cr(cn,"StructArrayLayout3i6");class Dn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,f,_)}emplace(t,l,f,_,E){const b=4*t;return this.int16[b+0]=l,this.int16[b+1]=f,this.int16[b+2]=_,this.int16[b+3]=E,t}}Dn.prototype.bytesPerElement=8,Cr(Dn,"StructArrayLayout4i8");class an extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,t,l,f,_,E,b,A)}emplace(t,l,f,_,E,b,A,k){const F=6*t,G=12*t,J=3*t;return this.int16[F+0]=l,this.int16[F+1]=f,this.uint8[G+4]=_,this.uint8[G+5]=E,this.uint8[G+6]=b,this.uint8[G+7]=A,this.float32[J+2]=k,t}}an.prototype.bytesPerElement=12,Cr(an,"StructArrayLayout2i4ub1f12");class Kn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,f,_)}emplace(t,l,f,_,E){const b=4*t;return this.float32[b+0]=l,this.float32[b+1]=f,this.float32[b+2]=_,this.float32[b+3]=E,t}}Kn.prototype.bytesPerElement=16,Cr(Kn,"StructArrayLayout4f16");class dn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E){const b=this.length;return this.resize(b+1),this.emplace(b,t,l,f,_,E)}emplace(t,l,f,_,E,b){const A=6*t,k=3*t;return this.uint16[A+0]=l,this.uint16[A+1]=f,this.uint16[A+2]=_,this.uint16[A+3]=E,this.float32[k+2]=b,t}}dn.prototype.bytesPerElement=12,Cr(dn,"StructArrayLayout4ui1f12");class Ln extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,f,_)}emplace(t,l,f,_,E){const b=4*t;return this.uint16[b+0]=l,this.uint16[b+1]=f,this.uint16[b+2]=_,this.uint16[b+3]=E,t}}Ln.prototype.bytesPerElement=8,Cr(Ln,"StructArrayLayout4ui8");class Nn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b){const A=this.length;return this.resize(A+1),this.emplace(A,t,l,f,_,E,b)}emplace(t,l,f,_,E,b,A){const k=6*t;return this.int16[k+0]=l,this.int16[k+1]=f,this.int16[k+2]=_,this.int16[k+3]=E,this.int16[k+4]=b,this.int16[k+5]=A,t}}Nn.prototype.bytesPerElement=12,Cr(Nn,"StructArrayLayout6i12");class Wn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b,A,k,F,G,J,ne){const le=this.length;return this.resize(le+1),this.emplace(le,t,l,f,_,E,b,A,k,F,G,J,ne)}emplace(t,l,f,_,E,b,A,k,F,G,J,ne,le){const de=12*t;return this.int16[de+0]=l,this.int16[de+1]=f,this.int16[de+2]=_,this.int16[de+3]=E,this.uint16[de+4]=b,this.uint16[de+5]=A,this.uint16[de+6]=k,this.uint16[de+7]=F,this.int16[de+8]=G,this.int16[de+9]=J,this.int16[de+10]=ne,this.int16[de+11]=le,t}}Wn.prototype.bytesPerElement=24,Cr(Wn,"StructArrayLayout4i4ui4i24");class Yn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b){const A=this.length;return this.resize(A+1),this.emplace(A,t,l,f,_,E,b)}emplace(t,l,f,_,E,b,A){const k=10*t,F=5*t;return this.int16[k+0]=l,this.int16[k+1]=f,this.int16[k+2]=_,this.float32[F+2]=E,this.float32[F+3]=b,this.float32[F+4]=A,t}}Yn.prototype.bytesPerElement=20,Cr(Yn,"StructArrayLayout3i3f20");class Xr extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint32[1*t+0]=l,t}}Xr.prototype.bytesPerElement=4,Cr(Xr,"StructArrayLayout1ul4");class bi extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b,A,k,F,G,J,ne,le){const de=this.length;return this.resize(de+1),this.emplace(de,t,l,f,_,E,b,A,k,F,G,J,ne,le)}emplace(t,l,f,_,E,b,A,k,F,G,J,ne,le,de){const Se=20*t,tt=10*t;return this.int16[Se+0]=l,this.int16[Se+1]=f,this.int16[Se+2]=_,this.int16[Se+3]=E,this.int16[Se+4]=b,this.float32[tt+3]=A,this.float32[tt+4]=k,this.float32[tt+5]=F,this.float32[tt+6]=G,this.int16[Se+14]=J,this.uint32[tt+8]=ne,this.uint16[Se+18]=le,this.uint16[Se+19]=de,t}}bi.prototype.bytesPerElement=40,Cr(bi,"StructArrayLayout5i4f1i1ul2ui40");class Br extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,t,l,f,_,E,b,A)}emplace(t,l,f,_,E,b,A,k){const F=8*t;return this.int16[F+0]=l,this.int16[F+1]=f,this.int16[F+2]=_,this.int16[F+4]=E,this.int16[F+5]=b,this.int16[F+6]=A,this.int16[F+7]=k,t}}Br.prototype.bytesPerElement=16,Cr(Br,"StructArrayLayout3i2i2i16");class R extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E){const b=this.length;return this.resize(b+1),this.emplace(b,t,l,f,_,E)}emplace(t,l,f,_,E,b){const A=4*t,k=8*t;return this.float32[A+0]=l,this.float32[A+1]=f,this.float32[A+2]=_,this.int16[k+6]=E,this.int16[k+7]=b,t}}R.prototype.bytesPerElement=16,Cr(R,"StructArrayLayout2f1f2i16");class L extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,f,_)}emplace(t,l,f,_,E){const b=12*t,A=3*t;return this.uint8[b+0]=l,this.uint8[b+1]=f,this.float32[A+1]=_,this.float32[A+2]=E,t}}L.prototype.bytesPerElement=12,Cr(L,"StructArrayLayout2ub2f12");class $ extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,l,f)}emplace(t,l,f,_){const E=3*t;return this.float32[E+0]=l,this.float32[E+1]=f,this.float32[E+2]=_,t}}$.prototype.bytesPerElement=12,Cr($,"StructArrayLayout3f12");class ee extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,l,f)}emplace(t,l,f,_){const E=3*t;return this.uint16[E+0]=l,this.uint16[E+1]=f,this.uint16[E+2]=_,t}}ee.prototype.bytesPerElement=6,Cr(ee,"StructArrayLayout3ui6");class Ee extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt,_t,At,yt,St,Ft){const kt=this.length;return this.resize(kt+1),this.emplace(kt,t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt,_t,At,yt,St,Ft)}emplace(t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt,_t,At,yt,St,Ft,kt){const yn=30*t,pn=15*t,Fn=60*t;return this.int16[yn+0]=l,this.int16[yn+1]=f,this.int16[yn+2]=_,this.float32[pn+2]=E,this.float32[pn+3]=b,this.uint16[yn+8]=A,this.uint16[yn+9]=k,this.uint32[pn+5]=F,this.uint32[pn+6]=G,this.uint32[pn+7]=J,this.uint16[yn+16]=ne,this.uint16[yn+17]=le,this.uint16[yn+18]=de,this.float32[pn+10]=Se,this.float32[pn+11]=tt,this.uint8[Fn+48]=_t,this.uint8[Fn+49]=At,this.uint8[Fn+50]=yt,this.uint32[pn+13]=St,this.int16[yn+28]=Ft,this.uint8[Fn+58]=kt,t}}Ee.prototype.bytesPerElement=60,Cr(Ee,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class st extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt,_t,At,yt,St,Ft,kt,yn,pn,Fn,or,En,$n,jn,tr){const cr=this.length;return this.resize(cr+1),this.emplace(cr,t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt,_t,At,yt,St,Ft,kt,yn,pn,Fn,or,En,$n,jn,tr)}emplace(t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt,_t,At,yt,St,Ft,kt,yn,pn,Fn,or,En,$n,jn,tr,cr){const Pn=38*t,Pr=19*t;return this.int16[Pn+0]=l,this.int16[Pn+1]=f,this.int16[Pn+2]=_,this.float32[Pr+2]=E,this.float32[Pr+3]=b,this.int16[Pn+8]=A,this.int16[Pn+9]=k,this.int16[Pn+10]=F,this.int16[Pn+11]=G,this.int16[Pn+12]=J,this.int16[Pn+13]=ne,this.uint16[Pn+14]=le,this.uint16[Pn+15]=de,this.uint16[Pn+16]=Se,this.uint16[Pn+17]=tt,this.uint16[Pn+18]=_t,this.uint16[Pn+19]=At,this.uint16[Pn+20]=yt,this.uint16[Pn+21]=St,this.uint16[Pn+22]=Ft,this.uint16[Pn+23]=kt,this.uint16[Pn+24]=yn,this.uint16[Pn+25]=pn,this.uint16[Pn+26]=Fn,this.uint16[Pn+27]=or,this.uint16[Pn+28]=En,this.uint32[Pr+15]=$n,this.float32[Pr+16]=jn,this.float32[Pr+17]=tr,this.float32[Pr+18]=cr,t}}st.prototype.bytesPerElement=76,Cr(st,"StructArrayLayout3i2f6i15ui1ul3f76");class Et extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.float32[1*t+0]=l,t}}Et.prototype.bytesPerElement=4,Cr(Et,"StructArrayLayout1f4");class en extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l,f,_,E){const b=this.length;return this.resize(b+1),this.emplace(b,t,l,f,_,E)}emplace(t,l,f,_,E,b){const A=5*t;return this.float32[A+0]=l,this.float32[A+1]=f,this.float32[A+2]=_,this.float32[A+3]=E,this.float32[A+4]=b,t}}en.prototype.bytesPerElement=20,Cr(en,"StructArrayLayout5f20");class Lt extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,t,l,f,_)}emplace(t,l,f,_,E){const b=6*t;return this.uint32[3*t+0]=l,this.uint16[b+2]=f,this.uint16[b+3]=_,this.uint16[b+4]=E,t}}Lt.prototype.bytesPerElement=12,Cr(Lt,"StructArrayLayout1ul3ui12");class gn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,l)}emplace(t,l,f){const _=2*t;return this.uint16[_+0]=l,this.uint16[_+1]=f,t}}gn.prototype.bytesPerElement=4,Cr(gn,"StructArrayLayout2ui4");class Rn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const l=this.length;return this.resize(l+1),this.emplace(l,t)}emplace(t,l){return this.uint16[1*t+0]=l,t}}Rn.prototype.bytesPerElement=2,Cr(Rn,"StructArrayLayout1ui2");class kn extends tn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,l)}emplace(t,l,f){const _=2*t;return this.float32[_+0]=l,this.float32[_+1]=f,t}}kn.prototype.bytesPerElement=8,Cr(kn,"StructArrayLayout2f8");class Bn extends It{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Bn.prototype.size=40;class Jn extends bi{get(t){return new Bn(this,t)}}Cr(Jn,"CollisionBoxArray");class er extends It{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}er.prototype.size=60;class Vr extends Ee{get(t){return new er(this,t)}}Cr(Vr,"PlacedSymbolArray");class ui extends It{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ui.prototype.size=76;class Yt extends st{get(t){return new ui(this,t)}}Cr(Yt,"SymbolInstanceArray");class Tr extends Et{getoffsetX(t){return this.float32[1*t+0]}}Cr(Tr,"GlyphOffsetArray");class Hs extends rr{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Cr(Hs,"SymbolLineVertexArray");class Ms extends It{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ms.prototype.size=12;class mi extends Lt{get(t){return new Ms(this,t)}}Cr(mi,"FeatureIndexArray");class Yr extends gn{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Cr(Yr,"FillExtrusionCentroidArray");const ri=Kt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Mi=Kt([{name:"a_dash",components:4,type:"Uint16"}]);var po={exports:{}},Yi=function(o,t){var l,f,_,E,b,A,k,F;for(f=o.length-(l=3&o.length),_=t,b=3432918353,A=461845907,F=0;F<f;)k=255&o.charCodeAt(F)|(255&o.charCodeAt(++F))<<8|(255&o.charCodeAt(++F))<<16|(255&o.charCodeAt(++F))<<24,++F,_=27492+(65535&(E=5*(65535&(_=(_^=k=(65535&(k=(k=(65535&k)*b+(((k>>>16)*b&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(k=0,l){case 3:k^=(255&o.charCodeAt(F+2))<<16;case 2:k^=(255&o.charCodeAt(F+1))<<8;case 1:_^=k=(65535&(k=(k=(65535&(k^=255&o.charCodeAt(F)))*b+(((k>>>16)*b&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295}return _^=o.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0},Qs=function(o,t){for(var l,f=o.length,_=t^f,E=0;f>=4;)l=1540483477*(65535&(l=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(l>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),f-=4,++E;switch(f){case 3:_^=(255&o.charCodeAt(E+2))<<16;case 2:_^=(255&o.charCodeAt(E+1))<<8;case 1:_=1540483477*(65535&(_^=255&o.charCodeAt(E)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};po.exports=Yi,po.exports.murmur3=Yi,po.exports.murmur2=Qs;var ko=ht(po.exports);class ps{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,l,f,_){this.ids.push(Ma(t)),this.positions.push(l,f,_)}getPositions(t){const l=Ma(t);let f=0,_=this.ids.length-1;for(;f<_;){const b=f+_>>1;this.ids[b]>=l?_=b:f=b+1}const E=[];for(;this.ids[f]===l;)E.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return E}static serialize(t,l){const f=new Float64Array(t.ids),_=new Uint32Array(t.positions);return xo(f,_,0,f.length-1),l&&l.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(t){const l=new ps;return l.ids=t.ids,l.positions=t.positions,l.indexed=!0,l}}function Ma(o){const t=+o;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:ko(String(o))}function xo(o,t,l,f){for(;l<f;){const _=o[l+f>>1];let E=l-1,b=f+1;for(;;){do{E++}while(o[E]<_);do{b--}while(o[b]>_);if(E>=b)break;oo(o,E,b),oo(t,3*E,3*b),oo(t,3*E+1,3*b+1),oo(t,3*E+2,3*b+2)}b-l<f-b?(xo(o,t,l,b),l=b+1):(xo(o,t,b+1,f),f=b)}}function oo(o,t,l){const f=o[t];o[t]=o[l],o[l]=f}Cr(ps,"FeaturePositionMap");class Ha{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,l),this.initialized=!0),!!this.location}}class Tc extends Ha{constructor(t){super(t),this.current=0}set(t,l,f){this.fetchUniformLocation(t,l)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class No extends Ha{constructor(t){super(t),this.current=[0,0,0,0]}set(t,l,f){this.fetchUniformLocation(t,l)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class fl extends Ha{constructor(t){super(t),this.current=ds.transparent}set(t,l,f){this.fetchUniformLocation(t,l)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const mu=new Float32Array(16),tu=new Float32Array(9),Cu=new Float32Array(4);function Nh(o){return[Ut(255*o.r,255*o.g),Ut(255*o.b,255*o.a)]}class mo{constructor(t,l,f){this.value=t,this.uniformNames=l.map(_=>`u_${_}`),this.type=f}setUniform(t,l,f,_,E){l.set(t,E,_.constantOr(this.value))}getBinding(t,l){return"color"===this.type?new fl(t):new Tc(t)}}class kl{constructor(t,l){this.uniformNames=l.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,l,f,_,E){const b="u_pattern"===E||"u_dash"===E?this.pattern:"u_pixel_ratio"===E?this.pixelRatio:null;b&&l.set(t,E,b)}getBinding(t,l){return"u_pattern"===l||"u_dash"===l?new No(t):new Tc(t)}}class Oc{constructor(t,l,f,_){this.expression=t,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(E=>({name:`a_${E}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,l,f,_,E,b){const A=this.paintVertexArray.length,k=this.expression.evaluate(new V(0),l,{},E,_,b);this.paintVertexArray.resize(t),this._setPaintValue(A,t,k)}updatePaintArray(t,l,f,_,E){const b=this.expression.evaluate({zoom:0},f,_,void 0,E);this._setPaintValue(t,l,b)}_setPaintValue(t,l,f){if("color"===this.type){const _=Nh(f);for(let E=t;E<l;E++)this.paintVertexArray.emplace(E,_[0],_[1])}else{for(let _=t;_<l;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pl{constructor(t,l,f,_,E,b){this.expression=t,this.uniformNames=l.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=l.map(A=>({name:`a_${A}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(t,l,f,_,E,b){const A=this.expression.evaluate(new V(this.zoom),l,{},E,_,b),k=this.expression.evaluate(new V(this.zoom+1),l,{},E,_,b),F=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(F,t,A,k)}updatePaintArray(t,l,f,_,E){const b=this.expression.evaluate({zoom:this.zoom},f,_,void 0,E),A=this.expression.evaluate({zoom:this.zoom+1},f,_,void 0,E);this._setPaintValue(t,l,b,A)}_setPaintValue(t,l,f,_){if("color"===this.type){const E=Nh(f),b=Nh(_);for(let A=t;A<l;A++)this.paintVertexArray.emplace(A,E[0],E[1],b[0],b[1])}else{for(let E=t;E<l;E++)this.paintVertexArray.emplace(E,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,l,f,_,E){const b=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,A=qt(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);l.set(t,E,A)}getBinding(t,l){return new Tc(t)}}class Nl{constructor(t,l,f,_,E){this.expression=t,this.layerId=E,this.paintVertexAttributes=("array"===f?Mi:ri).members;for(let b=0;b<l.length;++b);this.paintVertexArray=new _}populatePaintArray(t,l,f){const _=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(_,t,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(t,l,f,_,E,b){this._setPaintValues(t,l,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(t,l,f,_){if(!_||!f)return;const E=_[f];if(!E)return;const{tl:b,br:A,pixelRatio:k}=E;for(let F=t;F<l;F++)this.paintVertexArray.emplace(F,b[0],b[1],A[0],A[1],k)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ml{constructor(t,l,f=(()=>!0)){this.binders={},this._buffers=[];const _=[];for(const E in t.paint._values){if(!f(E))continue;const b=t.paint.get(E);if(!(b instanceof rt&&$a(b.property.specification)))continue;const A=Ra(E,t.type),k=b.value,F=b.property.specification.type,G=!!b.property.useIntegerZoom,J="line-dasharray"===E||E.endsWith("pattern"),ne="line-dasharray"===E&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==k.kind||ne)if("source"===k.kind||ne||J){const le=es(E,F,"source");this.binders[E]=J?new Nl(k,A,F,le,t.id):new Oc(k,A,F,le),_.push(`/a_${E}`)}else{const le=es(E,F,"composite");this.binders[E]=new pl(k,A,F,G,l,le),_.push(`/z_${E}`)}else this.binders[E]=J?new kl(k.value,A):new mo(k.value,A,F),_.push(`/u_${E}`)}this.cacheKey=_.sort().join("")}getMaxValue(t){const l=this.binders[t];return l instanceof Oc||l instanceof pl?l.maxValue:0}populatePaintArrays(t,l,f,_,E,b){for(const A in this.binders){const k=this.binders[A];(k instanceof Oc||k instanceof pl||k instanceof Nl)&&k.populatePaintArray(t,l,f,_,E,b)}}setConstantPatternPositions(t){for(const l in this.binders){const f=this.binders[l];f instanceof kl&&f.setConstantPatternPositions(t)}}updatePaintArrays(t,l,f,_,E,b){let A=!1;for(const k in t){const F=l.getPositions(k);for(const G of F){const J=f.feature(G.index);for(const ne in this.binders){const le=this.binders[ne];if((le instanceof Oc||le instanceof pl||le instanceof Nl)&&!0===le.expression.isStateDependent){const de=_.paint.get(ne);le.expression=de.value,le.updatePaintArray(G.start,G.end,J,t[k],E,b),A=!0}}}}return A}defines(){const t=[];for(const l in this.binders){const f=this.binders[l];(f instanceof mo||f instanceof kl)&&t.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return t}getBinderAttributes(){const t=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof Oc||f instanceof pl||f instanceof Nl)for(let _=0;_<f.paintVertexAttributes.length;_++)t.push(f.paintVertexAttributes[_].name)}return t}getBinderUniforms(){const t=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof mo||f instanceof kl||f instanceof pl)for(const _ of f.uniformNames)t.push(_)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const l=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof mo||_ instanceof kl||_ instanceof pl)for(const E of _.uniformNames)l.push({name:E,property:f,binding:_.getBinding(t,E)})}return l}setUniforms(t,l,f,_,E){for(const{name:b,property:A,binding:k}of f)this.binders[A].setUniform(t,k,E,_.get(A),b)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const l=this.binders[t];(l instanceof Oc||l instanceof pl||l instanceof Nl)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const l in this.binders){const f=this.binders[l];(f instanceof Oc||f instanceof pl||f instanceof Nl)&&f.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const l=this.binders[t];(l instanceof Oc||l instanceof pl||l instanceof Nl)&&l.destroy()}}}class pa{constructor(t,l,f=(()=>!0)){this.programConfigurations={};for(const _ of t)this.programConfigurations[_.id]=new ml(_,l,f);this.needsUpload=!1,this._featureMap=new ps,this._bufferOffset=0}populatePaintArrays(t,l,f,_,E,b,A){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(t,l,_,E,b,A);void 0!==l.id&&this._featureMap.add(l.id,f,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,l,f,_,E){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(t,this._featureMap,l,b,_,E)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Lh={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ra(o,t){return Lh[o]||[o.replace(`${t}-`,"").replace(/-/g,"_")]}const nu={"line-pattern":{source:dn,composite:dn},"fill-pattern":{source:dn,composite:dn},"fill-extrusion-pattern":{source:dn,composite:dn},"line-dasharray":{source:Ln,composite:Ln}},bo={color:{source:kn,composite:Kn},number:{source:Et,composite:kn}};function es(o,t,l){const f=nu[o];return f&&f[l]||bo[t][l]}Cr(mo,"ConstantBinder"),Cr(kl,"PatternConstantBinder"),Cr(Oc,"SourceExpressionBinder"),Cr(Nl,"PatternCompositeBinder"),Cr(pl,"CompositeExpressionBinder"),Cr(ml,"ProgramConfiguration",{omit:["_buffers"]}),Cr(pa,"ProgramConfigurationSet");const Ic="-transition";class rs extends wn{constructor(t,l){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),l.layout&&(this._unevaluatedLayout=new Ye(l.layout)),l.paint)){this._transitionablePaint=new ce(l.paint);for(const f in t.paint)this.setPaintProperty(f,t.paint[f],{validate:!1});for(const f in t.layout)this.setLayoutProperty(f,t.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ot(l.paint)}}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,l,f={}){null!=l&&this._validate(fu,`layers.${this.id}.layout.${t}`,t,l,f)||("visibility"!==t?this._unevaluatedLayout.setValue(t,l):this.visibility=l)}getPaintProperty(t){return Fr(t,Ic)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,l,f={}){if(null!=l&&this._validate(As,`layers.${this.id}.paint.${t}`,t,l,f))return!1;if(Fr(t,Ic))return this._transitionablePaint.setTransition(t.slice(0,-11),l||void 0),!1;{const _=this._transitionablePaint._values[t],E=_.value.isDataDriven(),b=_.value;this._transitionablePaint.setValue(t,l),this._handleSpecialPaintPropertyUpdate(t);const A=this._transitionablePaint._values[t].value,k=A.isDataDriven(),F=Fr(t,"pattern")||"line-dasharray"===t;return k||E||F||this._handleOverridablePaintPropertyUpdate(t,b,A)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,l,f){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,l){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,l)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),on(t,(l,f)=>!(void 0===l||"layout"===f&&!Object.keys(l).length||"paint"===f&&!Object.keys(l).length))}_validate(t,l,f,_,E={}){return(!E||!1!==E.validate)&&zr(this,t.call(Gs,{key:l,layerType:this.type,objectKey:f,value:_,styleSpec:bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const l=this.paint.get(t);if(l instanceof rt&&$a(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=lr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ru=Kt([{name:"a_pos",components:2,type:"Int16"}],4),To=Kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class go{constructor(t=[]){this.segments=t}prepareSegment(t,l,f,_){let E=this.segments[this.segments.length-1];return t>go.MAX_VERTEX_ARRAY_LENGTH&&ur(`Max vertices per segment is ${go.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!E||E.vertexLength+t>go.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==_)&&(E={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==_&&(E.sortKey=_),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const t of this.segments)for(const l in t.vaos)t.vaos[l].destroy()}static simpleSegment(t,l,f,_){return new go([{vertexOffset:t,primitiveOffset:l,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}go.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Cr(go,"SegmentVector");var ii=8192;class Ll{constructor(t,l){t&&(l?this.setSouthWest(t).setNorthEast(l):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ws?new Ws(t.lng,t.lat):Ws.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ws?new Ws(t.lng,t.lat):Ws.convert(t),this}extend(t){const l=this._sw,f=this._ne;let _,E;if(t instanceof Ws)_=t,E=t;else{if(!(t instanceof Ll))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ll.convert(t)):this.extend(Ws.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Ws.convert(t)):this;if(_=t._sw,E=t._ne,!_||!E)return this}return l||f?(l.lng=Math.min(_.lng,l.lng),l.lat=Math.min(_.lat,l.lat),f.lng=Math.max(E.lng,f.lng),f.lat=Math.max(E.lat,f.lat)):(this._sw=new Ws(_.lng,_.lat),this._ne=new Ws(E.lng,E.lat)),this}getCenter(){return new Ws((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ws(this.getWest(),this.getNorth())}getSouthEast(){return new Ws(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:l,lat:f}=Ws.convert(t);let _=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&_}static convert(t){return!t||t instanceof Ll?t:new Ll(t)}}var Fh=1e-6,Sc=typeof Float32Array<"u"?Float32Array:Array;function Vd(){var o=new Sc(9);return Sc!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Bh(o,t,l){var f=t[0],_=t[1],E=t[2],b=t[3],A=t[4],k=t[5],F=t[6],G=t[7],J=t[8],ne=l[0],le=l[1],de=l[2],Se=l[3],tt=l[4],_t=l[5],At=l[6],yt=l[7],St=l[8];return o[0]=ne*f+le*b+de*F,o[1]=ne*_+le*A+de*G,o[2]=ne*E+le*k+de*J,o[3]=Se*f+tt*b+_t*F,o[4]=Se*_+tt*A+_t*G,o[5]=Se*E+tt*k+_t*J,o[6]=At*f+yt*b+St*F,o[7]=At*_+yt*A+St*G,o[8]=At*E+yt*k+St*J,o}function $o(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Vh(o,t){var l=t[0],f=t[1],_=t[2],E=t[3],b=t[4],A=t[5],k=t[6],F=t[7],G=t[8],J=t[9],ne=t[10],le=t[11],de=t[12],Se=t[13],tt=t[14],_t=t[15],At=l*A-f*b,yt=l*k-_*b,St=l*F-E*b,Ft=f*k-_*A,kt=f*F-E*A,yn=_*F-E*k,pn=G*Se-J*de,Fn=G*tt-ne*de,or=G*_t-le*de,En=J*tt-ne*Se,$n=J*_t-le*Se,jn=ne*_t-le*tt,tr=At*jn-yt*$n+St*En+Ft*or-kt*Fn+yn*pn;return tr?(o[0]=(A*jn-k*$n+F*En)*(tr=1/tr),o[1]=(_*$n-f*jn-E*En)*tr,o[2]=(Se*yn-tt*kt+_t*Ft)*tr,o[3]=(ne*kt-J*yn-le*Ft)*tr,o[4]=(k*or-b*jn-F*Fn)*tr,o[5]=(l*jn-_*or+E*Fn)*tr,o[6]=(tt*St-de*yn-_t*yt)*tr,o[7]=(G*yn-ne*St+le*yt)*tr,o[8]=(b*$n-A*or+F*pn)*tr,o[9]=(f*or-l*$n-E*pn)*tr,o[10]=(de*kt-Se*St+_t*At)*tr,o[11]=(J*St-G*kt-le*At)*tr,o[12]=(A*Fn-b*En-k*pn)*tr,o[13]=(l*En-f*Fn+_*pn)*tr,o[14]=(Se*yt-de*Ft-tt*At)*tr,o[15]=(G*Ft-J*yt+ne*At)*tr,o):null}function Eo(o,t,l){var f=t[0],_=t[1],E=t[2],b=t[3],A=t[4],k=t[5],F=t[6],G=t[7],J=t[8],ne=t[9],le=t[10],de=t[11],Se=t[12],tt=t[13],_t=t[14],At=t[15],yt=l[0],St=l[1],Ft=l[2],kt=l[3];return o[0]=yt*f+St*A+Ft*J+kt*Se,o[1]=yt*_+St*k+Ft*ne+kt*tt,o[2]=yt*E+St*F+Ft*le+kt*_t,o[3]=yt*b+St*G+Ft*de+kt*At,o[4]=(yt=l[4])*f+(St=l[5])*A+(Ft=l[6])*J+(kt=l[7])*Se,o[5]=yt*_+St*k+Ft*ne+kt*tt,o[6]=yt*E+St*F+Ft*le+kt*_t,o[7]=yt*b+St*G+Ft*de+kt*At,o[8]=(yt=l[8])*f+(St=l[9])*A+(Ft=l[10])*J+(kt=l[11])*Se,o[9]=yt*_+St*k+Ft*ne+kt*tt,o[10]=yt*E+St*F+Ft*le+kt*_t,o[11]=yt*b+St*G+Ft*de+kt*At,o[12]=(yt=l[12])*f+(St=l[13])*A+(Ft=l[14])*J+(kt=l[15])*Se,o[13]=yt*_+St*k+Ft*ne+kt*tt,o[14]=yt*E+St*F+Ft*le+kt*_t,o[15]=yt*b+St*G+Ft*de+kt*At,o}function Du(o,t,l){var f,_,E,b,A,k,F,G,J,ne,le,de,Se=l[0],tt=l[1],_t=l[2];return t===o?(o[12]=t[0]*Se+t[4]*tt+t[8]*_t+t[12],o[13]=t[1]*Se+t[5]*tt+t[9]*_t+t[13],o[14]=t[2]*Se+t[6]*tt+t[10]*_t+t[14],o[15]=t[3]*Se+t[7]*tt+t[11]*_t+t[15]):(_=t[1],E=t[2],b=t[3],A=t[4],k=t[5],F=t[6],G=t[7],J=t[8],ne=t[9],le=t[10],de=t[11],o[0]=f=t[0],o[1]=_,o[2]=E,o[3]=b,o[4]=A,o[5]=k,o[6]=F,o[7]=G,o[8]=J,o[9]=ne,o[10]=le,o[11]=de,o[12]=f*Se+A*tt+J*_t+t[12],o[13]=_*Se+k*tt+ne*_t+t[13],o[14]=E*Se+F*tt+le*_t+t[14],o[15]=b*Se+G*tt+de*_t+t[15]),o}function Mu(o,t,l){var f=l[0],_=l[1],E=l[2];return o[0]=t[0]*f,o[1]=t[1]*f,o[2]=t[2]*f,o[3]=t[3]*f,o[4]=t[4]*_,o[5]=t[5]*_,o[6]=t[6]*_,o[7]=t[7]*_,o[8]=t[8]*E,o[9]=t[9]*E,o[10]=t[10]*E,o[11]=t[11]*E,o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o}function nd(o,t,l){var f=Math.sin(l),_=Math.cos(l),E=t[4],b=t[5],A=t[6],k=t[7],F=t[8],G=t[9],J=t[10],ne=t[11];return t!==o&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[4]=E*_+F*f,o[5]=b*_+G*f,o[6]=A*_+J*f,o[7]=k*_+ne*f,o[8]=F*_-E*f,o[9]=G*_-b*f,o[10]=J*_-A*f,o[11]=ne*_-k*f,o}function vd(o,t,l){var f=Math.sin(l),_=Math.cos(l),E=t[0],b=t[1],A=t[2],k=t[3],F=t[8],G=t[9],J=t[10],ne=t[11];return t!==o&&(o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=E*_-F*f,o[1]=b*_-G*f,o[2]=A*_-J*f,o[3]=k*_-ne*f,o[8]=E*f+F*_,o[9]=b*f+G*_,o[10]=A*f+J*_,o[11]=k*f+ne*_,o}function rh(o,t){return o[0]=t[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=t[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function vp(o,t,l){var f,_,E,b=l[0],A=l[1],k=l[2],F=Math.hypot(b,A,k);return F<Fh?null:(b*=F=1/F,A*=F,k*=F,f=Math.sin(t),_=Math.cos(t),o[0]=b*b*(E=1-_)+_,o[1]=A*b*E+k*f,o[2]=k*b*E-A*f,o[3]=0,o[4]=b*A*E-k*f,o[5]=A*A*E+_,o[6]=k*A*E+b*f,o[7]=0,o[8]=b*k*E+A*f,o[9]=A*k*E-b*f,o[10]=k*k*E+_,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,t=arguments.length;t--;)o+=arguments[t]*arguments[t];return Math.sqrt(o)});var ao=Eo;function Lo(){var o=new Sc(3);return Sc!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Uh(o){var t=new Sc(3);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t}function zh(o){return Math.hypot(o[0],o[1],o[2])}function rd(o,t,l){var f=new Sc(3);return f[0]=o,f[1]=t,f[2]=l,f}function iu(o,t,l){return o[0]=t[0]+l[0],o[1]=t[1]+l[1],o[2]=t[2]+l[2],o}function jh(o,t,l){return o[0]=t[0]-l[0],o[1]=t[1]-l[1],o[2]=t[2]-l[2],o}function ih(o,t,l){return o[0]=t[0]*l[0],o[1]=t[1]*l[1],o[2]=t[2]*l[2],o}function sh(o,t,l){return o[0]=Math.min(t[0],l[0]),o[1]=Math.min(t[1],l[1]),o[2]=Math.min(t[2],l[2]),o}function xd(o,t,l){return o[0]=Math.max(t[0],l[0]),o[1]=Math.max(t[1],l[1]),o[2]=Math.max(t[2],l[2]),o}function dc(o,t,l){return o[0]=t[0]*l,o[1]=t[1]*l,o[2]=t[2]*l,o}function $h(o,t,l,f){return o[0]=t[0]+l[0]*f,o[1]=t[1]+l[1]*f,o[2]=t[2]+l[2]*f,o}function Ac(o,t){var l=t[0],f=t[1],_=t[2],E=l*l+f*f+_*_;return E>0&&(E=1/Math.sqrt(E)),o[0]=t[0]*E,o[1]=t[1]*E,o[2]=t[2]*E,o}function Gc(o,t){return o[0]*t[0]+o[1]*t[1]+o[2]*t[2]}function Ru(o,t,l){var f=t[0],_=t[1],E=t[2],b=l[0],A=l[1],k=l[2];return o[0]=_*k-E*A,o[1]=E*b-f*k,o[2]=f*A-_*b,o}function ua(o,t,l){var f=t[0],_=t[1],E=t[2],b=l[3]*f+l[7]*_+l[11]*E+l[15];return o[0]=(l[0]*f+l[4]*_+l[8]*E+l[12])/(b=b||1),o[1]=(l[1]*f+l[5]*_+l[9]*E+l[13])/b,o[2]=(l[2]*f+l[6]*_+l[10]*E+l[14])/b,o}function Pf(o,t,l){var f=l[0],_=l[1],E=l[2],b=t[0],A=t[1],k=t[2],F=_*k-E*A,G=E*b-f*k,J=f*A-_*b,ne=_*J-E*G,le=E*F-f*J,de=f*G-_*F,Se=2*l[3];return G*=Se,J*=Se,le*=2,de*=2,o[0]=b+(F*=Se)+(ne*=2),o[1]=A+G+le,o[2]=k+J+de,o}var oh,su=jh,Gh=ih,Ed=zh;function Ud(o,t,l){return o[0]=t[0]*l,o[1]=t[1]*l,o[2]=t[2]*l,o[3]=t[3]*l,o}function Hh(o,t){var l=t[0],f=t[1],_=t[2],E=t[3],b=l*l+f*f+_*_+E*E;return b>0&&(b=1/Math.sqrt(b)),o[0]=l*b,o[1]=f*b,o[2]=_*b,o[3]=E*b,o}function Hu(o,t,l){var f=t[0],_=t[1],E=t[2],b=t[3];return o[0]=l[0]*f+l[4]*_+l[8]*E+l[12]*b,o[1]=l[1]*f+l[5]*_+l[9]*E+l[13]*b,o[2]=l[2]*f+l[6]*_+l[10]*E+l[14]*b,o[3]=l[3]*f+l[7]*_+l[11]*E+l[15]*b,o}function xp(){var o=new Sc(4);return Sc!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Ep(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function id(o,t,l){l*=.5;var f=t[0],_=t[1],E=t[2],b=t[3],A=Math.sin(l),k=Math.cos(l);return o[0]=f*k+b*A,o[1]=_*k+E*A,o[2]=E*k-_*A,o[3]=b*k-f*A,o}function ah(o,t,l){l*=.5;var f=t[0],_=t[1],E=t[2],b=t[3],A=Math.sin(l),k=Math.cos(l);return o[0]=f*k-E*A,o[1]=_*k+b*A,o[2]=E*k+f*A,o[3]=b*k-_*A,o}Lo(),oh=new Sc(4),Sc!=Float32Array&&(oh[0]=0,oh[1]=0,oh[2]=0,oh[3]=0);var ou=Hh;Lo(),rd(1,0,0),rd(0,1,0),xp(),xp(),Vd();const Zm=Kt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Of}=Zm,sd=Kt([{name:"a_pos_3",components:3,type:"Int16"}]);var ma=Kt([{name:"a_pos",type:"Int16",components:2}]);class wd{constructor(t,l){this.pos=t,this.dir=l}intersectsPlane(t,l,f){const _=Gc(l,this.dir);if(Math.abs(_)<1e-6)return!1;const E=((t[0]-this.pos[0])*l[0]+(t[1]-this.pos[1])*l[1]+(t[2]-this.pos[2])*l[2])/_;return f[0]=this.pos[0]+this.dir[0]*E,f[1]=this.pos[1]+this.dir[1]*E,f[2]=this.pos[2]+this.dir[2]*E,!0}closestPointOnSphere(t,l,f){if(Se=(le=this.pos)[0],tt=le[1],_t=le[2],At=(de=t)[0],yt=de[1],St=de[2],Math.abs(Se-At)<=Fh*Math.max(1,Math.abs(Se),Math.abs(At))&&Math.abs(tt-yt)<=Fh*Math.max(1,Math.abs(tt),Math.abs(yt))&&Math.abs(_t-St)<=Fh*Math.max(1,Math.abs(_t),Math.abs(St))||0===l)return f[0]=f[1]=f[2]=0,!1;var le,de,Se,tt,_t,At,yt,St;const[_,E,b]=this.dir,A=this.pos[0]-t[0],k=this.pos[1]-t[1],F=this.pos[2]-t[2],G=_*_+E*E+b*b,J=2*(A*_+k*E+F*b),ne=J*J-4*G*(A*A+k*k+F*F-l*l);if(ne<0){const le=Math.max(-J/2,0),de=A+_*le,Se=k+E*le,tt=F+b*le,_t=Math.hypot(de,Se,tt);return f[0]=de*l/_t,f[1]=Se*l/_t,f[2]=tt*l/_t,!1}{const le=(-J-Math.sqrt(ne))/(2*G);if(le<0){const de=Math.hypot(A,k,F);return f[0]=A*l/de,f[1]=k*l/de,f[2]=F*l/de,!1}return f[0]=A+_*le,f[1]=k+E*le,f[2]=F+b*le,!0}}}class Wa{constructor(t,l,f,_,E){this.TL=t,this.TR=l,this.BR=f,this.BL=_,this.horizon=E}static fromInvProjectionMatrix(t,l,f){const _=[-1,1,1],E=[1,1,1],b=[1,-1,1],A=[-1,-1,1],k=ua(_,_,t),F=ua(E,E,t),G=ua(b,b,t),J=ua(A,A,t);return new Wa(k,F,G,J,l/f)}}class bd{constructor(t,l){this.points=t,this.planes=l}static fromInvProjectionMatrix(t,l,f,_){const E=Math.pow(2,f),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const F=Hu([],k,t),G=1/F[3]/l*E;return(J=F)[0]=(ne=F)[0]*(le=[G,G,_?1/F[3]:G,G])[0],J[1]=ne[1]*le[1],J[2]=ne[2]*le[2],J[3]=ne[3]*le[3],J;var J,ne,le}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const F=Ac([],Ru([],su([],b[k[0]],b[k[1]]),su([],b[k[2]],b[k[1]]))),G=-Gc(F,b[k[1]]);return F.concat(G)});return new bd(b,A)}}class gl{static fromPoints(t){const l=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const _ of t)sh(l,l,_),xd(f,f,_);return new gl(l,f)}static applyTransform(t,l){const f=t.getCorners();for(let _=0;_<f.length;++_)ua(f[_],f[_],l);return gl.fromPoints(f)}constructor(t,l){this.min=t,this.max=l,this.center=dc([],iu([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],f=Uh(this.min),_=Uh(this.max);for(let E=0;E<l.length;E++)f[E]=l[E]?this.min[E]:this.center[E],_[E]=l[E]?this.center[E]:this.max[E];return _[2]=this.max[2],new gl(f,_)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,l=this.max;return[[t[0],t[1],t[2]],[l[0],t[1],t[2]],[l[0],l[1],t[2]],[t[0],l[1],t[2]],[t[0],t[1],l[2]],[l[0],t[1],l[2]],[l[0],l[1],l[2]],[t[0],l[1],l[2]]]}intersects(t){const l=this.getCorners();let f=!0;for(let _=0;_<t.planes.length;_++){const E=t.planes[_];let b=0;for(let A=0;A<l.length;A++)b+=Gc(E,l[A])+E[3]>=0;if(0===b)return 0;b!==l.length&&(f=!1)}if(f)return 2;for(let _=0;_<3;_++){let E=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let A=0;A<t.points.length;A++){const k=t.points[A][_]-this.min[_];E=Math.min(E,k),b=Math.max(b,k)}if(b<0||E>this.max[_]-this.min[_])return 0}return 1}}const Wh=5,lh=6,kc=ii/Math.PI/2,kf=16383,qh=[64,32,16],il=-kc,Xl=kc,Hc=[new gl([il,il,il],[Xl,Xl,Xl]),new gl([il,il,il],[0,0,Xl]),new gl([0,il,il],[Xl,0,Xl]),new gl([il,0,il],[0,Xl,Xl]),new gl([0,0,il],[Xl,Xl,Xl])];function Kh(o){return o*kc/Ff}function Zh(o,t,l,f=!0){const _=dc([],o._camera.position,o.worldSize),E=[t,l,1,1];Hu(E,E,o.pixelMatrixInverse),Ud(E,E,1/E[3]);const b=Ac([],su([],E,_)),A=o.globeMatrix,k=[A[12],A[13],A[14]],F=su([],k,_),G=zh(F),J=Ac([],F),ne=o.worldSize/(2*Math.PI),le=Gc(J,b),de=Math.asin(ne/G);if(de<Math.acos(le)){if(!f)return null;const or=[],En=[];dc(or,b,G/le),Ac(En,su(En,or,F)),Ac(b,iu(b,F,dc(b,En,Math.tan(de)*G)))}const Se=[];new wd(_,b).closestPointOnSphere(k,ne,Se);const tt=Ac([],Hn(A,0)),_t=Ac([],Hn(A,1)),At=Ac([],Hn(A,2)),yt=Gc(tt,Se),St=Gc(_t,Se),Ft=Gc(At,Se),kt=it(Math.asin(-St/ne));let yn=it(Math.atan2(yt,Ft));yn=o.center.lng+function(or,En){const $n=(En-or+180)%360-180;return $n<-180?$n+360:$n}(o.center.lng,yn);const pn=au(yn),Fn=qt(yl(kt),0,1);return new qc(pn,Fn)}class Xm{constructor(t,l,f){this.a=su([],t,f),this.b=su([],l,f),this.center=f;const _=Ac([],this.a),E=Ac([],this.b);this.angle=Math.acos(Gc(_,E))}}function gu(o,t){if(0===o.angle)return null;let l;return l=0===o.a[t]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[t]/o.a[t]/Math.sin(o.angle)-1/Math.tan(o.angle)),l<0||l>1?null:function(f,_,E,b){const A=Math.sin(E);return f*(Math.sin((1-b)*E)/A)+_*(Math.sin(b*E)/A)}(o.a[t],o.b[t],o.angle,qt(l,0,1))+o.center[t]}function Wu(o){if(o.z<=1)return Hc[o.z+2*o.y+o.x];const t=jd(Nf(o));return gl.fromPoints(t)}function _u(o,t,l){return dc(o,o,1-l),$h(o,o,t,l)}function wp(o,t){const l=yu(t.zoom);if(0===l)return Wu(o);const f=Nf(o),_=jd(f),E=au(f.getWest())*t.worldSize,b=au(f.getEast())*t.worldSize,A=yl(f.getNorth())*t.worldSize,k=yl(f.getSouth())*t.worldSize,F=[E,A,0],G=[b,A,0],J=[E,k,0],ne=[b,k,0],le=Vh([],t.globeMatrix);return ua(F,F,le),ua(G,G,le),ua(J,J,le),ua(ne,ne,le),_[0]=_u(_[0],J,l),_[1]=_u(_[1],ne,l),_[2]=_u(_[2],G,l),_[3]=_u(_[3],F,l),gl.fromPoints(_)}function bp(o,t,l){for(const f of o)ua(f,f,t),dc(f,f,l)}function Nf({x:o,y:t,z:l}){const f=1/(1<<l),_=new Ws(qa(o*f),Ka((t+1)*f)),E=new Ws(qa((o+1)*f),Ka(t*f));return new Ll(_,E)}function jd(o){const t=Ze(o.getNorth()),l=Ze(o.getSouth()),f=Math.cos(t),_=Math.cos(l),E=Math.sin(t),b=Math.sin(l),A=o.getWest(),k=o.getEast();return[Ql(_,b,A),Ql(_,b,k),Ql(f,E,k),Ql(f,E,A)]}function Ql(o,t,l,f=kc){return l=Ze(l),[o*Math.sin(l)*f,-t*f,o*Math.cos(l)*f]}function hc(o,t,l){return Ql(Math.cos(Ze(o)),Math.sin(Ze(o)),t,l)}function qu(o,t,l,f){const _=1<<l.z,E=(o/ii+l.x)/_;return hc(Ka((t/ii+l.y)/_),qa(E),f)}function ch({min:o,max:t}){return kf/Math.max(t[0]-o[0],t[1]-o[1],t[2]-o[2])}const Tp=new Float64Array(16);function Wc(o){const t=ch(o),l=rh(Tp,[t,t,t]);return Du(l,l,((f=[])[0]=-(_=o.min)[0],f[1]=-_[1],f[2]=-_[2],f));var f,_}function uh(o){const t=(f=o.min,(l=Tp)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=f[0],l[13]=f[1],l[14]=f[2],l[15]=1,l);var l,f;const _=1/ch(o);return Mu(t,t,[_,_,_])}function Pu(o,t,l,f,_){const E=function(k){const F=ii/(2*Math.PI);return k/(2*Math.PI)/F}(l),b=[o,t,-l/(2*Math.PI)],A=$o(new Float64Array(16));return Du(A,A,b),Mu(A,A,[E,E,E]),nd(A,A,Ze(-_)),vd(A,A,Ze(-f)),A}function yu(o){return Ht(Wh,lh,o)}function fm(o,t){const l=hc(t.lat,t.lng);return b=(_=jh([],function(de){const Se=hc(de._center.lat,de._center.lng);let tt=Ru([],rd(0,1,0),Se);const _t=vp([],-de.angle,Se);tt=ua(tt,tt,_t),vp(_t,-de._pitch,tt);const At=Ac([],Se);return dc(At,At,Kh(de.cameraToCenterDistance/de.pixelsPerMeter)),ua(At,At,_t),iu([],Se,At)}(o),l))[0],A=_[1],k=_[2],F=(E=l)[0],G=E[1],J=E[2],le=(ne=Math.sqrt(b*b+A*A+k*k)*Math.sqrt(F*F+G*G+J*J))&&Gc(_,E)/ne,Math.acos(Math.min(Math.max(le,-1),1));var _,E,b,A,k,F,G,J,ne,le}function Cc(o,t){return fm(o,t)>Math.PI/2*1.01}const pm=Ze(85),Lf=Math.cos(pm),f_=Math.sin(pm),Ff=6371008.8,Xh=2*Math.PI*Ff;class _l{constructor(t,l){if(isNaN(t)||isNaN(l))throw new Error(`Invalid LngLat object: (${t}, ${l})`);if(this.lng=+t,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _l(lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const l=Math.PI/180,f=this.lat*l,_=t.lat*l,E=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((t.lng-this.lng)*l);return Ff*Math.acos(Math.min(E,1))}toBounds(t=0){const l=360*t/40075017,f=l/Math.cos(Math.PI/180*this.lat);return new Ll(new _l(this.lng-f,this.lat-l),new _l(this.lng+f,this.lat+l))}toEcef(t){const l=Kh(t);return hc(this.lat,this.lng,kc+l)}static convert(t){if(t instanceof _l)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new _l(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new _l(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Ws=_l;function Co(o){return Xh*Math.cos(o*Math.PI/180)}function au(o){return(180+o)/360}function yl(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function fc(o,t){return o/Co(t)}function qa(o){return 360*o-180}function Ka(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Ip(o,t){return o*Co(Ka(t))}const xa=85.051129;function dh(o){return 1/Math.cos(o*Math.PI/180)}class qc{constructor(t,l,f=0){this.x=+t,this.y=+l,this.z=+f}static fromLngLat(t,l=0){const f=Ws.convert(t);return new qc(au(f.lng),yl(f.lat),fc(l,f.lat))}toLngLat(){return new Ws(qa(this.x),Ka(this.y))}toAltitude(){return Ip(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Xh*dh(Ka(this.y))}}function Bf(o,t,l,f,_,E,b,A,k){const F=(t+f)/2,G=(l+_)/2,J=new Le(F,G);A(J),function(ne,le,de,Se,tt,_t){const At=de-tt,yt=Se-_t;return Math.abs((Se-le)*At-(de-ne)*yt)/Math.hypot(At,yt)}(J.x,J.y,E.x,E.y,b.x,b.y)>=k?(Bf(o,t,l,F,G,E,J,A,k),Bf(o,F,G,f,_,J,b,A,k)):o.push(b)}function Qh(o,t,l){let f=o[0],_=f.x,E=f.y;t(f);const b=[f];for(let A=1;A<o.length;A++){const k=o[A],{x:F,y:G}=k;t(k),Bf(b,_,E,F,G,f,k,t,l),_=F,E=G,f=k}return b}function B(o,t,l,f){if(f(t,l)){const _=t.add(l)._mult(.5);B(o,t,_,f),B(o,_,l,f)}else o.push(l)}function S(o,t){let l=o[0];const f=[l];for(let _=1;_<o.length;_++){const E=o[_];B(f,l,E,t),l=E}return f}const M=Math.pow(2,14)-1,j=-M-1;function fe(o,t){const l=Math.round(o.x*t),f=Math.round(o.y*t);return o.x=qt(l,j,M),o.y=qt(f,j,M),(l<o.x||l>o.x+1||f<o.y||f>o.y+1)&&ur("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function We(o,t,l){const f=o.loadGeometry(),_=o.extent,E=ii/_;if(t&&l&&l.projection.isReprojectedInTileSpace){const b=1<<t.z,{scale:A,x:k,y:F,projection:G}=l,J=ne=>{const le=qa((t.x+ne.x/_)/b),de=Ka((t.y+ne.y/_)/b),Se=G.project(le,de);ne.x=(Se.x*A-k)*_,ne.y=(Se.y*A-F)*_};for(let ne=0;ne<f.length;ne++)if(1!==o.type)f[ne]=Qh(f[ne],J,1);else{const le=[];for(const de of f[ne])de.x<0||de.x>=_||de.y<0||de.y>=_||(J(de),le.push(de));f[ne]=le}}for(const b of f)for(const A of b)fe(A,E);return f}function zt(o,t){return{type:o.type,id:o.id,properties:o.properties,geometry:t?We(o):[]}}function fn(o,t,l,f,_){o.emplaceBack(2*t+(f+1)/2,2*l+(_+1)/2)}function Tn(o,t,l){o.emplaceBack(t.x,t.y,t.z,16384*l[0],16384*l[1],16384*l[2])}class ir{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new rr,this.indexArray=new ee,this.segments=new go,this.programConfigurations=new pa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,f,_){const E=this.layers[0],b=[];let A=null;"circle"===E.type&&(A=E.layout.get("circle-sort-key"));for(const{feature:F,id:G,index:J,sourceLayerIndex:ne}of t){const le=this.layers[0]._featureFilter.needGeometry,de=zt(F,le);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),de,f))continue;const Se=A?A.evaluate(de,{},f):void 0,tt={id:G,properties:F.properties,type:F.type,sourceLayerIndex:ne,index:J,geometry:le?de.geometry:We(F,f,_),patterns:{},sortKey:Se};b.push(tt)}A&&b.sort((F,G)=>F.sortKey-G.sortKey);let k=null;"globe"===_.projection.name&&(this.globeExtVertexArray=new Nn,k=_.projection);for(const F of b){const{geometry:G,index:J,sourceLayerIndex:ne}=F,le=t[J].feature;this.addFeature(F,G,J,l.availableImages,f,k),l.featureIndex.insert(le,G,J,ne,this.index)}}update(t,l,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ru.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,To.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,l,f,_,E,b){for(const A of l)for(const k of A){const F=k.x,G=k.y;if(F<0||F>=ii||G<0||G>=ii)continue;if(b){const le=b.projectTilePoint(F,G,E),de=b.upVector(E,F,G),Se=this.globeExtVertexArray;Tn(Se,le,de),Tn(Se,le,de),Tn(Se,le,de),Tn(Se,le,de)}const J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ne=J.vertexLength;fn(this.layoutVertexArray,F,G,-1,-1),fn(this.layoutVertexArray,F,G,1,-1),fn(this.layoutVertexArray,F,G,1,1),fn(this.layoutVertexArray,F,G,-1,1),this.indexArray.emplaceBack(ne,ne+1,ne+2),this.indexArray.emplaceBack(ne,ne+2,ne+3),J.vertexLength+=4,J.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,f,{},_,E)}}function oi(o,t){for(let l=0;l<o.length;l++)if(lu(t,o[l]))return!0;for(let l=0;l<t.length;l++)if(lu(o,t[l]))return!0;return!!hh(o,t)}function ai(o,t,l){return!!lu(o,t)||!!Yh(t,o,l)}function ks(o,t){if(1===o.length)return fh(t,o[0]);for(let l=0;l<t.length;l++){const f=t[l];for(let _=0;_<f.length;_++)if(lu(o,f[_]))return!0}for(let l=0;l<o.length;l++)if(fh(t,o[l]))return!0;for(let l=0;l<t.length;l++)if(hh(o,t[l]))return!0;return!1}function Nc(o,t,l){if(o.length>1){if(hh(o,t))return!0;for(let f=0;f<t.length;f++)if(Yh(t[f],o,l))return!0}for(let f=0;f<o.length;f++)if(Yh(o[f],t,l))return!0;return!1}function hh(o,t){if(0===o.length||0===t.length)return!1;for(let l=0;l<o.length-1;l++){const f=o[l],_=o[l+1];for(let E=0;E<t.length-1;E++)if(Sp(f,_,t[E],t[E+1]))return!0}return!1}function Sp(o,t,l,f){return Ai(o,l,f)!==Ai(t,l,f)&&Ai(o,t,l)!==Ai(o,t,f)}function Yh(o,t,l){const f=l*l;if(1===t.length)return o.distSqr(t[0])<f;for(let _=1;_<t.length;_++)if(Jh(o,t[_-1],t[_])<f)return!0;return!1}function Jh(o,t,l){const f=t.distSqr(l);if(0===f)return o.distSqr(t);const _=((o.x-t.x)*(l.x-t.x)+(o.y-t.y)*(l.y-t.y))/f;return o.distSqr(_<0?t:_>1?l:l.sub(t)._mult(_)._add(t))}function fh(o,t){let l,f,_,E=!1;for(let b=0;b<o.length;b++){l=o[b];for(let A=0,k=l.length-1;A<l.length;k=A++)f=l[A],_=l[k],f.y>t.y!=_.y>t.y&&t.x<(_.x-f.x)*(t.y-f.y)/(_.y-f.y)+f.x&&(E=!E)}return E}function lu(o,t){let l=!1;for(let f=0,_=o.length-1;f<o.length;_=f++){const E=o[f],b=o[_];E.y>t.y!=b.y>t.y&&t.x<(b.x-E.x)*(t.y-E.y)/(b.y-E.y)+E.x&&(l=!l)}return l}function ph(o,t,l,f,_){for(const b of o)if(t<=b.x&&l<=b.y&&f>=b.x&&_>=b.y)return!0;const E=[new Le(t,l),new Le(t,_),new Le(f,_),new Le(f,l)];if(o.length>2)for(const b of E)if(lu(o,b))return!0;for(let b=0;b<o.length-1;b++)if(ef(o[b],o[b+1],E))return!0;return!1}function ef(o,t,l){const f=l[0],_=l[2];if(o.x<f.x&&t.x<f.x||o.x>_.x&&t.x>_.x||o.y<f.y&&t.y<f.y||o.y>_.y&&t.y>_.y)return!1;const E=Ai(o,t,l[0]);return E!==Ai(o,t,l[1])||E!==Ai(o,t,l[2])||E!==Ai(o,t,l[3])}function Td(o,t,l){const f=t.paint.get(o).value;return"constant"===f.kind?f.value:l.programConfigurations.get(t.id).getMaxValue(o)}function tf(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function mm(o,t,l,f,_){if(!t[0]&&!t[1])return o;const E=Le.convert(t)._mult(_);"viewport"===l&&E._rotate(-f);const b=[];for(let A=0;A<o.length;A++)b.push(o[A].sub(E));return b}function Ap(o,t,l,f){const _=Le.convert(o)._mult(f);return"viewport"===t&&_._rotate(-l),_}Cr(ir,"CircleBucket",{omit:["layers"]});const gm=new mt({"circle-sort-key":new he(bt.layout_circle["circle-sort-key"])});var p_={paint:new mt({"circle-radius":new he(bt.paint_circle["circle-radius"]),"circle-color":new he(bt.paint_circle["circle-color"]),"circle-blur":new he(bt.paint_circle["circle-blur"]),"circle-opacity":new he(bt.paint_circle["circle-opacity"]),"circle-translate":new pe(bt.paint_circle["circle-translate"]),"circle-translate-anchor":new pe(bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pe(bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pe(bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new he(bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new he(bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new he(bt.paint_circle["circle-stroke-opacity"])}),layout:gm};function m_(o,t,l,f,_,E,b,A,k){if(E&&o.queryGeometry.isAboveHorizon)return!1;E&&(k*=o.pixelToTileUnitsFactor);const F=o.tileID.canonical,G=l.projection.upVectorScale(F,l.center.lat,l.worldSize).metersToTile;for(const J of t)for(const ne of J){const le=ne.add(A),de=_&&l.elevation?l.elevation.exaggeration()*_.getElevationAt(le.x,le.y,!0):0,Se=l.projection.projectTilePoint(le.x,le.y,F);if(de>0){const yt=l.projection.upVector(F,le.x,le.y);Se.x+=yt[0]*G*de,Se.y+=yt[1]*G*de,Se.z+=yt[2]*G*de}const tt=E?le:Qm(Se.x,Se.y,Se.z,f),_t=E?o.tilespaceRays.map(yt=>Ym(yt,de)):o.queryGeometry.screenGeometry,At=Hu([],[Se.x,Se.y,Se.z,1],f);if(!b&&E?k*=At[3]/l.cameraToCenterDistance:b&&!E&&(k*=l.cameraToCenterDistance/At[3]),E){const yt=Ka((ne.y/ii+F.y)/(1<<F.z));k/=l.projection.pixelsPerMeter(yt,1)/fc(1,yt)}if(ai(_t,tt,k))return!0}return!1}function Qm(o,t,l,f){const _=Hu([],[o,t,l,1],f);return new Le(_[0]/_[3],_[1]/_[3])}const g_=rd(0,0,0),hy=rd(0,0,1);function Ym(o,t){const l=Lo();return g_[2]=t,o.intersectsPlane(g_,hy,l),new Le(l[0],l[1])}class nf extends ir{}function __(o,{width:t,height:l},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==t*l*f)throw new RangeError("mismatched image size")}else _=new Uint8Array(t*l*f);return o.width=t,o.height=l,o.data=_,o}function fy(o,t,l){const{width:f,height:_}=t;f===o.width&&_===o.height||(vl(o,t,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,f),height:Math.min(o.height,_)},l),o.width=f,o.height=_,o.data=t.data)}function vl(o,t,l,f,_,E){if(0===_.width||0===_.height)return t;if(_.width>o.width||_.height>o.height||l.x>o.width-_.width||l.y>o.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>t.width||_.height>t.height||f.x>t.width-_.width||f.y>t.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const b=o.data,A=t.data;for(let k=0;k<_.height;k++){const F=((l.y+k)*o.width+l.x)*E,G=((f.y+k)*t.width+f.x)*E;for(let J=0;J<_.width*E;J++)A[G+J]=b[F+J]}return t}Cr(nf,"HeatmapBucket",{omit:["layers"]});class Id{constructor(t,l){__(this,t,1,l)}resize(t){fy(this,new Id(t),1)}clone(){return new Id({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,f,_,E){vl(t,l,f,_,E,1)}}class Kc{constructor(t,l){__(this,t,4,l)}resize(t){fy(this,new Kc(t),4)}replace(t,l){l?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,l,f,_,E){vl(t,l,f,_,E,4)}}Cr(Id,"AlphaImage"),Cr(Kc,"RGBAImage");var kv={paint:new mt({"heatmap-radius":new he(bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new he(bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pe(bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gt(bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pe(bt.paint_heatmap["heatmap-opacity"])})};function rf(o){const t={},l=o.resolution||256,f=o.clips?o.clips.length:1,_=o.image||new Kc({width:l,height:f}),E=(b,A,k)=>{t[o.evaluationKey]=k;const F=o.expression.evaluate(t);_.data[b+A+0]=Math.floor(255*F.r/F.a),_.data[b+A+1]=Math.floor(255*F.g/F.a),_.data[b+A+2]=Math.floor(255*F.b/F.a),_.data[b+A+3]=Math.floor(255*F.a)};if(o.clips)for(let b=0,A=0;b<f;++b,A+=4*l)for(let k=0,F=0;k<l;k++,F+=4){const G=k/(l-1),{start:J,end:ne}=o.clips[b];E(A,F,J*(1-G)+ne*G)}else for(let b=0,A=0;b<l;b++,A+=4)E(0,A,b/(l-1));return _}var $d={paint:new mt({"hillshade-illumination-direction":new pe(bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pe(bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pe(bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pe(bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pe(bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pe(bt.paint_hillshade["hillshade-accent-color"])})};const py=Kt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Nv}=py;var _m={exports:{}};function Cp(o,t,l){l=l||2;var f,_,E,b,A,k,F,G=t&&t.length,J=G?t[0]*l:o.length,ne=ym(o,0,J,l,!0),le=[];if(!ne||ne.next===ne.prev)return le;if(G&&(ne=function(Se,tt,_t,At){var yt,St,Ft,kt=[];for(yt=0,St=tt.length;yt<St;yt++)(Ft=ym(Se,tt[yt]*At,yt<St-1?tt[yt+1]*At:Se.length,At,!1))===Ft.next&&(Ft.steiner=!0),kt.push(yy(Ft));for(kt.sort(Lv),yt=0;yt<kt.length;yt++)_t=gy(kt[yt],_t);return _t}(o,t,ne,l)),o.length>80*l){f=E=o[0],_=b=o[1];for(var de=l;de<J;de+=l)(A=o[de])<f&&(f=A),(k=o[de+1])<_&&(_=k),A>E&&(E=A),k>b&&(b=k);F=0!==(F=Math.max(E-f,b-_))?32767/F:0}return od(ne,le,l,f,_,F,0),le}function ym(o,t,l,f,_){var E,b;if(_===cf(o,t,l,f)>0)for(E=t;E<l;E+=f)b=Uf(E,o[E],o[E+1],b);else for(E=l-f;E>=t;E-=f)b=Uf(E,o[E],o[E+1],b);return b&&Sd(b,b.next)&&(lf(b),b=b.next),b}function sf(o,t){if(!o)return o;t||(t=o);var l,f=o;do{if(l=!1,f.steiner||!Sd(f,f.next)&&0!==Pa(f.prev,f,f.next))f=f.next;else{if(lf(f),(f=t=f.prev)===f.next)break;l=!0}}while(l||f!==t);return t}function od(o,t,l,f,_,E,b){if(o){!b&&E&&function(G,J,ne,le){var de=G;do{0===de.z&&(de.z=v_(de.x,de.y,J,ne,le)),de.prevZ=de.prev,de.nextZ=de.next,de=de.next}while(de!==G);de.prevZ.nextZ=null,de.prevZ=null,function(Se){var tt,_t,At,yt,St,Ft,kt,yn,pn=1;do{for(_t=Se,Se=null,St=null,Ft=0;_t;){for(Ft++,At=_t,kt=0,tt=0;tt<pn&&(kt++,At=At.nextZ);tt++);for(yn=pn;kt>0||yn>0&&At;)0!==kt&&(0===yn||!At||_t.z<=At.z)?(yt=_t,_t=_t.nextZ,kt--):(yt=At,At=At.nextZ,yn--),St?St.nextZ=yt:Se=yt,yt.prevZ=St,St=yt;_t=At}St.nextZ=null,pn*=2}while(Ft>1)}(de)}(o,f,_,E);for(var A,k,F=o;o.prev!==o.next;)if(A=o.prev,k=o.next,E?vm(o,f,_,E):my(o))t.push(A.i/l|0),t.push(o.i/l|0),t.push(k.i/l|0),lf(o),o=k.next,F=k.next;else if((o=k)===F){b?1===b?od(o=Jm(sf(o),t,l),t,l,f,_,E,2):2===b&&y_(o,t,l,f,_,E):od(sf(o),t,l,f,_,E,1);break}}}function my(o){var t=o.prev,l=o,f=o.next;if(Pa(t,l,f)>=0)return!1;for(var _=t.x,E=l.x,b=f.x,A=t.y,k=l.y,F=f.y,G=_<E?_<b?_:b:E<b?E:b,J=A<k?A<F?A:F:k<F?k:F,ne=_>E?_>b?_:b:E>b?E:b,le=A>k?A>F?A:F:k>F?k:F,de=f.next;de!==t;){if(de.x>=G&&de.x<=ne&&de.y>=J&&de.y<=le&&xm(_,A,E,k,b,F,de.x,de.y)&&Pa(de.prev,de,de.next)>=0)return!1;de=de.next}return!0}function vm(o,t,l,f){var _=o.prev,E=o,b=o.next;if(Pa(_,E,b)>=0)return!1;for(var A=_.x,k=E.x,F=b.x,G=_.y,J=E.y,ne=b.y,le=A<k?A<F?A:F:k<F?k:F,de=G<J?G<ne?G:ne:J<ne?J:ne,Se=A>k?A>F?A:F:k>F?k:F,tt=G>J?G>ne?G:ne:J>ne?J:ne,_t=v_(le,de,t,l,f),At=v_(Se,tt,t,l,f),yt=o.prevZ,St=o.nextZ;yt&&yt.z>=_t&&St&&St.z<=At;){if(yt.x>=le&&yt.x<=Se&&yt.y>=de&&yt.y<=tt&&yt!==_&&yt!==b&&xm(A,G,k,J,F,ne,yt.x,yt.y)&&Pa(yt.prev,yt,yt.next)>=0||(yt=yt.prevZ,St.x>=le&&St.x<=Se&&St.y>=de&&St.y<=tt&&St!==_&&St!==b&&xm(A,G,k,J,F,ne,St.x,St.y)&&Pa(St.prev,St,St.next)>=0))return!1;St=St.nextZ}for(;yt&&yt.z>=_t;){if(yt.x>=le&&yt.x<=Se&&yt.y>=de&&yt.y<=tt&&yt!==_&&yt!==b&&xm(A,G,k,J,F,ne,yt.x,yt.y)&&Pa(yt.prev,yt,yt.next)>=0)return!1;yt=yt.prevZ}for(;St&&St.z<=At;){if(St.x>=le&&St.x<=Se&&St.y>=de&&St.y<=tt&&St!==_&&St!==b&&xm(A,G,k,J,F,ne,St.x,St.y)&&Pa(St.prev,St,St.next)>=0)return!1;St=St.nextZ}return!0}function Jm(o,t,l){var f=o;do{var _=f.prev,E=f.next.next;!Sd(_,E)&&mh(_,f,f.next,E)&&af(_,E)&&af(E,_)&&(t.push(_.i/l|0),t.push(f.i/l|0),t.push(E.i/l|0),lf(f),lf(f.next),f=o=E),f=f.next}while(f!==o);return sf(f)}function y_(o,t,l,f,_,E){var b=o;do{for(var A=b.next.next;A!==b.prev;){if(b.i!==A.i&&N0(b,A)){var k=ad(b,A);return b=sf(b,b.next),k=sf(k,k.next),od(b,t,l,f,_,E,0),void od(k,t,l,f,_,E,0)}A=A.next}b=b.next}while(b!==o)}function Lv(o,t){return o.x-t.x}function gy(o,t){var l=function(_,E){var b,A=E,k=_.x,F=_.y,G=-1/0;do{if(F<=A.y&&F>=A.next.y&&A.next.y!==A.y){var J=A.x+(F-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(J<=k&&J>G&&(G=J,b=A.x<A.next.x?A:A.next,J===k))return b}A=A.next}while(A!==E);if(!b)return null;var ne,le=b,de=b.x,Se=b.y,tt=1/0;A=b;do{k>=A.x&&A.x>=de&&k!==A.x&&xm(F<Se?k:G,F,de,Se,F<Se?G:k,F,A.x,A.y)&&(ne=Math.abs(F-A.y)/(k-A.x),af(A,_)&&(ne<tt||ne===tt&&(A.x>b.x||A.x===b.x&&_y(b,A)))&&(b=A,tt=ne)),A=A.next}while(A!==le);return b}(o,t);if(!l)return t;var f=ad(l,o);return sf(f,f.next),sf(l,l.next)}function _y(o,t){return Pa(o.prev,o,t.prev)<0&&Pa(t.next,o,o.next)<0}function v_(o,t,l,f,_){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-l)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-f)*_|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function yy(o){var t=o,l=o;do{(t.x<l.x||t.x===l.x&&t.y<l.y)&&(l=t),t=t.next}while(t!==o);return l}function xm(o,t,l,f,_,E,b,A){return(_-b)*(t-A)>=(o-b)*(E-A)&&(o-b)*(f-A)>=(l-b)*(t-A)&&(l-b)*(E-A)>=(_-b)*(f-A)}function N0(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!function(l,f){var _=l;do{if(_.i!==l.i&&_.next.i!==l.i&&_.i!==f.i&&_.next.i!==f.i&&mh(_,_.next,l,f))return!0;_=_.next}while(_!==l);return!1}(o,t)&&(af(o,t)&&af(t,o)&&function(l,f){var _=l,E=!1,b=(l.x+f.x)/2,A=(l.y+f.y)/2;do{_.y>A!=_.next.y>A&&_.next.y!==_.y&&b<(_.next.x-_.x)*(A-_.y)/(_.next.y-_.y)+_.x&&(E=!E),_=_.next}while(_!==l);return E}(o,t)&&(Pa(o.prev,o,t.prev)||Pa(o,t.prev,t))||Sd(o,t)&&Pa(o.prev,o,o.next)>0&&Pa(t.prev,t,t.next)>0)}function Pa(o,t,l){return(t.y-o.y)*(l.x-t.x)-(t.x-o.x)*(l.y-t.y)}function Sd(o,t){return o.x===t.x&&o.y===t.y}function mh(o,t,l,f){var _=gh(Pa(o,t,l)),E=gh(Pa(o,t,f)),b=gh(Pa(l,f,o)),A=gh(Pa(l,f,t));return _!==E&&b!==A||!(0!==_||!Vf(o,l,t))||!(0!==E||!Vf(o,f,t))||!(0!==b||!Vf(l,o,f))||!(0!==A||!Vf(l,t,f))}function Vf(o,t,l){return t.x<=Math.max(o.x,l.x)&&t.x>=Math.min(o.x,l.x)&&t.y<=Math.max(o.y,l.y)&&t.y>=Math.min(o.y,l.y)}function gh(o){return o>0?1:o<0?-1:0}function af(o,t){return Pa(o.prev,o,o.next)<0?Pa(o,t,o.next)>=0&&Pa(o,o.prev,t)>=0:Pa(o,t,o.prev)<0||Pa(o,o.next,t)<0}function ad(o,t){var l=new _h(o.i,o.x,o.y),f=new _h(t.i,t.x,t.y),_=o.next,E=t.prev;return o.next=t,t.prev=o,l.next=_,_.prev=l,f.next=l,l.prev=f,E.next=f,f.prev=E,f}function Uf(o,t,l,f){var _=new _h(o,t,l);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function lf(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function _h(o,t,l){this.i=o,this.x=t,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function cf(o,t,l,f){for(var _=0,E=t,b=l-f;E<l;E+=f)_+=(o[b]-o[E])*(o[E+1]+o[b+1]),b=E;return _}_m.exports=Cp,_m.exports.default=Cp,Cp.deviation=function(o,t,l,f){var _=t&&t.length,E=Math.abs(cf(o,0,_?t[0]*l:o.length,l));if(_)for(var b=0,A=t.length;b<A;b++)E-=Math.abs(cf(o,t[b]*l,b<A-1?t[b+1]*l:o.length,l));var k=0;for(b=0;b<f.length;b+=3){var F=f[b]*l,G=f[b+1]*l,J=f[b+2]*l;k+=Math.abs((o[F]-o[J])*(o[G+1]-o[F+1])-(o[F]-o[G])*(o[J+1]-o[F+1]))}return 0===E&&0===k?0:Math.abs((k-E)/E)},Cp.flatten=function(o){for(var t=o[0][0].length,l={vertices:[],holes:[],dimensions:t},f=0,_=0;_<o.length;_++){for(var E=0;E<o[_].length;E++)for(var b=0;b<t;b++)l.vertices.push(o[_][E][b]);_>0&&l.holes.push(f+=o[_-1].length)}return l};var Ad=ht(_m.exports);function Gd(o,t,l,f,_){zf(o,t,l||0,f||o.length-1,_||Dp)}function zf(o,t,l,f,_){for(;f>l;){if(f-l>600){var E=f-l+1,b=t-l+1,A=Math.log(E),k=.5*Math.exp(2*A/3),F=.5*Math.sqrt(A*k*(E-k)/E)*(b-E/2<0?-1:1);zf(o,t,Math.max(l,Math.floor(t-b*k/E+F)),Math.min(f,Math.floor(t+(E-b)*k/E+F)),_)}var G=o[t],J=l,ne=f;for(Cd(o,l,t),_(o[f],G)>0&&Cd(o,l,f);J<ne;){for(Cd(o,J,ne),J++,ne--;_(o[J],G)<0;)J++;for(;_(o[ne],G)>0;)ne--}0===_(o[l],G)?Cd(o,l,ne):Cd(o,++ne,f),ne<=t&&(l=ne+1),t<=ne&&(f=ne-1)}}function Cd(o,t,l){var f=o[t];o[t]=o[l],o[l]=f}function Dp(o,t){return o<t?-1:o>t?1:0}function Em(o,t){const l=o.length;if(l<=1)return[o];const f=[];let _,E;for(let b=0;b<l;b++){const A=Ri(o[b]);0!==A&&(o[b].area=Math.abs(A),void 0===E&&(E=A<0),E===A<0?(_&&f.push(_),_=[o[b]]):_.push(o[b]))}if(_&&f.push(_),t>1)for(let b=0;b<f.length;b++)f[b].length<=t||(Gd(f[b],t,1,f[b].length-1,eg),f[b]=f[b].slice(0,t));return f}function eg(o,t){return t.area-o.area}function tg(o,t,l){const f=l.patternDependencies;let _=!1;for(const E of t){const b=E.paint.get(`${o}-pattern`);b.isConstant()||(_=!0);const A=b.constantOr(null);A&&(_=!0,f[A]=!0)}return _}function ng(o,t,l,f,_){const E=_.patternDependencies;for(const b of t){const A=b.paint.get(`${o}-pattern`).value;if("constant"!==A.kind){let k=A.evaluate({zoom:f},l,{},_.availableImages);k=k&&k.name?k.name:k,E[k]=!0,l.patterns[b.id]=k}}return l}class Mp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rr,this.indexArray=new ee,this.indexArray2=new gn,this.programConfigurations=new pa(t.layers,t.zoom),this.segments=new go,this.segments2=new go,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=t.projection}populate(t,l,f,_){this.hasPattern=tg("fill",this.layers,l);const E=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:A,id:k,index:F,sourceLayerIndex:G}of t){const J=this.layers[0]._featureFilter.needGeometry,ne=zt(A,J);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),ne,f))continue;const le=E?E.evaluate(ne,{},f,l.availableImages):void 0,de={id:k,properties:A.properties,type:A.type,sourceLayerIndex:G,index:F,geometry:J?ne.geometry:We(A,f,_),patterns:{},sortKey:le};b.push(de)}E&&b.sort((A,k)=>A.sortKey-k.sortKey);for(const A of b){const{geometry:k,index:F,sourceLayerIndex:G}=A;if(this.hasPattern){const J=ng("fill",this.layers,A,this.zoom,l);this.patternFeatures.push(J)}else this.addFeature(A,k,F,f,{},l.availableImages);l.featureIndex.insert(t[F].feature,k,F,G,this.index)}}update(t,l,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,f,_)}addFeatures(t,l,f,_,E){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,l,f,_,E,b=[]){for(const A of Em(l,500)){let k=0;for(const de of A)k+=de.length;const F=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),G=F.vertexLength,J=[],ne=[];for(const de of A){if(0===de.length)continue;de!==A[0]&&ne.push(J.length/2);const Se=this.segments2.prepareSegment(de.length,this.layoutVertexArray,this.indexArray2),tt=Se.vertexLength;this.layoutVertexArray.emplaceBack(de[0].x,de[0].y),this.indexArray2.emplaceBack(tt+de.length-1,tt),J.push(de[0].x),J.push(de[0].y);for(let _t=1;_t<de.length;_t++)this.layoutVertexArray.emplaceBack(de[_t].x,de[_t].y),this.indexArray2.emplaceBack(tt+_t-1,tt+_t),J.push(de[_t].x),J.push(de[_t].y);Se.vertexLength+=de.length,Se.primitiveLength+=de.length}const le=Ad(J,ne);for(let de=0;de<le.length;de+=3)this.indexArray.emplaceBack(G+le[de],G+le[de+1],G+le[de+2]);F.vertexLength+=k,F.primitiveLength+=le.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,f,E,b,_)}}Cr(Mp,"FillBucket",{omit:["layers","patternFeatures"]});const x_=new mt({"fill-sort-key":new he(bt.layout_fill["fill-sort-key"])});var vy={paint:new mt({"fill-antialias":new pe(bt.paint_fill["fill-antialias"]),"fill-opacity":new he(bt.paint_fill["fill-opacity"]),"fill-color":new he(bt.paint_fill["fill-color"]),"fill-outline-color":new he(bt.paint_fill["fill-outline-color"]),"fill-translate":new pe(bt.paint_fill["fill-translate"]),"fill-translate-anchor":new pe(bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new he(bt.paint_fill["fill-pattern"])}),layout:x_};const rg=Kt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),yh=Kt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),uf=Kt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:E_}=rg;var wm={},L0=nt,Fv=Hd;function Hd(o,t,l,f,_){this.properties={},this.extent=l,this.type=0,this._pbf=o,this._geometry=-1,this._keys=f,this._values=_,o.readFields(bm,this,t)}function bm(o,t,l){1==o?t.id=l.readVarint():2==o?function(f,_){for(var E=f.readVarint()+f.pos;f.pos<E;){var b=_._keys[f.readVarint()],A=_._values[f.readVarint()];_.properties[b]=A}}(l,t):3==o?t.type=l.readVarint():4==o&&(t._geometry=l.pos)}function Wd(o){for(var t,l,f=0,_=0,E=o.length,b=E-1;_<E;b=_++)f+=((l=o[b]).x-(t=o[_]).x)*(t.y+l.y);return f}Hd.types=["Unknown","Point","LineString","Polygon"],Hd.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var t,l=o.readVarint()+o.pos,f=1,_=0,E=0,b=0,A=[];o.pos<l;){if(_<=0){var k=o.readVarint();f=7&k,_=k>>3}if(_--,1===f||2===f)E+=o.readSVarint(),b+=o.readSVarint(),1===f&&(t&&A.push(t),t=[]),t.push(new L0(E,b));else{if(7!==f)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&A.push(t),A},Hd.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var t=o.readVarint()+o.pos,l=1,f=0,_=0,E=0,b=1/0,A=-1/0,k=1/0,F=-1/0;o.pos<t;){if(f<=0){var G=o.readVarint();l=7&G,f=G>>3}if(f--,1===l||2===l)(_+=o.readSVarint())<b&&(b=_),_>A&&(A=_),(E+=o.readSVarint())<k&&(k=E),E>F&&(F=E);else if(7!==l)throw new Error("unknown command "+l)}return[b,k,A,F]},Hd.prototype.toGeoJSON=function(o,t,l){var f,_,E=this.extent*Math.pow(2,l),b=this.extent*o,A=this.extent*t,k=this.loadGeometry(),F=Hd.types[this.type];function G(le){for(var de=0;de<le.length;de++){var Se=le[de];le[de]=[360*(Se.x+b)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Se.y+A)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(f=0;f<k.length;f++)J[f]=k[f][0];G(k=J);break;case 2:for(f=0;f<k.length;f++)G(k[f]);break;case 3:for(k=function(le){var de=le.length;if(de<=1)return[le];for(var Se,tt,_t=[],At=0;At<de;At++){var yt=Wd(le[At]);0!==yt&&(void 0===tt&&(tt=yt<0),tt===yt<0?(Se&&_t.push(Se),Se=[le[At]]):Se.push(le[At]))}return Se&&_t.push(Se),_t}(k),f=0;f<k.length;f++)for(_=0;_<k[f].length;_++)G(k[f][_])}1===k.length?k=k[0]:F="Multi"+F;var ne={type:"Feature",geometry:{type:F,coordinates:k},properties:this.properties};return"id"in this&&(ne.id=this.id),ne};var qd=Fv,w_=ig;function ig(o,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(sg,this,t),this.length=this._features.length}function sg(o,t,l){15===o?t.version=l.readVarint():1===o?t.name=l.readString():5===o?t.extent=l.readVarint():2===o?t._features.push(l.pos):3===o?t._keys.push(l.readString()):4===o&&t._values.push(function(f){for(var _=null,E=f.readVarint()+f.pos;f.pos<E;){var b=f.readVarint()>>3;_=1===b?f.readString():2===b?f.readFloat():3===b?f.readDouble():4===b?f.readVarint64():5===b?f.readVarint():6===b?f.readSVarint():7===b?f.readBoolean():null}return _}(l))}ig.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var t=this._pbf.readVarint()+this._pbf.pos;return new qd(this._pbf,t,this.extent,this._keys,this._values)};var og=w_;function Rp(o,t,l){if(3===o){var f=new og(l,l.readVarint()+l.pos);f.length&&(t[f.name]=f)}}var Pp=wm.VectorTile=function(o,t){this.layers=o.readFields(Rp,{},t)},Op=wm.VectorTileFeature=Fv;function jf(o,t,l,f){const _=[],E=0===f?(b,A,k,F,G,J)=>{b.push(new Le(J,k+(J-A)/(F-A)*(G-k)))}:(b,A,k,F,G,J)=>{b.push(new Le(A+(J-k)/(G-k)*(F-A),J))};for(const b of o){const A=[];for(const k of b){if(k.length<=2)continue;const F=[];for(let ne=0;ne<k.length-1;ne++){const le=k[ne].x,de=k[ne].y,Se=k[ne+1].x,tt=k[ne+1].y,_t=0===f?le:de,At=0===f?Se:tt;_t<t?At>t&&E(F,le,de,Se,tt,t):_t>l?At<l&&E(F,le,de,Se,tt,l):F.push(k[ne]),At<t&&_t>=t&&E(F,le,de,Se,tt,t),At>l&&_t<=l&&E(F,le,de,Se,tt,l)}let G=k[k.length-1];const J=0===f?G.x:G.y;J>=t&&J<=l&&F.push(G),F.length&&(G=F[F.length-1],F[0].x===G.x&&F[0].y===G.y||F.push(F[0]),A.push(F))}A.length&&_.push(A)}return _}wm.VectorTileLayer=w_;const kp=Op.types,ag=Math.pow(2,13);function Ku(o,t,l,f,_,E,b,A){o.emplaceBack((t<<1)+b,(l<<1)+E,(Math.floor(f*ag)<<1)+_,Math.round(A))}function Tm(o,t,l){o.emplaceBack(t.x,t.y,t.z,16384*l[0],16384*l[1],16384*l[2])}class lg{constructor(){this.acc=new Le(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Le(t.x,t.y),this.max=new Le(t.x,t.y))}append(t,l){this.currentPolyCount.edges++,this.acc._add(t);const f=this.min,_=this.max;t.x<f.x?f.x=t.x:t.x>_.x&&(_.x=t.x),t.y<f.y?f.y=t.y:t.y>_.y&&(_.y=t.y),((0===t.x||t.x===ii)&&t.x===l.x)!=((0===t.y||t.y===ii)&&t.y===l.y)&&this.processBorderOverlap(t,l),l.x<0!=t.x<0&&this.addBorderIntersection(0,ns(l.y,t.y,(0-l.x)/(t.x-l.x))),l.x>ii!=t.x>ii&&this.addBorderIntersection(1,ns(l.y,t.y,(ii-l.x)/(t.x-l.x))),l.y<0!=t.y<0&&this.addBorderIntersection(2,ns(l.x,t.x,(0-l.y)/(t.y-l.y))),l.y>ii!=t.y>ii&&this.addBorderIntersection(3,ns(l.x,t.x,(ii-l.y)/(t.y-l.y)))}addBorderIntersection(t,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[t];l<f[0]&&(f[0]=l),l>f[1]&&(f[1]=l)}processBorderOverlap(t,l){if(t.x===l.x){if(t.y===l.y)return;const f=0===t.x?0:1;this.addBorderIntersection(f,l.y),this.addBorderIntersection(f,t.y)}else{const f=0===t.y?2:3;this.addBorderIntersection(f,l.x),this.addBorderIntersection(f,t.x)}}centroid(){const t=this.polyCount.reduce((l,f)=>l+f.edges,0);return 0!==t?this.acc.div(t)._round():new Le(0,0)}span(){return new Le(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,l)=>t+ +(l[0]!==Number.MAX_VALUE),0)}}class $f{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new Dn,this.centroidVertexArray=new Yr,this.indexArray=new ee,this.programConfigurations=new pa(t.layers,t.zoom),this.segments=new go,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=t.enableTerrain}populate(t,l,f,_){this.features=[],this.hasPattern=tg("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(E){const b=Math.exp(Math.PI*(1-E.y/(1<<E.z)*2));return 80150034*b/(b*b+1)/ii/(1<<E.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:E,id:b,index:A,sourceLayerIndex:k}of t){const F=this.layers[0]._featureFilter.needGeometry,G=zt(E,F);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),G,f))continue;const J={id:b,sourceLayerIndex:k,index:A,geometry:F?G.geometry:We(E,f,_),properties:E.properties,type:E.type,patterns:{}},ne=this.layoutVertexArray.length;this.hasPattern?this.features.push(ng("fill-extrusion",this.layers,J,this.zoom,l)):this.addFeature(J,J.geometry,A,f,{},l.availableImages,_),l.featureIndex.insert(E,J.geometry,A,k,this.index,ne)}this.sortBorders()}addFeatures(t,l,f,_,E){for(const b of this.features){const{geometry:A}=b;this.addFeature(b,A,b.index,l,f,_,E)}this.sortBorders()}update(t,l,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,E_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,uf.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,yh.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,l,f,_,E,b,A){const k=[new Le(0,0),new Le(ii,ii)],F=A.projection,G="globe"===F.name,J=this.enableTerrain&&!G?new lg:null,ne="Polygon"===kp[t.type];G&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Nn);const le=Em(l,500);for(let _t=le.length-1;_t>=0;_t--){const At=le[_t];(0===At.length||(de=At[0]).every(yt=>yt.x<=0)||de.every(yt=>yt.x>=ii)||de.every(yt=>yt.y<=0)||de.every(yt=>yt.y>=ii))&&le.splice(_t,1)}var de;let Se;if(G)Se=Zc(le,k,_);else{Se=[];for(const _t of le)Se.push({polygon:_t,bounds:k})}const tt=ne?this.edgeRadius:0;for(const{polygon:_t,bounds:At}of Se){let yt=0,St=0;for(const kt of _t)ne&&!kt[0].equals(kt[kt.length-1])&&kt.push(kt[0]),St+=ne?kt.length-1:kt.length;const Ft=this.segments.prepareSegment((ne?5:4)*St,this.layoutVertexArray,this.indexArray);if(ne){const kt=[],yn=[];yt=Ft.vertexLength;for(const Fn of _t){let or,En;Fn.length&&Fn!==_t[0]&&yn.push(kt.length/2),or=Fn[1].sub(Fn[0])._perp()._unit();for(let $n=1;$n<Fn.length;$n++){const jn=Fn[$n],tr=Fn[$n===Fn.length-1?1:$n+1];let{x:cr,y:Pn}=jn;if(tt){En=tr.sub(jn)._perp()._unit();const Pr=or.add(En)._unit(),Zr=tt*Math.min(4,1/(or.x*Pr.x+or.y*Pr.y));cr+=Zr*Pr.x,Pn+=Zr*Pr.y,or=En}Ku(this.layoutVertexArray,cr,Pn,0,0,1,1,0),Ft.vertexLength++,kt.push(jn.x,jn.y),G&&Tm(this.layoutVertexExtArray,F.projectTilePoint(cr,Pn,_),F.upVector(_,cr,Pn))}}const pn=Ad(kt,yn);for(let Fn=0;Fn<pn.length;Fn+=3)this.indexArray.emplaceBack(yt+pn[Fn],yt+pn[Fn+2],yt+pn[Fn+1]),Ft.primitiveLength++}for(const kt of _t){J&&kt.length&&J.startRing(kt[0]);let yn,pn,Fn,or=kt.length>4&&hf(kt[kt.length-2],kt[0],kt[1]),En=tt?cg(kt[kt.length-2],kt[0],kt[1],tt):0;pn=kt[1].sub(kt[0])._perp()._unit();let $n=!0;for(let jn=1,tr=0;jn<kt.length;jn++){let cr=kt[jn-1],Pn=kt[jn];const Pr=kt[jn===kt.length-1?1:jn+1];if(J&&ne&&J.currentPolyCount.top++,Gf(Pn,cr,At)){tt&&(pn=Pr.sub(Pn)._perp()._unit(),$n=!$n);continue}J&&J.append(Pn,cr);const Zr=Pn.sub(cr)._perp(),Lr=Zr.x/(Math.abs(Zr.x)+Math.abs(Zr.y)),is=Zr.y>0?1:0,hr=cr.dist(Pn);if(tr+hr>32768&&(tr=0),tt){Fn=Pr.sub(Pn)._perp()._unit();let ss=df(cr,Pn,Pr,Im(pn,Fn),tt);isNaN(ss)&&(ss=0);const Ti=Pn.sub(cr)._unit();cr=cr.add(Ti.mult(En))._round(),Pn=Pn.add(Ti.mult(-ss))._round(),En=ss,pn=Fn}const di=Ft.vertexLength,Zi=kt.length>4&&hf(cr,Pn,Pr);let lo=vh(tr,or,$n);if(Ku(this.layoutVertexArray,cr.x,cr.y,Lr,is,0,0,lo),Ku(this.layoutVertexArray,cr.x,cr.y,Lr,is,0,1,lo),tr+=hr,lo=vh(tr,Zi,!$n),or=Zi,Ku(this.layoutVertexArray,Pn.x,Pn.y,Lr,is,0,0,lo),Ku(this.layoutVertexArray,Pn.x,Pn.y,Lr,is,0,1,lo),Ft.vertexLength+=4,this.indexArray.emplaceBack(di+0,di+1,di+2),this.indexArray.emplaceBack(di+1,di+3,di+2),Ft.primitiveLength+=2,tt){const ss=yt+(1===jn?kt.length-2:jn-2),Ti=1===jn?yt:ss+1;if(this.indexArray.emplaceBack(di+1,ss,di+3),this.indexArray.emplaceBack(ss,Ti,di+3),Ft.primitiveLength+=2,void 0===yn&&(yn=di),!Gf(Pr,kt[jn],At)){const yi=jn===kt.length-1?yn:Ft.vertexLength;this.indexArray.emplaceBack(di+2,di+3,yi),this.indexArray.emplaceBack(di+3,yi+1,yi),this.indexArray.emplaceBack(di+3,Ti,yi+1),Ft.primitiveLength+=3}$n=!$n}if(G){const ss=this.layoutVertexExtArray,Ti=F.projectTilePoint(cr.x,cr.y,_),yi=F.projectTilePoint(Pn.x,Pn.y,_),cs=F.upVector(_,cr.x,cr.y),ts=F.upVector(_,Pn.x,Pn.y);Tm(ss,Ti,cs),Tm(ss,Ti,cs),Tm(ss,yi,ts),Tm(ss,yi,ts)}}ne&&(yt+=kt.length-1)}}if(J&&J.polyCount.length>0){if(J.borders){J.vertexArrayOffset=this.centroidVertexArray.length;const _t=J.borders,At=this.featuresOnBorder.push(J)-1;for(let yt=0;yt<4;yt++)_t[yt][0]!==Number.MAX_VALUE&&this.borders[yt].push(At)}this.encodeCentroid(J.borders?void 0:J.centroid(),J)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,f,E,b,_)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((l,f)=>this.featuresOnBorder[l].borders[t][0]-this.featuresOnBorder[f].borders[t][0])}encodeCentroid(t,l,f=!0){let _,E;if(t)if(0!==t.y){const A=l.span()._mult(this.tileToMeter);_=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(A.x/10)),E=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else _=Math.ceil(7*(t.x+450)),E=0;else _=0,E=+f;let b=f?this.centroidVertexArray.length:l.vertexArrayOffset;for(const A of l.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let k=0;k<A.top;k++)this.centroidVertexArray.emplace(b++,_,E);for(let k=0;k<2*A.edges;k++)this.centroidVertexArray.emplace(b++,0,E),this.centroidVertexArray.emplace(b++,_,E)}}}function Im(o,t){const l=o.add(t)._unit();return o.x*l.x+o.y*l.y}function cg(o,t,l,f){const _=t.sub(o)._perp()._unit(),E=l.sub(t)._perp()._unit();return df(o,t,l,Im(_,E),f)}function df(o,t,l,f,_){const E=Math.sqrt(1-f*f);return Math.min(o.dist(t)/3,t.dist(l)/3,_*E/f)}function Gf(o,t,l){return o.x<l[0].x&&t.x<l[0].x||o.x>l[1].x&&t.x>l[1].x||o.y<l[0].y&&t.y<l[0].y||o.y>l[1].y&&t.y>l[1].y}function hf(o,t,l){if(o.x<0||o.x>=ii||t.x<0||t.x>=ii||l.x<0||l.x>=ii)return!1;const f=l.sub(t),_=f.perp(),E=o.sub(t);return(f.x*E.x+f.y*E.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(E.x*E.x+E.y*E.y))>-.866&&_.x*E.x+_.y*E.y<0}function vh(o,t,l){const f=t?2|o:-3&o;return l?1|f:-2&f}function b_(){const o=Math.PI/32,t=Math.tan(o),l=Ff;return l*Math.sqrt(1+2*t*t)-l}function Zc(o,t,l){const f=1<<l.z,_=qa(l.x/f),E=qa((l.x+1)/f),b=Ka(l.y/f),A=Ka((l.y+1)/f);return function(k,F,G,J,ne=0,le){const de=[];if(!k.length||!G||!J)return de;const Se=(kt,yn)=>{for(const pn of kt)de.push({polygon:pn,bounds:yn})},tt=Math.ceil(Math.log2(G)),_t=Math.ceil(Math.log2(J)),At=tt-_t,yt=[];for(let kt=0;kt<Math.abs(At);kt++)yt.push(At>0?0:1);for(let kt=0;kt<Math.min(tt,_t);kt++)yt.push(0),yt.push(1);let St=k;if(St=jf(St,F[0].y-ne,F[1].y+ne,1),St=jf(St,F[0].x-ne,F[1].x+ne,0),!St.length)return de;const Ft=[];for(yt.length?Ft.push({polygons:St,bounds:F,depth:0}):Se(St,F);Ft.length;){const kt=Ft.pop(),yn=kt.depth,pn=yt[yn],Fn=kt.bounds[0],or=kt.bounds[1],En=0===pn?Fn.x:Fn.y,$n=0===pn?or.x:or.y,jn=le?le(pn,En,$n):.5*(En+$n),tr=jf(kt.polygons,En-ne,jn+ne,pn),cr=jf(kt.polygons,jn-ne,$n+ne,pn);if(tr.length){const Pn=[Fn,new Le(0===pn?jn:or.x,1===pn?jn:or.y)];yt.length>yn+1?Ft.push({polygons:tr,bounds:Pn,depth:yn+1}):Se(tr,Pn)}if(cr.length){const Pn=[new Le(0===pn?jn:Fn.x,1===pn?jn:Fn.y),or];yt.length>yn+1?Ft.push({polygons:cr,bounds:Pn,depth:yn+1}):Se(cr,Pn)}}return de}(o,t,Math.ceil((E-_)/11.25),Math.ceil((b-A)/11.25),1,(k,F,G)=>{if(0===k)return.5*(F+G);{const J=Ka((l.y+F/ii)/f);return(yl(.5*(Ka((l.y+G/ii)/f)+J))*f-l.y)*ii}})}Cr($f,"FillExtrusionBucket",{omit:["layers","features"]}),Cr(lg,"PartMetadata");const xy=new mt({"fill-extrusion-edge-radius":new pe(bt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ug={paint:new mt({"fill-extrusion-opacity":new pe(bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new he(bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pe(bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pe(bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new he(bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new he(bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new he(bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pe(bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new pe(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new pe(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new pe(bt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:xy};function Sm(o,t,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[o*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}class Zu{constructor(t,l,f){this.z=t,this.x=l,this.y=f,this.key=Np(0,t,t,l,f)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,l){const f=(b=this.y,A=this.z,k=Sm(256*(E=this.x),256*(b=Math.pow(2,A)-b-1),A),F=Sm(256*(E+1),256*(b+1),A),k[0]+","+k[1]+","+F[0]+","+F[1]),_=function(E,b,A){let k,F="";for(let G=E;G>0;G--)k=1<<G-1,F+=(b&k?1:0)+(A&k?2:0);return F}(this.z,this.x,this.y);var E,b,A,k,F;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ou{constructor(t,l){this.wrap=t,this.canonical=l,this.key=Np(t,l.z,l.z,l.x,l.y)}}class Yl{constructor(t,l,f,_,E){this.overscaledZ=t,this.wrap=l,this.canonical=new Zu(f,+_,+E),this.key=0===l&&t===f?this.canonical.key:Np(l,t,f,_,E)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const l=this.canonical.z-t;return t>this.canonical.z?new Yl(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yl(t,this.wrap,t,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(t,l=!0){if(this.overscaledZ===t&&l)return this.key;if(t>this.canonical.z)return Np(this.wrap*+l,t,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-t;return Np(this.wrap*+l,t,t,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const l=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>l&&t.canonical.y===this.canonical.y>>l}children(t){if(this.overscaledZ>=t)return[new Yl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new Yl(l,this.wrap,l,f,_),new Yl(l,this.wrap,l,f+1,_),new Yl(l,this.wrap,l,f,_+1),new Yl(l,this.wrap,l,f+1,_+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Yl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Yl(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ou(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Np(o,t,l,f,_){const E=1<<Math.min(l,22);let b=E*(_%E)+f%E;return o&&l<22&&(b+=E*E*((o<0?-2*o-1:2*o)%(1<<2*(22-l)))),16*(32*b+l)+(t-l)}Cr(Zu,"CanonicalTileID"),Cr(Yl,"OverscaledTileID",{omit:["projMatrix"]});class ld extends Le{constructor(t,l,f){super(t,l),this.z=f}}function Am(o,t){return o.x*t.x+o.y*t.y}function Hf(o,t){if(1===o.length){let l=0;const f=t[l++];let _;for(;!_||f.equals(_);)if(_=t[l++],!_)return 1/0;for(;l<t.length;l++){const E=t[l],b=o[0],A=_.sub(f),k=E.sub(f),F=b.sub(f),G=Am(A,A),J=Am(A,k),ne=Am(k,k),le=Am(F,A),de=Am(F,k),Se=G*ne-J*J,tt=(ne*le-J*de)/Se,_t=(G*de-J*le)/Se,At=f.z*(1-tt-_t)+_.z*tt+E.z*_t;if(isFinite(At))return At}return 1/0}{let l=1/0;for(const f of t)l=Math.min(l,f.z);return l}}function T_(o,t,l,f,_,E,b,A){const k=b*_.getElevationAt(o,t,!0,!0),F=0!==E[0],G=F?0===E[1]?b*(E[0]/7-450):b*function(J,ne,le){const de=Math.floor(ne[0]/8),Se=Math.floor(ne[1]/8),tt=10*(ne[0]-8*de),_t=10*(ne[1]-8*Se),At=J.getElevationAt(de,Se,!0,!0),yt=J.getMeterToDEM(le),St=Math.floor(.5*(tt*yt-1)),Ft=Math.floor(.5*(_t*yt-1)),kt=J.tileCoordToPixel(de,Se),yn=2*St+1,pn=2*Ft+1,Fn=(Zr=yn,Lr=pn,[(cr=J).getElevationAtPixel(Pn=kt.x-St,Pr=kt.y-Ft,!0),cr.getElevationAtPixel(Pn+Lr,Pr,!0),cr.getElevationAtPixel(Pn,Pr+Lr,!0),cr.getElevationAtPixel(Pn+Zr,Pr+Lr,!0)]),or=Math.abs(Fn[0]-Fn[1]),En=Math.abs(Fn[2]-Fn[3]),$n=Math.abs(Fn[0]-Fn[2])+Math.abs(Fn[1]-Fn[3]),jn=Math.min(.25,.5*yt*(or+En)/yn),tr=Math.min(.25,.5*yt*$n/pn);var cr,Pn,Pr,Zr,Lr;return At+Math.max(jn*tt,tr*_t)}(_,E,A):k;return{base:k+(0===l)?-1:l,top:F?Math.max(G+f,k+l+2):k+f}}const xh=Kt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ey}=xh,Bv=Kt([{name:"a_packed",components:4,type:"Float32"}]),{members:wy}=Bv,Vv=Op.types,Cm=Math.cos(Math.PI/180*37.5);class cd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(l=>l.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new an,this.layoutVertexArray2=new Kn,this.indexArray=new ee,this.programConfigurations=new pa(t.layers,t.zoom),this.segments=new go,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(t,l,f,_){this.hasPattern=tg("line",this.layers,l);const E=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:G,id:J,index:ne,sourceLayerIndex:le}of t){const de=this.layers[0]._featureFilter.needGeometry,Se=zt(G,de);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),Se,f))continue;const tt=E?E.evaluate(Se,{},f):void 0,_t={id:J,properties:G.properties,type:G.type,sourceLayerIndex:le,index:ne,geometry:de?Se.geometry:We(G,f,_),patterns:{},sortKey:tt};b.push(_t)}E&&b.sort((G,J)=>G.sortKey-J.sortKey);const{lineAtlas:A,featureIndex:k}=l,F=this.addConstantDashes(A);for(const G of b){const{geometry:J,index:ne,sourceLayerIndex:le}=G;if(F&&this.addFeatureDashes(G,A),this.hasPattern){const de=ng("line",this.layers,G,this.zoom,l);this.patternFeatures.push(de)}else this.addFeature(G,J,ne,f,A.positions,l.availableImages);k.insert(t[ne].feature,J,ne,le,this.index)}}addConstantDashes(t){let l=!1;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,E=f.layout.get("line-cap").value;if("constant"!==_.kind||"constant"!==E.kind)l=!0;else{const b=E.value,A=_.value;if(!A)continue;t.addDash(A,b)}}return l}addFeatureDashes(t,l){const f=this.zoom;for(const _ of this.layers){const E=_.paint.get("line-dasharray").value,b=_.layout.get("line-cap").value;if("constant"===E.kind&&"constant"===b.kind)continue;let A,k;if("constant"===E.kind){if(A=E.value,!A)continue}else A=E.evaluate({zoom:f},t);k="constant"===b.kind?b.value:b.evaluate({zoom:f},t),l.addDash(A,k),t.patterns[_.id]=l.getKey(A,k)}}update(t,l,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,l,this.stateDependentLayers,f,_)}addFeatures(t,l,f,_,E){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,wy)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ey),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,l,f,_,E,b){const A=this.layers[0].layout,k=A.get("line-join").evaluate(t,{}),F=A.get("line-cap").evaluate(t,{}),G=A.get("line-miter-limit"),J=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const ne of l)this.addLine(ne,t,k,F,G,J);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,f,E,b,_)}addLine(t,l,f,_,E,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _t=0;_t<t.length-1;_t++)this.totalDistance+=t[_t].dist(t[_t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A="Polygon"===Vv[l.type];let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let F=0;for(;F<k-1&&t[F].equals(t[F+1]);)F++;if(k<(A?3:2))return;"bevel"===f&&(E=1.05);const G=this.overscaling<=16?15*ii/(512*this.overscaling):0,J=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let ne,le,de,Se,tt;this.e1=this.e2=-1,A&&(ne=t[k-2],tt=t[F].sub(ne)._unit()._perp());for(let _t=F;_t<k;_t++){if(de=_t===k-1?A?t[F+1]:void 0:t[_t+1],de&&t[_t].equals(de))continue;tt&&(Se=tt),ne&&(le=ne),ne=t[_t],tt=de?de.sub(ne)._unit()._perp():Se,Se=Se||tt;let At=Se.add(tt);0===At.x&&0===At.y||At._unit();const yt=Se.x*tt.x+Se.y*tt.y,St=At.x*tt.x+At.y*tt.y,Ft=0!==St?1/St:1/0,kt=2*Math.sqrt(2-2*St),yn=St<Cm&&le&&de,pn=Se.x*tt.y-Se.y*tt.x>0;if(yn&&_t>F){const En=ne.dist(le);if(En>2*G){const $n=ne.sub(ne.sub(le)._mult(G/En)._round());this.updateDistance(le,$n),this.addCurrentVertex($n,Se,0,0,J),le=$n}}const Fn=le&&de;let or=Fn?f:A?"butt":_;if(Fn&&"round"===or&&(Ft<b?or="miter":Ft<=2&&(or="fakeround")),"miter"===or&&Ft>E&&(or="bevel"),"bevel"===or&&(Ft>2&&(or="flipbevel"),Ft<E&&(or="miter")),le&&this.updateDistance(le,ne),"miter"===or)At._mult(Ft),this.addCurrentVertex(ne,At,0,0,J);else if("flipbevel"===or){if(Ft>100)At=tt.mult(-1);else{const En=Ft*Se.add(tt).mag()/Se.sub(tt).mag();At._perp()._mult(En*(pn?-1:1))}this.addCurrentVertex(ne,At,0,0,J),this.addCurrentVertex(ne,At.mult(-1),0,0,J)}else if("bevel"===or||"fakeround"===or){const En=-Math.sqrt(Ft*Ft-1),$n=pn?En:0,jn=pn?0:En;if(le&&this.addCurrentVertex(ne,Se,$n,jn,J),"fakeround"===or){const tr=Math.round(180*kt/Math.PI/20);for(let cr=1;cr<tr;cr++){let Pn=cr/tr;if(.5!==Pn){const Zr=Pn-.5;Pn+=Pn*Zr*(Pn-1)*((1.0904+yt*(yt*(3.55645-1.43519*yt)-3.2452))*Zr*Zr+(.848013+yt*(.215638*yt-1.06021)))}const Pr=tt.sub(Se)._mult(Pn)._add(Se)._unit()._mult(pn?-1:1);this.addHalfVertex(ne,Pr.x,Pr.y,!1,pn,0,J)}}de&&this.addCurrentVertex(ne,tt,-$n,-jn,J)}else if("butt"===or)this.addCurrentVertex(ne,At,0,0,J);else if("square"===or){const En=le?1:-1;le||this.addCurrentVertex(ne,At,En,En,J),this.addCurrentVertex(ne,At,0,0,J),le&&this.addCurrentVertex(ne,At,En,En,J)}else"round"===or&&(le&&(this.addCurrentVertex(ne,Se,0,0,J),this.addCurrentVertex(ne,Se,1,1,J,!0)),de&&(this.addCurrentVertex(ne,tt,-1,-1,J,!0),this.addCurrentVertex(ne,tt,0,0,J)));if(yn&&_t<k-1){const En=ne.dist(de);if(En>2*G){const $n=ne.add(de.sub(ne)._mult(G/En)._round());this.updateDistance(ne,$n),this.addCurrentVertex($n,tt,0,0,J),ne=$n}}}}addCurrentVertex(t,l,f,_,E,b=!1){const A=l.y*_-l.x,k=-l.y-l.x*_;this.addHalfVertex(t,l.x+l.y*f,l.y-l.x*f,b,!1,f,E),this.addHalfVertex(t,A,k,b,!0,-_,E)}addHalfVertex({x:t,y:l},f,_,E,b,A,k){this.layoutVertexArray.emplaceBack((t<<1)+(E?1:0),(l<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(0===A?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const F=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),k.primitiveLength++),b?this.e2=F:this.e1=F}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,l){this.distance+=t.dist(l),this.updateScaledDistance()}}Cr(cd,"LineBucket",{omit:["layers","patternFeatures"]});const ff=new mt({"line-cap":new he(bt.layout_line["line-cap"]),"line-join":new he(bt.layout_line["line-join"]),"line-miter-limit":new pe(bt.layout_line["line-miter-limit"]),"line-round-limit":new pe(bt.layout_line["line-round-limit"]),"line-sort-key":new he(bt.layout_line["line-sort-key"])});var dg={paint:new mt({"line-opacity":new he(bt.paint_line["line-opacity"]),"line-color":new he(bt.paint_line["line-color"]),"line-translate":new pe(bt.paint_line["line-translate"]),"line-translate-anchor":new pe(bt.paint_line["line-translate-anchor"]),"line-width":new he(bt.paint_line["line-width"]),"line-gap-width":new he(bt.paint_line["line-gap-width"]),"line-offset":new he(bt.paint_line["line-offset"]),"line-blur":new he(bt.paint_line["line-blur"]),"line-dasharray":new he(bt.paint_line["line-dasharray"]),"line-pattern":new he(bt.paint_line["line-pattern"]),"line-gradient":new gt(bt.paint_line["line-gradient"]),"line-trim-offset":new pe(bt.paint_line["line-trim-offset"])}),layout:ff};const I_=new class extends he{possiblyEvaluate(o,t){return t=new V(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(o,t)}evaluate(o,t,l,f){return t=Qe({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(o,t,l,f)}}(dg.paint.properties["line-width"].specification);function hg(o,t){return t>0?t+2*o:o}I_.useIntegerZoom=!0;const F0=Kt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Uv=Kt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Lp=Kt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Kt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wf=Kt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fg=Kt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const by=Kt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),B0=Kt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Kt([{name:"triangle",components:3,type:"Uint16"}]),Kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Kt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Kt([{type:"Float32",name:"offsetX"}]),Kt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Jl=24;const Dd=128;function S_(o,t){const{expression:l}=t;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new V(o+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:_}=l;let E=0;for(;E<f.length&&f[E]<=o;)E++;E=Math.max(0,E-1);let b=E;for(;b<f.length&&f[b]<o+1;)b++;b=Math.min(f.length-1,b);const A=f[E],k=f[b];return"composite"===l.kind?{kind:"composite",minZoom:A,maxZoom:k,interpolationType:_}:{kind:"camera",minZoom:A,maxZoom:k,minSize:l.evaluate(new V(A)),maxSize:l.evaluate(new V(k)),interpolationType:_}}}function Fp(o,{uSize:t,uSizeT:l},{lowerSize:f,upperSize:_}){return"source"===o.kind?f/Dd:"composite"===o.kind?ns(f/Dd,_/Dd,l):t}function xl(o,t){let l=0,f=0;if("constant"===o.kind)f=o.layoutSize;else if("source"!==o.kind){const{interpolationType:_,minZoom:E,maxZoom:b}=o,A=_?qt(Ca.interpolationFactor(_,t,E,b),0,1):0;"camera"===o.kind?f=ns(o.minSize,o.maxSize,A):l=A}return{uSizeT:l,uSize:f}}var zv=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Dd,evaluateSizeForFeature:Fp,evaluateSizeForZoom:xl,getSizeData:S_});function Ty(o,t,l){return o.sections.forEach(f=>{f.text=function(_,E,b){const A=E.layout.get("text-transform").evaluate(b,{});return"uppercase"===A?_=_.toLocaleUpperCase():"lowercase"===A&&(_=_.toLocaleLowerCase()),P.applyArabicShaping&&(_=P.applyArabicShaping(_)),_}(f.text,t,l)}),o}const Bp={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function jv(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function A_(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var C_=Fo,pf=function(o,t,l,f,_){var E,b,A=8*_-f-1,k=(1<<A)-1,F=k>>1,G=-7,J=l?_-1:0,ne=l?-1:1,le=o[t+J];for(J+=ne,E=le&(1<<-G)-1,le>>=-G,G+=A;G>0;E=256*E+o[t+J],J+=ne,G-=8);for(b=E&(1<<-G)-1,E>>=-G,G+=f;G>0;b=256*b+o[t+J],J+=ne,G-=8);if(0===E)E=1-F;else{if(E===k)return b?NaN:1/0*(le?-1:1);b+=Math.pow(2,f),E-=F}return(le?-1:1)*b*Math.pow(2,E-f)},Vp=function(o,t,l,f,_,E){var b,A,k,F=8*E-_-1,G=(1<<F)-1,J=G>>1,ne=23===_?Math.pow(2,-24)-Math.pow(2,-77):0,le=f?0:E-1,de=f?1:-1,Se=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(A=isNaN(t)?1:0,b=G):(b=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-b))<1&&(b--,k*=2),(t+=b+J>=1?ne/k:ne*Math.pow(2,1-J))*k>=2&&(b++,k/=2),b+J>=G?(A=0,b=G):b+J>=1?(A=(t*k-1)*Math.pow(2,_),b+=J):(A=t*Math.pow(2,J-1)*Math.pow(2,_),b=0));_>=8;o[l+le]=255&A,le+=de,A/=256,_-=8);for(b=b<<_|A,F+=_;F>0;o[l+le]=255&b,le+=de,b/=256,F-=8);o[l+le-de]|=128*Se};function Fo(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Fo.Varint=0,Fo.Fixed64=1,Fo.Bytes=2,Fo.Fixed32=5;var pg=4294967296,Kd=1/pg,Dm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Xu(o){return o.type===Fo.Bytes?o.readVarint()+o.pos:o.pos+1}function Mm(o,t,l){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));l.realloc(f);for(var _=l.pos-1;_>=o;_--)l.buf[_+f]=l.buf[_]}function D_(o,t){for(var l=0;l<o.length;l++)t.writeVarint(o[l])}function $v(o,t){for(var l=0;l<o.length;l++)t.writeSVarint(o[l])}function Iy(o,t){for(var l=0;l<o.length;l++)t.writeFloat(o[l])}function Gv(o,t){for(var l=0;l<o.length;l++)t.writeDouble(o[l])}function M_(o,t){for(var l=0;l<o.length;l++)t.writeBoolean(o[l])}function Hv(o,t){for(var l=0;l<o.length;l++)t.writeFixed32(o[l])}function Sy(o,t){for(var l=0;l<o.length;l++)t.writeSFixed32(o[l])}function Rm(o,t){for(var l=0;l<o.length;l++)t.writeFixed64(o[l])}function Ay(o,t){for(var l=0;l<o.length;l++)t.writeSFixed64(o[l])}function mg(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+16777216*o[t+3]}function qf(o,t,l){o[l]=t,o[l+1]=t>>>8,o[l+2]=t>>>16,o[l+3]=t>>>24}function R_(o,t){return(o[t]|o[t+1]<<8|o[t+2]<<16)+(o[t+3]<<24)}Fo.prototype={destroy:function(){this.buf=null},readFields:function(o,t,l){for(l=l||this.length;this.pos<l;){var f=this.readVarint(),_=f>>3,E=this.pos;this.type=7&f,o(_,t,this),this.pos===E&&this.skip(f)}return t},readMessage:function(o,t){return this.readFields(o,t,this.readVarint()+this.pos)},readFixed32:function(){var o=mg(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=R_(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=mg(this.buf,this.pos)+mg(this.buf,this.pos+4)*pg;return this.pos+=8,o},readSFixed64:function(){var o=mg(this.buf,this.pos)+R_(this.buf,this.pos+4)*pg;return this.pos+=8,o},readFloat:function(){var o=pf(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=pf(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var t,l,f=this.buf;return t=127&(l=f[this.pos++]),l<128?t:(t|=(127&(l=f[this.pos++]))<<7,l<128?t:(t|=(127&(l=f[this.pos++]))<<14,l<128?t:(t|=(127&(l=f[this.pos++]))<<21,l<128?t:function(_,E,b){var A,k,F=b.buf;if(A=(112&(k=F[b.pos++]))>>4,k<128||(A|=(127&(k=F[b.pos++]))<<3,k<128)||(A|=(127&(k=F[b.pos++]))<<10,k<128)||(A|=(127&(k=F[b.pos++]))<<17,k<128)||(A|=(127&(k=F[b.pos++]))<<24,k<128)||(A|=(1&(k=F[b.pos++]))<<31,k<128))return function Md(o,t,l){return l?4294967296*t+(o>>>0):4294967296*(t>>>0)+(o>>>0)}(_,A,E);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(l=f[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,t=this.pos;return this.pos=o,o-t>=12&&Dm?Dm.decode(this.buf.subarray(t,o)):function(l,f,_){for(var E="",b=f;b<_;){var A,k,F,G=l[b],J=null,ne=G>239?4:G>223?3:G>191?2:1;if(b+ne>_)break;1===ne?G<128&&(J=G):2===ne?128==(192&(A=l[b+1]))&&(J=(31&G)<<6|63&A)<=127&&(J=null):3===ne?(k=l[b+2],128==(192&(A=l[b+1]))&&128==(192&k)&&((J=(15&G)<<12|(63&A)<<6|63&k)<=2047||J>=55296&&J<=57343)&&(J=null)):4===ne&&(k=l[b+2],F=l[b+3],128==(192&(A=l[b+1]))&&128==(192&k)&&128==(192&F)&&((J=(15&G)<<18|(63&A)<<12|(63&k)<<6|63&F)<=65535||J>=1114112)&&(J=null)),null===J?(J=65533,ne=1):J>65535&&(J-=65536,E+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),E+=String.fromCharCode(J),b+=ne}return E}(this.buf,t,o)},readBytes:function(){var o=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,o);return this.pos=o,t},readPackedVarint:function(o,t){if(this.type!==Fo.Bytes)return o.push(this.readVarint(t));var l=Xu(this);for(o=o||[];this.pos<l;)o.push(this.readVarint(t));return o},readPackedSVarint:function(o){if(this.type!==Fo.Bytes)return o.push(this.readSVarint());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Fo.Bytes)return o.push(this.readBoolean());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Fo.Bytes)return o.push(this.readFloat());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Fo.Bytes)return o.push(this.readDouble());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Fo.Bytes)return o.push(this.readFixed32());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Fo.Bytes)return o.push(this.readSFixed32());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Fo.Bytes)return o.push(this.readFixed64());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Fo.Bytes)return o.push(this.readSFixed64());var t=Xu(this);for(o=o||[];this.pos<t;)o.push(this.readSFixed64());return o},skip:function(o){var t=7&o;if(t===Fo.Varint)for(;this.buf[this.pos++]>127;);else if(t===Fo.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Fo.Fixed32)this.pos+=4;else{if(t!==Fo.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(o,t){this.writeVarint(o<<3|t)},realloc:function(o){for(var t=this.length||16;t<this.pos+o;)t*=2;if(t!==this.length){var l=new Uint8Array(t);l.set(this.buf),this.buf=l,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),qf(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),qf(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),qf(this.buf,-1&o,this.pos),qf(this.buf,Math.floor(o*Kd),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),qf(this.buf,-1&o,this.pos),qf(this.buf,Math.floor(o*Kd),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(t,l){var f,_,E,A;if(t>=0?(f=t%4294967296|0,_=t/4294967296|0):(_=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,_=_+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),E=f,(A=l).buf[A.pos++]=127&E|128,E>>>=7,A.buf[A.pos++]=127&E|128,E>>>=7,A.buf[A.pos++]=127&E|128,E>>>=7,A.buf[A.pos++]=127&E|128,A.buf[A.pos]=127&(E>>>=7),function(E,b){var A=(7&E)<<4;b.buf[b.pos++]|=A|((E>>>=3)?128:0),E&&(b.buf[b.pos++]=127&E|((E>>>=7)?128:0),E&&(b.buf[b.pos++]=127&E|((E>>>=7)?128:0),E&&(b.buf[b.pos++]=127&E|((E>>>=7)?128:0),E&&(b.buf[b.pos++]=127&E|((E>>>=7)?128:0),E&&(b.buf[b.pos++]=127&E)))))}(_,l)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var t=this.pos;this.pos=function(f,_,E){for(var b,A,k=0;k<_.length;k++){if((b=_.charCodeAt(k))>55295&&b<57344){if(!A){b>56319||k+1===_.length?(f[E++]=239,f[E++]=191,f[E++]=189):A=b;continue}if(b<56320){f[E++]=239,f[E++]=191,f[E++]=189,A=b;continue}b=A-55296<<10|b-56320|65536,A=null}else A&&(f[E++]=239,f[E++]=191,f[E++]=189,A=null);b<128?f[E++]=b:(b<2048?f[E++]=b>>6|192:(b<65536?f[E++]=b>>12|224:(f[E++]=b>>18|240,f[E++]=b>>12&63|128),f[E++]=b>>6&63|128),f[E++]=63&b|128)}return E}(this.buf,o,this.pos);var l=this.pos-t;l>=128&&Mm(t,l,this),this.pos=t-1,this.writeVarint(l),this.pos+=l},writeFloat:function(o){this.realloc(4),Vp(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Vp(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var t=o.length;this.writeVarint(t),this.realloc(t);for(var l=0;l<t;l++)this.buf[this.pos++]=o[l]},writeRawMessage:function(o,t){this.pos++;var l=this.pos;o(t,this);var f=this.pos-l;f>=128&&Mm(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeMessage:function(o,t,l){this.writeTag(o,Fo.Bytes),this.writeRawMessage(t,l)},writePackedVarint:function(o,t){t.length&&this.writeMessage(o,D_,t)},writePackedSVarint:function(o,t){t.length&&this.writeMessage(o,$v,t)},writePackedBoolean:function(o,t){t.length&&this.writeMessage(o,M_,t)},writePackedFloat:function(o,t){t.length&&this.writeMessage(o,Iy,t)},writePackedDouble:function(o,t){t.length&&this.writeMessage(o,Gv,t)},writePackedFixed32:function(o,t){t.length&&this.writeMessage(o,Hv,t)},writePackedSFixed32:function(o,t){t.length&&this.writeMessage(o,Sy,t)},writePackedFixed64:function(o,t){t.length&&this.writeMessage(o,Rm,t)},writePackedSFixed64:function(o,t){t.length&&this.writeMessage(o,Ay,t)},writeBytesField:function(o,t){this.writeTag(o,Fo.Bytes),this.writeBytes(t)},writeFixed32Field:function(o,t){this.writeTag(o,Fo.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(o,t){this.writeTag(o,Fo.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(o,t){this.writeTag(o,Fo.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(o,t){this.writeTag(o,Fo.Fixed64),this.writeSFixed64(t)},writeVarintField:function(o,t){this.writeTag(o,Fo.Varint),this.writeVarint(t)},writeSVarintField:function(o,t){this.writeTag(o,Fo.Varint),this.writeSVarint(t)},writeStringField:function(o,t){this.writeTag(o,Fo.Bytes),this.writeString(t)},writeFloatField:function(o,t){this.writeTag(o,Fo.Fixed32),this.writeFloat(t)},writeDoubleField:function(o,t){this.writeTag(o,Fo.Fixed64),this.writeDouble(t)},writeBooleanField:function(o,t){this.writeVarintField(o,!!t)}};var Eh=ht(C_);const mf=3;function P_(o,t,l){t.glyphs=[],1===o&&l.readMessage(gg,t)}function gg(o,t,l){if(3===o){const{id:f,bitmap:_,width:E,height:b,left:A,top:k,advance:F}=l.readMessage(Cy,{});t.glyphs.push({id:f,bitmap:new Id({width:E+2*mf,height:b+2*mf},_),metrics:{width:E,height:b,left:A,top:k,advance:F}})}else 4===o?t.ascender=l.readSVarint():5===o&&(t.descender=l.readSVarint())}function Cy(o,t,l){1===o?t.id=l.readVarint():2===o?t.bitmap=l.readBytes():3===o?t.width=l.readVarint():4===o?t.height=l.readVarint():5===o?t.left=l.readSVarint():6===o?t.top=l.readSVarint():7===o&&(t.advance=l.readVarint())}const O_=mf;function Up(o){let t=0,l=0;for(const b of o)t+=b.w*b.h,l=Math.max(l,b.w);o.sort((b,A)=>A.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),l),h:1/0}];let _=0,E=0;for(const b of o)for(let A=f.length-1;A>=0;A--){const k=f[A];if(!(b.w>k.w||b.h>k.h)){if(b.x=k.x,b.y=k.y,E=Math.max(E,b.y+b.h),_=Math.max(_,b.x+b.w),b.w===k.w&&b.h===k.h){const F=f.pop();A<f.length&&(f[A]=F)}else b.h===k.h?(k.x+=b.w,k.w-=b.w):b.w===k.w?(k.y+=b.h,k.h-=b.h):(f.push({x:k.x+b.w,y:k.y,w:k.w-b.w,h:b.h}),k.y+=b.h,k.h-=b.h);break}}return{w:_,h:E,fill:t/(_*E)||0}}const ku=1;class _g{constructor(t,{pixelRatio:l,version:f,stretchX:_,stretchY:E,content:b}){this.paddedRect=t,this.pixelRatio=l,this.stretchX=_,this.stretchY=E,this.content=b,this.version=f}get tl(){return[this.paddedRect.x+ku,this.paddedRect.y+ku]}get br(){return[this.paddedRect.x+this.paddedRect.w-ku,this.paddedRect.y+this.paddedRect.h-ku]}get displaySize(){return[(this.paddedRect.w-2*ku)/this.pixelRatio,(this.paddedRect.h-2*ku)/this.pixelRatio]}}class yg{constructor(t,l){const f={},_={};this.haveRenderCallbacks=[];const E=[];this.addImages(t,f,E),this.addImages(l,_,E);const{w:b,h:A}=Up(E),k=new Kc({width:b||1,height:A||1});for(const F in t){const G=t[F],J=f[F].paddedRect;Kc.copy(G.data,k,{x:0,y:0},{x:J.x+ku,y:J.y+ku},G.data)}for(const F in l){const G=l[F],J=_[F].paddedRect,ne=J.x+ku,le=J.y+ku,de=G.data.width,Se=G.data.height;Kc.copy(G.data,k,{x:0,y:0},{x:ne,y:le},G.data),Kc.copy(G.data,k,{x:0,y:Se-1},{x:ne,y:le-1},{width:de,height:1}),Kc.copy(G.data,k,{x:0,y:0},{x:ne,y:le+Se},{width:de,height:1}),Kc.copy(G.data,k,{x:de-1,y:0},{x:ne-1,y:le},{width:1,height:Se}),Kc.copy(G.data,k,{x:0,y:0},{x:ne+de,y:le},{width:1,height:Se})}this.image=k,this.iconPositions=f,this.patternPositions=_}addImages(t,l,f){for(const _ in t){const E=t[_],b={x:0,y:0,w:E.data.width+2*ku,h:E.data.height+2*ku};f.push(b),l[_]=new _g(b,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(t,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>t.hasImage(f)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in t.updatedImages)this.patchUpdatedImage(this.iconPositions[f],t.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],t.getImage(f),l)}patchUpdatedImage(t,l,f){if(!t||!l||t.version===l.version)return;t.version=l.version;const[_,E]=t.tl;f.update(l.data,void 0,{x:_,y:E})}}Cr(_g,"ImagePosition"),Cr(yg,"ImageAtlas");const Nu={horizontal:1,vertical:2,horizontalOnly:3},Dy=-17;class Pm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,l){const f=new Pm;return f.scale=t||1,f.fontStack=l,f}static forImage(t){const l=new Pm;return l.imageName=t,l}}class Kf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,l){const f=new Kf;for(let _=0;_<t.sections.length;_++){const E=t.sections[_];E.image?f.addImageSection(E):f.addTextSection(E,l)}return f}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(l,f){let _="";for(let E=0;E<l.length;E++){const b=l.charCodeAt(E+1)||null,A=l.charCodeAt(E-1)||null;_+=!f&&(b&&td(b)&&!Bp[l[E+1]]||A&&td(A)&&!Bp[l[E-1]])||!Bp[l[E]]?l[E]:Bp[l[E]]}return _}(this.text,t)}trim(){let t=0;for(let f=0;f<this.text.length&&gf[this.text.charCodeAt(f)];f++)t++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=t&&gf[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(t,l),this.sectionIndex=this.sectionIndex.slice(t,l)}substring(t,l){const f=new Kf;return f.text=this.text.substring(t,l),f.sectionIndex=this.sectionIndex.slice(t,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,l)=>Math.max(t,this.sections[l].scale),0)}addTextSection(t,l){this.text+=t.text,this.sections.push(Pm.forText(t.scale,t.fontStack||l));const f=this.sections.length-1;for(let _=0;_<t.text.length;++_)this.sectionIndex.push(f)}addImageSection(t){const l=t.image?t.image.name:"";if(0===l.length)return void ur("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Pm.forImage(l)),this.sectionIndex.push(this.sections.length-1)):ur("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Om(o,t,l,f,_,E,b,A,k,F,G,J,ne,le,de){const Se=Kf.fromFeature(o,_);J===Nu.vertical&&Se.verticalizePunctuation(ne);let tt=[];const _t=function(kt,yn,pn,Fn,or,En){if(!kt)return[];const $n=[],jn=function(Pr,Zr,Lr,is,hr,di){let Zi=0;for(let lo=0;lo<Pr.length();lo++){const ss=Pr.getSection(lo);Zi+=Xf(Pr.getCharCode(lo),ss,is,hr,Zr,di)}return Zi/Math.max(1,Math.ceil(Zi/Lr))}(kt,yn,pn,Fn,or,En),tr=kt.text.indexOf("\u200b")>=0;let cr=0;for(let Pr=0;Pr<kt.length();Pr++){const Zr=kt.getSection(Pr),Lr=kt.getCharCode(Pr);if(gf[Lr]||(cr+=Xf(Lr,Zr,Fn,or,yn,En)),Pr<kt.length()-1){const is=!((Pn=Lr)<11904||!(vr["Bopomofo Extended"](Pn)||vr.Bopomofo(Pn)||vr["CJK Compatibility Forms"](Pn)||vr["CJK Compatibility Ideographs"](Pn)||vr["CJK Compatibility"](Pn)||vr["CJK Radicals Supplement"](Pn)||vr["CJK Strokes"](Pn)||vr["CJK Symbols and Punctuation"](Pn)||vr["CJK Unified Ideographs Extension A"](Pn)||vr["CJK Unified Ideographs"](Pn)||vr["Enclosed CJK Letters and Months"](Pn)||vr["Halfwidth and Fullwidth Forms"](Pn)||vr.Hiragana(Pn)||vr["Ideographic Description Characters"](Pn)||vr["Kangxi Radicals"](Pn)||vr["Katakana Phonetic Extensions"](Pn)||vr.Katakana(Pn)||vr["Vertical Forms"](Pn)||vr["Yi Radicals"](Pn)||vr["Yi Syllables"](Pn)));(Zf[Lr]||is||Zr.imageName)&&$n.push(xg(Pr+1,cr,jn,$n,vg(Lr,kt.getCharCode(Pr+1),is&&tr),!1))}}var Pn;return k_(xg(kt.length(),cr,jn,$n,0,!0))}(Se,F,E,t,f,le),{processBidirectionalText:At,processStyledBidirectionalText:yt}=P;if(At&&1===Se.sections.length){const kt=At(Se.toString(),_t);for(const yn of kt){const pn=new Kf;pn.text=yn,pn.sections=Se.sections;for(let Fn=0;Fn<yn.length;Fn++)pn.sectionIndex.push(0);tt.push(pn)}}else if(yt){const kt=yt(Se.text,Se.sectionIndex,_t);for(const yn of kt){const pn=new Kf;pn.text=yn[0],pn.sectionIndex=yn[1],pn.sections=Se.sections,tt.push(pn)}}else tt=function(kt,yn){const pn=[],Fn=kt.text;let or=0;for(const En of yn)pn.push(kt.substring(or,En)),or=En;return or<Fn.length&&pn.push(kt.substring(or,Fn.length)),pn}(Se,_t);const St=[],Ft={positionedLines:St,text:Se.toString(),top:G[1],bottom:G[1],left:G[0],right:G[0],writingMode:J,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(kt,yn,pn,Fn,or,En,$n,jn,tr,cr,Pn,Pr){let Zr=0,Lr=0,is=0;const hr="right"===jn?1:"left"===jn?0:.5;let di=!1;for(const cs of or){const ts=cs.getSections();for(const Ys of ts){if(Ys.imageName)continue;const Go=yn[Ys.fontStack];if(Go&&(di=void 0!==Go.ascender&&void 0!==Go.descender,!di))break}if(!di)break}let Zi=0;for(const cs of or){cs.trim();const ts=cs.getMaxScale(),Ys=(ts-1)*Jl,Go={positionedGlyphs:[],lineOffset:0};kt.positionedLines[Zi]=Go;const ms=Go.positionedGlyphs;let Vi=0;if(!cs.length()){Lr+=En,++Zi;continue}let Io=0,Oa=0;for(let _o=0;_o<cs.length();_o++){const wl=cs.getSection(_o),ka=cs.getSectionIndex(_o),Na=cs.getCharCode(_o);let co=wl.scale,sl=null,Zo=null,qs=null,Ea=Jl,pc=0;const Ks=!(tr===Nu.horizontal||!Pn&&!Gu(Na)||Pn&&(gf[Na]||(lo=Na,vr.Arabic(lo)||vr["Arabic Supplement"](lo)||vr["Arabic Extended-A"](lo)||vr["Arabic Presentation Forms-A"](lo)||vr["Arabic Presentation Forms-B"](lo))));if(wl.imageName){const Fc=Fn[wl.imageName];if(!Fc)continue;qs=wl.imageName,kt.iconsInText=kt.iconsInText||!0,Zo=Fc.paddedRect;const mc=Fc.displaySize;co=co*Jl/Pr,sl={width:mc[0],height:mc[1],left:ku,top:-O_,advance:Ks?mc[1]:mc[0],localGlyph:!1},pc=di?-sl.height*co:Dy+ts*Jl-mc[1]*co,Ea=sl.advance;const gd=(Ks?mc[0]:mc[1])*co-Jl*ts;gd>0&&gd>Vi&&(Vi=gd)}else{const Fc=pn[wl.fontStack];if(!Fc)continue;Fc[Na]&&(Zo=Fc[Na]);const mc=yn[wl.fontStack];if(!mc)continue;const gd=mc.glyphs[Na];if(!gd)continue;if(sl=gd.metrics,Ea=8203!==Na?Jl:0,di){const im=void 0!==mc.ascender?Math.abs(mc.ascender):0,jm=void 0!==mc.descender?Math.abs(mc.descender):0,Ph=(im+jm)*co;Io<Ph&&(Io=Ph,Oa=(im-jm)/2*co),pc=-im*co}else pc=Dy+(ts-co)*Jl}Ks?(kt.verticalizable=!0,ms.push({glyph:Na,imageName:qs,x:Zr,y:Lr+pc,vertical:Ks,scale:co,localGlyph:sl.localGlyph,fontStack:wl.fontStack,sectionIndex:ka,metrics:sl,rect:Zo}),Zr+=Ea*co+cr):(ms.push({glyph:Na,imageName:qs,x:Zr,y:Lr+pc,vertical:Ks,scale:co,localGlyph:sl.localGlyph,fontStack:wl.fontStack,sectionIndex:ka,metrics:sl,rect:Zo}),Zr+=sl.advance*co+cr)}0!==ms.length&&(is=Math.max(Zr-cr,is),di?jp(ms,hr,Vi,Oa,En*ts/2):jp(ms,hr,Vi,0,En/2)),Zr=0;const El=En*ts+Vi;Go.lineOffset=Math.max(Vi,Ys),Lr+=El,++Zi}var lo;const ss=Lr,{horizontalAlign:Ti,verticalAlign:yi}=Eg($n);(function(cs,ts,Ys,Go,ms,Vi){const Io=(ts-Ys)*ms,Oa=-Vi*Go;for(const El of cs)for(const _o of El.positionedGlyphs)_o.x+=Io,_o.y+=Oa})(kt.positionedLines,hr,Ti,yi,is,ss),kt.top+=-yi*ss,kt.bottom=kt.top+ss,kt.left+=-Ti*is,kt.right=kt.left+is,kt.hasBaseline=di}(Ft,t,l,f,tt,b,A,k,J,F,ne,de),!function(kt){for(const yn of kt)if(0!==yn.positionedGlyphs.length)return!1;return!0}(St)&&Ft}const gf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zf={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xf(o,t,l,f,_,E){if(t.imageName){const b=f[t.imageName];return b?b.displaySize[0]*t.scale*Jl/E+_:0}{const b=l[t.fontStack],A=b&&b.glyphs[o];return A?A.metrics.advance*t.scale+_:0}}function zp(o,t,l,f){const _=Math.pow(o-t,2);return f?o<t?_/2:2*_:_+Math.abs(l)*l}function vg(o,t,l){let f=0;return 10===o&&(f-=1e4),l&&(f+=150),40!==o&&65288!==o||(f+=50),41!==t&&65289!==t||(f+=50),f}function xg(o,t,l,f,_,E){let b=null,A=zp(t,l,_,E);for(const k of f){const F=zp(t-k.x,l,_,E)+k.badness;F<=A&&(b=k,A=F)}return{index:o,x:t,priorBreak:b,badness:A}}function k_(o){return o?k_(o.priorBreak).concat(o.index):[]}function Eg(o){let t=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:t,verticalAlign:l}}function jp(o,t,l,f,_){if(!(t||l||f||_))return;const E=o.length-1,b=o[E],A=(b.x+b.metrics.advance*b.scale)*t;for(let k=0;k<=E;k++)o[k].x-=A,o[k].y+=l+f+_}function _f(o,t,l){const{horizontalAlign:f,verticalAlign:_}=Eg(l),E=t[0]-o.displaySize[0]*f,b=t[1]-o.displaySize[1]*_;return{image:o,top:b,bottom:b+o.displaySize[1],left:E,right:E+o.displaySize[0]}}function Lu(o,t,l,f,_,E){const b=o.image;let A;if(b.content){const tt=b.content,_t=b.pixelRatio||1;A=[tt[0]/_t,tt[1]/_t,b.displaySize[0]-tt[2]/_t,b.displaySize[1]-tt[3]/_t]}const k=t.left*E,F=t.right*E;let G,J,ne,le;"width"===l||"both"===l?(le=_[0]+k-f[3],J=_[0]+F+f[1]):(le=_[0]+(k+F-b.displaySize[0])/2,J=le+b.displaySize[0]);const de=t.top*E,Se=t.bottom*E;return"height"===l||"both"===l?(G=_[1]+de-f[0],ne=_[1]+Se+f[2]):(G=_[1]+(de+Se-b.displaySize[1])/2,ne=G+b.displaySize[1]),{image:b,top:G,right:J,bottom:ne,left:le,collisionPadding:A}}class cu extends Le{constructor(t,l,f,_,E){super(t,l),this.angle=_,this.z=f,void 0!==E&&(this.segment=E)}clone(){return new cu(this.x,this.y,this.z,this.angle,this.segment)}}function Lc(o,t,l,f,_){if(void 0===t.segment)return!0;let E=t,b=t.segment+1,A=0;for(;A>-l/2;){if(b--,b<0)return!1;A-=o[b].dist(E),E=o[b]}A+=o[b].dist(o[b+1]),b++;const k=[];let F=0;for(;A<l/2;){const G=o[b],J=o[b+1];if(!J)return!1;let ne=o[b-1].angleTo(G)-G.angleTo(J);for(ne=Math.abs((ne+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:A,angleDelta:ne}),F+=ne;A-k[0].distance>f;)F-=k.shift().angleDelta;if(F>_)return!1;b++,A+=G.dist(J)}return!0}function Wv(o){let t=0;for(let l=0;l<o.length-1;l++)t+=o[l].dist(o[l+1]);return t}function N_(o,t,l){return o?.6*t*l:0}function wg(o,t){return Math.max(o?o.right-o.left:0,t?t.right-t.left:0)}function bg(o,t,l,f,_,E){const b=N_(l,_,E),A=wg(l,f)*E;let k=0;const F=Wv(o)/2;for(let G=0;G<o.length-1;G++){const J=o[G],ne=o[G+1],le=J.dist(ne);if(k+le>F){const de=(F-k)/le,Se=ns(J.x,ne.x,de),tt=ns(J.y,ne.y,de),_t=new cu(Se,tt,0,ne.angleTo(J),G);return!b||Lc(o,_t,A,b,t)?_t:void 0}k+=le}}function Tg(o,t,l,f,_,E,b,A,k){const F=N_(f,E,b),G=wg(f,_),J=G*b,ne=0===o[0].x||o[0].x===k||0===o[0].y||o[0].y===k;return t-J<t/4&&(t=J+t/4),Ig(o,ne?t/2*A%t:(G/2+2*E)*b*A%t,t,F,l,J,ne,!1,k)}function Ig(o,t,l,f,_,E,b,A,k){const F=E/2,G=Wv(o);let J=0,ne=t-l,le=[];for(let de=0;de<o.length-1;de++){const Se=o[de],tt=o[de+1],_t=Se.dist(tt),At=tt.angleTo(Se);for(;ne+l<J+_t;){ne+=l;const yt=(ne-J)/_t,St=ns(Se.x,tt.x,yt),Ft=ns(Se.y,tt.y,yt);if(St>=0&&St<k&&Ft>=0&&Ft<k&&ne-F>=0&&ne+F<=G){const kt=new cu(St,Ft,0,At,de);kt._round(),f&&!Lc(o,kt,E,f,_)||le.push(kt)}}J+=_t}return A||le.length||b||(le=Ig(o,J/2,l,f,_,E,b,!0,k)),le}function qv(o,t,l,f,_){const E=[];for(let b=0;b<o.length;b++){const A=o[b];let k;for(let F=0;F<A.length-1;F++){let G=A[F],J=A[F+1];G.x<t&&J.x<t||(G.x<t?G=new Le(t,G.y+(t-G.x)/(J.x-G.x)*(J.y-G.y))._round():J.x<t&&(J=new Le(t,G.y+(t-G.x)/(J.x-G.x)*(J.y-G.y))._round()),G.y<l&&J.y<l||(G.y<l?G=new Le(G.x+(l-G.y)/(J.y-G.y)*(J.x-G.x),l)._round():J.y<l&&(J=new Le(G.x+(l-G.y)/(J.y-G.y)*(J.x-G.x),l)._round()),G.x>=f&&J.x>=f||(G.x>=f?G=new Le(f,G.y+(f-G.x)/(J.x-G.x)*(J.y-G.y))._round():J.x>=f&&(J=new Le(f,G.y+(f-G.x)/(J.x-G.x)*(J.y-G.y))._round()),G.y>=_&&J.y>=_||(G.y>=_?G=new Le(G.x+(_-G.y)/(J.y-G.y)*(J.x-G.x),_)._round():J.y>=_&&(J=new Le(G.x+(_-G.y)/(J.y-G.y)*(J.x-G.x),_)._round()),k&&G.equals(k[k.length-1])||(k=[G],E.push(k)),k.push(J)))))}}return E}Cr(cu,"Anchor");const yf=1e20;function Sg(o,t,l,f,_,E,b,A,k){for(let F=t;F<t+f;F++)Ag(o,l*E+F,E,_,b,A,k);for(let F=l;F<l+_;F++)Ag(o,F*E+t,1,f,b,A,k)}function Ag(o,t,l,f,_,E,b){E[0]=0,b[0]=-yf,b[1]=yf,_[0]=o[t];for(let A=1,k=0,F=0;A<f;A++){_[A]=o[t+A*l];const G=A*A;do{const J=E[k];F=(_[A]-_[J]+G-J*J)/(A-J)/2}while(F<=b[k]&&--k>-1);k++,E[k]=A,b[k]=F,b[k+1]=yf}for(let A=0,k=0;A<f;A++){for(;b[k+1]<A;)k++;const F=E[k],G=A-F;o[t+A*l]=_[F]+G*G}}const Qu=2,vf={none:0,ideographs:1,all:2};class xf{constructor(t,l,f){this.requestManager=t,this.localGlyphMode=l,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,l){const f=[];for(const _ in t)for(const E of t[_])f.push({stack:_,id:E});Ct(f,({stack:_,id:E},b)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let k=A.glyphs[E];if(void 0!==k)return void b(null,{stack:_,id:E,glyph:k});if(k=this._tinySDF(A,_,E),k)return A.glyphs[E]=k,void b(null,{stack:_,id:E,glyph:k});const F=Math.floor(E/256);if(256*F>65535)return void b(new Error("glyphs > 65535 not supported"));if(A.ranges[F])return void b(null,{stack:_,id:E,glyph:k});let G=A.requests[F];G||(G=A.requests[F]=[],xf.loadGlyphRange(_,F,this.url,this.requestManager,(J,ne)=>{if(ne){A.ascender=ne.ascender,A.descender=ne.descender;for(const le in ne.glyphs)this._doesCharSupportLocalGlyph(+le)||(A.glyphs[+le]=ne.glyphs[+le]);A.ranges[F]=!0}for(const le of G)le(J,ne);delete A.requests[F]})),G.push((J,ne)=>{J?b(J):ne&&b(null,{stack:_,id:E,glyph:ne.glyphs[E]||null})})},(_,E)=>{if(_)l(_);else if(E){const b={};for(const{stack:A,id:k,glyph:F}of E)void 0===b[A]&&(b[A]={}),void 0===b[A].glyphs&&(b[A].glyphs={}),b[A].glyphs[k]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics},b[A].ascender=this.entries[A].ascender,b[A].descender=this.entries[A].descender;l(null,b)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==vf.none&&(this.localGlyphMode===vf.all?!!this.localFontFamily:!!this.localFontFamily&&(vr["CJK Unified Ideographs"](t)||vr["Hangul Syllables"](t)||vr.Hiragana(t)||vr.Katakana(t)||vr["CJK Symbols and Punctuation"](t)))}_tinySDF(t,l,f){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(f))return;let E=t.tinySDF;if(!E){let Se="400";/bold/i.test(l)?Se="900":/medium/i.test(l)?Se="500":/light/i.test(l)&&(Se="200"),E=t.tinySDF=new xf.TinySDF({fontFamily:_,fontWeight:Se,fontSize:24*Qu,buffer:3*Qu,radius:8*Qu}),E.fontWeight=Se}if(this.localGlyphs[E.fontWeight][f])return this.localGlyphs[E.fontWeight][f];const b=String.fromCharCode(f),{data:A,width:k,height:F,glyphWidth:G,glyphHeight:J,glyphLeft:ne,glyphTop:le,glyphAdvance:de}=E.draw(b);return this.localGlyphs[E.fontWeight][f]={id:f,bitmap:new Id({width:k,height:F},A),metrics:{width:G/Qu,height:J/Qu,left:ne/Qu,top:le/Qu-27,advance:de/Qu,localGlyph:!0}}}}xf.loadGlyphRange=function(o,t,l,f,_){const E=256*t,b=E+255,A=f.transformRequest(f.normalizeGlyphsURL(l).replace("{fontstack}",o).replace("{range}",`${E}-${b}`),vi.Glyphs);Fs(A,(k,F)=>{if(k)_(k);else if(F){const G={},J=new Eh(F).readFields(P_,{});for(const ne of J.glyphs)G[ne.id]=ne;_(null,{glyphs:G,ascender:J.ascender,descender:J.descender})}})},xf.TinySDF=class{constructor({fontSize:o=24,buffer:t=3,radius:l=8,cutoff:f=.25,fontFamily:_="sans-serif",fontWeight:E="normal",fontStyle:b="normal"}={}){this.buffer=t,this.cutoff=f,this.radius=l;const A=this.size=o+4*t,k=this._createCanvas(A),F=this.ctx=k.getContext("2d",{willReadFrequently:!0});F.font=`${b} ${E} ${o}px ${_}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(o){const t=document.createElement("canvas");return t.width=t.height=o,t}draw(o){const{width:t,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:_,actualBoundingBoxRight:E}=this.ctx.measureText(o),b=Math.ceil(l),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-_))),k=Math.min(this.size-this.buffer,b+Math.ceil(f)),F=A+2*this.buffer,G=k+2*this.buffer,J=Math.max(F*G,0),ne=new Uint8ClampedArray(J),le={data:ne,width:F,height:G,glyphWidth:A,glyphHeight:k,glyphTop:b,glyphLeft:0,glyphAdvance:t};if(0===A||0===k)return le;const{ctx:de,buffer:Se,gridInner:tt,gridOuter:_t}=this;de.clearRect(Se,Se,A,k),de.fillText(o,Se,Se+b);const At=de.getImageData(Se,Se,A,k);_t.fill(yf,0,J),tt.fill(0,0,J);for(let yt=0;yt<k;yt++)for(let St=0;St<A;St++){const Ft=At.data[4*(yt*A+St)+3]/255;if(0===Ft)continue;const kt=(yt+Se)*F+St+Se;if(1===Ft)_t[kt]=0,tt[kt]=yf;else{const yn=.5-Ft;_t[kt]=yn>0?yn*yn:0,tt[kt]=yn<0?yn*yn:0}}Sg(_t,0,0,F,G,F,this.f,this.v,this.z),Sg(tt,Se,Se,A,k,F,this.f,this.v,this.z);for(let yt=0;yt<J;yt++){const St=Math.sqrt(_t[yt])-Math.sqrt(tt[yt]);ne[yt]=Math.round(255-255*(St/this.radius+this.cutoff))}return le}};const Rd=ku;function $p(o,t,l,f){const _=[],E=o.image,b=E.pixelRatio,A=E.paddedRect.w-2*Rd,k=E.paddedRect.h-2*Rd,F=o.right-o.left,G=o.bottom-o.top,J=E.stretchX||[[0,A]],ne=E.stretchY||[[0,k]],le=(En,$n)=>En+$n[1]-$n[0],de=J.reduce(le,0),Se=ne.reduce(le,0),tt=A-de,_t=k-Se;let At=0,yt=de,St=0,Ft=Se,kt=0,yn=tt,pn=0,Fn=_t;if(E.content&&f){const En=E.content;At=ud(J,0,En[0]),St=ud(ne,0,En[1]),yt=ud(J,En[0],En[2]),Ft=ud(ne,En[1],En[3]),kt=En[0]-At,pn=En[1]-St,yn=En[2]-En[0]-yt,Fn=En[3]-En[1]-Ft}const or=(En,$n,jn,tr)=>{const cr=Qf(En.stretch-At,yt,F,o.left),Pn=Zd(En.fixed-kt,yn,En.stretch,de),Pr=Qf($n.stretch-St,Ft,G,o.top),Zr=Zd($n.fixed-pn,Fn,$n.stretch,Se),Lr=Qf(jn.stretch-At,yt,F,o.left),is=Zd(jn.fixed-kt,yn,jn.stretch,de),hr=Qf(tr.stretch-St,Ft,G,o.top),di=Zd(tr.fixed-pn,Fn,tr.stretch,Se),Zi=new Le(cr,Pr),lo=new Le(Lr,Pr),ss=new Le(Lr,hr),Ti=new Le(cr,hr),yi=new Le(Pn/b,Zr/b),cs=new Le(is/b,di/b),ts=t*Math.PI/180;if(ts){const ms=Math.sin(ts),Vi=Math.cos(ts),Io=[Vi,-ms,ms,Vi];Zi._matMult(Io),lo._matMult(Io),Ti._matMult(Io),ss._matMult(Io)}const Ys=En.stretch+En.fixed,Go=$n.stretch+$n.fixed;return{tl:Zi,tr:lo,bl:Ti,br:ss,tex:{x:E.paddedRect.x+Rd+Ys,y:E.paddedRect.y+Rd+Go,w:jn.stretch+jn.fixed-Ys,h:tr.stretch+tr.fixed-Go},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yi,pixelOffsetBR:cs,minFontScaleX:yn/b/F,minFontScaleY:Fn/b/G,isSDF:l}};if(f&&(E.stretchX||E.stretchY)){const En=Cg(J,tt,de),$n=Cg(ne,_t,Se);for(let jn=0;jn<En.length-1;jn++){const tr=En[jn],cr=En[jn+1];for(let Pn=0;Pn<$n.length-1;Pn++)_.push(or(tr,$n[Pn],cr,$n[Pn+1]))}}else _.push(or({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:k+1}));return _}function ud(o,t,l){let f=0;for(const _ of o)f+=Math.max(t,Math.min(l,_[1]))-Math.max(t,Math.min(l,_[0]));return f}function Cg(o,t,l){const f=[{fixed:-Rd,stretch:0}];for(const[_,E]of o){const b=f[f.length-1];f.push({fixed:_-b.stretch,stretch:b.stretch}),f.push({fixed:_-b.stretch,stretch:b.stretch+(E-_)})}return f.push({fixed:t+Rd,stretch:l}),f}function Qf(o,t,l,f){return o/t*l+f}function Zd(o,t,l,f){return o-t*l/f}function L_(o,t,l,f){const _=t+o.positionedLines[f].lineOffset;return 0===f?l+_/2:l+(_+(t+o.positionedLines[f-1].lineOffset))/2}class My{constructor(t=[],l=F_){if(this.data=t,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:l,compare:f}=this,_=l[t];for(;t>0;){const E=t-1>>1,b=l[E];if(f(_,b)>=0)break;l[t]=b,t=E}l[t]=_}_down(t){const{data:l,compare:f}=this,_=this.length>>1,E=l[t];for(;t<_;){let b=1+(t<<1),A=l[b];const k=b+1;if(k<this.length&&f(l[k],A)<0&&(b=k,A=l[k]),f(A,E)>=0)break;l[t]=A,t=b}l[t]=E}}function F_(o,t){return o<t?-1:o>t?1:0}function Dg(o,t=1,l=!1){let f=1/0,_=1/0,E=-1/0,b=-1/0;const A=o[0];for(let le=0;le<A.length;le++){const de=A[le];(!le||de.x<f)&&(f=de.x),(!le||de.y<_)&&(_=de.y),(!le||de.x>E)&&(E=de.x),(!le||de.y>b)&&(b=de.y)}const k=Math.min(E-f,b-_);let F=k/2;const G=new My([],dd);if(0===k)return new Le(f,_);for(let le=f;le<E;le+=k)for(let de=_;de<b;de+=k)G.push(new Xd(le+F,de+F,F,o));let J=function(le){let de=0,Se=0,tt=0;const _t=le[0];for(let At=0,yt=_t.length,St=yt-1;At<yt;St=At++){const Ft=_t[At],kt=_t[St],yn=Ft.x*kt.y-kt.x*Ft.y;Se+=(Ft.x+kt.x)*yn,tt+=(Ft.y+kt.y)*yn,de+=3*yn}return new Xd(Se/de,tt/de,0,le)}(o),ne=G.length;for(;G.length;){const le=G.pop();(le.d>J.d||!J.d)&&(J=le,l&&console.log("found best %d after %d probes",Math.round(1e4*le.d)/1e4,ne)),le.max-J.d<=t||(F=le.h/2,G.push(new Xd(le.p.x-F,le.p.y-F,F,o)),G.push(new Xd(le.p.x+F,le.p.y-F,F,o)),G.push(new Xd(le.p.x-F,le.p.y+F,F,o)),G.push(new Xd(le.p.x+F,le.p.y+F,F,o)),ne+=4)}return l&&(console.log(`num probes: ${ne}`),console.log(`best distance: ${J.d}`)),J.p}function dd(o,t){return t.max-o.max}class Xd{constructor(t,l,f,_){this.p=new Le(t,l),this.h=f,this.d=function(E,b){let A=!1,k=1/0;for(let F=0;F<b.length;F++){const G=b[F];for(let J=0,ne=G.length,le=ne-1;J<ne;le=J++){const de=G[J],Se=G[le];de.y>E.y!=Se.y>E.y&&E.x<(Se.x-de.x)*(E.y-de.y)/(Se.y-de.y)+de.x&&(A=!A),k=Math.min(k,Jh(E,de,Se))}}return(A?1:-1)*Math.sqrt(k)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const Ef=7,km=Number.POSITIVE_INFINITY,Kv=Math.sqrt(2);function Gp(o,[t,l]){let f=0,_=0;if(l===km){t<0&&(t=0);const E=t/Kv;switch(o){case"top-right":case"top-left":_=E-Ef;break;case"bottom-right":case"bottom-left":_=-E+Ef;break;case"bottom":_=-t+Ef;break;case"top":_=t-Ef}switch(o){case"top-right":case"bottom-right":f=-E;break;case"top-left":case"bottom-left":f=E;break;case"left":f=t;break;case"right":f=-t}}else{switch(t=Math.abs(t),l=Math.abs(l),o){case"top-right":case"top-left":case"top":_=l-Ef;break;case"bottom-right":case"bottom-left":case"bottom":_=-l+Ef}switch(o){case"top-right":case"bottom-right":case"right":f=-t;break;case"top-left":case"bottom-left":case"left":f=t}}return[f,_]}function Ry(o,t,l,f,_,E,b,A,k,F){o.createArrays(),o.tilePixelRatio=ii/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const G=o.layers[0].layout,J=o.layers[0]._unevaluatedLayout._values,ne={};if("composite"===o.textSizeData.kind){const{minZoom:Se,maxZoom:tt}=o.textSizeData;ne.compositeTextSizes=[J["text-size"].possiblyEvaluate(new V(Se),A),J["text-size"].possiblyEvaluate(new V(tt),A)]}if("composite"===o.iconSizeData.kind){const{minZoom:Se,maxZoom:tt}=o.iconSizeData;ne.compositeIconSizes=[J["icon-size"].possiblyEvaluate(new V(Se),A),J["icon-size"].possiblyEvaluate(new V(tt),A)]}ne.layoutTextSize=J["text-size"].possiblyEvaluate(new V(k+1),A),ne.layoutIconSize=J["icon-size"].possiblyEvaluate(new V(k+1),A),ne.textMaxSize=J["text-size"].possiblyEvaluate(new V(18),A);const le="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),de=G.get("text-size");for(const Se of o.features){const tt=G.get("text-font").evaluate(Se,{},A).join(","),_t=de.evaluate(Se,{},A),At=ne.layoutTextSize.evaluate(Se,{},A),yt=(ne.layoutIconSize.evaluate(Se,{},A),{horizontal:{},vertical:void 0}),St=Se.text;let Ft,kt=[0,0];if(St){const Fn=St.toString(),or=G.get("text-letter-spacing").evaluate(Se,{},A)*Jl,En=G.get("text-line-height").evaluate(Se,{},A)*Jl,$n=_d(Fn)?or:0,jn=G.get("text-anchor").evaluate(Se,{},A),tr=G.get("text-variable-anchor");if(!tr){const Lr=G.get("text-radial-offset").evaluate(Se,{},A);kt=Lr?Gp(jn,[Lr*Jl,km]):G.get("text-offset").evaluate(Se,{},A).map(is=>is*Jl)}let cr=le?"center":G.get("text-justify").evaluate(Se,{},A);const Pn="point"===G.get("symbol-placement"),Pr=Pn?G.get("text-max-width").evaluate(Se,{},A)*Jl:1/0,Zr=Lr=>{o.allowVerticalPlacement&&Su(Fn)&&(yt.vertical=Om(St,t,l,_,tt,Pr,En,jn,Lr,$n,kt,Nu.vertical,!0,At,_t))};if(!le&&tr){const Lr="auto"===cr?tr.map(hr=>Pd(hr)):[cr];let is=!1;for(let hr=0;hr<Lr.length;hr++){const di=Lr[hr];if(!yt.horizontal[di])if(is)yt.horizontal[di]=yt.horizontal[0];else{const Zi=Om(St,t,l,_,tt,Pr,En,"center",di,$n,kt,Nu.horizontal,!1,At,_t);Zi&&(yt.horizontal[di]=Zi,is=1===Zi.positionedLines.length)}}Zr("left")}else{if("auto"===cr&&(cr=Pd(jn)),Pn||G.get("text-writing-mode").indexOf("horizontal")>=0||!Su(Fn)){const Lr=Om(St,t,l,_,tt,Pr,En,jn,cr,$n,kt,Nu.horizontal,!1,At,_t);Lr&&(yt.horizontal[cr]=Lr)}Zr(Pn?"left":cr)}}let yn=!1;if(Se.icon&&Se.icon.name){const Fn=f[Se.icon.name];Fn&&(Ft=_f(_[Se.icon.name],G.get("icon-offset").evaluate(Se,{},A),G.get("icon-anchor").evaluate(Se,{},A)),yn=Fn.sdf,void 0===o.sdfIcons?o.sdfIcons=Fn.sdf:o.sdfIcons!==Fn.sdf&&ur("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fn.pixelRatio!==o.pixelRatio||0!==G.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const pn=Yf(yt.horizontal)||yt.vertical;o.iconsInText||(o.iconsInText=!!pn&&pn.iconsInText),(pn||Ft)&&Nm(o,Se,yt,Ft,f,ne,At,0,kt,yn,b,A,F)}E&&o.generateCollisionDebugBuffers(k,o.collisionBoxArray)}function Pd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nm(o,t,l,f,_,E,b,A,k,F,G,J,ne){let le=E.textMaxSize.evaluate(t,{},J);void 0===le&&(le=b);const de=o.layers[0].layout,Se=de.get("icon-offset").evaluate(t,{},J),tt=Yf(l.horizontal)||l.vertical,_t="globe"===ne.name,At=Jl,yt=b/At,St=o.tilePixelRatio*le/At,Ft=(jn=o.overscaling,o.zoom>18&&jn>2&&(jn>>=1),Math.max(ii/(512*jn),1)*de.get("symbol-spacing")),kt=de.get("text-padding")*o.tilePixelRatio,yn=de.get("icon-padding")*o.tilePixelRatio,pn=Ze(de.get("text-max-angle")),Fn="map"===de.get("text-rotation-alignment")&&"point"!==de.get("symbol-placement"),or="map"===de.get("icon-rotation-alignment")&&"point"!==de.get("symbol-placement"),En=de.get("symbol-placement"),$n=Ft/2;var jn;const tr=de.get("icon-text-fit");let cr;f&&"none"!==tr&&(o.allowVerticalPlacement&&l.vertical&&(cr=Lu(f,l.vertical,tr,de.get("icon-text-fit-padding"),Se,yt)),tt&&(f=Lu(f,tt,tr,de.get("icon-text-fit-padding"),Se,yt)));const Pn=(Pr,Zr,Lr)=>{if(Zr.x<0||Zr.x>=ii||Zr.y<0||Zr.y>=ii)return;let is=null;if(_t){const{x:hr,y:di,z:Zi}=ne.projectTilePoint(Zr.x,Zr.y,Lr);is={anchor:new cu(hr,di,Zi,0,void 0),up:ne.upVector(Lr,Zr.x,Zr.y)}}!function(hr,di,Zi,lo,ss,Ti,yi,cs,ts,Ys,Go,ms,Vi,Io,Oa,El,_o,wl,ka,Na,co,sl,Zo,qs,Ea){const pc=hr.addToLineVertexArray(di,lo);let Ks,Fc,mc,gd,im,jm,Ph,q_=0,Gy=0,Qv=0,Hy=0,$m=-1,K_=-1;const xu={};let Nd=ko("");const Qc=Zi?Zi.anchor:di;let Ld=0,Yv=0;if(void 0===ts._unevaluatedLayout.getValue("text-radial-offset")?[Ld,Yv]=ts.layout.get("text-offset").evaluate(co,{},Ea).map(Vu=>Vu*Jl):(Ld=ts.layout.get("text-radial-offset").evaluate(co,{},Ea)*Jl,Yv=km),hr.allowVerticalPlacement&&ss.vertical){const Vu=ss.vertical;if(Oa)jm=Rg(Vu),cs&&(Ph=Rg(cs));else{const Eu=ts.layout.get("text-rotate").evaluate(co,{},Ea)+90;mc=Mg(Ys,Qc,di,Go,ms,Vi,Vu,Io,Eu,El),cs&&(gd=Mg(Ys,Qc,di,Go,ms,Vi,cs,wl,Eu))}}if(Ti){const Vu=ts.layout.get("icon-rotate").evaluate(co,{},Ea),Eu="none"!==ts.layout.get("icon-text-fit"),Mf=$p(Ti,Vu,Zo,Eu),lp=cs?$p(cs,Vu,Zo,Eu):void 0;Fc=Mg(Ys,Qc,di,Go,ms,Vi,Ti,wl,Vu),q_=4*Mf.length;const X_=hr.iconSizeData;let Uu=null;"source"===X_.kind?(Uu=[Dd*ts.layout.get("icon-size").evaluate(co,{},Ea)],Uu[0]>wh&&ur(`${hr.layerIds[0]}: Value for "icon-size" is >= ${wf}. Reduce your "icon-size".`)):"composite"===X_.kind&&(Uu=[Dd*sl.compositeIconSizes[0].evaluate(co,{},Ea),Dd*sl.compositeIconSizes[1].evaluate(co,{},Ea)],(Uu[0]>wh||Uu[1]>wh)&&ur(`${hr.layerIds[0]}: Value for "icon-size" is >= ${wf}. Reduce your "icon-size".`)),hr.addSymbols(hr.icon,Mf,Uu,Na,ka,co,!1,Zi,di,pc.lineStartIndex,pc.lineLength,-1,qs,Ea),$m=hr.icon.placedSymbolArray.length-1,lp&&(Gy=4*lp.length,hr.addSymbols(hr.icon,lp,Uu,Na,ka,co,Nu.vertical,Zi,di,pc.lineStartIndex,pc.lineLength,-1,qs,Ea),K_=hr.icon.placedSymbolArray.length-1)}for(const Vu in ss.horizontal){const Eu=ss.horizontal[Vu];Ks||(Nd=ko(Eu.text),Oa?im=Rg(Eu):Ks=Mg(Ys,Qc,di,Go,ms,Vi,Eu,Io,ts.layout.get("text-rotate").evaluate(co,{},Ea),El));const Mf=1===Eu.positionedLines.length;if(Qv+=Hp(hr,Zi,di,Eu,yi,ts,Oa,co,El,pc,ss.vertical?Nu.horizontal:Nu.horizontalOnly,Mf?Object.keys(ss.horizontal):[Vu],xu,$m,sl,qs,Ea),Mf)break}ss.vertical&&(Hy+=Hp(hr,Zi,di,ss.vertical,yi,ts,Oa,co,El,pc,Nu.vertical,["vertical"],xu,K_,sl,qs,Ea));let Do=-1;const sm=(Vu,Eu)=>Vu?Math.max(Vu,Eu):Eu;Do=sm(im,Do),Do=sm(jm,Do),Do=sm(Ph,Do);const Z_=Do>-1?1:0;hr.glyphOffsetArray.length>=hd.MAX_GLYPHS&&ur("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==co.sortKey&&hr.addToSortKeyRanges(hr.symbolInstances.length,co.sortKey),hr.symbolInstances.emplaceBack(Qc.x,Qc.y,Qc.z,di.x,di.y,xu.right>=0?xu.right:-1,xu.center>=0?xu.center:-1,xu.left>=0?xu.left:-1,xu.vertical>=0?xu.vertical:-1,$m,K_,Nd,void 0!==Ks?Ks:hr.collisionBoxArray.length,void 0!==Ks?Ks+1:hr.collisionBoxArray.length,void 0!==mc?mc:hr.collisionBoxArray.length,void 0!==mc?mc+1:hr.collisionBoxArray.length,void 0!==Fc?Fc:hr.collisionBoxArray.length,void 0!==Fc?Fc+1:hr.collisionBoxArray.length,gd||hr.collisionBoxArray.length,gd?gd+1:hr.collisionBoxArray.length,Go,Qv,Hy,q_,Gy,Z_,0,Ld,Yv,Do)}(o,Zr,is,Pr,l,f,_,cr,o.layers[0],o.collisionBoxArray,t.index,t.sourceLayerIndex,o.index,kt,Fn,k,0,yn,or,Se,t,E,F,G,J)};if("line"===En)for(const Pr of qv(t.geometry,0,0,ii,ii)){const Zr=Tg(Pr,Ft,pn,l.vertical||tt,f,At,St,o.overscaling,ii);for(const Lr of Zr)tt&&B_(o,tt.text,$n,Lr)||Pn(Pr,Lr,J)}else if("line-center"===En){for(const Pr of t.geometry)if(Pr.length>1){const Zr=bg(Pr,pn,l.vertical||tt,f,At,St);Zr&&Pn(Pr,Zr,J)}}else if("Polygon"===t.type)for(const Pr of Em(t.geometry,0)){const Zr=Dg(Pr,16);Pn(Pr[0],new cu(Zr.x,Zr.y,0,0,void 0),J)}else if("LineString"===t.type)for(const Pr of t.geometry)Pn(Pr,new cu(Pr[0].x,Pr[0].y,0,0,void 0),J);else if("Point"===t.type)for(const Pr of t.geometry)for(const Zr of Pr)Pn([Zr],new cu(Zr.x,Zr.y,0,0,void 0),J)}const wf=255,wh=wf*Dd;function Hp(o,t,l,f,_,E,b,A,k,F,G,J,ne,le,de,Se,tt){const _t=function(St,Ft,kt,yn,pn,Fn,or,En){const $n=[];if(0===Ft.positionedLines.length)return $n;const jn=yn.layout.get("text-rotate").evaluate(Fn,{})*Math.PI/180,tr=function(Lr){const is=Lr[0],hr=Lr[1],di=is*hr;return di>0?[is,-hr]:di<0?[-is,hr]:0===is?[hr,is]:[hr,-is]}(kt);let cr=Math.abs(Ft.top-Ft.bottom);for(const Lr of Ft.positionedLines)cr-=Lr.lineOffset;const Pn=Ft.positionedLines.length,Pr=cr/Pn;let Zr=Ft.top-kt[1];for(let Lr=0;Lr<Pn;++Lr){const is=Ft.positionedLines[Lr];Zr=L_(Ft,Pr,Zr,Lr);for(const hr of is.positionedGlyphs){if(!hr.rect)continue;const di=hr.rect||{};let Zi=O_+1,lo=!0,ss=1,Ti=0;if(hr.imageName){const Zo=or[hr.imageName];if(!Zo)continue;if(Zo.sdf){ur("SDF images are not supported in formatted text and will be ignored.");continue}lo=!1,ss=Zo.pixelRatio,Zi=ku/ss}const yi=(pn||En)&&hr.vertical,cs=hr.metrics.advance*hr.scale/2,ts=hr.metrics,Ys=hr.rect;if(null===Ys)continue;En&&Ft.verticalizable&&(Ti=hr.imageName?cs-hr.metrics.width*hr.scale/2:0);const Go=pn?[hr.x+cs,hr.y]:[0,0];let ms=[0,0],Vi=[0,0],Io=!1;pn||(yi?(Vi=[hr.x+cs+tr[0],hr.y+tr[1]-Ti],Io=!0):ms=[hr.x+cs+kt[0],hr.y+kt[1]-Ti]);const Oa=Ys.w*hr.scale/(ss*(hr.localGlyph?Qu:1)),El=Ys.h*hr.scale/(ss*(hr.localGlyph?Qu:1));let _o,wl,ka,Na;if(yi){const Zo=hr.y-Zr,qs=new Le(-cs,cs-Zo),Ea=-Math.PI/2,pc=new Le(...Vi);_o=new Le(-cs+ms[0],ms[1]),_o._rotateAround(Ea,qs)._add(pc),_o.x+=-Zo+cs,_o.y-=(ts.left-Zi)*hr.scale;const Ks=hr.imageName?ts.advance*hr.scale:Jl*hr.scale,Fc=String.fromCharCode(hr.glyph);jv(Fc)?_o.x+=(1-Zi)*hr.scale:A_(Fc)?_o.x+=Ks-ts.height*hr.scale+(-Zi-1)*hr.scale:_o.x+=hr.imageName||ts.width+2*Zi===Ys.w&&ts.height+2*Zi===Ys.h?(Ks-El)/2:(Ks-(ts.height+2*Zi)*hr.scale)/2,wl=new Le(_o.x,_o.y-Oa),ka=new Le(_o.x+El,_o.y),Na=new Le(_o.x+El,_o.y-Oa)}else{const Zo=(ts.left-Zi)*hr.scale-cs+ms[0],qs=(-ts.top-Zi)*hr.scale+ms[1],Ea=Zo+Oa,pc=qs+El;_o=new Le(Zo,qs),wl=new Le(Ea,qs),ka=new Le(Zo,pc),Na=new Le(Ea,pc)}if(jn){let Zo;Zo=pn?new Le(0,0):Io?new Le(tr[0],tr[1]):new Le(kt[0],kt[1]),_o._rotateAround(jn,Zo),wl._rotateAround(jn,Zo),ka._rotateAround(jn,Zo),Na._rotateAround(jn,Zo)}const co=new Le(0,0),sl=new Le(0,0);$n.push({tl:_o,tr:wl,bl:ka,br:Na,tex:di,writingMode:Ft.writingMode,glyphOffset:Go,sectionIndex:hr.sectionIndex,isSDF:lo,pixelOffsetTL:co,pixelOffsetBR:sl,minFontScaleX:0,minFontScaleY:0})}}return $n}(0,f,k,E,b,A,_,o.allowVerticalPlacement),At=o.textSizeData;let yt=null;"source"===At.kind?(yt=[Dd*E.layout.get("text-size").evaluate(A,{},tt)],yt[0]>wh&&ur(`${o.layerIds[0]}: Value for "text-size" is >= ${wf}. Reduce your "text-size".`)):"composite"===At.kind&&(yt=[Dd*de.compositeTextSizes[0].evaluate(A,{},tt),Dd*de.compositeTextSizes[1].evaluate(A,{},tt)],(yt[0]>wh||yt[1]>wh)&&ur(`${o.layerIds[0]}: Value for "text-size" is >= ${wf}. Reduce your "text-size".`)),o.addSymbols(o.text,_t,yt,k,b,A,G,t,l,F.lineStartIndex,F.lineLength,le,Se,tt);for(const St of J)ne[St]=o.text.placedSymbolArray.length-1;return 4*_t.length}function Yf(o){for(const t in o)return o[t];return null}function Mg(o,t,l,f,_,E,b,A,k,F){let G=b.top,J=b.bottom,ne=b.left,le=b.right;const de=b.collisionPadding;if(de&&(ne-=de[0],G-=de[1],le+=de[2],J+=de[3]),k){const Se=new Le(ne,G),tt=new Le(le,G),_t=new Le(ne,J),At=new Le(le,J),yt=Ze(k);let St=new Le(0,0);F&&(St=new Le(F[0],F[1])),Se._rotateAround(yt,St),tt._rotateAround(yt,St),_t._rotateAround(yt,St),At._rotateAround(yt,St),ne=Math.min(Se.x,tt.x,_t.x,At.x),le=Math.max(Se.x,tt.x,_t.x,At.x),G=Math.min(Se.y,tt.y,_t.y,At.y),J=Math.max(Se.y,tt.y,_t.y,At.y)}return o.emplaceBack(t.x,t.y,t.z,l.x,l.y,ne,G,le,J,A,f,_,E),o.length-1}function Rg(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const t=o.bottom-o.top;return t>0?Math.max(10,t):null}function B_(o,t,l,f){const _=o.compareText;if(t in _){const E=_[t];for(let b=E.length-1;b>=0;b--)if(f.dist(E[b])<l)return!0}else _[t]=[];return _[t].push(f),!1}function Pg(o,t){const l=o.fovAboveCenter,f=o.elevation?o.elevation.getMinElevationBelowMSL()*t:0,_=(o._camera.position[2]*o.worldSize-f)/Math.cos(o._pitch),E=Math.sin(l)*_/Math.sin(Math.max(Math.PI/2-o._pitch-l,.01)),b=Math.sin(o._pitch)*E+_;return Math.min(1.01*b,_*(1/o._horizonShift))}function bh(o,t){if(!t.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:t};const l=Math.pow(2,-o.z),f=o.x*l,_=(o.x+1)*l,E=o.y*l,b=(o.y+1)*l,A=qa(f),k=qa(_),F=Ka(E),G=Ka(b),J=t.project(A,F),ne=t.project(k,F),le=t.project(k,G),de=t.project(A,G);let Se=Math.min(J.x,ne.x,le.x,de.x),tt=Math.min(J.y,ne.y,le.y,de.y),_t=Math.max(J.x,ne.x,le.x,de.x),At=Math.max(J.y,ne.y,le.y,de.y);const yt=l/16;function St(kt,yn,pn,Fn,or,En){const $n=(pn+or)/2,jn=(Fn+En)/2,tr=t.project(qa($n),Ka(jn)),cr=Math.max(0,Se-tr.x,tt-tr.y,tr.x-_t,tr.y-At);Se=Math.min(Se,tr.x),_t=Math.max(_t,tr.x),tt=Math.min(tt,tr.y),At=Math.max(At,tr.y),cr>yt&&(St(kt,tr,pn,Fn,$n,jn),St(tr,yn,$n,jn,or,En))}St(J,ne,f,E,_,E),St(ne,le,_,E,_,b),St(le,de,_,b,f,b),St(de,J,f,b,f,E),Se-=yt,tt-=yt,_t+=yt,At+=yt;const Ft=1/Math.max(_t-Se,At-tt);return{scale:Ft,x:Se*Ft,y:tt*Ft,x2:_t*Ft,y2:At*Ft,projection:t}}const Og=$o(new Float32Array(16));class Od{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,l){return{x:0,y:0,z:0}}unproject(t,l){return new Ws(0,0)}projectTilePoint(t,l,f){return{x:t,y:l,z:0}}locationPoint(t,l,f=!0){return t._coordinatePoint(t.locationCoordinate(l),f)}pixelsPerMeter(t,l){return fc(1,t)*l}pixelSpaceConversion(t,l,f){return 1}farthestPixelDistance(t){return Pg(t,t.pixelsPerMeter)}pointCoordinate(t,l,f,_){const E=t.horizonLineFromTop(!1),b=new Le(l,Math.max(E,f));return t.rayIntersectionCoordinate(t.pointRayIntersection(b,_))}pointCoordinate3D(t,l,f){const _=new Le(l,f);if(t.elevation)return t.elevation.pointCoordinate(_);{const E=this.pointCoordinate(t,_.x,_.y,0);return[E.x,E.y,E.z]}}isPointAboveHorizon(t,l){if(t.elevation)return!this.pointCoordinate3D(t,l.x,l.y);const f=t.horizonLineFromTop();return l.y<f}createInversionMatrix(t,l){return Og}createTileMatrix(t,l,f){let _,E,b;const A=f.canonical,k=$o(new Float64Array(16));if(this.isReprojectedInTileSpace){const F=bh(A,this);_=1,E=F.x+f.wrap*F.scale,b=F.y,Mu(k,k,[_/F.scale,_/F.scale,t.pixelsPerMeter/l])}else _=l/t.zoomScale(A.z),E=(A.x+Math.pow(2,A.z)*f.wrap)*_,b=A.y*_;return Du(k,k,[E,b,0]),Mu(k,k,[_/ii,_/ii,1]),k}upVector(t,l,f){return[0,0,1]}upVectorScale(t,l,f){return{metersToTile:1}}}class Jf extends Od{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[l,f]=this.parallels=t.parallels||[29.5,45.5],_=Math.sin(Ze(l));this.n=(_+Math.sin(Ze(f)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(t,l){const{n:f,c:_,r0:E}=this,b=Ze(t-this.center[0]),A=Ze(l),k=Math.sqrt(_-2*f*Math.sin(A))/f;return{x:k*Math.sin(b*f),y:k*Math.cos(b*f)-E,z:0}}unproject(t,l){const{n:f,c:_,r0:E}=this,b=E+l;let A=Math.atan2(t,Math.abs(b))*Math.sign(b);b*f<0&&(A-=Math.PI*Math.sign(t)*Math.sign(b));const k=Ze(this.center[0])*f;A=lt(A,-Math.PI-k,Math.PI-k);const F=qt(it(A/f)+this.center[0],-180,180),G=Math.asin(qt((_-(t*t+b*b)*f*f)/(2*f),-1,1)),J=qt(it(G),-xa,xa);return new Ws(F,J)}}const Wp=1.340264,Th=-.081106,Ih=893e-6,bf=.003796,ep=Math.sqrt(3)/2;class qp extends Od{project(t,l){l=l/180*Math.PI,t=t/180*Math.PI;const f=Math.asin(ep*Math.sin(l)),_=f*f,E=_*_*_;return{x:.5*(t*Math.cos(f)/(ep*(Wp+3*Th*_+E*(7*Ih+9*bf*_)))/Math.PI+.5),y:1-.5*(f*(Wp+Th*_+E*(Ih+bf*_))/Math.PI+1),z:0}}unproject(t,l){t=(2*t-.5)*Math.PI;let f=l=(2*(1-l)-1)*Math.PI,_=f*f,E=_*_*_;for(let G,J,ne,le=0;le<12&&(J=f*(Wp+Th*_+E*(Ih+bf*_))-l,ne=Wp+3*Th*_+E*(7*Ih+9*bf*_),G=J/ne,f=qt(f-G,-Math.PI/3,Math.PI/3),_=f*f,E=_*_*_,!(Math.abs(G)<1e-12));++le);const b=ep*t*(Wp+3*Th*_+E*(7*Ih+9*bf*_))/Math.cos(f),A=Math.asin(Math.sin(f)/ep),k=qt(180*b/Math.PI,-180,180),F=qt(180*A/Math.PI,-xa,xa);return new Ws(k,F)}}class V_ extends Od{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,l){return{x:.5+t/360,y:.5-l/360,z:0}}unproject(t,l){const f=360*(t-.5),_=qt(360*(.5-l),-xa,xa);return new Ws(f,_)}}const Sh=Math.PI/2;function Ah(o){return Math.tan((Sh+o)/2)}class Tf extends Od{constructor(t){super(t),this.center=t.center||[0,30];const[l,f]=this.parallels=t.parallels||[30,30];let _=Ze(l),E=Ze(f);this.southernCenter=_+E<0,this.southernCenter&&(_=-_,E=-E);const b=Math.cos(_),A=Ah(_);this.n=_===E?Math.sin(_):Math.log(b/Math.cos(E))/Math.log(Ah(E)/A),this.f=b*Math.pow(Ah(_),this.n)/this.n}project(t,l){l=Ze(l),this.southernCenter&&(l=-l),t=Ze(t-this.center[0]);const f=1e-6,{n:_,f:E}=this;E>0?l<-Sh+f&&(l=-Sh+f):l>Sh-f&&(l=Sh-f);const b=E/Math.pow(Ah(l),_);let A=b*Math.sin(_*t),k=E-b*Math.cos(_*t);return A=.5*(A/Math.PI+.5),k=.5*(k/Math.PI+.5),{x:A,y:this.southernCenter?k:1-k,z:0}}unproject(t,l){t=(2*t-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:f,f:_}=this,E=_-l,b=Math.sign(E),A=Math.sign(f)*Math.sqrt(t*t+E*E);let k=Math.atan2(t,Math.abs(E))*b;E*f<0&&(k-=Math.PI*Math.sign(t)*b);const F=qt(it(k/f)+this.center[0],-180,180),G=qt(it(2*Math.atan(Math.pow(_/A,1/f))-Sh),-xa,xa);return new Ws(F,this.southernCenter?-G:G)}}class kg extends Od{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,l){return{x:au(t),y:yl(l),z:0}}unproject(t,l){const f=qa(t),_=Ka(l);return new Ws(f,_)}}const If=Ze(xa);class tp extends Od{project(t,l){const f=(l=Ze(l))*l,_=f*f;return{x:.5*((t=Ze(t))*(.8707-.131979*f+_*(_*(.003971*f-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+f*(.015085+_*(.028874*f-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(t,l){t=(2*t-.5)*Math.PI;let f=l=(2*(1-l)-1)*Math.PI,_=25,E=0,b=f*f;do{b=f*f;const F=b*b;E=(f*(1.007226+b*(.015085+F*(.028874*b-.044475-.005916*F)))-l)/(1.007226+b*(.045255+F*(.259866*b-.311325-.005916*11*F))),f=qt(f-E,-If,If)}while(Math.abs(E)>1e-6&&--_>0);b=f*f;const A=qt(it(t/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),k=it(f);return new Ws(A,k)}}const Cs=Ze(xa);class np extends Od{project(t,l){l=Ze(l),t=Ze(t);const f=Math.cos(l),_=2/Math.PI,E=Math.acos(f*Math.cos(t/2)),b=Math.sin(E)/E,A=.5*(t*_+2*f*Math.sin(t/2)/b)||0,k=.5*(l+Math.sin(l)/b)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(k/Math.PI+1),z:0}}unproject(t,l){let f=t=(2*t-.5)*Math.PI,_=l=(2*(1-l)-1)*Math.PI,E=25;const b=1e-6;let A=0,k=0;do{const F=Math.cos(_),G=Math.sin(_),J=2*G*F,ne=G*G,le=F*F,de=Math.cos(f/2),Se=Math.sin(f/2),tt=2*de*Se,_t=Se*Se,At=1-le*de*de,yt=At?1/At:0,St=At?Math.acos(F*de)*Math.sqrt(1/At):0,Ft=.5*(2*St*F*Se+2*f/Math.PI)-t,kt=.5*(St*G+_)-l,yn=.5*yt*(le*_t+St*F*de*ne)+1/Math.PI,pn=yt*(tt*J/4-St*G*Se),Fn=.125*yt*(J*Se-St*G*le*tt),or=.5*yt*(ne*de+St*_t*F)+.5,En=pn*Fn-or*yn;A=(kt*pn-Ft*or)/En,k=(Ft*Fn-kt*yn)/En,f=qt(f-A,-Math.PI,Math.PI),_=qt(_-k,-Cs,Cs)}while((Math.abs(A)>b||Math.abs(k)>b)&&--E>0);return new Ws(it(f),it(_))}}class U_ extends Od{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,l){const{scale:f,cosPhi:_}=this;return{x:Ze(t)*_*f+.5,y:-Math.sin(Ze(l))/_*f+.5,z:0}}unproject(t,l){const{scale:f,cosPhi:_}=this,E=-(l-.5)/f,b=qt(it((t-.5)/f)/_,-180,180),A=Math.asin(qt(E*_,-1,1)),k=qt(it(A),-xa,xa);return new Ws(b,k)}}class Kp extends kg{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,l,f){const _=qu(t,l,f);return ua(_,_,Wc(Wu(f))),{x:_[0],y:_[1],z:_[2]}}locationPoint(t,l){const f=hc(l.lat,l.lng),_=Ac([],f),E=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(l),t._centerAltitude):t._centerAltitude;$h(f,f,_,fc(1,0)*ii*E);const b=$o(new Float64Array(16));return Eo(b,t.pixelMatrix,t.globeMatrix),ua(f,f,b),new Le(f[0],f[1])}pixelsPerMeter(t,l){return fc(1,0)*l}pixelSpaceConversion(t,l,f){const _=fc(1,t)*l,E=ns(fc(1,45)*l,_,f);return this.pixelsPerMeter(t,l)/E}createTileMatrix(t,l,f){const _=uh(Wu(f.canonical));return Eo(new Float64Array(16),t.globeMatrix,_)}createInversionMatrix(t,l){const{center:f}=t,_=Wc(Wu(l));return vd(_,_,Ze(f.lng)),nd(_,_,Ze(f.lat)),Mu(_,_,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(t,l,f,_){return Zh(t,l,f,!0)||new qc(0,0)}pointCoordinate3D(t,l,f){const _=this.pointCoordinate(t,l,f,0);return[_.x,_.y,_.z]}isPointAboveHorizon(t,l){return!Zh(t,l.x,l.y,!1)}farthestPixelDistance(t){const l=function(_,E){const b=_.cameraToCenterDistance,A=_._centerAltitude*E,k=_._camera,F=_._camera.forward(),G=iu([],dc([],F,-b),[0,0,A]),J=_.worldSize/(2*Math.PI),ne=[0,0,-J],le=_.width/_.height,de=Math.tan(_.fovAboveCenter),Se=dc([],k.up(),de),tt=dc([],k.right(),de*le),_t=Ac([],iu([],iu([],F,Se),tt)),At=[];let yt;if(new wd(G,_t).closestPointOnSphere(ne,J,At)){const St=iu([],At,ne),Ft=su([],St,G);yt=Math.cos(_.fovAboveCenter)*zh(Ft)}else{const St=su([],G,ne),Ft=su([],ne,G);Ac(Ft,Ft);const kt=zh(St)-J;yt=Math.sqrt(kt*(kt+2*J));const yn=Math.acos(yt/(J+kt))-Math.acos(Gc(F,Ft));yt*=Math.cos(yn)}return 1.01*yt}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),f=yu(t.zoom);if(f>0){const _=Pg(t,fc(1,t.center.lat)*t.worldSize),E=t.worldSize/(2*Math.PI),b=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ns(l,_+E*(1-Math.cos(b)),Math.pow(f,10))}return l}upVector(t,l,f){return qu(l,f,t,1)}upVectorScale(t){return{metersToTile:Kh(ch(Wu(t)))}}}function Lm(o){const t=o.parallels,l=!!t&&Math.abs(t[0]+t[1])<.01;switch(o.name){case"mercator":return new kg(o);case"equirectangular":return new V_(o);case"naturalEarth":return new tp(o);case"equalEarth":return new qp(o);case"winkelTripel":return new np(o);case"albers":return l?new U_(o):new Jf(o);case"lambertConformalConic":return l?new U_(o):new Tf(o);case"globe":return new Kp(o)}throw new Error(`Invalid projection name: ${o.name}`)}const Ng=Op.types,z_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ch(o,t,l,f,_,E,b,A,k,F,G,J,ne){const le=A?Math.min(wh,Math.round(A[0])):0,de=A?Math.min(wh,Math.round(A[1])):0;o.emplaceBack(t,l,Math.round(32*f),Math.round(32*_),E,b,(le<<1)+(k?1:0),de,16*F,16*G,256*J,256*ne)}function Dh(o,t,l,f,_,E,b){o.emplaceBack(t,l,f,_,E,b)}function Zp(o,t,l,f,_){o.emplaceBack(t,l,f,_),o.emplaceBack(t,l,f,_),o.emplaceBack(t,l,f,_),o.emplaceBack(t,l,f,_)}function rp(o){for(const t of o.sections)if(nh(t.text))return!0;return!1}class Xp{constructor(t){this.layoutVertexArray=new Wn,this.indexArray=new ee,this.programConfigurations=t,this.segments=new go,this.dynamicLayoutVertexArray=new Kn,this.opacityVertexArray=new Xr,this.placedSymbolArray=new Vr,this.globeExtVertexArray=new Yn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,l,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,F0.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Lp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,z_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Uv.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Cr(Xp,"SymbolBuffers");class Qp{constructor(t,l,f){this.layoutVertexArray=new t,this.layoutAttributes=l,this.indexArray=new f,this.segments=new go,this.collisionVertexArray=new L,this.collisionVertexArrayExt=new $}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Wf.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,fg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Cr(Qp,"CollisionBuffers");class hd{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(b=>b.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$o([]),this.placementViewportMatrix=$o([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=S_(this.zoom,l["text-size"]),this.iconSizeData=S_(this.zoom,l["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),E=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==E&&void 0!==_.constantOr(1),this.sortFeaturesByY=("viewport-y"===E||"auto"===E&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(b=>Nu[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Xp(new pa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Xp(new pa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Tr,this.lineVertexArray=new Hs,this.symbolInstances=new Yt}calculateGlyphDependencies(t,l,f,_,E){for(let b=0;b<t.length;b++)if(l[t.charCodeAt(b)]=!0,_&&E){const A=Bp[t.charAt(b)];A&&(l[A.charCodeAt(0)]=!0)}}populate(t,l,f,_){const E=this.layers[0],b=E.layout,A="globe"===this.projection.name,k=b.get("text-font"),F=b.get("text-field"),G=b.get("icon-image"),J=("constant"!==F.value.kind||F.value.value instanceof ba&&!F.value.value.isEmpty()||F.value.value.toString().length>0)&&("constant"!==k.value.kind||k.value.value.length>0),ne="constant"!==G.value.kind||!!G.value.value||Object.keys(G.parameters).length>0,le=b.get("symbol-sort-key");if(this.features=[],!J&&!ne)return;const de=l.iconDependencies,Se=l.glyphDependencies,tt=l.availableImages,_t=new V(this.zoom);for(const{feature:At,id:yt,index:St,sourceLayerIndex:Ft}of t){const kt=E._featureFilter.needGeometry,yn=zt(At,kt);if(!E._featureFilter.filter(_t,yn,f))continue;if(kt||(yn.geometry=We(At,f,_)),A&&1!==At.type&&f.z<=5){const En=yn.geometry,$n=.98078528056,jn=(tr,cr)=>Gc(qu(tr.x,tr.y,f,1),qu(cr.x,cr.y,f,1))<$n;for(let tr=0;tr<En.length;tr++)En[tr]=S(En[tr],jn)}let pn,Fn;if(J){const En=E.getValueAndResolveTokens("text-field",yn,f,tt),$n=ba.factory(En);rp($n)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===w()||this.hasRTLText&&P.isParsed())&&(pn=Ty($n,E,yn))}if(ne){const En=E.getValueAndResolveTokens("icon-image",yn,f,tt);Fn=En instanceof Ro?En:Ro.fromString(En)}if(!pn&&!Fn)continue;const or=this.sortFeaturesByKey?le.evaluate(yn,{},f):void 0;if(this.features.push({id:yt,text:pn,icon:Fn,index:St,sourceLayerIndex:Ft,geometry:yn.geometry,properties:At.properties,type:Ng[At.type],sortKey:or}),Fn&&(de[Fn.name]=!0),pn){const En=k.evaluate(yn,{},f).join(","),$n="map"===b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nu.vertical)>=0;for(const jn of pn.sections)if(jn.image)de[jn.image.name]=!0;else{const tr=Su(pn.toString()),cr=jn.fontStack||En,Pn=Se[cr]=Se[cr]||{};this.calculateGlyphDependencies(jn.text,Pn,$n,this.allowVerticalPlacement,tr)}}}"line"===b.get("symbol-placement")&&(this.features=function(At){const yt={},St={},Ft=[];let kt=0;function yn(En){Ft.push(At[En]),kt++}function pn(En,$n,jn){const tr=St[En];return delete St[En],St[$n]=tr,Ft[tr].geometry[0].pop(),Ft[tr].geometry[0]=Ft[tr].geometry[0].concat(jn[0]),tr}function Fn(En,$n,jn){const tr=yt[$n];return delete yt[$n],yt[En]=tr,Ft[tr].geometry[0].shift(),Ft[tr].geometry[0]=jn[0].concat(Ft[tr].geometry[0]),tr}function or(En,$n,jn){const tr=jn?$n[0][$n[0].length-1]:$n[0][0];return`${En}:${tr.x}:${tr.y}`}for(let En=0;En<At.length;En++){const $n=At[En],jn=$n.geometry,tr=$n.text?$n.text.toString():null;if(!tr){yn(En);continue}const cr=or(tr,jn),Pn=or(tr,jn,!0);if(cr in St&&Pn in yt&&St[cr]!==yt[Pn]){const Pr=Fn(cr,Pn,jn),Zr=pn(cr,Pn,Ft[Pr].geometry);delete yt[cr],delete St[Pn],St[or(tr,Ft[Zr].geometry,!0)]=Zr,Ft[Pr].geometry=null}else cr in St?pn(cr,Pn,jn):Pn in yt?Fn(cr,Pn,jn):(yn(En),yt[cr]=kt-1,St[Pn]=kt-1)}return Ft.filter(En=>En.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((At,yt)=>At.sortKey-yt.sortKey)}update(t,l,f,_){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,l,this.layers,f,_),this.icon.programConfigurations.updatePaintArrays(t,l,this.layers,f,_))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Lm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,l){const f=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:_,y:E}of l)this.lineVertexArray.emplaceBack(_,E);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(t,l,f,_,E,b,A,k,F,G,J,ne,le,de){const Se=t.indexArray,tt=t.layoutVertexArray,_t=t.globeExtVertexArray,At=t.segments.prepareSegment(4*l.length,tt,Se,this.canOverlap?b.sortKey:void 0),yt=this.glyphOffsetArray.length,St=At.vertexLength,Ft=this.allowVerticalPlacement&&A===Nu.vertical?Math.PI/2:0,kt=b.text&&b.text.sections;for(let pn=0;pn<l.length;pn++){const{tl:Fn,tr:or,bl:En,br:$n,tex:jn,pixelOffsetTL:tr,pixelOffsetBR:cr,minFontScaleX:Pn,minFontScaleY:Pr,glyphOffset:Zr,isSDF:Lr,sectionIndex:is}=l[pn],hr=At.vertexLength,di=Zr[1];if(Ch(tt,F.x,F.y,Fn.x,di+Fn.y,jn.x,jn.y,f,Lr,tr.x,tr.y,Pn,Pr),Ch(tt,F.x,F.y,or.x,di+or.y,jn.x+jn.w,jn.y,f,Lr,cr.x,tr.y,Pn,Pr),Ch(tt,F.x,F.y,En.x,di+En.y,jn.x,jn.y+jn.h,f,Lr,tr.x,cr.y,Pn,Pr),Ch(tt,F.x,F.y,$n.x,di+$n.y,jn.x+jn.w,jn.y+jn.h,f,Lr,cr.x,cr.y,Pn,Pr),k){const{x:Zi,y:lo,z:ss}=k.anchor,[Ti,yi,cs]=k.up;Dh(_t,Zi,lo,ss,Ti,yi,cs),Dh(_t,Zi,lo,ss,Ti,yi,cs),Dh(_t,Zi,lo,ss,Ti,yi,cs),Dh(_t,Zi,lo,ss,Ti,yi,cs),Zp(t.dynamicLayoutVertexArray,Zi,lo,ss,Ft)}else Zp(t.dynamicLayoutVertexArray,F.x,F.y,F.z,Ft);Se.emplaceBack(hr,hr+1,hr+2),Se.emplaceBack(hr+1,hr+2,hr+3),At.vertexLength+=4,At.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zr[0]),pn!==l.length-1&&is===l[pn+1].sectionIndex||t.programConfigurations.populatePaintArrays(tt.length,b,b.index,{},le,de,kt&&kt[is])}const yn=k?k.anchor:F;t.placedSymbolArray.emplaceBack(yn.x,yn.y,yn.z,F.x,F.y,yt,this.glyphOffsetArray.length-yt,St,G,J,F.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],A,0,!1,0,ne,0)}_commitLayoutVertex(t,l,f,_,E,b,A){t.emplaceBack(l,f,_,E,b,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(t,l,f,_,E,b,A){const k=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),F=k.vertexLength,G=A.tileAnchorX,J=A.tileAnchorY;for(let le=0;le<4;le++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(l,-t.padding,-t.padding),f.collisionVertexArrayExt.emplaceBack(l,t.padding,-t.padding),f.collisionVertexArrayExt.emplaceBack(l,t.padding,t.padding),f.collisionVertexArrayExt.emplaceBack(l,-t.padding,t.padding),this._commitLayoutVertex(f.layoutVertexArray,_,E,b,G,J,new Le(t.x1,t.y1)),this._commitLayoutVertex(f.layoutVertexArray,_,E,b,G,J,new Le(t.x2,t.y1)),this._commitLayoutVertex(f.layoutVertexArray,_,E,b,G,J,new Le(t.x2,t.y2)),this._commitLayoutVertex(f.layoutVertexArray,_,E,b,G,J,new Le(t.x1,t.y2)),k.vertexLength+=4;const ne=f.indexArray;ne.emplaceBack(F,F+1),ne.emplaceBack(F+1,F+2),ne.emplaceBack(F+2,F+3),ne.emplaceBack(F+3,F),k.primitiveLength+=4}_addTextDebugCollisionBoxes(t,l,f,_,E,b){for(let A=_;A<E;A++){const k=f.get(A),F=this.getSymbolInstanceTextSize(t,b,l,A);this._addCollisionDebugVertices(k,F,this.textCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(t,l,f,_,E,b){for(let A=_;A<E;A++){const k=f.get(A),F=this.getSymbolInstanceIconSize(t,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(k,F,this.iconCollisionBox,k.projectedAnchorX,k.projectedAnchorY,k.projectedAnchorZ,b)}}generateCollisionDebugBuffers(t,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qp(Br,by.members,gn),this.iconCollisionBox=new Qp(Br,by.members,gn);const f=xl(this.iconSizeData,t),_=xl(this.textSizeData,t);for(let E=0;E<this.symbolInstances.length;E++){const b=this.symbolInstances.get(E);this._addTextDebugCollisionBoxes(_,t,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(_,t,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(f,t,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(f,t,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(t,l,f,_){const E=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:_),b=Fp(this.textSizeData,t,E)/Jl;return this.tilePixelRatio*b}getSymbolInstanceIconSize(t,l,f){const _=this.icon.placedSymbolArray.get(f),E=Fp(this.iconSizeData,t,_);return this.tilePixelRatio*E}_commitDebugCollisionVertexUpdate(t,l,f){t.emplaceBack(l,-f,-f),t.emplaceBack(l,f,-f),t.emplaceBack(l,f,f),t.emplaceBack(l,-f,f)}_updateTextDebugCollisionBoxes(t,l,f,_,E,b){for(let A=_;A<E;A++){const k=f.get(A),F=this.getSymbolInstanceTextSize(t,b,l,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,F,k.padding)}}_updateIconDebugCollisionBoxes(t,l,f,_,E,b){for(let A=_;A<E;A++){const k=f.get(A),F=this.getSymbolInstanceIconSize(t,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,F,k.padding)}}updateCollisionDebugBuffers(t,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=xl(this.iconSizeData,t),_=xl(this.textSizeData,t);for(let E=0;E<this.symbolInstances.length;E++){const b=this.symbolInstances.get(E);this._updateTextDebugCollisionBoxes(_,t,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(_,t,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(f,t,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,t,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,l,f,_,E,b,A,k,F){const G={};if(l<f){const{x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St,featureIndex:Ft}=t.get(l);G.textBox={x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St},G.textFeatureIndex=Ft}if(_<E){const{x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St,featureIndex:Ft}=t.get(_);G.verticalTextBox={x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St},G.verticalTextFeatureIndex=Ft}if(b<A){const{x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St,featureIndex:Ft}=t.get(b);G.iconBox={x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St},G.iconFeatureIndex=Ft}if(k<F){const{x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St,featureIndex:Ft}=t.get(k);G.verticalIconBox={x1:J,y1:ne,x2:le,y2:de,padding:Se,projectedAnchorX:tt,projectedAnchorY:_t,projectedAnchorZ:At,tileAnchorX:yt,tileAnchorY:St},G.verticalIconFeatureIndex=Ft}return G}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,l){const f=t.placedSymbolArray.get(l),_=f.vertexStartIndex+4*f.numGlyphs;for(let E=f.vertexStartIndex;E<_;E+=4)t.indexArray.emplaceBack(E,E+1,E+2),t.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(t),f=Math.cos(t),_=[],E=[],b=[];for(let A=0;A<this.symbolInstances.length;++A){b.push(A);const k=this.symbolInstances.get(A);_.push(0|Math.round(l*k.tileAnchorX+f*k.tileAnchorY)),E.push(k.featureIndex)}return b.sort((A,k)=>_[A]-_[k]||E[k]-E[A]),b}addToSortKeyRanges(t,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:E,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:F}=f;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),E>=0&&E!==_&&this.addIndicesForPlacedSymbol(this.text,E),b>=0&&b!==E&&b!==_&&this.addIndicesForPlacedSymbol(this.text,b),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k),F>=0&&this.addIndicesForPlacedSymbol(this.icon,F)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Cr(hd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hd.MAX_GLYPHS=65535,hd.addDynamicAttributes=Zp;const j_=new mt({"symbol-placement":new pe(bt.layout_symbol["symbol-placement"]),"symbol-spacing":new pe(bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pe(bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new he(bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pe(bt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pe(bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new pe(bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new pe(bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pe(bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new he(bt.layout_symbol["icon-size"]),"icon-text-fit":new pe(bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pe(bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new he(bt.layout_symbol["icon-image"]),"icon-rotate":new he(bt.layout_symbol["icon-rotate"]),"icon-padding":new pe(bt.layout_symbol["icon-padding"]),"icon-keep-upright":new pe(bt.layout_symbol["icon-keep-upright"]),"icon-offset":new he(bt.layout_symbol["icon-offset"]),"icon-anchor":new he(bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pe(bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pe(bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pe(bt.layout_symbol["text-rotation-alignment"]),"text-field":new he(bt.layout_symbol["text-field"]),"text-font":new he(bt.layout_symbol["text-font"]),"text-size":new he(bt.layout_symbol["text-size"]),"text-max-width":new he(bt.layout_symbol["text-max-width"]),"text-line-height":new he(bt.layout_symbol["text-line-height"]),"text-letter-spacing":new he(bt.layout_symbol["text-letter-spacing"]),"text-justify":new he(bt.layout_symbol["text-justify"]),"text-radial-offset":new he(bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pe(bt.layout_symbol["text-variable-anchor"]),"text-anchor":new he(bt.layout_symbol["text-anchor"]),"text-max-angle":new pe(bt.layout_symbol["text-max-angle"]),"text-writing-mode":new pe(bt.layout_symbol["text-writing-mode"]),"text-rotate":new he(bt.layout_symbol["text-rotate"]),"text-padding":new pe(bt.layout_symbol["text-padding"]),"text-keep-upright":new pe(bt.layout_symbol["text-keep-upright"]),"text-transform":new he(bt.layout_symbol["text-transform"]),"text-offset":new he(bt.layout_symbol["text-offset"]),"text-allow-overlap":new pe(bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new pe(bt.layout_symbol["text-ignore-placement"]),"text-optional":new pe(bt.layout_symbol["text-optional"])});var Fm={paint:new mt({"icon-opacity":new he(bt.paint_symbol["icon-opacity"]),"icon-color":new he(bt.paint_symbol["icon-color"]),"icon-halo-color":new he(bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new he(bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new he(bt.paint_symbol["icon-halo-blur"]),"icon-translate":new pe(bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new pe(bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new he(bt.paint_symbol["text-opacity"]),"text-color":new he(bt.paint_symbol["text-color"],{runtimeType:Ci,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new he(bt.paint_symbol["text-halo-color"]),"text-halo-width":new he(bt.paint_symbol["text-halo-width"]),"text-halo-blur":new he(bt.paint_symbol["text-halo-blur"]),"text-translate":new pe(bt.paint_symbol["text-translate"]),"text-translate-anchor":new pe(bt.paint_symbol["text-translate-anchor"])}),layout:j_};class Lg{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Vs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(t.formattedSection))return l.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Cr(Lg,"FormatSectionOverride",{omit:["defaultValue"]});class Bm extends rs{constructor(t){super(t,Fm)}recalculate(t,l){super.recalculate(t,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const E of f)_.indexOf(E)<0&&_.push(E);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,l,f,_){const E=this.layout.get(t).evaluate(l,{},f,_),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||ke(b.value)||!E?E:(A=l.properties,E.replace(/{([^{}]+)}/g,(F,G)=>G in A?String(A[G]):""));var A}createBucket(t){return new hd(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Fm.paint.overridableProperties){if(!Bm.hasPaintOverride(this.layout,t))continue;const l=this.paint.get(t),f=new Lg(l),_=new W(f,l.property.specification);let E=null;E="constant"===l.value.kind||"source"===l.value.kind?new be("source",_):new wt("composite",_,l.value.zoomStops,l.value._interpolationType),this.paint._values[t]=new rt(l.property,E,l.parameters)}}_handleOverridablePaintPropertyUpdate(t,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&Bm.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,l){const f=t.get("text-field"),_=Fm.paint.properties[l];let E=!1;const b=A=>{for(const k of A)if(_.overrides&&_.overrides.hasOverride(k))return void(E=!0)};if("constant"===f.value.kind&&f.value.value instanceof ba)b(f.value.value.sections);else if("source"===f.value.kind){const A=F=>{E||(F instanceof ia&&no(F.value)===Mo?b(F.value.sections):F instanceof Us?b(F.sections):F.eachChild(A))},k=f.value;k._styleExpression&&A(k._styleExpression.expression)}return E}getProgramConfiguration(t){return new ml(this,t)}}var Py={paint:new mt({"background-color":new pe(bt.paint_background["background-color"]),"background-pattern":new pe(bt.paint_background["background-pattern"]),"background-opacity":new pe(bt.paint_background["background-opacity"])})},Oy={paint:new mt({"raster-opacity":new pe(bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new pe(bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pe(bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pe(bt.paint_raster["raster-brightness-max"]),"raster-saturation":new pe(bt.paint_raster["raster-saturation"]),"raster-contrast":new pe(bt.paint_raster["raster-contrast"]),"raster-resampling":new pe(bt.paint_raster["raster-resampling"]),"raster-fade-duration":new pe(bt.paint_raster["raster-fade-duration"])})};class $_ extends rs{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var Zv={paint:new mt({"sky-type":new pe(bt.paint_sky["sky-type"]),"sky-atmosphere-sun":new pe(bt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new pe(bt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new pe(bt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new pe(bt.paint_sky["sky-gradient-radius"]),"sky-gradient":new gt(bt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new pe(bt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new pe(bt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new pe(bt.paint_sky["sky-opacity"])})};function G_(o,t,l){const f=[0,0,1],_=Ep([]);return ah(_,_,l?-Ze(o)+Math.PI:Ze(o)),id(_,_,-Ze(t)),Pf(f,f,_),Ac(f,f)}const Xv={circle:class extends rs{constructor(o){super(o,p_)}createBucket(o){return new ir(o)}queryRadius(o){const t=o;return Td("circle-radius",this,t)+Td("circle-stroke-width",this,t)+tf(this.paint.get("circle-translate"))}queryIntersectsFeature(o,t,l,f,_,E,b,A){const k=Ap(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),E.angle,o.pixelToTileUnitsFactor),F=this.paint.get("circle-radius").evaluate(t,l)+this.paint.get("circle-stroke-width").evaluate(t,l);return m_(o,f,E,b,A,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),k,F)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new ml(this,o)}},heatmap:class extends rs{createBucket(o){return new nf(o)}constructor(o){super(o,kv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Td("heatmap-radius",this,o)}queryIntersectsFeature(o,t,l,f,_,E,b,A){const k=this.paint.get("heatmap-radius").evaluate(t,l);return m_(o,f,E,b,A,!0,!0,new Le(0,0),k)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new ml(this,o)}},hillshade:class extends rs{constructor(o){super(o,$d)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends rs{constructor(o){super(o,vy)}getProgramIds(){const o=this.paint.get("fill-pattern"),t=o&&o.constantOr(1),l=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(o){return new ml(this,o)}recalculate(o,t){super.recalculate(o,t);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Mp(o)}queryRadius(){return tf(this.paint.get("fill-translate"))}queryIntersectsFeature(o,t,l,f,_,E){return!o.queryGeometry.isAboveHorizon&&ks(mm(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),E.angle,o.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends rs{constructor(o){super(o,ug)}createBucket(o){return new $f(o)}queryRadius(){return tf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new ml(this,o)}queryIntersectsFeature(o,t,l,f,_,E,b,A,k){const F=Ap(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),E.angle,o.pixelToTileUnitsFactor),G=this.paint.get("fill-extrusion-height").evaluate(t,l),J=this.paint.get("fill-extrusion-base").evaluate(t,l),ne=[0,0],le=A&&E.elevation,de=E.elevation?E.elevation.exaggeration():1,Se=o.tile.getBucket(this);if(le&&Se instanceof $f){const St=Se.centroidVertexArray,Ft=k+1;Ft<St.length&&(ne[0]=St.geta_centroid_pos0(Ft),ne[1]=St.geta_centroid_pos1(Ft))}if(0===ne[0]&&1===ne[1])return!1;"globe"===E.projection.name&&(f=Zc([f],[new Le(0,0),new Le(ii,ii)],o.tileID.canonical).map(St=>St.polygon).flat());const tt=le?A:null,[_t,At]=(Ft=f,kt=J,yn=G,pn=F,Fn=b,or=tt,En=ne,$n=de,jn=E.center.lat,"globe"===(St=E).projection.name?function(cr,Pn,Pr,Zr,Lr,is,hr,di,Zi,lo,ss){const Ti=[],yi=[],cs=cr.projection.upVectorScale(ss,cr.center.lat,cr.worldSize).metersToTile,ts=[0,0,0,1],Ys=[0,0,0,1],Go=(Vi,Io,Oa,El)=>{Vi[0]=Io,Vi[1]=Oa,Vi[2]=El,Vi[3]=1},ms=b_();Pr>0&&(Pr+=ms),Zr+=ms;for(const Vi of Pn){const Io=[],Oa=[];for(const El of Vi){const _o=El.x+Lr.x,wl=El.y+Lr.y,ka=cr.projection.projectTilePoint(_o,wl,ss),Na=cr.projection.upVector(ss,El.x,El.y);let co=Pr,sl=Zr;if(hr){const Zo=T_(_o,wl,Pr,Zr,hr,di,Zi,lo);co+=Zo.base,sl+=Zo.top}0!==Pr?Go(ts,ka.x+Na[0]*cs*co,ka.y+Na[1]*cs*co,ka.z+Na[2]*cs*co):Go(ts,ka.x,ka.y,ka.z),Go(Ys,ka.x+Na[0]*cs*sl,ka.y+Na[1]*cs*sl,ka.z+Na[2]*cs*sl),ua(ts,ts,is),ua(Ys,Ys,is),Io.push(new ld(ts[0],ts[1],ts[2])),Oa.push(new ld(Ys[0],Ys[1],Ys[2]))}Ti.push(Io),yi.push(Oa)}return[Ti,yi]}(St,Ft,kt,yn,pn,Fn,or,En,$n,jn,o.tileID.canonical):or?function(cr,Pn,Pr,Zr,Lr,is,hr,di,Zi){const lo=[],ss=[],Ti=[0,0,0,1];for(const yi of cr){const cs=[],ts=[];for(const Ys of yi){const Go=Ys.x+Zr.x,ms=Ys.y+Zr.y,Vi=T_(Go,ms,Pn,Pr,is,hr,di,Zi);Ti[0]=Go,Ti[1]=ms,Ti[2]=Vi.base,Ti[3]=1,Hu(Ti,Ti,Lr),Ti[3]=Math.max(Ti[3],1e-5);const Io=new ld(Ti[0]/Ti[3],Ti[1]/Ti[3],Ti[2]/Ti[3]);Ti[0]=Go,Ti[1]=ms,Ti[2]=Vi.top,Ti[3]=1,Hu(Ti,Ti,Lr),Ti[3]=Math.max(Ti[3],1e-5);const Oa=new ld(Ti[0]/Ti[3],Ti[1]/Ti[3],Ti[2]/Ti[3]);cs.push(Io),ts.push(Oa)}lo.push(cs),ss.push(ts)}return[lo,ss]}(Ft,kt,yn,pn,Fn,or,En,$n,jn):function(cr,Pn,Pr,Zr,Lr){const is=[],hr=[],di=Lr[8]*Pn,Zi=Lr[9]*Pn,lo=Lr[10]*Pn,ss=Lr[11]*Pn,Ti=Lr[8]*Pr,yi=Lr[9]*Pr,cs=Lr[10]*Pr,ts=Lr[11]*Pr;for(const Ys of cr){const Go=[],ms=[];for(const Vi of Ys){const Io=Vi.x+Zr.x,Oa=Vi.y+Zr.y,El=Lr[0]*Io+Lr[4]*Oa+Lr[12],_o=Lr[1]*Io+Lr[5]*Oa+Lr[13],wl=Lr[2]*Io+Lr[6]*Oa+Lr[14],ka=Lr[3]*Io+Lr[7]*Oa+Lr[15],Na=El+di,co=_o+Zi,sl=wl+lo,Zo=Math.max(ka+ss,1e-5),qs=El+Ti,Ea=_o+yi,pc=wl+cs,Ks=Math.max(ka+ts,1e-5);Go.push(new ld(Na/Zo,co/Zo,sl/Zo)),ms.push(new ld(qs/Ks,Ea/Ks,pc/Ks))}is.push(Go),hr.push(ms)}return[is,hr]}(Ft,kt,yn,pn,Fn)),yt=o.queryGeometry;var St,Ft,kt,yn,pn,Fn,or,En,$n,jn;return function(St,Ft,kt){let yn=1/0;ks(kt,Ft)&&(yn=Hf(kt,Ft[0]));for(let pn=0;pn<Ft.length;pn++){const Fn=Ft[pn],or=St[pn];for(let En=0;En<Fn.length-1;En++){const $n=Fn[En],jn=[$n,Fn[En+1],or[En+1],or[En],$n];oi(kt,jn)&&(yn=Math.min(yn,Hf(kt,jn)))}}return yn!==1/0&&yn}(_t,At,yt.isPointQuery()?yt.screenBounds:yt.screenGeometry)}},line:class extends rs{constructor(o){super(o,dg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof za,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,t){super.recalculate(o,t),this.paint._values["line-floorwidth"]=I_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new cd(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new ml(this,o)}queryRadius(o){const t=o,l=hg(Td("line-width",this,t),Td("line-gap-width",this,t)),f=Td("line-offset",this,t);return l/2+Math.abs(f)+tf(this.paint.get("line-translate"))}queryIntersectsFeature(o,t,l,f,_,E){if(o.queryGeometry.isAboveHorizon)return!1;const b=mm(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),E.angle,o.pixelToTileUnitsFactor),A=o.pixelToTileUnitsFactor/2*hg(this.paint.get("line-width").evaluate(t,l),this.paint.get("line-gap-width").evaluate(t,l)),k=this.paint.get("line-offset").evaluate(t,l);return k&&(f=function(F,G){const J=[],ne=new Le(0,0);for(let le=0;le<F.length;le++){const de=F[le],Se=[];for(let tt=0;tt<de.length;tt++){const _t=de[tt],At=de[tt+1],yt=0===tt?ne:_t.sub(de[tt-1])._unit()._perp(),St=tt===de.length-1?ne:At.sub(_t)._unit()._perp(),Ft=yt._add(St)._unit();Ft._mult(1/(Ft.x*St.x+Ft.y*St.y)),Se.push(Ft._mult(G)._add(_t))}J.push(Se)}return J}(f,k*o.pixelToTileUnitsFactor)),function(F,G,J){for(let ne=0;ne<G.length;ne++){const le=G[ne];if(F.length>=3)for(let de=0;de<le.length;de++)if(lu(F,le[de]))return!0;if(Nc(F,le,J))return!0}return!1}(b,f,A)}isTileClipped(){return!0}},symbol:Bm,background:class extends rs{constructor(o){super(o,Py)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends rs{constructor(o){super(o,Oy)}getProgramIds(){return["raster"]}},sky:class extends rs{constructor(o){super(o,Zv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(o,t){if("atmosphere"===this.paint.get("sky-type")){const f=this.paint.get("sky-atmosphere-sun"),_=!f,E=o.style.light,b=E.properties.get("position");return _&&"viewport"===E.properties.get("anchor")&&ur("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?G_(b.azimuthal,90-b.polar,t):G_(f[0],90-f[1],t)}const l=this.paint.get("sky-gradient-center");return G_(l[0],90-l[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class Vm{constructor(t,l,f,_){this.context=t,this.format=f,this.texture=t.gl.createTexture(),this.update(l,_)}update(t,l,f){const{width:_,height:E}=t,{context:b}=this,{gl:A}=b,{HTMLImageElement:k,HTMLCanvasElement:F,HTMLVideoElement:G,ImageData:J,ImageBitmap:ne}=ae;if(A.bindTexture(A.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!l||!1!==l.premultiply)),f||this.size&&this.size[0]===_&&this.size[1]===E){const{x:le,y:de}=f||{x:0,y:0};t instanceof k||t instanceof F||t instanceof G||t instanceof J||ne&&t instanceof ne?A.texSubImage2D(A.TEXTURE_2D,0,le,de,A.RGBA,A.UNSIGNED_BYTE,t):A.texSubImage2D(A.TEXTURE_2D,0,le,de,_,E,A.RGBA,A.UNSIGNED_BYTE,t.data)}else this.size=[_,E],t instanceof k||t instanceof F||t instanceof G||t instanceof J||ne&&t instanceof ne?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,t):A.texImage2D(A.TEXTURE_2D,0,this.format,_,E,0,this.format,A.UNSIGNED_BYTE,t.data);this.useMipmap=!!(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(t,l){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?t===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_NEAREST:t),this.filter=t),l!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Fg{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ky{constructor(){this.tasks={},this.taskQueue=[],Vn(["process"],this),this.invoker=new Fg(this.process),this.nextId=0}add(t,l){const f=this.nextId++,_=function({type:E,isSymbolTile:b,zoom:A}){return A=A||0,"message"===E?0:"maybePrepare"!==E||b?"parseTile"!==E||b?"parseTile"===E&&b?300-A:"maybePrepare"===E&&b?400-A:500:200-A:100-A}(l);if(0===_){nr();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:t,metadata:l,priority:_,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){nr();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const l=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let t=null,l=1/0;for(let _=0;_<this.taskQueue.length;_++){const E=this.tasks[this.taskQueue[_]];E.priority<l&&(l=E.priority,t=_)}if(null===t)return null;const f=this.taskQueue[t];return this.taskQueue.splice(t,1),f}remove(){this.invoker.remove()}}class Bg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let l=0;l<t.length;l++){const f=t[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const Ny=["tile","layer","source","sourceLayer","state"];class Xc{constructor(t,l,f,_,E){this.type="Feature",this._vectorTileFeature=t,this._z=l,this._x=f,this._y=_,this.properties=t.properties,this.id=E}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const l of Ny)void 0!==this[l]&&(t[l]=this[l]);return t}}const ip=new Uint16Array(8184);for(let o=0;o<2046;o++){let t=o+2,l=0,f=0,_=0,E=0,b=0,A=0;for(1&t?_=E=b=32:l=f=A=32;(t>>=1)>1;){const F=l+_>>1,G=f+E>>1;1&t?(_=l,E=f,l=b,f=A):(l=_,f=E,_=b,E=A),b=F,A=G}const k=4*o;ip[k+0]=l,ip[k+1]=f,ip[k+2]=_,ip[k+3]=E}const Bu=new Uint16Array(2178),Mh=new Uint8Array(1089),Yp=new Uint16Array(1089);function Ly(o){return 0===o?-.03125:32===o?.03125:0}var Vg=Kt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ug={type:2,extent:ii,loadGeometry:()=>[[new Le(0,0),new Le(ii+1,0),new Le(ii+1,ii+1),new Le(0,ii+1),new Le(0,0)]]};class Um{constructor(t,l,f,_,E){this.tileID=t,this.uid=$t(),this.uses=0,this.tileSize=l,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(t){const l=t+this.timeAdded;l<ws.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=bh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,l,f){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(_,E){const b={};if(!E)return b;for(const A of _){const k=A.layerIds.map(F=>E.getLayer(F)).filter(Boolean);if(0!==k.length){A.layers=k,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(F=>k.filter(G=>G.id===F)[0]));for(const F of k)b[F.id]=A}}return b}(t.buckets,l.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const E=this.buckets[_];if(E instanceof hd){if(this.hasSymbolBuckets=!0,!f)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const E=this.buckets[_];if(E instanceof hd&&E.hasRTLText){this.hasRTLText=!0,P.isLoading()||P.isLoaded()||"deferred"!==w()||C();break}}this.queryPadding=0;for(const _ in this.buckets){const E=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(_).queryRadius(E))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Jn}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const _=this.buckets[f];_.uploadPending()&&_.upload(t)}const l=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vm(t,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vm(t,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vm(t,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,l,f,_,E,b,A,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:A,transform:b,params:E,tileTransform:this.tileTransform},t,l,f):{}}querySourceFeatures(t,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),E=l?l.sourceLayer:"",b=_._geojsonTileLayer||_[E];if(!b)return;const A=lr(l&&l.filter),{z:k,x:F,y:G}=this.tileID.canonical,J={z:k,x:F,y:G};for(let ne=0;ne<b.length;ne++){const le=b.feature(ne);if(A.needGeometry){const tt=zt(le,!0);if(!A.filter(new V(this.tileID.overscaledZ),tt,this.tileID.canonical))continue}else if(!A.filter(new V(this.tileID.overscaledZ),le))continue;const de=f.getId(le,E),Se=new Xc(le,k,F,G,de);Se.tile=J,t.push(Se)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const l=this.expirationTime;if(t.cacheControl){const f=mr(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{const E=this.expirationTime-l;E?this.expirationTime=f+Math.max(E,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!l)return;const f=this.latestFeatureIndex.loadVTLayers(),_=l.style.listImages();for(const E in this.buckets){if(!l.style.hasLayer(E))continue;const b=this.buckets[E],A=b.layers[0].sourceLayer||"_geojsonTileLayer",k=f[A],F=t[A];if(!k||!F||0===Object.keys(F).length)continue;if(b.update(F,k,_,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof cd||b instanceof Mp){const J=l.style._getSourceCache(b.layers[0].source);l._terrain&&l._terrain.enabled&&J&&b.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(J.id,this.tileID)}const G=l&&l.style&&l.style.getLayer(E);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ws.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ws.now()+t}setTexture(t,l){const f=l.context,_=f.gl;this.texture=this.texture||l.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Vm(f,t,_.RGBA,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,l){const f={};for(const _ of l)f[_]=!0;this.dependencies[t]=f}hasDependency(t,l){for(const f of t){const _=this.dependencies[f];if(_)for(const E of l)if(_[E])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const f=We(Ug,this.tileID.canonical,this.tileTransform)[0],_=new rr,E=new Rn;for(let b=0;b<f.length;b++){const{x:A,y:k}=f[b];_.emplaceBack(A,k),E.emplaceBack(b)}E.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(E),this._tileDebugBuffer=t.createVertexBuffer(_,ma.members),this._tileDebugSegments=go.simpleSegment(0,0,_.length,E.length)}_makeTileBoundsBuffers(t,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const f=We(Ug,this.tileID.canonical,this.tileTransform)[0];let _,E;if(this.isRaster){const b=function(A,k){const F=bh(A,k),G=Math.pow(2,A.z);for(let tt=0;tt<33;tt++)for(let _t=0;_t<33;_t++){const At=qa((A.x+(_t+Ly(_t))/32)/G),yt=Ka((A.y+(tt+Ly(tt))/32)/G),St=k.project(At,yt),Ft=33*tt+_t;Bu[2*Ft+0]=Math.round((St.x*F.scale-F.x)*ii),Bu[2*Ft+1]=Math.round((St.y*F.scale-F.y)*ii)}Mh.fill(0),Yp.fill(0);for(let tt=2045;tt>=0;tt--){const _t=4*tt,At=ip[_t+0],yt=ip[_t+1],St=ip[_t+2],Ft=ip[_t+3],kt=At+St>>1,yn=yt+Ft>>1,pn=kt+yn-yt,Fn=yn+At-kt,or=33*yt+At,En=33*Ft+St,$n=33*yn+kt,jn=Math.hypot((Bu[2*or+0]+Bu[2*En+0])/2-Bu[2*$n+0],(Bu[2*or+1]+Bu[2*En+1])/2-Bu[2*$n+1])>=16;Mh[$n]=Mh[$n]||(jn?1:0),tt<1022&&(Mh[$n]=Mh[$n]||Mh[33*(yt+Fn>>1)+(At+pn>>1)]||Mh[33*(Ft+Fn>>1)+(St+pn>>1)])}const J=new Dn,ne=new ee;let le=0;function de(tt,_t){const At=33*_t+tt;return 0===Yp[At]&&(J.emplaceBack(Bu[2*At+0],Bu[2*At+1],tt*ii/32,_t*ii/32),Yp[At]=++le),Yp[At]-1}function Se(tt,_t,At,yt,St,Ft){const kt=tt+At>>1,yn=_t+yt>>1;if(Math.abs(tt-St)+Math.abs(_t-Ft)>1&&Mh[33*yn+kt])Se(St,Ft,tt,_t,kt,yn),Se(At,yt,St,Ft,kt,yn);else{const pn=de(tt,_t),Fn=de(At,yt),or=de(St,Ft);ne.emplaceBack(pn,Fn,or)}}return Se(0,0,32,32,32,0),Se(32,32,0,0,0,32),{vertices:J,indices:ne}}(this.tileID.canonical,l);_=b.vertices,E=b.indices}else{_=new Dn,E=new ee;for(const{x:A,y:k}of f)_.emplaceBack(A,k,0,0);const b=Ad(_.int16,void 0,4);for(let A=0;A<b.length;A+=3)E.emplaceBack(b[A],b[A+1],b[A+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,Vg.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(E),this._tileBoundsSegments=go.simpleSegment(0,0,_.length,E.length)}_makeGlobeTileDebugBuffers(t,l){const f=l.projection;if(!f||"globe"!==f.name||l.freezeTileCoverage)return;const _=this.tileID.canonical,E=Wc(wp(_,l)),b=yu(l.zoom);let A;b>0&&(A=Vh(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,l,E,A,b),this._makeGlobeTileDebugTextBuffer(t,_,l,E,A,b)}_globePoint(t,l,f,_,E,b,A){let k=qu(t,l,f);if(b){const F=1<<f.z,G=au(_.center.lng),J=yl(_.center.lat),ne=(f.x+.5)/F-G;let le=0;ne>.5?le=-1:ne<-.5&&(le=1);let de=(t/ii+f.x)/F+le,Se=(l/ii+f.y)/F;de=(de-G)*_._pixelsPerMercatorPixel+G,Se=(Se-J)*_._pixelsPerMercatorPixel+J;const tt=[de*_.worldSize,Se*_.worldSize,0];ua(tt,tt,b),k=_u(k,tt,A)}return ua(k,k,E)}_makeGlobeTileDebugBorderBuffer(t,l,f,_,E,b){const A=new rr,k=new Rn,F=new cn,G=(ne,le,de,Se,tt)=>{const _t=(de-ne)/(tt-1),At=(Se-le)/(tt-1),yt=A.length;for(let St=0;St<tt;St++){const Ft=ne+St*_t,kt=le+St*At;A.emplaceBack(Ft,kt);const yn=this._globePoint(Ft,kt,l,f,_,E,b);F.emplaceBack(yn[0],yn[1],yn[2]),k.emplaceBack(yt+St)}},J=ii;G(0,0,J,0,16),G(J,0,J,J,16),G(J,J,0,J,16),G(0,J,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(k),this._tileDebugBuffer=t.createVertexBuffer(A,ma.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(F,sd.members),this._tileDebugSegments=go.simpleSegment(0,0,A.length,k.length)}_makeGlobeTileDebugTextBuffer(t,l,f,_,E,b){const A=ii/4,k=new rr,F=new ee,G=new cn,J=25;F.reserve(32),k.reserve(J),G.reserve(J);const ne=(le,de)=>J*le+de;for(let le=0;le<J;le++){const de=le*A;for(let Se=0;Se<J;Se++){const tt=Se*A;k.emplaceBack(tt,de);const _t=this._globePoint(tt,de,l,f,_,E,b);G.emplaceBack(_t[0],_t[1],_t[2])}}for(let le=0;le<4;le++)for(let de=0;de<4;de++){const Se=ne(le,de),tt=ne(le,de+1),_t=ne(le+1,de),At=ne(le+1,de+1);F.emplaceBack(Se,tt,_t),F.emplaceBack(_t,tt,At)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(F),this._tileDebugTextBuffer=t.createVertexBuffer(k,ma.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(G,sd.members),this._tileDebugTextSegments=go.simpleSegment(0,0,J,32)}}class Fy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,l,f){const _=String(l);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},Qe(this.stateChanges[t][_],f),null===this.deletedStates[t]){this.deletedStates[t]={};for(const E in this.state[t])E!==_&&(this.deletedStates[t][E]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][_]){this.deletedStates[t][_]={};for(const E in this.state[t][_])f[E]||(this.deletedStates[t][_][E]=null)}else for(const E in f)this.deletedStates[t]&&this.deletedStates[t][_]&&null===this.deletedStates[t][_][E]&&delete this.deletedStates[t][_][E]}removeFeatureState(t,l,f){if(null===this.deletedStates[t])return;const _=String(l);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&void 0!==l)null!==this.deletedStates[t][_]&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][f]=null);else if(void 0!==l)if(this.stateChanges[t]&&this.stateChanges[t][_])for(f in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][f]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,l){const f=String(l),_=Qe({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const E=this.deletedStates[t][l];if(null===E)return{};for(const b in E)delete _[b]}return _}initializeTileState(t,l){t.setFeatureState(this.state,l)}coalesceChanges(t,l){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const E={};for(const b in this.stateChanges[_])this.state[_][b]||(this.state[_][b]={}),Qe(this.state[_][b],this.stateChanges[_][b]),E[b]=this.state[_][b];f[_]=E}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const E={};if(null===this.deletedStates[_])for(const b in this.state[_])E[b]={},this.state[_][b]={};else for(const b in this.deletedStates[_]){if(null===this.deletedStates[_][b])this.state[_][b]={};else if(this.state[_][b])for(const A of Object.keys(this.deletedStates[_][b]))delete this.state[_][b][A];E[b]=this.state[_][b]}f[_]=f[_]||{},Qe(f[_],E)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const _ in t)t[_].setFeatureState(f,l)}}class zg{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,l){const f=this.toIdx(t,l);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(t,l){return this.leaves[this.toIdx(t,l)]}toIdx(t,l){return l*this.size+t}}function jg(o,t,l,f){let _=0,E=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(f[b])<1e-15){if(l[b]<o[b]||l[b]>t[b])return null}else{const A=1/f[b];let k=(o[b]-l[b])*A,F=(t[b]-l[b])*A;if(k>F){const G=k;k=F,F=G}if(k>_&&(_=k),F<E&&(E=F),_>E)return null}return _}function By(o,t,l,f,_,E,b,A,k,F,G){const J=f-o,ne=_-t,le=E-l,de=b-o,Se=A-t,tt=k-l,_t=G[1]*tt-G[2]*Se,At=G[2]*de-G[0]*tt,yt=G[0]*Se-G[1]*de,St=J*_t+ne*At+le*yt;if(Math.abs(St)<1e-15)return null;const Ft=1/St,kt=F[0]-o,yn=F[1]-t,pn=F[2]-l,Fn=(kt*_t+yn*At+pn*yt)*Ft;if(Fn<0||Fn>1)return null;const or=yn*le-pn*ne,En=pn*J-kt*le,$n=kt*ne-yn*J,jn=(G[0]*or+G[1]*En+G[2]*$n)*Ft;return jn<0||Fn+jn>1?null:(de*or+Se*En+tt*$n)*Ft}function $g(o,t,l){return(o-t)/(l-t)}function Vy(o,t,l,f,_,E,b,A,k){const F=1<<l,G=E-f,J=b-_,ne=(o+1)/F*G+f,le=(t+0)/F*J+_,de=(t+1)/F*J+_;A[0]=(o+0)/F*G+f,A[1]=le,k[0]=ne,k[1]=de}class Gg{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(E){const b=Math.ceil(Math.log2(E.dim/8)),A=[];let k=Math.ceil(Math.pow(2,b));const F=1/k,G=(le,de,Se,tt,_t)=>{const At=tt?1:0,yt=(le+1)*Se-At,St=de*Se,Ft=(de+1)*Se-At;_t[0]=le*Se,_t[1]=St,_t[2]=yt,_t[3]=Ft};let J=new zg(k);const ne=[];for(let le=0;le<k*k;le++){G(le%k,Math.floor(le/k),F,!1,ne);const de=pd(ne[0],ne[1],E),Se=pd(ne[2],ne[1],E),tt=pd(ne[2],ne[3],E),_t=pd(ne[0],ne[3],E);J.minimums.push(Math.min(de,Se,tt,_t)),J.maximums.push(Math.max(de,Se,tt,_t)),J.leaves.push(1)}for(A.push(J),k/=2;k>=1;k/=2){const le=A[A.length-1];J=new zg(k);for(let de=0;de<k*k;de++){G(de%k,Math.floor(de/k),2,!0,ne);const Se=le.getElevation(ne[0],ne[1]),tt=le.getElevation(ne[2],ne[1]),_t=le.getElevation(ne[2],ne[3]),At=le.getElevation(ne[0],ne[3]),yt=le.isLeaf(ne[0],ne[1]),St=le.isLeaf(ne[2],ne[1]),Ft=le.isLeaf(ne[2],ne[3]),kt=le.isLeaf(ne[0],ne[3]),yn=Math.min(Se.min,tt.min,_t.min,At.min),pn=Math.max(Se.max,tt.max,_t.max,At.max),Fn=yt&&St&&Ft&&kt;J.maximums.push(pn),J.minimums.push(yn),J.leaves.push(pn-yn<=5&&Fn?1:0)}A.push(J)}return A}(this.dem),f=l.length-1,_=l[f];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(l,0,0,f,0)}raycastRoot(t,l,f,_,E,b,A=1){return jg([t,l,-100],[f,_,this.maximums[0]*A],E,b)}raycast(t,l,f,_,E,b,A=1){if(!this.nodeCount)return null;const k=this.raycastRoot(t,l,f,_,E,b,A);if(null==k)return null;const F=[],G=[],J=[],ne=[],le=[{idx:0,t:k,nodex:0,nodey:0,depth:0}];for(;le.length>0;){const{idx:de,t:Se,nodex:tt,nodey:_t,depth:At}=le.pop();if(this.leaves[de]){Vy(tt,_t,At,t,l,f,_,J,ne);const St=1<<At,Ft=(tt+0)/St,kt=(tt+1)/St,yn=(_t+0)/St,pn=(_t+1)/St,Fn=pd(Ft,yn,this.dem)*A,or=pd(kt,yn,this.dem)*A,En=pd(kt,pn,this.dem)*A,$n=pd(Ft,pn,this.dem)*A,jn=By(J[0],J[1],Fn,ne[0],J[1],or,ne[0],ne[1],En,E,b),tr=By(ne[0],ne[1],En,J[0],ne[1],$n,J[0],J[1],Fn,E,b),cr=Math.min(null!==jn?jn:Number.MAX_VALUE,null!==tr?tr:Number.MAX_VALUE);if(cr!==Number.MAX_VALUE)return cr;{const Pn=$h([],E,b,Se);if(kd(Fn,or,$n,En,$g(Pn[0],J[0],ne[0]),$g(Pn[1],J[1],ne[1]))>=Pn[2])return Se}continue}let yt=0;for(let St=0;St<this._siblingOffset.length;St++){Vy((tt<<1)+this._siblingOffset[St][0],(_t<<1)+this._siblingOffset[St][1],At+1,t,l,f,_,J,ne),J[2]=-100,ne[2]=this.maximums[this.childOffsets[de]+St]*A;const Ft=jg(J,ne,E,b);if(null!=Ft){const kt=Ft;F[St]=kt;let yn=!1;for(let pn=0;pn<yt&&!yn;pn++)kt>=F[G[pn]]&&(G.splice(pn,0,St),yn=!0);yn||(G[yt]=St),yt++}}for(let St=0;St<yt;St++){const Ft=G[St];le.push({idx:this.childOffsets[de]+Ft,t:F[Ft],nodex:(tt<<1)+this._siblingOffset[Ft][0],nodey:(_t<<1)+this._siblingOffset[Ft][1],depth:At+1})}}return null}_addNode(t,l,f){return this.minimums.push(t),this.maximums.push(l),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(t,l,f,_,E){if(1===t[_].isLeaf(l,f))return;this.childOffsets[E]||(this.childOffsets[E]=this.nodeCount);const b=_-1,A=t[b];let k=0,F=0;for(let G=0;G<this._siblingOffset.length;G++){const J=2*l+this._siblingOffset[G][0],ne=2*f+this._siblingOffset[G][1],le=A.getElevation(J,ne),de=A.isLeaf(J,ne),Se=this._addNode(le.min,le.max,de);de&&(k|=1<<G),F||(F=Se)}for(let G=0;G<this._siblingOffset.length;G++)k&1<<G||this._construct(t,2*l+this._siblingOffset[G][0],2*f+this._siblingOffset[G][1],b,F+G)}}function kd(o,t,l,f,_,E){return ns(ns(o,l,E),ns(t,f,E),_)}function pd(o,t,l){const f=l.dim,_=qt(o*f-.5,0,f-1),E=qt(t*f-.5,0,f-1),b=Math.floor(_),A=Math.floor(E),k=Math.min(b+1,f-1),F=Math.min(A+1,f-1);return kd(l.get(b,A),l.get(k,A),l.get(b,F),l.get(k,F),_-b,E-A)}const Hg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function H_(o,t,l){return(256*o*256+256*t+l)/10-1e4}function sp(o,t,l){return 256*o+t+l/256-32768}class Jp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,l,f,_=!1,E=!1){if(this.uid=t,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return ur(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2,A=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=f||"mapbox",this.borderReady=_,!_){for(let k=0;k<b;k++)A[this._idx(-1,k)]=A[this._idx(0,k)],A[this._idx(b,k)]=A[this._idx(b-1,k)],A[this._idx(k,-1)]=A[this._idx(k,0)],A[this._idx(k,b)]=A[this._idx(k,b-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(b,-1)]=A[this._idx(b-1,0)],A[this._idx(-1,b)]=A[this._idx(0,b-1)],A[this._idx(b,b)]=A[this._idx(b-1,b-1)],E&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Gg(this)}get(t,l,f=!1){f&&(t=qt(t,-1,this.dim),l=qt(l,-1,this.dim));const _=4*this._idx(t,l);return("terrarium"===this.encoding?sp:H_)(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}static getUnpackVector(t){return Hg[t]}get unpackVector(){return Hg[this.encoding]}_idx(t,l){if(t<-1||t>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(t+1)}static pack(t,l){const f=[0,0,0,0],_=Jp.getUnpackVector(l);let E=Math.floor((t+_[3])/_[2]);return f[2]=E%256,E=Math.floor(E/256),f[1]=E%256,E=Math.floor(E/256),f[0]=E,f}getPixels(){return new Kc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,l,f){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let _=l*this.dim,E=l*this.dim+this.dim,b=f*this.dim,A=f*this.dim+this.dim;switch(l){case-1:_=E-1;break;case 1:E=_+1}switch(f){case-1:b=A-1;break;case 1:A=b+1}const k=-l*this.dim,F=-f*this.dim;for(let G=b;G<A;G++)for(let J=_;J<E;J++){const ne=4*this._idx(J,G),le=4*this._idx(J+k,G+F);this.pixels[ne+0]=t.pixels[le+0],this.pixels[ne+1]=t.pixels[le+1],this.pixels[ne+2]=t.pixels[le+2],this.pixels[ne+3]=t.pixels[le+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Cr(Jp,"DEMData"),Cr(Gg,"DemMinMaxQuadTree",{omit:["dem"]});class em{constructor(t,l){this.max=t,this.onRemove=l,this.reset()}reset(){for(const t in this.data)for(const l of this.data[t])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(t,l,f){const _=t.wrapped().key;void 0===this.data[_]&&(this.data[_]=[]);const E={value:l,timeout:void 0};if(void 0!==f&&(E.timeout=setTimeout(()=>{this.remove(t,E)},f)),this.data[_].push(E),this.order.push(_),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const l=this.data[t].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),l.value}getByKey(t){const l=this.data[t];return l?l[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,l){if(!this.has(t))return this;const f=t.wrapped().key,_=void 0===l?0:this.data[f].indexOf(l),E=this.data[f][_];return this.data[f].splice(_,1),E.timeout&&clearTimeout(E.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(E.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(t){const l=[];for(const f in this.data)for(const _ of this.data[f])t(_.value)||l.push(_);for(const f of l)this.remove(f.value.tileID,f)}}class Sf{constructor(t,l,f){this.func=t,this.mask=l,this.range=f}}Sf.ReadOnly=!1,Sf.ReadWrite=!0,Sf.disabled=new Sf(519,Sf.ReadOnly,[0,1]);class md{constructor(t,l,f,_,E,b){this.test=t,this.ref=l,this.mask=f,this.fail=_,this.depthFail=E,this.pass=b}}md.disabled=new md({func:519,mask:0},0,0,7680,7680,7680);class Yu{constructor(t,l,f){this.blendFunction=t,this.blendColor=l,this.mask=f}}Yu.Replace=[1,0],Yu.disabled=new Yu(Yu.Replace,ds.transparent,[!1,!1,!1,!1]),Yu.unblended=new Yu(Yu.Replace,ds.transparent,[!0,!0,!0,!0]),Yu.alphaBlended=new Yu([1,771],ds.transparent,[!0,!0,!0,!0]);class Ju{constructor(t,l,f){this.enable=t,this.mode=l,this.frontFace=f}}Ju.disabled=new Ju(!1,1029,2305),Ju.backCCW=new Ju(!0,1029,2305),Ju.backCW=new Ju(!0,1029,2304),Ju.frontCW=new Ju(!0,1028,2304),Ju.frontCCW=new Ju(!0,1028,2305);class vu extends wn{constructor(t,l,f){super(),this.id=t,this._onlySymbols=f,l.on("data",_=>{"source"===_.dataType&&"metadata"===_.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===_.dataType&&"content"===_.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new em(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fy,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const l=this._tiles[t];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,l){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,l)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(t),f.prepare(this.map.style.imageManager)}}getIds(){return Pt(this._tiles).map(t=>t.tileID).sort(Kg).map(t=>t.key)}getRenderableIds(t){const l=[];for(const f in this._tiles)this._isIdRenderable(+f,t)&&l.push(this._tiles[f]);return t?l.sort((f,_)=>{const E=f.tileID,b=_.tileID,A=new Le(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),k=new Le(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-b.overscaledZ||k.y-A.y||k.x-A.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(Kg).map(f=>f.key)}hasRenderableParent(t){const l=this.findLoadedParent(t,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(t,l){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(l||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,l){const f=this._tiles[t];f&&("loading"!==f.state&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,t,l)))}_tileLoaded(t,l,f,_){if(_)if(t.state="errored",404!==_.status)this._source.fire(new Nt(_,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=ws.now(),"expired"===f&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(l,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Dt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const l=this.getRenderableIds();for(let _=0;_<l.length;_++){const E=l[_];if(t.neighboringTiles&&t.neighboringTiles[E]){const b=this.getTileByID(E);f(t,b),f(b,t)}}function f(_,E){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let b=E.tileID.canonical.x-_.tileID.canonical.x;const A=E.tileID.canonical.y-_.tileID.canonical.y,k=Math.pow(2,_.tileID.canonical.z),F=E.tileID.key;0===b&&0===A||Math.abs(A)>1||(Math.abs(b)>1&&(1===Math.abs(b+k)?b+=k:1===Math.abs(b-k)&&(b-=k)),E.dem&&_.dem&&(_.dem.backfillBorder(E.dem,b,A),_.neighboringTiles&&_.neighboringTiles[F]&&(_.neighboringTiles[F].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,l,f,_){for(const E in this._tiles){let b=this._tiles[E];if(_[E]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>f)continue;let A=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const F=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[F.key],b&&b.hasData()&&(A=F)}let k=A;for(;k.overscaledZ>l;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){_[A.key]=A;break}}}findLoadedParent(t,l){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=t.overscaledZ-1;f>=l;f--){const _=t.scaledTo(f),E=this._getLoadedTile(_);if(E)return E}}_getLoadedTile(t){const l=this._tiles[t.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,l){l=l||this._source.tileSize;const f=Math.ceil(t.width/l)+1,_=Math.ceil(t.height/l)+1,E=Math.floor(f*_*5),b="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,E):E,A="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)}handleWrapJump(t){const l=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,l){const f={};for(const _ in this._tiles){const E=this._tiles[_];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+l),f[E.tileID.key]=E}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,l,f){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let _;this.updateCacheSize(t,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new Yl(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(_=t.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(_=_.filter(A=>this._source.hasTile(A)))):_=[];const E=this._updateRetainedTiles(_);if(Uy(this._source.type)&&0!==_.length){const A={},k={},F=Object.keys(E);for(const J of F){const ne=E[J],le=this._tiles[J];if(!le||le.fadeEndTime&&le.fadeEndTime<=ws.now())continue;const de=this.findLoadedParent(ne,Math.max(ne.overscaledZ-vu.maxOverzooming,this._source.minzoom));de&&(this._addTile(de.tileID),A[de.tileID.key]=de.tileID),k[J]=ne}const G=_[_.length-1].overscaledZ;for(const J in this._tiles){const ne=this._tiles[J];if(E[J]||!ne.hasData())continue;let le=ne.tileID;for(;le.overscaledZ>G;){le=le.scaledTo(le.overscaledZ-1);const de=this._tiles[le.key];if(de&&de.hasData()&&k[le.key]){E[J]=ne.tileID;break}}}for(const J in A)E[J]||(this._coveredTiles[J]=!0,E[J]=A[J])}for(const A in E)this._tiles[A].clearFadeHold();const b=function(A,k){const F=[];for(const G in A)G in k||F.push(G);return F}(this._tiles,E);for(const A of b){const k=this._tiles[A];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const l={};if(0===t.length)return l;const f={},_=t.reduce((F,G)=>Math.min(F,G.overscaledZ),1/0),E=t[0].overscaledZ,b=Math.max(E-vu.maxOverzooming,this._source.minzoom),A=Math.max(E+vu.maxUnderzooming,this._source.minzoom),k={};for(const F of t){const G=this._addTile(F);l[F.key]=F,G.hasData()||_<this._source.maxzoom&&(k[F.key]=F)}this._retainLoadedChildren(k,_,A,l);for(const F of t){let G=this._tiles[F.key];if(G.hasData())continue;if(F.canonical.z>=this._source.maxzoom){const ne=F.children(this._source.maxzoom)[0],le=this.getTile(ne);if(le&&le.hasData()){l[ne.key]=ne;continue}}else{const ne=F.children(this._source.maxzoom);if(l[ne[0].key]&&l[ne[1].key]&&l[ne[2].key]&&l[ne[3].key])continue}let J=G.wasRequested();for(let ne=F.overscaledZ-1;ne>=b;--ne){const le=F.scaledTo(ne);if(f[le.key]||(f[le.key]=!0,G=this.getTile(le),!G&&J&&(G=this._addTile(le)),G&&(l[le.key]=le,J=G.wasRequested(),G.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const l=[];let f,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}l.push(_.key);const E=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(E),f)break;_=E}for(const E of l)this._loadedParentTiles[E]=f}}_addTile(t){let l=this._tiles[t.key];if(l)return l;l=this._cache.getAndRemove(t),l&&(this._setTileReloadTimer(t.key,l),l.tileID=t,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,l)));const f=!!l;if(!f){const _=this.map?this.map.painter:null;l=new Um(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,_,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,t.key,l.state))}return l?(l.uses++,this._tiles[t.key]=l,f||this._source.fire(new Dt("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(t,l){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=l.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){const l=this._tiles[t];l&&(l.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,l,f){const _=[],E=this.transform;if(!E)return _;const b="globe"===E.projection.name,A=au(E.center.lng);for(const k in this._tiles){const F=this._tiles[k];if(f&&F.clearQueryDebugViz(),F.holdingForFade())continue;let G;if(b){const J=F.tileID.canonical;if(0===J.z){const ne=[Math.abs(qt(A,...Rh(J,-1))-A),Math.abs(qt(A,...Rh(J,1))-A)];G=[0,2*ne.indexOf(Math.min(...ne))-1]}else{const ne=[Math.abs(qt(A,...Rh(J,-1))-A),Math.abs(qt(A,...Rh(J,0))-A),Math.abs(qt(A,...Rh(J,1))-A)];G=[ne.indexOf(Math.min(...ne))-1]}}else G=[0];for(const J of G){const ne=t.containsTile(F,E,l,J);ne&&_.push(ne)}}return _}getVisibleCoordinates(t){const l=this.getRenderableIds(t).map(f=>this._tiles[f].tileID);for(const f of l)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(Uy(this._source.type))for(const t in this._tiles){const l=this._tiles[t];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=ws.now())return!0}return!1}setFeatureState(t,l,f){this._state.updateState(t=t||"_geojsonTileLayer",l,f)}removeFeatureState(t,l,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",l,f)}getFeatureState(t,l){return this._state.getState(t=t||"_geojsonTileLayer",l)}setDependencies(t,l,f){const _=this._tiles[t];_&&_.setDependencies(l,f)}reloadTilesForDependencies(t,l){for(const f in this._tiles)this._tiles[f].hasDependency(t,l)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(t,l))}_preloadTiles(t,l){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,l))};return void this._source.on("data",A)}const f=new Map,_=Array.isArray(t)?t:[t],E=this.map.painter.terrain,b=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const A of _){const k=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of k)f.set(F.key,F);this.usedForTerrain&&A.updateElevation(!1)}Ct(Array.from(f.values()),(A,k)=>{const F=new Um(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(F,G=>{"raster-dem"===this._source.type&&F.dem&&this._backfillDEM(F),k(G,F)})},l)}}function Kg(o,t){const l=Math.abs(2*o.wrap)-+(o.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return o.overscaledZ-t.overscaledZ||f-l||t.canonical.y-o.canonical.y||t.canonical.x-o.canonical.x}function Uy(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function Rh(o,t){const l=1<<o.z;return[o.x/l+t,(o.x+1)/l+t]}vu.maxOverzooming=10,vu.maxUnderzooming=3;class Zg{constructor(t,l,f){this._demTile=t,this._dem=this._demTile.dem,this._scale=l,this._offset=f}static create(t,l,f){const _=f||t.findDEMTileFor(l);if(!_||!_.dem)return;const E=_.dem,b=_.tileID,A=1<<l.canonical.z-b.canonical.z;return new Zg(_,_.tileSize/ii/A,[(l.canonical.x/A-b.canonical.x)*E.dim,(l.canonical.y/A-b.canonical.y)*E.dim])}tileCoordToPixel(t,l){const f=l*this._scale+this._offset[1],_=Math.floor(t*this._scale+this._offset[0]),E=Math.floor(f);return new Le(_,E)}getElevationAt(t,l,f,_){const E=t*this._scale+this._offset[0],b=l*this._scale+this._offset[1],A=Math.floor(E),k=Math.floor(b),F=this._dem;return _=!!_,f?ns(ns(F.get(A,k,_),F.get(A,k+1,_),b-k),ns(F.get(A+1,k,_),F.get(A+1,k+1,_),b-k),E-A):F.get(A,k,_)}getElevationAtPixel(t,l,f){return this._dem.get(t,l,!!f)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*fc(1,t)*this._dem.stride}}class Cf{constructor(t,l){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Un(ii,16,0),this.featureIndexArray=new mi,this.promoteId=l}insert(t,l,f,_,E,b=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,E,b);const k=this.grid;for(let F=0;F<l.length;F++){const G=l[F],J=[1/0,1/0,-1/0,-1/0];for(let ne=0;ne<G.length;ne++){const le=G[ne];J[0]=Math.min(J[0],le.x),J[1]=Math.min(J[1],le.y),J[2]=Math.max(J[2],le.x),J[3]=Math.max(J[3],le.y)}J[0]<ii&&J[1]<ii&&J[2]>=0&&J[3]>=0&&k.insert(A,J[0],J[1],J[2],J[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Pp(new Eh(this.rawTileData)).layers,this.sourceLayerCoder=new Bg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,l,f,_){this.loadVTLayers();const E=t.params||{},b=lr(E.filter),A=t.tileResult,k=t.transform,F=A.bufferedTilespaceBounds,G=this.grid.query(F.min.x,F.min.y,F.max.x,F.max.y,(de,Se,tt,_t)=>ph(A.bufferedTilespaceGeometry,de,Se,tt,_t));G.sort(Df);let J=null;k.elevation&&G.length>0&&(J=Zg.create(k.elevation,this.tileID));const ne={};let le;for(let de=0;de<G.length;de++){const Se=G[de];if(Se===le)continue;le=Se;const tt=this.featureIndexArray.get(Se);let _t=null;this.loadMatchingFeature(ne,tt,b,E.layers,E.availableImages,l,f,_,(At,yt,St,Ft=0)=>(_t||(_t=We(At,this.tileID.canonical,t.tileTransform)),yt.queryIntersectsFeature(A,At,St,_t,this.z,t.transform,t.pixelPosMatrix,J,Ft)))}return ne}loadMatchingFeature(t,l,f,_,E,b,A,k,F){const{featureIndex:G,bucketIndex:J,sourceLayerIndex:ne,layoutVertexArrayOffset:le}=l,de=this.bucketLayerIDs[J];if(_&&!function(At,yt){for(let St=0;St<At.length;St++)if(yt.indexOf(At[St])>=0)return!0;return!1}(_,de))return;const Se=this.sourceLayerCoder.decode(ne),tt=this.vtLayers[Se].feature(G);if(f.needGeometry){const At=zt(tt,!0);if(!f.filter(new V(this.tileID.overscaledZ),At,this.tileID.canonical))return}else if(!f.filter(new V(this.tileID.overscaledZ),tt))return;const _t=this.getId(tt,Se);for(let At=0;At<de.length;At++){const yt=de[At];if(_&&_.indexOf(yt)<0)continue;const St=b[yt];if(!St)continue;let Ft={};void 0!==_t&&k&&(Ft=k.getState(St.sourceLayer||"_geojsonTileLayer",_t));const kt=Qe({},A[yt]);kt.paint=W_(kt.paint,St.paint,tt,Ft,E),kt.layout=W_(kt.layout,St.layout,tt,Ft,E);const yn=!F||F(tt,St,Ft,le);if(!yn)continue;const pn=new Xc(tt,this.z,this.x,this.y,_t);pn.layer=kt;let Fn=t[yt];void 0===Fn&&(Fn=t[yt]=[]),Fn.push({featureIndex:G,feature:pn,intersectionZ:yn})}}lookupSymbolFeatures(t,l,f,_,E,b,A,k){const F={};this.loadVTLayers();const G=lr(E);for(const J of t)this.loadMatchingFeature(F,{bucketIndex:f,sourceLayerIndex:_,featureIndex:J,layoutVertexArrayOffset:0},G,b,A,k,l);return F}loadFeature(t){const{featureIndex:l,sourceLayerIndex:f}=t;this.loadVTLayers();const _=this.sourceLayerCoder.decode(f),E=this.vtFeatures[_];if(E[l])return E[l];const b=this.vtLayers[_].feature(l);return E[l]=b,b}hasLayer(t){for(const l of this.bucketLayerIDs)for(const f of l)if(t===f)return!0;return!1}getId(t,l){let f=t.id;if(this.promoteId){const _="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=_&&(f=t.properties[_]),"boolean"==typeof f&&(f=Number(f))}return f}}function W_(o,t,l,f,_){return Ot(o,(E,b)=>{const A=t instanceof ot?t.get(b):null;return A&&A.evaluate?A.evaluate(l,f,_):A})}function Df(o,t){return t-o}Cr(Cf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class op{constructor(t,l){this.width=t,this.height=l,this.nextRow=0,this.image=new Id({width:t,height:l}),this.positions={},this.uploaded=!1}getDash(t,l){const f=this.getKey(t,l);return this.positions[f]}trim(){const t=this.width,l=this.height=sn(this.nextRow);this.image.resize({width:t,height:l})}getKey(t,l){return t.join(",")+l}getDashRanges(t,l,f){const _=[];let E=t.length%2==1?-t[t.length-1]*f:0,b=t[0]*f,A=!0;_.push({left:E,right:b,isDash:A,zeroLength:0===t[0]});let k=t[0];for(let F=1;F<t.length;F++){A=!A;const G=t[F];E=k*f,k+=G,b=k*f,_.push({left:E,right:b,isDash:A,zeroLength:0===G})}return _}addRoundDash(t,l,f){const _=l/2;for(let E=-f;E<=f;E++){const b=this.width*(this.nextRow+f+E);let A=0,k=t[A];for(let F=0;F<this.width;F++){F/k.right>1&&(k=t[++A]);const G=Math.abs(F-k.left),J=Math.abs(F-k.right),ne=Math.min(G,J);let le;const de=E/f*(_+1);if(k.isDash){const Se=_-Math.abs(de);le=Math.sqrt(ne*ne+Se*Se)}else le=_-Math.sqrt(ne*ne+de*de);this.image.data[b+F]=Math.max(0,Math.min(255,le+128))}}}addRegularDash(t,l){for(let k=t.length-1;k>=0;--k){const F=t[k],G=t[k+1];F.zeroLength?t.splice(k,1):G&&G.isDash===F.isDash&&(G.left=F.left,t.splice(k,1))}const f=t[0],_=t[t.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const E=this.width*this.nextRow;let b=0,A=t[b];for(let k=0;k<this.width;k++){k/A.right>1&&(A=t[++b]);const F=Math.abs(k-A.left),G=Math.abs(k-A.right),J=Math.min(F,G);this.image.data[E+k]=Math.max(0,Math.min(255,(A.isDash?J:-J)+l+128))}}addDash(t,l){const f=this.getKey(t,l);if(this.positions[f])return this.positions[f];const _="round"===l,E=_?7:0,b=2*E+1;if(this.nextRow+b>this.height)return ur("LineAtlas out of space"),null;0===t.length&&t.push(1);let A=0;for(let G=0;G<t.length;G++)t[G]<0&&(ur("Negative value is found in line dasharray, replacing values with 0"),t[G]=0),A+=t[G];if(0!==A){const G=this.width/A,J=this.getDashRanges(t,this.width,G);_?this.addRoundDash(J,G,E):this.addRegularDash(J,"square"===l?.5*G:0)}const k=this.nextRow+E;this.nextRow+=b;const F={tl:[k,E],br:[A,0]};return this.positions[f]=F,F}}Cr(op,"LineAtlas");const tm=1*Qu;class ap{constructor(t){const l={},f=[];for(const A in t){const k=t[A],F=l[A]={};for(const G in k.glyphs){const J=k.glyphs[+G];if(!J||0===J.bitmap.width||0===J.bitmap.height)continue;const ne=J.metrics.localGlyph?tm:1,le={x:0,y:0,w:J.bitmap.width+2*ne,h:J.bitmap.height+2*ne};f.push(le),F[G]=le}}const{w:_,h:E}=Up(f),b=new Id({width:_||1,height:E||1});for(const A in t){const k=t[A];for(const F in k.glyphs){const G=k.glyphs[+F];if(!G||0===G.bitmap.width||0===G.bitmap.height)continue;const J=l[A][F],ne=G.metrics.localGlyph?tm:1;Id.copy(G.bitmap,b,{x:0,y:0},{x:J.x+ne,y:J.y+ne},G.bitmap)}}this.image=b,this.positions=l}}Cr(ap,"GlyphAtlas");class zy{constructor(t){this.tileID=new Yl(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=bh(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,l,f,_,E){this.status="parsing",this.data=t,this.collisionBoxArray=new Jn;const b=new Bg(Object.keys(t.layers).sort()),A=new Cf(this.tileID,this.promoteId);A.bucketLayerIDs=[];const k={},F=new op(256,256),G={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:F,availableImages:f},J=l.familiesBySource[this.source];for(const Ft in J){const kt=t.layers[Ft];if(!kt)continue;let yn=!1,pn=!1;for(const En of J[Ft])"symbol"===En[0].type?yn=!0:pn=!0;if(!0===this.isSymbolTile&&!yn||!1===this.isSymbolTile&&!pn)continue;1===kt.version&&ur(`Vector tile source "${this.source}" layer "${Ft}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fn=b.encode(Ft),or=[];for(let En=0;En<kt.length;En++){const $n=kt.feature(En),jn=A.getId($n,Ft);or.push({feature:$n,id:jn,index:En,sourceLayerIndex:Fn})}for(const En of J[Ft]){const $n=En[0];void 0!==this.isSymbolTile&&"symbol"===$n.type!==this.isSymbolTile||$n.minzoom&&this.zoom<Math.floor($n.minzoom)||$n.maxzoom&&this.zoom>=$n.maxzoom||"none"!==$n.visibility&&(Xg(En,this.zoom,f),(k[$n.id]=$n.createBucket({index:A.bucketLayerIDs.length,layers:En,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(or,G,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(En.map(jn=>jn.id)))}}let ne,le,de,Se;F.trim();const tt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_t=()=>{if(ne)return E(ne);if(le&&de&&Se){const Ft=new ap(le),kt=new yg(de,Se);for(const yn in k){const pn=k[yn];pn instanceof hd?(Xg(pn.layers,this.zoom,f),Ry(pn,le,Ft.positions,de,kt.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):pn.hasPattern&&(pn instanceof cd||pn instanceof Mp||pn instanceof $f)&&(Xg(pn.layers,this.zoom,f),pn.addFeatures(G,this.tileID.canonical,kt.patternPositions,f,this.tileTransform))}this.status="done",E(null,{buckets:Pt(k).filter(yn=>!yn.isEmpty()),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ft.image,lineAtlas:F,imageAtlas:kt,glyphMap:this.returnDependencies?le:null,iconMap:this.returnDependencies?de:null,glyphPositions:this.returnDependencies?Ft.positions:null})}},At=Ot(G.glyphDependencies,Ft=>Object.keys(Ft).map(Number));Object.keys(At).length?_.send("getGlyphs",{uid:this.uid,stacks:At},(Ft,kt)=>{ne||(ne=Ft,le=kt,_t())},void 0,!1,tt):le={};const yt=Object.keys(G.iconDependencies);yt.length?_.send("getImages",{icons:yt,source:this.source,tileID:this.tileID,type:"icons"},(Ft,kt)=>{ne||(ne=Ft,de=kt,_t())},void 0,!1,tt):de={};const St=Object.keys(G.patternDependencies);St.length?_.send("getImages",{icons:St,source:this.source,tileID:this.tileID,type:"patterns"},(Ft,kt)=>{ne||(ne=Ft,Se=kt,_t())},void 0,!1,tt):Se={},_t()}}function Xg(o,t,l){const f=new V(t);for(const _ of o)_.recalculate(f,l)}class Qg{constructor(t){this.entries={},this.scheduler=t}request(t,l,f,_){const E=this.entries[t]=this.entries[t]||{callbacks:[]};if(E.result){const[b,A]=E.result;return this.scheduler?this.scheduler.add(()=>{_(b,A)},l):_(b,A),()=>{}}return E.callbacks.push(_),E.cancel||(E.cancel=f((b,A)=>{E.result=[b,A];for(const k of E.callbacks)this.scheduler?this.scheduler.add(()=>{k(b,A)},l):k(b,A);setTimeout(()=>delete this.entries[t],3e3)})),()=>{E.result||(E.callbacks=E.callbacks.filter(b=>b!==_),E.callbacks.length||(E.cancel(),delete this.entries[t]))}}}function jy(o,t,l){const f=JSON.stringify(o.request);return o.data&&(this.deduped.entries[f]={result:[null,o.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},_=>{const E=Fs(o.request,(b,A,k,F)=>{b?_(b):A&&_(null,{vectorTile:l?void 0:new Pp(new Eh(A)),rawData:A,cacheControl:k,expires:F})});return()=>{E.cancel(),_()}},t)}const Yg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class nm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(t,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(1!==_)throw new Error(`Got v${_} data when expected v1.`);const E=Yg[15&f];if(!E)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(t,2,1),[A]=new Uint32Array(t,4,1);return new nm(A,b,E,t)}constructor(t,l=64,f=Float64Array,_){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const E=Yg.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,A=t*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-A%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+A+k,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+A+k),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+A+k,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=t)}add(t,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=t,this.coords[this._pos++]=l,f}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return rm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,l,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:b,nodeSize:A}=this,k=[0,E.length-1,0],F=[];for(;k.length;){const G=k.pop()||0,J=k.pop()||0,ne=k.pop()||0;if(J-ne<=A){for(let tt=ne;tt<=J;tt++){const _t=b[2*tt],At=b[2*tt+1];_t>=t&&_t<=f&&At>=l&&At<=_&&F.push(E[tt])}continue}const le=ne+J>>1,de=b[2*le],Se=b[2*le+1];de>=t&&de<=f&&Se>=l&&Se<=_&&F.push(E[le]),(0===G?t<=de:l<=Se)&&(k.push(ne),k.push(le-1),k.push(1-G)),(0===G?f>=de:_>=Se)&&(k.push(le+1),k.push(J),k.push(1-G))}return F}within(t,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:E,nodeSize:b}=this,A=[0,_.length-1,0],k=[],F=f*f;for(;A.length;){const G=A.pop()||0,J=A.pop()||0,ne=A.pop()||0;if(J-ne<=b){for(let tt=ne;tt<=J;tt++)Jg(E[2*tt],E[2*tt+1],t,l)<=F&&k.push(_[tt]);continue}const le=ne+J>>1,de=E[2*le],Se=E[2*le+1];Jg(de,Se,t,l)<=F&&k.push(_[le]),(0===G?t-f<=de:l-f<=Se)&&(A.push(ne),A.push(le-1),A.push(1-G)),(0===G?t+f>=de:l+f>=Se)&&(A.push(le+1),A.push(J),A.push(1-G))}return k}}function rm(o,t,l,f,_,E){if(_-f<=l)return;const b=f+_>>1;zm(o,t,b,f,_,E),rm(o,t,l,f,b-1,1-E),rm(o,t,l,b+1,_,1-E)}function zm(o,t,l,f,_,E){for(;_>f;){if(_-f>600){const F=_-f+1,G=l-f+1,J=Math.log(F),ne=.5*Math.exp(2*J/3),le=.5*Math.sqrt(J*ne*(F-ne)/F)*(G-F/2<0?-1:1);zm(o,t,l,Math.max(f,Math.floor(l-G*ne/F+le)),Math.min(_,Math.floor(l+(F-G)*ne/F+le)),E)}const b=t[2*l+E];let A=f,k=_;for(Qd(o,t,f,l),t[2*_+E]>b&&Qd(o,t,f,_);A<k;){for(Qd(o,t,A,k),A++,k--;t[2*A+E]<b;)A++;for(;t[2*k+E]>b;)k--}t[2*f+E]===b?Qd(o,t,f,k):(k++,Qd(o,t,k,_)),k<=l&&(f=k+1),l<=k&&(_=k-1)}}function Qd(o,t,l,f){$y(o,l,f),$y(t,2*l,2*f),$y(t,2*l+1,2*f+1)}function $y(o,t,l){const f=o[t];o[t]=o[l],o[l]=f}function Jg(o,t,l,f){const _=o-l,E=t-f;return _*_+E*E}m.ARRAY_TYPE=Sc,m.AUTH_ERR_MSG=ge,m.Aabb=gl,m.Actor=class{constructor(o,t,l){this.target=o,this.parent=t,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Vn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=nr()?o:ae,this.scheduler=new ky}send(o,t,l,f,_=!1,E){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=E,this.callbacks[b]=l);const A=Zn(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:o,hasCallback:!!l,targetMapId:f,mustQueue:_,sourceMapId:this.mapId,data:bc(t,A)},A),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(o){const t=o.data,l=t.id;if(l&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const f=this.cancelCallbacks[l];delete this.cancelCallbacks[l],f&&f.cancel()}else if(t.mustQueue||nr()){const f=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,t),f&&f.metadata||{type:"message"})}else this.processTask(l,t)}processTask(o,t){if("<response>"===t.type){const l=this.callbacks[o];delete this.callbacks[o],l&&(t.error?l(uc(t.error)):l(null,uc(t.data)))}else{const l=Zn(this.globalScope)?void 0:[],f=t.hasCallback?(E,b)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:E?bc(E):null,data:bc(b,l)},l)}:E=>{},_=uc(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,_,f);else if(this.parent.getWorkerSource){const E=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,E[0],_.source)[E[1]](_,f)}else f(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},m.CanonicalTileID=Zu,m.Color=ds,m.ColorMode=Yu,m.CullFaceMode=Ju,m.DEMData=Jp,m.DataConstantProperty=pe,m.DedupedRequest=Qg,m.DepthMode=Sf,m.EXTENT=ii,m.Elevation=class{isDataAvailableAtPoint(o){const t=this._source();if(this.isUsingMockSource()||!t||o.y<0||o.y>1)return!1;const l=t.getSource().maxzoom,f=1<<l,_=Math.floor(o.x),E=Math.floor((o.x-_)*f),b=Math.floor(o.y*f),A=this.findDEMTileFor(new Yl(l,_,l,E,b));return!(!A||!A.dem)}getAtPointOrZero(o,t=0){return this.getAtPoint(o,t)||0}getAtPoint(o,t,l=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);const f=this._source();if(!f||o.y<0||o.y>1)return t;const _=f.getSource().maxzoom,E=1<<_,b=Math.floor(o.x),A=o.x-b,k=new Yl(_,b,_,Math.floor(A*E),Math.floor(o.y*E)),F=this.findDEMTileFor(k);if(!F||!F.dem)return t;const G=F.dem,J=1<<F.tileID.canonical.z,ne=(A*J-F.tileID.canonical.x)*G.dim,le=(o.y*J-F.tileID.canonical.y)*G.dim,de=Math.floor(ne),Se=Math.floor(le);return(l?this.exaggeration():1)*ns(ns(G.get(de,Se),G.get(de,Se+1),le-Se),ns(G.get(de+1,Se),G.get(de+1,Se+1),le-Se),ne-de)}getAtTileOffset(o,t,l){const f=1<<o.canonical.z;return this.getAtPointOrZero(new qc(o.wrap+(o.canonical.x+t/ii)/f,(o.canonical.y+l/ii)/f))}getAtTileOffsetFunc(o,t,l,f){return _=>{const E=this.getAtTileOffset(o,_.x,_.y),b=f.upVector(o.canonical,_.x,_.y);return dc(b,b,E*f.upVectorScale(o.canonical,t,l).metersToTile),b}}getForTilePoints(o,t,l,f){if(this.isUsingMockSource())return!1;const _=Zg.create(this,o,f);return!!_&&(t.forEach(E=>{E[2]=this.exaggeration()*_.getElevationAt(E[0],E[1],l)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(o);if(!t||!t.dem)return null;const l=t.dem.tree,f=t.tileID,_=1<<o.canonical.z-f.canonical.z;let E=o.canonical.x/_-f.canonical.x,b=o.canonical.y/_-f.canonical.y,A=0;for(let k=0;k<o.canonical.z-f.canonical.z&&!l.leaves[A];k++){E*=2,b*=2;const F=2*Math.floor(b)+Math.floor(E);A=l.childOffsets[A]+F,E%=1,b%=1}return{min:this.exaggeration()*l.minimums[A],max:this.exaggeration()*l.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,t,l){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},m.ErrorEvent=Nt,m.EvaluationParameters=V,m.Event=Dt,m.Evented=wn,m.FillExtrusionBucket=$f,m.Frustum=bd,m.FrustumCorners=Wa,m.GLOBE_RADIUS=kc,m.GLOBE_SCALE_MATCH_LATITUDE=45,m.GLOBE_ZOOM_THRESHOLD_MAX=lh,m.GLOBE_ZOOM_THRESHOLD_MIN=Wh,m.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,t){const l=new rr,f=new ee,_=[],E=o+1+2,b=t[0]+1,A=t[0]+1+(1+t.length),k=(F,G,J)=>{let ne=F===E-1?F-2:0===F?F:F-1;return ne+=J?24575:0,[ne,G]};for(let F=0;F<E;++F)l.emplaceBack(...k(F,0,!0));for(let F=0;F<b;++F)for(let G=0;G<E;++G)l.emplaceBack(...k(G,F,(0===G||G===E-1)&&!0));for(let F=0;F<t.length;++F){const G=t[F];for(let J=0;J<E;++J)l.emplaceBack(...k(J,G,!0))}for(let F=0;F<t.length;++F){const G=f.length,J=t[F]+1+2,ne=new ee;for(let Se=0;Se<J-1;Se++){const tt=Se===J-2,_t=tt?E*(A-t.length+F-Se):E;for(let At=0;At<E-1;At++){const yt=Se*E+At;0===Se||tt||0===At||At===E-2?(ne.emplaceBack(yt+1,yt,yt+_t),ne.emplaceBack(yt+_t,yt+_t+1,yt+1)):(f.emplaceBack(yt+1,yt,yt+_t),f.emplaceBack(yt+_t,yt+_t+1,yt+1))}}const le=go.simpleSegment(0,G,l.length,f.length-G);for(let Se=0;Se<ne.uint16.length;Se+=3)f.emplaceBack(ne.uint16[Se],ne.uint16[Se+1],ne.uint16[Se+2]);const de=go.simpleSegment(0,G,l.length,f.length-G);_.push({withoutSkirts:le,withSkirts:de})}return{vertices:l,indices:f,segments:_}}_createGrid(o){const t=this._fillGridMeshWithLods(64,qh);this._gridSegments=t.segments,this._gridBuffer=o.createVertexBuffer(t.vertices,ma.members),this._gridIndexBuffer=o.createIndexBuffer(t.indices,!0)}_createPoles(o){const t=new ee;for(let _=0;_<=64;_++)t.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=o.createIndexBuffer(t,!0);const l=new en,f=new en;this._poleSegments=[];for(let _=0,E=0;_<Wh;_++){const b=360/(1<<_);l.emplaceBack(0,-kc,0,.5,0),f.emplaceBack(0,-kc,0,.5,1);for(let A=0;A<=64;A++){const k=A/64,F=ns(0,b,k),[G,J,ne]=Ql(Lf,f_,F,kc);l.emplaceBack(G,J,ne,k,0),f.emplaceBack(G,J,ne,k,1)}this._poleSegments.push(go.simpleSegment(E,0,66,64)),E+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(l,Of,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(f,Of,!1)}getGridBuffers(o,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,t){if(!this._wireframeSegments){const l=new gn,f=64,_=f+1+2,E=1;this._wireframeSegments=[];for(let b=0,A=0;b<qh.length;b++){const k=qh[b];for(let G=E;G<k+E;G++)for(let J=E;J<f+E;J++){const ne=G*_+J;l.emplaceBack(ne,ne+1),l.emplaceBack(ne,ne+_),l.emplaceBack(ne,ne+_+1)}const F=k*f*3;this._wireframeSegments.push(go.simpleSegment(0,A,(k+1)*_,F)),A+=F}this._wireframeIndexBuffer=o.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},m.GlyphManager=xf,m.ImagePosition=_g,m.KDBush=nm,m.LivePerformanceUtils=wa,m.LngLat=Ws,m.LngLatBounds=Ll,m.LocalGlyphMode=vf,m.MAX_MERCATOR_LATITUDE=xa,m.MercatorCoordinate=qc,m.ONE_EM=Jl,m.OverscaledTileID=Yl,m.PerformanceMarkers=ra,m.Point=Le,m.Properties=mt,m.RGBAImage=Kc,m.Ray=wd,m.RequestManager=class{constructor(o,t,l){this._transformRequestFn=o,this._customAccessToken=t,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const o=function(){let t="";for(let l=0;l<10;l++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",je,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,t){return this._transformRequestFn&&this._transformRequestFn(o,t)||{url:o}}normalizeStyleURL(o,t){if(!Me(o))return o;const l=Ae(o);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||t)}normalizeGlyphsURL(o,t){if(!Me(o))return o;const l=Ae(o);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||t)}normalizeSourceURL(o,t,l,f){if(!Me(o))return o;const _=Ae(o);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),l&&_.params.push(`language=${l}`),f&&_.params.push(`worldview=${f}`),this._makeAPIURL(_,this._customAccessToken||t)}normalizeSpriteURL(o,t,l,f){const _=Ae(o);return Me(o)?(_.path=`/styles/v1${_.path}/sprite${t}${l}`,this._makeAPIURL(_,this._customAccessToken||f)):(_.path+=`${t}${l}`,Ne(_))}normalizeTileURL(o,t,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Me(o))return o;const f=Ae(o);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||l&&"raster"!==f.authority&&512===l?"@2x":""}${xe.supported?".webp":"$1"}`),"raster"===f.authority?f.path=`/${Ve.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${Ve.TILE_URL_VERSION}${f.path}`);const _=this._customAccessToken||function(E){for(const b of E){const A=b.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(f.params)||Ve.ACCESS_TOKEN;return Ve.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,_)}canonicalizeTileURL(o,t){const l=Ae(o);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return o;let f="mapbox://";l.path.match(/^\/raster\/v1\//)?f+=`raster/${l.path.replace(`/${Ve.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${l.path.replace(`/${Ve.TILE_URL_VERSION}/`,"")}`;let _=l.params;return t&&(_=_.filter(E=>!E.match(/^access_token=/))),_.length&&(f+=`?${_.join("&")}`),f}canonicalizeTileset(o,t){const l=!!t&&Me(t),f=[];for(const _ of o.tiles||[])$e(_)?f.push(this.canonicalizeTileURL(_,l)):f.push(_);return f}_makeAPIURL(o,t){const l="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Ae(Ve.API_URL);if(o.protocol=f.protocol,o.authority=f.authority,"http"===o.protocol){const _=o.params.indexOf("secure");_>=0&&o.params.splice(_,1)}if("/"!==f.path&&(o.path=`${f.path}${o.path}`),!Ve.REQUIRE_ACCESS_TOKEN)return Ne(o);if(t=t||Ve.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return o.params=o.params.filter(_=>-1===_.indexOf("access_token")),o.params.push(`access_token=${t||""}`),Ne(o)}},m.ResourceType=vi,m.SegmentVector=go,m.SourceCache=vu,m.StencilMode=md,m.StructArrayLayout1ui2=Rn,m.StructArrayLayout2f1f2i16=R,m.StructArrayLayout2i4=rr,m.StructArrayLayout2ui4=gn,m.StructArrayLayout3f12=$,m.StructArrayLayout3ui6=ee,m.StructArrayLayout4i8=Dn,m.StructArrayLayout5f20=en,m.Texture=Vm,m.Tile=Um,m.Transitionable=ce,m.Uniform1f=Tc,m.Uniform1i=class extends Ha{constructor(o){super(o),this.current=0}set(o,t,l){this.fetchUniformLocation(o,t)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},m.Uniform2f=class extends Ha{constructor(o){super(o),this.current=[0,0]}set(o,t,l){this.fetchUniformLocation(o,t)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},m.Uniform3f=class extends Ha{constructor(o){super(o),this.current=[0,0,0]}set(o,t,l){this.fetchUniformLocation(o,t)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},m.Uniform4f=No,m.UniformColor=fl,m.UniformMatrix2f=class extends Ha{constructor(o){super(o),this.current=Cu}set(o,t,l){if(this.fetchUniformLocation(o,t))for(let f=0;f<4;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},m.UniformMatrix3f=class extends Ha{constructor(o){super(o),this.current=tu}set(o,t,l){if(this.fetchUniformLocation(o,t))for(let f=0;f<9;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},m.UniformMatrix4f=class extends Ha{constructor(o){super(o),this.current=mu}set(o,t,l){if(this.fetchUniformLocation(o,t)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let f=1;f<16;f++)if(l[f]!==this.current[f]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},m.UnwrappedTileID=Ou,m.ValidationError=Xn,m.VectorTileFeature=Op,m.VectorTileWorkerSource=class extends wn{constructor(o,t,l,f,_){super(),this.actor=o,this.layerIndex=t,this.availableImages=l,this.loadVectorData=_||jy,this.loading={},this.loaded={},this.deduped=new Qg(o.scheduler),this.isSpriteLoaded=f,this.scheduler=o.scheduler}loadTile(o,t){const l=o.uid,f=o&&o.request,_=f&&f.collectResourceTiming,E=this.loading[l]=new zy(o);E.abort=this.loadVectorData(o,(b,A)=>{const k=!this.loading[l];if(delete this.loading[l],k||b||!A)return E.status="done",k||(this.loaded[l]=E),t(b);const F=A.rawData,G={};A.expires&&(G.expires=A.expires),A.cacheControl&&(G.cacheControl=A.cacheControl),E.vectorTile=A.vectorTile||new Pp(new Eh(F));const J=()=>{E.parse(E.vectorTile,this.layerIndex,this.availableImages,this.actor,(ne,le)=>{if(ne||!le)return t(ne);const de={};if(_){const Se=Sn(f);Se.length>0&&(de.resourceTiming=JSON.parse(JSON.stringify(Se)))}t(null,Qe({rawTileData:F.slice(0)},le,G,de))})};this.isSpriteLoaded?J():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(J,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):J()}),this.loaded=this.loaded||{},this.loaded[l]=E})}reloadTile(o,t){const l=this.loaded,f=o.uid,_=this;if(l&&l[f]){const E=l[f];E.showCollisionBoxes=o.showCollisionBoxes,E.enableTerrain=!!o.enableTerrain,E.projection=o.projection,E.tileTransform=bh(o.tileID.canonical,o.projection);const b=(A,k)=>{const F=E.reloadCallback;F&&(delete E.reloadCallback,E.parse(E.vectorTile,_.layerIndex,this.availableImages,_.actor,F)),t(A,k)};"parsing"===E.status?E.reloadCallback=b:"done"===E.status&&(E.vectorTile?E.parse(E.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(o,t){const l=o.uid,f=this.loading[l];f&&(f.abort&&f.abort(),delete this.loading[l]),t()}removeTile(o,t){const l=this.loaded,f=o.uid;l&&l[f]&&delete l[f],t()}},m.WritingMode=Nu,m.ZoomDependentExpression=wt,m.add=iu,m.addDynamicAttributes=Zp,m.adjoint=function(o,t){var l=t[0],f=t[1],_=t[2],E=t[3],b=t[4],A=t[5],k=t[6],F=t[7],G=t[8];return o[0]=b*G-A*F,o[1]=_*F-f*G,o[2]=f*A-_*b,o[3]=A*k-E*G,o[4]=l*G-_*k,o[5]=_*E-l*A,o[6]=E*F-b*k,o[7]=f*k-l*F,o[8]=l*b-f*E,o},m.asyncAll=Ct,m.bezier=bn,m.bindAll=Vn,m.boundsAttributes=Vg,m.bufferConvexPolygon=function(o,t){const l=[];for(let f=0;f<o.length;f++){const _=lt(f-1,-1,o.length-1),E=lt(f+1,-1,o.length-1),b=o[f],A=o[E],k=o[_].sub(b).unit(),F=A.sub(b).unit(),G=F.angleWithSep(k.x,k.y),J=k.add(F).unit().mult(-1*t/Math.sin(G/2));l.push(b.add(J))}return l},m.cacheEntryPossiblyAdded=function(o){Ur++,Ur>Gt&&(o.getActor().send("enforceCacheSizeLimit",kr),Ur=0)},m.calculateGlobeLabelMatrix=function(o,t){const{x:l,y:f}=o.point,_=Pu(l,f,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Eo(_,_,uh(Wu(t)))},m.calculateGlobeMatrix=function(o){const{x:t,y:l}=o.point,{lng:f,lat:_}=o._center;return Pu(t,l,o.worldSize,f,_)},m.calculateGlobeMercatorMatrix=function(o){const t=o.pixelsPerMeter,l=t/fc(1,o.center.lat),f=$o(new Float64Array(16));return Du(f,f,[o.point.x,o.point.y,0]),Mu(f,f,[l,l,t]),Float32Array.from(f)},m.circumferenceAtLatitude=Co,m.clamp=qt,m.clearTileCache=function(o){if(!pt())return;const t=ae.caches.delete(Sr);o&&t.catch(o).then(()=>o())},m.clipLine=qv,m.clone=function(o){var t=new Sc(16);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.clone$1=Or,m.collisionCircleLayout=B0,m.config=Ve,m.conjugate=function(o,t){return o[0]=-t[0],o[1]=-t[1],o[2]=-t[2],o[3]=t[3],o},m.create=function(){var o=new Sc(16);return Sc!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},m.create$1=Vd,m.createExpression=ie,m.createLayout=Kt,m.createStyleLayer=function(o){return"custom"===o.type?new $_(o):new Xv[o.type](o)},m.cross=Ru,m.degToRad=Ze,m.distance=function(o,t){return Math.hypot(t[0]-o[0],t[1]-o[1],t[2]-o[2])},m.div=function(o,t,l){return o[0]=t[0]/l[0],o[1]=t[1]/l[1],o[2]=t[2]/l[2],o},m.dot=Gc,m.earthRadius=Ff,m.ease=Cn,m.easeCubicInOut=nn,m.ecefToLatLng=function([o,t,l]){const f=Math.hypot(o,t,l),_=Math.atan2(o,l),E=.5*Math.PI-Math.acos(-t/f);return new Ws(it(_),it(E))},m.emitValidationErrors=zr,m.endsWith=Fr,m.enforceCacheSizeLimit=function(o){Mt(),Bt&&Bt.then(t=>{t.keys().then(l=>{for(let f=0;f<l.length-o;f++)t.delete(l[f])})})},m.evaluateSizeForFeature=Fp,m.evaluateSizeForZoom=xl,m.evaluateVariableOffset=Gp,m.evented=y,m.exactEquals=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]&&o[3]===t[3]},m.exactEquals$1=function(o,t){return o[0]===t[0]&&o[1]===t[1]&&o[2]===t[2]},m.exported=ws,m.exported$1=xe,m.extend=Qe,m.extend$1=On,m.fillExtrusionHeightLift=b_,m.filterObject=on,m.fromMat4=function(o,t){return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[4],o[4]=t[5],o[5]=t[6],o[6]=t[8],o[7]=t[9],o[8]=t[10],o},m.fromQuat=function(o,t){var l=t[0],f=t[1],_=t[2],E=t[3],b=l+l,A=f+f,k=_+_,F=l*b,G=f*b,J=f*A,ne=_*b,le=_*A,de=_*k,Se=E*b,tt=E*A,_t=E*k;return o[0]=1-J-de,o[1]=G+_t,o[2]=ne-tt,o[3]=0,o[4]=G-_t,o[5]=1-F-de,o[6]=le+Se,o[7]=0,o[8]=ne+tt,o[9]=le-Se,o[10]=1-F-J,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.fromRotation=function(o,t){var l=Math.sin(t),f=Math.cos(t);return o[0]=f,o[1]=l,o[2]=0,o[3]=-l,o[4]=f,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},m.fromScaling=rh,m.furthestTileCorner=function(o){const t=Math.round((o+45+360)%360/90)%4;return Ge[t]},m.getAABBPointSquareDist=function(o,t,l){let f=0;for(let _=0;_<2;++_){const E=l?l[_]:0;o[_]>E&&(f+=(o[_]-E)*(o[_]-E)),t[_]<E&&(f+=(E-t[_])*(E-t[_]))}return f},m.getAnchorAlignment=Eg,m.getAnchorJustification=Pd,m.getBounds=function(o){let t=1/0,l=1/0,f=-1/0,_=-1/0;for(const E of o)t=Math.min(t,E.x),l=Math.min(l,E.y),f=Math.max(f,E.x),_=Math.max(_,E.y);return{min:new Le(t,l),max:new Le(f,_)}},m.getColumn=Hn,m.getDefaultExportFromCjs=ht,m.getGridMatrix=function(o,t,l,f){const _=t.getNorth(),E=t.getSouth(),b=t.getWest(),A=t.getEast(),k=1<<o.z,F=A-b,G=_-E,J=F/64,ne=-G/qh[l],le=[0,J,0,ne,0,0,_,b,0];if(o.z>0){const de=180/f;Bh(le,le,[de/F+1,0,0,0,de/G+1,0,-.5*de/J,.5*de/ne,1])}return le[2]=k,le[5]=o.x,le[8]=o.y,le},m.getImage=oe,m.getJSON=function(o,t){return qn(Qe(o,{type:"json"}),t)},m.getLatitudinalLod=function(o){const t=xa-5;o=qt(o,-t,t)/t*90;const l=Math.pow(Math.abs(Math.sin(Ze(o))),3);return Math.round(l*(qh.length-1))},m.getMapSessionAPI=_r,m.getPerformanceMeasurement=Sn,m.getProjection=Lm,m.getRTLTextPluginStatus=w,m.getReferrer=ci,m.getTilePoint=function(o,{x:t,y:l},f=0){return new Le(((t-f)*o.scale-o.x)*ii,(l*o.scale-o.y)*ii)},m.getTileVec3=function(o,t,l=0){return rd(((t.x-l)*o.scale-o.x)*ii,(t.y*o.scale-o.y)*ii,Ip(t.z,t.y))},m.getVideo=function(o,t){const l=ae.document.createElement("video");l.muted=!0,l.onloadstart=function(){t(null,l)};for(let f=0;f<o.length;f++){const _=ae.document.createElement("source");Zt(o[f])||(l.crossOrigin="Anonymous"),_.src=o[f],l.appendChild(_)}return{cancel:()=>{}}},m.globeCenterToScreenPoint=function(o){const t=[0,0,0],l=$o(new Float64Array(16));return Eo(l,o.pixelMatrix,o.globeMatrix),ua(t,t,l),new Le(t[0],t[1])},m.globeDenormalizeECEF=uh,m.globeECEFOrigin=function(o,t){const l=[0,0,0];return ua(l,l,Wc(Wu(t.canonical))),ua(l,l,o),l},m.globeMetersToEcef=Kh,m.globeNormalizeECEF=Wc,m.globePixelsToTileUnits=function(o,t){return ii/(512*Math.pow(2,o))*ch(Wu(t))},m.globePoleMatrixForTile=function(o,t,l){const f=$o(new Float64Array(16)),_=(t/(1<<o)-.5)*Math.PI*2;return vd(f,l.globeMatrix,_),Float32Array.from(f)},m.globeTileBounds=Wu,m.globeTiltAtLngLat=fm,m.globeToMercatorTransition=yu,m.globeUseCustomAntiAliasing=function(o,t,l){const f=yu(l.zoom),_=o.style.map._antialias,E=!!t.extStandardDerivatives,b=t.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===f&&!_&&!b&&E},m.identity=$o,m.identity$1=Ep,m.invert=Vh,m.isFullscreen=function(){return!!ae.document.fullscreenElement||!!ae.document.webkitFullscreenElement},m.isLngLatBehindGlobe=Cc,m.isMapAuthenticated=function(o){return Bs.has(o)},m.isMapboxURL=Me,m.isSafariWithAntialiasingBug=function(o){const t=o.navigator?o.navigator.userAgent:null;return!!Zn(o)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},m.latFromMercatorY=Ka,m.latLngToECEF=hc,m.len=Ed,m.length=zh,m.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},m.lngFromMercatorX=qa,m.loadVectorTile=jy,m.makeRequest=qn,m.mapValue=function(o,t,l,f,_){return qt((o-t)/(l-t)*(_-f)+f,f,_)},m.mercatorScale=dh,m.mercatorXfromLng=au,m.mercatorYfromLat=yl,m.mercatorZfromAltitude=fc,m.mul=ao,m.mul$1=Gh,m.multiply=Eo,m.multiply$1=Bh,m.multiply$2=ih,m.nextPowerOfTwo=sn,m.normalize=Ac,m.normalize$1=ou,m.normalize$2=Hh,m.number=ns,m.ortho=function(o,t,l,f,_,E,b){var A=1/(t-l),k=1/(f-_),F=1/(E-b);return o[0]=-2*A,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*k,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*F,o[11]=0,o[12]=(t+l)*A,o[13]=(_+f)*k,o[14]=(b+E)*F,o[15]=1,o},m.pbf=C_,m.perspective=function(o,t,l,f,_){var E,b=1/Math.tan(t/2);return o[0]=b/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=b,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=_&&_!==1/0?(o[10]=(_+f)*(E=1/(f-_)),o[14]=2*_*f*E):(o[10]=-1,o[14]=-2*f),o},m.pick=function(o,t){const l={};for(let f=0;f<t.length;f++){const _=t[f];_ in o&&(l[_]=o[_])}return l},m.plugin=P,m.pointGeometry=nt,m.polesInViewport=function(o){const t=$o(new Float64Array(16));Eo(t,o.pixelMatrix,o.globeMatrix);const l=[0,il,0],f=[0,Xl,0];return ua(l,l,t),ua(f,f,t),[l[0]>0&&l[0]<=o.width&&l[1]>0&&l[1]<=o.height&&!Cc(o,new Ws(o.center.lat,90)),f[0]>0&&f[0]<=o.width&&f[1]>0&&f[1]<=o.height&&!Cc(o,new Ws(o.center.lat,-90))]},m.polygonContainsPoint=lu,m.polygonIntersectsBox=ph,m.polygonIntersectsPolygon=oi,m.polygonizeBounds=function(o,t,l=0,f=!0){const _=new Le(l,l),E=o.sub(_),b=t.add(_),A=[E,new Le(b.x,E.y),b,new Le(E.x,b.y)];return f&&A.push(E.clone()),A},m.posAttributes=ma,m.postMapLoadEvent=Hr,m.postPerformanceEvent=$i,m.postTurnstileEvent=ar,m.potpack=Up,m.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},m.radToDeg=it,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.registerForPluginStateChange=function(o){return o({pluginStatus:c,pluginURL:n}),y.on("pluginStateChange",o),o},m.removeAuthState=function(o){Bs.delete(o)},m.renderColorRamp=rf,m.resample=Qh,m.rotateX=nd,m.rotateX$1=id,m.rotateY=vd,m.rotateY$1=ah,m.rotateZ=function(o,t,l){var f=Math.sin(l),_=Math.cos(l),E=t[0],b=t[1],A=t[2],k=t[3],F=t[4],G=t[5],J=t[6],ne=t[7];return t!==o&&(o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]),o[0]=E*_+F*f,o[1]=b*_+G*f,o[2]=A*_+J*f,o[3]=k*_+ne*f,o[4]=F*_-E*f,o[5]=G*_-b*f,o[6]=J*_-A*f,o[7]=ne*_-k*f,o},m.rotateZ$1=function(o,t,l){l*=.5;var f=t[0],_=t[1],E=t[2],b=t[3],A=Math.sin(l),k=Math.cos(l);return o[0]=f*k+_*A,o[1]=_*k-f*A,o[2]=E*k+b*A,o[3]=b*k-E*A,o},m.scale=Mu,m.scale$1=Ud,m.scale$2=dc,m.scaleAndAdd=$h,m.set=function(o,t,l,f){return o[0]=t,o[1]=l,o[2]=f,o},m.setCacheLimits=function(o,t){kr=o,Gt=t},m.setColumn=function(o,t,l){o[4*t+0]=l[0],o[4*t+1]=l[1],o[4*t+2]=l[2],o[4*t+3]=l[3]},m.setRTLTextPlugin=function(o,t,l=!1){if(c===Oo||c===pi||c===Au)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=ws.resolveURL(o),c=Oo,Z=t,p(),l||C()},m.smoothstep=Ht,m.spec=bt,m.squaredLength=function(o){var t=o[0],l=o[1],f=o[2];return t*t+l*l+f*f},m.storeAuthState=function(o,t){t?Bs.add(o):Bs.delete(o)},m.sub=su,m.subtract=jh,m.symbolSize=zv,m.tileAABB=function(o,t,l,f,_,E,b,A,k){if("globe"===k.name)return function Os(o,t,l){const f=t/o.worldSize,_=o.globeMatrix;if(l.z<=1){const pn=Wu(l).getCorners();return bp(pn,_,f),gl.fromPoints(pn)}const E=Nf(l),b=jd(E);bp(b,_,f);const A=Number.MAX_VALUE,k=[-A,-A,-A],F=[A,A,A];if(E.contains(o.center)){for(const or of b)sh(F,F,or),xd(k,k,or);k[2]=0;const pn=o.point,Fn=[pn.x*f,pn.y*f,0];return sh(F,F,Fn),xd(k,k,Fn),new gl(F,k)}const G=[_[12]*f,_[13]*f,_[14]*f],J=E.getCenter(),ne=qt(o.center.lat,-xa,xa),le=qt(J.lat,-xa,xa),de=au(o.center.lng),Se=yl(ne);let tt=de-au(J.lng);const _t=Se-yl(le);tt>.5?tt-=1:tt<-.5&&(tt+=1);let At=0;Math.abs(tt)>Math.abs(_t)?At=tt>=0?1:3:(At=_t>=0?0:2,$h(G,G,[_[4]*f,_[5]*f,_[6]*f],-Math.sin(Ze(_t>=0?E.getSouth():E.getNorth()))*kc));const yt=b[At],St=b[(At+1)%4],Ft=new Xm(yt,St,G),kt=[gu(Ft,0)||yt[0],gu(Ft,1)||yt[1],gu(Ft,2)||yt[2]],yn=yu(o.zoom);if(yn>0){const pn=function({x:or,y:En,z:$n},jn,tr,cr,Pn){const Pr=1/(1<<$n);let Zr=or*Pr,Lr=Zr+Pr,is=En*Pr,hr=is+Pr,di=0;const Zi=(Zr+Lr)/2-cr;return Zi>.5?di=-1:Zi<-.5&&(di=1),Zr=((Zr+di)*jn-(cr*=jn))*tr+cr,Lr=((Lr+di)*jn-cr)*tr+cr,is=(is*jn-(Pn*=jn))*tr+Pn,hr=(hr*jn-Pn)*tr+Pn,[[Zr,hr,0],[Lr,hr,0],[Lr,is,0],[Zr,is,0]]}(l,t,o._pixelsPerMercatorPixel,de,Se);for(let or=0;or<b.length;or++)_u(b[or],pn[or],yn);const Fn=iu([],pn[At],pn[(At+1)%4]);dc(Fn,Fn,.5),_u(kt,Fn,yn)}for(const pn of b)sh(F,F,pn),xd(k,k,pn);return F[2]=Math.min(yt[2],St[2]),sh(F,F,kt),xd(k,k,kt),new gl(F,k)}(o,t,new Zu(l,f,_));const F=bh({z:l,x:f,y:_},k);return new gl([(E+F.x/F.scale)*t,t*(F.y/F.scale),b],[(E+F.x2/F.scale)*t,t*(F.y2/F.scale),A])},m.tileCornersToBounds=Nf,m.tileTransform=bh,m.transformMat3=function(o,t,l){var f=t[0],_=t[1],E=t[2];return o[0]=f*l[0]+_*l[3]+E*l[6],o[1]=f*l[1]+_*l[4]+E*l[7],o[2]=f*l[2]+_*l[5]+E*l[8],o},m.transformMat4=ua,m.transformMat4$1=Hu,m.transformQuat=Pf,m.transitionTileAABBinECEF=wp,m.translate=Du,m.transpose=function(o,t){if(o===t){var l=t[1],f=t[2],_=t[5];o[1]=t[3],o[2]=t[6],o[3]=l,o[5]=t[7],o[6]=f,o[7]=_}else o[0]=t[0],o[1]=t[3],o[2]=t[6],o[3]=t[1],o[4]=t[4],o[5]=t[7],o[6]=t[2],o[7]=t[5],o[8]=t[8];return o},m.triggerPluginCompletionEvent=a,m.uniqueId=$t,m.updateGlobeVertexNormal=function(o,t,l,f,_){const E=5*t+2;o.float32[E+0]=l,o.float32[E+1]=f,o.float32[E+2]=_},m.validateCustomStyleLayer=function(o){const t=[],l=o.id;return void 0===l&&t.push({message:`layers.${l}: missing required property "id"`}),void 0===o.render&&t.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&t.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),t},m.validateFilter=o=>pr(Kl(o)),m.validateFog=o=>pr(cc(o)),m.validateLayer=o=>pr(jo(o)),m.validateLight=o=>pr(Ss(o)),m.validateSource=o=>pr(fa(o)),m.validateStyle=Gs,m.validateTerrain=o=>pr(Oi(o)),m.values=Pt,m.vectorTile=wm,m.version=De,m.warnOnce=ur,m.window=ae,m.wrap=lt}),z(0,function(m){function ae(ve){if("number"==typeof ve||"boolean"==typeof ve||"string"==typeof ve||null==ve)return JSON.stringify(ve);if(Array.isArray(ve)){let Q="[";for(const oe of ve)Q+=`${ae(oe)},`;return`${Q}]`}let re="{";for(const Q of Object.keys(ve).sort())re+=`${Q}:${ae(ve[Q])},`;return`${re}}`}function De(ve){let re="";for(const Q of m.refProperties)re+=`/${ae(ve[Q])}`;return re}class Be{constructor(re){this.keyCache={},re&&this.replace(re)}replace(re){this._layerConfigs={},this._layers={},this.update(re,[])}update(re,Q){for(const ge of re)this._layerConfigs[ge.id]=ge,(this._layers[ge.id]=m.createStyleLayer(ge)).compileFilter(),this.keyCache[ge.id]&&delete this.keyCache[ge.id];for(const ge of Q)delete this.keyCache[ge],delete this._layerConfigs[ge],delete this._layers[ge];this.familiesBySource={};const oe=function(ge,Me){const $e={};for(let Ie=0;Ie<ge.length;Ie++){const we=Me&&Me[ge[Ie].id]||De(ge[Ie]);Me&&(Me[ge[Ie].id]=we);let Je=$e[we];Je||(Je=$e[we]=[]),Je.push(ge[Ie])}const Re=[];for(const Ie in $e)Re.push($e[Ie]);return Re}(m.values(this._layerConfigs),this.keyCache);for(const ge of oe){const Me=ge.map(Ae=>this._layers[Ae.id]),$e=Me[0];if("none"===$e.visibility)continue;const Re=$e.source||"";let Ie=this.familiesBySource[Re];Ie||(Ie=this.familiesBySource[Re]={});const we=$e.sourceLayer||"_geojsonTileLayer";let Je=Ie[we];Je||(Je=Ie[we]=[]),Je.push(Me)}}}class Ve{loadTile(re,Q){const{uid:oe,encoding:ge,rawImageData:Me,padding:$e,buildQuadTree:Re}=re,Ie=m.window.ImageBitmap&&Me instanceof m.window.ImageBitmap?this.getImageData(Me,$e):Me;Q(null,new m.DEMData(oe,Ie,ge,$e<1,Re))}getImageData(re,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const oe=this.offscreenCanvasContext.getImageData(-Q,-Q,re.width+2*Q,re.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}function xe(ve,re){if(0!==ve.length){se(ve[0],re);for(var Q=1;Q<ve.length;Q++)se(ve[Q],!re)}}function se(ve,re){for(var Q=0,oe=0,ge=0,Me=ve.length,$e=Me-1;ge<Me;$e=ge++){var Re=(ve[ge][0]-ve[$e][0])*(ve[$e][1]+ve[ge][1]),Ie=Q+Re;oe+=Math.abs(Q)>=Math.abs(Re)?Q-Ie+Re:Re-Ie+Q,Q=Ie}Q+oe>=0!=!!re&&ve.reverse()}var me=m.getDefaultExportFromCjs(function ve(re,Q){var oe,ge=re&&re.type;if("FeatureCollection"===ge)for(oe=0;oe<re.features.length;oe++)ve(re.features[oe],Q);else if("GeometryCollection"===ge)for(oe=0;oe<re.geometries.length;oe++)ve(re.geometries[oe],Q);else if("Feature"===ge)ve(re.geometry,Q);else if("Polygon"===ge)xe(re.coordinates,Q);else if("MultiPolygon"===ge)for(oe=0;oe<re.coordinates.length;oe++)xe(re.coordinates[oe],Q);return re});const He=m.VectorTileFeature.prototype.toGeoJSON;var qe={exports:{}},Oe=m.pointGeometry,je=m.vectorTile.VectorTileFeature,ht=et;function et(ve,re){this.options=re||{},this.features=ve,this.length=ve.length}function ct(ve,re){this.id="number"==typeof ve.id?ve.id:void 0,this.type=ve.type,this.rawGeometry=1===ve.type?[ve.geometry]:ve.geometry,this.properties=ve.tags,this.extent=re||4096}et.prototype.feature=function(ve){return new ct(this.features[ve],this.options.extent)},ct.prototype.loadGeometry=function(){var ve=this.rawGeometry;this.geometry=[];for(var re=0;re<ve.length;re++){for(var Q=ve[re],oe=[],ge=0;ge<Q.length;ge++)oe.push(new Oe(Q[ge][0],Q[ge][1]));this.geometry.push(oe)}return this.geometry},ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ve=this.geometry,re=1/0,Q=-1/0,oe=1/0,ge=-1/0,Me=0;Me<ve.length;Me++)for(var $e=ve[Me],Re=0;Re<$e.length;Re++){var Ie=$e[Re];re=Math.min(re,Ie.x),Q=Math.max(Q,Ie.x),oe=Math.min(oe,Ie.y),ge=Math.max(ge,Ie.y)}return[re,oe,Q,ge]},ct.prototype.toGeoJSON=je.prototype.toGeoJSON;var Ue=m.pbf,nt=ht;function Xe(ve){var re=new Ue;return function(Q,oe){for(var ge in Q.layers)oe.writeMessage(3,Le,Q.layers[ge])}(ve,re),re.finish()}function Le(ve,re){var Q;re.writeVarintField(15,ve.version||1),re.writeStringField(1,ve.name||""),re.writeVarintField(5,ve.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(Q=0;Q<ve.length;Q++)oe.feature=ve.feature(Q),re.writeMessage(2,Te,oe);var ge=oe.keys;for(Q=0;Q<ge.length;Q++)re.writeStringField(3,ge[Q]);var Me=oe.values;for(Q=0;Q<Me.length;Q++)re.writeMessage(4,nn,Me[Q])}function Te(ve,re){var Q=ve.feature;void 0!==Q.id&&re.writeVarintField(1,Q.id),re.writeMessage(2,at,ve),re.writeVarintField(3,Q.type),re.writeMessage(4,Ge,Q)}function at(ve,re){var Q=ve.feature,oe=ve.keys,ge=ve.values,Me=ve.keycache,$e=ve.valuecache;for(var Re in Q.properties){var Ie=Q.properties[Re],we=Me[Re];if(null!==Ie){void 0===we&&(oe.push(Re),Me[Re]=we=oe.length-1),re.writeVarint(we);var Je=typeof Ie;"string"!==Je&&"boolean"!==Je&&"number"!==Je&&(Ie=JSON.stringify(Ie));var Ae=Je+":"+Ie,Ne=$e[Ae];void 0===Ne&&(ge.push(Ie),$e[Ae]=Ne=ge.length-1),re.writeVarint(Ne)}}}function Ze(ve,re){return(re<<3)+(7&ve)}function it(ve){return ve<<1^ve>>31}function Ge(ve,re){for(var Q=ve.loadGeometry(),oe=ve.type,ge=0,Me=0,$e=Q.length,Re=0;Re<$e;Re++){var Ie=Q[Re],we=1;1===oe&&(we=Ie.length),re.writeVarint(Ze(1,we));for(var Je=3===oe?Ie.length-1:Ie.length,Ae=0;Ae<Je;Ae++){1===Ae&&1!==oe&&re.writeVarint(Ze(2,Je-1));var Ne=Ie[Ae].x-ge,ft=Ie[Ae].y-Me;re.writeVarint(it(Ne)),re.writeVarint(it(ft)),ge+=Ne,Me+=ft}3===oe&&re.writeVarint(Ze(7,1))}}function nn(ve,re){var Q=typeof ve;"string"===Q?re.writeStringField(1,ve):"boolean"===Q?re.writeBooleanField(7,ve):"number"===Q&&(ve%1!=0?re.writeDoubleField(3,ve):ve<0?re.writeSVarintField(6,ve):re.writeVarintField(5,ve))}qe.exports=Xe,qe.exports.fromVectorTileJs=Xe,qe.exports.fromGeojsonVt=function(ve,re){re=re||{};var Q={};for(var oe in ve)Q[oe]=new nt(ve[oe].features,re),Q[oe].name=oe,Q[oe].version=re.version,Q[oe].extent=re.extent;return Xe({layers:Q})},qe.exports.GeoJSONWrapper=nt;var bn=m.getDefaultExportFromCjs(qe.exports);const Cn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},qt=Math.fround||(Ht=new Float32Array(1),ve=>(Ht[0]=+ve,Ht[0]));var Ht;const lt=3,Ct=5,Pt=6;class Qe{constructor(re){this.options=Object.assign(Object.create(Cn),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:Q,minZoom:oe,maxZoom:ge}=this.options;Q&&console.time("total time");const Me=`prepare ${re.length} points`;Q&&console.time(Me),this.points=re;const $e=[];for(let Ie=0;Ie<re.length;Ie++){const we=re[Ie];if(!we.geometry)continue;const[Je,Ae]=we.geometry.coordinates,Ne=qt(Qt(Je)),ft=qt(sn(Ae));$e.push(Ne,ft,1/0,Ie,-1,1),this.options.reduce&&$e.push(0)}let Re=this.trees[ge+1]=this._createTree($e);Q&&console.timeEnd(Me);for(let Ie=ge;Ie>=oe;Ie--){const we=+Date.now();Re=this.trees[Ie]=this._createTree(this._cluster(Re,Ie)),Q&&console.log("z%d: %d clusters in %dms",Ie,Re.numItems,+Date.now()-we)}return Q&&console.timeEnd("total time"),this}getClusters(re,Q){let oe=((re[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,re[1]));let Me=180===re[2]?180:((re[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)oe=-180,Me=180;else if(oe>Me){const Ae=this.getClusters([oe,ge,180,$e],Q),Ne=this.getClusters([-180,ge,Me,$e],Q);return Ae.concat(Ne)}const Re=this.trees[this._limitZoom(Q)],Ie=Re.range(Qt(oe),sn($e),Qt(Me),sn(ge)),we=Re.data,Je=[];for(const Ae of Ie){const Ne=this.stride*Ae;Je.push(we[Ne+Ct]>1?Tt(we,Ne,this.clusterProps):this.points[we[Ne+lt]])}return Je}getChildren(re){const Q=this._getOriginId(re),oe=this._getOriginZoom(re),ge="No cluster with the specified id.",Me=this.trees[oe];if(!Me)throw new Error(ge);const $e=Me.data;if(Q*this.stride>=$e.length)throw new Error(ge);const Re=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Ie=Me.within($e[Q*this.stride],$e[Q*this.stride+1],Re),we=[];for(const Je of Ie){const Ae=Je*this.stride;$e[Ae+4]===re&&we.push($e[Ae+Ct]>1?Tt($e,Ae,this.clusterProps):this.points[$e[Ae+lt]])}if(0===we.length)throw new Error(ge);return we}getLeaves(re,Q,oe){const ge=[];return this._appendLeaves(ge,re,Q=Q||10,oe=oe||0,0),ge}getTile(re,Q,oe){const ge=this.trees[this._limitZoom(re)],Me=Math.pow(2,re),{extent:$e,radius:Re}=this.options,Ie=Re/$e,we=(oe-Ie)/Me,Je=(oe+1+Ie)/Me,Ae={features:[]};return this._addTileFeatures(ge.range((Q-Ie)/Me,we,(Q+1+Ie)/Me,Je),ge.data,Q,oe,Me,Ae),0===Q&&this._addTileFeatures(ge.range(1-Ie/Me,we,1,Je),ge.data,Me,oe,Me,Ae),Q===Me-1&&this._addTileFeatures(ge.range(0,we,Ie/Me,Je),ge.data,-1,oe,Me,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(re){let Q=this._getOriginZoom(re)-1;for(;Q<=this.options.maxZoom;){const oe=this.getChildren(re);if(Q++,1!==oe.length)break;re=oe[0].properties.cluster_id}return Q}_appendLeaves(re,Q,oe,ge,Me){const $e=this.getChildren(Q);for(const Re of $e){const Ie=Re.properties;if(Ie&&Ie.cluster?Me+Ie.point_count<=ge?Me+=Ie.point_count:Me=this._appendLeaves(re,Ie.cluster_id,oe,ge,Me):Me<ge?Me++:re.push(Re),re.length===oe)break}return Me}_createTree(re){const Q=new m.KDBush(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<re.length;oe+=this.stride)Q.add(re[oe],re[oe+1]);return Q.finish(),Q.data=re,Q}_addTileFeatures(re,Q,oe,ge,Me,$e){for(const Re of re){const Ie=Re*this.stride,we=Q[Ie+Ct]>1;let Je,Ae,Ne;if(we)Je=$t(Q,Ie,this.clusterProps),Ae=Q[Ie],Ne=Q[Ie+1];else{const Rt=this.points[Q[Ie+lt]];Je=Rt.properties;const[Mn,ar]=Rt.geometry.coordinates;Ae=Qt(Mn),Ne=sn(ar)}const ft={type:1,geometry:[[Math.round(this.options.extent*(Ae*Me-oe)),Math.round(this.options.extent*(Ne*Me-ge))]],tags:Je};let Vt;Vt=we||this.options.generateId?Q[Ie+lt]:this.points[Q[Ie+lt]].id,void 0!==Vt&&(ft.id=Vt),$e.features.push(ft)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,Q){const{radius:oe,extent:ge,reduce:Me,minPoints:$e}=this.options,Re=oe/(ge*Math.pow(2,Q)),Ie=re.data,we=[],Je=this.stride;for(let Ae=0;Ae<Ie.length;Ae+=Je){if(Ie[Ae+2]<=Q)continue;Ie[Ae+2]=Q;const Ne=Ie[Ae],ft=Ie[Ae+1],Vt=re.within(Ie[Ae],Ie[Ae+1],Re),Rt=Ie[Ae+Ct];let Mn=Rt;for(const ar of Vt){const wr=ar*Je;Ie[wr+2]>Q&&(Mn+=Ie[wr+Ct])}if(Mn>Rt&&Mn>=$e){let ar,wr=Ne*Rt,Hr=ft*Rt,Li=-1;const $i=(Ae/Je<<5)+(Q+1)+this.points.length;for(const Wr of Vt){const _r=Wr*Je;if(Ie[_r+2]<=Q)continue;Ie[_r+2]=Q;const Bs=Ie[_r+Ct];wr+=Ie[_r]*Bs,Hr+=Ie[_r+1]*Bs,Ie[_r+4]=$i,Me&&(ar||(ar=this._map(Ie,Ae,!0),Li=this.clusterProps.length,this.clusterProps.push(ar)),Me(ar,this._map(Ie,_r)))}Ie[Ae+4]=$i,we.push(wr/Mn,Hr/Mn,1/0,$i,-1,Mn),Me&&we.push(Li)}else{for(let ar=0;ar<Je;ar++)we.push(Ie[Ae+ar]);if(Mn>1)for(const ar of Vt){const wr=ar*Je;if(!(Ie[wr+2]<=Q)){Ie[wr+2]=Q;for(let Hr=0;Hr<Je;Hr++)we.push(Ie[wr+Hr])}}}}return we}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,Q,oe){if(re[Q+Ct]>1){const $e=this.clusterProps[re[Q+Pt]];return oe?Object.assign({},$e):$e}const ge=this.points[re[Q+lt]].properties,Me=this.options.map(ge);return oe&&Me===ge?Object.assign({},Me):Me}}function Tt(ve,re,Q){return{type:"Feature",id:ve[re+lt],properties:$t(ve,re,Q),geometry:{type:"Point",coordinates:[(oe=ve[re],360*(oe-.5)),mn(ve[re+1])]}};var oe}function $t(ve,re,Q){const oe=ve[re+Ct],ge=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,Me=ve[re+Pt],$e=-1===Me?{}:Object.assign({},Q[Me]);return Object.assign($e,{cluster:!0,cluster_id:ve[re+lt],point_count:oe,point_count_abbreviated:ge})}function Qt(ve){return ve/360+.5}function sn(ve){const re=Math.sin(ve*Math.PI/180),Q=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return Q<0?0:Q>1?1:Q}function mn(ve){const re=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Vn(ve,re,Q,oe){for(var ge,Me=oe,$e=Q-re>>1,Re=Q-re,Ie=ve[re],we=ve[re+1],Je=ve[Q],Ae=ve[Q+1],Ne=re+3;Ne<Q;Ne+=3){var ft=Fr(ve[Ne],ve[Ne+1],Ie,we,Je,Ae);if(ft>Me)ge=Ne,Me=ft;else if(ft===Me){var Vt=Math.abs(Ne-$e);Vt<Re&&(ge=Ne,Re=Vt)}}Me>oe&&(ge-re>3&&Vn(ve,re,ge,oe),ve[ge+2]=Me,Q-ge>3&&Vn(ve,ge,Q,oe))}function Fr(ve,re,Q,oe,ge,Me){var $e=ge-Q,Re=Me-oe;if(0!==$e||0!==Re){var Ie=((ve-Q)*$e+(re-oe)*Re)/($e*$e+Re*Re);Ie>1?(Q=ge,oe=Me):Ie>0&&(Q+=$e*Ie,oe+=Re*Ie)}return($e=ve-Q)*$e+(Re=re-oe)*Re}function Ot(ve,re,Q,oe){var ge={id:void 0===ve?null:ve,type:re,geometry:Q,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var $e=Me.geometry,Re=Me.type;if("Point"===Re||"MultiPoint"===Re||"LineString"===Re)on(Me,$e);else if("Polygon"===Re||"MultiLineString"===Re)for(var Ie=0;Ie<$e.length;Ie++)on(Me,$e[Ie]);else if("MultiPolygon"===Re)for(Ie=0;Ie<$e.length;Ie++)for(var we=0;we<$e[Ie].length;we++)on(Me,$e[Ie][we])}(ge),ge}function on(ve,re){for(var Q=0;Q<re.length;Q+=3)ve.minX=Math.min(ve.minX,re[Q]),ve.minY=Math.min(ve.minY,re[Q+1]),ve.maxX=Math.max(ve.maxX,re[Q]),ve.maxY=Math.max(ve.maxY,re[Q+1])}function Or(ve,re,Q,oe){if(re.geometry){var ge=re.geometry.coordinates,Me=re.geometry.type,$e=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2),Re=[],Ie=re.id;if(Q.promoteId?Ie=re.properties[Q.promoteId]:Q.generateId&&(Ie=oe||0),"Point"===Me)jr(ge,Re);else if("MultiPoint"===Me)for(var we=0;we<ge.length;we++)jr(ge[we],Re);else if("LineString"===Me)ur(ge,Re,$e,!1);else if("MultiLineString"===Me){if(Q.lineMetrics){for(we=0;we<ge.length;we++)ur(ge[we],Re=[],$e,!1),ve.push(Ot(Ie,"LineString",Re,re.properties));return}Ai(ge,Re,$e,!1)}else if("Polygon"===Me)Ai(ge,Re,$e,!0);else{if("MultiPolygon"!==Me){if("GeometryCollection"===Me){for(we=0;we<re.geometry.geometries.length;we++)Or(ve,{id:Ie,geometry:re.geometry.geometries[we],properties:re.properties},Q,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(we=0;we<ge.length;we++){var Je=[];Ai(ge[we],Je,$e,!0),Re.push(Je)}}ve.push(Ot(Ie,Me,Re,re.properties))}}function jr(ve,re){re.push(Ri(ve[0])),re.push(nr(ve[1])),re.push(0)}function ur(ve,re,Q,oe){for(var ge,Me,$e=0,Re=0;Re<ve.length;Re++){var Ie=Ri(ve[Re][0]),we=nr(ve[Re][1]);re.push(Ie),re.push(we),re.push(0),Re>0&&($e+=oe?(ge*we-Ie*Me)/2:Math.sqrt(Math.pow(Ie-ge,2)+Math.pow(we-Me,2))),ge=Ie,Me=we}var Je=re.length-3;re[2]=1,Vn(re,0,Je,Q),re[Je+2]=1,re.size=Math.abs($e),re.start=0,re.end=re.size}function Ai(ve,re,Q,oe){for(var ge=0;ge<ve.length;ge++){var Me=[];ur(ve[ge],Me,Q,oe),re.push(Me)}}function Ri(ve){return ve/360+.5}function nr(ve){var re=Math.sin(ve*Math.PI/180),Q=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return Q<0?0:Q>1?1:Q}function mr(ve,re,Q,oe,ge,Me,$e,Re){if(oe/=re,Me>=(Q/=re)&&$e<oe)return ve;if($e<Q||Me>=oe)return null;for(var Ie=[],we=0;we<ve.length;we++){var Je=ve[we],Ae=Je.geometry,Ne=Je.type,ft=0===ge?Je.minX:Je.minY,Vt=0===ge?Je.maxX:Je.maxY;if(ft>=Q&&Vt<oe)Ie.push(Je);else if(!(Vt<Q||ft>=oe)){var Rt=[];if("Point"===Ne||"MultiPoint"===Ne)Er(Ae,Rt,Q,oe,ge);else if("LineString"===Ne)Zn(Ae,Rt,Q,oe,ge,!1,Re.lineMetrics);else if("MultiLineString"===Ne)Hn(Ae,Rt,Q,oe,ge,!1);else if("Polygon"===Ne)Hn(Ae,Rt,Q,oe,ge,!0);else if("MultiPolygon"===Ne)for(var Mn=0;Mn<Ae.length;Mn++){var ar=[];Hn(Ae[Mn],ar,Q,oe,ge,!0),ar.length&&Rt.push(ar)}if(Rt.length){if(Re.lineMetrics&&"LineString"===Ne){for(Mn=0;Mn<Rt.length;Mn++)Ie.push(Ot(Je.id,Ne,Rt[Mn],Je.tags));continue}"LineString"!==Ne&&"MultiLineString"!==Ne||(1===Rt.length?(Ne="LineString",Rt=Rt[0]):Ne="MultiLineString"),"Point"!==Ne&&"MultiPoint"!==Ne||(Ne=3===Rt.length?"Point":"MultiPoint"),Ie.push(Ot(Je.id,Ne,Rt,Je.tags))}}}return Ie.length?Ie:null}function Er(ve,re,Q,oe,ge){for(var Me=0;Me<ve.length;Me+=3){var $e=ve[Me+ge];$e>=Q&&$e<=oe&&(re.push(ve[Me]),re.push(ve[Me+1]),re.push(ve[Me+2]))}}function Zn(ve,re,Q,oe,ge,Me,$e){for(var Re,Ie,we=us(ve),Je=0===ge?kr:Gt,Ae=ve.start,Ne=0;Ne<ve.length-3;Ne+=3){var ft=ve[Ne],Vt=ve[Ne+1],Rt=ve[Ne+2],Mn=ve[Ne+3],ar=ve[Ne+4],wr=0===ge?ft:Vt,Hr=0===ge?Mn:ar,Li=!1;$e&&(Re=Math.sqrt(Math.pow(ft-Mn,2)+Math.pow(Vt-ar,2))),wr<Q?Hr>Q&&(Ie=Je(we,ft,Vt,Mn,ar,Q),$e&&(we.start=Ae+Re*Ie)):wr>oe?Hr<oe&&(Ie=Je(we,ft,Vt,Mn,ar,oe),$e&&(we.start=Ae+Re*Ie)):Sr(we,ft,Vt,Rt),Hr<Q&&wr>=Q&&(Ie=Je(we,ft,Vt,Mn,ar,Q),Li=!0),Hr>oe&&wr<=oe&&(Ie=Je(we,ft,Vt,Mn,ar,oe),Li=!0),!Me&&Li&&($e&&(we.end=Ae+Re*Ie),re.push(we),we=us(ve)),$e&&(Ae+=Re)}var $i=ve.length-3;ft=ve[$i],Vt=ve[$i+1],Rt=ve[$i+2],(wr=0===ge?ft:Vt)>=Q&&wr<=oe&&Sr(we,ft,Vt,Rt),$i=we.length-3,Me&&$i>=3&&(we[$i]!==we[0]||we[$i+1]!==we[1])&&Sr(we,we[0],we[1],we[2]),we.length&&re.push(we)}function us(ve){var re=[];return re.size=ve.size,re.start=ve.start,re.end=ve.end,re}function Hn(ve,re,Q,oe,ge,Me){for(var $e=0;$e<ve.length;$e++)Zn(ve[$e],re,Q,oe,ge,Me,!1)}function Sr(ve,re,Q,oe){ve.push(re),ve.push(Q),ve.push(oe)}function kr(ve,re,Q,oe,ge,Me){var $e=(Me-re)/(oe-re);return ve.push(Me),ve.push(Q+(ge-Q)*$e),ve.push(1),$e}function Gt(ve,re,Q,oe,ge,Me){var $e=(Me-Q)/(ge-Q);return ve.push(re+(oe-re)*$e),ve.push(Me),ve.push(1),$e}function Bt(ve,re){for(var Q=[],oe=0;oe<ve.length;oe++){var ge,Me=ve[oe],$e=Me.type;if("Point"===$e||"MultiPoint"===$e||"LineString"===$e)ge=Ce(Me.geometry,re);else if("MultiLineString"===$e||"Polygon"===$e){ge=[];for(var Re=0;Re<Me.geometry.length;Re++)ge.push(Ce(Me.geometry[Re],re))}else if("MultiPolygon"===$e)for(ge=[],Re=0;Re<Me.geometry.length;Re++){for(var Ie=[],we=0;we<Me.geometry[Re].length;we++)Ie.push(Ce(Me.geometry[Re][we],re));ge.push(Ie)}Q.push(Ot(Me.id,$e,ge,Me.tags))}return Q}function Ce(ve,re){var Q=[];Q.size=ve.size,void 0!==ve.start&&(Q.start=ve.start,Q.end=ve.end);for(var oe=0;oe<ve.length;oe+=3)Q.push(ve[oe]+re,ve[oe+1],ve[oe+2]);return Q}function pt(ve,re){if(ve.transformed)return ve;var Q,oe,ge,Me=1<<ve.z,$e=ve.x,Re=ve.y;for(Q=0;Q<ve.features.length;Q++){var Ie=ve.features[Q],we=Ie.geometry,Je=Ie.type;if(Ie.geometry=[],1===Je)for(oe=0;oe<we.length;oe+=2)Ie.geometry.push(Mt(we[oe],we[oe+1],re,Me,$e,Re));else for(oe=0;oe<we.length;oe++){var Ae=[];for(ge=0;ge<we[oe].length;ge+=2)Ae.push(Mt(we[oe][ge],we[oe][ge+1],re,Me,$e,Re));Ie.geometry.push(Ae)}}return ve.transformed=!0,ve}function Mt(ve,re,Q,oe,ge,Me){return[Math.round(Q*(ve*oe-ge)),Math.round(Q*(re*oe-Me))]}function hn(ve,re,Q,oe,ge){for(var Me=re===ge.maxZoom?0:ge.tolerance/((1<<re)*ge.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Q,y:oe,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Re=0;Re<ve.length;Re++){$e.numFeatures++,Ur($e,ve[Re],Me,ge);var Ie=ve[Re].minX,we=ve[Re].minY,Je=ve[Re].maxX,Ae=ve[Re].maxY;Ie<$e.minX&&($e.minX=Ie),we<$e.minY&&($e.minY=we),Je>$e.maxX&&($e.maxX=Je),Ae>$e.maxY&&($e.maxY=Ae)}return $e}function Ur(ve,re,Q,oe){var ge=re.geometry,Me=re.type,$e=[];if("Point"===Me||"MultiPoint"===Me)for(var Re=0;Re<ge.length;Re+=3)$e.push(ge[Re]),$e.push(ge[Re+1]),ve.numPoints++,ve.numSimplified++;else if("LineString"===Me)vi($e,ge,ve,Q,!1,!1);else if("MultiLineString"===Me||"Polygon"===Me)for(Re=0;Re<ge.length;Re++)vi($e,ge[Re],ve,Q,"Polygon"===Me,0===Re);else if("MultiPolygon"===Me)for(var Ie=0;Ie<ge.length;Ie++){var we=ge[Ie];for(Re=0;Re<we.length;Re++)vi($e,we[Re],ve,Q,!0,0===Re)}if($e.length){var Je=re.tags||null;if("LineString"===Me&&oe.lineMetrics){for(var Ae in Je={},re.tags)Je[Ae]=re.tags[Ae];Je.mapbox_clip_start=ge.start/ge.size,Je.mapbox_clip_end=ge.end/ge.size}var Ne={geometry:$e,type:"Polygon"===Me||"MultiPolygon"===Me?3:"LineString"===Me||"MultiLineString"===Me?2:1,tags:Je};null!==re.id&&(Ne.id=re.id),ve.features.push(Ne)}}function vi(ve,re,Q,oe,ge,Me){var $e=oe*oe;if(oe>0&&re.size<(ge?$e:oe))Q.numPoints+=re.length/3;else{for(var Re=[],Ie=0;Ie<re.length;Ie+=3)(0===oe||re[Ie+2]>$e)&&(Q.numSimplified++,Re.push(re[Ie]),Re.push(re[Ie+1])),Q.numPoints++;ge&&function(we,Je){for(var Ae=0,Ne=0,ft=we.length,Vt=ft-2;Ne<ft;Vt=Ne,Ne+=2)Ae+=(we[Ne]-we[Vt])*(we[Ne+1]+we[Vt+1]);if(Ae>0===Je)for(Ne=0,ft=we.length;Ne<ft/2;Ne+=2){var Rt=we[Ne],Mn=we[Ne+1];we[Ne]=we[ft-2-Ne],we[Ne+1]=we[ft-1-Ne],we[ft-2-Ne]=Rt,we[ft-1-Ne]=Mn}}(Re,Me),ve.push(Re)}}function $r(ve,re){var Q=(re=this.options=function(ge,Me){for(var $e in Me)ge[$e]=Me[$e];return ge}(Object.create(this.options),re)).debug;if(Q&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge,Me,$e,Re,Ie,we,oe=function(ge,Me){var $e=[];if("FeatureCollection"===ge.type)for(var Re=0;Re<ge.features.length;Re++)Or($e,ge.features[Re],Me,Re);else Or($e,"Feature"===ge.type?ge:{geometry:ge},Me);return $e}(ve,re);this.tiles={},this.tileCoords=[],Q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=ge=oe,Ie=mr(ge,1,-1-($e=(Me=re).buffer/Me.extent),$e,0,-1,2,Me),we=mr(ge,1,1-$e,2+$e,0,-1,2,Me),(Ie||we)&&(Re=mr(ge,1,-$e,1+$e,0,-1,2,Me)||[],Ie&&(Re=Bt(Ie,1).concat(Re)),we&&(Re=Re.concat(Bt(we,-1)))),(oe=Re).length&&this.splitTile(oe,0,0,0),Q&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ci(ve,re,Q){return 32*((1<<ve)*Q+re)+ve}function qn(ve,re){const Q=ve.tileID.canonical;if(!this._geoJSONIndex)return re(null,null);const oe=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!oe)return re(null,null);const ge=new class{constructor($e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=$e.length,this._features=$e}feature($e){return new class{constructor(Re){this._feature=Re,this.extent=m.EXTENT,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(1===this._feature.type){const Re=[];for(const Ie of this._feature.geometry)Re.push([new m.Point(Ie[0],Ie[1])]);return Re}{const Re=[];for(const Ie of this._feature.geometry){const we=[];for(const Je of Ie)we.push(new m.Point(Je[0],Je[1]));Re.push(we)}return Re}}toGeoJSON(Re,Ie,we){return He.call(this,Re,Ie,we)}}(this._features[$e])}}(oe.features);let Me=bn(ge);0===Me.byteOffset&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),re(null,{vectorTile:ge,rawData:Me.buffer})}$r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$r.prototype.splitTile=function(ve,re,Q,oe,ge,Me,$e){for(var Re=[ve,re,Q,oe],Ie=this.options,we=Ie.debug;Re.length;){oe=Re.pop(),Q=Re.pop(),re=Re.pop(),ve=Re.pop();var Je=1<<re,Ae=ci(re,Q,oe),Ne=this.tiles[Ae];if(!Ne&&(we>1&&console.time("creation"),Ne=this.tiles[Ae]=hn(ve,re,Q,oe,Ie),this.tileCoords.push({z:re,x:Q,y:oe}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,Q,oe,Ne.numFeatures,Ne.numPoints,Ne.numSimplified),console.timeEnd("creation"));var ft="z"+re;this.stats[ft]=(this.stats[ft]||0)+1,this.total++}if(Ne.source=ve,ge){if(re===Ie.maxZoom||re===ge)continue;var Vt=1<<ge-re;if(Q!==Math.floor(Me/Vt)||oe!==Math.floor($e/Vt))continue}else if(re===Ie.indexMaxZoom||Ne.numPoints<=Ie.indexMaxPoints)continue;if(Ne.source=null,0!==ve.length){we>1&&console.time("clipping");var Rt,Mn,ar,wr,Hr,Li,$i=.5*Ie.buffer/Ie.extent,Wr=.5-$i,_r=.5+$i,Bs=1+$i;Rt=Mn=ar=wr=null,Hr=mr(ve,Je,Q-$i,Q+_r,0,Ne.minX,Ne.maxX,Ie),Li=mr(ve,Je,Q+Wr,Q+Bs,0,Ne.minX,Ne.maxX,Ie),ve=null,Hr&&(Rt=mr(Hr,Je,oe-$i,oe+_r,1,Ne.minY,Ne.maxY,Ie),Mn=mr(Hr,Je,oe+Wr,oe+Bs,1,Ne.minY,Ne.maxY,Ie),Hr=null),Li&&(ar=mr(Li,Je,oe-$i,oe+_r,1,Ne.minY,Ne.maxY,Ie),wr=mr(Li,Je,oe+Wr,oe+Bs,1,Ne.minY,Ne.maxY,Ie),Li=null),we>1&&console.timeEnd("clipping"),Re.push(Rt||[],re+1,2*Q,2*oe),Re.push(Mn||[],re+1,2*Q,2*oe+1),Re.push(ar||[],re+1,2*Q+1,2*oe),Re.push(wr||[],re+1,2*Q+1,2*oe+1)}}},$r.prototype.getTile=function(ve,re,Q){var oe=this.options,ge=oe.extent,Me=oe.debug;if(ve<0||ve>24)return null;var $e=1<<ve,Re=ci(ve,re=(re%$e+$e)%$e,Q);if(this.tiles[Re])return pt(this.tiles[Re],ge);Me>1&&console.log("drilling down to z%d-%d-%d",ve,re,Q);for(var Ie,we=ve,Je=re,Ae=Q;!Ie&&we>0;)we--,Je=Math.floor(Je/2),Ae=Math.floor(Ae/2),Ie=this.tiles[ci(we,Je,Ae)];return Ie&&Ie.source?(Me>1&&console.log("found parent tile z%d-%d-%d",we,Je,Ae),Me>1&&console.time("drilling down"),this.splitTile(Ie.source,we,Je,Ae,ve,re,Q),Me>1&&console.timeEnd("drilling down"),this.tiles[Re]?pt(this.tiles[Re],ge):null):null};class Fs extends m.VectorTileWorkerSource{constructor(re,Q,oe,ge,Me){super(re,Q,oe,ge,qn),Me&&(this.loadGeoJSON=Me)}loadData(re,Q){const oe=re&&re.request,ge=oe&&oe.collectResourceTiming;this.loadGeoJSON(re,(Me,$e)=>{if(Me||!$e)return Q(Me);if("object"!=typeof $e)return Q(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{me($e,!0);try{if(re.filter){const Ie=m.createExpression(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ie.result)throw new Error(Ie.value.map(Je=>`${Je.key}: ${Je.message}`).join(", "));$e={type:"FeatureCollection",features:$e.features.filter(Je=>Ie.value.evaluate({zoom:0},Je))}}this._geoJSONIndex=re.cluster?new Qe(function({superclusterOptions:Ie,clusterProperties:we}){if(!we||!Ie)return Ie;const Je={},Ae={},Ne={accumulated:null,zoom:0},ft={properties:null},Vt=Object.keys(we);for(const Rt of Vt){const[Mn,ar]=we[Rt],wr=m.createExpression(ar),Hr=m.createExpression("string"==typeof Mn?[Mn,["accumulated"],["get",Rt]]:Mn);Je[Rt]=wr.value,Ae[Rt]=Hr.value}return Ie.map=Rt=>{ft.properties=Rt;const Mn={};for(const ar of Vt)Mn[ar]=Je[ar].evaluate(Ne,ft);return Mn},Ie.reduce=(Rt,Mn)=>{ft.properties=Mn;for(const ar of Vt)Ne.accumulated=Rt[ar],Rt[ar]=Ae[ar].evaluate(Ne,ft)},Ie}(re)).load($e.features):new $r(Ie=$e,re.geojsonVtOptions)}catch(Ie){return Q(Ie)}this.loaded={};const Re={};if(ge){const Ie=m.getPerformanceMeasurement(oe);Ie&&(Re.resourceTiming={},Re.resourceTiming[re.source]=JSON.parse(JSON.stringify(Ie)))}Q(null,Re)}var Ie})}reloadTile(re,Q){const oe=this.loaded;return oe&&oe[re.uid]?super.reloadTile(re,Q):this.loadTile(re,Q)}loadGeoJSON(re,Q){if(re.request)m.getJSON(re.request,Q);else{if("string"!=typeof re.data)return Q(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));try{return Q(null,JSON.parse(re.data))}catch{return Q(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(re,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(oe){Q(oe)}}getClusterChildren(re,Q){try{Q(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(oe){Q(oe)}}getClusterLeaves(re,Q){try{Q(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(oe){Q(oe)}}}class Zt{constructor(re){this.self=re,this.actor=new m.Actor(re,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=m.getProjection({name:"mercator"}),this.workerSourceTypes={vector:m.VectorTileWorkerSource,geojson:Fs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Q,oe)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=oe},this.self.registerRTLTextPlugin=Q=>{if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=Q.applyArabicShaping,m.plugin.processBidirectionalText=Q.processBidirectionalText,m.plugin.processStyledBidirectionalText=Q.processStyledBidirectionalText}}clearCaches(re,Q,oe){delete this.layerIndexes[re],delete this.availableImages[re],delete this.workerSources[re],delete this.demWorkerSources[re],oe()}checkIfReady(re,Q,oe){oe()}setReferrer(re,Q){this.referrer=Q}spriteLoaded(re,Q){this.isSpriteLoaded[re]=Q;for(const oe in this.workerSources[re]){const ge=this.workerSources[re][oe];for(const Me in ge)ge[Me]instanceof m.VectorTileWorkerSource&&(ge[Me].isSpriteLoaded=Q,ge[Me].fire(new m.Event("isSpriteLoaded")))}}setImages(re,Q,oe){this.availableImages[re]=Q;for(const ge in this.workerSources[re]){const Me=this.workerSources[re][ge];for(const $e in Me)Me[$e].availableImages=Q}oe()}enableTerrain(re,Q,oe){this.terrain=Q,oe()}setProjection(re,Q){this.projections[re]=m.getProjection(Q)}setLayers(re,Q,oe){this.getLayerIndex(re).replace(Q),oe()}updateLayers(re,Q,oe){this.getLayerIndex(re).update(Q.layers,Q.removedIds),oe()}loadTile(re,Q,oe){const ge=this.enableTerrain?m.extend({enableTerrain:this.terrain},Q):Q;ge.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,Q.type,Q.source).loadTile(ge,oe)}loadDEMTile(re,Q,oe){const ge=this.enableTerrain?m.extend({buildQuadTree:this.terrain},Q):Q;this.getDEMWorkerSource(re,Q.source).loadTile(ge,oe)}reloadTile(re,Q,oe){const ge=this.enableTerrain?m.extend({enableTerrain:this.terrain},Q):Q;ge.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,Q.type,Q.source).reloadTile(ge,oe)}abortTile(re,Q,oe){this.getWorkerSource(re,Q.type,Q.source).abortTile(Q,oe)}removeTile(re,Q,oe){this.getWorkerSource(re,Q.type,Q.source).removeTile(Q,oe)}removeSource(re,Q,oe){if(!this.workerSources[re]||!this.workerSources[re][Q.type]||!this.workerSources[re][Q.type][Q.source])return;const ge=this.workerSources[re][Q.type][Q.source];delete this.workerSources[re][Q.type][Q.source],void 0!==ge.removeSource?ge.removeSource(Q,oe):oe()}loadWorkerSource(re,Q,oe){try{this.self.importScripts(Q.url),oe()}catch(ge){oe(ge.toString())}}syncRTLPluginState(re,Q,oe){try{m.plugin.setState(Q);const ge=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&null!=ge){this.self.importScripts(ge);const Me=m.plugin.isParsed();oe(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ge}`),Me)}}catch(ge){oe(ge.toString())}}getAvailableImages(re){let Q=this.availableImages[re];return Q||(Q=[]),Q}getLayerIndex(re){let Q=this.layerIndexes[re];return Q||(Q=this.layerIndexes[re]=new Be),Q}getWorkerSource(re,Q,oe){return this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][Q]||(this.workerSources[re][Q]={}),this.workerSources[re][Q][oe]||(this.workerSources[re][Q][oe]=new this.workerSourceTypes[Q]({send:(Me,$e,Re,Ie,we,Je)=>{this.actor.send(Me,$e,Re,re,we,Je)},scheduler:this.actor.scheduler},this.getLayerIndex(re),this.getAvailableImages(re),this.isSpriteLoaded[re])),this.workerSources[re][Q][oe]}getDEMWorkerSource(re,Q){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][Q]||(this.demWorkerSources[re][Q]=new Ve),this.demWorkerSources[re][Q]}enforceCacheSizeLimit(re,Q){m.enforceCacheSizeLimit(Q)}getWorkerPerformanceMetrics(re,Q,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Zt(self)),Zt}),z(0,function(m){function ae(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!ae(c[a],n[a]))return!1;return!0}if("object"==typeof c&&null!==c&&null!==n){if("object"!=typeof n||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!ae(c[a],n[a]))return!1;return!0}return c===n}var De=Be;function Be(c){return n=c,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,y,w=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(w);try{y=new Worker(C),p=!0}catch{p=!1}return y&&y.terminate(),URL.revokeObjectURL(C),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var y=p.getContext("2d");if(!y)return!1;var w=y.getImageData(0,0,1,1);return w&&w.width===p.width}()||(void 0===Ve[a=n&&n.failIfMajorPerformanceCaveat]&&(Ve[a]=function(p){var y,C,P,V,w=(C=p,P=document.createElement("canvas"),(V=Object.create(Be.webGLContextAttributes)).failIfMajorPerformanceCaveat=C,P.getContext("webgl",V)||P.getContext("experimental-webgl",V));if(!w)return!1;try{y=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!y||w.isContextLost())&&(w.shaderSource(y,"void main() {}"),w.compileShader(y),!0===w.getShaderParameter(y,w.COMPILE_STATUS))}(a)),!Ve[a]||document.documentMode));var n,a}var Ve={};function xe(c,n,a){const p=m.window.document.createElement(c);return void 0!==n&&(p.className=n),a&&a.appendChild(p),p}function se(c,n,a){const p=m.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const y of Object.keys(n))p.setAttributeNS(null,y,n[y]);return a&&a.appendChild(p),p}Be.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const me=m.window.document&&m.window.document.documentElement.style,He=me&&void 0!==me.userSelect?"userSelect":"WebkitUserSelect";let qe;function Oe(){me&&He&&(qe=me[He],me[He]="none")}function je(){me&&He&&(me[He]=qe)}function ht(c){c.preventDefault(),c.stopPropagation(),m.window.removeEventListener("click",ht,!0)}function et(){m.window.addEventListener("click",ht,!0),m.window.setTimeout(()=>{m.window.removeEventListener("click",ht,!0)},0)}function ct(c,n){const a=c.getBoundingClientRect();return Xe(c,a,n)}function Ue(c,n){const a=c.getBoundingClientRect(),p=[];for(let y=0;y<n.length;y++)p.push(Xe(c,a,n[y]));return p}function nt(c){return void 0!==m.window.InstallTrigger&&2===c.button&&c.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function Xe(c,n,a){const p=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new m.Point((a.clientX-n.left)*p,(a.clientY-n.top)*p)}function Le(c,n){var a=n[0],p=n[1],y=n[2],w=n[3],C=a*w-y*p;return C?(c[0]=w*(C=1/C),c[1]=-p*C,c[2]=-y*C,c[3]=a*C,c):null}function Te(c){const{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class at extends m.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:p}of this.requestors)this._notify(a,p);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new m.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new m.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new m.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,a){if(!n)return!0;let p=0;for(const y of n){if(y[0]<p||y[1]<y[0]||a<y[1])return!1;p=y[1]}return!0}_validateContent(n,a){return!(n&&(4!==n.length||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let p=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(p=!1);this.isLoaded()||p?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const p={};for(const y of n){this.images[y]||this.fire(new m.Event("styleimagemissing",{id:y}));const w=this.images[y];w?p[y]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!(!w.userImage||!w.userImage.render)}:m.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,p)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],p=this.getImage(n);if(!p)return null;if(a&&a.position.version===p.version)return a.position;if(a)a.position.version=p.version;else{const y={w:p.data.width+2,h:p.data.height+2,x:0,y:0},w=new m.ImagePosition(y,p);this.patterns[n]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture&&this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const w in this.patterns)n.push(this.patterns[w].bin);const{w:a,h:p}=m.potpack(n),y=this.atlasImage;y.resize({width:a||1,height:p||1});for(const w in this.patterns){const{bin:C}=this.patterns[w],P=C.x+1,V=C.y+1,K=this.images[w].data,Y=K.width,ce=K.height;m.RGBAImage.copy(K,y,{x:0,y:0},{x:P,y:V},{width:Y,height:ce}),m.RGBAImage.copy(K,y,{x:0,y:ce-1},{x:P,y:V-1},{width:Y,height:1}),m.RGBAImage.copy(K,y,{x:0,y:0},{x:P,y:V+ce},{width:Y,height:1}),m.RGBAImage.copy(K,y,{x:Y-1,y:0},{x:P-1,y:V},{width:1,height:ce}),m.RGBAImage.copy(K,y,{x:0,y:0},{x:P+Y,y:V},{width:1,height:ce})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const p=this.images[a];Te(p)&&this.updateImage(a,p)}}}const Ze=new m.Properties({anchor:new m.DataConstantProperty(m.spec.light.anchor),position:new class{constructor(){this.specification=m.spec.light.position}possiblyEvaluate(c,n){return function([a,p,y]){const w=m.degToRad(p+90),C=m.degToRad(y);return{x:a*Math.cos(w)*Math.sin(C),y:a*Math.sin(w)*Math.sin(C),z:a*Math.cos(C),azimuthal:p,polar:y}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:m.number(c.x,n.x,a),y:m.number(c.y,n.y,a),z:m.number(c.z,n.z,a),azimuthal:m.number(c.azimuthal,n.azimuthal,a),polar:m.number(c.polar,n.polar,a)}}},color:new m.DataConstantProperty(m.spec.light.color),intensity:new m.DataConstantProperty(m.spec.light.intensity)});class it extends m.Evented{constructor(n){super(),this._transitionable=new m.Transitionable(Ze),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(m.validateLight,n,a))for(const p in n){const y=n[p];m.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),y):this._transitionable.setValue(p,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,p){return(!p||!1!==p.validate)&&m.emitValidationErrors(this,n.call(m.validateStyle,m.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}const Ge=new m.Properties({source:new m.DataConstantProperty(m.spec.terrain.source),exaggeration:new m.DataConstantProperty(m.spec.terrain.exaggeration)});let nn=class extends m.Evented{constructor(c,n){super(),this._transitionable=new m.Transitionable(Ge),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(c){for(const n in c){const a=c[n];m.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),a):this._transitionable.setValue(n,a)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}};function bn(c,n,a,p){const y=m.smoothstep(45,65,a),[w,C]=Cn(c,p),P=m.length(n);let V=1-Math.min(1,Math.exp((P-w)/(C-w)*-6));return V*=V*V,V=Math.min(1,1.00747*V),V*y*c.alpha}function Cn(c,n){const a=.5/Math.tan(.5*n);return[c.range[0]+a,c.range[1]+a]}const qt=new m.Properties({range:new m.DataConstantProperty(m.spec.fog.range),color:new m.DataConstantProperty(m.spec.fog.color),"high-color":new m.DataConstantProperty(m.spec.fog["high-color"]),"space-color":new m.DataConstantProperty(m.spec.fog["space-color"]),"horizon-blend":new m.DataConstantProperty(m.spec.fog["horizon-blend"]),"star-intensity":new m.DataConstantProperty(m.spec.fog["star-intensity"])});class Ht extends m.Evented{constructor(n,a){super(),this._transitionable=new m.Transitionable(qt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a="globe"===n.projection.name,p=m.globeToMercatorTransition(n.zoom),y=this.properties.get("range"),w=[.5,3];return{range:a?[m.number(w[0],y[0],p),m.number(w[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(m.validateFog,n,a)){for(const p of Object.keys(m.spec.fog))n&&void 0===n[p]&&(n[p]=m.spec.fog[p].default);for(const p in n){const y=n[p];m.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),y):this._transitionable.setValue(p,y)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:m.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(p,y,w){const C=m.MercatorCoordinate.fromLngLat(y),P=w.elevation?w.elevation.getAtPointOrZero(C):0,V=[C.x,C.y,P];return m.transformMat4(V,V,w.mercatorFogMatrix),bn(p,V,w.pitch,w._fov)}(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Cn(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,p){return(!p||!1!==p.validate)&&m.emitValidationErrors(this,n.call(m.validateStyle,m.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:m.spec})))}}class lt{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=m.uniqueId();const p=this.workerPool.acquire(this.id);for(let y=0;y<p.length;y++){const w=new lt.Actor(p[y],a,this.id);w.name=`Worker ${y}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,p){m.asyncAll(this.actors,(y,w)=>{y.send(n,a,w)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Ct(c,n,a){return n*(m.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}lt.Actor=m.Actor;class Pt{constructor(n,a,p,y){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,a){let p,y;if(n instanceof m.Point||"number"==typeof n[0]){const w=m.Point.convert(n);p=[w],y=a.isPointAboveHorizon(w)}else{const w=m.Point.convert(n[0]),C=m.Point.convert(n[1]);p=[w,C],y=m.polygonizeBounds(w,C).every(P=>a.isPointAboveHorizon(P))}return new Pt(p,a.getCameraPoint(),y,a)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return m.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new m.Point(1,1)):this.screenBounds[1],y=m.polygonizeBounds(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(y[3]=this.cameraPoint)),m.bufferConvexPolygon(y,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new m.Point(1,1)):this.screenBounds[1],y=m.polygonizeBounds(a,p,n),w=this.cameraPoint.clone();switch(3*((w.y>a.y)+(w.y>p.y))+((w.x>a.x)+(w.x>p.x))){case 0:y[0]=w,y[4]=w.clone();break;case 1:y.splice(1,0,w);break;case 2:y[1]=w;break;case 3:y.splice(4,0,w);break;case 5:y.splice(2,0,w);break;case 6:y[3]=w;break;case 7:y.splice(3,0,w);break;case 8:y[2]=w}return y}containsTile(n,a,p,y=0){const w=n.queryPadding/a._pixelsPerMercatorPixel+1,C=p?this._bufferedCameraMercator(w,a):this._bufferedScreenMercator(w,a);let P=n.tileID.wrap+(C.unwrapped?y:0);const V=C.polygon.map(ot=>m.getTilePoint(n.tileTransform,ot,P));if(!m.polygonIntersectsBox(V,0,0,m.EXTENT,m.EXTENT))return;P=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const K=this.screenGeometryMercator.polygon.map(ot=>m.getTileVec3(n.tileTransform,ot,P)),Y=K.map(ot=>new m.Point(ot[0],ot[1])),ce=a.getFreeCameraOptions().position||new m.MercatorCoordinate(0,0,0),Pe=m.getTileVec3(n.tileTransform,ce,P),Ke=K.map(ot=>{const pe=m.sub(ot,ot,Pe);return m.normalize(pe,pe),new m.Ray(Pe,pe)}),Ye=Ct(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Y,tilespaceRays:Ke,bufferedTilespaceGeometry:V,bufferedTilespaceBounds:(rt=m.getBounds(V),rt.min.x=m.clamp(rt.min.x,0,m.EXTENT),rt.min.y=m.clamp(rt.min.y,0,m.EXTENT),rt.max.x=m.clamp(rt.max.x,0,m.EXTENT),rt.max.y=m.clamp(rt.max.y,0,m.EXTENT),rt),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Ye};var rt}_bufferedScreenMercator(n,a){const p=$t(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y="globe"===a.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(w=>a.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(n,a){const p=$t(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y="globe"===a.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(w=>a.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(n,a){const p=function(w,C){const P=m.multiply([],C.pixelMatrix,C.globeMatrix),V=[0,-m.GLOBE_RADIUS,0,1],K=[0,m.GLOBE_RADIUS,0,1],Y=[0,0,0,1];m.transformMat4$1(V,V,P),m.transformMat4$1(K,K,P),m.transformMat4$1(Y,Y,P);const ce=new m.Point(V[0]/V[3],V[1]/V[3]),Pe=new m.Point(K[0]/K[3],K[1]/K[3]),Ke=m.polygonContainsPoint(w,ce)&&V[3]<Y[3],Ye=m.polygonContainsPoint(w,Pe)&&K[3]<Y[3];if(!Ke&&!Ye)return null;const rt=function(It,tn,Kt){for(let ln=1;ln<It.length;ln++){const rr=Tt(tn.pointCoordinate3D(It[ln-1]).x),cn=Tt(tn.pointCoordinate3D(It[ln]).x);if(Kt<0){if(rr<cn)return{idx:ln,t:-rr/(cn-1-rr)}}else if(cn<rr)return{idx:ln,t:(1-rr)/(cn+1-rr)}}return null}(w,C,Ke?-1:1);if(!rt)return null;const{idx:ot,t:pe}=rt;let he=ot>1?Qe(w.slice(0,ot),C):[],gt=ot<w.length?Qe(w.slice(ot),C):[];he=he.map(It=>new m.Point(Tt(It.x),It.y)),gt=gt.map(It=>new m.Point(Tt(It.x),It.y));const mt=[...he];0===mt.length&&mt.push(gt[gt.length-1]);const Ut=m.number(mt[mt.length-1].y,(0===gt.length?he[0]:gt[0]).y,pe);let jt;return jt=Ke?[new m.Point(0,Ut),new m.Point(0,0),new m.Point(1,0),new m.Point(1,Ut)]:[new m.Point(1,Ut),new m.Point(1,1),new m.Point(0,1),new m.Point(0,Ut)],mt.push(...jt),0===gt.length?mt.push(he[0]):mt.push(...gt),{polygon:mt.map(It=>new m.MercatorCoordinate(It.x,It.y)),unwrapped:!1}}(n,a);if(p)return p;const y=function(w,C){let P=!1,V=-1/0,K=0;for(let ce=0;ce<w.length-1;ce++)w[ce].x>V&&(V=w[ce].x,K=ce);for(let ce=0;ce<w.length-1;ce++){const Pe=(K+ce)%(w.length-1),Ke=w[Pe],Ye=w[Pe+1];Math.abs(Ke.x-Ye.x)>.5&&(Ke.x<Ye.x?(Ke.x+=1,0===Pe&&(w[w.length-1].x+=1)):(Ye.x+=1,Pe+1===w.length-1&&(w[0].x+=1)),P=!0)}const Y=m.mercatorXfromLng(C.center.lng);return P&&Y<Math.abs(Y-1)&&w.forEach(ce=>{ce.x-=1}),{polygon:w,unwrapped:P}}(Qe(n,a).map(w=>new m.Point(Tt(w.x),w.y)),a);return{polygon:y.polygon.map(w=>new m.MercatorCoordinate(w.x,w.y)),unwrapped:y.unwrapped}}}function Qe(c,n){return m.resample(c,a=>{const p=n.pointCoordinate3D(a);a.x=p.x,a.y=p.y},1/256)}function Tt(c){return c<0?1+c%1:c%1}function $t(c){return 100*c|0}function Qt(c,n,a,p,y){const w=function(C,P){if(C)return y(C);if(P){c.url&&P.tiles&&c.tiles&&delete c.tiles;const V=m.pick(m.extend(P,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(V.vectorLayers=P.vector_layers,V.vectorLayerIds=V.vectorLayers.map(K=>K.id)),V.tiles=n.canonicalizeTileset(V,c.url),y(null,V)}};return c.url?m.getJSON(n.transformRequest(n.normalizeSourceURL(c.url,null,a,p),m.ResourceType.Source),w):m.exported.frame(()=>w(null,c))}class sn{constructor(n,a,p){this.bounds=m.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),p=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*a),y=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*a),w=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*a),C=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=p&&n.x<w&&n.y>=y&&n.y<C}}class mn{constructor(n,a,p){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fr{constructor(n,a,p,y){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=y,this.context=n;const w=n.gl;this.buffer=w.createBuffer(),n.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let p=0;p<this.attributes.length;p++){const y=a.attributes[this.attributes[p].name];void 0!==y&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,a,p){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],C=a.attributes[w.name];void 0!==C&&n.vertexAttribPointer(C,w.components,n[Vn[w.type]],!1,this.itemSize,w.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ot{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class on extends Ot{getDefault(){return m.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Or extends Ot{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class jr extends Ot{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ur extends Ot{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ai extends Ot{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ri extends Ot{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class nr extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class mr extends Ot{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Er extends Ot{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Zn extends Ot{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class us extends Ot{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class Hn extends Ot{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Sr extends Ot{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class kr extends Ot{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Gt extends Ot{getDefault(){return m.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Bt extends Ot{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Ce extends Ot{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class pt extends Ot{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Mt extends Ot{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let hn,Ur=class extends Ot{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class vi extends Ot{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class $r extends Ot{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ci extends Ot{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class qn extends Ot{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Fs extends Ot{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Zt extends Ot{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ve extends Ot{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class re extends Ot{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Q extends Ot{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class oe extends Ot{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ge extends Ot{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Me extends Ot{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class $e extends Me{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Re extends Me{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ie extends Re{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class we{constructor(n,a,p,y){this.context=n,this.width=a,this.height=p;const w=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new $e(n,w),y&&(this.depthAttachment=new Re(n,w))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const p=this.depthAttachment.get();p&&n.deleteRenderbuffer(p)}n.deleteFramebuffer(this.framebuffer)}}class Je{constructor(n,a=!1){if(this.gl=n,this.isWebGL2=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),a){const p=n;this.extVertexArrayObject={createVertexArrayOES:p.createVertexArray.bind(n),deleteVertexArrayOES:p.deleteVertexArray.bind(n),bindVertexArrayOES:p.bindVertexArray.bind(n)}}this.clearColor=new on(this),this.clearDepth=new Or(this),this.clearStencil=new jr(this),this.colorMask=new ur(this),this.depthMask=new Ai(this),this.stencilMask=new Ri(this),this.stencilFunc=new nr(this),this.stencilOp=new mr(this),this.stencilTest=new Er(this),this.depthRange=new Zn(this),this.depthTest=new us(this),this.depthFunc=new Hn(this),this.blend=new Sr(this),this.blendFunc=new kr(this),this.blendColor=new Gt(this),this.blendEquation=new Bt(this),this.cullFace=new Ce(this),this.cullFaceSide=new pt(this),this.frontFace=new Mt(this),this.program=new Ur(this),this.activeTexture=new vi(this),this.viewport=new $r(this),this.bindFramebuffer=new ci(this),this.bindRenderbuffer=new qn(this),this.bindTexture=new Fs(this),this.bindVertexBuffer=new Zt(this),this.bindElementBuffer=new ve(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new re(this),this.pixelStoreUnpack=new Q(this),this.pixelStoreUnpackPremultiplyAlpha=new oe(this),this.pixelStoreUnpackFlipY=new ge(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),a||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(a||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new mn(this,n,a)}createVertexBuffer(n,a,p){return new Fr(this,n,a,p)}createRenderbuffer(n,a,p){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,n,a,p),this.bindRenderbuffer.set(null),w}createFramebuffer(n,a,p){return new we(this,n,a,p)}clear({color:n,depth:a,stencil:p}){const y=this.gl;let w=0;n&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==a&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),void 0!==p&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),y.clear(w)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){ae(n.blendFunction,m.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ae extends m.Evented{constructor(n,a,p,y){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(a,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new m.DedupedRequest}load(n){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Qt(this._options,this.map._requestManager,a,p,(y,w)=>{this._tileJSONRequest=null,this._loaded=!0,y?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),p&&2!==p.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new m.ErrorEvent(y))):w&&(m.extend(this,w),w.bounds&&(this.tileBounds=new sn(w.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return m.extend({},this._options)}loadTile(n,a){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(p,m.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,n.actor&&"expired"!==n.state)"loading"===n.state?n.reloadCallback=a:n.request=n.actor.send("reloadTile",y,w.bind(this));else if(n.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",y,w.bind(this),void 0,!0);else{const C=m.loadVectorTile.call({deduped:this._deduped},y,(P,V)=>{P||!V?w.call(this,P):(y.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},n.actor&&n.actor.send("loadTile",y,w.bind(this),void 0,!0))},!0);n.request={cancel:C}}function w(C,P){return delete n.request,n.aborted?a(null):C&&404!==C.status?a(C):(P&&P.resourceTiming&&(n.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&n.setExpiryData(P),n.loadVectorData(P,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ne extends m.Evented{constructor(n,a,p,y){super(),this.id=n,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},a),m.extend(this,m.pick(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qt(this._options,this.map._requestManager,null,null,(a,p)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new m.ErrorEvent(a)):p&&(m.extend(this,p),p.bounds&&(this.tileBounds=new sn(p.bounds,this.minzoom,this.maxzoom)),m.postTurnstileEvent(p.tiles),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return m.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const p=m.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=m.getImage(this.map._requestManager.transformRequest(y,m.ResourceType.Tile),(w,C,P,V)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):w?(n.state="errored",a(w)):C?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:P,expires:V}),n.setTexture(C,this.map.painter),n.state="loaded",m.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(n,a,p){n.setTexture(a,p)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ft(c,n,a,p,y,w,C,P){const V=[c,a,y,n,p,w,1,1,1],K=[C,P,1],Y=m.adjoint([],V),[ce,Pe,Ke]=m.transformMat3(K,K,m.transpose(Y,Y));return m.multiply$1(V,[ce,0,0,0,Pe,0,0,0,Ke],V)}class Vt extends m.Evented{constructor(n,a,p,y){super(),this.id=n,this.dispatcher=p,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=a,this._dirty=!1}load(n,a){this._loaded=a||!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),(p,y)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new m.ErrorEvent(p));else if(y){const{HTMLImageElement:w}=m.window;this.image=y instanceof w?m.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(m.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let y=1/0,w=1/0,C=-1/0,P=-1/0;for(const ce of p)y=Math.min(y,ce.x),w=Math.min(w,ce.y),C=Math.max(C,ce.x),P=Math.max(P,ce.y);const V=Math.max(C-y,P-w),K=Math.max(0,Math.floor(-Math.log(V)/Math.LN2)),Y=Math.pow(2,K);return new m.CanonicalTileID(K,Math.floor((y+C)/2*Y),Math.floor((w+P)/2*Y))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const V in this.tiles){const K=this.tiles[V];"loaded"!==K.state&&(K.state="loaded",K.texture=this.texture)}if(this._boundsArray)return;const a=m.tileTransform(this.tileID,this.map.transform.projection),[p,y,w,C]=this.coordinates.map(V=>{const K=a.projection.project(V[0],V[1]);return m.getTilePoint(a,K)._round()});this.perspectiveTransform=function(V,K,Y,ce,Pe,Ke,Ye,rt,ot,pe){const he=ft(0,0,V,0,0,K,V,K),gt=ft(Y,ce,Pe,Ke,Ye,rt,ot,pe);return m.multiply$1(gt,m.adjoint(he,he),gt),[gt[6]/gt[8]*V/m.EXTENT,gt[7]/gt[8]*K/m.EXTENT]}(this.width,this.height,p.x,p.y,y.x,y.y,C.x,C.y,w.x,w.y);const P=this._boundsArray=new m.StructArrayLayout4i8;P.emplaceBack(p.x,p.y,0,0),P.emplaceBack(y.x,y.y,m.EXTENT,0),P.emplaceBack(C.x,C.y,0,m.EXTENT),P.emplaceBack(w.x,w.y,m.EXTENT,m.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(P,m.boundsAttributes.members),this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,a=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new m.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Rt={vector:Ae,raster:Ne,"raster-dem":class extends Ne{constructor(c,n,a,p){super(c,n,a,p),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,w){y&&(c.state="errored",n(y)),w&&(c.dem=w,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=m.getImage(this.map._requestManager.transformRequest(a,m.ResourceType.Tile),function(y,w,C,P){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(y)c.state="errored",n(y);else if(w){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:C,expires:P});const V=m.window.ImageBitmap&&w instanceof m.window.ImageBitmap&&(null==hn&&(hn=m.window.OffscreenCanvas&&new m.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof m.window.createImageBitmap),hn),K=1-(w.width-m.prevPowerOfTwo(w.width))/2;K<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const Y=V?w:m.exported.getImageData(w,K),ce={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:Y,encoding:this.encoding,padding:K};c.actor&&"expired"!==c.state||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",ce,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const n=c.canonical,a=Math.pow(2,n.z),p=(n.x-1+a)%a,y=0===n.x?c.wrap-1:c.wrap,w=(n.x+1+a)%a,C=n.x+1===a?c.wrap+1:c.wrap,P={};return P[new m.OverscaledTileID(c.overscaledZ,y,n.z,p,n.y).key]={backfilled:!1},P[new m.OverscaledTileID(c.overscaledZ,C,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(P[new m.OverscaledTileID(c.overscaledZ,y,n.z,p,n.y-1).key]={backfilled:!1},P[new m.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},P[new m.OverscaledTileID(c.overscaledZ,C,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<a&&(P[new m.OverscaledTileID(c.overscaledZ,y,n.z,p,n.y+1).key]={backfilled:!1},P[new m.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},P[new m.OverscaledTileID(c.overscaledZ,C,n.z,w,n.y+1).key]={backfilled:!1}),P}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends m.Evented{constructor(c,n,a,p){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=n.data,this._options=m.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*y,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*y,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:m.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},n),this}getClusterLeaves(c,n,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:n,offset:a},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new m.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=m.extend({},this.workerOptions),n=this._data;"string"==typeof n?(c.request=this.map._requestManager.transformRequest(m.exported.resolveURL(n),m.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,p)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new m.ErrorEvent(a));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y.resourceTiming=p.resourceTiming[this.id]),this.fire(new m.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,y)=>(delete c.request,c.unloadVectorData(),c.aborted?n(null):p?n(p):(c.loadVectorData(y,this.map.painter,"reloadTile"===a),n(null))),void 0,"loadTile"===a)}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return m.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Vt{constructor(c,n,a,p){super(c,n,a,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,m.ResourceType.Source).url);m.getVideo(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new m.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Vt,canvas:class extends Vt{constructor(c,n,a,p){super(c,n,a,p),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(w=>"number"!=typeof w))||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends m.Evented{constructor(c,n,a,p){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new m.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new m.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new sn(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),m.extend(this,m.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return m.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:n,y:a,z:p}=c.canonical;return this._implementation.hasTile({x:n,y:a,z:p})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){const{x:a,y:p,z:y}=c.tileID.canonical,w=new m.window.AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:a,y:p,z:y},{signal:w.signal})).then(function(C){return delete c.request,c.aborted?(c.state="unloaded",n(null)):void 0===C?(c.state="errored",n(null)):null===C?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null)):(P=C)instanceof m.window.ImageData||P instanceof m.window.HTMLCanvasElement||P instanceof m.window.ImageBitmap||P instanceof m.window.HTMLImageElement?(this.loadTileData(c,C),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var P}.bind(this)).catch(C=>{20!==C.code&&(c.state="errored",n(C))}),c.request.cancel=()=>w.abort()}loadTileData(c,n){Ne.loadTileData(c,n,this._map.painter)}unloadTileData(c){Ne.unloadTileData(c,this._map.painter)}unloadTile(c,n){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:p,z:y}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:p,z:y})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Mn=function(c,n,a,p){const y=new Rt[n.type](c,n,a,p);if(y.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${y.id}`);return m.bindAll(["load","abort","unload","serialize","prepare"],y),y};function ar(c,n){const a=m.identity([]);return m.scale(a,a,[.5*c.width,.5*-c.height,1]),m.translate(a,a,[1,-1,0]),m.multiply(a,a,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function wr(c,n,a,p,y,w,C,P=!1){const V=c.tilesIn(p,C,P);V.sort(Li);const K=[];for(const ce of V)K.push({wrappedTileID:ce.tile.tileID.wrapped().key,queryResults:ce.tile.queryRenderedFeatures(n,a,c._state,ce,y,w,ar(c.transform,ce.tile.tileID),P)});const Y=function(ce){const Pe={},Ke={};for(const Ye of ce){const rt=Ye.queryResults,ot=Ye.wrappedTileID,pe=Ke[ot]=Ke[ot]||{};for(const he in rt){const gt=rt[he],mt=pe[he]=pe[he]||{},Ut=Pe[he]=Pe[he]||[];for(const jt of gt)mt[jt.featureIndex]||(mt[jt.featureIndex]=!0,Ut.push(jt))}}return Pe}(K);for(const ce in Y)Y[ce].forEach(Pe=>{const Ke=Pe.feature,Ye=Ke.layer;Ye&&"background"!==Ye.type&&"sky"!==Ye.type&&(Ke.source=Ye.source,Ye["source-layer"]&&(Ke.sourceLayer=Ye["source-layer"]),Ke.state=void 0!==Ke.id?c.getFeatureState(Ye["source-layer"],Ke.id):{})});return Y}function Hr(c,n){const a=c.getRenderableIds().map(w=>c.getTileByID(w)),p=[],y={};for(let w=0;w<a.length;w++){const C=a[w],P=C.tileID.canonical.key;y[P]||(y[P]=!0,C.querySourceFeatures(p,n))}return p}function Li(c,n){const a=c.tileID,p=n.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function $i(){return null!=Z.workerClass?new Z.workerClass:new m.window.Worker(Z.workerUrl)}const Wr="mapboxgl_preloaded_worker_pool";class _r{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<_r.workerCount;)this.workers.push(new $i);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Wr]}numActive(){return Object.keys(this.active).length}}let Bs;function ra(){return Bs||(Bs=new _r),Bs}function wa(c,n){const a={};for(const p in c)"ref"!==p&&(a[p]=c[p]);return m.refProperties.forEach(p=>{p in n&&(a[p]=n[p])}),a}function In(c){c=c.slice();const n=Object.create(null);for(let a=0;a<c.length;a++)n[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=wa(c[a],n[c[a].ref]));return c}_r.workerCount=2;const Jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Sn(c,n,a){a.push({command:Jt.addSource,args:[c,n[c]]})}function Gr(c,n,a){n.push({command:Jt.removeSource,args:[c]}),a[c]=!0}function gi(c,n,a,p){Gr(c,a,p),Sn(c,n,a)}function Ii(c,n,a){let p;for(p in c[a])if(c[a].hasOwnProperty(p)&&"data"!==p&&!ae(c[a][p],n[a][p]))return!1;for(p in n[a])if(n[a].hasOwnProperty(p)&&"data"!==p&&!ae(c[a][p],n[a][p]))return!1;return!0}function ki(c,n,a,p,y,w){let C;for(C in n=n||{},c=c||{})c.hasOwnProperty(C)&&(ae(c[C],n[C])||a.push({command:w,args:[p,C,n[C],y]}));for(C in n)n.hasOwnProperty(C)&&!c.hasOwnProperty(C)&&(ae(c[C],n[C])||a.push({command:w,args:[p,C,n[C],y]}))}function ws(c){return c.id}function _i(c,n){return c[n.id]=n,c}class ut{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=m.clamp(n,0,1);let a=1,p=this._distances[a];const y=n*this.paddedLength+this.padding;for(;p<y&&a<this._distances.length;)p=this._distances[++a];const w=a-1,C=this._distances[w],P=p-C,V=P>0?(y-C)/P:0;return this.points[w].mult(1-V).add(this.points[a].mult(V))}}class Dt{constructor(n,a,p){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(a/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,p,y,w){this._forEachCell(a,p,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(n,a,p,y){this._forEachCell(a-y,p-y,a+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(p),this.circles.push(y)}_insertBoxCell(n,a,p,y,w,C){this.boxCells[w].push(C)}_insertCircleCell(n,a,p,y,w,C){this.circleCells[w].push(C)}_query(n,a,p,y,w,C){if(p<0||n>this.width||y<0||a>this.height)return!w&&[];const P=[];if(n<=0&&a<=0&&this.width<=p&&this.height<=y){if(w)return!0;for(let V=0;V<this.boxKeys.length;V++)P.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const K=this.circles[3*V],Y=this.circles[3*V+1],ce=this.circles[3*V+2];P.push({key:this.circleKeys[V],x1:K-ce,y1:Y-ce,x2:K+ce,y2:Y+ce})}return C?P.filter(C):P}return this._forEachCell(n,a,p,y,this._queryCell,P,{hitTest:w,seenUids:{box:{},circle:{}}},C),w?P.length>0:P}_queryCircle(n,a,p,y,w){const C=n-p,P=n+p,V=a-p,K=a+p;if(P<0||C>this.width||K<0||V>this.height)return!y&&[];const Y=[];return this._forEachCell(C,V,P,K,this._queryCellCircle,Y,{hitTest:y,circle:{x:n,y:a,radius:p},seenUids:{box:{},circle:{}}},w),y?Y.length>0:Y}query(n,a,p,y,w){return this._query(n,a,p,y,!1,w)}hitTest(n,a,p,y,w){return this._query(n,a,p,y,!0,w)}hitTestCircle(n,a,p,y){return this._queryCircle(n,a,p,!0,y)}_queryCell(n,a,p,y,w,C,P,V){const K=P.seenUids,Y=this.boxCells[w];if(null!==Y){const Pe=this.bboxes;for(const Ke of Y)if(!K.box[Ke]){K.box[Ke]=!0;const Ye=4*Ke;if(n<=Pe[Ye+2]&&a<=Pe[Ye+3]&&p>=Pe[Ye+0]&&y>=Pe[Ye+1]&&(!V||V(this.boxKeys[Ke]))){if(P.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Ke],x1:Pe[Ye],y1:Pe[Ye+1],x2:Pe[Ye+2],y2:Pe[Ye+3]})}}}const ce=this.circleCells[w];if(null!==ce){const Pe=this.circles;for(const Ke of ce)if(!K.circle[Ke]){K.circle[Ke]=!0;const Ye=3*Ke;if(this._circleAndRectCollide(Pe[Ye],Pe[Ye+1],Pe[Ye+2],n,a,p,y)&&(!V||V(this.circleKeys[Ke]))){if(P.hitTest)return C.push(!0),!0;{const rt=Pe[Ye],ot=Pe[Ye+1],pe=Pe[Ye+2];C.push({key:this.circleKeys[Ke],x1:rt-pe,y1:ot-pe,x2:rt+pe,y2:ot+pe})}}}}}_queryCellCircle(n,a,p,y,w,C,P,V){const K=P.circle,Y=P.seenUids,ce=this.boxCells[w];if(null!==ce){const Ke=this.bboxes;for(const Ye of ce)if(!Y.box[Ye]){Y.box[Ye]=!0;const rt=4*Ye;if(this._circleAndRectCollide(K.x,K.y,K.radius,Ke[rt+0],Ke[rt+1],Ke[rt+2],Ke[rt+3])&&(!V||V(this.boxKeys[Ye])))return C.push(!0),!0}}const Pe=this.circleCells[w];if(null!==Pe){const Ke=this.circles;for(const Ye of Pe)if(!Y.circle[Ye]){Y.circle[Ye]=!0;const rt=3*Ye;if(this._circlesCollide(Ke[rt],Ke[rt+1],Ke[rt+2],K.x,K.y,K.radius)&&(!V||V(this.circleKeys[Ye])))return C.push(!0),!0}}}_forEachCell(n,a,p,y,w,C,P,V){const K=this._convertToXCellCoord(n),Y=this._convertToYCellCoord(a),ce=this._convertToXCellCoord(p),Pe=this._convertToYCellCoord(y);for(let Ke=K;Ke<=ce;Ke++)for(let Ye=Y;Ye<=Pe;Ye++)if(w.call(this,n,a,p,y,this.xCellCount*Ye+Ke,C,P,V))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,p,y,w,C){const P=y-n,V=w-a,K=p+C;return K*K>P*P+V*V}_circleAndRectCollide(n,a,p,y,w,C,P){const V=(C-y)/2,K=Math.abs(n-(y+V));if(K>V+p)return!1;const Y=(P-w)/2,ce=Math.abs(a-(w+Y));if(ce>Y+p)return!1;if(K<=V||ce<=Y)return!0;const Pe=K-V,Ke=ce-Y;return Pe*Pe+Ke*Ke<=p*p}}const Nt={unknown:0,flipRequired:1,flipNotRequired:2},wn=Math.tan(85*Math.PI/180);function bt(c,n,a,p,y,w,C){const P=m.create();if(a)if("globe"===w.name){const V=m.calculateGlobeLabelMatrix(y,n);m.multiply(P,P,V)}else{const V=Le([],C);P[0]=V[0],P[1]=V[1],P[4]=V[2],P[5]=V[3],p||m.rotateZ(P,P,y.angle)}else m.multiply(P,y.labelPlaneMatrix,c);return P}function On(c,n,a,p,y,w,C){const P=bt(c,n,a,p,y,w,C);return"globe"===w.name&&a||(P[2]=P[6]=P[10]=P[14]=0),P}function sr(c,n,a,p,y,w,C){if(a){if("globe"===w.name){const P=bt(c,n,a,p,y,w,C);return m.invert(P,P),m.multiply(P,c,P),P}{const P=m.clone(c),V=m.identity([]);return V[0]=C[0],V[1]=C[1],V[4]=C[2],V[5]=C[3],m.multiply(P,P,V),p||m.rotateZ(P,P,-y.angle),P}}return y.glCoordMatrix}function ei(c,n,a,p){const y=[c,n,a,1];a?m.transformMat4$1(y,y,p):br(y,y,p);const w=y[3];return y[0]/=w,y[1]/=w,y[2]/=w,y}function Mr(c,n){return Math.min(.5+c/n*.5,1.5)}function li(c,n){const a=c[0]/c[3],p=c[1]/c[3];return a>=-n[0]&&a<=n[0]&&p>=-n[1]&&p<=n[1]}function xi(c,n,a,p,y,w,C,P,V,K){const Y=a.transform,ce=p?c.textSizeData:c.iconSizeData,Pe=m.evaluateSizeForZoom(ce,a.transform.zoom),Ke="globe"===Y.projection.name,Ye=[256/a.width*2+1,256/a.height*2+1],rt=p?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;rt.clear();let ot=null;Ke&&(ot=p?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const pe=c.lineVertexArray,he=p?c.text.placedSymbolArray:c.icon.placedSymbolArray,gt=a.transform.width/a.transform.height;let mt,Ut=!1;for(let jt=0;jt<he.length;jt++){const It=he.get(jt),{numGlyphs:tn,writingMode:Kt}=It;if(Kt!==m.WritingMode.vertical||Ut||mt===m.WritingMode.horizontal||(Ut=!0),mt=Kt,(It.hidden||Kt===m.WritingMode.vertical)&&!Ut){_s(tn,rt);continue}Ut=!1;const ln=new m.Point(It.tileAnchorX,It.tileAnchorY);let{x:rr,y:cn,z:Dn}=Y.projection.projectTilePoint(ln.x,ln.y,K.canonical);if(V){const[bi,Br,R]=V(ln);rr+=bi,cn+=Br,Dn+=R}const an=[rr,cn,Dn,1];if(m.transformMat4$1(an,an,n),!li(an,Ye)){_s(tn,rt);continue}const Kn=Mr(a.transform.cameraToCenterDistance,an[3]),dn=m.evaluateSizeForFeature(ce,Pe,It),Ln=C?dn/Kn:dn*Kn,Nn=ei(rr,cn,Dn,y);if(Nn[3]<=0){_s(tn,rt);continue}let Wn={};const Yn=C?null:V,Xr=gr(It,Ln,!1,P,n,y,w,c.glyphOffsetArray,pe,rt,ot,Nn,ln,Wn,gt,Yn,Y.projection,K,C);Ut=Xr.useVertical,Yn&&Xr.needsFlipping&&(Wn={}),(Xr.notEnoughRoom||Ut||Xr.needsFlipping&&gr(It,Ln,!0,P,n,y,w,c.glyphOffsetArray,pe,rt,ot,Nn,ln,Wn,gt,Yn,Y.projection,K,C).notEnoughRoom)&&_s(tn,rt)}p?(c.text.dynamicLayoutVertexBuffer.updateData(rt),ot&&c.text.globeExtVertexBuffer.updateData(ot)):(c.icon.dynamicLayoutVertexBuffer.updateData(rt),ot&&c.icon.globeExtVertexBuffer.updateData(ot))}function Ds(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt){const{lineStartIndex:ot,glyphStartIndex:pe,segment:he}=P,gt=pe+P.numGlyphs,mt=ot+P.lineLength,Ut=n.getoffsetX(pe),jt=n.getoffsetX(gt-1),It=Ci(c*Ut,a,p,y,w,C,he,ot,mt,V,K,Y,ce,Pe,!0,Ke,Ye,rt);if(!It)return null;const tn=Ci(c*jt,a,p,y,w,C,he,ot,mt,V,K,Y,ce,Pe,!0,Ke,Ye,rt);return tn?{first:It,last:tn}:null}function Vs(c,n,a,p){return c===m.WritingMode.horizontal&&Math.abs(p)>Math.abs(a)?{useVertical:!0}:c===m.WritingMode.vertical?p>0?{needsFlipping:!0}:null:n!==Nt.unknown&&(0===(y=a)||Math.abs(p/y)>wn)?n===Nt.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null;var y}function gr(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt,ot,pe,he){const gt=n/24,mt=c.lineOffsetX*gt,Ut=c.lineOffsetY*gt,{lineStartIndex:jt,glyphStartIndex:It,numGlyphs:tn,segment:Kt,writingMode:ln,flipState:rr}=c,cn=jt+c.lineLength,Dn=an=>{if(Y){const[Nn,Wn,Yn]=an.up,Xr=K.length;m.updateGlobeVertexNormal(Y,Xr+0,Nn,Wn,Yn),m.updateGlobeVertexNormal(Y,Xr+1,Nn,Wn,Yn),m.updateGlobeVertexNormal(Y,Xr+2,Nn,Wn,Yn),m.updateGlobeVertexNormal(Y,Xr+3,Nn,Wn,Yn)}const[Kn,dn,Ln]=an.point;m.addDynamicAttributes(K,Kn,dn,Ln,an.angle)};if(tn>1){const an=Ds(gt,P,mt,Ut,a,ce,Pe,c,V,w,Ke,rt,!1,ot,pe,he);if(!an)return{notEnoughRoom:!0};if(p&&!a){let[Kn,dn,Ln]=an.first.point,[Nn,Wn,Yn]=an.last.point;[Kn,dn]=ei(Kn,dn,Ln,C),[Nn,Wn]=ei(Nn,Wn,Yn,C);const Xr=Vs(ln,rr,(Nn-Kn)*Ye,Wn-dn);if(c.flipState=Xr&&Xr.needsFlipping?Nt.flipRequired:Nt.flipNotRequired,Xr)return Xr}Dn(an.first);for(let Kn=It+1;Kn<It+tn-1;Kn++){const dn=Ci(gt*P.getoffsetX(Kn),mt,Ut,a,ce,Pe,Kt,jt,cn,V,w,Ke,rt,!1,!1,ot,pe,he);if(!dn)return K.length-=4*(Kn-It),{notEnoughRoom:!0};Dn(dn)}Dn(an.last)}else{if(p&&!a){const Kn=ei(Pe.x,Pe.y,0,y),dn=jt+Kt+1,Ln=new m.Point(V.getx(dn),V.gety(dn)),Nn=ei(Ln.x,Ln.y,0,y),Wn=Nn[3]>0?Nn:qr(Pe,Ln,Kn,1,y,void 0,ot,pe.canonical),Yn=Vs(ln,rr,(Wn[0]-Kn[0])*Ye,Wn[1]-Kn[1]);if(c.flipState=Yn&&Yn.needsFlipping?Nt.flipRequired:Nt.flipNotRequired,Yn)return Yn}const an=Ci(gt*P.getoffsetX(It),mt,Ut,a,ce,Pe,Kt,jt,cn,V,w,Ke,rt,!1,!1,ot,pe,he);if(!an)return{notEnoughRoom:!0};Dn(an)}return{}}function ti(c,n,a,p,y){const{x:w,y:C,z:P}=p.projectTilePoint(c.x,c.y,n);if(!y)return ei(w,C,P,a);const[V,K,Y]=y(c);return ei(w+V,C+K,P+Y,a)}function qr(c,n,a,p,y,w,C,P){const V=ti(c.sub(n)._unit()._add(c),P,y,C,w);return m.sub(V,a,V),m.normalize(V,V),m.scaleAndAdd(V,a,V,p)}function Ci(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt,ot,pe){const he=p?c-n:c+n;let gt=he>0?1:-1,mt=0;p&&(gt*=-1,mt=Math.PI),gt<0&&(mt+=Math.PI);let Ut=P+C+(gt>0?0:1)|0,jt=y,It=y,tn=0,Kt=0;const ln=Math.abs(he),rr=[],cn=[];let Dn=w,an=Dn;const Kn=()=>qr(an,Dn,It,ln-tn+1,Y,Pe,rt,ot.canonical);for(;tn+Kt<=ln;){if(Ut+=gt,Ut<P||Ut>=V)return null;if(It=jt,an=Dn,rr.push(It),Ke&&cn.push(an),Dn=new m.Point(K.getx(Ut),K.gety(Ut)),jt=ce[Ut],!jt){const R=ti(Dn,ot.canonical,Y,rt,Pe);jt=R[3]>0?ce[Ut]=R:Kn()}tn+=Kt,Kt=m.distance(It,jt)}Ye&&Pe&&(ce[Ut]&&(jt=Kn(),Kt=m.distance(It,jt)),ce[Ut]=jt);const dn=(ln-tn)/Kt,Ln=Dn.sub(an)._mult(dn)._add(an),Nn=m.sub([],jt,It),Wn=m.scaleAndAdd([],It,Nn,dn);let Yn=[0,0,1],Xr=Nn[0],bi=Nn[1];if(pe&&(Yn=rt.upVector(ot.canonical,Ln.x,Ln.y),0!==Yn[0]||0!==Yn[1]||1!==Yn[2])){const R=[Yn[2],0,-Yn[0]],L=m.cross([],Yn,R);m.normalize(R,R),m.normalize(L,L),Xr=m.dot(Nn,R),bi=m.dot(Nn,L)}if(a){const R=m.cross([],Yn,Nn);m.normalize(R,R),m.scaleAndAdd(Wn,Wn,R,a*gt)}const Br=mt+Math.atan2(bi,Xr);return rr.push(Wn),Ke&&cn.push(Ln),{point:Wn,angle:Br,path:rr,tilePath:cn,up:Yn}}function _s(c,n){const a=n.length,p=a+4*c;n.resize(p),n.float32.fill(-1/0,4*a,4*p)}function br(c,n,a){const p=n[0],y=n[1];return c[0]=a[0]*p+a[4]*y+a[12],c[1]=a[1]*p+a[5]*y+a[13],c[3]=a[3]*p+a[7]*y+a[15],c}const Ui=100;class Mo{constructor(n,a,p=new Dt(n.width+200,n.height+200,25),y=new Dt(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ui,this.screenBottomBoundary=n.height+Ui,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,p,y,w,C,P,V){let K=p.projectedAnchorX,Y=p.projectedAnchorY,ce=p.projectedAnchorZ;const Pe=p.elevation,Ke=p.tileID,Ye=n.getProjection();if(Pe&&Ke){const[jt,It,tn]=Ye.upVector(Ke.canonical,p.tileAnchorX,p.tileAnchorY),Kt=Ye.upVectorScale(Ke.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;K+=jt*Pe*Kt,Y+=It*Pe*Kt,ce+=tn*Pe*Kt}const rt=this.projectAndGetPerspectiveRatio(P,K,Y,ce,p.tileID,"globe"===Ye.name||!!Pe||this.transform.pitch>0,Ye),ot=C*rt.perspectiveRatio,pe=(p.x1*a+y.x-p.padding)*ot+rt.point.x,he=(p.y1*a+y.y-p.padding)*ot+rt.point.y,gt=(p.x2*a+y.x+p.padding)*ot+rt.point.x,mt=(p.y2*a+y.y+p.padding)*ot+rt.point.y,Ut=rt.perspectiveRatio<=.55||rt.occluded;return!this.isInsideGrid(pe,he,gt,mt)||!w&&this.grid.hitTest(pe,he,gt,mt,V)||Ut?{box:[],offscreen:!1,occluded:rt.occluded}:{box:[pe,he,gt,mt],offscreen:this.isOffscreen(pe,he,gt,mt),occluded:!1}}placeCollisionCircles(n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt){const ot=[],pe=this.transform.elevation,he=n.getProjection(),gt=pe?pe.getAtTileOffsetFunc(rt,this.transform.center.lat,this.transform.worldSize,he):null,mt=new m.Point(p.tileAnchorX,p.tileAnchorY);let{x:Ut,y:jt,z:It}=he.projectTilePoint(mt.x,mt.y,rt.canonical);if(gt){const[Ln,Nn,Wn]=gt(mt);Ut+=Ln,jt+=Nn,It+=Wn}const tn="globe"===he.name,Kt=this.projectAndGetPerspectiveRatio(P,Ut,jt,It,rt,tn||!!pe||this.transform.pitch>0,he),{perspectiveRatio:ln}=Kt,rr=(ce?C/ln:C*ln)/m.ONE_EM,cn=ei(Ut,jt,It,V),Dn=Kt.signedDistanceFromCamera>0?Ds(rr,w,p.lineOffsetX*rr,p.lineOffsetY*rr,!1,cn,mt,p,y,V,{},pe&&!ce?gt:null,ce&&!!pe,he,rt,ce):null;let an=!1,Kn=!1,dn=!0;if(Dn&&!Kt.occluded){const Ln=.5*Ke*ln+Ye,Nn=new m.Point(-100,-100),Wn=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),Yn=new ut,{first:Xr,last:bi}=Dn,Br=Xr.path.length;let R=[];for(let ee=Br-1;ee>=1;ee--)R.push(Xr.path[ee]);for(let ee=1;ee<bi.path.length;ee++)R.push(bi.path[ee]);const L=2.5*Ln;K&&(R=R.map(([ee,Ee,st],Et)=>(gt&&!tn&&(st=gt(Et<Br-1?Xr.tilePath[Br-1-Et]:bi.tilePath[Et-Br+2])[2]),ei(ee,Ee,st,K))),R.some(ee=>ee[3]<=0)&&(R=[]));let $=[];if(R.length>0){let ee=1/0,Ee=-1/0,st=1/0,Et=-1/0;for(const en of R)ee=Math.min(ee,en[0]),st=Math.min(st,en[1]),Ee=Math.max(Ee,en[0]),Et=Math.max(Et,en[1]);Ee>=Nn.x&&ee<=Wn.x&&Et>=Nn.y&&st<=Wn.y&&($=[R.map(en=>new m.Point(en[0],en[1]))],(ee<Nn.x||Ee>Wn.x||st<Nn.y||Et>Wn.y)&&($=m.clipLine($,Nn.x,Nn.y,Wn.x,Wn.y)))}for(const ee of $){Yn.reset(ee,.25*Ln);let Ee=0;Ee=Yn.length<=.5*Ln?1:Math.ceil(Yn.paddedLength/L)+1;for(let st=0;st<Ee;st++){const Et=st/Math.max(Ee-1,1),en=Yn.lerp(Et),Lt=en.x+Ui,gn=en.y+Ui;ot.push(Lt,gn,Ln,0);const Rn=Lt-Ln,kn=gn-Ln,Bn=Lt+Ln,Jn=gn+Ln;if(dn=dn&&this.isOffscreen(Rn,kn,Bn,Jn),Kn=Kn||this.isInsideGrid(Rn,kn,Bn,Jn),!a&&this.grid.hitTestCircle(Lt,gn,Ln,Pe)&&(an=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:an,occluded:!1}}}}return{circles:!Y&&an||!Kn?[]:ot,offscreen:dn,collisionDetected:an,occluded:Kt.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const a=[];let p=1/0,y=1/0,w=-1/0,C=-1/0;for(const Y of n){const ce=new m.Point(Y.x+Ui,Y.y+Ui);p=Math.min(p,ce.x),y=Math.min(y,ce.y),w=Math.max(w,ce.x),C=Math.max(C,ce.y),a.push(ce)}const P=this.grid.query(p,y,w,C).concat(this.ignoredGrid.query(p,y,w,C)),V={},K={};for(const Y of P){const ce=Y.key;if(void 0===V[ce.bucketInstanceId]&&(V[ce.bucketInstanceId]={}),V[ce.bucketInstanceId][ce.featureIndex])continue;const Pe=[new m.Point(Y.x1,Y.y1),new m.Point(Y.x2,Y.y1),new m.Point(Y.x2,Y.y2),new m.Point(Y.x1,Y.y2)];m.polygonIntersectsPolygon(a,Pe)&&(V[ce.bucketInstanceId][ce.featureIndex]=!0,void 0===K[ce.bucketInstanceId]&&(K[ce.bucketInstanceId]=[]),K[ce.bucketInstanceId].push(ce.featureIndex))}return K}insertCollisionBox(n,a,p,y,w){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:w},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,p,y,w){const C=a?this.ignoredGrid:this.grid,P={bucketInstanceId:p,featureIndex:y,collisionGroupID:w};for(let V=0;V<n.length;V+=4)C.insertCircle(P,n[V],n[V+1],n[V+2])}projectAndGetPerspectiveRatio(n,a,p,y,w,C,P){const V=[a,p,y,1];let K=!1;y||this.transform.pitch>0?(m.transformMat4$1(V,V,n),this.fogState&&w&&"globe"!==P.name&&(K=function(Pe,Ke,Ye,rt,ot,pe){const he=pe.calculateFogTileMatrix(ot),gt=[Ke,Ye,rt];return m.transformMat4(gt,gt,he),bn(Pe,gt,pe.pitch,pe._fov)}(this.fogState,a,p,y,w.toUnwrapped(),this.transform)>.9)):br(V,V,n);const Y=V[3];return{point:new m.Point((V[0]/Y+1)/2*this.transform.width+Ui,(-V[1]/Y+1)/2*this.transform.height+Ui),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/Y*.5,1.5),signedDistanceFromCamera:Y,occluded:C&&V[2]>Y||K}}isOffscreen(n,a,p,y){return p<Ui||n>=this.screenRightBoundary||y<Ui||a>this.screenBottomBoundary}isInsideGrid(n,a,p,y){return p>=0&&n<this.gridRightBoundary&&y>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=m.identity([]);return m.translate(n,n,[-100,-100,0]),n}}function bs(c,n,a){const p=n.createTileMatrix(c,c.worldSize,a.toUnwrapped());return m.multiply(new Float32Array(16),c.projMatrix,p)}function Gi(c,n,a){if(n.projection.name===a.projection.name)return c.projMatrix;const p=a.clone();return p.setProjection(n.projection),bs(p,n.getProjection(),c)}function ys(c,n,a){return n.name===a.projection.name?c.projMatrix:bs(a,n,c)}class fi{constructor(n,a,p,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):y&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Pi{constructor(n,a,p,y,w,C=!1){this.text=new fi(n?n.text:null,a,p,w),this.icon=new fi(n?n.icon:null,a,y,w),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fl{constructor(n,a,p,y=!1){this.text=n,this.icon=a,this.skipFade=p,this.clipped=y}}class Wo{constructor(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]}}class gc{constructor(n,a,p,y,w){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=w}}class Iu{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[n]}}function bl(c,n,a,p,y){const{horizontalAlign:w,verticalAlign:C}=m.getAnchorAlignment(c),P=-(w-.5)*n,V=-(C-.5)*a,K=m.evaluateVariableOffset(c,p);return new m.Point(P+K[0]*y,V+K[1]*y)}function Fi(c,n,a,p,y){const w=new m.Point(c,n);return a&&w._rotate(p?y:-y),w}class Nr{constructor(n,a,p,y,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Mo(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Iu(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,p,y){const w=p.getBucket(a),C=p.latestFeatureIndex;if(!w||!C||a.id!==w.layerIds[0])return;const P=w.layers[0].layout,V=p.collisionBoxArray,K=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),Y=p.tileSize/m.EXTENT,ce=p.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Pe=(Ke=p.tileID,Ye=w.getProjection(),rt=this.transform,Ye.name===this.projection?rt.calculateProjMatrix(Ke.toUnwrapped()):bs(rt,Ye,Ke));var Ke,Ye,rt;const ot="map"===P.get("text-pitch-alignment"),pe="map"===P.get("text-rotation-alignment");a.compileFilter();const he=a.dynamicFilter(),gt=a.dynamicFilterNeedsFeature(),mt=this.transform.calculatePixelsToTileUnitsMatrix(p),Ut=On(Pe,p.tileID.canonical,ot,pe,this.transform,w.getProjection(),mt);let jt=null;if(ot){const Kt=sr(Pe,p.tileID.canonical,ot,pe,this.transform,w.getProjection(),mt);jt=m.multiply([],this.transform.labelPlaneMatrix,Kt)}let It=null;he&&p.latestFeatureIndex&&(It={unwrappedTileID:ce,dynamicFilter:he,dynamicFilterNeedsFeature:gt,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new gc(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,p.tileID);const tn={bucket:w,layout:P,posMatrix:Pe,textLabelPlaneMatrix:Ut,labelToScreenMatrix:jt,clippingData:It,scale:K,textPixelRatio:Y,holdingForFade:p.holdingForFade(),collisionBoxArray:V,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:m.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const Kt of w.sortKeyRanges){const{sortKey:ln,symbolInstanceStart:rr,symbolInstanceEnd:cn}=Kt;n.push({sortKey:ln,symbolInstanceStart:rr,symbolInstanceEnd:cn,parameters:tn})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:tn})}attemptAnchorPlacement(n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt,ot,pe,he){const{textOffset0:gt,textOffset1:mt,crossTileID:Ut}=Pe,jt=[gt,mt],It=bl(n,p,y,jt,w),tn=this.collisionIndex.placeCollisionBox(Ye,w,a,Fi(It.x,It.y,C,P,this.transform.angle),ce,V,K,Y.predicate);if(ot){const Kt=Ye.getSymbolInstanceIconSize(he,this.transform.zoom,Pe.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Ye,Kt,ot,Fi(It.x,It.y,C,P,this.transform.angle),ce,V,K,Y.predicate).box.length)return}if(tn.box.length>0){let Kt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ut]&&this.prevPlacement.placements[Ut]&&this.prevPlacement.placements[Ut].text&&(Kt=this.prevPlacement.variableOffsets[Ut].anchor),this.variableOffsets[Ut]={textOffset:jt,width:p,height:y,anchor:n,textScale:w,prevAnchor:Kt},this.markUsedJustification(Ye,n,Pe,rt),Ye.allowVerticalPlacement&&(this.markUsedOrientation(Ye,rt,Pe),this.placedOrientations[Ut]=rt),{shift:It,placedGlyphBoxes:tn}}}placeLayerBucketPart(n,a,p,y){const{bucket:w,layout:C,posMatrix:P,textLabelPlaneMatrix:V,labelToScreenMatrix:K,clippingData:Y,textPixelRatio:ce,holdingForFade:Pe,collisionBoxArray:Ke,partiallyEvaluatedTextSize:Ye,partiallyEvaluatedIconSize:rt,collisionGroup:ot}=n.parameters,pe=C.get("text-optional"),he=C.get("icon-optional"),gt=C.get("text-allow-overlap"),mt=C.get("icon-allow-overlap"),Ut="map"===C.get("text-rotation-alignment"),jt="map"===C.get("text-pitch-alignment"),It="none"!==C.get("icon-text-fit"),tn="viewport-y"===C.get("symbol-z-order");this.transform.setProjection(w.projection);let Kt=gt&&(mt||!w.hasIconData()||he),ln=mt&&(gt||!w.hasTextData()||pe);!w.collisionArrays&&Ke&&w.deserializeCollisionBoxes(Ke),p&&y&&w.updateCollisionDebugBuffers(this.transform.zoom,Ke);const rr=(cn,Dn,an)=>{const{crossTileID:Kn,numVerticalGlyphVertices:dn}=cn;if(Y){const Bn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Jn=null;if(Y.dynamicFilterNeedsFeature){const er=this.retainedQueryData[w.bucketInstanceId];Jn=Y.featureIndex.loadFeature({featureIndex:cn.featureIndex,bucketIndex:er.bucketIndex,sourceLayerIndex:er.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Y.dynamicFilter)(Bn,Jn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new m.Point(cn.tileAnchorX,cn.tileAnchorY),this.transform.calculateDistanceTileData(Y.unwrappedTileID)))return this.placements[Kn]=new Fl(!1,!1,!1,!0),void a.add(Kn)}if(a.has(Kn))return;if(Pe)return void(this.placements[Kn]=new Fl(!1,!1,!1));let Ln=!1,Nn=!1,Wn=!0,Yn=!1,Xr=!1,bi=null,Br={box:null,offscreen:null,occluded:null},R={box:null,offscreen:null,occluded:null},L=null,$=null,ee=null,Ee=0,st=0,Et=0;an.textFeatureIndex?Ee=an.textFeatureIndex:cn.useRuntimeCollisionCircles&&(Ee=cn.featureIndex),an.verticalTextFeatureIndex&&(st=an.verticalTextFeatureIndex);const en=Bn=>{Bn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Jn=this.transform.elevation;(Jn||Bn.elevation)&&(Bn.elevation=Jn?Jn.getAtTileOffset(Bn.tileID,Bn.tileAnchorX,Bn.tileAnchorY):0)},Lt=an.textBox;if(Lt){en(Lt);const Bn=er=>{let Vr=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!er&&this.prevPlacement){const ui=this.prevPlacement.placedOrientations[Kn];ui&&(this.placedOrientations[Kn]=ui,Vr=ui,this.markUsedOrientation(w,Vr,cn))}return Vr},Jn=(er,Vr)=>{if(w.allowVerticalPlacement&&dn>0&&an.verticalTextBox){for(const ui of w.writingModes)if(ui===m.WritingMode.vertical?(Br=Vr(),R=Br):Br=er(),Br&&Br.box&&Br.box.length)break}else Br=er()};if(C.get("text-variable-anchor")){let er=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Kn]){const Yt=this.prevPlacement.variableOffsets[Kn];er.indexOf(Yt.anchor)>0&&(er=er.filter(Tr=>Tr!==Yt.anchor),er.unshift(Yt.anchor))}const Vr=(Yt,Tr,Hs)=>{const Ms=w.getSymbolInstanceTextSize(Ye,cn,this.transform.zoom,Dn),mi=(Yt.x2-Yt.x1)*Ms+2*Yt.padding,Yr=(Yt.y2-Yt.y1)*Ms+2*Yt.padding,ri=It&&!mt?Tr:null;ri&&en(ri);let Mi={box:[],offscreen:!1,occluded:!1};const po=gt?2*er.length:er.length;for(let Rr=0;Rr<po;++Rr){const ls=this.attemptAnchorPlacement(er[Rr%er.length],Yt,mi,Yr,Ms,Ut,jt,ce,P,ot,Rr>=er.length,cn,Dn,w,Hs,ri,Ye,rt);if(ls&&(Mi=ls.placedGlyphBoxes,Mi&&Mi.box&&Mi.box.length)){Ln=!0,bi=ls.shift;break}}return Mi};Jn(()=>Vr(Lt,an.iconBox,m.WritingMode.horizontal),()=>{const Yt=an.verticalTextBox;return Yt&&en(Yt),w.allowVerticalPlacement&&!(Br&&Br.box&&Br.box.length)&&dn>0&&Yt?Vr(Yt,an.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Br&&(Ln=Br.box,Wn=Br.offscreen,Yn=Br.occluded);const ui=Bn(!(!Br||!Br.box));if(!Ln&&this.prevPlacement){const Yt=this.prevPlacement.variableOffsets[Kn];Yt&&(this.variableOffsets[Kn]=Yt,this.markUsedJustification(w,Yt.anchor,cn,ui))}}else{const er=(Vr,ui)=>{const Yt=w.getSymbolInstanceTextSize(Ye,cn,this.transform.zoom,Dn),Tr=this.collisionIndex.placeCollisionBox(w,Yt,Vr,new m.Point(0,0),gt,ce,P,ot.predicate);return Tr&&Tr.box&&Tr.box.length&&(this.markUsedOrientation(w,ui,cn),this.placedOrientations[Kn]=ui),Tr};Jn(()=>er(Lt,m.WritingMode.horizontal),()=>{const Vr=an.verticalTextBox;return w.allowVerticalPlacement&&dn>0&&Vr?(en(Vr),er(Vr,m.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Bn(!!(Br&&Br.box&&Br.box.length))}}if(L=Br,Ln=L&&L.box&&L.box.length>0,Wn=L&&L.offscreen,Yn=L&&L.occluded,cn.useRuntimeCollisionCircles){const Bn=w.text.placedSymbolArray.get(cn.centerJustifiedTextSymbolIndex>=0?cn.centerJustifiedTextSymbolIndex:cn.verticalPlacedTextSymbolIndex),Jn=m.evaluateSizeForFeature(w.textSizeData,Ye,Bn),er=C.get("text-padding");$=this.collisionIndex.placeCollisionCircles(w,gt,Bn,w.lineVertexArray,w.glyphOffsetArray,Jn,P,V,K,p,jt,ot.predicate,cn.collisionCircleDiameter*Jn/m.ONE_EM,er,this.retainedQueryData[w.bucketInstanceId].tileID),Ln=gt||$.circles.length>0&&!$.collisionDetected,Wn=Wn&&$.offscreen,Yn=$.occluded}if(an.iconFeatureIndex&&(Et=an.iconFeatureIndex),an.iconBox){const Bn=Jn=>{en(Jn);const er=It&&bi?Fi(bi.x,bi.y,Ut,jt,this.transform.angle):new m.Point(0,0),Vr=w.getSymbolInstanceIconSize(rt,this.transform.zoom,cn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Vr,Jn,er,mt,ce,P,ot.predicate)};R&&R.box&&R.box.length&&an.verticalIconBox?(ee=Bn(an.verticalIconBox),Nn=ee.box.length>0):(ee=Bn(an.iconBox),Nn=ee.box.length>0),Wn=Wn&&ee.offscreen,Xr=ee.occluded}const gn=pe||0===cn.numHorizontalGlyphVertices&&0===dn,Rn=he||0===cn.numIconVertices;if(gn||Rn?Rn?gn||(Nn=Nn&&Ln):Ln=Nn&&Ln:Nn=Ln=Nn&&Ln,Ln&&L&&L.box&&this.collisionIndex.insertCollisionBox(L.box,C.get("text-ignore-placement"),w.bucketInstanceId,R&&R.box&&st?st:Ee,ot.ID),Nn&&ee&&this.collisionIndex.insertCollisionBox(ee.box,C.get("icon-ignore-placement"),w.bucketInstanceId,Et,ot.ID),$&&(Ln&&this.collisionIndex.insertCollisionCircles($.circles,C.get("text-ignore-placement"),w.bucketInstanceId,Ee,ot.ID),p)){const Bn=w.bucketInstanceId;let Jn=this.collisionCircleArrays[Bn];void 0===Jn&&(Jn=this.collisionCircleArrays[Bn]=new Wo);for(let er=0;er<$.circles.length;er+=4)Jn.circles.push($.circles[er+0]),Jn.circles.push($.circles[er+1]),Jn.circles.push($.circles[er+2]),Jn.circles.push($.collisionDetected?1:0)}const kn="globe"!==w.projection.name;Kt=Kt&&(kn||!Yn),ln=ln&&(kn||!Xr),this.placements[Kn]=new Fl(Ln||Kt,Nn||ln,Wn||w.justReloaded),a.add(Kn)};if(tn){const cn=w.getSortedSymbolIndexes(this.transform.angle);for(let Dn=cn.length-1;Dn>=0;--Dn){const an=cn[Dn];rr(w.symbolInstances.get(an),an,w.collisionArrays[an])}}else for(let cn=n.symbolInstanceStart;cn<n.symbolInstanceEnd;cn++)rr(w.symbolInstances.get(cn),cn,w.collisionArrays[cn]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){const cn=this.collisionCircleArrays[w.bucketInstanceId];m.invert(cn.invProjMatrix,P),cn.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,a,p,y){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:V,crossTileID:K}=p,Y=m.getAnchorJustification(a),ce=y===m.WritingMode.vertical?V:"left"===Y?w:"center"===Y?C:"right"===Y?P:-1;w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=ce>=0&&w!==ce?0:K),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=ce>=0&&C!==ce?0:K),P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=ce>=0&&P!==ce?0:K),V>=0&&(n.text.placedSymbolArray.get(V).crossTileID=ce>=0&&V!==ce?0:K)}markUsedOrientation(n,a,p){const y=a===m.WritingMode.horizontal||a===m.WritingMode.horizontalOnly?a:0,w=a===m.WritingMode.vertical?a:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:V,verticalPlacedTextSymbolIndex:K}=p,Y=n.text.placedSymbolArray;C>=0&&(Y.get(C).placedOrientation=y),P>=0&&(Y.get(P).placedOrientation=y),V>=0&&(Y.get(V).placedOrientation=y),K>=0&&(Y.get(K).placedOrientation=w)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const y=a?a.symbolFadeChange(n):1,w=a?a.opacities:{},C=a?a.variableOffsets:{},P=a?a.placedOrientations:{};for(const V in this.placements){const K=this.placements[V],Y=w[V];Y?(this.opacities[V]=new Pi(Y,y,K.text,K.icon,null,K.clipped),p=p||K.text!==Y.text.placed||K.icon!==Y.icon.placed):(this.opacities[V]=new Pi(null,y,K.text,K.icon,K.skipFade,K.clipped),p=p||K.text||K.icon)}for(const V in w){const K=w[V];if(!this.opacities[V]){const Y=new Pi(K,y,!1,!1);Y.isHidden()||(this.opacities[V]=Y,p=p||K.text.placed||K.icon.placed)}}for(const V in C)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=C[V]);for(const V in P)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=P[V]);p?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const p=new Set;for(const y of a){const w=y.getBucket(n);w&&y.latestFeatureIndex&&n.id===w.layerIds[0]&&this.updateBucketOpacities(w,p,y.collisionBoxArray)}}updateBucketOpacities(n,a,p){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,w=!!n.layers[0].dynamicFilter(),C=new Pi(null,0,!1,!1,!0),P=y.get("text-allow-overlap"),V=y.get("icon-allow-overlap"),K=y.get("text-variable-anchor"),Y="map"===y.get("text-rotation-alignment"),ce="map"===y.get("text-pitch-alignment"),Pe="none"!==y.get("icon-text-fit"),Ke=new Pi(null,0,P&&(V||!n.hasIconData()||y.get("icon-optional")),V&&(P||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&p&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(p);const Ye=(ot,pe,he)=>{for(let gt=0;gt<pe/4;gt++)ot.opacityVertexArray.emplaceBack(he)};let rt=0;for(let ot=0;ot<n.symbolInstances.length;ot++){const pe=n.symbolInstances.get(ot),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:gt,crossTileID:mt,numIconVertices:Ut}=pe,jt=a.has(mt);let It=this.opacities[mt];jt?It=C:It||(It=Ke,this.opacities[mt]=It),a.add(mt);const tn=he>0||gt>0,Kt=Ut>0,ln=this.placedOrientations[mt],rr=ln===m.WritingMode.vertical,cn=ln===m.WritingMode.horizontal||ln===m.WritingMode.horizontalOnly;if(!tn&&!Kt||It.isHidden()||rt++,tn){const Dn=al(It.text);Ye(n.text,he,rr?no:Dn),Ye(n.text,gt,cn?no:Dn);const an=It.text.isHidden(),{leftJustifiedTextSymbolIndex:Kn,centerJustifiedTextSymbolIndex:dn,rightJustifiedTextSymbolIndex:Ln,verticalPlacedTextSymbolIndex:Nn}=pe,Wn=n.text.placedSymbolArray,Yn=an||rr?1:0;Kn>=0&&(Wn.get(Kn).hidden=Yn),dn>=0&&(Wn.get(dn).hidden=Yn),Ln>=0&&(Wn.get(Ln).hidden=Yn),Nn>=0&&(Wn.get(Nn).hidden=an||cn?1:0);const Xr=this.variableOffsets[mt];Xr&&this.markUsedJustification(n,Xr.anchor,pe,ln);const bi=this.placedOrientations[mt];bi&&(this.markUsedJustification(n,"left",pe,bi),this.markUsedOrientation(n,bi,pe))}if(Kt){const Dn=al(It.icon),{placedIconSymbolIndex:an,verticalPlacedIconSymbolIndex:Kn}=pe,dn=n.icon.placedSymbolArray,Ln=It.icon.isHidden()?1:0;an>=0&&(Ye(n.icon,Ut,rr?no:Dn),dn.get(an).hidden=Ln),Kn>=0&&(Ye(n.icon,pe.numVerticalIconVertices,cn?no:Dn),dn.get(Kn).hidden=Ln)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Dn=n.collisionArrays[ot];if(Dn){let an=new m.Point(0,0),Kn=!0;if(Dn.textBox||Dn.verticalTextBox){if(K){const Ln=this.variableOffsets[mt];Ln?(an=bl(Ln.anchor,Ln.width,Ln.height,Ln.textOffset,Ln.textScale),Y&&an._rotate(ce?this.transform.angle:-this.transform.angle)):Kn=!1}w&&(Kn=!It.clipped),Dn.textBox&&eo(n.textCollisionBox.collisionVertexArray,It.text.placed,!Kn||rr,an.x,an.y),Dn.verticalTextBox&&eo(n.textCollisionBox.collisionVertexArray,It.text.placed,!Kn||cn,an.x,an.y)}const dn=Kn&&!(cn||!Dn.verticalIconBox);Dn.iconBox&&eo(n.iconCollisionBox.collisionVertexArray,It.icon.placed,dn,Pe?an.x:0,Pe?an.y:0),Dn.verticalIconBox&&eo(n.iconCollisionBox.collisionVertexArray,It.icon.placed,!dn,Pe?an.x:0,Pe?an.y:0)}}}if(n.fullyClipped=0===rt,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ot=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ot.invProjMatrix,n.placementViewportMatrix=ot.viewportMatrix,n.collisionCircleArray=ot.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function eo(c,n,a,p,y){c.emplaceBack(n?1:0,a?1:0,p||0,y||0),c.emplaceBack(n?1:0,a?1:0,p||0,y||0),c.emplaceBack(n?1:0,a?1:0,p||0,y||0),c.emplaceBack(n?1:0,a?1:0,p||0,y||0)}const to=Math.pow(2,25),ds=Math.pow(2,24),Bc=Math.pow(2,17),Tl=Math.pow(2,16),ba=Math.pow(2,9),Ro=Math.pow(2,8),Ta=Math.pow(2,1);function al(c){if(0===c.opacity&&!c.placed)return 0;if(1===c.opacity&&c.placed)return 4294967295;const n=c.placed?1:0,a=Math.floor(127*c.opacity);return a*to+n*ds+a*Bc+n*Tl+a*ba+n*Ro+a*Ta+n}const no=0;class Xo{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,p,y,w){const C=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(C,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((P,V)=>P.sortKey-V.sortKey));this._currentPartIndex<C.length;){const P=C[this._currentPartIndex];if(a.placeLayerBucketPart(P,this._seenCrossTileIDs,p,0===P.symbolInstanceStart),this._currentPartIndex++,w())return!0}return!1}}class Za{constructor(n,a,p,y,w,C,P,V){this.placement=new Nr(n,w,C,P,V),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,a,p){const y=m.exported.now(),w=()=>{const C=m.exported.now()-y;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=a[n[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if("symbol"===C.type&&(!C.minzoom||C.minzoom<=P)&&(!C.maxzoom||C.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Xo(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const ia=512/m.EXTENT/2;class hs{constructor(n,a,p){this.tileID=n,this.bucketInstanceId=p,this.index=new m.KDBush(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*m.EXTENT,w=n.canonical.y*m.EXTENT;for(let C=0;C<a.length;C++){const{key:P,crossTileID:V,tileAnchorX:K,tileAnchorY:Y}=a.get(C),ce=Math.floor((y+K)*ia),Pe=Math.floor((w+Y)*ia);this.index.add(ce,Pe),this.keys.push(P),this.crossTileIDs.push(V)}this.index.finish()}findMatches(n,a,p){const y=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),w=ia/Math.pow(2,a.canonical.z-this.tileID.canonical.z),C=a.canonical.x*m.EXTENT,P=a.canonical.y*m.EXTENT;for(let V=0;V<n.length;V++){const K=n.get(V);if(K.crossTileID)continue;const{key:Y,tileAnchorX:ce,tileAnchorY:Pe}=K,Ke=Math.floor((C+ce)*w),Ye=Math.floor((P+Pe)*w),rt=this.index.range(Ke-y,Ye-y,Ke+y,Ye+y);for(const ot of rt){const pe=this.crossTileIDs[ot];if(this.keys[ot]===Y&&!p.has(pe)){p.add(pe),K.crossTileID=pe;break}}}}}class sa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(0!==a)for(const p in this.indexes){const y=this.indexes[p],w={};for(const C in y){const P=y[C];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+a),w[P.tileID.key]=P}this.indexes[p]=w}this.lng=n}addBucket(n,a,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let w=0;w<a.symbolInstances.length;w++)a.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>n.overscaledZ)for(const P in C){const V=C[P];V.tileID.isChildOf(n)&&V.findMatches(a.symbolInstances,n,y)}else{const P=C[n.scaledTo(Number(w)).key];P&&P.findMatches(a.symbolInstances,n,y)}}for(let w=0;w<a.symbolInstances.length;w++){const C=a.symbolInstances.get(w);C.crossTileID||(C.crossTileID=p.generate(),y.add(C.crossTileID))}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new hs(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const p of a.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let a=!1;for(const p in this.indexes){const y=this.indexes[p];for(const w in y)n[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[w]),delete y[w],a=!0)}return a}}class Zs{constructor(){this.layerIndexes={},this.crossTileIDs=new sa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,p,y){let w=this.layerIndexes[n.id];void 0===w&&(w=this.layerIndexes[n.id]=new wi);let C=!1;const P={};"globe"!==y.name&&w.handleWrapJump(p);for(const V of a){const K=V.getBucket(n);K&&n.id===K.layerIds[0]&&(K.bucketInstanceId||(K.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(V.tileID,K,this.crossTileIDs)&&(C=!0),P[K.bucketInstanceId]=!0)}return w.removeStaleBuckets(P)&&(C=!0),C}pruneUnusedLayers(n){const a={};n.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const Us=(c,n)=>m.emitValidationErrors(c,n&&n.filter(a=>"source.canvas"!==a.identifier)),ga=m.pick(Jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ei=m.pick(Jt,["setCenter","setZoom","setBearing","setPitch"]),Il={version:8,layers:[],sources:{}},La={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bo extends m.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new lt(ra(),this),this.imageManager=new at,this.imageManager.setEventedParent(this),this.glyphManager=new m.GlyphManager(n._requestManager,a.localFontFamily?m.LocalGlyphMode.all:a.localIdeographFontFamily?m.LocalGlyphMode.ideographs:m.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.crossTileSymbolIndex=new Zs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());const p=this;this._rtlTextPluginCallback=Bo.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(w,C)=>{if(m.triggerPluginCompletionEvent(w),C&&C.every(P=>P))for(const P in p._sourceCaches){const V=p._sourceCaches[P],K=V.getSource().type;"vector"!==K&&"geojson"!==K||V.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const w=this.getSource(y.sourceId);if(w&&w.vectorLayerIds)for(const C in this._layers){const P=this._layers[C];P.source===w.id&&this._validateLayer(P)}})}loadURL(n,a={}){this.fire(new m.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof a.validate?a.validate:!m.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const y=this.map._requestManager.transformRequest(n,m.ResourceType.Style);this._request=m.getJSON(y,(w,C)=>{this._request=null,w?this.fire(new m.ErrorEvent(w)):C&&this._load(C,p)})}loadJSON(n,a={}){this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.exported.frame(()=>{this._request=null,this._load(n,!1!==a.validate)})}loadEmpty(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Il,!1)}_updateLayerCount(n,a){const p=a?1:-1;n.is3D()&&(this._num3DLayers+=p),"circle"===n.type&&(this._numCircleLayers+=p),"symbol"===n.type&&(this._numSymbolLayers+=p)}_load(n,a){if(a&&Us(this,m.validateStyle(n)))return;this._loaded=!0,this.stylesheet=m.clone$1(n),this._updateMapProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const p=In(this.stylesheet.layers);this._order=p.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of p){const w=m.createStyleLayer(y);w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new it(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(a,p,y){let w,C,P;const V=m.exported.devicePixelRatio>1?"@2x":"";let K=m.getJSON(p.transformRequest(p.normalizeSpriteURL(a,V,".json"),m.ResourceType.SpriteJSON),(Pe,Ke)=>{K=null,P||(P=Pe,w=Ke,ce())}),Y=m.getImage(p.transformRequest(p.normalizeSpriteURL(a,V,".png"),m.ResourceType.SpriteImage),(Pe,Ke)=>{Y=null,P||(P=Pe,C=Ke,ce())});function ce(){if(P)y(P);else if(w&&C){const Pe=m.exported.getImageData(C),Ke={};for(const Ye in w){const{width:rt,height:ot,x:pe,y:he,sdf:gt,pixelRatio:mt,stretchX:Ut,stretchY:jt,content:It}=w[Ye],tn=new m.RGBAImage({width:rt,height:ot});m.RGBAImage.copy(Pe,tn,{x:pe,y:he},{x:0,y:0},{width:rt,height:ot}),Ke[Ye]={data:tn,pixelRatio:mt,sdf:gt,stretchX:Ut,stretchY:jt,content:It}}y(null,Ke)}}return{cancel(){K&&(K.cancel(),K=null),Y&&(Y.cancel(),Y=null)}}}(n,this.map._requestManager,(a,p)=>{if(this._spriteRequest=null,a)this.fire(new m.ErrorEvent(a));else if(p)for(const y in p)this.imageManager.addImage(y,p[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new m.Event("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const p=n.sourceLayer;p&&("geojson"===a.type||a.vectorLayerIds&&-1===a.vectorLayerIds.indexOf(p))&&this.fire(new m.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const p of n){const y=this._layers[p];"custom"!==y.type&&a.push(y.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&("function"==typeof n.isLayerDraped?n.isLayerDraped():La[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const C in this._updatedSources){const P=this._updatedSources[C];"reload"===P?this._reloadSource(C):"clear"===P&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const p={};for(const y in this._sourceCaches){const w=this._sourceCaches[y];p[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];if(w.recalculate(n,this._availableImages),!w.isHidden(n.zoom)){const P=this._getLayerSourceCache(w);P&&(P.used=!0)}const C=this.map.painter;if(C){const P=w.getProgramIds();if(!P)continue;const V=w.getProgramConfiguration(n.zoom);for(const K of P)C.useProgram(K,V)}}for(const y in p){const w=this._sourceCaches[y];p[y]!==w.used&&w.getSource().fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new m.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Us(this,m.validateStyle(n)))return!1;(n=m.clone$1(n)).layers=In(n.layers);const a=function(y,w){if(!y)return[{command:Jt.setStyle,args:[w]}];let C=[];try{if(!ae(y.version,w.version))return[{command:Jt.setStyle,args:[w]}];ae(y.center,w.center)||C.push({command:Jt.setCenter,args:[w.center]}),ae(y.zoom,w.zoom)||C.push({command:Jt.setZoom,args:[w.zoom]}),ae(y.bearing,w.bearing)||C.push({command:Jt.setBearing,args:[w.bearing]}),ae(y.pitch,w.pitch)||C.push({command:Jt.setPitch,args:[w.pitch]}),ae(y.sprite,w.sprite)||C.push({command:Jt.setSprite,args:[w.sprite]}),ae(y.glyphs,w.glyphs)||C.push({command:Jt.setGlyphs,args:[w.glyphs]}),ae(y.transition,w.transition)||C.push({command:Jt.setTransition,args:[w.transition]}),ae(y.light,w.light)||C.push({command:Jt.setLight,args:[w.light]}),ae(y.fog,w.fog)||C.push({command:Jt.setFog,args:[w.fog]}),ae(y.projection,w.projection)||C.push({command:Jt.setProjection,args:[w.projection]});const P={},V=[];!function(ce,Pe,Ke,Ye){let rt;for(rt in Pe=Pe||{},ce=ce||{})ce.hasOwnProperty(rt)&&(Pe.hasOwnProperty(rt)||Gr(rt,Ke,Ye));for(rt in Pe){if(!Pe.hasOwnProperty(rt))continue;const ot=Pe[rt];ce.hasOwnProperty(rt)?ae(ce[rt],ot)||("geojson"===ce[rt].type&&"geojson"===ot.type&&Ii(ce,Pe,rt)?Ke.push({command:Jt.setGeoJSONSourceData,args:[rt,ot.data]}):gi(rt,Pe,Ke,Ye)):Sn(rt,Pe,Ke)}}(y.sources,w.sources,V,P);const K=[];y.layers&&y.layers.forEach(ce=>{ce.source&&P[ce.source]?C.push({command:Jt.removeLayer,args:[ce.id]}):K.push(ce)});let Y=y.terrain;Y&&P[Y.source]&&(C.push({command:Jt.setTerrain,args:[void 0]}),Y=void 0),C=C.concat(V),ae(Y,w.terrain)||C.push({command:Jt.setTerrain,args:[w.terrain]}),function(ce,Pe,Ke){Pe=Pe||[];const Ye=(ce=ce||[]).map(ws),rt=Pe.map(ws),ot=ce.reduce(_i,{}),pe=Pe.reduce(_i,{}),he=Ye.slice(),gt=Object.create(null);let mt,Ut,jt,It,tn,Kt,ln;for(mt=0,Ut=0;mt<Ye.length;mt++)jt=Ye[mt],pe.hasOwnProperty(jt)?Ut++:(Ke.push({command:Jt.removeLayer,args:[jt]}),he.splice(he.indexOf(jt,Ut),1));for(mt=0,Ut=0;mt<rt.length;mt++)jt=rt[rt.length-1-mt],he[he.length-1-mt]!==jt&&(ot.hasOwnProperty(jt)?(Ke.push({command:Jt.removeLayer,args:[jt]}),he.splice(he.lastIndexOf(jt,he.length-Ut),1)):Ut++,Kt=he[he.length-mt],Ke.push({command:Jt.addLayer,args:[pe[jt],Kt]}),he.splice(he.length-mt,0,jt),gt[jt]=!0);for(mt=0;mt<rt.length;mt++)if(jt=rt[mt],It=ot[jt],tn=pe[jt],!gt[jt]&&!ae(It,tn))if(ae(It.source,tn.source)&&ae(It["source-layer"],tn["source-layer"])&&ae(It.type,tn.type)){for(ln in ki(It.layout,tn.layout,Ke,jt,null,Jt.setLayoutProperty),ki(It.paint,tn.paint,Ke,jt,null,Jt.setPaintProperty),ae(It.filter,tn.filter)||Ke.push({command:Jt.setFilter,args:[jt,tn.filter]}),ae(It.minzoom,tn.minzoom)&&ae(It.maxzoom,tn.maxzoom)||Ke.push({command:Jt.setLayerZoomRange,args:[jt,tn.minzoom,tn.maxzoom]}),It)It.hasOwnProperty(ln)&&"layout"!==ln&&"paint"!==ln&&"filter"!==ln&&"metadata"!==ln&&"minzoom"!==ln&&"maxzoom"!==ln&&(0===ln.indexOf("paint.")?ki(It[ln],tn[ln],Ke,jt,ln.slice(6),Jt.setPaintProperty):ae(It[ln],tn[ln])||Ke.push({command:Jt.setLayerProperty,args:[jt,ln,tn[ln]]}));for(ln in tn)tn.hasOwnProperty(ln)&&!It.hasOwnProperty(ln)&&"layout"!==ln&&"paint"!==ln&&"filter"!==ln&&"metadata"!==ln&&"minzoom"!==ln&&"maxzoom"!==ln&&(0===ln.indexOf("paint.")?ki(It[ln],tn[ln],Ke,jt,ln.slice(6),Jt.setPaintProperty):ae(It[ln],tn[ln])||Ke.push({command:Jt.setLayerProperty,args:[jt,ln,tn[ln]]}))}else Ke.push({command:Jt.removeLayer,args:[jt]}),Kt=he[he.lastIndexOf(jt)+1],Ke.push({command:Jt.addLayer,args:[tn,Kt]})}(K,w.layers,C)}catch(P){console.warn("Unable to compute style diff:",P),C=[{command:Jt.setStyle,args:[w]}]}return C}(this.serialize(),n).filter(y=>!(y.command in Ei));if(0===a.length)return!1;const p=a.filter(y=>!(y.command in ga));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);return a.forEach(y=>{"setTransition"!==y.command&&"setProjection"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new m.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new m.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,p={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(m.validateSource,`sources.${n}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const y=Mn(n,a,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:y.serialize(),sourceId:n}));const w=C=>{const P=(C?"symbol:":"other:")+n,V=this._sourceCaches[P]=new m.SourceCache(P,y,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[n]=V,V.style=this,V.onAdd(this.map)};w(!1),"vector"!==a.type&&"geojson"!==a.type||w(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new m.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new m.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(n);for(const y of p)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}_getSources(){const n=[];for(const a in this._otherSourceCaches){const p=this._getSourceCache(a);p&&n.push(p.getSource())}return n}addLayer(n,a,p={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let w;if("custom"===n.type){if(Us(this,m.validateCustomStyleLayer(n)))return;w=m.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(y,n.source),n=m.clone$1(n),n=m.extend(n,{source:y})),this._validate(m.validateLayer,`layers.${y}`,n,{arrayIndex:-1},p))return;w=m.createStyleLayer(n),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const C=a?this._order.indexOf(a):this._order.length;if(a&&-1===C)return void this.fire(new m.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(C,0,y),this._layerOrderChanged=!0,this._layers[y]=w;const P=this._getLayerSourceCache(w);if(this._removedLayers[y]&&w.source&&P&&"custom"!==w.type){const V=this._removedLayers[y];delete this._removedLayers[y],V.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",P.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const p=this._order.indexOf(n);this._order.splice(p,1);const y=a?this._order.indexOf(a):this._order.length;a&&-1===y?this.fire(new m.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const p=this._order.indexOf(n);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,p){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===a&&y.maxzoom===p||(null!=a&&(y.minzoom=a),null!=p&&(y.maxzoom=p),this._updateLayer(y)):this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,p={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!ae(y.filter,a))return null==a?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(m.validateFilter,`layers.${y.id}.filter`,a,{layerType:y.type},p)||(y.filter=m.clone$1(a),this._updateLayer(y)))}else this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&m.clone$1(a.filter)}setLayoutProperty(n,a,p,y={}){this._checkLoaded();const w=this.getLayer(n);w?ae(w.getLayoutProperty(a),p)||(w.setLayoutProperty(a,p,y),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const p=this.getLayer(n);if(p)return p.getLayoutProperty(a);this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,p,y={}){this._checkLoaded();const w=this.getLayer(n);w?ae(w.getPaintProperty(a),p)||(w.setPaintProperty(a,p,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new m.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const p=this.getLayer(n);return p&&p.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const p=n.source,y=n.sourceLayer,w=this.getSource(p);if(!w)return void this.fire(new m.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const C=w.type;if("geojson"===C&&y)return void this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===C&&!y)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided.")));const P=this._getSourceCaches(p);for(const V of P)V.setFeatureState(y,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const p=n.source,y=this.getSource(p);if(!y)return void this.fire(new m.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const w=y.type,C="vector"===w?n.sourceLayer:void 0;if("vector"===w&&!C)return void this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const P=this._getSourceCaches(p);for(const V of P)V.removeFeatureState(C,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,p=n.sourceLayer,y=this.getSource(a);if(y){if("vector"!==y.type||p)return void 0===n.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(p,n.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();n[p.id]||(n[p.id]=p.serialize())}return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},a=>void 0!==a)}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&"raster"!==a.getSource().type&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=C=>"fill-extrusion"===this._layers[C].type,p={},y=[];for(let C=this._order.length-1;C>=0;C--){const P=this._order[C];if(a(P)){p[P]=C;for(const V of n){const K=V[P];if(K)for(const Y of K)y.push(Y)}}}y.sort((C,P)=>P.intersectionZ-C.intersectionZ);const w=[];for(let C=this._order.length-1;C>=0;C--){const P=this._order[C];if(a(P))for(let V=y.length-1;V>=0;V--){const K=y[V].feature;if(p[K.layer.id]<C)break;w.push(K),y.pop()}else for(const V of n){const K=V[P];if(K)for(const Y of K)w.push(Y.feature)}}return w}queryRenderedFeatures(n,a,p){a&&a.filter&&this._validate(m.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const y={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const V of a.layers){const K=this._layers[V];if(!K)return this.fire(new m.ErrorEvent(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];y[K.source]=!0}}const w=[];a.availableImages=this._availableImages;const C=a&&a.layers?a.layers.some(V=>{const K=this.getLayer(V);return K&&K.is3D()}):this.has3DLayers(),P=Pt.createFromScreenPoints(n,p);for(const V in this._sourceCaches){const K=this._sourceCaches[V].getSource().id;a.layers&&!y[K]||w.push(wr(this._sourceCaches[V],this._layers,this._serializedLayers,P,a,p,C,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(V,K,Y,ce,Pe,Ke,Ye){const rt={},ot=Ke.queryRenderedSymbols(ce),pe=[];for(const he of Object.keys(ot).map(Number))pe.push(Ye[he]);pe.sort(Li);for(const he of pe){const gt=he.featureIndex.lookupSymbolFeatures(ot[he.bucketInstanceId],K,he.bucketIndex,he.sourceLayerIndex,Pe.filter,Pe.layers,Pe.availableImages,V);for(const mt in gt){const Ut=rt[mt]=rt[mt]||[],jt=gt[mt];jt.sort((It,tn)=>{const Kt=he.featureSortOrder;if(Kt){const ln=Kt.indexOf(It.featureIndex);return Kt.indexOf(tn.featureIndex)-ln}return tn.featureIndex-It.featureIndex});for(const It of jt)Ut.push(It)}}for(const he in rt)rt[he].forEach(gt=>{const mt=gt.feature,Ut=Y(V[he]);if(!Ut)return;const jt=Ut.getFeatureState(mt.layer["source-layer"],mt.id);mt.source=mt.layer.source,mt.layer["source-layer"]&&(mt.sourceLayer=mt.layer["source-layer"]),mt.state=jt});return rt}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),P.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(n,a){a&&a.filter&&this._validate(m.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const p=this._getSourceCaches(n);let y=[];for(const w of p)y=y.concat(Hr(w,a));return y}addSourceType(n,a,p){return Bo.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(Bo.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const p=this.light.getLight();let y=!1;for(const C in n)if(!ae(n[C],p[C])){y=!0;break}if(!y)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=n;if(1===a){if("object"==typeof p.source){const y="terrain-dem-src";this.addSource(y,p.source),p=m.clone$1(p),p=m.extend(p,{source:y})}if(this._validate(m.validateTerrain,"terrain",p))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,a)}else{const y=this.terrain,w=y.get();for(const C of Object.keys(m.spec.terrain))!p.hasOwnProperty(C)&&m.spec.terrain[C].default&&(p[C]=m.spec.terrain[C].default);for(const C in p)if(!ae(p[C],w[C])){y.set(p),this.stylesheet.terrain=p;const P=this._setTransitionParameters({duration:0});y.updateTransitions(P);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Ht(n,this.map.transform);this.stylesheet.fog=n;const p=this._setTransitionParameters({duration:0});a.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,p=a.get();0===Object.keys(n).length&&a.set(n);for(const y in n)if(!ae(n[y],p[y])){a.set(n),this.stylesheet.fog=n;const w=this._setTransitionParameters({duration:0});a.updateTransitions(w);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:m.exported.now(),transition:m.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(p=>this.isLayerDraped(this._layers[p])),a=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const p=this.terrain=new nn(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];"fill-extrusion"===a.type&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];"symbol"===a.type&&this._updateLayer(a)}}_validate(n,a,p,y,w={}){return(!w||!1!==w.validate)&&Us(this,n.call(m.validateStyle,m.extend({key:a,style:this.serialize(),value:p,styleSpec:m.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const p of a)p.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const p of a)p.resume(),p.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,p,y,w=!1){let C=!1,P=!1;const V={};for(const K of this._order){const Y=this._layers[K];if("symbol"!==Y.type)continue;if(!V[Y.source]){const Pe=this._getLayerSourceCache(Y);if(!Pe)continue;V[Y.source]=Pe.getRenderableIds(!0).map(Ke=>Pe.getTileByID(Ke)).sort((Ke,Ye)=>Ye.tileID.overscaledZ-Ke.tileID.overscaledZ||(Ke.tileID.isLessThan(Ye.tileID)?-1:1))}const ce=this.crossTileSymbolIndex.addLayer(Y,V[Y.source],n.center.lng,n.projection);C=C||ce}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new m.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.exported.now(),n.zoom))&&(this.pauseablePlacement=new Za(n,this._order,w,a,p,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.exported.now()),P=!0),C&&this.pauseablePlacement.placement.setStale()),P||C)for(const K of this._order){const Y=this._layers[K];"symbol"===Y.type&&this.placement.updateLayerOpacities(Y,V[Y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,p){this.imageManager.getImages(a.icons,p),this._updateTilesForChangedImages();const y=w=>{w&&w.setDependencies(a.tileID.key,a.type,a.icons)};y(this._otherSourceCaches[a.source]),y(this._symbolSourceCaches[a.source])}getGlyphs(n,a,p){this.glyphManager.getGlyphs(a.stacks,p)}getResource(n,a,p){return m.makeRequest(a,p)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return 0===a.length?(this.fire(new m.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bo.getSourceType=function(c){return Rt[c]},Bo.setSourceType=function(c,n){Rt[c]=n},Bo.registerForPluginStateChange=m.registerForPluginStateChange;var _c="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Xa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",qo="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Qo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ko="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Fa={},oa={};const Bl=[];Ul(_c,Bl),Ul(qo,Bl),Ul(Qo,Bl),Ul(Ko,Bl),Fa=Ki("",qo),oa=Ki(Ko,Qo);const Qa=Ki("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Yc=_c,So="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Vl={background:Ki("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Ki("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Ki("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Ki("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ki("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Ki("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ki("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ki("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ki("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Ki("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Ki("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Ki("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Ki("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Ki("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Ki("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Ki("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ki("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Ki("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Ki("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Ki("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Ki("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Ki("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Ki("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Ki("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Ki("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ki("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xa),skyboxGradient:Ki("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xa),skyboxCapture:Ki("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ki("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Ki("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Ul(c,n){const a=c.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let p of a)if(p=p.trim(),"#"===p[0]&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const w of y)n.includes(w)||n.push(w)}}function Ki(c,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},w=[...Bl];return Ul(c,w),Ul(n,w),{fragmentSource:c=c.replace(a,(C,P,V,K,Y)=>(y[Y]=!0,"define"===P?`\n#ifndef HAS_UNIFORM_u_${Y}\nvarying ${V} ${K} ${Y};\n#else\nuniform ${V} ${K} u_${Y};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Y}\n    ${V} ${K} ${Y} = u_${Y};\n#endif\n`)),vertexSource:n=n.replace(a,(C,P,V,K,Y)=>{const ce="float"===K?"vec2":"vec4",Pe=Y.match(/color/)?"color":ce;return y[Y]?"define"===P?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${V} ${ce} a_${Y};\nvarying ${V} ${K} ${Y};\n#else\nuniform ${V} ${K} u_${Y};\n#endif\n`:"vec4"===Pe?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = a_${Y};\n#else\n    ${V} ${K} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = unpack_mix_${Pe}(a_${Y}, u_${Y}_t);\n#else\n    ${V} ${K} ${Y} = u_${Y};\n#endif\n`:"define"===P?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${V} ${ce} a_${Y};\n#else\nuniform ${V} ${K} u_${Y};\n#endif\n`:"vec4"===Pe?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${V} ${K} ${Y} = a_${Y};\n#else\n    ${V} ${K} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${V} ${K} ${Y} = unpack_mix_${Pe}(a_${Y}, u_${Y}_t);\n#else\n    ${V} ${K} ${Y} = u_${Y};\n#endif\n`}),staticAttributes:p,usedDefines:w}}class zl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,p,y,w,C,P){this.context=n;let V=this.boundPaintVertexBuffers.length!==y.length;for(let Y=0;!V&&Y<y.length;Y++)this.boundPaintVertexBuffers[Y]!==y[Y]&&(V=!0);let K=this.boundDynamicVertexBuffers.length!==P.length;for(let Y=0;!K&&Y<P.length;Y++)this.boundDynamicVertexBuffers[Y]!==P[Y]&&(K=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==p||V||K||this.boundIndexBuffer!==w||this.boundVertexOffset!==C)this.freshBind(a,p,y,w,C,P);else{n.bindVertexArrayOES.set(this.vao);for(const Y of P)Y&&Y.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(n,a,p,y,w,C){let P;const V=n.numAttributes,K=this.context,Y=K.gl;if(K.extVertexArrayObject)this.vao&&this.destroy(),this.vao=K.extVertexArrayObject.createVertexArrayOES(),K.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=C;else{P=K.currentNumAttributes||0;for(let ce=V;ce<P;ce++)Y.disableVertexAttribArray(ce)}a.enableAttributes(Y,n),a.bind(),a.setVertexAttribPointers(Y,n,w);for(const ce of p)ce.enableAttributes(Y,n),ce.bind(),ce.setVertexAttribPointers(Y,n,w);for(const ce of C)ce&&(ce.enableAttributes(Y,n),ce.bind(),ce.setVertexAttribPointers(Y,n,w));y&&y.bind(),K.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function aa(c,n){const a=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new m.MercatorCoordinate(0,p/a).toLngLat().lat,new m.MercatorCoordinate(0,(p+1)/a).toLngLat().lat]}function Ba(c,n,a,p,y,w,C){const P=c.context,V=P.gl,K=a.fbo;if(!K)return;c.prepareDrawTile();const Y=c.useProgram("hillshade");P.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,K.colorAttachment.get());const ce=((rt,ot,pe,he)=>{const gt=pe.paint.get("hillshade-shadow-color"),mt=pe.paint.get("hillshade-highlight-color"),Ut=pe.paint.get("hillshade-accent-color");let jt=pe.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===pe.paint.get("hillshade-illumination-anchor")&&(jt-=rt.transform.angle);const It=!rt.options.moving;return{u_matrix:he||rt.transform.calculateProjMatrix(ot.tileID.toUnwrapped(),It),u_image:0,u_latrange:aa(0,ot.tileID),u_light:[pe.paint.get("hillshade-exaggeration"),jt],u_shadow:gt,u_highlight:mt,u_accent:Ut}})(c,a,p,c.terrain?n.projMatrix:null);c.prepareDrawProgram(P,Y,n.toUnwrapped());const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:Ke,tileBoundsSegments:Ye}=c.getTileBoundsBuffers(a);Y.draw(P,V.TRIANGLES,y,w,C,m.CullFaceMode.disabled,ce,p.id,Pe,Ke,Ye)}function Va(c,n,a){if(!n.needsDEMTextureUpload)return;const p=c.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(a.stride);const w=a.getPixels();n.demTexture?n.demTexture.update(w,{premultiply:!1}):n.demTexture=new m.Texture(p,w,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Vc(c,n,a,p,y,w){const C=c.context,P=C.gl;if(!n.dem)return;const V=n.dem;if(C.activeTexture.set(P.TEXTURE1),Va(c,n,V),!n.demTexture)return;n.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);const K=V.dim;C.activeTexture.set(P.TEXTURE0);let Y=n.fbo;if(!Y){const Ye=new m.Texture(C,{width:K,height:K,data:null},P.RGBA);Ye.bind(P.LINEAR,P.CLAMP_TO_EDGE),Y=n.fbo=C.createFramebuffer(K,K,!0),Y.colorAttachment.set(Ye.texture)}C.bindFramebuffer.set(Y.framebuffer),C.viewport.set([0,0,K,K]);const{tileBoundsBuffer:ce,tileBoundsIndexBuffer:Pe,tileBoundsSegments:Ke}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(C,P.TRIANGLES,p,y,w,m.CullFaceMode.disabled,((Ye,rt)=>{const ot=rt.stride,pe=m.create();return m.ortho(pe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(pe,pe,[0,-m.EXTENT,0]),{u_matrix:pe,u_image:1,u_dimension:[ot,ot],u_zoom:Ye.overscaledZ,u_unpack:rt.unpackVector}})(n.tileID,V),a.id,ce,Pe,Ke),n.needsHillshadePrepare=!1}const Vo=c=>({u_matrix:new m.UniformMatrix4f(c),u_image0:new m.Uniform1i(c),u_skirt_height:new m.Uniform1f(c)}),Ia=(c,n)=>({u_matrix:c,u_image0:0,u_skirt_height:n}),Ya=(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:a,u_zoom_transition:y,u_merc_center:w,u_image0:0,u_frustum_tl:C,u_frustum_tr:P,u_frustum_br:V,u_frustum_bl:K,u_globe_pos:Y,u_globe_radius:ce,u_viewport:Pe,u_grid_matrix:Ye?Float32Array.from(Ye):new Float32Array(9),u_skirt_height:Ke});function Ua(c,n){return null!=c&&null!=n&&!(!c.hasData()||!n.hasData())&&null!=c.demTexture&&null!=n.demTexture&&c.tileID.key!==n.tileID.key}const Sa=new class{constructor(){this.operations={}}newMorphing(c,n,a,p,y){if(c in this.operations){const w=this.operations[c];w.to.tileID.key!==a.tileID.key&&(w.queued=a)}else this.operations[c]={startTime:p,phase:0,duration:y,from:n,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(const n in this.operations){const a=this.operations[n];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},ro={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function si(c){return 6*Math.pow(1.5,22-c)}function Aa(c,n){const a=1<<c.z;return!n&&(0===c.x||c.x===a-1)||0===c.y||c.y===a-1}const Po=c=>({u_matrix:c});function _a(c,n,a,p,y){if(y>0){const w=m.exported.now(),C=(w-c.timeAdded)/y,P=n?(w-n.timeAdded)/y:-1,V=a.getSource(),K=p.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),Y=!n||Math.abs(n.tileID.overscaledZ-K)>Math.abs(c.tileID.overscaledZ-K),ce=Y&&c.refreshedUponExpiration?1:m.clamp(Y?C:1-P,0,1);return c.refreshedUponExpiration&&C>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-ce}:{opacity:ce,mix:0}}return{opacity:1,mix:0}}class zi extends m.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new lt(ra(),null),y=Mn("mock-dem",a,p,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class tc extends m.SourceCache{constructor(n){const a=Mn("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new lt(ra(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,p){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,C)=>{if(w[C.key]="",!this._tiles[C.key]){const P=new m.Tile(C,this._source.tileSize*C.overscaleFactor(),n.tileZoom);P.state="loaded",this._tiles[C.key]=P}return w},{});for(const w in this._tiles)w in y||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(n){const a=this.proxyCachedFBO[n];if(void 0!==a){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Uo extends m.OverscaledTileID{constructor(n,a,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class za extends m.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,w]=function(V){const K=new m.StructArrayLayout2i4,Y=new m.StructArrayLayout3ui6;K.reserve(17161),Y.reserve(33800);const Pe=m.EXTENT/128,Ke=m.EXTENT+Pe/2,Ye=Ke+Pe;for(let ot=-Pe;ot<Ye;ot+=Pe)for(let pe=-Pe;pe<Ye;pe+=Pe){const he=pe<0||pe>Ke||ot<0||ot>Ke?24575:0,gt=m.clamp(Math.round(pe),0,m.EXTENT),mt=m.clamp(Math.round(ot),0,m.EXTENT);K.emplaceBack(gt+he,mt)}const rt=(ot,pe)=>{const he=131*pe+ot;Y.emplaceBack(he+1,he,he+131),Y.emplaceBack(he+131,he+131+1,he+1)};for(let ot=1;ot<129;ot++)for(let pe=1;pe<129;pe++)rt(pe,ot);return[0,129].forEach(ot=>{for(let pe=0;pe<130;pe++)rt(pe,ot),rt(ot,pe)}),[K,Y,32768]}(),C=n.context;this.gridBuffer=C.createVertexBuffer(p,m.posAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(y),this.gridSegments=m.SegmentVector.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=m.SegmentVector.simpleSegment(0,0,p.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new tc(a.map),this.orthoMatrix=m.create(),m.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,m.EXTENT,0,m.EXTENT,0,1);const P=C.gl;this._overlapStencilMode=new m.StencilMode({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new zi(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,p){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const w=()=>{this.sourceCache.used&&m.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(a,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),a.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&m.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=a.getIds().map(V=>{const K=a.getTileByID(V).tileID;return K.projMatrix=p.calculateProjMatrix(K.toUnwrapped()),K});(function(V,K){const Y=K.transform.pointCoordinate(K.transform.getCameraPoint()),ce=new m.Point(Y.x,Y.y);V.sort((Pe,Ke)=>{if(Ke.overscaledZ-Pe.overscaledZ)return Ke.overscaledZ-Pe.overscaledZ;const Ye=new m.Point(Pe.canonical.x+(1<<Pe.canonical.z)*Pe.wrap,Pe.canonical.y),rt=new m.Point(Ke.canonical.x+(1<<Ke.canonical.z)*Ke.wrap,Ke.canonical.y),ot=ce.mult(1<<Pe.canonical.z);return ot.x-=.5,ot.y-=.5,ot.distSqr(Ye)-ot.distSqr(rt)})})(y,this.painter),this._previousZoom=p.zoom;const w=this.proxyToSource||{};this.proxyToSource={},y.forEach(V=>{this.proxyToSource[V.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const V in C){const K=C[V];if(!K.used||(K!==this.sourceCache&&this.resetTileLookupCache(K.id),this._setupProxiedCoordsForOrtho(K,n[V],w),K.usedForTerrain))continue;const Y=n[V];K.getSource().reparseOverscaled&&this._assignTerrainTiles(Y)}this.proxiedCoords[a.id]=y.map(V=>new Uo(V,V.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=m.exported.now();const P={};this._visibleDemTiles=[];for(const V of this.proxyCoords){const K=this.terrainTileForTile[V.key];if(!K)continue;const Y=K.tileID.key;Y in P||(this._visibleDemTiles.push(K),P[Y]=Y)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],w=y.dem;!w||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),Va(this.painter,y,w))}}_prepareDemTileUniforms(n,a,p,y){if(!a||null==a.demTexture)return!1;const w=n.tileID.canonical,C=Math.pow(2,a.tileID.canonical.z-w.z),P=y||"";return p[`u_dem_tl${P}`]=[w.x*C%1,w.y*C%1],p[`u_dem_scale${P}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const p=new m.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new m.Texture(n,p,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const w=y.dem.tree.minimums[0];return w>0&&n++,p+w},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new m.RGBAImage({width:1,height:1},new Uint8Array(m.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(y,{premultiply:!1}):w=this._emptyDEMTexture=new m.Texture(n,y,a.RGBA,{premultiply:!1}),w}setupElevationDraw(n,a,p){const y=this.painter.context,w=y.gl,C=(P=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:m.DEMData.getUnpackVector(P),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var P;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();let V=null,K=null,Y=1;if(p&&p.morphing&&this._useVertexMorphing){const ce=p.morphing.srcDemTile,Pe=p.morphing.dstDemTile;Y=p.morphing.phase,ce&&Pe&&(this._prepareDemTileUniforms(n,ce,C,"_prev")&&(K=ce),this._prepareDemTileUniforms(n,Pe,C)&&(V=Pe))}if(K&&V?(y.activeTexture.set(w.TEXTURE2),V.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),y.activeTexture.set(w.TEXTURE4),K.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),C.u_dem_lerp=Y):(V=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(n,V,C)?V.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),y.activeTexture.set(w.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&V){const ce=(1<<V.tileID.canonical.z)*m.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=ce}if(p&&p.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(y,C),"globe"===this.painter.transform.projection.name){const ce=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);a.setGlobeUniformValues(y,ce)}}globeUniformValues(n,a,p){const y=n.projection;return{u_tile_tl_up:y.upVector(a,0,0),u_tile_tr_up:y.upVector(a,m.EXTENT,0),u_tile_br_up:y.upVector(a,m.EXTENT,m.EXTENT),u_tile_bl_up:y.upVector(a,0,m.EXTENT),u_tile_up_scale:p?m.globeMetersToEcef(1):y.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,p=this.painter.context;0!==n.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,w,C,P,V){if("globe"===y.transform.projection.name)!function(K,Y,ce,Pe,Ke){const Ye=K.context,rt=Ye.gl;let ot,pe;const he=K.options.showTerrainWireframe?2:0,gt=K.transform,mt=m.globeUseCustomAntiAliasing(K,Ye,gt),Ut=(Kn,dn)=>{if(pe===Kn)return;const Ln=[ro[Kn],"PROJECTION_GLOBE_VIEW"];mt&&Ln.push("CUSTOM_ANTIALIASING"),dn&&Ln.push(ro[he]),ot=K.useProgram("globeRaster",null,Ln),pe=Kn},jt=K.colorModeForRenderPass(),It=new m.DepthMode(rt.LEQUAL,m.DepthMode.ReadWrite,K.depthRangeFor3D);Sa.update(Ke);const tn=m.calculateGlobeMercatorMatrix(gt),Kt=[m.mercatorXfromLng(gt.center.lng),m.mercatorYfromLat(gt.center.lat)],ln=he?[!1,!0]:[!1],rr=K.globeSharedBuffers,cn=[gt.width*m.exported.devicePixelRatio,gt.height*m.exported.devicePixelRatio],Dn=Float32Array.from(gt.globeMatrix),an={useDenormalizedUpVectorScale:!0};if(ln.forEach(Kn=>{const dn=K.transform,Ln=si(dn.zoom)*Y.exaggeration();pe=-1;const Nn=Kn?rt.LINES:rt.TRIANGLES;for(const Wn of Pe){const Yn=ce.getTile(Wn),Xr=m.StencilMode.disabled,bi=Y.prevTerrainTileForTile[Wn.key],Br=Y.terrainTileForTile[Wn.key];Ua(bi,Br)&&Sa.newMorphing(Wn.key,bi,Br,Ke,250),Ye.activeTexture.set(rt.TEXTURE0),Yn.texture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE);const R=Sa.getMorphValuesForProxy(Wn.key),L=R?1:0;R&&m.extend$1(an,{morphing:{srcDemTile:R.from,dstDemTile:R.to,phase:m.easeCubicInOut(R.phase)}});const $=m.tileCornersToBounds(Wn.canonical),ee=m.getLatitudinalLod($.getCenter().lat),Ee=m.getGridMatrix(Wn.canonical,$,ee,dn.worldSize/dn._pixelsPerMercatorPixel),st=m.globeNormalizeECEF(m.globeTileBounds(Wn.canonical)),Et=Ya(dn.projMatrix,Dn,tn,st,m.globeToMercatorTransition(dn.zoom),Kt,dn.frustumCorners.TL,dn.frustumCorners.TR,dn.frustumCorners.BR,dn.frustumCorners.BL,dn.globeCenterInViewSpace,dn.globeRadius,cn,Ln,Ee);if(Ut(L,Kn),Y.setupElevationDraw(Yn,ot,an),K.prepareDrawProgram(Ye,ot,Wn.toUnwrapped()),rr){const[en,Lt,gn]=Kn?rr.getWirefameBuffers(K.context,ee):rr.getGridBuffers(ee,0!==Ln);ot.draw(Ye,Nn,It,Xr,jt,m.CullFaceMode.backCCW,Et,"globe_raster",en,Lt,gn)}}}),rr){const Kn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];mt&&Kn.push("CUSTOM_ANTIALIASING"),ot=K.useProgram("globeRaster",null,Kn);for(const dn of Pe){const{x:Ln,y:Nn,z:Wn}=dn.canonical,Yn=0===Nn,Xr=Nn===(1<<Wn)-1,[bi,Br,R,L]=rr.getPoleBuffers(Wn);if(L&&(Yn||Xr)){const $=ce.getTile(dn);Ye.activeTexture.set(rt.TEXTURE0),$.texture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE);let ee=m.globePoleMatrixForTile(Wn,Ln,gt);const Ee=m.globeNormalizeECEF(m.globeTileBounds(dn.canonical)),st=(Et,en)=>Et.draw(Ye,rt.TRIANGLES,It,m.StencilMode.disabled,jt,m.CullFaceMode.disabled,Ya(gt.projMatrix,ee,ee,Ee,0,Kt,gt.frustumCorners.TL,gt.frustumCorners.TR,gt.frustumCorners.BR,gt.frustumCorners.BL,gt.globeCenterInViewSpace,gt.globeRadius,cn,0),"globe_pole_raster",en,R,L);Y.setupElevationDraw($,ot,an),K.prepareDrawProgram(Ye,ot,dn.toUnwrapped()),Yn&&st(ot,bi),Xr&&(ee=m.scale(m.create(),ee,[1,-1,1]),st(ot,Br))}}}}(y,w,C,P,V);else{const K=y.context,Y=K.gl;let ce,Pe;const Ke=y.options.showTerrainWireframe?2:0,Ye=(gt,mt)=>{if(Pe===gt)return;const Ut=[ro[gt]];mt&&Ut.push(ro[Ke]),ce=y.useProgram("terrainRaster",null,Ut),Pe=gt},rt=y.colorModeForRenderPass(),ot=new m.DepthMode(Y.LEQUAL,m.DepthMode.ReadWrite,y.depthRangeFor3D);Sa.update(V);const pe=y.transform,he=si(pe.zoom)*w.exaggeration();(Ke?[!1,!0]:[!1]).forEach(gt=>{Pe=-1;const mt=gt?Y.LINES:Y.TRIANGLES,[Ut,jt]=gt?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const It of P){const tn=C.getTile(It),Kt=m.StencilMode.disabled,ln=w.prevTerrainTileForTile[It.key],rr=w.terrainTileForTile[It.key];Ua(ln,rr)&&Sa.newMorphing(It.key,ln,rr,V,250),K.activeTexture.set(Y.TEXTURE0),tn.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST);const cn=Sa.getMorphValuesForProxy(It.key),Dn=cn?1:0;let an;cn&&(an={morphing:{srcDemTile:cn.from,dstDemTile:cn.to,phase:m.easeCubicInOut(cn.phase)}});const Kn=Ia(It.projMatrix,Aa(It.canonical,pe.renderWorldCopies)?he/10:he);Ye(Dn,gt),w.setupElevationDraw(tn,ce,an),y.prepareDrawProgram(K,ce,It.toUnwrapped()),ce.draw(K,mt,ot,Kt,rt,m.CullFaceMode.backCCW,Kn,"terrain_raster",w.gridBuffer,Ut,jt)}})}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,y=this.proxySourceCache,w=this.proxiedCoords[y.id],C=this._drapedRenderBatches.shift(),P=[],V=a.style.order;let K=0;for(const Y of w){const ce=y.getTileByID(Y.proxyTileKey),Pe=y.proxyCachedFBO[Y.key]?y.proxyCachedFBO[Y.key][n]:void 0,Ke=void 0!==Pe?y.renderCache[Pe]:this.pool[K++],Ye=void 0!==Pe;if(ce.texture=Ke.tex,Ye&&!Ke.dirty){P.push(ce.tileID);continue}let rt;p.bindFramebuffer.set(Ke.fb.framebuffer),this.renderedToTile=!1,Ke.dirty&&(p.clear({color:m.Color.transparent,stencil:0}),Ke.dirty=!1);for(let ot=C.start;ot<=C.end;++ot){const pe=a.style._layers[V[ot]];if(pe.isHidden(a.transform.zoom))continue;const he=a.style._getLayerSourceCache(pe),gt=he?this.proxyToSource[Y.key][he.id]:[Y];if(!gt)continue;const mt=gt;p.viewport.set([0,0,Ke.fb.width,Ke.fb.height]),rt!==(he?he.id:null)&&(this._setupStencil(Ke,gt,pe,he),rt=he?he.id:null),a.renderLayer(a,he,pe,mt)}this.renderedToTile?(Ke.dirty=!0,P.push(ce.tileID)):Ye||--K,5===K&&(K=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),C.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(0===a)return{efficiency:100};let p,y=0,w=0,C=!1;for(let P=0;P<a;++P){const V=n._layers[n.order[P]];this._style.isLayerDraped(V)?(C&&++y,++w):C||(C=!0,p=V.id)}return 0===w?{efficiency:100}:{efficiency:100*(1-y/w),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,a,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const C=w.tileID,P=1<<C.overscaledZ,{x:V,y:K}=C.canonical,Y=V/P,ce=(V+1)/P,Pe=K/P,Ke=(K+1)/P;return{minx:Y,miny:Pe,maxx:ce,maxy:Ke,t:w.dem.tree.raycastRoot(Y,Pe,ce,Ke,n,a,p),tile:w}});y.sort((w,C)=>(null!==w.t?w.t:Number.MAX_VALUE)-(null!==C.t?C.t:Number.MAX_VALUE));for(const w of y){if(null==w.t)return null;const C=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,n,a,p);if(null!=C)return C}return null}_createFBO(){const n=this.painter.context,a=n.gl,p=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const y=new m.Texture(n,{width:p[0],height:p[1],data:null},a.RGBA);y.bind(a.LINEAR,a.CLAMP_TO_EDGE);const w=n.createFramebuffer(p[0],p[1],!1);return w.colorAttachment.set(y.texture),w.depthAttachment=new Ie(n,w.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:w,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._layers[n],p=a.isHidden(this.painter.transform.zoom);return"custom"===a.type?!p&&a.shouldRedrape():!p&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style._getSources())if(p instanceof Ae){n=!0;break}if(!n)return;const a={};for(let p=0;p<this._style.order.length;++p){const y=this._style._layers[this._style.order[p]],w=this._style._getLayerSourceCache(y);if(w&&!a[w.id]&&!y.isHidden(this.painter.transform.zoom)&&"line"===y.type&&y.widthExpression()instanceof m.ZoomDependentExpression){a[w.id]=!0;for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][w.id];if(P)for(const V of P)this._clearRenderCacheForTile(w.id,V)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof Ne){n=!0;break}if(!n)return;const a={};for(let p=0;p<this._style.order.length;++p){const y=this._style._layers[this._style.order[p]],w=this._style._getLayerSourceCache(y);if(!w||a[w.id]||y.isHidden(this.painter.transform.zoom)||"raster"!==y.type)continue;const C=y.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const V=this.proxyToSource[P.key][w.id];if(V)for(const K of V){const Y=_a(w.getTile(K),w.findLoadedParent(K,0),w,this.painter.transform,C);(1!==Y.opacity||0!==Y.mix)&&this._clearRenderCacheForTile(w.id,K)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(0===a)return;const p=[];let y,w=0,C=this._style._layers[n[w]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++w<a;)C=this._style._layers[n[w]];for(;w<a;++w){const P=this._style._layers[n[w]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?void 0===y&&(y=w):void 0!==y&&(p.push({start:y,end:w-1}),y=void 0))}void 0!==y&&p.push({start:y,end:w-1}),this._drapedRenderBatches=p}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const C=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let P=0;P<C.length;++P){const V=Object.values(C[P]);a.renderCachePool.push(...V)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let C=p.length-1;C>=0;C--){const P=p[C];if(a.getTileByID(P.key),void 0!==a.proxyCachedFBO[P.key]){const V=n[P.key],K=this.proxyToSource[P.key];let Y=0;for(const ce in K){const Pe=K[ce],Ke=V[ce];if(!Ke||Ke.length!==Pe.length||Pe.some((Ye,rt)=>Ye!==Ke[rt]||y[ce]&&y[ce].hasOwnProperty(Ye.key))){Y=-1;break}++Y}for(const ce in a.proxyCachedFBO[P.key])a.renderCache[a.proxyCachedFBO[P.key][ce]].dirty=Y<0||Y!==Object.values(V).length}}const w=[...this._drapedRenderBatches];w.sort((C,P)=>P.end-P.start-(C.end-C.start));for(const C of w)for(const P of p){if(a.proxyCachedFBO[P.key])continue;let V=a.renderCachePool.pop();void 0===V&&a.renderCache.length<50&&(V=a.renderCache.length,a.renderCache.push(this._createFBO())),void 0!==V&&(a.proxyCachedFBO[P.key]={},a.proxyCachedFBO[P.key][C.start]=V,a.renderCache[V].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,C=w.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let P;if(p.isTileClipped())P=a.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):m.StencilMode.disabled}_renderTileClippingMasks(n,a){const p=this.painter,y=this.painter.context,w=y.gl;p._tileClippingMaskIDs={},y.setColorMode(m.ColorMode.disabled),y.setDepthMode(m.DepthMode.disabled);const C=p.useProgram("clippingMask");for(const P of n){const V=p._tileClippingMaskIDs[P.key]=--a;C.draw(y,w.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:w.ALWAYS,mask:0},V,255,w.KEEP,w.KEEP,w.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,Po(P.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const p=[n.x,n.y,1,1];m.transformMat4$1(p,p,a.pixelMatrixInverse),m.scale$1(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const y=a._camera.position,w=m.mercatorZfromAltitude(1,a.center.lat),C=[y[0],y[1],y[2]/w,0],P=m.subtract([],p.slice(0,3),C);m.normalize(P,P);const V=this.raycast(C,P,this._exaggeration);return null!==V&&V?(m.scaleAndAdd(C,C,P,V),C[3]=C[2],C[2]*=w,C):null}drawDepth(){const n=this.painter,a=n.context,p=this.proxySourceCache,y=Math.ceil(n.width),w=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=a.gl,P=a.createFramebuffer(y,w,!0);a.activeTexture.set(C.TEXTURE0);const V=new m.Texture(a,{width:y,height:w,data:null},C.RGBA);V.bind(C.NEAREST,C.CLAMP_TO_EDGE),P.colorAttachment.set(V.texture);const K=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,y,w);P.depthAttachment.set(K),this._depthFBO=P,this._depthTexture=V}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,y,w]),function(C,P,V,K){if("globe"===C.transform.projection.name)return;const Y=C.context,ce=Y.gl;Y.clear({depth:1});const Pe=C.useProgram("terrainDepth"),Ke=new m.DepthMode(ce.LESS,m.DepthMode.ReadWrite,C.depthRangeFor3D);for(const Ye of K){const rt=V.getTile(Ye),ot=Ia(Ye.projMatrix,0);P.setupElevationDraw(rt,Pe),Pe.draw(Y,ce.TRIANGLES,Ke,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.backCCW,ot,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(n,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,p){if(n.getSource()instanceof Vt)return this._setupProxiedCoordsForImageSource(n,a,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],w=this.proxyCoords;for(let P=0;P<w.length;P++){const V=w[P],K=this._findTileCoveringTileID(V,n);if(K){const Y=this._createProxiedId(V,K,p[V.key]&&p[V.key][n.id]);y.push(Y),this.proxyToSource[V.key][n.id]=[Y]}}let C=!1;for(let P=0;P<a.length;P++){const V=n.getTile(a[P]);if(!V||!V.hasData())continue;const K=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(K&&K.tileID.canonical.z!==V.tileID.canonical.z){const Y=this.proxyToSource[K.tileID.key][n.id],ce=this._createProxiedId(K.tileID,V,p[K.tileID.key]&&p[K.tileID.key][n.id]);Y?Y.splice(Y.length-1,0,ce):this.proxyToSource[K.tileID.key][n.id]=[ce],y.push(ce),C=!0}}this._sourceTilesOverlap[n.id]=C}_setupProxiedCoordsForImageSource(n,a,p){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],w=this.proxyCoords,C=n.getSource(),P=new m.Point(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),V=C.coordinates.map(m.MercatorCoordinate.fromLngLat).reduce((Y,ce)=>(Y.min.x=Math.min(Y.min.x,ce.x-P.x),Y.min.y=Math.min(Y.min.y,ce.y-P.y),Y.max.x=Math.max(Y.max.x,ce.x-P.x),Y.max.y=Math.max(Y.max.y,ce.y-P.y),Y),{min:new m.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new m.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),K=(Y,ce)=>{const Pe=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),Ke=Y.canonical.y/(1<<Y.canonical.z),Ye=m.EXTENT/(1<<Y.canonical.z),rt=ce.wrap+ce.canonical.x/(1<<ce.canonical.z),ot=ce.canonical.y/(1<<ce.canonical.z);return Pe+Ye<rt+V.min.x||Pe>rt+V.max.x||Ke+Ye<ot+V.min.y||Ke>ot+V.max.y};for(let Y=0;Y<w.length;Y++){const ce=w[Y];for(let Pe=0;Pe<a.length;Pe++){const Ke=n.getTile(a[Pe]);if(!Ke||!Ke.hasData()||K(ce,Ke.tileID))continue;const Ye=this._createProxiedId(ce,Ke,p[ce.key]&&p[ce.key][n.id]),rt=this.proxyToSource[ce.key][n.id];rt?rt.push(Ye):this.proxyToSource[ce.key][n.id]=[Ye],y.push(Ye)}}}_createProxiedId(n,a,p){let y=this.orthoMatrix;if(p){const w=p.find(C=>C.key===a.tileID.key);if(w)return w}if(a.tileID.key!==n.key){const w=n.canonical.z-a.tileID.canonical.z;let C,P,V;y=m.create();const K=a.tileID.wrap-n.wrap<<n.overscaledZ;w>0?(C=m.EXTENT>>w,P=C*((a.tileID.canonical.x<<w)-n.canonical.x+K),V=C*((a.tileID.canonical.y<<w)-n.canonical.y)):(C=m.EXTENT<<-w,P=m.EXTENT*(a.tileID.canonical.x-(n.canonical.x+K<<-w)),V=m.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-w))),m.ortho(y,0,C,0,C,0,1),m.translate(y,y,[P,V,0])}return new Uo(a.tileID,n.key,y)}_findTileCoveringTileID(n,a){let p=a.getTile(n);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[a.id],w=y[n.key];if(p=w?a.getTileByID(w):null,p&&p.hasData()||null===w)return p;let C=p?p.tileID:n,P=C.overscaledZ;const V=a.getSource().minzoom,K=[];if(!w){const ce=a.getSource().maxzoom;if(n.canonical.z>=ce){const Pe=n.canonical.z-ce;a.getSource().reparseOverscaled?(P=Math.max(n.canonical.z+2,a.transform.tileZoom),C=new m.OverscaledTileID(P,n.wrap,ce,n.canonical.x>>Pe,n.canonical.y>>Pe)):0!==Pe&&(P=ce,C=new m.OverscaledTileID(P,n.wrap,ce,n.canonical.x>>Pe,n.canonical.y>>Pe))}C.key!==n.key&&(K.push(C.key),p=a.getTile(C))}const Y=ce=>{K.forEach(Pe=>{y[Pe]=ce}),K.length=0};for(P-=1;P>=V&&(!p||!p.hasData());P--){p&&Y(p.tileID.key);const ce=C.calculateScaledKey(P);if(p=a.getTileByID(ce),p&&p.hasData())break;const Pe=y[ce];if(null===Pe)break;void 0===Pe?K.push(ce):p=a.getTileByID(Pe)}return Y(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(a){let p=0;const y=new m.StructArrayLayout2ui4,w=131;for(let C=1;C<129;C++){for(let P=1;P<129;P++)p=C*w+P,y.emplaceBack(p,p+1),y.emplaceBack(p,p+w),y.emplaceBack(p+1,p+w),128===C&&y.emplaceBack(p+w,p+w+1);y.emplaceBack(p+1,p+1+w)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=m.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ns{static cacheKey(n,a,p,y){let w=`${a}${y?y.cacheKey:""}`;for(const C of p)n.usedDefines.includes(C)&&(w+=`/${C}`);return w}constructor(n,a,p,y,w,C){const P=n.gl;this.program=P.createProgram();const V=function(pe){const he=[];for(let gt=0;gt<pe.length;gt++){if(null===pe[gt])continue;const mt=pe[gt].split(" ");he.push(mt.pop())}return he}(p.staticAttributes),K=y?y.getBinderAttributes():[],Y=V.concat(K);let ce=y?y.defines():[];ce=ce.concat(C.map(pe=>`#define ${pe}`));const Pe=n.isWebGL2?"#version 300 es\n":"",Ke=Pe+ce.concat(n.extStandardDerivatives&&0===Pe.length?"#extension GL_OES_standard_derivatives : enable\n".concat(So):So,So,Yc,Qa.fragmentSource,oa.fragmentSource,p.fragmentSource).join("\n"),Ye=Pe+ce.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Yc,Qa.vertexSource,oa.vertexSource,Fa.vertexSource,p.vertexSource).join("\n"),rt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(rt,Ke),P.compileShader(rt),P.attachShader(this.program,rt);const ot=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(ot,Ye),P.compileShader(ot),P.attachShader(this.program,ot),this.attributes={},this.numAttributes=Y.length;for(let pe=0;pe<this.numAttributes;pe++)Y[pe]&&(P.bindAttribLocation(this.program,pe,Y[pe]),this.attributes[Y[pe]]=pe);P.linkProgram(this.program),P.deleteShader(ot),P.deleteShader(rt),this.fixedUniforms=w(n),this.binderUniforms=y?y.getUniforms(n):[],C.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new m.Uniform1i(pe=n),u_dem_prev:new m.Uniform1i(pe),u_dem_unpack:new m.Uniform4f(pe),u_dem_tl:new m.Uniform2f(pe),u_dem_scale:new m.Uniform1f(pe),u_dem_tl_prev:new m.Uniform2f(pe),u_dem_scale_prev:new m.Uniform1f(pe),u_dem_size:new m.Uniform1f(pe),u_dem_lerp:new m.Uniform1f(pe),u_exaggeration:new m.Uniform1f(pe),u_depth:new m.Uniform1i(pe),u_depth_size_inv:new m.Uniform2f(pe),u_meter_to_dem:new m.Uniform1f(pe),u_label_plane_matrix_inv:new m.UniformMatrix4f(pe)}),C.includes("GLOBE")&&(this.globeUniforms=(pe=>({u_tile_tl_up:new m.Uniform3f(pe),u_tile_tr_up:new m.Uniform3f(pe),u_tile_br_up:new m.Uniform3f(pe),u_tile_bl_up:new m.Uniform3f(pe),u_tile_up_scale:new m.Uniform1f(pe)}))(n)),C.includes("FOG")&&(this.fogUniforms=(pe=>({u_fog_matrix:new m.UniformMatrix4f(pe),u_fog_range:new m.Uniform2f(pe),u_fog_color:new m.Uniform4f(pe),u_fog_horizon_blend:new m.Uniform1f(pe),u_fog_temporal_offset:new m.Uniform1f(pe),u_frustum_tl:new m.Uniform3f(pe),u_frustum_tr:new m.Uniform3f(pe),u_frustum_br:new m.Uniform3f(pe),u_frustum_bl:new m.Uniform3f(pe),u_globe_pos:new m.Uniform3f(pe),u_globe_radius:new m.Uniform1f(pe),u_globe_transition:new m.Uniform1f(pe),u_is_globe:new m.Uniform1i(pe),u_viewport:new m.Uniform2f(pe)}))(n))}var pe}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in a)p[y]&&p[y].set(this.program,y,a[y])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in a)p[y]&&p[y].set(this.program,y,a[y])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in a)p[y].set(this.program,y,a[y])}}draw(n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt){const ot=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(p),n.setStencilMode(y),n.setColorMode(w),n.setCullFace(C);for(const he of Object.keys(this.fixedUniforms))this.fixedUniforms[he].set(this.program,he,P[he]);Ye&&Ye.setUniforms(this.program,n,this.binderUniforms,Pe,{zoom:Ke});const pe={[ot.LINES]:2,[ot.TRIANGLES]:3,[ot.LINE_STRIP]:1}[a];for(const he of ce.get()){const gt=he.vaos||(he.vaos={});(gt[V]||(gt[V]=new zl)).bind(n,this,K,Ye?Ye.getPaintVertexBuffers():[],Y,he.vertexOffset,rt||[]),ot.drawElements(a,he.primitiveLength*pe,ot.UNSIGNED_SHORT,he.primitiveOffset*pe*2)}}}function ll(c,n){const a=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,c.transform.tileZoom)/a,y=p*(n.tileID.canonical.x+n.tileID.wrap*a),w=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/Ct(n,1,c.transform.tileZoom),u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}const Hi=m.create(),cl=(c,n,a,p,y,w,C,P,V,K,Y)=>{const ce=n.style.light,Pe=ce.properties.get("position"),Ke=[Pe.x,Pe.y,Pe.z],Ye=m.create$1();"viewport"===ce.properties.get("anchor")&&(m.fromRotation(Ye,-n.transform.angle),m.transformMat3(Ke,Ke,Ye));const rt=ce.properties.get("color"),ot=n.transform,pe={u_matrix:c,u_lightpos:Ke,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[rt.r,rt.g,rt.b],u_vertical_gradient:+a,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:w};return"globe"===ot.projection.name&&(pe.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],pe.u_zoom_transition=V,pe.u_inv_rot_matrix=Y,pe.u_merc_center=K,pe.u_up_dir=ot.projection.upVector(new m.CanonicalTileID(0,0,0),K[0]*m.EXTENT,K[1]*m.EXTENT),pe.u_height_lift=P),pe},nc=(c,n,a,p,y,w,C,P,V,K,Y,ce)=>{const Pe=cl(c,n,a,p,y,w,C,V,K,Y,ce),Ke={u_height_factor:-Math.pow(2,C.overscaledZ)/P.tileSize/8};return m.extend(Pe,ll(n,P),Ke)},Ja=c=>({u_matrix:c}),da=(c,n,a)=>m.extend(Ja(c),ll(n,a)),vs=(c,n)=>({u_matrix:c,u_world:n}),el=(c,n,a,p)=>m.extend(da(c,n,a),{u_world:p}),uu=m.create(),Sl=(c,n,a,p,y,w)=>{const C=c.transform,P="globe"===C.projection.name;let V;if("map"===w.paint.get("circle-pitch-alignment"))if(P){const Y=m.globePixelsToTileUnits(C.zoom,n.canonical)*C._pixelsPerMercatorPixel;V=Float32Array.from([Y,0,0,Y])}else V=C.calculatePixelsToTileUnitsMatrix(a);else V=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const K={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:c.translatePosMatrix(n.projMatrix,a,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:m.exported.devicePixelRatio,u_extrude_scale:V,u_inv_rot_matrix:uu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){K.u_inv_rot_matrix=p,K.u_merc_center=y,K.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],K.u_zoom_transition=m.globeToMercatorTransition(C.zoom);const Y=y[0]*m.EXTENT,ce=y[1]*m.EXTENT;K.u_up_dir=C.projection.upVector(new m.CanonicalTileID(0,0,0),Y,ce)}return K},wo=c=>{const n=[];return"map"===c.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===c.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},Mc=(c,n,a,p)=>{const y=m.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},Al=(c,n,a=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:a}),rc=m.create(),Ts=(c,n,a,p,y,w,C)=>{const P=c.transform,V="globe"===P.projection.name,K=V?m.globePixelsToTileUnits(P.zoom,n.canonical)*P._pixelsPerMercatorPixel:Ct(a,1,w),Y={u_matrix:n.projMatrix,u_extrude_scale:K,u_intensity:C,u_inv_rot_matrix:rc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(V){Y.u_inv_rot_matrix=p,Y.u_merc_center=y,Y.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],Y.u_zoom_transition=m.globeToMercatorTransition(P.zoom);const ce=y[0]*m.EXTENT,Pe=y[1]*m.EXTENT;Y.u_up_dir=P.projection.upVector(new m.CanonicalTileID(0,0,0),ce,Pe)}return Y},jl=(c,n,a,p,y,w,C)=>{const P=c.transform,V=P.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:$l(c,n,a,p),u_pixels_to_tile_units:V,u_device_pixel_ratio:w,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:zo(a)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Cl(n,c.transform),u_alpha_discard_threshold:0,u_trim_offset:C}},Uc=(c,n,a,p,y)=>{const w=c.transform;return{u_matrix:$l(c,n,a,p),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:Cl(n,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Cl(c,n){return 1/Ct(c,1,n.tileZoom)}function $l(c,n,a,p){return c.translatePosMatrix(p||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function zo(c){const n=c.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const yc=(c,n,a,p,y,w)=>{return{u_matrix:c,u_tl_parent:n,u_scale_parent:a,u_fade_t:p.mix,u_opacity:p.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(P=y.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(C=y.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Ca(y.paint.get("raster-hue-rotate")),u_perspective_transform:w};var C,P};function Ca(c){c*=Math.PI/180;const n=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Jc=m.create(),vc=(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt)=>{const ot=y.transform,pe={u_is_size_zoom_constant:+("constant"===c||"source"===c),u_is_size_feature_constant:+("constant"===c||"camera"===c),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ot.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:ot.width/ot.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:P,u_is_text:+V,u_pitch_with_map:+p,u_texsize:K,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Jc,u_up_vector:[0,-1,0]};return"globe"===rt.name&&(pe.u_tile_id=[Y.canonical.x,Y.canonical.y,1<<Y.canonical.z],pe.u_zoom_transition=ce,pe.u_inv_rot_matrix=Ke,pe.u_merc_center=Pe,pe.u_camera_forward=ot._camera.forward(),pe.u_ecef_origin=m.globeECEFOrigin(ot.globeMatrix,Y.toUnwrapped()),pe.u_tile_matrix=Float32Array.from(ot.globeMatrix),pe.u_up_vector=Ye),pe},Gl=(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt,ot)=>m.extend(vc(c,n,a,p,y,w,C,P,V,K,ce,Pe,Ke,Ye,rt,ot),{u_gamma_scale:p?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:m.exported.devicePixelRatio,u_is_halo:+Y}),ic=(c,n,a,p,y,w,C,P,V,K,Y,ce,Pe,Ke,Ye,rt)=>m.extend(Gl(c,n,a,p,y,w,C,P,!0,V,!0,Y,ce,Pe,Ke,Ye,rt),{u_texsize_icon:K,u_texture_icon:1}),Dl=(c,n,a)=>({u_matrix:c,u_opacity:n,u_color:a}),xc=(c,n,a,p,y)=>m.extend(function(w,C,P){const V=C.imageManager.getPattern(w.toString()),{width:K,height:Y}=C.imageManager.getPixelSize(),ce=Math.pow(2,P.tileID.overscaledZ),Pe=P.tileSize*Math.pow(2,C.transform.tileZoom)/ce,Ke=Pe*(P.tileID.canonical.x+P.tileID.wrap*ce),Ye=Pe*P.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[K,Y],u_pattern_size:V.displaySize,u_tile_units_to_pixels:1/Ct(P,1,C.transform.tileZoom),u_pixel_coord_upper:[Ke>>16,Ye>>16],u_pixel_coord_lower:[65535&Ke,65535&Ye]}}(p,a,y),{u_matrix:c,u_opacity:n}),Bi={fillExtrusion:c=>({u_matrix:new m.UniformMatrix4f(c),u_lightpos:new m.Uniform3f(c),u_lightintensity:new m.Uniform1f(c),u_lightcolor:new m.Uniform3f(c),u_vertical_gradient:new m.Uniform1f(c),u_opacity:new m.Uniform1f(c),u_edge_radius:new m.Uniform1f(c),u_ao:new m.Uniform2f(c),u_tile_id:new m.Uniform3f(c),u_zoom_transition:new m.Uniform1f(c),u_inv_rot_matrix:new m.UniformMatrix4f(c),u_merc_center:new m.Uniform2f(c),u_up_dir:new m.Uniform3f(c),u_height_lift:new m.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new m.UniformMatrix4f(c),u_lightpos:new m.Uniform3f(c),u_lightintensity:new m.Uniform1f(c),u_lightcolor:new m.Uniform3f(c),u_vertical_gradient:new m.Uniform1f(c),u_height_factor:new m.Uniform1f(c),u_edge_radius:new m.Uniform1f(c),u_ao:new m.Uniform2f(c),u_tile_id:new m.Uniform3f(c),u_zoom_transition:new m.Uniform1f(c),u_inv_rot_matrix:new m.UniformMatrix4f(c),u_merc_center:new m.Uniform2f(c),u_up_dir:new m.Uniform3f(c),u_height_lift:new m.Uniform1f(c),u_image:new m.Uniform1i(c),u_texsize:new m.Uniform2f(c),u_pixel_coord_upper:new m.Uniform2f(c),u_pixel_coord_lower:new m.Uniform2f(c),u_tile_units_to_pixels:new m.Uniform1f(c),u_opacity:new m.Uniform1f(c)}),fill:c=>({u_matrix:new m.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new m.UniformMatrix4f(c),u_image:new m.Uniform1i(c),u_texsize:new m.Uniform2f(c),u_pixel_coord_upper:new m.Uniform2f(c),u_pixel_coord_lower:new m.Uniform2f(c),u_tile_units_to_pixels:new m.Uniform1f(c)}),fillOutline:c=>({u_matrix:new m.UniformMatrix4f(c),u_world:new m.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new m.UniformMatrix4f(c),u_world:new m.Uniform2f(c),u_image:new m.Uniform1i(c),u_texsize:new m.Uniform2f(c),u_pixel_coord_upper:new m.Uniform2f(c),u_pixel_coord_lower:new m.Uniform2f(c),u_tile_units_to_pixels:new m.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new m.Uniform1f(c),u_extrude_scale:new m.UniformMatrix2f(c),u_device_pixel_ratio:new m.Uniform1f(c),u_matrix:new m.UniformMatrix4f(c),u_inv_rot_matrix:new m.UniformMatrix4f(c),u_merc_center:new m.Uniform2f(c),u_tile_id:new m.Uniform3f(c),u_zoom_transition:new m.Uniform1f(c),u_up_dir:new m.Uniform3f(c)}),collisionBox:c=>({u_matrix:new m.UniformMatrix4f(c),u_camera_to_center_distance:new m.Uniform1f(c),u_extrude_scale:new m.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new m.UniformMatrix4f(c),u_inv_matrix:new m.UniformMatrix4f(c),u_camera_to_center_distance:new m.Uniform1f(c),u_viewport_size:new m.Uniform2f(c)}),debug:c=>({u_color:new m.UniformColor(c),u_matrix:new m.UniformMatrix4f(c),u_overlay:new m.Uniform1i(c),u_overlay_scale:new m.Uniform1f(c)}),clippingMask:c=>({u_matrix:new m.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new m.Uniform1f(c),u_intensity:new m.Uniform1f(c),u_matrix:new m.UniformMatrix4f(c),u_inv_rot_matrix:new m.UniformMatrix4f(c),u_merc_center:new m.Uniform2f(c),u_tile_id:new m.Uniform3f(c),u_zoom_transition:new m.Uniform1f(c),u_up_dir:new m.Uniform3f(c)}),heatmapTexture:c=>({u_image:new m.Uniform1i(c),u_color_ramp:new m.Uniform1i(c),u_opacity:new m.Uniform1f(c)}),hillshade:c=>({u_matrix:new m.UniformMatrix4f(c),u_image:new m.Uniform1i(c),u_latrange:new m.Uniform2f(c),u_light:new m.Uniform2f(c),u_shadow:new m.UniformColor(c),u_highlight:new m.UniformColor(c),u_accent:new m.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new m.UniformMatrix4f(c),u_image:new m.Uniform1i(c),u_dimension:new m.Uniform2f(c),u_zoom:new m.Uniform1f(c),u_unpack:new m.Uniform4f(c)}),line:c=>({u_matrix:new m.UniformMatrix4f(c),u_pixels_to_tile_units:new m.UniformMatrix2f(c),u_device_pixel_ratio:new m.Uniform1f(c),u_units_to_pixels:new m.Uniform2f(c),u_dash_image:new m.Uniform1i(c),u_gradient_image:new m.Uniform1i(c),u_image_height:new m.Uniform1f(c),u_texsize:new m.Uniform2f(c),u_tile_units_to_pixels:new m.Uniform1f(c),u_alpha_discard_threshold:new m.Uniform1f(c),u_trim_offset:new m.Uniform2f(c)}),linePattern:c=>({u_matrix:new m.UniformMatrix4f(c),u_texsize:new m.Uniform2f(c),u_pixels_to_tile_units:new m.UniformMatrix2f(c),u_device_pixel_ratio:new m.Uniform1f(c),u_image:new m.Uniform1i(c),u_units_to_pixels:new m.Uniform2f(c),u_tile_units_to_pixels:new m.Uniform1f(c),u_alpha_discard_threshold:new m.Uniform1f(c)}),raster:c=>({u_matrix:new m.UniformMatrix4f(c),u_tl_parent:new m.Uniform2f(c),u_scale_parent:new m.Uniform1f(c),u_fade_t:new m.Uniform1f(c),u_opacity:new m.Uniform1f(c),u_image0:new m.Uniform1i(c),u_image1:new m.Uniform1i(c),u_brightness_low:new m.Uniform1f(c),u_brightness_high:new m.Uniform1f(c),u_saturation_factor:new m.Uniform1f(c),u_contrast_factor:new m.Uniform1f(c),u_spin_weights:new m.Uniform3f(c),u_perspective_transform:new m.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new m.Uniform1i(c),u_is_size_feature_constant:new m.Uniform1i(c),u_size_t:new m.Uniform1f(c),u_size:new m.Uniform1f(c),u_camera_to_center_distance:new m.Uniform1f(c),u_rotate_symbol:new m.Uniform1i(c),u_aspect_ratio:new m.Uniform1f(c),u_fade_change:new m.Uniform1f(c),u_matrix:new m.UniformMatrix4f(c),u_label_plane_matrix:new m.UniformMatrix4f(c),u_coord_matrix:new m.UniformMatrix4f(c),u_is_text:new m.Uniform1i(c),u_pitch_with_map:new m.Uniform1i(c),u_texsize:new m.Uniform2f(c),u_tile_id:new m.Uniform3f(c),u_zoom_transition:new m.Uniform1f(c),u_inv_rot_matrix:new m.UniformMatrix4f(c),u_merc_center:new m.Uniform2f(c),u_camera_forward:new m.Uniform3f(c),u_tile_matrix:new m.UniformMatrix4f(c),u_up_vector:new m.Uniform3f(c),u_ecef_origin:new m.Uniform3f(c),u_texture:new m.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new m.Uniform1i(c),u_is_size_feature_constant:new m.Uniform1i(c),u_size_t:new m.Uniform1f(c),u_size:new m.Uniform1f(c),u_camera_to_center_distance:new m.Uniform1f(c),u_rotate_symbol:new m.Uniform1i(c),u_aspect_ratio:new m.Uniform1f(c),u_fade_change:new m.Uniform1f(c),u_matrix:new m.UniformMatrix4f(c),u_label_plane_matrix:new m.UniformMatrix4f(c),u_coord_matrix:new m.UniformMatrix4f(c),u_is_text:new m.Uniform1i(c),u_pitch_with_map:new m.Uniform1i(c),u_texsize:new m.Uniform2f(c),u_texture:new m.Uniform1i(c),u_gamma_scale:new m.Uniform1f(c),u_device_pixel_ratio:new m.Uniform1f(c),u_tile_id:new m.Uniform3f(c),u_zoom_transition:new m.Uniform1f(c),u_inv_rot_matrix:new m.UniformMatrix4f(c),u_merc_center:new m.Uniform2f(c),u_camera_forward:new m.Uniform3f(c),u_tile_matrix:new m.UniformMatrix4f(c),u_up_vector:new m.Uniform3f(c),u_ecef_origin:new m.Uniform3f(c),u_is_halo:new m.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new m.Uniform1i(c),u_is_size_feature_constant:new m.Uniform1i(c),u_size_t:new m.Uniform1f(c),u_size:new m.Uniform1f(c),u_camera_to_center_distance:new m.Uniform1f(c),u_rotate_symbol:new m.Uniform1i(c),u_aspect_ratio:new m.Uniform1f(c),u_fade_change:new m.Uniform1f(c),u_matrix:new m.UniformMatrix4f(c),u_label_plane_matrix:new m.UniformMatrix4f(c),u_coord_matrix:new m.UniformMatrix4f(c),u_is_text:new m.Uniform1i(c),u_pitch_with_map:new m.Uniform1i(c),u_texsize:new m.Uniform2f(c),u_texsize_icon:new m.Uniform2f(c),u_texture:new m.Uniform1i(c),u_texture_icon:new m.Uniform1i(c),u_gamma_scale:new m.Uniform1f(c),u_device_pixel_ratio:new m.Uniform1f(c),u_is_halo:new m.Uniform1i(c)}),background:c=>({u_matrix:new m.UniformMatrix4f(c),u_opacity:new m.Uniform1f(c),u_color:new m.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new m.UniformMatrix4f(c),u_opacity:new m.Uniform1f(c),u_image:new m.Uniform1i(c),u_pattern_tl:new m.Uniform2f(c),u_pattern_br:new m.Uniform2f(c),u_texsize:new m.Uniform2f(c),u_pattern_size:new m.Uniform2f(c),u_pixel_coord_upper:new m.Uniform2f(c),u_pixel_coord_lower:new m.Uniform2f(c),u_tile_units_to_pixels:new m.Uniform1f(c)}),terrainRaster:Vo,terrainDepth:Vo,skybox:c=>({u_matrix:new m.UniformMatrix4f(c),u_sun_direction:new m.Uniform3f(c),u_cubemap:new m.Uniform1i(c),u_opacity:new m.Uniform1f(c),u_temporal_offset:new m.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new m.UniformMatrix4f(c),u_color_ramp:new m.Uniform1i(c),u_center_direction:new m.Uniform3f(c),u_radius:new m.Uniform1f(c),u_opacity:new m.Uniform1f(c),u_temporal_offset:new m.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new m.UniformMatrix3f(c),u_sun_direction:new m.Uniform3f(c),u_sun_intensity:new m.Uniform1f(c),u_color_tint_r:new m.Uniform4f(c),u_color_tint_m:new m.Uniform4f(c),u_luminance:new m.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new m.UniformMatrix4f(c),u_globe_matrix:new m.UniformMatrix4f(c),u_normalize_matrix:new m.UniformMatrix4f(c),u_merc_matrix:new m.UniformMatrix4f(c),u_zoom_transition:new m.Uniform1f(c),u_merc_center:new m.Uniform2f(c),u_image0:new m.Uniform1i(c),u_grid_matrix:new m.UniformMatrix3f(c),u_skirt_height:new m.Uniform1f(c),u_frustum_tl:new m.Uniform3f(c),u_frustum_tr:new m.Uniform3f(c),u_frustum_br:new m.Uniform3f(c),u_frustum_bl:new m.Uniform3f(c),u_globe_pos:new m.Uniform3f(c),u_globe_radius:new m.Uniform1f(c),u_viewport:new m.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new m.Uniform3f(c),u_frustum_tr:new m.Uniform3f(c),u_frustum_br:new m.Uniform3f(c),u_frustum_bl:new m.Uniform3f(c),u_horizon:new m.Uniform1f(c),u_transition:new m.Uniform1f(c),u_fadeout_range:new m.Uniform1f(c),u_color:new m.Uniform4f(c),u_high_color:new m.Uniform4f(c),u_space_color:new m.Uniform4f(c),u_star_intensity:new m.Uniform1f(c),u_star_density:new m.Uniform1f(c),u_star_size:new m.Uniform1f(c),u_temporal_offset:new m.Uniform1f(c),u_horizon_angle:new m.Uniform1f(c),u_rotation_matrix:new m.UniformMatrix4f(c)})};let $s;function Is(c,n,a,p,y,w,C){const P=c.context,V=P.gl,K=c.transform,Y=c.useProgram("collisionBox"),ce=[];let Pe=0,Ke=0;for(let mt=0;mt<p.length;mt++){const Ut=p[mt],jt=n.getTile(Ut),It=jt.getBucket(a);if(!It)continue;const tn=Gi(Ut,It,K);let Kt=tn;0===y[0]&&0===y[1]||(Kt=c.translatePosMatrix(tn,jt,y,w));const ln=C?It.textCollisionBox:It.iconCollisionBox,rr=It.collisionCircleArray;if(rr.length>0){const cn=m.create(),Dn=Kt;m.mul(cn,It.placementInvProjMatrix,K.glCoordMatrix),m.mul(cn,cn,It.placementViewportMatrix),ce.push({circleArray:rr,circleOffset:Ke,transform:Dn,invTransform:cn,projection:It.getProjection()}),Pe+=rr.length/4,Ke=Pe}ln&&(c.terrain&&c.terrain.setupElevationDraw(jt,Y),Y.draw(P,V.LINES,m.DepthMode.disabled,m.StencilMode.disabled,c.colorModeForRenderPass(),m.CullFaceMode.disabled,Mc(Kt,K,jt,It.getProjection()),a.id,ln.layoutVertexBuffer,ln.indexBuffer,ln.segments,null,K.zoom,null,[ln.collisionVertexBuffer,ln.collisionVertexBufferExt]))}if(!C||!ce.length)return;const Ye=c.useProgram("collisionCircle"),rt=new m.StructArrayLayout2f1f2i16;rt.resize(4*Pe),rt._trim();let ot=0;for(const mt of ce)for(let Ut=0;Ut<mt.circleArray.length/4;Ut++){const jt=4*Ut,It=mt.circleArray[jt+0],tn=mt.circleArray[jt+1],Kt=mt.circleArray[jt+2],ln=mt.circleArray[jt+3];rt.emplace(ot++,It,tn,Kt,ln,0),rt.emplace(ot++,It,tn,Kt,ln,1),rt.emplace(ot++,It,tn,Kt,ln,2),rt.emplace(ot++,It,tn,Kt,ln,3)}(!$s||$s.length<2*Pe)&&($s=function(mt){const Ut=2*mt,jt=new m.StructArrayLayout3ui6;jt.resize(Ut),jt._trim();for(let It=0;It<Ut;It++){const tn=6*It;jt.uint16[tn+0]=4*It+0,jt.uint16[tn+1]=4*It+1,jt.uint16[tn+2]=4*It+2,jt.uint16[tn+3]=4*It+2,jt.uint16[tn+4]=4*It+3,jt.uint16[tn+5]=4*It+0}return jt}(Pe));const pe=P.createIndexBuffer($s,!0),he=P.createVertexBuffer(rt,m.collisionCircleLayout.members,!0);for(const mt of ce){const Ut={u_matrix:mt.transform,u_inv_matrix:mt.invTransform,u_camera_to_center_distance:(gt=K).getCameraToCenterDistance(mt.projection),u_viewport_size:[gt.width,gt.height]};Ye.draw(P,V.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,c.colorModeForRenderPass(),m.CullFaceMode.disabled,Ut,a.id,he,pe,m.SegmentVector.simpleSegment(0,2*mt.circleOffset,mt.circleArray.length,mt.circleArray.length/2),null,K.zoom)}var gt;he.destroy(),pe.destroy()}const Yo=m.create();function uo({width:c,height:n,anchor:a,textOffset:p,textScale:y},w){const{horizontalAlign:C,verticalAlign:P}=m.getAnchorAlignment(a),V=-(C-.5)*c,K=-(P-.5)*n,Y=m.evaluateVariableOffset(a,p);return new m.Point((V/y+Y[0])*w,(K/y+Y[1])*w)}function Ns(c,n,a,p,y,w,C,P,V,K,Y){const ce=c.text.placedSymbolArray,Pe=c.text.dynamicLayoutVertexArray,Ke=c.icon.dynamicLayoutVertexArray,Ye={},rt=c.getProjection(),ot=ys(P,rt,w),pe=w.elevation,he=rt.upVectorScale(P.canonical,w.center.lat,w.worldSize).metersToTile;Pe.clear();for(let gt=0;gt<ce.length;gt++){const mt=ce.get(gt),{tileAnchorX:Ut,tileAnchorY:jt,numGlyphs:It}=mt,tn=mt.hidden||!mt.crossTileID||c.allowVerticalPlacement&&!mt.placedOrientation?null:p[mt.crossTileID];if(tn){let Kt=0,ln=0,rr=0;if(pe){const Yn=pe?pe.getAtTileOffset(P,Ut,jt):0,[Xr,bi,Br]=rt.upVector(P.canonical,Ut,jt);Kt=Yn*Xr*he,ln=Yn*bi*he,rr=Yn*Br*he}let[cn,Dn,an,Kn]=ei(mt.projectedAnchorX+Kt,mt.projectedAnchorY+ln,mt.projectedAnchorZ+rr,a?ot:C);const dn=Mr(w.getCameraToCenterDistance(rt),Kn);let Ln=y.evaluateSizeForFeature(c.textSizeData,K,mt)*dn/m.ONE_EM;a&&(Ln*=c.tilePixelRatio/V);const Nn=uo(tn,Ln);a?(({x:cn,y:Dn,z:an}=rt.projectTilePoint(Ut+Nn.x,jt+Nn.y,P.canonical)),[cn,Dn,an]=ei(cn+Kt,Dn+ln,an+rr,C)):(n&&Nn._rotate(-w.angle),cn+=Nn.x,Dn+=Nn.y,an=0);const Wn=c.allowVerticalPlacement&&mt.placedOrientation===m.WritingMode.vertical?Math.PI/2:0;for(let Yn=0;Yn<It;Yn++)m.addDynamicAttributes(Pe,cn,Dn,an,Wn);Y&&mt.associatedIconIndex>=0&&(Ye[mt.associatedIconIndex]={x:cn,y:Dn,z:an,angle:Wn})}else _s(It,Pe)}if(Y){Ke.clear();const gt=c.icon.placedSymbolArray;for(let mt=0;mt<gt.length;mt++){const Ut=gt.get(mt),{numGlyphs:jt}=Ut,It=Ye[mt];if(Ut.hidden||!It)_s(jt,Ke);else{const{x:tn,y:Kt,z:ln,angle:rr}=It;for(let cn=0;cn<jt;cn++)m.addDynamicAttributes(Ke,tn,Kt,ln,rr)}}c.icon.dynamicLayoutVertexBuffer.updateData(Ke)}c.text.dynamicLayoutVertexBuffer.updateData(Pe)}function Ml(c,n,a){return a.iconsInText&&n?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function tl(c,n,a,p,y,w,C,P,V,K,Y,ce){const Pe=c.context,Ke=Pe.gl,Ye=c.transform,rt="map"===P,ot="map"===V,pe=rt&&"point"!==a.layout.get("symbol-placement"),he=rt&&!ot&&!pe,gt=void 0!==a.layout.get("symbol-sort-key").constantOr(1);let mt=!1;const Ut=c.depthModeForSublayer(0,m.DepthMode.ReadOnly),jt=[m.mercatorXfromLng(Ye.center.lng),m.mercatorYfromLat(Ye.center.lat)],It=a.layout.get("text-variable-anchor"),tn="globe"===Ye.projection.name,Kt=[],ln=[0,-1,0];let rr=ln;!tn&&!Ye.mercatorFromTransition||rt||(rr=function(cn){const Dn=cn._camera.getWorldToCamera(cn.worldSize,1),an=m.multiply([],Dn,cn.globeMatrix);m.invert(an,an);const Kn=[0,0,0],dn=[0,1,0,0];return m.transformMat4$1(dn,dn,an),Kn[0]=dn[0],Kn[1]=dn[1],Kn[2]=dn[2],m.normalize(Kn,Kn),Kn}(Ye));for(const cn of p){const Dn=n.getTile(cn),an=Dn.getBucket(a);if(!an||"mercator"===an.projection.name&&tn)continue;const Kn=y?an.text:an.icon;if(!Kn||an.fullyClipped||!Kn.segments.get().length)continue;const dn=Kn.programConfigurations.get(a.id),Ln=y||an.sdfIcons,Nn=y?an.textSizeData:an.iconSizeData,Wn=ot||0!==Ye.pitch,Yn=m.evaluateSizeForZoom(Nn,Ye.zoom);let Xr,bi,Br,R,L=[0,0],$=null;if(y)bi=Dn.glyphAtlasTexture,Br=Ke.LINEAR,Xr=Dn.glyphAtlasTexture.size,an.iconsInText&&(L=Dn.imageAtlasTexture.size,$=Dn.imageAtlasTexture,R=Wn||c.options.rotating||c.options.zooming||"composite"===Nn.kind||"camera"===Nn.kind?Ke.LINEAR:Ke.NEAREST);else{const Yr=1!==a.layout.get("icon-size").constantOr(0)||an.iconsNeedLinear;bi=Dn.imageAtlasTexture,Br=Ln||c.options.rotating||c.options.zooming||Yr||Wn?Ke.LINEAR:Ke.NEAREST,Xr=Dn.imageAtlasTexture.size}const ee="globe"===an.projection.name,Ee=ee?rr:ln,st=ee?m.globeToMercatorTransition(Ye.zoom):0,Et=ys(cn,an.getProjection(),Ye),en=Ye.calculatePixelsToTileUnitsMatrix(Dn),Lt=bt(Et,Dn.tileID.canonical,ot,rt,Ye,an.getProjection(),en),gn=c.terrain&&ot&&pe?m.invert(m.create(),Lt):Yo,Rn=sr(Et,Dn.tileID.canonical,ot,rt,Ye,an.getProjection(),en),kn=It&&an.hasTextData(),Bn="none"!==a.layout.get("icon-text-fit")&&kn&&an.hasIconData();if(pe){const Yr=Ye.elevation,ri=Yr?Yr.getAtTileOffsetFunc(cn,Ye.center.lat,Ye.worldSize,an.getProjection()):null,Mi=On(Et,Dn.tileID.canonical,ot,rt,Ye,an.getProjection(),en);xi(an,Et,c,y,Mi,Rn,ot,K,ri,cn)}const Jn=pe||y&&It||Bn,er=c.translatePosMatrix(Et,Dn,w,C),Vr=Jn?Yo:Lt,ui=c.translatePosMatrix(Rn,Dn,w,C,!0),Yt=an.getProjection().createInversionMatrix(Ye,cn.canonical),Tr=[];c.terrainRenderModeElevated()&&ot&&Tr.push("PITCH_WITH_MAP_TERRAIN"),ee&&Tr.push("PROJECTION_GLOBE_VIEW"),Jn&&Tr.push("PROJECTED_POS_ON_VIEWPORT");const Hs=Ln&&0!==a.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let Ms;Ms=Ln?an.iconsInText?ic(Nn.kind,Yn,he,ot,c,er,Vr,ui,Xr,L,cn,st,jt,Yt,Ee,an.getProjection()):Gl(Nn.kind,Yn,he,ot,c,er,Vr,ui,y,Xr,!0,cn,st,jt,Yt,Ee,an.getProjection()):vc(Nn.kind,Yn,he,ot,c,er,Vr,ui,y,Xr,cn,st,jt,Yt,Ee,an.getProjection());const mi={program:c.useProgram(Ml(Ln,y,an),dn,Tr),buffers:Kn,uniformValues:Ms,atlasTexture:bi,atlasTextureIcon:$,atlasInterpolation:Br,atlasInterpolationIcon:R,isSDF:Ln,hasHalo:Hs,tile:Dn,labelPlaneMatrixInv:gn};if(gt&&an.canOverlap){mt=!0;const Yr=Kn.segments.get();for(const ri of Yr)Kt.push({segments:new m.SegmentVector([ri]),sortKey:ri.sortKey,state:mi})}else Kt.push({segments:Kn.segments,sortKey:0,state:mi})}mt&&Kt.sort((cn,Dn)=>cn.sortKey-Dn.sortKey);for(const cn of Kt){const Dn=cn.state;if(c.terrain&&c.terrain.setupElevationDraw(Dn.tile,Dn.program,{useDepthForOcclusion:!tn,labelPlaneMatrixInv:Dn.labelPlaneMatrixInv}),Pe.activeTexture.set(Ke.TEXTURE0),Dn.atlasTexture.bind(Dn.atlasInterpolation,Ke.CLAMP_TO_EDGE),Dn.atlasTextureIcon&&(Pe.activeTexture.set(Ke.TEXTURE1),Dn.atlasTextureIcon&&Dn.atlasTextureIcon.bind(Dn.atlasInterpolationIcon,Ke.CLAMP_TO_EDGE)),Dn.isSDF){const an=Dn.uniformValues;Dn.hasHalo&&(an.u_is_halo=1,du(Dn.buffers,cn.segments,a,c,Dn.program,Ut,Y,ce,an)),an.u_is_halo=0}du(Dn.buffers,cn.segments,a,c,Dn.program,Ut,Y,ce,Dn.uniformValues)}}function du(c,n,a,p,y,w,C,P,V){const K=p.context,Y=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];y.draw(K,K.gl.TRIANGLES,w,C,P,m.CullFaceMode.disabled,V,a.id,c.layoutVertexBuffer,c.indexBuffer,n,a.paint,p.transform.zoom,c.programConfigurations.get(a.id),Y)}function eu(c,n,a,p,y,w,C){const P=c.context.gl,V=a.paint.get("fill-pattern"),K=V&&V.constantOr(1);let Y,ce,Pe,Ke,Ye;C?(ce=K&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=P.LINES):(ce=K?"fillPattern":"fill",Y=P.TRIANGLES);for(const rt of p){const ot=n.getTile(rt);if(K&&!ot.patternsLoaded())continue;const pe=ot.getBucket(a);if(!pe)continue;c.prepareDrawTile();const he=pe.programConfigurations.get(a.id),gt=c.useProgram(ce,he);K&&(c.context.activeTexture.set(P.TEXTURE0),ot.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),he.updatePaintBuffers());const mt=V.constantOr(null);if(mt&&ot.imageAtlas){const jt=ot.imageAtlas.patternPositions[mt.toString()];jt&&he.setConstantPatternPositions(jt)}const Ut=c.translatePosMatrix(rt.projMatrix,ot,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(C){Ke=pe.indexBuffer2,Ye=pe.segments2;const jt=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];Pe="fillOutlinePattern"===ce&&K?el(Ut,c,ot,jt):vs(Ut,jt)}else Ke=pe.indexBuffer,Ye=pe.segments,Pe=K?da(Ut,c,ot):Ja(Ut);c.prepareDrawProgram(c.context,gt,rt.toUnwrapped()),gt.draw(c.context,Y,y,c.stencilModeForClipping(rt),w,m.CullFaceMode.disabled,Pe,a.id,pe.layoutVertexBuffer,Ke,Ye,a.paint,c.transform.zoom,he)}}function nl(c,n,a,p,y,w,C){const P=c.context,V=P.gl,K=c.transform,Y=a.paint.get("fill-extrusion-pattern"),ce=Y.constantOr(1),Pe=a.paint.get("fill-extrusion-opacity"),Ke=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],Ye=a.layout.get("fill-extrusion-edge-radius"),rt=Ye>0&&!a.paint.get("fill-extrusion-rounded-roof"),ot=rt?0:Ye,pe="globe"===K.projection.name?m.fillExtrusionHeightLift():0,he="globe"===K.projection.name,gt=he?m.globeToMercatorTransition(K.zoom):0,mt=[m.mercatorXfromLng(K.center.lng),m.mercatorYfromLat(K.center.lat)],Ut=[];he&&Ut.push("PROJECTION_GLOBE_VIEW"),Ke[0]>0&&Ut.push("FAUX_AO"),rt&&Ut.push("ZERO_ROOF_RADIUS");for(const jt of p){const It=n.getTile(jt),tn=It.getBucket(a);if(!tn||tn.projection.name!==K.projection.name)continue;const Kt=tn.programConfigurations.get(a.id),ln=c.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",Kt,Ut);if(c.terrain){const Ln=c.terrain;if(c.style.terrainSetForDrapingOnly())Ln.setupElevationDraw(It,ln,{useMeterToDem:!0});else{if(!tn.enableTerrain)continue;if(Ln.setupElevationDraw(It,ln,{useMeterToDem:!0}),sc(P,n,jt,tn,a,Ln),!tn.centroidVertexBuffer){const Nn=ln.attributes.a_centroid_pos;void 0!==Nn&&V.vertexAttrib2f(Nn,0,0)}}}ce&&(c.context.activeTexture.set(V.TEXTURE0),It.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Kt.updatePaintBuffers());const rr=Y.constantOr(null);if(rr&&It.imageAtlas){const Ln=It.imageAtlas.patternPositions[rr.toString()];Ln&&Kt.setConstantPatternPositions(Ln)}const cn=c.translatePosMatrix(jt.projMatrix,It,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Dn=K.projection.createInversionMatrix(K,jt.canonical),an=a.paint.get("fill-extrusion-vertical-gradient"),Kn=ce?nc(cn,c,an,Pe,Ke,ot,jt,It,pe,gt,mt,Dn):cl(cn,c,an,Pe,Ke,ot,jt,pe,gt,mt,Dn);c.prepareDrawProgram(P,ln,jt.toUnwrapped());const dn=[];c.terrain&&dn.push(tn.centroidVertexBuffer),he&&dn.push(tn.layoutVertexExtBuffer),ln.draw(P,P.gl.TRIANGLES,y,w,C,m.CullFaceMode.backCCW,Kn,a.id,tn.layoutVertexBuffer,tn.indexBuffer,tn.segments,a.paint,c.transform.zoom,Kt,dn)}}function sc(c,n,a,p,y,w){const C=[pe=>{let he=pe.canonical.x-1,gt=pe.wrap;return he<0&&(he=(1<<pe.canonical.z)-1,gt--),new m.OverscaledTileID(pe.overscaledZ,gt,pe.canonical.z,he,pe.canonical.y)},pe=>{let he=pe.canonical.x+1,gt=pe.wrap;return he===1<<pe.canonical.z&&(he=0,gt++),new m.OverscaledTileID(pe.overscaledZ,gt,pe.canonical.z,he,pe.canonical.y)},pe=>new m.OverscaledTileID(pe.overscaledZ,pe.wrap,pe.canonical.z,pe.canonical.x,(0===pe.canonical.y?1<<pe.canonical.z:pe.canonical.y)-1),pe=>new m.OverscaledTileID(pe.overscaledZ,pe.wrap,pe.canonical.z,pe.canonical.x,pe.canonical.y===(1<<pe.canonical.z)-1?0:pe.canonical.y+1)],P=pe=>{const he=n.getSource().minzoom,gt=Ut=>{const jt=n.getTileByID(Ut);if(jt&&jt.hasData())return jt.getBucket(y)},mt=[0,-1,1];for(const Ut of mt){if(pe.overscaledZ+Ut<he)continue;const jt=gt(pe.calculateScaledKey(pe.overscaledZ+Ut));if(jt)return jt}},V=[0,0,0],K=(pe,he)=>(V[0]=Math.min(pe.min.y,he.min.y),V[1]=Math.max(pe.max.y,he.max.y),V[2]=m.EXTENT-he.min.x>pe.max.x?he.min.x-m.EXTENT:pe.max.x,V),Y=(pe,he)=>(V[0]=Math.min(pe.min.x,he.min.x),V[1]=Math.max(pe.max.x,he.max.x),V[2]=m.EXTENT-he.min.y>pe.max.y?he.min.y-m.EXTENT:pe.max.y,V),ce=[(pe,he)=>K(pe,he),(pe,he)=>K(he,pe),(pe,he)=>Y(pe,he),(pe,he)=>Y(he,pe)],Pe=new m.Point(0,0);let Ke,Ye,rt;const ot=(pe,he,gt,mt,Ut)=>{const jt=[[mt?gt:pe,mt?pe:gt,0],[mt?gt:he,mt?he:gt,0]],It=Ut<0?m.EXTENT+Ut:Ut,tn=[mt?It:(pe+he)/2,mt?(pe+he)/2:It,0];return 0===gt&&Ut<0||0!==gt&&Ut>0?w.getForTilePoints(rt,[tn],!0,Ye):jt.push(tn),w.getForTilePoints(a,jt,!0,Ke),Math.max(jt[0][2],jt[1][2],tn[2])/w.exaggeration()};for(let pe=0;pe<4;pe++){const he=(pe<2?1:5)-pe,gt=p.borders[pe];if(0===gt.length)continue;const mt=rt=C[pe](a),Ut=P(mt);if(!(Ut&&Ut instanceof m.FillExtrusionBucket&&Ut.enableTerrain)||p.borderDoneWithNeighborZ[pe]===Ut.canonical.z&&Ut.borderDoneWithNeighborZ[he]===p.canonical.z||(Ye=w.findDEMTileFor(mt),!Ye||!Ye.dem))continue;if(!Ke){const Kt=w.findDEMTileFor(a);if(!Kt||!Kt.dem)return;Ke=Kt}const jt=Ut.borders[he];let It=0;const tn=Ut.borderDoneWithNeighborZ[he]!==p.canonical.z;if(p.canonical.z===Ut.canonical.z){for(let Kt=0;Kt<gt.length;Kt++){const ln=p.featuresOnBorder[gt[Kt]],rr=ln.borders[pe];let cn;for(;It<jt.length&&(cn=Ut.featuresOnBorder[jt[It]],!(cn.borders[he][1]>rr[0]+3));)tn&&Ut.encodeCentroid(void 0,cn,!1),It++;if(cn&&It<jt.length){const Dn=It;let an=0;for(;!(cn.borders[he][0]>rr[1]-3)&&(an++,++It!==jt.length);)cn=Ut.featuresOnBorder[jt[It]];if(cn=Ut.featuresOnBorder[jt[Dn]],ln.intersectsCount()>1||cn.intersectsCount()>1||1!==an){1!==an&&(It=Dn),p.encodeCentroid(void 0,ln,!1),tn&&Ut.encodeCentroid(void 0,cn,!1);continue}const Kn=ce[pe](ln,cn),dn=pe%2?m.EXTENT-1:0;Pe.x=ot(Kn[0],Math.min(m.EXTENT-1,Kn[1]),dn,pe<2,Kn[2]),Pe.y=0,p.encodeCentroid(Pe,ln,!1),tn&&Ut.encodeCentroid(Pe,cn,!1)}else p.encodeCentroid(void 0,ln,!1)}p.borderDoneWithNeighborZ[pe]=Ut.canonical.z,p.needsCentroidUpdate=!0,tn&&(Ut.borderDoneWithNeighborZ[he]=p.canonical.z,Ut.needsCentroidUpdate=!0)}else{for(const Kt of gt)p.encodeCentroid(void 0,p.featuresOnBorder[Kt],!1);if(tn){for(const Kt of jt)Ut.encodeCentroid(void 0,Ut.featuresOnBorder[Kt],!1);Ut.borderDoneWithNeighborZ[he]=p.canonical.z,Ut.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[pe]=Ut.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(c)}const os=new m.Color(1,0,0,1),Ec=new m.Color(0,1,0,1),zc=new m.Color(0,0,1,1),yo=new m.Color(1,0,1,1),Hl=new m.Color(0,1,1,1);function hu(c,n,a){const p=c.context,y=c.transform,w=p.gl,C="globe"===y.projection.name,P=C?["PROJECTION_GLOBE_VIEW"]:null;let V=a.projMatrix;if(C&&m.globeToMercatorTransition(y.zoom)>0){const ln=m.transitionTileAABBinECEF(a.canonical,y),rr=m.globeDenormalizeECEF(ln);V=m.multiply(new Float32Array(16),y.globeMatrix,rr),m.multiply(V,y.projMatrix,V)}const K=c.useProgram("debug",null,P),Y=n.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(Y,K);const ce=m.DepthMode.disabled,Pe=m.StencilMode.disabled,Ke=c.colorModeForRenderPass();p.activeTexture.set(w.TEXTURE0),c.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),C?Y._makeGlobeTileDebugBuffers(c.context,y):Y._makeDebugTileBoundsBuffers(c.context,y.projection);const rt=Y._tileDebugBuffer||c.debugBuffer,ot=Y._tileDebugIndexBuffer||c.debugIndexBuffer,pe=Y._tileDebugSegments||c.debugSegments;K.draw(p,w.LINE_STRIP,ce,Pe,Ke,m.CullFaceMode.disabled,Al(V,m.Color.red),"$debug",rt,ot,pe,null,null,null,[Y._globeTileDebugBorderBuffer]);const he=Y.latestRawTileData,gt=Math.floor((he&&he.byteLength||0)/1024),mt=n.getTile(a).tileSize,Ut=512/Math.min(mt,512)*(a.overscaledZ/y.zoom)*.5;let jt=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(jt+=` => ${a.overscaledZ}`),jt+=` ${gt}kb`,function(ln,rr){ln.initDebugOverlayCanvas();const cn=ln.debugOverlayCanvas,Dn=ln.context.gl,an=ln.debugOverlayCanvas.getContext("2d");an.clearRect(0,0,cn.width,cn.height),an.shadowColor="white",an.shadowBlur=2,an.lineWidth=1.5,an.strokeStyle="white",an.textBaseline="top",an.font="bold 36px Open Sans, sans-serif",an.fillText(rr,5,5),an.strokeText(rr,5,5),ln.debugOverlayTexture.update(cn),ln.debugOverlayTexture.bind(Dn.LINEAR,Dn.CLAMP_TO_EDGE)}(c,jt);const It=Y._tileDebugTextBuffer||c.debugBuffer,tn=Y._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Kt=Y._tileDebugTextSegments||c.debugSegments;K.draw(p,w.TRIANGLES,ce,Pe,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,Al(V,m.Color.transparent,Ut),"$debug",It,tn,Kt,null,null,null,[Y._globeTileDebugTextBuffer])}function oc(c,n,a,p){gs(c,0,n+a/2,c.transform.width,a,p)}function Ps(c,n,a,p){gs(c,n-a/2,0,a,c.transform.height,p)}function gs(c,n,a,p,y,w){const C=c.context,P=C.gl;P.enable(P.SCISSOR_TEST),P.scissor(n*m.exported.devicePixelRatio,a*m.exported.devicePixelRatio,p*m.exported.devicePixelRatio,y*m.exported.devicePixelRatio),C.clear({color:w}),P.disable(P.SCISSOR_TEST)}const Wl=m.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ja}=Wl;function ya(c,n,a,p){c.emplaceBack(n,a,p)}class ac{constructor(n){this.vertexArray=new m.StructArrayLayout3f12,this.indices=new m.StructArrayLayout3ui6,ya(this.vertexArray,-1,-1,1),ya(this.vertexArray,1,-1,1),ya(this.vertexArray,-1,1,1),ya(this.vertexArray,1,1,1),ya(this.vertexArray,-1,-1,-1),ya(this.vertexArray,1,-1,-1),ya(this.vertexArray,-1,1,-1),ya(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ja),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=m.SegmentVector.simpleSegment(0,0,36,12)}}function ha(c,n,a,p,y,w){const C=c.gl,P=n.paint.get("sky-atmosphere-color"),V=n.paint.get("sky-atmosphere-halo-color"),K=n.paint.get("sky-atmosphere-sun-intensity"),Y={u_matrix_3f:m.fromMat4(m.create$1(),p),u_sun_direction:y,u_sun_intensity:K,u_color_tint_r:[(Ye=P).r,Ye.g,Ye.b,Ye.a],u_color_tint_m:[(rt=V).r,rt.g,rt.b,rt.a],u_luminance:5e-5};var Ye,rt;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+w,n.skyboxTexture,0),a.draw(c,C.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.unblended,m.CullFaceMode.frontCW,Y,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ql=m.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rl{constructor(n){const a=new m.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const p=new m.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,ql.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=m.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ho={symbol:function(c,n,a,p,y){if("translucent"!==c.renderPass)return;const w=m.StencilMode.disabled,C=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(P,V,K,Y,ce,Pe,Ke){const Ye=V.transform,rt="map"===ce,ot="map"===Pe;for(const pe of P){const he=Y.getTile(pe),gt=he.getBucket(K);if(!gt||!gt.text||!gt.text.segments.get().length)continue;const mt=m.evaluateSizeForZoom(gt.textSizeData,Ye.zoom),Ut=ys(pe,gt.getProjection(),Ye),jt=Ye.calculatePixelsToTileUnitsMatrix(he),It=bt(Ut,he.tileID.canonical,ot,rt,Ye,gt.getProjection(),jt),tn="none"!==K.layout.get("icon-text-fit")&&gt.hasIconData();if(mt){const Kt=Math.pow(2,Ye.zoom-he.tileID.overscaledZ);Ns(gt,rt,ot,Ke,m.symbolSize,Ye,It,pe,Kt,mt,tn)}}}(p,c,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),y),0!==a.paint.get("icon-opacity").constantOr(1)&&tl(c,n,a,p,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),w,C),0!==a.paint.get("text-opacity").constantOr(1)&&tl(c,n,a,p,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),w,C),n.map.showCollisionBoxes&&(Is(c,n,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Is(c,n,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,a,p){if("translucent"!==c.renderPass)return;const y=a.paint.get("circle-opacity"),w=a.paint.get("circle-stroke-width"),C=a.paint.get("circle-stroke-opacity"),P=void 0!==a.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===w.constantOr(1)||0===C.constantOr(1)))return;const V=c.context,K=V.gl,Y=c.transform,ce=c.depthModeForSublayer(0,m.DepthMode.ReadOnly),Pe=m.StencilMode.disabled,Ke=c.colorModeForRenderPass(),Ye="globe"===Y.projection.name,rt=[m.mercatorXfromLng(Y.center.lng),m.mercatorYfromLat(Y.center.lat)],ot=[];for(let he=0;he<p.length;he++){const gt=p[he],mt=n.getTile(gt),Ut=mt.getBucket(a);if(!Ut||Ut.projection.name!==Y.projection.name)continue;const jt=Ut.programConfigurations.get(a.id),It=wo(a);Ye&&It.push("PROJECTION_GLOBE_VIEW");const tn=c.useProgram("circle",jt,It),Kt=Ut.layoutVertexBuffer,ln=Ut.globeExtVertexBuffer,rr=Ut.indexBuffer,cn=Y.projection.createInversionMatrix(Y,gt.canonical),Dn={programConfiguration:jt,program:tn,layoutVertexBuffer:Kt,globeExtVertexBuffer:ln,indexBuffer:rr,uniformValues:Sl(c,gt,mt,cn,rt,a),tile:mt};if(P){const an=Ut.segments.get();for(const Kn of an)ot.push({segments:new m.SegmentVector([Kn]),sortKey:Kn.sortKey,state:Dn})}else ot.push({segments:Ut.segments,sortKey:0,state:Dn})}P&&ot.sort((he,gt)=>he.sortKey-gt.sortKey);const pe={useDepthForOcclusion:!Ye};for(const he of ot){const{programConfiguration:gt,program:mt,layoutVertexBuffer:Ut,globeExtVertexBuffer:jt,indexBuffer:It,uniformValues:tn,tile:Kt}=he.state,ln=he.segments;c.terrain&&c.terrain.setupElevationDraw(Kt,mt,pe),c.prepareDrawProgram(V,mt,Kt.tileID.toUnwrapped()),mt.draw(V,K.TRIANGLES,ce,Pe,Ke,m.CullFaceMode.disabled,tn,a.id,Ut,It,ln,a.paint,Y.zoom,gt,[jt])}},heatmap:function(c,n,a,p){if(0!==a.paint.get("heatmap-opacity"))if("offscreen"===c.renderPass){const y=c.context,w=y.gl,C=m.StencilMode.disabled,P=new m.ColorMode([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Ke,Ye,rt,ot){const pe=Ke.gl,he=Ye.width*ot,gt=Ye.height*ot;Ke.activeTexture.set(pe.TEXTURE1),Ke.viewport.set([0,0,he,gt]);let mt=rt.heatmapFbo;if(!mt||mt&&(mt.width!==he||mt.height!==gt)){mt&&mt.destroy();const Ut=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Ut),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),mt=rt.heatmapFbo=Ke.createFramebuffer(he,gt,!1),function(jt,It,tn,Kt,ln,rr){const cn=jt.gl;cn.texImage2D(cn.TEXTURE_2D,0,jt.isWebGL2&&jt.extRenderToTextureHalfFloat?cn.RGBA16F:cn.RGBA,ln,rr,0,cn.RGBA,jt.extRenderToTextureHalfFloat?jt.isWebGL2?cn.HALF_FLOAT:jt.extTextureHalfFloat.HALF_FLOAT_OES:cn.UNSIGNED_BYTE,null),Kt.colorAttachment.set(tn)}(Ke,0,Ut,mt,he,gt)}else pe.bindTexture(pe.TEXTURE_2D,mt.colorAttachment.get()),Ke.bindFramebuffer.set(mt.framebuffer)})(y,c,a,"globe"===c.transform.projection.name?.5:.25),y.clear({color:m.Color.transparent});const V=c.transform,K="globe"===V.projection.name,Y=K?["PROJECTION_GLOBE_VIEW"]:null,ce=K?m.CullFaceMode.frontCCW:m.CullFaceMode.disabled,Pe=[m.mercatorXfromLng(V.center.lng),m.mercatorYfromLat(V.center.lat)];for(let Ke=0;Ke<p.length;Ke++){const Ye=p[Ke];if(n.hasRenderableParent(Ye))continue;const rt=n.getTile(Ye),ot=rt.getBucket(a);if(!ot||ot.projection.name!==V.projection.name)continue;const pe=ot.programConfigurations.get(a.id),he=c.useProgram("heatmap",pe,Y),{zoom:gt}=c.transform;c.terrain&&c.terrain.setupElevationDraw(rt,he),c.prepareDrawProgram(y,he,Ye.toUnwrapped());const mt=V.projection.createInversionMatrix(V,Ye.canonical);he.draw(y,w.TRIANGLES,m.DepthMode.disabled,C,P,ce,Ts(c,Ye,rt,mt,Pe,gt,a.paint.get("heatmap-intensity")),a.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,a.paint,c.transform.zoom,pe,K?[ot.globeExtVertexBuffer]:null)}y.viewport.set([0,0,c.width,c.height])}else"translucent"===c.renderPass&&(c.context.setColorMode(c.colorModeForRenderPass()),function(y,w){const C=y.context,P=C.gl,V=w.heatmapFbo;if(!V)return;C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,V.colorAttachment.get()),C.activeTexture.set(P.TEXTURE1);let K=w.colorRampTexture;K||(K=w.colorRampTexture=new m.Texture(C,w.colorRamp,P.RGBA)),K.bind(P.LINEAR,P.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(C,P.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,y.colorModeForRenderPass(),m.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:w.paint.get("heatmap-opacity")},w.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,w.paint,y.transform.zoom)}(c,a))},line:function(c,n,a,p){if("translucent"!==c.renderPass)return;const y=a.paint.get("line-opacity"),w=a.paint.get("line-width");if(0===y.constantOr(1)||0===w.constantOr(1))return;const C=c.depthModeForSublayer(0,m.DepthMode.ReadOnly),P=c.colorModeForRenderPass(),V=c.terrain&&c.terrain.renderingToTexture?1:m.exported.devicePixelRatio,K=a.paint.get("line-dasharray"),Y=K.constantOr(1),ce=a.layout.get("line-cap"),Pe=a.paint.get("line-pattern"),Ke=Pe.constantOr(1),Ye=a.paint.get("line-gradient"),rt=Ke?"linePattern":"line",ot=c.context,pe=ot.gl,he=(mt=>{const Ut=[];zo(mt)&&Ut.push("RENDER_LINE_DASH"),mt.paint.get("line-gradient")&&Ut.push("RENDER_LINE_GRADIENT");const jt=mt.paint.get("line-trim-offset");0===jt[0]&&0===jt[1]||Ut.push("RENDER_LINE_TRIM_OFFSET");const It=mt.paint.get("line-pattern").constantOr(1),tn=1!==mt.paint.get("line-opacity").constantOr(1);return!It&&tn&&Ut.push("RENDER_LINE_ALPHA_DISCARD"),Ut})(a);let gt=he.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(gt=!1);for(const mt of p){const Ut=n.getTile(mt);if(Ke&&!Ut.patternsLoaded())continue;const jt=Ut.getBucket(a);if(!jt)continue;c.prepareDrawTile();const It=jt.programConfigurations.get(a.id),tn=c.useProgram(rt,It,he),Kt=Pe.constantOr(null);if(Kt&&Ut.imageAtlas){const Ln=Ut.imageAtlas.patternPositions[Kt.toString()];Ln&&It.setConstantPatternPositions(Ln)}const ln=K.constantOr(null),rr=ce.constantOr(null);if(!Ke&&ln&&rr&&Ut.lineAtlas){const Ln=Ut.lineAtlas.getDash(ln,rr);Ln&&It.setConstantPatternPositions(Ln)}let[cn,Dn]=a.paint.get("line-trim-offset");("round"===rr||"square"===rr)&&cn!==Dn&&(0===cn&&(cn-=1),1===Dn&&(Dn+=1));const an=c.terrain?mt.projMatrix:null,Kn=Ke?Uc(c,Ut,a,an,V):jl(c,Ut,a,an,jt.lineClipsArray.length,V,[cn,Dn]);if(Ye){const Ln=jt.gradients[a.id];let Nn=Ln.texture;if(a.gradientVersion!==Ln.version){let Wn=256;if(a.stepInterpolant){const Yn=n.getSource().maxzoom,Xr=mt.canonical.z===Yn?Math.ceil(1<<c.transform.maxZoom-mt.canonical.z):1;Wn=m.clamp(m.nextPowerOfTwo(jt.maxLineLength/m.EXTENT*1024*Xr),256,ot.maxTextureSize)}Ln.gradient=m.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Wn,image:Ln.gradient||void 0,clips:jt.lineClipsArray}),Ln.texture?Ln.texture.update(Ln.gradient):Ln.texture=new m.Texture(ot,Ln.gradient,pe.RGBA),Ln.version=a.gradientVersion,Nn=Ln.texture}ot.activeTexture.set(pe.TEXTURE1),Nn.bind(a.stepInterpolant?pe.NEAREST:pe.LINEAR,pe.CLAMP_TO_EDGE)}Y&&(ot.activeTexture.set(pe.TEXTURE0),Ut.lineAtlasTexture.bind(pe.LINEAR,pe.REPEAT),It.updatePaintBuffers()),Ke&&(ot.activeTexture.set(pe.TEXTURE0),Ut.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),It.updatePaintBuffers()),c.prepareDrawProgram(ot,tn,mt.toUnwrapped());const dn=Ln=>{tn.draw(ot,pe.TRIANGLES,C,Ln,P,m.CullFaceMode.disabled,Kn,a.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,a.paint,c.transform.zoom,It,[jt.layoutVertexBuffer2])};if(gt){const Ln=c.stencilModeForClipping(mt).ref;0===Ln&&c.terrain&&ot.clear({stencil:0});const Nn={func:pe.EQUAL,mask:255};Kn.u_alpha_discard_threshold=.8,dn(new m.StencilMode(Nn,Ln,255,pe.KEEP,pe.KEEP,pe.INVERT)),Kn.u_alpha_discard_threshold=0,dn(new m.StencilMode(Nn,Ln,255,pe.KEEP,pe.KEEP,pe.KEEP))}else dn(c.stencilModeForClipping(mt))}gt&&(c.resetStencilClippingMasks(),c.terrain&&ot.clear({stencil:0}))},fill:function(c,n,a,p){const y=a.paint.get("fill-color"),w=a.paint.get("fill-opacity");if(0===w.constantOr(1))return;const C=c.colorModeForRenderPass(),P=a.paint.get("fill-pattern"),V=c.opaquePassEnabledForLayer()&&!P.constantOr(1)&&1===y.constantOr(m.Color.transparent).a&&1===w.constantOr(0)?"opaque":"translucent";if(c.renderPass===V){const K=c.depthModeForSublayer(1,"opaque"===c.renderPass?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly);eu(c,n,a,p,K,C,!1)}if("translucent"===c.renderPass&&a.paint.get("fill-antialias")){const K=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,m.DepthMode.ReadOnly);eu(c,n,a,p,K,C,!0)}},"fill-extrusion":function(c,n,a,p){const y=a.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===c.renderPass){const w=new m.DepthMode(c.context.gl.LEQUAL,m.DepthMode.ReadWrite,c.depthRangeFor3D);if(1!==y||a.paint.get("fill-extrusion-pattern").constantOr(1))nl(c,n,a,p,w,m.StencilMode.disabled,m.ColorMode.disabled),nl(c,n,a,p,w,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const C=c.colorModeForRenderPass();nl(c,n,a,p,w,m.StencilMode.disabled,C)}}},hillshade:function(c,n,a,p){if("offscreen"!==c.renderPass&&"translucent"!==c.renderPass)return;const y=c.context,w=c.depthModeForSublayer(0,m.DepthMode.ReadOnly),C=c.colorModeForRenderPass(),P=c.terrain&&c.terrain.renderingToTexture,[V,K]="translucent"!==c.renderPass||P?[{},p]:c.stencilConfigForOverlap(p);for(const Y of K){const ce=n.getTile(Y);if(ce.needsHillshadePrepare&&"offscreen"===c.renderPass)Vc(c,ce,a,w,m.StencilMode.disabled,C);else if("translucent"===c.renderPass){const Pe=P&&c.terrain?c.terrain.stencilModeForRTTOverlap(Y):V[Y.overscaledZ];Ba(c,Y,ce,a,w,Pe,C)}}y.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,a,p,y,w){if("translucent"!==c.renderPass||0===a.paint.get("raster-opacity")||!p.length)return;const C=c.context,P=C.gl,V=n.getSource(),K=c.useProgram("raster"),Y=c.colorModeForRenderPass(),ce=c.terrain&&c.terrain.renderingToTexture,[Pe,Ke]=V instanceof Vt||ce?[{},p]:c.stencilConfigForOverlap(p),Ye=Ke[Ke.length-1].overscaledZ,rt=!c.options.moving;for(const ot of Ke){const pe=ce?m.DepthMode.disabled:c.depthModeForSublayer(ot.overscaledZ-Ye,1===a.paint.get("raster-opacity")?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly,P.LESS),he=ot.toUnwrapped(),gt=n.getTile(ot);if(ce&&(!gt||!gt.hasData()))continue;const mt=ce?ot.projMatrix:c.transform.calculateProjMatrix(he,rt),Ut=c.terrain&&ce?c.terrain.stencilModeForRTTOverlap(ot):Pe[ot.overscaledZ],jt=w?0:a.paint.get("raster-fade-duration");gt.registerFadeDuration(jt);const It=n.findLoadedParent(ot,0),tn=_a(gt,It,n,c.transform,jt);let Kt,ln;c.terrain&&c.terrain.prepareDrawTile();const rr="nearest"===a.paint.get("raster-resampling")?P.NEAREST:P.LINEAR;C.activeTexture.set(P.TEXTURE0),gt.texture.bind(rr,P.CLAMP_TO_EDGE),C.activeTexture.set(P.TEXTURE1),It?(It.texture.bind(rr,P.CLAMP_TO_EDGE),Kt=Math.pow(2,It.tileID.overscaledZ-gt.tileID.overscaledZ),ln=[gt.tileID.canonical.x*Kt%1,gt.tileID.canonical.y*Kt%1]):gt.texture.bind(rr,P.CLAMP_TO_EDGE),gt.texture.useMipmap&&C.extTextureFilterAnisotropic&&c.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const cn=yc(mt,ln||[0,0],Kt||1,tn,a,V instanceof Vt?V.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(C,K,he),V instanceof Vt)V.boundsBuffer&&V.boundsSegments&&K.draw(C,P.TRIANGLES,pe,m.StencilMode.disabled,Y,m.CullFaceMode.disabled,cn,a.id,V.boundsBuffer,c.quadTriangleIndexBuffer,V.boundsSegments);else{const{tileBoundsBuffer:Dn,tileBoundsIndexBuffer:an,tileBoundsSegments:Kn}=c.getTileBoundsBuffers(gt);K.draw(C,P.TRIANGLES,pe,Ut,Y,m.CullFaceMode.disabled,cn,a.id,Dn,an,Kn)}}c.resetStencilClippingMasks()},background:function(c,n,a,p){const y=a.paint.get("background-color"),w=a.paint.get("background-opacity");if(0===w)return;const C=c.context,P=C.gl,V=c.transform,K=V.tileSize,Y=a.paint.get("background-pattern");if(c.isPatternMissing(Y))return;const ce=!Y&&1===y.a&&1===w&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==ce)return;const Pe=m.StencilMode.disabled,Ke=c.depthModeForSublayer(0,"opaque"===ce?m.DepthMode.ReadWrite:m.DepthMode.ReadOnly),Ye=c.colorModeForRenderPass(),rt=c.useProgram(Y?"backgroundPattern":"background");let ot,pe=p;pe||(ot=c.getBackgroundTiles(),pe=Object.values(ot).map(he=>he.tileID)),Y&&(C.activeTexture.set(P.TEXTURE0),c.imageManager.bind(c.context));for(const he of pe){const gt=he.toUnwrapped(),mt=p?he.projMatrix:c.transform.calculateProjMatrix(gt);c.prepareDrawTile();const Ut=n?n.getTile(he):ot?ot[he.key]:new m.Tile(he,K,V.zoom,c),jt=Y?xc(mt,w,c,Y,{tileID:he,tileSize:K}):Dl(mt,w,y);c.prepareDrawProgram(C,rt,gt);const{tileBoundsBuffer:It,tileBoundsIndexBuffer:tn,tileBoundsSegments:Kt}=c.getTileBoundsBuffers(Ut);rt.draw(C,P.TRIANGLES,Ke,Pe,Ye,m.CullFaceMode.disabled,jt,a.id,It,tn,Kt)}},sky:function(c,n,a){const p=c.transform,y="mercator"===p.projection.name||"globe"===p.projection.name?1:m.smoothstep(7,8,p.zoom),w=a.paint.get("sky-opacity")*y;if(0===w)return;const C=c.context,P=a.paint.get("sky-type"),V=new m.DepthMode(C.gl.LEQUAL,m.DepthMode.ReadOnly,[0,1]),K=c.frameCounter/1e3%1;"atmosphere"===P?"offscreen"===c.renderPass?a.needsSkyboxCapture(c)&&(function(Y,ce,Pe,Ke){const Ye=Y.context,rt=Ye.gl;let ot=ce.skyboxFbo;if(!ot){ot=ce.skyboxFbo=Ye.createFramebuffer(32,32,!1),ce.skyboxGeometry=new ac(Ye),ce.skyboxTexture=Ye.gl.createTexture(),rt.bindTexture(rt.TEXTURE_CUBE_MAP,ce.skyboxTexture),rt.texParameteri(rt.TEXTURE_CUBE_MAP,rt.TEXTURE_WRAP_S,rt.CLAMP_TO_EDGE),rt.texParameteri(rt.TEXTURE_CUBE_MAP,rt.TEXTURE_WRAP_T,rt.CLAMP_TO_EDGE),rt.texParameteri(rt.TEXTURE_CUBE_MAP,rt.TEXTURE_MIN_FILTER,rt.LINEAR),rt.texParameteri(rt.TEXTURE_CUBE_MAP,rt.TEXTURE_MAG_FILTER,rt.LINEAR);for(let mt=0;mt<6;++mt)rt.texImage2D(rt.TEXTURE_CUBE_MAP_POSITIVE_X+mt,0,rt.RGBA,32,32,0,rt.RGBA,rt.UNSIGNED_BYTE,null)}Ye.bindFramebuffer.set(ot.framebuffer),Ye.viewport.set([0,0,32,32]);const pe=ce.getCenter(Y,!0),he=Y.useProgram("skyboxCapture"),gt=new Float64Array(16);m.identity(gt),m.rotateY(gt,gt,.5*-Math.PI),ha(Ye,ce,he,gt,pe,0),m.identity(gt),m.rotateY(gt,gt,.5*Math.PI),ha(Ye,ce,he,gt,pe,1),m.identity(gt),m.rotateX(gt,gt,.5*-Math.PI),ha(Ye,ce,he,gt,pe,2),m.identity(gt),m.rotateX(gt,gt,.5*Math.PI),ha(Ye,ce,he,gt,pe,3),m.identity(gt),ha(Ye,ce,he,gt,pe,4),m.identity(gt),m.rotateY(gt,gt,Math.PI),ha(Ye,ce,he,gt,pe,5),Ye.viewport.set([0,0,Y.width,Y.height])}(c,a),a.markSkyboxValid(c)):"sky"===c.renderPass&&function(Y,ce,Pe,Ke,Ye){const rt=Y.context,ot=rt.gl,pe=Y.transform,he=Y.useProgram("skybox");rt.activeTexture.set(ot.TEXTURE0),ot.bindTexture(ot.TEXTURE_CUBE_MAP,ce.skyboxTexture);const gt=((mt,Ut,jt,It,tn)=>({u_matrix:mt,u_sun_direction:Ut,u_cubemap:0,u_opacity:It,u_temporal_offset:tn}))(pe.skyboxMatrix,ce.getCenter(Y,!1),0,Ke,Ye);Y.prepareDrawProgram(rt,he),he.draw(rt,ot.TRIANGLES,Pe,m.StencilMode.disabled,Y.colorModeForRenderPass(),m.CullFaceMode.backCW,gt,"skybox",ce.skyboxGeometry.vertexBuffer,ce.skyboxGeometry.indexBuffer,ce.skyboxGeometry.segment)}(c,a,V,w,K):"gradient"===P&&"sky"===c.renderPass&&function(Y,ce,Pe,Ke,Ye){const rt=Y.context,ot=rt.gl,pe=Y.transform,he=Y.useProgram("skyboxGradient");ce.skyboxGeometry||(ce.skyboxGeometry=new ac(rt)),rt.activeTexture.set(ot.TEXTURE0);let gt=ce.colorRampTexture;gt||(gt=ce.colorRampTexture=new m.Texture(rt,ce.colorRamp,ot.RGBA)),gt.bind(ot.LINEAR,ot.CLAMP_TO_EDGE);const mt=(Ut=pe.skyboxMatrix,jt=ce.getCenter(Y,!1),It=ce.paint.get("sky-gradient-radius"),tn=Ke,Kt=Ye,{u_matrix:Ut,u_color_ramp:0,u_center_direction:jt,u_radius:m.degToRad(It),u_opacity:tn,u_temporal_offset:Kt});var Ut,jt,It,tn,Kt;Y.prepareDrawProgram(rt,he),he.draw(rt,ot.TRIANGLES,Pe,m.StencilMode.disabled,Y.colorModeForRenderPass(),m.CullFaceMode.backCW,mt,"skyboxGradient",ce.skyboxGeometry.vertexBuffer,ce.skyboxGeometry.indexBuffer,ce.skyboxGeometry.segment)}(c,a,V,w,K)},debug:function(c,n,a){for(let p=0;p<a.length;p++)hu(c,n,a[p])},custom:function(c,n,a,p){const y=c.context,w=a.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||"offscreen"===c.renderPass)&&a.isLayerDraped()){if("offscreen"===c.renderPass){const C=w.prerender;if(C){if(c.setCustomLayerDefaults(),y.setColorMode(c.colorModeForRenderPass()),"globe"===c.transform.projection.name){const P=c.transform.pointMerc;C.call(w,y.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),m.globeToMercatorTransition(c.transform.zoom),[P.x,P.y],c.transform.pixelsPerMeterRatio)}else C.call(w,y.gl,c.transform.customLayerMatrix());y.setDirty(),c.setBaseState()}}else if("translucent"===c.renderPass){if(c.terrain&&c.terrain.renderingToTexture){const P=w.renderToTile;if(P){const V=p[0].canonical,K=new m.MercatorCoordinate(V.x+p[0].wrap*(1<<V.z),V.y,V.z);y.setDepthMode(m.DepthMode.disabled),y.setStencilMode(m.StencilMode.disabled),y.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),P.call(w,y.gl,K),y.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),y.setColorMode(c.colorModeForRenderPass()),y.setStencilMode(m.StencilMode.disabled);const C="3d"===w.renderingMode?new m.DepthMode(c.context.gl.LEQUAL,m.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,m.DepthMode.ReadOnly);if(y.setDepthMode(C),"globe"===c.transform.projection.name){const P=c.transform.pointMerc;w.render(y.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),m.globeToMercatorTransition(c.transform.zoom),[P.x,P.y],c.transform.pixelsPerMeterRatio)}else w.render(y.gl,c.transform.customLayerMatrix());y.setDirty(),c.setBaseState(),y.bindFramebuffer.set(null)}}else m.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class $a{constructor(n,a,p=!1){this.context=new Je(n,p),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=m.SourceCache.maxUnderzooming+m.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new za(this,n));const y=this._terrain;this.transform.elevation=p?y:null,y.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||"globe"===this.transform.projection.name||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=a.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const w=p+.78*(y-p);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*m.exported.devicePixelRatio,this.height=a*m.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const n=this.context,a=new m.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(m.EXTENT,0),a.emplaceBack(0,m.EXTENT),a.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,m.posAttributes.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);const p=new m.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(m.EXTENT,0),p.emplaceBack(0,m.EXTENT),p.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=n.createVertexBuffer(p,m.posAttributes.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);const y=new m.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,m.posAttributes.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);const w=new m.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(m.EXTENT,0,m.EXTENT,0),w.emplaceBack(0,m.EXTENT,0,m.EXTENT),w.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(w,m.boundsAttributes.members),this.mercatorBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);const C=new m.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(C);const P=new m.StructArrayLayout1ui2;for(const K of[0,1,3,2,0])P.emplaceBack(K);this.debugIndexBuffer=n.createIndexBuffer(P),this.emptyTexture=new m.Texture(n,new m.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=m.create();const V=this.context.gl;this.stencilClearMode=new m.StencilMode({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO),this.loadTimeStamps.push(m.window.performance.now()),this.atmosphereBuffer=new Rl(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,m.DepthMode.disabled,this.stencilClearMode,m.ColorMode.disabled,m.CullFaceMode.disabled,Po(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,p){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const V of p)if(void 0===this._tileClippingMaskIDs[V.key]){P=!0;break}if(!P)return}this.currentStencilSource=a.id;const y=this.context,w=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(m.ColorMode.disabled),y.setDepthMode(m.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of p){const V=a.getTile(P),K=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ce,tileBoundsSegments:Pe}=this.getTileBoundsBuffers(V);C.draw(y,w.TRIANGLES,m.DepthMode.disabled,new m.StencilMode({func:w.ALWAYS,mask:0},K,255,w.KEEP,w.KEEP,w.REPLACE),m.ColorMode.disabled,m.CullFaceMode.disabled,Po(P.projMatrix),"$clipping",Y,ce,Pe)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new m.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new m.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,p=n.sort((C,P)=>P.overscaledZ-C.overscaledZ),y=p[p.length-1].overscaledZ,w=p[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let P=0;P<w;P++)C[P+y]=new m.StencilMode({func:a.GEQUAL,mask:255},P+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=w,[C,p]}return[{[y]:m.StencilMode.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new m.ColorMode([n.CONSTANT_COLOR,n.ONE],new m.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?m.ColorMode.unblended:m.ColorMode.alphaBlended}depthModeForSublayer(n,a,p){if(!this.opaquePassEnabledForLayer())return m.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new m.DepthMode(p||this.context.gl.LEQUAL,a,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(m.exported.now()),this.imageManager.beginFrame();const p=this.style.order,y=this.style._sourceCaches;for(const K in y){const Y=y[K];Y.used&&Y.prepare(this.context)}const w={},C={},P={};for(const K in y){const Y=y[K];w[K]=Y.getVisibleCoordinates(),C[K]=w[K].slice().reverse(),P[K]=Y.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let K=0;K<p.length;K++)if(this.style._layers[p[K]].is3D()){this.opaquePassCutoff=K;break}if(this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new m.GlobeSharedBuffers(this.context)),!m.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const K of p){const Y=this.style._layers[K],ce=n._getLayerSourceCache(Y);if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const Pe=ce?C[ce.id]:void 0;("custom"===Y.type||Y.isSky()||Pe&&Pe.length)&&this.renderLayer(this,ce,Y,Pe)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const V=this.terrain;if(V&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&V.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const K=this.style._layers[p[this.currentLayer]],Y=n._getLayerSourceCache(K);if(K.isSky())continue;const ce=Y?C[Y.id]:void 0;this._renderTileClippingMasks(K,Y,ce),this.renderLayer(this,Y,K,ce)}if(this.style.fog&&this.transform.projection.supportsFog&&function(K,Y){const ce=K.context,Pe=ce.gl,Ke=K.transform,Ye=new m.DepthMode(Pe.LEQUAL,m.DepthMode.ReadOnly,[0,1]),rt=K.useProgram("globeAtmosphere",null,"globe"===Ke.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ot=m.globeToMercatorTransition(Ke.zoom),pe=Y.properties.get("color").toArray01(),he=Y.properties.get("high-color").toArray01(),gt=Y.properties.get("space-color").toArray01PremultipliedAlpha(),mt=m.identity$1([]);m.rotateY$1(mt,mt,-m.degToRad(Ke._center.lng)),m.rotateX$1(mt,mt,m.degToRad(Ke._center.lat)),m.rotateZ$1(mt,mt,Ke.angle),m.rotateX$1(mt,mt,-Ke._pitch);const Ut=m.fromQuat(new Float32Array(16),mt),jt=m.mapValue(Y.properties.get("star-intensity"),0,1,0,.25),tn=m.mapValue(Y.properties.get("horizon-blend"),0,1,5e-4,.25),Kt=m.globeUseCustomAntiAliasing(K,ce,Ke)&&5e-4===tn?Ke.worldSize/(2*Math.PI*1.025)-1:Ke.globeRadius,ln=K.frameCounter/1e3%1,rr=m.length(Ke.globeCenterInViewSpace),cn=Math.sqrt(Math.pow(rr,2)-Math.pow(Kt,2)),Dn=Math.acos(cn/rr),an={u_frustum_tl:Ke.frustumCorners.TL,u_frustum_tr:Ke.frustumCorners.TR,u_frustum_br:Ke.frustumCorners.BR,u_frustum_bl:Ke.frustumCorners.BL,u_horizon:Ke.frustumCorners.horizon,u_transition:ot,u_fadeout_range:tn,u_color:pe,u_high_color:he,u_space_color:gt,u_star_intensity:jt,u_star_size:5*m.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ln,u_horizon_angle:Dn,u_rotation_matrix:Ut};K.prepareDrawProgram(ce,rt);const Kn=K.atmosphereBuffer;Kn&&rt.draw(ce,Pe.TRIANGLES,Ye,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.backCW,an,"skybox",Kn.vertexBuffer,Kn.indexBuffer,Kn.segments)}(this,this.style.fog),this.renderPass="sky",(m.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const K=this.style._layers[p[this.currentLayer]],Y=n._getLayerSourceCache(K);K.isSky()&&this.renderLayer(this,Y,K,Y?C[Y.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const K=this.style._layers[p[this.currentLayer]],Y=n._getLayerSourceCache(K);if(K.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(K)){if(K.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ce=Y?("symbol"===K.type?P:C)[Y.id]:void 0;this._renderTileClippingMasks(K,Y,Y?w[Y.id]:void 0),this.renderLayer(this,Y,K,ce),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let K=null;m.values(this.style._layers).forEach(Y=>{const ce=n._getLayerSourceCache(Y);ce&&!Y.isHidden(this.transform.zoom)&&(!K||K.getSource().maxzoom<ce.getSource().maxzoom)&&(K=ce)}),K&&this.options.showTileBoundaries&&ho.debug(this,K,K.getVisibleCoordinates())}this.options.showPadding&&function(K){const Y=K.transform.padding;oc(K,K.transform.height-(Y.top||0),3,os),oc(K,Y.bottom||0,3,Ec),Ps(K,Y.left||0,3,zc),Ps(K,K.transform.width-(Y.right||0),3,yo);const ce=K.transform.centerPoint;var Pe,Ke,Ye,rt;gs(Pe=K,(Ke=ce.x)-1,(Ye=K.transform.height-ce.y)-10,2,20,rt=Hl),gs(Pe,Ke-10,Ye-1,20,2,rt)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(m.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,a,p,y){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(p.type)||n.terrain&&"custom"===p.type)&&ho[p.type](n,a,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let p=this.gpuTimers[n.id];p||(p=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),p.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const p in n){const y=n[p],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(y.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(y.query),a[p]=C}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let p=0;for(const y of n)p+=a.getQueryObjectEXT(y,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(y);return p}translatePosMatrix(n,a,p,y,w){if(!p[0]&&!p[1])return n;const C=w?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(C){const K=Math.sin(C),Y=Math.cos(C);p=[p[0]*Y-p[1]*K,p[0]*K+p[1]*Y]}const P=[w?p[0]:Ct(a,p[0],this.transform.zoom),w?p[1]:Ct(a,p[1],this.transform.zoom),0],V=new Float32Array(16);return m.translate(V,n,P),V}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){return null===n||void 0!==n&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.terrain&&0===this.terrain.exaggeration(),p=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),"globe"===this.transform.projection.name&&y.push("GLOBE"),a&&y.push("ZERO_EXAGGERATION"),p&&!n&&0!==p.getOpacity(this.transform.pitch)&&y.push("FOG"),n&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(n,a,p){this.cache=this.cache||{};const y=p||[],w=this.currentGlobalDefines().concat(y),C=ns.cacheKey(Vl[n],n,w,a);return this.cache[C]||(this.cache[C]=new ns(this.context,n,Vl[n],a,Bi[n],w)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,p){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const w=y.getOpacity(this.transform.pitch),C=((P,V,K,Y,ce,Pe,Ke,Ye,rt,ot,pe)=>{const he=P.transform,gt=V.properties.get("color").toArray01();gt[3]=Y;const mt=P.frameCounter/1e3%1;return{u_fog_matrix:K?he.calculateFogTileMatrix(K):P.identityMat,u_fog_range:V.getFovAdjustedRange(he._fov),u_fog_color:gt,u_fog_horizon_blend:V.properties.get("horizon-blend"),u_fog_temporal_offset:mt,u_frustum_tl:ce,u_frustum_tr:Pe,u_frustum_br:Ke,u_frustum_bl:Ye,u_globe_pos:rt,u_globe_radius:ot,u_viewport:pe,u_globe_transition:m.globeToMercatorTransition(he.zoom),u_is_globe:+("globe"===he.projection.name)}})(this,y,p,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*m.exported.devicePixelRatio,this.transform.height*m.exported.devicePixelRatio]);a.setFogUniformValues(n,C)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)a[y.key]=n[y.key]||new m.Tile(y,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class wc{constructor(n=0,a=0,p=0,y=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=p,this.right=y}interpolate(n,a,p){return null!=a.top&&null!=n.top&&(this.top=m.number(n.top,a.top,p)),null!=a.bottom&&null!=n.bottom&&(this.bottom=m.number(n.bottom,a.bottom,p)),null!=a.left&&null!=n.left&&(this.left=m.number(n.left,a.left,p)),null!=a.right&&null!=n.right&&(this.right=m.number(n.right,a.right,p)),this}getCenter(n,a){const p=m.clamp((this.left+n-this.right)/2,0,n),y=m.clamp((this.top+a-this.bottom)/2,0,a);return new m.Point(p,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new wc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function io(c,n){const a=m.getColumn(c,3);m.fromQuat(c,n),m.setColumn(c,3,a)}function as(c,n){const a=m.identity$1([]);return m.rotateZ$1(a,a,-n),m.rotateX$1(a,a,-c),a}function Pl(c,n){const a=[c[0],c[1],0],p=[n[0],n[1],0];if(m.length(a)>=1e-15){const C=m.normalize([],a);m.scale$2(p,C,m.dot(p,C)),n[0]=p[0],n[1]=p[1]}const y=m.cross([],n,c);if(m.len(y)<1e-15)return null;const w=Math.atan2(-y[1],y[0]);return as(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),w)}class Ls{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof m.MercatorCoordinate?n:new m.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=m.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const p=this.position,y=this._elevation?this._elevation.getAtPointOrZero(m.MercatorCoordinate.fromLngLat(n)):0,w=m.MercatorCoordinate.fromLngLat(n,y),C=[w.x-p.x,w.y-p.y,w.z-p.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Pl(C,a)}setPitchBearing(n,a){this.orientation=as(m.degToRad(n),m.degToRad(-a))}}class la{constructor(n,a){this._transform=m.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new m.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=m.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&m.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||m.identity$1([]),n&&io(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=as(n,a),io(this._transform,this._orientation)}forward(){const n=m.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=m.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=m.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const p=new Float64Array(16);return m.invert(p,this.getWorldToCamera(n,a)),p}getWorldToCameraPosition(n,a,p){const y=this.position;m.scale$2(y,y,-n);const w=new Float64Array(16);return m.fromScaling(w,[p,p,p]),m.translate(w,w,y),w[10]*=a,w}getWorldToCamera(n,a){const p=new Float64Array(16),y=new Float64Array(4),w=this.position;return m.conjugate(y,this._orientation),m.scale$2(w,w,-n),m.fromQuat(p,y),m.translate(p,p,w),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(n,a,p,y){const w=new Float64Array(16);return m.perspective(w,n,a,p,y),w}getDistanceToElevation(n,a=!1){const p=0===n?0:m.mercatorZfromAltitude(n,a?m.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new la([...this.position],[...this.orientation])}}function ul(c,n){const a=va(c.projection,c.zoom,c.width,c.height),p=function(w,C,P,V,K){const Y=new m.LngLat(P.lng-180*Da,P.lat),ce=new m.LngLat(P.lng+180*Da,P.lat),Pe=w.project(Y.lng,Y.lat),Ke=w.project(ce.lng,ce.lat),Ye=-Math.atan2(Ke.y-Pe.y,Ke.x-Pe.x),rt=m.MercatorCoordinate.fromLngLat(P);rt.y=m.clamp(rt.y,-1+Da,1-Da);const ot=rt.toLngLat(),pe=w.project(ot.lng,ot.lat),he=m.MercatorCoordinate.fromLngLat(ot);he.x+=Da;const gt=he.toLngLat(),mt=w.project(gt.lng,gt.lat),Ut=W(mt.x-pe.x,mt.y-pe.y,Ye),jt=m.MercatorCoordinate.fromLngLat(ot);jt.y+=Da;const It=jt.toLngLat(),tn=w.project(It.lng,It.lat),Kt=W(tn.x-pe.x,tn.y-pe.y,Ye),ln=Math.abs(Ut.x)/Math.abs(Kt.y),rr=m.identity([]);m.rotateZ(rr,rr,-Ye*(1-(K?0:V)));const cn=m.identity([]);return m.scale(cn,cn,[1,1-(1-ln)*V,1]),cn[4]=-Kt.x/Kt.y*V,m.rotateZ(cn,cn,Ye),m.multiply(cn,rr,cn),cn}(c.projection,0,c.center,a,n),y=lc(c);return m.scale(p,p,[y,y,1]),p}function lc(c){const n=c.projection,a=va(c.projection,c.zoom,c.width,c.height),p=jc(n,c.center),y=jc(n,m.LngLat.convert(n.center));return Math.pow(2,p*a+(1-a)*y)}function va(c,n,a,p,y=1/0){const w=c.range;if(!w)return 0;const C=Math.min(y,Math.max(a,p)),P=Math.log(C/1024)/Math.LN2;return m.smoothstep(w[0]+P,w[1]+P,n)}const Da=1/4e4;function jc(c,n){const a=m.clamp(n.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),p=new m.LngLat(n.lng-180*Da,a),y=new m.LngLat(n.lng+180*Da,a),w=c.project(p.lng,a),C=c.project(y.lng,a),P=m.MercatorCoordinate.fromLngLat(p),V=m.MercatorCoordinate.fromLngLat(y),K=C.x-w.x,Y=C.y-w.y,ce=V.x-P.x,Pe=V.y-P.y,Ke=Math.sqrt((ce*ce+Pe*Pe)/(K*K+Y*Y));return Math.log(Ke)/Math.LN2}function W(c,n,a){const p=Math.cos(a),y=Math.sin(a);return{x:c*p-n*y,y:c*y+n*p}}class ke{constructor(n,a,p,y,w,C,P){this.tileSize=512,this._renderWorldCopies=void 0===w||w,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(C),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new la,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new ke(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,a=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return m.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=m.getProjection(this.projectionOptions);const p=!ae(a,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=m.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return m.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new m.Point(this.width,this.height)}get bearing(){return m.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var p,y,w,C,P,V,K,Y,ce,Pe;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(p=new m.ARRAY_TYPE(4),m.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),y=this.rotationMatrix,C=this.angle,P=(w=this.rotationMatrix)[0],V=w[1],K=w[2],Y=w[3],ce=Math.sin(C),Pe=Math.cos(C),y[0]=P*Pe+K*ce,y[1]=V*Pe+Y*ce,y[2]=P*-ce+K*Pe,y[3]=V*-ce+Y*Pe)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=m.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=m.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,w=0;for(let C=0;C<a.length;C++){const P=new m.Point(a[C][0]*this.width,p+a[C][1]*(this.height-p)),V=n.pointCoordinate(P);if(!V)continue;const K=1/Math.hypot(V[0]-this._camera.position[0],V[1]-this._camera.position[1]);y+=V[3]*K,w+=K}return 0===w?NaN:y/w}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*a,y=this._mercatorZfromZoom(n),w=this._mercatorZfromZoom(this._maxZoom),C=Math.max(y-p,w);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const y=m.length(m.sub([],this._camera.position,p));return m.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!m.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];m.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Ls;return a.position=new m.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!m.length$1(n))return!1;m.normalize$1(n,n);const a=m.transformQuat([],[0,0,-1],n),p=m.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const y=Pl(a,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=m.clamp(n[2],y/p,y/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,p){this._unmodified=!1,this._edgeInsets.interpolate(n,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new m.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new m.Point(0,0)),y=this.pointCoordinate(new m.Point(this.width,0)),w=this.pointCoordinate(new m.Point(this.width,this.height)),C=this.pointCoordinate(new m.Point(0,this.height)),P=Math.floor(Math.min(p.x,y.x,w.x,C.x)),V=Math.floor(Math.max(p.x,y.x,w.x,C.x)),K=1;for(let Y=P-K;Y<=V+K;Y++)0!==Y&&a.push(new m.UnwrappedTileID(Y,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const p=a,y=this.elevation&&!n.isTerrainDEM,w="mercator"===this.projection.name;if(void 0!==n.minzoom&&a<n.minzoom)return[];void 0!==n.maxzoom&&a>n.maxzoom&&(a=n.maxzoom);const C=this.locationCoordinate(this.center),P=this.center.lat,V=1<<a,K=[V*C.x,V*C.y,0],Y="globe"===this.projection.name,ce=!Y,Pe=m.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,ce),Ke=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ye=V*m.mercatorZfromAltitude(1,this.center.lat),rt=this._camera.position[2]/m.mercatorZfromAltitude(1,this.center.lat),ot=[V*Ke.x,V*Ke.y,rt*(ce?1:Ye)],pe=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),he=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,gt=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,mt=n.isTerrainDEM?-gt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ut=this.projection.isReprojectedInTileSpace?lc(this):1,jt=dn=>{const Nn=new m.MercatorCoordinate(dn.x+25e-6,dn.y,dn.z),Wn=new m.MercatorCoordinate(dn.x,dn.y+25e-6,dn.z),Yn=dn.toLngLat(),Xr=Nn.toLngLat(),bi=Wn.toLngLat(),Br=this.locationCoordinate(Yn),R=this.locationCoordinate(Xr),L=this.locationCoordinate(bi),$=Math.hypot(R.x-Br.x,R.y-Br.y),ee=Math.hypot(L.x-Br.x,L.y-Br.y);return Math.sqrt($*ee)*Ut/25e-6},It=dn=>{const Ln=gt,Nn=mt;return{aabb:m.tileAABB(this,V,0,0,0,dn,Nn,Ln,this.projection),zoom:0,x:0,y:0,minZ:Nn,maxZ:Ln,wrap:dn,fullyVisible:!1}},tn=[];let Kt=[];const ln=a,rr=n.reparseOverscaled?p:a,cn=dn=>dn*dn,Dn=cn((rt-this._centerAltitude)*Ye),an=dn=>{if(!this._elevation||!dn.tileID||!w)return;const Ln=this._elevation.getMinMaxForTile(dn.tileID),Nn=dn.aabb;Ln?(Nn.min[2]=Ln.min,Nn.max[2]=Ln.max,Nn.center[2]=(Nn.min[2]+Nn.max[2])/2):(dn.shouldSplit=Kn(dn),dn.shouldSplit||(Nn.min[2]=Nn.max[2]=Nn.center[2]=this._centerAltitude))},Kn=dn=>{if(dn.zoom<he)return!0;if(dn.zoom===ln)return!1;if(null!=dn.shouldSplit)return dn.shouldSplit;const Ln=dn.aabb.distanceX(ot),Nn=dn.aabb.distanceY(ot);let Wn=Dn,Yn=1;if(Y){Wn=cn(dn.aabb.distanceZ(ot));const Br=Math.pow(2,dn.zoom),R=m.latFromMercatorY((dn.y+1)/Br),L=m.latFromMercatorY(dn.y/Br),$=Math.min(Math.max(P,R),L),ee=m.circumferenceAtLatitude($)/m.circumferenceAtLatitude(P);if(Yn=$===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ee/this._mercatorScaleRatio),this.zoom<=m.GLOBE_ZOOM_THRESHOLD_MIN&&dn.zoom===ln-1&&ee>=.9)return!0}else if(y&&(Wn=cn(dn.aabb.distanceZ(ot)*Ye)),this.projection.isReprojectedInTileSpace&&p<=5){const Br=Math.pow(2,dn.zoom),R=jt(new m.MercatorCoordinate((dn.x+.5)/Br,(dn.y+.5)/Br));Yn=R>.85?1:R}const Xr=Ln*Ln+Nn*Nn+Wn;return Xr<cn((1<<ln-dn.zoom)*pe*Yn*((Br,R)=>{if(R*cn(.707)<Br)return 1;const L=Math.sqrt(R/Br);return L/(1.4144271570014144+(Math.pow(1.1,L-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Wn,Dn),Xr))};if(this.renderWorldCopies)for(let dn=1;dn<=3;dn++)tn.push(It(-dn)),tn.push(It(dn));for(tn.push(It(0));tn.length>0;){const dn=tn.pop(),Ln=dn.x,Nn=dn.y;let Wn=dn.fullyVisible;if(!Wn){const Yn=dn.aabb.intersects(Pe);if(0===Yn)continue;Wn=2===Yn}if(dn.zoom!==ln&&Kn(dn))for(let Yn=0;Yn<4;Yn++){const Xr=(Ln<<1)+Yn%2,bi=(Nn<<1)+(Yn>>1),Br={aabb:w?dn.aabb.quadrant(Yn):m.tileAABB(this,V,dn.zoom+1,Xr,bi,dn.wrap,dn.minZ,dn.maxZ,this.projection),zoom:dn.zoom+1,x:Xr,y:bi,wrap:dn.wrap,fullyVisible:Wn,tileID:void 0,shouldSplit:void 0,minZ:dn.minZ,maxZ:dn.maxZ};y&&!Y&&(Br.tileID=new m.OverscaledTileID(dn.zoom+1===ln?rr:dn.zoom+1,dn.wrap,dn.zoom+1,Xr,bi),an(Br)),tn.push(Br)}else{const Yn=dn.zoom===ln?rr:dn.zoom;if(n.minzoom&&n.minzoom>Yn)continue;const Xr=K[0]-(.5+Ln+(dn.wrap<<dn.zoom))*(1<<a-dn.zoom),bi=K[1]-.5-Nn,Br=dn.tileID?dn.tileID:new m.OverscaledTileID(Yn,dn.wrap,dn.zoom,Ln,Nn);Kt.push({tileID:Br,distanceSq:Xr*Xr+bi*bi})}}if(this.fogCullDistSq){const dn=this.fogCullDistSq,Ln=this.horizonLineFromTop();Kt=Kt.filter(Nn=>{const Wn=[0,0,0,1],Yn=[m.EXTENT,m.EXTENT,0,1],Xr=this.calculateFogTileMatrix(Nn.tileID.toUnwrapped());m.transformMat4$1(Wn,Wn,Xr),m.transformMat4$1(Yn,Yn,Xr);const bi=m.getAABBPointSquareDist(Wn,Yn);if(0===bi)return!0;let Br=!1;const R=this._elevation;if(R&&bi>dn&&0!==Ln){const L=this.calculateProjMatrix(Nn.tileID.toUnwrapped());let $;n.isTerrainDEM||($=R.getMinMaxForTile(Nn.tileID)),$||($={min:mt,max:gt});const ee=m.furthestTileCorner(this.rotation),Ee=[ee[0]*m.EXTENT,ee[1]*m.EXTENT,$.max];m.transformMat4(Ee,Ee,L),Br=(1-Ee[1])*this.height*.5<Ln}return bi<dn||Br})}return Kt.sort((dn,Ln)=>dn.distanceSq-Ln.distanceSq).map(dn=>dn.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=m.clamp(n.lat,-m.MAX_MERCATOR_LATITUDE,m.MAX_MERCATOR_LATITUDE),p=this.projection.project(n.lng,a);return new m.Point(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/m.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let p,y;const w=this.centerPoint;if("globe"===this.projection.name){const P=this.worldSize;p=(a.x-w.x)/P,y=(a.y-w.y)/P}else{const P=this.pointCoordinate(a),V=this.pointCoordinate(w);p=P.x-V.x,y=P.y-V.y}const C=this.locationCoordinate(n);this.setLocation(new m.MercatorCoordinate(C.x-p,C.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const p=a?m.mercatorZfromAltitude(a,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new m.MercatorCoordinate(y.x,y.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const p=a??this._centerAltitude,y=[n.x,n.y,0,1],w=[n.x,n.y,1,1];m.transformMat4$1(y,y,this.pixelMatrixInverse),m.transformMat4$1(w,w,this.pixelMatrixInverse);const C=w[3];m.scale$1(y,y,1/y[3]),m.scale$1(w,w,1/C);const P=y[2],V=w[2];return{p0:y,p1:w,t:P===V?0:(p-P)/(V-P)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return m.transformMat4$1(a,a,this.pixelMatrixInverse),m.transformMat4$1(p,p,this.pixelMatrixInverse),m.scale$1(a,a,1/a[3]),m.scale$1(p,p,1/p[3]),a[2]=m.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,p[2]=m.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,m.scale$1(a,a,1/this.worldSize),m.scale$1(p,p,1/this.worldSize),new m.Ray([a[0],a[1],a[2]],m.normalize([],m.sub([],p,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:p,t:y}=n,w=m.mercatorZfromAltitude(a[2],this._center.lat),C=m.mercatorZfromAltitude(p[2],this._center.lat);return new m.MercatorCoordinate(m.number(a[0],p[0],y)/this.worldSize,m.number(a[1],p[1],y)/this.worldSize,m.number(w,C,y))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new m.MercatorCoordinate(a[0],a[1],a[2]);let p=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const w=.02*y,C=n.clone();for(let P=0;P<10&&y-p>w;P++){C.y=m.number(p,y,.66);const V=this.projection.pointCoordinate3D(this,C.x,C.y);V?(y=C.y,a=V):p=C.y}return a?new m.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return m.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new m.Point(y[0]/y[3],y[1]/y[3]):new m.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,w=this.pointLocation3D(new m.Point(a,n)),C=this.pointLocation3D(new m.Point(y,n)),P=this.pointLocation3D(new m.Point(y,p)),V=this.pointLocation3D(new m.Point(a,p));let K=Math.min(w.lng,C.lng,P.lng,V.lng),Y=Math.max(w.lng,C.lng,P.lng,V.lng),ce=Math.min(w.lat,C.lat,P.lat,V.lat),Pe=Math.max(w.lat,C.lat,P.lat,V.lat);const Ke=Math.pow(2,-this.zoom)/16*270,Ye="globe"===this.projection.name?1:4,rt=(ot,pe,he,gt,mt)=>{const Ut=(ot+he)/2,jt=(pe+gt)/2,It=new m.Point(Ut,jt),{lng:tn,lat:Kt}=this.pointLocation3D(It),ln=Math.max(0,K-tn,ce-Kt,tn-Y,Kt-Pe);K=Math.min(K,tn),Y=Math.max(Y,tn),ce=Math.min(ce,Kt),Pe=Math.max(Pe,Kt),(mt<Ye||ln>Ke)&&(rt(ot,pe,Ut,jt,mt+1),rt(Ut,jt,he,gt,mt+1))};if(rt(a,n,y,n,1),rt(y,n,y,p,1),rt(y,p,a,p,1),rt(a,p,a,n,1),"globe"===this.projection.name){const[ot,pe]=m.polesInViewport(this);ot?(Pe=90,Y=180,K=-180):pe&&(ce=-90,Y=180,K=-180)}return new m.LngLatBounds(new m.LngLat(K,ce),new m.LngLat(Y,Pe))}_getBoundsRectangular(n,a){const{top:p,left:y}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,P=new m.Point(y,p),V=new m.Point(C,p),K=new m.Point(C,w),Y=new m.Point(y,w);let ce=this.pointCoordinate(P,n),Pe=this.pointCoordinate(V,n);const Ke=this.pointCoordinate(K,a),Ye=this.pointCoordinate(Y,a),rt=(ot,pe)=>(pe.y-ot.y)/(pe.x-ot.x);return ce.y>1&&Pe.y>=0?ce=new m.MercatorCoordinate((1-Ye.y)/rt(Ye,ce)+Ye.x,1):ce.y<0&&Pe.y<=1&&(ce=new m.MercatorCoordinate(-Ye.y/rt(Ye,ce)+Ye.x,0)),Pe.y>1&&ce.y>=0?Pe=new m.MercatorCoordinate((1-Ke.y)/rt(Ke,Pe)+Ke.x,1):Pe.y<0&&ce.y<=1&&(Pe=new m.MercatorCoordinate(-Ke.y/rt(Ke,Pe)+Ke.x,0)),(new m.LngLatBounds).extend(this.coordinateLocation(ce)).extend(this.coordinateLocation(Pe)).extend(this.coordinateLocation(Ye)).extend(this.coordinateLocation(Ke))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((p,y)=>{if(y.dem){const w=y.dem.tree;p.min=Math.min(p.min,w.minimums[0]),p.max=Math.max(p.max,w.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-m.MAX_MERCATOR_LATITUDE,this.maxLat=m.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=m.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=m.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=m.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=m.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,p=this._distanceTileDataCache;if(p[a])return p[a];const y=n.canonical,w=1/this.height,C=this.cameraWorldSize,P=C/this.zoomScale(y.z),V=(y.x+Math.pow(2,y.z)*n.wrap)*P,K=y.y*P,Y=this.point;Y.x*=C/this.worldSize,Y.y*=C/this.worldSize;const ce=this.angle,Pe=Math.sin(-ce),Ke=-Math.cos(-ce);return p[a]={bearing:[Pe,Ke],center:[(Y.x-V)*w,(Y.y-K)*w],scale:P/m.EXTENT*w},p[a]}calculateFogTileMatrix(n){const a=n.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return m.multiply(y,this.worldToFogMatrix,y),p[a]=new Float32Array(y),p[a]}calculateProjMatrix(n,a=!1){const p=n.key,y=a?this._alignedProjMatrixCache:this._projMatrixCache;if(y[p])return y[p];const w=this.calculatePosMatrix(n,this.worldSize);return m.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,w),y[p]=new Float32Array(w),y[p]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const y=function(w,C){const{scale:P}=w.tileTransform,V=P*m.EXTENT/(w.tileSize*Math.pow(2,C.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return K=new Float32Array(4),Pe=(Y=C.inverseAdjustmentMatrix)[1],Ke=Y[2],Ye=Y[3],ot=(ce=[V,V])[1],K[0]=Y[0]*(rt=ce[0]),K[1]=Pe*rt,K[2]=Ke*ot,K[3]=Ye*ot,K;var K,Y,ce,Pe,Ke,Ye,rt,ot}(n,this);return p[a]=y,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const n=1/this.worldSize,a=m.fromScaling([],[n,n,n]);return m.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const a=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),y=this._camera.forward(),w=m.mercatorZfromAltitude(1,this._center.lat);p[2]/=w,y[2]/=w,m.normalize(y,y);const C=n.raycast(p,y,n.exaggeration());if(C){const P=m.scaleAndAdd([],p,y,C),V=new m.MercatorCoordinate(P[0],P[1],m.mercatorZfromAltitude(P[2],m.latFromMercatorY(P[1]))),K=(V.z+m.length([V.x-p[0],V.y-p[1],V.z-p[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(K),this._centerAltitude=V.toAltitude(),this._center=this.coordinateLocation(V),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,p=m.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),w=a.getAtPointOrZero(new m.MercatorCoordinate(...y)),C=this.pixelsPerMeter/this.worldSize*w,P=this._minimumHeightOverTerrain(),V=y[2]-C;if(V<=P)if(V<0||n){const K=this.locationCoordinate(this._center,this._centerAltitude),Y=[y[0],y[1],K.z-y[2]],ce=m.length(Y);Y[2]-=(P-V)/this._pixelsPerMercatorPixel;const Pe=m.length(Y);if(0===Pe)return;m.scale$2(Y,Y,ce/Pe*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],K.z*this._pixelsPerMercatorPixel-Y[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const Pe=this.center;return Pe.lat=m.clamp(Pe.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(Pe.lng=m.clamp(Pe.lng,this.minLng,this.maxLng)),this.center=Pe,void(this._constraining=!1)}const a=this._unmodified,{x:p,y}=this.point;let w=0,C=p,P=y;const V=this.width/2,K=this.height/2,Y=this.worldMinY*this.scale,ce=this.worldMaxY*this.scale;if(y-K<Y&&(P=Y+K),y+K>ce&&(P=ce-K),ce-Y<this.height&&(w=Math.max(w,this.height/(ce-Y)),P=(ce+Y)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Pe=this.worldMinX*this.scale,Ke=this.worldMaxX*this.scale,Ye=this.worldSize/2-(Pe+Ke)/2;C=(p+Ye+this.worldSize)%this.worldSize-Ye,C-V<Pe&&(C=Pe+V),C+V>Ke&&(C=Ke-V),Ke-Pe<this.width&&(w=Math.max(w,this.width/(Ke-Pe)),C=(Ke+Pe)/2)}C===p&&P===y||(this.center=this.unproject(new m.Point(C,P))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=m.mercatorZfromAltitude(1,this.center.lat)/m.mercatorZfromAltitude(1,m.GLOBE_SCALE_MATCH_LATITUDE));const p=va(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y="meters"===this.projection.zAxisUnit?a:1,w=this._camera.getWorldToCamera(this.worldSize,y),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height;let P=m.mul([],C,w);if(this.projection.isReprojectedInTileSpace){const jt=this.locationCoordinate(this.center),It=m.identity([]);m.translate(It,It,[jt.x*this.worldSize,jt.y*this.worldSize,0]),m.multiply(It,It,ul(this)),m.translate(It,It,[-jt.x*this.worldSize,-jt.y*this.worldSize,0]),m.multiply(P,P,It),this.inverseAdjustmentMatrix=function(tn){const Kt=ul(tn,!0);return Le([],[Kt[0],Kt[1],Kt[4],Kt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=m.scale([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=m.invert(new Float64Array(16),this.projMatrix);const V=m.invert([],C);this.frustumCorners=m.FrustumCorners.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height);const K=new Float32Array(16);m.identity(K),m.scale(K,K,[1,-1,1]),m.rotateX(K,K,this._pitch),m.rotateZ(K,K,this.angle);const Y=m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ce=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Y[8]=2*-n.x/this.width,Y[9]=2*(n.y+ce)/this.height,this.skyboxMatrix=m.multiply(K,Y,K);const Pe=this.point,Ke=Pe.x,Ye=Pe.y,rt=this.width%2/2,ot=this.height%2/2,pe=Math.cos(this.angle),he=Math.sin(this.angle),gt=Ke-Math.round(Ke)+pe*rt+he*ot,mt=Ye-Math.round(Ye)+pe*ot+he*rt,Ut=new Float64Array(P);if(m.translate(Ut,Ut,[gt>.5?gt-1:gt,mt>.5?mt-1:mt,0]),this.alignedProjMatrix=Ut,P=m.create(),m.scale(P,P,[this.width/2,-this.height/2,1]),m.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=m.create(),m.scale(P,P,[1,-1,1]),m.translate(P,P,[-1,-1,0]),m.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},P=m.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=m.calculateGlobeMatrix(this);const jt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=m.transformMat4(jt,jt,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,w=[n,n,a];m.scale$2(w,w,y),m.scale$2(p,p,-1),m.multiply$2(p,p,w);const C=m.create();m.translate(C,C,p),m.scale(C,C,w),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,y)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*w,y.y/this.worldSize-p[1]*w,n/this.worldSize*this._centerAltitude-p[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=n[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(w=Math.min((a-p)/y,1)),this._camera.position=m.scaleAndAdd([],this._camera.position,n,w),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),w=m.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(m.degToRad(this._maxPitch)),P=Math.max((n[2]-w)/Math.cos(p),C),V=this._zoomFromMercatorZ(P);m.scaleAndAdd(n,n,a,P),this._pitch=m.clamp(p,m.degToRad(this.minPitch),m.degToRad(this.maxPitch)),this.angle=m.wrap(y,-Math.PI,Math.PI),this._setZoom(m.clamp(V,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new m.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,p=m.GLOBE_ZOOM_THRESHOLD_MAX,y=0,w=1/0;for(;p-a>1e-6&&p>a;){const C=a+.5*(p-a),P=this.tileSize*Math.pow(2,C),V=this.getCameraToCenterDistance(this.projection,C,P),K=this.scaleZoom(V/(n*this.tileSize)),Y=Math.abs(C-K);Y<w&&(w=Y,y=C),C<K?a=C:p=C}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(m.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const p=Math.min(n.x,a.x),y=Math.max(n.x,a.x),w=Math.min(n.y,a.y),C=Math.max(n.y,a.y);if(w<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const P=[new m.Point(p,w),new m.Point(y,C),new m.Point(p,C),new m.Point(y,w)],V=this.renderWorldCopies?-3:0,K=this.renderWorldCopies?4:1;for(const Y of P){const ce=this.pointRayIntersection(Y);if(ce.t<0)return!0;const Pe=this.rayIntersectionCoordinate(ce);if(Pe.x<V||Pe.y<0||Pe.x>K||Pe.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+m.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new m.Point(0,0),new m.Point(this.width,this.height))}zoomDeltaToMovement(n,a){const p=m.length(m.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if("globe"===this.projection.name){const n=function([a,p,y],w){const C=[a,p,y,1];m.transformMat4$1(C,C,w);const P=C[3]=Math.max(C[3],1e-6);return C[0]/=P,C[1]/=P,C[2]/=P,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new m.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,n))}}getCameraToCenterDistance(n,a=this.zoom,p=this.worldSize){const y=va(n,a,this.width,this.height,1024),w=n.pixelSpaceConversion(this.center.lat,p,y);return.5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&m.multiply(n,n,this.globeMatrix),n}}function ie(c,n){let a=!1,p=null;const y=()=>{p=null,a&&(c(),p=setTimeout(y,n),a=!1)};return()=>(a=!0,p||y(),p)}class be{constructor(n){this._hashName=n&&encodeURIComponent(n),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ie(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,m.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),m.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=wt(n);if(this._hashName){const p=this._hashName;let y=!1;const w=m.window.location.hash.slice(1).split("&").map(C=>{const P=C.split("=")[0];return P===p?(y=!0,`${P}=${a}`):C}).filter(C=>C);return y||w.push(`${p}=${a}`),`#${w.join("&")}`}return`#${a}`}_getCurrentHash(){const n=m.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(p=>isNaN(p))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:p,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=m.window.location.href.replace(/(#.+)?$/,this.getHashString());m.window.history.replaceState(m.window.history.state,null,n)}}function wt(c,n){const a=c.getCenter(),p=Math.round(100*c.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),C=Math.round(a.lng*w)/w,P=Math.round(a.lat*w)/w,V=c.getBearing(),K=c.getPitch();let Y=n?`/${C}/${P}/${p}`:`${p}/${P}/${C}`;return(V||K)&&(Y+="/"+Math.round(10*V)/10),K&&(Y+=`/${Math.round(K)}`),Y}const _n={linearity:.3,easing:m.bezier(0,0,.3,1)},Gn=m.extend({deceleration:2500,maxSpeed:1400},_n),Ar=m.extend({deceleration:20,maxSpeed:1400},_n),Xn=m.extend({deceleration:1e3,maxSpeed:360},_n),Qr=m.extend({deceleration:1e3,maxSpeed:90},_n);class zs{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=m.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)a.zoom+=w.zoomDelta||0,a.bearing+=w.bearingDelta||0,a.pitch+=w.pitchDelta||0,w.panDelta&&a.pan._add(w.panDelta),w.around&&(a.around=w.around),w.pinchAround&&(a.pinchAround=w.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(a.pan.mag()){const w=fs(a.pan.mag(),p,m.extend({},Gn,n||{}));y.offset=a.pan.mult(w.amount/a.pan.mag()),y.center=this._map.transform.center,Wi(y,w)}if(a.zoom){const w=fs(a.zoom,p,Ar);y.zoom=this._map.transform.zoom+w.amount,Wi(y,w)}if(a.bearing){const w=fs(a.bearing,p,Xn);y.bearing=this._map.transform.bearing+m.clamp(w.amount,-179,179),Wi(y,w)}if(a.pitch){const w=fs(a.pitch,p,Qr);y.pitch=this._map.transform.pitch+w.amount,Wi(y,w)}if(y.zoom||y.bearing){const w=void 0===a.pinchAround?a.around:a.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Wi(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function fs(c,n,a){const{maxSpeed:p,linearity:y,deceleration:w}=a,C=m.clamp(c*y/(n/1e3),-p,p),P=Math.abs(C)/(w*y);return{easing:a.easing,duration:1e3*P,amount:C*(P/2)}}class ji extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p,y={}){const w=ct(a.getCanvasContainer(),p),C=a.unproject(w);super(n,m.extend({point:w,lngLat:C,originalEvent:p},y)),this._defaultPrevented=!1,this.target=a}}class so extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p){const y="touchend"===n?p.changedTouches:p.touches,w=Ue(a.getCanvasContainer(),y),C=w.map(V=>a.unproject(V)),P=w.reduce((V,K,Y,ce)=>V.add(K.div(ce.length)),new m.Point(0,0));super(n,{points:w,point:P,lngLats:C,lngLat:a.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class Jo extends m.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,p){super(n,{originalEvent:p}),this._defaultPrevented=!1}}class xs{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Jo(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new ji(n.type,this._map,n))}mouseup(n){this._map.fire(new ji(n.type,this._map,n))}preclick(n){const a=m.extend({},n);a.type="preclick",this._map.fire(new ji(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new ji(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new ji(n.type,this._map,n))}mouseover(n){this._map.fire(new ji(n.type,this._map,n))}mouseout(n){this._map.fire(new ji(n.type,this._map,n))}touchstart(n){return this._firePreventable(new so(n.type,this._map,n))}touchmove(n){this._map.fire(new so(n.type,this._map,n))}touchend(n){this._map.fire(new so(n.type,this._map,n))}touchcancel(n){this._map.fire(new so(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lr{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new ji(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ji(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kr{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&0===n.button&&(Oe(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const p=a,y=this._startPos,w=this._lastPos;if(!y||!w||w.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const C=Math.min(y.x,p.x),P=Math.max(y.x,p.x),V=Math.min(y.y,p.y),K=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${V}px)`,this._box.style.width=P-C+"px",this._box.style.height=K-V+"px")})}mouseupWindow(n,a){if(!this._active)return;const p=this._startPos,y=a;if(p&&0===n.button){if(this.reset(),et(),p.x!==y.x||p.y!==y.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:w=>w.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),je(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new m.Event(n,{originalEvent:a}))}}function Di(c,n){const a={};for(let p=0;p<c.length;p++)a[c[p].identifier]=n[p];return a}class Ni{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const w=new m.Point(0,0);for(const C of y)w._add(C);return w.div(y.length)}(a),this.touches=Di(p,a)))}touchmove(n,a,p){if(this.aborted||!this.centroid)return;const y=Di(p,a);for(const w in this.touches){const C=y[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(n,a,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class js{constructor(n){this.singleTap=new Ni(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,p){this.singleTap.touchstart(n,a,p)}touchmove(n,a,p){this.singleTap.touchmove(n,a,p)}touchend(n,a,p){const y=this.singleTap.touchend(n,a,p);if(y){const w=n.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(y)<30;if(w&&C||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ea{constructor(){this._zoomIn=new js({numTouches:1,numTaps:2}),this._zoomOut=new js({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,p){this._zoomIn.touchstart(n,a,p),this._zoomOut.touchstart(n,a,p)}touchmove(n,a,p){this._zoomIn.touchmove(n,a,p),this._zoomOut.touchmove(n,a,p)}touchend(n,a,p){const y=this._zoomIn.touchend(n,a,p),w=this._zoomOut.touchend(n,a,p);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(y)},{originalEvent:n})}):w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rl={0:1,2:2};class qi{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const p=nt(n);this._correctButton(n,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(n,a){const p=this._lastPoint;if(p)if(n.preventDefault(),null!=this._eventButton&&function(y,w){const C=rl[w];return void 0===y.buttons||(y.buttons&C)!==C}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}mouseupWindow(n){this._lastPoint&&nt(n)===this._eventButton&&(this._moved&&et(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ca extends qi{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return 0===a&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class fo extends qi{_correctButton(n,a){return 0===a&&n.ctrlKey||2===a}_move(n,a){const p=.8*(a.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class Si extends qi{_correctButton(n,a){return 0===a&&n.ctrlKey||2===a}_move(n,a){const p=-.5*(a.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class dl{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),m.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)}touchstart(n,a,p){return this._calculateTransform(n,a,p)}touchmove(n,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length&&!m.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,p)}}touchend(n,a,p){this._calculateTransform(n,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,p){p.length>0&&(this._active=!0);const y=Di(p,a),w=new m.Point(0,0),C=new m.Point(0,0);let P=0;for(const K in y){const Y=y[K],ce=this._touches[K];ce&&(w._add(Y),C._add(Y.sub(ce)),P++,y[K]=Y)}if(this._touches=y,P<this._minTouches||!C.mag())return;const V=C.div(P);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(P),panDelta:V}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Kl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,p){return{}}touchstart(n,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,p){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[w,C]=y,P=Ol(p,a,w),V=Ol(p,a,C);if(!P||!V)return;const K=this._aroundCenter?null:P.add(V).div(2);return this._move([P,V],K,n)}touchend(n,a,p){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,C=Ol(p,a,y),P=Ol(p,a,w);C&&P||(this._active&&et(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ol(c,n,a){for(let p=0;p<c.length;p++)if(c[p].identifier===a)return n[p]}function Xs(c,n){return Math.log(c/n)/Math.LN2}class Rc extends Kl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Xs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xs(this._distance,p),pinchAround:a}}}function Zl(c,n){return 180*c.angleWith(n)/Math.PI}class jo extends Kl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Zl(this._vector,p),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Zl(n,p);return Math.abs(y)<a}}function Ga(c){return Math.abs(c.y)>Math.abs(c.x)}class ju extends Kl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Ga(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,p){const y=this._lastPoints;if(!y)return;const w=n[0].sub(y[0]),C=n[1].sub(y[1]);return this._map._cooperativeGestures&&!m.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(w,C,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5})}gestureBeginsVertically(n,a,p){if(void 0!==this._valid)return this._valid;const y=n.mag()>=2,w=a.mag()>=2;if(!y&&!w)return;if(!y||!w)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const C=n.y>0==a.y>0;return Ga(n)&&Ga(a)&&C}}const fa={panStep:100,bearingStep:15,pitchStep:10};class hl{constructor(){const n=fa;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,p=0,y=0,w=0,C=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),w=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),w=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),C=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:P=>{const V=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Ss,zoom:a?Math.round(V)+a*(n.shiftKey?2:1):V,bearing:P.getBearing()+p*this._bearingStep,pitch:P.getPitch()+y*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:P.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ss(c){return c*(2-c)}const Oi=4.000244140625;class cc{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,m.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||m.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=m.exported.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==a&&a%Oi==0?this._type="wheel":0!==a&&Math.abs(a)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ct(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const V="wheel"===this._type&&Math.abs(this._delta)>Oi?this._wheelZoomRate:this._defaultZoomRate;let K=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&0!==K&&(K=1/K);const Y=a(),ce=Math.pow(2,Y),Pe="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):ce;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(Pe*K))),"wheel"===this._type&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:a(),y=this._startZoom,w=this._easing;let C,P=!1;if("wheel"===this._type&&y&&w){const V=Math.min((m.exported.now()-this._lastWheelEventTime)/200,1),K=w(V);C=m.number(y,p,K),V<1?this._frameId||(this._frameId=!0):P=!0}else C=p,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:C-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=m.ease;if(this._prevEase){const p=this._prevEase,y=(m.exported.now()-p.start)/p.duration,w=p.easing(y+.01)-p.easing(y),C=.27/Math.sqrt(w*w+1e-4)*.01,P=Math.sqrt(.0729-C*C);a=m.bezier(C,P,.25,1)}return this._prevEase={start:m.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(m.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ta{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zn{constructor(){this._tap=new js({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,a,p))}touchmove(n,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=a[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(n,a,p)}touchend(n,a,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(n,a,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gs{constructor(n,a,p){this._el=n,this._mousePan=a,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class As{constructor(n,a,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fu{constructor(n,a,p,y){this._el=n,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const pr=c=>c.zoom||c.drag||c.pitch||c.rotate;class zr extends m.Event{}class $u{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const p=m.sub([],a,n);this.radius=m.length(p[2]<0?m.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){m.div(n,n,this.constants),m.normalize(n,n),m.mul$1(n,n,this.constants);const a=m.scale$2([],n,this.radius);if(a[2]>0){const p=m.scale$2([],[0,0,1],m.dot(a,[0,0,1])),y=m.scale$2([],m.normalize([],[a[0],a[1],0]),this.radius),w=m.add([],a,m.scale$2([],m.sub([],m.add([],y,p),a),2));a[0]=w[0],a[1]=w[1]}return a}}function dr(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class xn{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new zs(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $u,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),m.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[m.window,"blur",void 0]];for(const[y,w,C]of this._listeners)y.addEventListener(w,y===m.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[n,a,p]of this._listeners)n.removeEventListener(a,n===m.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(n){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new xs(a,n));const y=a.boxZoom=new Kr(a,n);this._add("boxZoom",y);const w=new ea,C=new vo;a.doubleClickZoom=new ta(C,w),this._add("tapZoom",w),this._add("clickZoom",C);const P=new zn;this._add("tapDragZoom",P);const V=a.touchPitch=new ju(a);this._add("touchPitch",V);const K=new fo(n),Y=new Si(n);a.dragRotate=new As(n,K,Y),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);const ce=new ca(n),Pe=new dl(a,n);a.dragPan=new Gs(p,ce,Pe),this._add("mousePan",ce),this._add("touchPan",Pe,["touchZoom","touchRotate"]);const Ke=new jo,Ye=new Rc;a.touchZoomRotate=new fu(p,Ye,Ke,P),this._add("touchRotate",Ke,["touchPan","touchZoom"]),this._add("touchZoom",Ye,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lr(a));const rt=a.scrollZoom=new cc(a,this);this._add("scrollZoom",rt,["mousePan"]);const ot=a.keyboard=new hl;this._add("keyboard",ot);for(const pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[pe]&&a[pe].enable(n[pe])}_add(n,a,p){this._handlers.push({handlerName:n,handler:a,allowed:p}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,p){for(const y in n)if(y!==p&&(!a||a.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const p of n)this._el.contains(p.target)&&a.push(p);return a}handleEvent(n,a){this._updatingCamera=!0;const p="renderFrame"===n.type,y=p?void 0:n,w={needsRenderFrame:!1},C={},P={},V=n.touches?this._getMapTouches(n.touches):void 0,K=V?Ue(this._el,V):p?void 0:ct(this._el,n);for(const{handlerName:Pe,handler:Ke,allowed:Ye}of this._handlers){if(!Ke.isEnabled())continue;let rt;this._blockedByActive(P,Ye,Pe)?Ke.reset():Ke[a||n.type]&&(rt=Ke[a||n.type](n,K,V),this.mergeHandlerResult(w,C,rt,Pe,y),rt&&rt.needsRenderFrame&&this._triggerRenderFrame()),(rt||Ke.isActive())&&(P[Pe]=Ke)}const Y={};for(const Pe in this._previousActiveHandlers)P[Pe]||(Y[Pe]=y);this._previousActiveHandlers=P,(Object.keys(Y).length||dr(w))&&(this._changes.push([w,C,Y]),this._triggerRenderFrame()),(Object.keys(P).length||dr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ce}=w;ce&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ce(this._map))}mergeHandlerResult(n,a,p,y,w){if(!p)return;m.extend(n,p);const C={handlerName:y,originalEvent:p.originalEvent||w};void 0!==p.zoomDelta&&(a.zoom=C),void 0!==p.panDelta&&(a.drag=C),void 0!==p.pitchDelta&&(a.pitch=C),void 0!==p.bearingDelta&&(a.rotate=C)}_applyChanges(){const n={},a={},p={};for(const[y,w,C]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new m.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(n.around=y.around),void 0!==y.aroundCoord&&(n.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),m.extend(a,w),m.extend(p,C);this._updateMapTransform(n,a,p),this._changes=[]}_updateMapTransform(n,a,p){const y=this._map,w=y.transform,C=he=>[he.x,he.y,he.z];if((he=>{const gt=this._eventsInProgress.drag;return gt&&!this._handlersById[gt.handlerName].isActive()})()&&!dr(n)){const he=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",he!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&y._stop(!0),!dr(n))return void this._fireEvents(a,p,!0);let{panDelta:P,zoomDelta:V,bearingDelta:K,pitchDelta:Y,around:ce,aroundCoord:Pe,pinchAround:Ke}=n;w._isCameraConstrained&&(V>0&&(V=0),w._isCameraConstrained=!1),void 0!==Ke&&(ce=Ke),(V||(he=>a.drag&&!this._eventsInProgress.drag)())&&ce&&(this._dragOrigin=C(w.pointCoordinate3D(ce)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",y._stop(!0),ce=ce||y.transform.centerPoint,K&&(w.bearing+=K),Y&&(w.pitch+=Y),w._updateCameraState();const Ye=[0,0,0];if(P)if("mercator"===w.projection.name){const he=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(ce).dir),gt=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(ce.sub(P)).dir);Ye[0]=gt[0]-he[0],Ye[1]=gt[1]-he[1]}else{const he=w.pointCoordinate(ce);if("globe"===w.projection.name){P=P.rotate(-w.angle);const gt=w._pixelsPerMercatorPixel/w.worldSize;Ye[0]=-P.x*m.mercatorScale(m.latFromMercatorY(he.y))*gt,Ye[1]=-P.y*m.mercatorScale(w.center.lat)*gt}else{const gt=w.pointCoordinate(ce.sub(P));he&&gt&&(Ye[0]=gt.x-he.x,Ye[1]=gt.y-he.y)}}const rt=w.zoom,ot=[0,0,0];if(V){const he=C(Pe||w.pointCoordinate3D(ce)),gt={dir:m.normalize([],m.sub([],he,w._camera.position))};if(gt.dir[2]<0){const mt=w.zoomDeltaToMovement(he,V);m.scale$2(ot,gt.dir,mt)}}const pe=m.add(Ye,Ye,ot);w._translateCameraConstrained(pe),V&&Math.abs(w.zoom-rt)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,p,!0)}_fireEvents(n,a,p){const y=pr(this._eventsInProgress),w=pr(n),C={};for(const Y in n){const{originalEvent:ce}=n[Y];this._eventsInProgress[Y]||(C[`${Y}start`]=ce),this._eventsInProgress[Y]=n[Y]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const Y in C)this._fireEvent(Y,C[Y]);w&&this._fireEvent("move",w.originalEvent);for(const Y in n){const{originalEvent:ce}=n[Y];this._fireEvent(Y,ce)}const P={};let V;for(const Y in this._eventsInProgress){const{handlerName:ce,originalEvent:Pe}=this._eventsInProgress[Y];this._handlersById[ce].isActive()||(delete this._eventsInProgress[Y],V=a[ce]||Pe,P[`${Y}end`]=V)}for(const Y in P)this._fireEvent(Y,P[Y]);const K=pr(this._eventsInProgress);if(p&&(y||w)&&!K){this._updatingCamera=!0;const Y=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ce=Pe=>0!==Pe&&-this._bearingSnap<Pe&&Pe<this._bearingSnap;Y?(ce(Y.bearing||this._map.getBearing())&&(Y.bearing=0),this._map.easeTo(Y,{originalEvent:V})):(this._map.fire(new m.Event("moveend",{originalEvent:V})),ce(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new m.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new zr("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Un="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ao extends m.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=!1!==a.respectPrefersReducedMotion,m.bindAll(["_renderFrameCallback"],this)}getCenter(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,p){return n=m.Point.convert(n).mult(-1),this.panTo(this.transform.center,m.extend({offset:n},a),p)}panTo(n,a,p){return this.easeTo(m.extend({center:n},a),p)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,p){return this.easeTo(m.extend({zoom:n},a),p)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,p){return this.easeTo(m.extend({bearing:n},a),p)}resetNorth(n,a){return this.rotateTo(0,m.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=m.LngLatBounds.convert(n);const p=a&&a.bearing||0,y=a&&a.pitch||0,w=n.getNorthWest(),C=n.getSouthEast();return this._cameraForBounds(this.transform,w,C,p,y,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=m.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const p=n.padding;n.padding={top:p,bottom:p,right:p,left:p}}return n.padding=m.extend(a,n.padding),n}_minimumAABBFrustumDistance(n,a){const p=a.max[0]-a.min[0],y=a.max[1]-a.min[1];return p/y>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,p,y,w,C){const P=n.clone(),V=this._extendCameraOptions(C);P.bearing=y,P.pitch=w;const K=m.LngLat.convert(a),Y=m.LngLat.convert(p),ce=.5*(K.lat+Y.lat),Pe=.5*(K.lng+Y.lng),Ke=m.latLngToECEF(ce,Pe),Ye=m.normalize([],Ke),rt=m.normalize([],m.cross([],Ye,[0,1,0])),ot=m.cross([],rt,Ye),pe=[rt[0],rt[1],rt[2],0,ot[0],ot[1],ot[2],0,Ye[0],Ye[1],Ye[2],0,0,0,0,1],he=[Ke,m.latLngToECEF(K.lat,K.lng),m.latLngToECEF(Y.lat,K.lng),m.latLngToECEF(Y.lat,Y.lng),m.latLngToECEF(K.lat,Y.lng),m.latLngToECEF(ce,K.lng),m.latLngToECEF(ce,Y.lng),m.latLngToECEF(K.lat,Pe),m.latLngToECEF(Y.lat,Pe)];let gt=m.Aabb.fromPoints(he.map(Wn=>[m.dot(rt,Wn),m.dot(ot,Wn),m.dot(Ye,Wn)]));const mt=m.transformMat4([],gt.center,pe);0===m.squaredLength(mt)&&m.set(mt,0,0,1),m.normalize(mt,mt),m.scale$2(mt,mt,m.GLOBE_RADIUS),P.center=m.ecefToLatLng(mt);const Ut=P.getWorldToCameraMatrix(),jt=m.invert(new Float64Array(16),Ut);gt=m.Aabb.applyTransform(gt,m.multiply([],Ut,pe)),m.transformMat4(mt,mt,Ut);const It=.5*(gt.max[2]-gt.min[2]),tn=this._minimumAABBFrustumDistance(P,gt),Kt=m.scale$2([],[0,0,1],It),ln=m.add(Kt,mt,Kt),rr=tn+(0===P.pitch?0:m.distance(mt,ln)),cn=P.globeCenterInViewSpace,Dn=m.sub([],mt,[cn[0],cn[1],cn[2]]);m.normalize(Dn,Dn),m.scale$2(Dn,Dn,rr);const an=m.add([],mt,Dn);m.transformMat4(an,an,jt);const Kn=m.earthRadius/m.GLOBE_RADIUS,dn=m.length(an),Ln=m.mercatorZfromAltitude(Math.max(dn*Kn-m.earthRadius,Number.EPSILON),0),Nn=Math.min(P.zoomFromMercatorZAdjusted(Ln),V.maxZoom);return Nn>.5*(m.GLOBE_ZOOM_THRESHOLD_MIN+m.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"mercator"}),P.zoom=Nn,this._cameraForBounds(P,a,p,y,w,C)):{center:P.center,zoom:Nn,bearing:y,pitch:w}}queryTerrainElevation(n,a){const p=this.transform.elevation;return p?(a=m.extend({},{exaggerated:!0},a),p.getAtPoint(m.MercatorCoordinate.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,p,y,w,C){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,a,p,y,w,C);const P=n.clone(),V=this._extendCameraOptions(C),K=P.padding;P.bearing=y,P.pitch=w;const Y=m.LngLat.convert(a),ce=m.LngLat.convert(p),Pe=new m.LngLat(Y.lng,ce.lat),Ke=new m.LngLat(ce.lng,Y.lat),Ye=P.project(Y),rt=P.project(ce),ot=this.queryTerrainElevation(Y),pe=this.queryTerrainElevation(ce),he=this.queryTerrainElevation(Pe),gt=this.queryTerrainElevation(Ke),mt=[[Ye.x,Ye.y,Math.min(ot||0,pe||0,he||0,gt||0)],[rt.x,rt.y,Math.max(ot||0,pe||0,he||0,gt||0)]];let Ut=m.Aabb.fromPoints(mt);const jt=P.getWorldToCameraMatrix(),It=m.invert(new Float64Array(16),jt);Ut=m.Aabb.applyTransform(Ut,jt);const tn=m.sub([],Ut.max,Ut.min),Kt=K.left||0,ln=K.right||0,rr=K.bottom||0,cn=K.top||0,{left:Dn,right:an,top:Kn,bottom:dn}=V.padding,Ln=.5*(Kt+ln),Nn=.5*(cn+rr),Wn=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(Kt+ln+Dn+an))/tn[0],(P.height-(rr+cn+dn+Kn))/tn[1])),V.maxZoom),Yn=P.scale/P.zoomScale(Wn);Ut=new m.Aabb([Ut.min[0]-(Dn+Ln)*Yn,Ut.min[1]-(dn+Nn)*Yn,Ut.min[2]],[Ut.max[0]+(an+Ln)*Yn,Ut.max[1]+(Kn+Nn)*Yn,Ut.max[2]]);const Xr=.5*tn[2],bi=this._minimumAABBFrustumDistance(P,Ut),Br=[0,0,1,0];m.transformMat4$1(Br,Br,jt),m.normalize$2(Br,Br);const R=m.scale$2([],Br,bi+Xr),L=m.add([],Ut.center,R),$=("number"==typeof V.offset.x&&"number"==typeof V.offset.y?new m.Point(V.offset.x,V.offset.y):m.Point.convert(V.offset)).rotate(-m.degToRad(y));Ut.center[0]-=$.x*Yn,Ut.center[1]+=$.y*Yn,m.transformMat4(Ut.center,Ut.center,It),m.transformMat4(L,L,It);const ee=[Ut.center[0],Ut.center[1],L[2]*P.pixelsPerMeter];m.scale$2(ee,ee,1/P.worldSize);const Ee=m.lngFromMercatorX(ee[0]),st=m.latFromMercatorY(ee[1]),Et=Math.min(P._zoomFromMercatorZ(ee[2]),V.maxZoom),en=new m.LngLat(Ee,st);return P.mercatorFromTransition&&Et<.5*(m.GLOBE_ZOOM_THRESHOLD_MIN+m.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"globe"}),P.zoom=Et,this._cameraForBounds(P,a,p,y,w,C)):{center:en,zoom:Et,bearing:y,pitch:w}}fitBounds(n,a,p){const y=this.cameraForBounds(n,a);return this._fitInternal(y,a,p)}fitScreenCoordinates(n,a,p,y,w){const C=m.Point.convert(n),P=m.Point.convert(a),V=new m.Point(Math.min(C.x,P.x),Math.min(C.y,P.y)),K=new m.Point(Math.max(C.x,P.x),Math.max(C.y,P.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(C,P))return this;const Y=this.transform.pointLocation3D(V),ce=this.transform.pointLocation3D(K),Pe=this.transform.pointLocation3D(new m.Point(V.x,K.y)),Ke=this.transform.pointLocation3D(new m.Point(K.x,V.y)),Ye=[Math.min(Y.lng,ce.lng,Pe.lng,Ke.lng),Math.min(Y.lat,ce.lat,Pe.lat,Ke.lat)],rt=[Math.max(Y.lng,ce.lng,Pe.lng,Ke.lng),Math.max(Y.lat,ce.lat,Pe.lat,Ke.lat)],ot=y&&y.pitch?y.pitch:this.getPitch(),pe=this._cameraForBounds(this.transform,Ye,rt,p,ot,y);return this._fitInternal(pe,y,w)}_fitInternal(n,a,p){return n?(delete(a=m.extend(n,a)).padding,a.linear?this.easeTo(a,p):this.flyTo(a,p)):this}jumpTo(n,a){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let y=!1,w=!1,C=!1;return"zoom"in n&&p.zoom!==+n.zoom&&(y=!0,p.zoom=+n.zoom),void 0!==n.center&&(p.center=m.LngLat.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(w=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(C=!0,p.pitch=+n.pitch),null==n.padding||p.isPaddingEqual(n.padding)||(p.padding=n.padding),n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new m.Event("movestart",a)).fire(new m.Event("move",a)),y&&this.fire(new m.Event("zoomstart",a)).fire(new m.Event("zoom",a)).fire(new m.Event("zoomend",a)),w&&this.fire(new m.Event("rotatestart",a)).fire(new m.Event("rotate",a)).fire(new m.Event("rotateend",a)),C&&this.fire(new m.Event("pitchstart",a)).fire(new m.Event("pitch",a)).fire(new m.Event("pitchend",a)),this.fire(new m.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||m.warnOnce(Un),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const p=this.transform;if(!p.projection.supportsFreeCamera)return m.warnOnce(Un),this;this.stop();const y=p.zoom,w=p.pitch,C=p.bearing;p.setFreeCameraOptions(n);const P=y!==p.zoom,V=w!==p.pitch,K=C!==p.bearing;return this.fire(new m.Event("movestart",a)).fire(new m.Event("move",a)),P&&this.fire(new m.Event("zoomstart",a)).fire(new m.Event("zoom",a)).fire(new m.Event("zoomend",a)),K&&this.fire(new m.Event("rotatestart",a)).fire(new m.Event("rotate",a)).fire(new m.Event("rotateend",a)),V&&this.fire(new m.Event("pitchstart",a)).fire(new m.Event("pitch",a)).fire(new m.Event("pitchend",a)),this.fire(new m.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),(!1===(n=m.extend({offset:[0,0],duration:500,easing:m.ease},n)).animate||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,y=this.getZoom(),w=this.getBearing(),C=this.getPitch(),P=this.getPadding(),V="zoom"in n?+n.zoom:y,K="bearing"in n?this._normalizeBearing(n.bearing,w):w,Y="pitch"in n?+n.pitch:C,ce="padding"in n?n.padding:p.padding,Pe=m.Point.convert(n.offset);let Ke,Ye,rt;if("globe"===p.projection.name){const Kt=m.MercatorCoordinate.fromLngLat(p.center),ln=Pe.rotate(-p.angle);Kt.x+=ln.x/p.worldSize,Kt.y+=ln.y/p.worldSize;const rr=Kt.toLngLat(),cn=m.LngLat.convert(n.center||rr);this._normalizeCenter(cn),Ke=p.centerPoint.add(ln),Ye=new m.Point(Kt.x,Kt.y).mult(p.worldSize),rt=new m.Point(m.mercatorXfromLng(cn.lng),m.mercatorYfromLat(cn.lat)).mult(p.worldSize).sub(Ye)}else{Ke=p.centerPoint.add(Pe);const Kt=p.pointLocation(Ke),ln=m.LngLat.convert(n.center||Kt);this._normalizeCenter(ln),Ye=p.project(Kt),rt=p.project(ln).sub(Ye)}const ot=p.zoomScale(V-y);let pe,he;n.around&&(pe=m.LngLat.convert(n.around),he=p.locationPoint(pe));const gt=this._zooming||V!==y,mt=this._rotating||w!==K,Ut=this._pitching||Y!==C,jt=!p.isPaddingEqual(ce),It=Kt=>ln=>{if(gt&&(Kt.zoom=m.number(y,V,ln)),mt&&(Kt.bearing=m.number(w,K,ln)),Ut&&(Kt.pitch=m.number(C,Y,ln)),jt&&(Kt.interpolatePadding(P,ce,ln),Ke=Kt.centerPoint.add(Pe)),pe)Kt.setLocationAtPoint(pe,he);else{const rr=Kt.zoomScale(Kt.zoom-y),cn=V>y?Math.min(2,ot):Math.max(.5,ot),Dn=Math.pow(cn,1-ln),an=Kt.unproject(Ye.add(rt.mult(ln*Dn)).mult(rr));Kt.setLocationAtPoint(Kt.renderWorldCopies?an.wrap():an,Ke)}return n.preloadOnly||this._fireMoveEvents(a),Kt};if(n.preloadOnly){const Kt=this._emulate(It,n.duration,p);return this._preloadTiles(Kt),this}const tn={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=gt,this._rotating=mt,this._pitching=Ut,this._padding=jt,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,tn),this._ease(It(p),Kt=>{p.recenterOnTerrain(),this._afterEase(a,Kt)},n),this}_prepareEase(n,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||p.moving||this.fire(new m.Event("movestart",n)),this._zooming&&!p.zooming&&this.fire(new m.Event("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new m.Event("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new m.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new m.Event("move",n)),this._zooming&&this.fire(new m.Event("zoom",n)),this._rotating&&this.fire(new m.Event("rotate",n)),this._pitching&&this.fire(new m.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new m.Event("zoomend",n)),y&&this.fire(new m.Event("rotateend",n)),w&&this.fire(new m.Event("pitchend",n)),this.fire(new m.Event("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const Wn=m.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wn,a)}this.stop(),n=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},n);const p=this.transform,y=this.getZoom(),w=this.getBearing(),C=this.getPitch(),P=this.getPadding(),V="zoom"in n?m.clamp(+n.zoom,p.minZoom,p.maxZoom):y,K="bearing"in n?this._normalizeBearing(n.bearing,w):w,Y="pitch"in n?+n.pitch:C,ce="padding"in n?n.padding:p.padding,Pe=p.zoomScale(V-y),Ke=m.Point.convert(n.offset);let Ye=p.centerPoint.add(Ke);const rt=p.pointLocation(Ye),ot=m.LngLat.convert(n.center||rt);this._normalizeCenter(ot);const pe=p.project(rt),he=p.project(ot).sub(pe);let gt=n.curve;const mt=Math.max(p.width,p.height),Ut=mt/Pe,jt=he.mag();if("minZoom"in n){const Wn=m.clamp(Math.min(n.minZoom,y,V),p.minZoom,p.maxZoom),Yn=mt/p.zoomScale(Wn-y);gt=Math.sqrt(Yn/jt*2)}const It=gt*gt;function tn(Wn){const Yn=(Ut*Ut-mt*mt+(Wn?-1:1)*It*It*jt*jt)/(2*(Wn?Ut:mt)*It*jt);return Math.log(Math.sqrt(Yn*Yn+1)-Yn)}function Kt(Wn){return(Math.exp(Wn)-Math.exp(-Wn))/2}function ln(Wn){return(Math.exp(Wn)+Math.exp(-Wn))/2}const rr=tn(0);let cn=function(Wn){return ln(rr)/ln(rr+gt*Wn)},Dn=function(Wn){return mt*((ln(rr)*(Kt(Yn=rr+gt*Wn)/ln(Yn))-Kt(rr))/It)/jt;var Yn},an=(tn(1)-rr)/gt;if(Math.abs(jt)<1e-6||!isFinite(an)){if(Math.abs(mt-Ut)<1e-6)return this.easeTo(n,a);const Wn=Ut<mt?-1:1;an=Math.abs(Math.log(Ut/mt))/gt,Dn=function(){return 0},cn=function(Yn){return Math.exp(Wn*gt*Yn)}}n.duration="duration"in n?+n.duration:1e3*an/("screenSpeed"in n?+n.screenSpeed/gt:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Kn=w!==K,dn=Y!==C,Ln=!p.isPaddingEqual(ce),Nn=Wn=>Yn=>{const Xr=Yn*an,bi=1/cn(Xr);Wn.zoom=1===Yn?V:y+Wn.scaleZoom(bi),Kn&&(Wn.bearing=m.number(w,K,Yn)),dn&&(Wn.pitch=m.number(C,Y,Yn)),Ln&&(Wn.interpolatePadding(P,ce,Yn),Ye=Wn.centerPoint.add(Ke));const Br=1===Yn?ot:Wn.unproject(pe.add(he.mult(Dn(Xr))).mult(bi));return Wn.setLocationAtPoint(Wn.renderWorldCopies?Br.wrap():Br,Ye),Wn._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),Wn};if(n.preloadOnly){const Wn=this._emulate(Nn,n.duration,p);return this._preloadTiles(Wn),this}return this._zooming=!0,this._rotating=Kn,this._pitching=dn,this._padding=Ln,this._prepareEase(a,!1),this._ease(Nn(p),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,a)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,a,p){!1===p.animate||0===p.duration?(n(1),a()):(this._easeStart=m.exported.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((m.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=m.wrap(n,-180,180);const p=Math.abs(n-a);return Math.abs(n-360-a)<p&&(n-=360),Math.abs(n+360-a)<p&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const p=n.lng-a.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&m.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,p){const y=Math.ceil(15*a/1e3),w=[],C=n(p.clone());for(let P=0;P<=y;P++){const V=C(P/y);w.push(V.clone())}return w}}class Cr{constructor(n={}){this.options=n,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe("button","mapboxgl-ctrl-attrib-button",this._container),xe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=xe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===a&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const p=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",p),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(n){const p=a.reduce((y,w,C)=>(w.value&&(y+=`${w.key}=${w.value}${C<a.length-1?"&":""}`),y),"?");n.href=`${m.config.FEEDBACK_URL}/${p}#${wt(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const a=this._map.style._sourceCaches;for(const y in a){const w=a[y];if(w.used){const C=w.getSource();C.attribution&&n.indexOf(C.attribution)<0&&n.push(C.attribution)}}n.sort((y,w)=>y.length-w.length),n=n.filter((y,w)=>{for(let C=w+1;C<n.length;C++)if(n[C].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class pu{constructor(){m.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=xe("div","mapboxgl-ctrl");const a=xe("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const a in n){const p=n[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class $c{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const y of p)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function bc(c,n,a){if(c=new m.LngLat(c.lng,c.lat),n){const p=new m.LngLat(c.lng-360,c.lat),y=new m.LngLat(c.lng+360,c.lat),w=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),C=a.locationPoint(c).distSqr(n),P=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(p).distSqr(n)<C&&(P||Math.abs(p.lng-a.center.lng)<w)?c=p:a.locationPoint(y).distSqr(n)<C&&(P||Math.abs(y.lng-a.center.lng)<w)&&(c=y)}for(;Math.abs(c.lng-a.center.lng)>180;){const p=a.locationPoint(c);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const uc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class vr extends m.Evented{constructor(n,a){if(super(),(n instanceof m.window.HTMLElement||a)&&(n=m.extend({element:n},a)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=m.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=xe("div");const y=41,w=27,C=se("svg",{display:"block",height:y*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${y}`},this._element),P=se("radialGradient",{id:"shadowGradient"},se("defs",{},C));se("stop",{offset:"10%","stop-opacity":.4},P),se("stop",{offset:"100%","stop-opacity":.05},P),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=m.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const p=this._element.classList;for(const y in uc)p.remove(`mapboxgl-marker-anchor-${y}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=m.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,p=n.charCode||n.keyCode;"Space"!==a&&"Enter"!==a&&32!==p&&13!==p||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const p=n.unproject(a),y=n.getFreeCameraOptions();if(!y.position)return!1;const w=y.position.toLngLat();return w.distanceTo(p)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(a);let y;n._showingGlobe()&&m.isLngLatBehindGlobe(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${uc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${a.x}px,${a.y}px)\n        `}_calculateXYTransform(){const n=this._pos,a=this._map,p=this.getPitchAlignment();if(!a||!n||"map"!==p)return"";if(!a._showingGlobe()){const V=a.getPitch();return V?`rotateX(${V}deg)`:""}const y=m.radToDeg(m.globeTiltAtLngLat(a.transform,this._lngLat)),w=n.sub(m.globeCenterToScreenPoint(a.transform)),C=Math.abs(w.x)+Math.abs(w.y);if(0===C)return"";const P=y/C;return`rotateX(${-w.y*P}deg) rotateY(${w.x*P}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let p=0;const y=this.getRotationAlignment();if("map"===y)if(a._showingGlobe()){const w=a.project(new m.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=a.project(new m.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);p=m.radToDeg(Math.atan2(C.y,C.x))-90}else p=-a.getBearing();else if("horizon"===y){const w=m.smoothstep(4,6,a.getZoom()),C=m.globeCenterToScreenPoint(a.transform);C.y+=w*a.transform.height;const P=n.sub(C),V=m.radToDeg(Math.atan2(P.y,P.x));p=(V>90?V-270:V+90)*(1-w)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){m.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=bc(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),!0===n?this._updateFrameId=m.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=m.Point.convert(n),this._update(),this}_onMove(n){const a=this._map;if(!a)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const w=this._clickTolerance||a._clickTolerance;if(n.point.dist(p)<w)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new m.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,p=this._pos;a&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Su={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_d=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yd(c=new m.Point(0,0),n="bottom"){if("number"==typeof c){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new m.Point(0,c);case"top-left":return new m.Point(a,a);case"top-right":return new m.Point(-a,a);case"bottom":return new m.Point(0,-c);case"bottom-left":return new m.Point(a,-a);case"bottom-right":return new m.Point(-a,-a);case"left":return new m.Point(c,0);case"right":return new m.Point(-c,0)}return new m.Point(0,0)}return c instanceof m.Point||Array.isArray(c)?m.Point.convert(c):m.Point.convert(c[n]||[0,0])}class Gu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=m.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,p){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+p}}const td={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Qi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Pc={showCompass:!0,showZoom:!0,visualizePitch:!1};class nh{constructor(n,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new fo({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Si({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Oe()}move(n,a){const p=this.map,y=this.mouseRotate.mousemoveWindow(n,a),w=y&&y.bearingDelta;if(w&&p.setBearing(p.getBearing()+w),this.mousePitch){const C=this.mousePitch.mousemoveWindow(n,a),P=C&&C.pitchDelta;P&&p.setPitch(p.getPitch()+P)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){je(),m.window.removeEventListener("mousemove",this.mousemove),m.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(m.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ct(this.element,n)),m.window.addEventListener("mousemove",this.mousemove),m.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ct(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ue(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Ue(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Oo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},pi={maxWidth:100,unit:"metric"},Au={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Z={version:m.version,supported:De,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:class extends Ao{constructor(c){if(m.LivePerformanceUtils.mark(m.PerformanceMarkers.create),null!=(c=m.extend({},Qi,c)).minZoom&&null!=c.maxZoom&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=c.minPitch&&null!=c.maxPitch&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=c.minPitch&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=c.maxPitch&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&m.isSafariWithAntialiasingBug(m.window)&&(c.antialias=!1,m.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ke(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._useWebGL2=c.useWebGL2,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new $c,this._domRenderTaskQueue=new $c,this._controls=[],this._markers=[],this._popups=[],this._mapId=m.uniqueId(),this._locale=m.extend({},td,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Gu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new m.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,"string"==typeof c.container){if(this._container=m.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof m.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&m.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==m.window&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1),m.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new xn(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new be("string"==typeof c.hash&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,m.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Cr({customAttribution:c.customAttribution})),this._logoControl=new pu,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new m.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new m.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(c,n){if(void 0===n&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const p=this._controlPositions[n];return-1!==n.indexOf("bottom")?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new m.Event("movestart",c)).fire(new m.Event("move",c)),this.fire(new m.Event("resize",c)),n&&this.fire(new m.Event("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(m.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new m.Event("zoomstart")).fire(new m.Event("zoom")).fire(new m.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new m.Event("pitchstart")).fire(new m.Event("pitch")).fire(new m.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return"auto"===c?m.window.navigator.language:Array.isArray(c)?0===c.length?void 0:c.map(n=>"auto"===n?m.window.navigator.language:n):c}setLanguage(c){const n=this._parseLanguage(c);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(c){return this._lazyInitEmptyStyle(),c?"string"==typeof c&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const c=this.transform,n=c.projection.name;let a;"globe"===n&&c.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):"mercator"===n&&c.zoom<m.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;if(n="globe"===c.name&&this.transform.zoom>=m.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(c){return this.transform.locationPoint3D(m.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(m.Point.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,n,a){if("mouseenter"===c||"mouseover"===c){let p=!1;const y=C=>{const P=n.filter(K=>this.getLayer(K)),V=P.length?this.queryRenderedFeatures(C.point,{layers:P}):[];V.length?p||(p=!0,a.call(this,new ji(c,this,C.originalEvent,{features:V}))):p=!1},w=()=>{p=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:y,mouseout:w}}}if("mouseleave"===c||"mouseout"===c){let p=!1;const y=C=>{const P=n.filter(V=>this.getLayer(V));(P.length?this.queryRenderedFeatures(C.point,{layers:P}):[]).length?p=!0:p&&(p=!1,a.call(this,new ji(c,this,C.originalEvent)))},w=C=>{p&&(p=!1,a.call(this,new ji(c,this,C.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:y,mouseout:w}}}{const p=y=>{const w=n.filter(P=>this.getLayer(P)),C=w.length?this.queryRenderedFeatures(y.point,{layers:w}):[];C.length&&(y.features=C,a.call(this,y),delete y.features)};return{layers:new Set(n),listener:a,delegates:{[c]:p}}}}on(c,n,a){if(void 0===a)return super.on(c,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(c,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(c,n,a){if(void 0===a)return super.once(c,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(c,n,a);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(c,n,a){if(void 0===a)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);const p=(w,C)=>{if(w.size!==C.size)return!1;for(const P of w)if(!C.has(P))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[c]:void 0;return y&&(w=>{for(let C=0;C<w.length;C++){const P=w[C];if(P.listener===a&&p(P.layers,n)){for(const V in P.delegates)this.off(V,P.delegates[V]);return w.splice(C,1),this}}})(y),this}queryRenderedFeatures(c,n){return this.style?(void 0!==n||void 0===c||c instanceof m.Point||Array.isArray(c)||(n=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(c,n){return this.style.querySourceFeatures(c,n)}isPointOnSurface(c){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&m.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(m.Point.convert(c))}setStyle(c,n){return!1!==(n=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){const n=this._locale[c];if(null==n)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Bo(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof c?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if("string"==typeof c){const a=this._requestManager.normalizeStyleURL(c),p=this._requestManager.transformRequest(a,m.ResourceType.Style);m.getJSON(p,(y,w)=>{y?this.fire(new m.ErrorEvent(y)):w&&this._updateDiff(w,n)})}else"object"==typeof c&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(a){m.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(m.warnOnce("There is no style added to the map."),!1)}addSource(c,n){return this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const n in c){const a=c[n]._tiles;for(const p in a){const y=a[p];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(c,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,n,{pixelRatio:a=1,sdf:p=!1,stretchX:y,stretchY:w,content:C}={}){if(this._lazyInitEmptyStyle(),n instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&n instanceof m.window.ImageBitmap){const{width:P,height:V,data:K}=m.exported.getImageData(n);this.style.addImage(c,{data:new m.RGBAImage({width:P,height:V},K),pixelRatio:a,stretchX:y,stretchY:w,content:C,sdf:p,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:V}=n,K=n;this.style.addImage(c,{data:new m.RGBAImage({width:P,height:V},new Uint8Array(K.data)),pixelRatio:a,stretchX:y,stretchY:w,content:C,sdf:p,version:0,userImage:K}),K.onAdd&&K.onAdd(this,c)}}updateImage(c,n){const a=this.style.getImage(c);if(!a)return void this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&n instanceof m.window.ImageBitmap?m.exported.getImageData(n):n,{width:y,height:w}=p;void 0!==y&&void 0!==w?y===a.data.width&&w===a.data.height?(a.data.replace(p.data,!(n instanceof m.window.HTMLImageElement||m.window.ImageBitmap&&n instanceof m.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new m.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${w})\n                must be that same as the previous version of the image\n                (${a.data.width}, ${a.data.height})`))):this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){m.getImage(this._requestManager.transformRequest(c,m.ResourceType.Image),(a,p)=>{n(a,p instanceof m.window.HTMLImageElement?m.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(c,n){return this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)}moveLayer(c,n){return this.style.moveLayer(c,n),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,n,a){return this.style.setLayerZoomRange(c,n,a),this._update(!0)}setFilter(c,n,a={}){return this.style.setFilter(c,n,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,n,a,p={}){return this.style.setPaintProperty(c,n,a,p),this._update(!0)}getPaintProperty(c,n){return this.style.getPaintProperty(c,n)}setLayoutProperty(c,n,a,p={}){return this.style.setLayoutProperty(c,n,a,p),this._update(!0)}getLayoutProperty(c,n){return this.style.getLayoutProperty(c,n)}setLight(c,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(m.LngLat.convert(c),this.transform):0}setFeatureState(c,n){return this.style.setFeatureState(c,n),this._update()}removeFeatureState(c,n){return this.style.removeFeatureState(c,n),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,p,y,w=this._container;for(;w&&(!p||!y);){const C=m.window.getComputedStyle(w).transform;C&&"none"!==C&&(a=C.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&"0"!==a[0]&&"1"!==a[0]&&(p=a[0]),a[3]&&"0"!==a[3]&&"1"!==a[3]&&(y=a[3])),w=w.parentElement}this._containerWidth=p?Math.abs(c/p):c,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=xe("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=xe("div","mapboxgl-canvas-container",c);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=xe("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=xe("div","mapboxgl-control-container",c),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{p[y]=xe("div",`mapboxgl-ctrl-${y}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){const a=m.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const n=this._markers.indexOf(c);-1!==n&&this._markers.splice(n,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const n=this._popups.indexOf(c);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const c=m.extend({},De.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",c),a=n||this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);a?(this._useWebGL2&&!n&&m.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),m.storeAuthState(a,!0),this.painter=new $a(a,this.transform,!!n),this.on("data",p=>{"source"===p.dataType&&this.painter.setTileLoadedFlag(!0)}),m.exported$1.testSupport(a)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;const a=this.painter.context.extTimerQuery,p=m.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],m.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],m.window.performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,V=this.transform.pitch,K=m.exported.now(),Y=new m.EvaluationParameters(P,{now:K,fadeDuration:y,pitch:V,transition:this.style.getTransition()});this.style.update(Y)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const P=m.exported.now()-p;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout(()=>{const V=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new m.Event("gpu-timing-frame",{cpuTime:P,gpuTime:V})),m.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:V}})},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const V=this.painter.queryGpuTimers(P);this.fire(new m.Event("gpu-timing-layer",{layerTimes:V}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const V=this.painter.queryGpuTimeDeferredRender(P);this.fire(new m.Event("gpu-timing-deferred-render",{gpuTime:V}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(C||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(w=this._updateAverageElevation(p,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new m.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new m.Event("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,m.LivePerformanceUtils.mark(m.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&m.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const n of this._markers)c&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!c||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(c,n=!1){const a=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&a(0);if((n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=c;const C=Math.abs(p-y);if(C>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(y),a(y);this._averageElevation.easeTo(y,c,300)}else if(C>1e-4)return this._averageElevation.jumpTo(y),a(y)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){m.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===m.AUTH_ERR_MSG||401===c.status)){const n=this.painter.context.gl;m.storeAuthState(n,!1),this._logoControl instanceof pu&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new m.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),m.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function y(w){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,w,0);const C=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,C),C}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(y(c),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(c,n,a){let p=a[1]-a[0];const y=c.length/4;for(let w=0;w<n.length;w++){const C=n[w];let P=0;for(let V=0;V<C.length;V+=4)C[V]===c[V]&&C[V+1]===c[V+1]&&C[V+2]===c[V+2]&&C[V+3]===c[V+3]&&(P+=1);p+=(a[w+2]-a[w+1])*(1-P/y)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==m.window&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1),m.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),m.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new m.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=m.exported.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(c){const n=this.style?Object.values(this.style._sourceCaches):[];return m.asyncAll(n,(a,p)=>a._preloadTiles(c,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){"hidden"===m.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,n){m.setCacheLimits(c,n)}get version(){return m.version}},NavigationControl:class{constructor(c){this.options=m.extend({},Pc,c),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const n=c.getZoom(),a=n===c.getMaxZoom(),p=n===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nh(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){const a=xe("button",c,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(c,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends m.Evented{constructor(c){super(),this.options=m.extend({geolocation:m.window.navigator.geolocation},Oo,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ie(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,c(a)};void 0!==this._supportsGeolocation?c(this._supportsGeolocation):void 0!==m.window.navigator.permissions?m.window.navigator.permissions.query({name:"geolocation"}).then(a=>n("denied"!==a.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(c){const n=this._map.getMaxBounds(),a=c.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(c),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}}_updateCamera(c){const n=new m.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,p=this._map.getBearing(),y=m.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),y,{geolocateSource:!0})}_updateMarker(c){if(c){const n=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,n=m.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(1===c.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===c.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=xe("button","mapboxgl-ctrl-geolocate",this._container),xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===c){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe("div","mapboxgl-user-location"),this._dotElement.appendChild(xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new m.Event("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:!0===c.absolute&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{m.window.addEventListener("ondeviceorientationabsolute"in m.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==m.window.DeviceMotionEvent&&"function"==typeof m.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),m.window.removeEventListener("deviceorientation",this._onDeviceOrientation),m.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cr,ScaleControl:class{constructor(c){this.options=m.extend({},pi,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),m.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,p=n._containerWidth/2-c/2,y=n.unproject([p,a]),w=n.unproject([p+c,a]),C=y.distanceTo(w);if("imperial"===this.options.unit){const P=3.2808*C;P>5280?this._setScale(c,P/5280,"mile"):this._setScale(c,P,"foot")}else"nautical"===this.options.unit?this._setScale(c,C/1852,"nautical-mile"):C>=1e3?this._setScale(c,C/1e3,"kilometer"):this._setScale(c,C,"meter")}_setScale(c,n,a){this._map._requestDomTask(()=>{const p=function(w){const C=Math.pow(10,`${Math.floor(w)}`.length-1);let P=w/C;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(V){const K=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*K)/K}(P),C*P}(n),y=p/n;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==a?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(p):`${p}&nbsp;${Au[a]}`,this._container.style.width=c*y+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof m.window.HTMLElement?this._container=c.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in m.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!m.window.document.fullscreenEnabled&&!m.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xe("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(m.window.document.fullscreenElement||m.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends m.Evented{constructor(c){super(),this.options=m.extend(Object.create(Su),c),m.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new m.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new m.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(m.window.document.createTextNode(c))}setHTML(c){const n=m.window.document.createDocumentFragment(),a=m.window.document.createElement("body");let p;for(a.innerHTML=c;p=a.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=xe("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){const a=this._closeButton=xe("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,p=this._pos;if(!n||!a||!p)return"bottom";const y=a.offsetWidth,w=a.offsetHeight,C=p.x<y/2,P=p.x>n.transform.width-y/2;if(p.y+c<w)return C?"top-left":P?"top-right":"top";if(p.y>n.transform.height-w){if(C)return"bottom-left";if(P)return"bottom-right"}return C?"left":P?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let p=this._container;if(p||(p=this._container=xe("div","mapboxgl-popup",n.getContainer()),this._tip=xe("div","mapboxgl-popup-tip",p),p.appendChild(a)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bc(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){const y=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),w=yd(this.options.offset),C=this._anchor=this._getAnchor(w.y),P=yd(this.options.offset,C),V=y.add(P).round();n._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${uc[C]} translate(${V.x}px,${V.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=m.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(_d);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:vr,Style:Bo,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,FreeCameraOptions:Ls,Evented:m.Evented,config:m.config,prewarm:function(){ra().acquire(Wr)},clearPrewarmedResources:function(){const c=Bs;c&&(c.isPreloaded()&&1===c.numActive()?(c.release(Wr),Bs=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(c){m.config.ACCESS_TOKEN=c},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(c){m.config.API_URL=c},get workerCount(){return _r.workerCount},set workerCount(c){_r.workerCount=c},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){m.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){m.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:m.exported.setNow,restoreNow:m.exported.restoreNow};return Z}),O}()},4774:function(An){An.exports=function(){"use strict";function xt(Zt,ve){for(var re=0;re<ve.length;re++){var Q=ve[re];Q.enumerable=Q.enumerable||!1,Q.configurable=!0,"value"in Q&&(Q.writable=!0),Object.defineProperty(Zt,Q.key,Q)}}function z(Zt,ve){(null==ve||ve>Zt.length)&&(ve=Zt.length);for(var re=0,Q=new Array(ve);re<ve;re++)Q[re]=Zt[re];return Q}function ye(Zt,ve){var re;if(typeof Symbol>"u"||null==Zt[Symbol.iterator]){if(Array.isArray(Zt)||(re=function O(Zt,ve){if(Zt){if("string"==typeof Zt)return z(Zt,ve);var re=Object.prototype.toString.call(Zt).slice(8,-1);if("Object"===re&&Zt.constructor&&(re=Zt.constructor.name),"Map"===re||"Set"===re)return Array.from(Zt);if("Arguments"===re||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(re))return z(Zt,ve)}}(Zt))||ve&&Zt&&"number"==typeof Zt.length){re&&(Zt=re);var Q=0;return function(){return Q>=Zt.length?{done:!0}:{done:!1,value:Zt[Q++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(re=Zt[Symbol.iterator]()).next.bind(re)}var ae=function m(Zt){var ve={exports:{}};return Zt(ve,ve.exports),ve.exports}(function(Zt){function ve(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}Zt.exports={defaults:{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1},getDefaults:ve,changeDefaults:function re(Q){Zt.exports.defaults=Q}}}),De=/[&<>"']/,Be=/[&<>"']/g,Ve=/[<>"']|&(?!#?\w+;)/,xe=/[<>"']|&(?!#?\w+;)/g,se={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},me=function(ve){return se[ve]};var qe=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function Oe(Zt){return Zt.replace(qe,function(ve,re){return"colon"===(re=re.toLowerCase())?":":"#"===re.charAt(0)?"x"===re.charAt(1)?String.fromCharCode(parseInt(re.substring(2),16)):String.fromCharCode(+re.substring(1)):""})}var je=/(^|[^\[])\^/g;var et=/[^\w:]/g,ct=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;var nt={},Xe=/^[^:]+:\/*[^/]*$/,Le=/^([^:]+:)[\s\S]*$/,Te=/^([^:]+:\/*[^/]*)[\s\S]*$/;function at(Zt,ve){nt[" "+Zt]||(nt[" "+Zt]=Xe.test(Zt)?Zt+"/":nn(Zt,"/",!0));var re=-1===(Zt=nt[" "+Zt]).indexOf(":");return"//"===ve.substring(0,2)?re?ve:Zt.replace(Le,"$1")+ve:"/"===ve.charAt(0)?re?ve:Zt.replace(Te,"$1")+ve:Zt+ve}function nn(Zt,ve,re){var Q=Zt.length;if(0===Q)return"";for(var oe=0;oe<Q;){var ge=Zt.charAt(Q-oe-1);if(ge!==ve||re){if(ge===ve||!re)break;oe++}else oe++}return Zt.substr(0,Q-oe)}var Ht_escape=function He(Zt,ve){if(ve){if(De.test(Zt))return Zt.replace(Be,me)}else if(Ve.test(Zt))return Zt.replace(xe,me);return Zt},Ht_unescape=Oe,Ht_edit=function ht(Zt,ve){Zt=Zt.source||Zt,ve=ve||"";var re={replace:function(oe,ge){return ge=(ge=ge.source||ge).replace(je,"$1"),Zt=Zt.replace(oe,ge),re},getRegex:function(){return new RegExp(Zt,ve)}};return re},Ht_cleanUrl=function Ue(Zt,ve,re){if(Zt){var Q;try{Q=decodeURIComponent(Oe(re)).replace(et,"").toLowerCase()}catch{return null}if(0===Q.indexOf("javascript:")||0===Q.indexOf("vbscript:")||0===Q.indexOf("data:"))return null}ve&&!ct.test(re)&&(re=at(ve,re));try{re=encodeURI(re).replace(/%25/g,"%")}catch{return null}return re},Ht_noopTest={exec:function(){}},Ht_merge=function it(Zt){for(var re,Q,ve=1;ve<arguments.length;ve++)for(Q in re=arguments[ve])Object.prototype.hasOwnProperty.call(re,Q)&&(Zt[Q]=re[Q]);return Zt},Ht_checkSanitizeDeprecation=function Cn(Zt){Zt&&Zt.sanitize&&!Zt.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")},Ht_repeatString=function qt(Zt,ve){if(ve<1)return"";for(var re="";ve>1;)1&ve&&(re+=Zt),ve>>=1,Zt+=Zt;return re+Zt},lt=ae.defaults,Ct=nn,Pt=function Ge(Zt,ve){var Q=Zt.replace(/\|/g,function(ge,Me,$e){for(var Re=!1,Ie=Me;--Ie>=0&&"\\"===$e[Ie];)Re=!Re;return Re?"|":" |"}).split(/ \|/),oe=0;if(Q.length>ve)Q.splice(ve);else for(;Q.length<ve;)Q.push("");for(;oe<Q.length;oe++)Q[oe]=Q[oe].trim().replace(/\\\|/g,"|");return Q},Qe=Ht_escape,Tt=function bn(Zt,ve){if(-1===Zt.indexOf(ve[1]))return-1;for(var re=Zt.length,Q=0,oe=0;oe<re;oe++)if("\\"===Zt[oe])oe++;else if(Zt[oe]===ve[0])Q++;else if(Zt[oe]===ve[1]&&--Q<0)return oe;return-1};function $t(Zt,ve,re){var Q=ve.href,oe=ve.title?Qe(ve.title):null,ge=Zt[1].replace(/\\([\[\]])/g,"$1");return"!"!==Zt[0].charAt(0)?{type:"link",raw:re,href:Q,title:oe,text:ge}:{type:"image",raw:re,href:Q,title:oe,text:Qe(ge)}}var sn=function(){function Zt(re){this.options=re||lt}var ve=Zt.prototype;return ve.space=function(Q){var oe=this.rules.block.newline.exec(Q);if(oe)return oe[0].length>1?{type:"space",raw:oe[0]}:{raw:"\n"}},ve.code=function(Q,oe){var ge=this.rules.block.code.exec(Q);if(ge){var Me=oe[oe.length-1];if(Me&&"paragraph"===Me.type)return{raw:ge[0],text:ge[0].trimRight()};var $e=ge[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:ge[0],codeBlockStyle:"indented",text:this.options.pedantic?$e:Ct($e,"\n")}}},ve.fences=function(Q){var oe=this.rules.block.fences.exec(Q);if(oe){var ge=oe[0],Me=function Qt(Zt,ve){var re=Zt.match(/^(\s+)(?:```)/);if(null===re)return ve;var Q=re[1];return ve.split("\n").map(function(oe){var ge=oe.match(/^\s+/);return null===ge?oe:ge[0].length>=Q.length?oe.slice(Q.length):oe}).join("\n")}(ge,oe[3]||"");return{type:"code",raw:ge,lang:oe[2]?oe[2].trim():oe[2],text:Me}}},ve.heading=function(Q){var oe=this.rules.block.heading.exec(Q);if(oe){var ge=oe[2].trim();if(/#$/.test(ge)){var Me=Ct(ge,"#");(this.options.pedantic||!Me||/ $/.test(Me))&&(ge=Me.trim())}return{type:"heading",raw:oe[0],depth:oe[1].length,text:ge}}},ve.nptable=function(Q){var oe=this.rules.block.nptable.exec(Q);if(oe){var ge={type:"table",header:Pt(oe[1].replace(/^ *| *\| *$/g,"")),align:oe[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:oe[3]?oe[3].replace(/\n$/,"").split("\n"):[],raw:oe[0]};if(ge.header.length===ge.align.length){var $e,Me=ge.align.length;for($e=0;$e<Me;$e++)ge.align[$e]=/^ *-+: *$/.test(ge.align[$e])?"right":/^ *:-+: *$/.test(ge.align[$e])?"center":/^ *:-+ *$/.test(ge.align[$e])?"left":null;for(Me=ge.cells.length,$e=0;$e<Me;$e++)ge.cells[$e]=Pt(ge.cells[$e],ge.header.length);return ge}}},ve.hr=function(Q){var oe=this.rules.block.hr.exec(Q);if(oe)return{type:"hr",raw:oe[0]}},ve.blockquote=function(Q){var oe=this.rules.block.blockquote.exec(Q);if(oe){var ge=oe[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:oe[0],text:ge}}},ve.list=function(Q){var oe=this.rules.block.list.exec(Q);if(oe){var Je,Ae,Ne,ft,Vt,Rt,Mn,ar,ge=oe[0],Me=oe[2],$e=Me.length>1,Re={type:"list",raw:ge,ordered:$e,start:$e?+Me.slice(0,-1):"",loose:!1,items:[]},Ie=oe[0].match(this.rules.block.item),we=!1,wr=Ie.length;Ne=this.rules.block.listItemStart.exec(Ie[0]);for(var Hr=0;Hr<wr;Hr++){if(ge=Je=Ie[Hr],Hr!==wr-1){if(ft=this.rules.block.listItemStart.exec(Ie[Hr+1]),this.options.pedantic?ft[1].length>Ne[1].length:ft[1].length>Ne[0].length||ft[1].length>3){Ie.splice(Hr,2,Ie[Hr]+"\n"+Ie[Hr+1]),Hr--,wr--;continue}(!this.options.pedantic||this.options.smartLists?ft[2][ft[2].length-1]!==Me[Me.length-1]:$e===(1===ft[2].length))&&(Vt=Ie.slice(Hr+1).join("\n"),Re.raw=Re.raw.substring(0,Re.raw.length-Vt.length),Hr=wr-1),Ne=ft}Ae=Je.length,~(Je=Je.replace(/^ *([*+-]|\d+[.)]) ?/,"")).indexOf("\n ")&&(Ae-=Je.length,Je=Je.replace(this.options.pedantic?/^ {1,4}/gm:new RegExp("^ {1,"+Ae+"}","gm"),"")),Rt=we||/\n\n(?!\s*$)/.test(Je),Hr!==wr-1&&(we="\n"===Je.charAt(Je.length-1),Rt||(Rt=we)),Rt&&(Re.loose=!0),this.options.gfm&&(ar=void 0,(Mn=/^\[[ xX]\] /.test(Je))&&(ar=" "!==Je[1],Je=Je.replace(/^\[[ xX]\] +/,""))),Re.items.push({type:"list_item",raw:ge,task:Mn,checked:ar,loose:Rt,text:Je})}return Re}},ve.html=function(Q){var oe=this.rules.block.html.exec(Q);if(oe)return{type:this.options.sanitize?"paragraph":"html",raw:oe[0],pre:!this.options.sanitizer&&("pre"===oe[1]||"script"===oe[1]||"style"===oe[1]),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(oe[0]):Qe(oe[0]):oe[0]}},ve.def=function(Q){var oe=this.rules.block.def.exec(Q);if(oe)return oe[3]&&(oe[3]=oe[3].substring(1,oe[3].length-1)),{tag:oe[1].toLowerCase().replace(/\s+/g," "),raw:oe[0],href:oe[2],title:oe[3]}},ve.table=function(Q){var oe=this.rules.block.table.exec(Q);if(oe){var ge={type:"table",header:Pt(oe[1].replace(/^ *| *\| *$/g,"")),align:oe[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:oe[3]?oe[3].replace(/\n$/,"").split("\n"):[]};if(ge.header.length===ge.align.length){ge.raw=oe[0];var $e,Me=ge.align.length;for($e=0;$e<Me;$e++)ge.align[$e]=/^ *-+: *$/.test(ge.align[$e])?"right":/^ *:-+: *$/.test(ge.align[$e])?"center":/^ *:-+ *$/.test(ge.align[$e])?"left":null;for(Me=ge.cells.length,$e=0;$e<Me;$e++)ge.cells[$e]=Pt(ge.cells[$e].replace(/^ *\| *| *\| *$/g,""),ge.header.length);return ge}}},ve.lheading=function(Q){var oe=this.rules.block.lheading.exec(Q);if(oe)return{type:"heading",raw:oe[0],depth:"="===oe[2].charAt(0)?1:2,text:oe[1]}},ve.paragraph=function(Q){var oe=this.rules.block.paragraph.exec(Q);if(oe)return{type:"paragraph",raw:oe[0],text:"\n"===oe[1].charAt(oe[1].length-1)?oe[1].slice(0,-1):oe[1]}},ve.text=function(Q,oe){var ge=this.rules.block.text.exec(Q);if(ge){var Me=oe[oe.length-1];return Me&&"text"===Me.type?{raw:ge[0],text:ge[0]}:{type:"text",raw:ge[0],text:ge[0]}}},ve.escape=function(Q){var oe=this.rules.inline.escape.exec(Q);if(oe)return{type:"escape",raw:oe[0],text:Qe(oe[1])}},ve.tag=function(Q,oe,ge){var Me=this.rules.inline.tag.exec(Q);if(Me)return!oe&&/^<a /i.test(Me[0])?oe=!0:oe&&/^<\/a>/i.test(Me[0])&&(oe=!1),!ge&&/^<(pre|code|kbd|script)(\s|>)/i.test(Me[0])?ge=!0:ge&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(Me[0])&&(ge=!1),{type:this.options.sanitize?"text":"html",raw:Me[0],inLink:oe,inRawBlock:ge,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(Me[0]):Qe(Me[0]):Me[0]}},ve.link=function(Q){var oe=this.rules.inline.link.exec(Q);if(oe){var ge=oe[2].trim();if(!this.options.pedantic&&/^</.test(ge)){if(!/>$/.test(ge))return;var Me=Ct(ge.slice(0,-1),"\\");if((ge.length-Me.length)%2==0)return}else{var $e=Tt(oe[2],"()");if($e>-1){var Ie=(0===oe[0].indexOf("!")?5:4)+oe[1].length+$e;oe[2]=oe[2].substring(0,$e),oe[0]=oe[0].substring(0,Ie).trim(),oe[3]=""}}var we=oe[2],Je="";if(this.options.pedantic){var Ae=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(we);Ae&&(we=Ae[1],Je=Ae[3])}else Je=oe[3]?oe[3].slice(1,-1):"";return we=we.trim(),/^</.test(we)&&(we=this.options.pedantic&&!/>$/.test(ge)?we.slice(1):we.slice(1,-1)),$t(oe,{href:we&&we.replace(this.rules.inline._escapes,"$1"),title:Je&&Je.replace(this.rules.inline._escapes,"$1")},oe[0])}},ve.reflink=function(Q,oe){var ge;if((ge=this.rules.inline.reflink.exec(Q))||(ge=this.rules.inline.nolink.exec(Q))){var Me=(ge[2]||ge[1]).replace(/\s+/g," ");if(!(Me=oe[Me.toLowerCase()])||!Me.href){var $e=ge[0].charAt(0);return{type:"text",raw:$e,text:$e}}return $t(ge,Me,ge[0])}},ve.strong=function(Q,oe,ge){void 0===ge&&(ge="");var Me=this.rules.inline.strong.start.exec(Q);if(Me&&(!Me[1]||Me[1]&&(""===ge||this.rules.inline.punctuation.exec(ge)))){oe=oe.slice(-1*Q.length);var Re,$e="**"===Me[0]?this.rules.inline.strong.endAst:this.rules.inline.strong.endUnd;for($e.lastIndex=0;null!=(Me=$e.exec(oe));)if(Re=this.rules.inline.strong.middle.exec(oe.slice(0,Me.index+3)))return{type:"strong",raw:Q.slice(0,Re[0].length),text:Q.slice(2,Re[0].length-2)}}},ve.em=function(Q,oe,ge){void 0===ge&&(ge="");var Me=this.rules.inline.em.start.exec(Q);if(Me&&(!Me[1]||Me[1]&&(""===ge||this.rules.inline.punctuation.exec(ge)))){oe=oe.slice(-1*Q.length);var Re,$e="*"===Me[0]?this.rules.inline.em.endAst:this.rules.inline.em.endUnd;for($e.lastIndex=0;null!=(Me=$e.exec(oe));)if(Re=this.rules.inline.em.middle.exec(oe.slice(0,Me.index+2)))return{type:"em",raw:Q.slice(0,Re[0].length),text:Q.slice(1,Re[0].length-1)}}},ve.codespan=function(Q){var oe=this.rules.inline.code.exec(Q);if(oe){var ge=oe[2].replace(/\n/g," "),Me=/[^ ]/.test(ge),$e=/^ /.test(ge)&&/ $/.test(ge);return Me&&$e&&(ge=ge.substring(1,ge.length-1)),ge=Qe(ge,!0),{type:"codespan",raw:oe[0],text:ge}}},ve.br=function(Q){var oe=this.rules.inline.br.exec(Q);if(oe)return{type:"br",raw:oe[0]}},ve.del=function(Q){var oe=this.rules.inline.del.exec(Q);if(oe)return{type:"del",raw:oe[0],text:oe[2]}},ve.autolink=function(Q,oe){var Me,$e,ge=this.rules.inline.autolink.exec(Q);if(ge)return $e="@"===ge[2]?"mailto:"+(Me=Qe(this.options.mangle?oe(ge[1]):ge[1])):Me=Qe(ge[1]),{type:"link",raw:ge[0],text:Me,href:$e,tokens:[{type:"text",raw:Me,text:Me}]}},ve.url=function(Q,oe){var ge;if(ge=this.rules.inline.url.exec(Q)){var Me,$e;if("@"===ge[2])$e="mailto:"+(Me=Qe(this.options.mangle?oe(ge[0]):ge[0]));else{var Re;do{Re=ge[0],ge[0]=this.rules.inline._backpedal.exec(ge[0])[0]}while(Re!==ge[0]);Me=Qe(ge[0]),$e="www."===ge[1]?"http://"+Me:Me}return{type:"link",raw:ge[0],text:Me,href:$e,tokens:[{type:"text",raw:Me,text:Me}]}}},ve.inlineText=function(Q,oe,ge){var $e,Me=this.rules.inline.text.exec(Q);if(Me)return $e=oe?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(Me[0]):Qe(Me[0]):Me[0]:Qe(this.options.smartypants?ge(Me[0]):Me[0]),{type:"text",raw:Me[0],text:$e}},Zt}(),mn=Ht_noopTest,Vn=Ht_edit,Fr=Ht_merge,Ot={newline:/^(?: *(?:\n|$))+/,code:/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?:\n+|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?! {0,3}bull )\n*|\s*$)/,html:"^ {0,3}(?:<(script|pre|style)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:\\n{2,}|$)|<(?!script|pre|style)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$)|</(?!script|pre|style)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$))",def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,nptable:mn,table:mn,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html| +\n)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\[\[\]]|[^\[\]])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};Ot.def=Vn(Ot.def).replace("label",Ot._label).replace("title",Ot._title).getRegex(),Ot.bullet=/(?:[*+-]|\d{1,9}[.)])/,Ot.item=/^( *)(bull) ?[^\n]*(?:\n(?! *bull ?)[^\n]*)*/,Ot.item=Vn(Ot.item,"gm").replace(/bull/g,Ot.bullet).getRegex(),Ot.listItemStart=Vn(/^( *)(bull)/).replace("bull",Ot.bullet).getRegex(),Ot.list=Vn(Ot.list).replace(/bull/g,Ot.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+Ot.def.source+")").getRegex(),Ot._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ot._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,Ot.html=Vn(Ot.html,"i").replace("comment",Ot._comment).replace("tag",Ot._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Ot.paragraph=Vn(Ot._paragraph).replace("hr",Ot.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",Ot._tag).getRegex(),Ot.blockquote=Vn(Ot.blockquote).replace("paragraph",Ot.paragraph).getRegex(),Ot.normal=Fr({},Ot),Ot.gfm=Fr({},Ot.normal,{nptable:"^ *([^|\\n ].*\\|.*)\\n {0,3}([-:]+ *\\|[-| :]*)(?:\\n((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)",table:"^ *\\|(.+)\\n {0,3}\\|?( *[-:]+[-| :]*)(?:\\n *((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),Ot.gfm.nptable=Vn(Ot.gfm.nptable).replace("hr",Ot.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",Ot._tag).getRegex(),Ot.gfm.table=Vn(Ot.gfm.table).replace("hr",Ot.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",Ot._tag).getRegex(),Ot.pedantic=Fr({},Ot.normal,{html:Vn("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",Ot._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:mn,paragraph:Vn(Ot.normal._paragraph).replace("hr",Ot.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",Ot.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var on={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:mn,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(?!\s*\])((?:\\[\[\]]?|[^\[\]\\])+)\]/,nolink:/^!?\[(?!\s*\])((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",strong:{start:/^(?:(\*\*(?=[*punctuation]))|\*\*)(?![\s])|__/,middle:/^\*\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*\*$|^__(?![\s])((?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?)__$/,endAst:/[^punctuation\s]\*\*(?!\*)|[punctuation]\*\*(?!\*)(?:(?=[punctuation_\s]|$))/,endUnd:/[^\s]__(?!_)(?:(?=[punctuation*\s])|$)/},em:{start:/^(?:(\*(?=[punctuation]))|\*)(?![*\s])|_/,middle:/^\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*$|^_(?![_\s])(?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?_$/,endAst:/[^punctuation\s]\*(?!\*)|[punctuation]\*(?!\*)(?:(?=[punctuation_\s]|$))/,endUnd:/[^\s]_(?!_)(?:(?=[punctuation*\s])|$)/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:mn,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\s*punctuation])/,_punctuation:"!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~"};on.punctuation=Vn(on.punctuation).replace(/punctuation/g,on._punctuation).getRegex(),on._blockSkip="\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>",on._overlapSkip="__[^_]*?__|\\*\\*\\[^\\*\\]*?\\*\\*",on._comment=Vn(Ot._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),on.em.start=Vn(on.em.start).replace(/punctuation/g,on._punctuation).getRegex(),on.em.middle=Vn(on.em.middle).replace(/punctuation/g,on._punctuation).replace(/overlapSkip/g,on._overlapSkip).getRegex(),on.em.endAst=Vn(on.em.endAst,"g").replace(/punctuation/g,on._punctuation).getRegex(),on.em.endUnd=Vn(on.em.endUnd,"g").replace(/punctuation/g,on._punctuation).getRegex(),on.strong.start=Vn(on.strong.start).replace(/punctuation/g,on._punctuation).getRegex(),on.strong.middle=Vn(on.strong.middle).replace(/punctuation/g,on._punctuation).replace(/overlapSkip/g,on._overlapSkip).getRegex(),on.strong.endAst=Vn(on.strong.endAst,"g").replace(/punctuation/g,on._punctuation).getRegex(),on.strong.endUnd=Vn(on.strong.endUnd,"g").replace(/punctuation/g,on._punctuation).getRegex(),on.blockSkip=Vn(on._blockSkip,"g").getRegex(),on.overlapSkip=Vn(on._overlapSkip,"g").getRegex(),on._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,on._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,on._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,on.autolink=Vn(on.autolink).replace("scheme",on._scheme).replace("email",on._email).getRegex(),on._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,on.tag=Vn(on.tag).replace("comment",on._comment).replace("attribute",on._attribute).getRegex(),on._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,on._href=/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/,on._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,on.link=Vn(on.link).replace("label",on._label).replace("href",on._href).replace("title",on._title).getRegex(),on.reflink=Vn(on.reflink).replace("label",on._label).getRegex(),on.reflinkSearch=Vn(on.reflinkSearch,"g").replace("reflink",on.reflink).replace("nolink",on.nolink).getRegex(),on.normal=Fr({},on),on.pedantic=Fr({},on.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:Vn(/^!?\[(label)\]\((.*?)\)/).replace("label",on._label).getRegex(),reflink:Vn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",on._label).getRegex()}),on.gfm=Fr({},on.normal,{escape:Vn(on.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*~]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))/}),on.gfm.url=Vn(on.gfm.url,"i").replace("email",on.gfm._extended_email).getRegex(),on.breaks=Fr({},on.gfm,{br:Vn(on.br).replace("{2,}","*").getRegex(),text:Vn(on.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});var Or={block:Ot,inline:on},jr=ae.defaults,ur=Or.block,Ai=Or.inline,Ri=Ht_repeatString;function nr(Zt){return Zt.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201c").replace(/"/g,"\u201d").replace(/\.{3}/g,"\u2026")}function mr(Zt){var re,Q,ve="",oe=Zt.length;for(re=0;re<oe;re++)Q=Zt.charCodeAt(re),Math.random()>.5&&(Q="x"+Q.toString(16)),ve+="&#"+Q+";";return ve}var Er=function(){function Zt(re){this.tokens=[],this.tokens.links=Object.create(null),this.options=re||jr,this.options.tokenizer=this.options.tokenizer||new sn,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options;var Q={block:ur.normal,inline:Ai.normal};this.options.pedantic?(Q.block=ur.pedantic,Q.inline=Ai.pedantic):this.options.gfm&&(Q.block=ur.gfm,Q.inline=this.options.breaks?Ai.breaks:Ai.gfm),this.tokenizer.rules=Q}Zt.lex=function(Q,oe){return new Zt(oe).lex(Q)},Zt.lexInline=function(Q,oe){return new Zt(oe).inlineTokens(Q)};var ve=Zt.prototype;return ve.lex=function(Q){return Q=Q.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),this.blockTokens(Q,this.tokens,!0),this.inline(this.tokens),this.tokens},ve.blockTokens=function(Q,oe,ge){void 0===oe&&(oe=[]),void 0===ge&&(ge=!0),this.options.pedantic&&(Q=Q.replace(/^ +$/gm,""));for(var Me,$e,Re,Ie;Q;)if(Me=this.tokenizer.space(Q))Q=Q.substring(Me.raw.length),Me.type&&oe.push(Me);else if(Me=this.tokenizer.code(Q,oe))Q=Q.substring(Me.raw.length),Me.type?oe.push(Me):((Ie=oe[oe.length-1]).raw+="\n"+Me.raw,Ie.text+="\n"+Me.text);else if(Me=this.tokenizer.fences(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(Me=this.tokenizer.heading(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(Me=this.tokenizer.nptable(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(Me=this.tokenizer.hr(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(Me=this.tokenizer.blockquote(Q))Q=Q.substring(Me.raw.length),Me.tokens=this.blockTokens(Me.text,[],ge),oe.push(Me);else if(Me=this.tokenizer.list(Q)){for(Q=Q.substring(Me.raw.length),Re=Me.items.length,$e=0;$e<Re;$e++)Me.items[$e].tokens=this.blockTokens(Me.items[$e].text,[],!1);oe.push(Me)}else if(Me=this.tokenizer.html(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(ge&&(Me=this.tokenizer.def(Q)))Q=Q.substring(Me.raw.length),this.tokens.links[Me.tag]||(this.tokens.links[Me.tag]={href:Me.href,title:Me.title});else if(Me=this.tokenizer.table(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(Me=this.tokenizer.lheading(Q))Q=Q.substring(Me.raw.length),oe.push(Me);else if(ge&&(Me=this.tokenizer.paragraph(Q)))Q=Q.substring(Me.raw.length),oe.push(Me);else if(Me=this.tokenizer.text(Q,oe))Q=Q.substring(Me.raw.length),Me.type?oe.push(Me):((Ie=oe[oe.length-1]).raw+="\n"+Me.raw,Ie.text+="\n"+Me.text);else if(Q){var we="Infinite loop on byte: "+Q.charCodeAt(0);if(this.options.silent){console.error(we);break}throw new Error(we)}return oe},ve.inline=function(Q){var oe,ge,Me,$e,Re,Ie,we=Q.length;for(oe=0;oe<we;oe++)switch(Ie=Q[oe],Ie.type){case"paragraph":case"text":case"heading":Ie.tokens=[],this.inlineTokens(Ie.text,Ie.tokens);break;case"table":for(Ie.tokens={header:[],cells:[]},$e=Ie.header.length,ge=0;ge<$e;ge++)Ie.tokens.header[ge]=[],this.inlineTokens(Ie.header[ge],Ie.tokens.header[ge]);for($e=Ie.cells.length,ge=0;ge<$e;ge++)for(Re=Ie.cells[ge],Ie.tokens.cells[ge]=[],Me=0;Me<Re.length;Me++)Ie.tokens.cells[ge][Me]=[],this.inlineTokens(Re[Me],Ie.tokens.cells[ge][Me]);break;case"blockquote":this.inline(Ie.tokens);break;case"list":for($e=Ie.items.length,ge=0;ge<$e;ge++)this.inline(Ie.items[ge].tokens)}return Q},ve.inlineTokens=function(Q,oe,ge,Me){void 0===oe&&(oe=[]),void 0===ge&&(ge=!1),void 0===Me&&(Me=!1);var $e,Ie,we,Je,Re=Q;if(this.tokens.links){var Ae=Object.keys(this.tokens.links);if(Ae.length>0)for(;null!=(Ie=this.tokenizer.rules.inline.reflinkSearch.exec(Re));)Ae.includes(Ie[0].slice(Ie[0].lastIndexOf("[")+1,-1))&&(Re=Re.slice(0,Ie.index)+"["+Ri("a",Ie[0].length-2)+"]"+Re.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(Ie=this.tokenizer.rules.inline.blockSkip.exec(Re));)Re=Re.slice(0,Ie.index)+"["+Ri("a",Ie[0].length-2)+"]"+Re.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;Q;)if(we||(Je=""),we=!1,$e=this.tokenizer.escape(Q))Q=Q.substring($e.raw.length),oe.push($e);else if($e=this.tokenizer.tag(Q,ge,Me))Q=Q.substring($e.raw.length),ge=$e.inLink,Me=$e.inRawBlock,oe.push($e);else if($e=this.tokenizer.link(Q))Q=Q.substring($e.raw.length),"link"===$e.type&&($e.tokens=this.inlineTokens($e.text,[],!0,Me)),oe.push($e);else if($e=this.tokenizer.reflink(Q,this.tokens.links))Q=Q.substring($e.raw.length),"link"===$e.type&&($e.tokens=this.inlineTokens($e.text,[],!0,Me)),oe.push($e);else if($e=this.tokenizer.strong(Q,Re,Je))Q=Q.substring($e.raw.length),$e.tokens=this.inlineTokens($e.text,[],ge,Me),oe.push($e);else if($e=this.tokenizer.em(Q,Re,Je))Q=Q.substring($e.raw.length),$e.tokens=this.inlineTokens($e.text,[],ge,Me),oe.push($e);else if($e=this.tokenizer.codespan(Q))Q=Q.substring($e.raw.length),oe.push($e);else if($e=this.tokenizer.br(Q))Q=Q.substring($e.raw.length),oe.push($e);else if($e=this.tokenizer.del(Q))Q=Q.substring($e.raw.length),$e.tokens=this.inlineTokens($e.text,[],ge,Me),oe.push($e);else if($e=this.tokenizer.autolink(Q,mr))Q=Q.substring($e.raw.length),oe.push($e);else if(ge||!($e=this.tokenizer.url(Q,mr))){if($e=this.tokenizer.inlineText(Q,Me,nr))Q=Q.substring($e.raw.length),Je=$e.raw.slice(-1),we=!0,oe.push($e);else if(Q){var Ne="Infinite loop on byte: "+Q.charCodeAt(0);if(this.options.silent){console.error(Ne);break}throw new Error(Ne)}}else Q=Q.substring($e.raw.length),oe.push($e);return oe},function H(Zt,ve,re){return ve&&xt(Zt.prototype,ve),re&&xt(Zt,re),Zt}(Zt,null,[{key:"rules",get:function(){return{block:ur,inline:Ai}}}]),Zt}(),Zn=ae.defaults,us=Ht_cleanUrl,Hn=Ht_escape,Sr=function(){function Zt(re){this.options=re||Zn}var ve=Zt.prototype;return ve.code=function(Q,oe,ge){var Me=(oe||"").match(/\S*/)[0];if(this.options.highlight){var $e=this.options.highlight(Q,Me);null!=$e&&$e!==Q&&(ge=!0,Q=$e)}return Q=Q.replace(/\n$/,"")+"\n",Me?'<pre><code class="'+this.options.langPrefix+Hn(Me,!0)+'">'+(ge?Q:Hn(Q,!0))+"</code></pre>\n":"<pre><code>"+(ge?Q:Hn(Q,!0))+"</code></pre>\n"},ve.blockquote=function(Q){return"<blockquote>\n"+Q+"</blockquote>\n"},ve.html=function(Q){return Q},ve.heading=function(Q,oe,ge,Me){return this.options.headerIds?"<h"+oe+' id="'+this.options.headerPrefix+Me.slug(ge)+'">'+Q+"</h"+oe+">\n":"<h"+oe+">"+Q+"</h"+oe+">\n"},ve.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},ve.list=function(Q,oe,ge){var Me=oe?"ol":"ul";return"<"+Me+(oe&&1!==ge?' start="'+ge+'"':"")+">\n"+Q+"</"+Me+">\n"},ve.listitem=function(Q){return"<li>"+Q+"</li>\n"},ve.checkbox=function(Q){return"<input "+(Q?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},ve.paragraph=function(Q){return"<p>"+Q+"</p>\n"},ve.table=function(Q,oe){return oe&&(oe="<tbody>"+oe+"</tbody>"),"<table>\n<thead>\n"+Q+"</thead>\n"+oe+"</table>\n"},ve.tablerow=function(Q){return"<tr>\n"+Q+"</tr>\n"},ve.tablecell=function(Q,oe){var ge=oe.header?"th":"td";return(oe.align?"<"+ge+' align="'+oe.align+'">':"<"+ge+">")+Q+"</"+ge+">\n"},ve.strong=function(Q){return"<strong>"+Q+"</strong>"},ve.em=function(Q){return"<em>"+Q+"</em>"},ve.codespan=function(Q){return"<code>"+Q+"</code>"},ve.br=function(){return this.options.xhtml?"<br/>":"<br>"},ve.del=function(Q){return"<del>"+Q+"</del>"},ve.link=function(Q,oe,ge){if(null===(Q=us(this.options.sanitize,this.options.baseUrl,Q)))return ge;var Me='<a href="'+Hn(Q)+'"';return oe&&(Me+=' title="'+oe+'"'),Me+">"+ge+"</a>"},ve.image=function(Q,oe,ge){if(null===(Q=us(this.options.sanitize,this.options.baseUrl,Q)))return ge;var Me='<img src="'+Q+'" alt="'+ge+'"';return oe&&(Me+=' title="'+oe+'"'),Me+(this.options.xhtml?"/>":">")},ve.text=function(Q){return Q},Zt}(),kr=function(){function Zt(){}var ve=Zt.prototype;return ve.strong=function(Q){return Q},ve.em=function(Q){return Q},ve.codespan=function(Q){return Q},ve.del=function(Q){return Q},ve.html=function(Q){return Q},ve.text=function(Q){return Q},ve.link=function(Q,oe,ge){return""+ge},ve.image=function(Q,oe,ge){return""+ge},ve.br=function(){return""},Zt}(),Gt=function(){function Zt(){this.seen={}}var ve=Zt.prototype;return ve.serialize=function(Q){return Q.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")},ve.getNextSafeSlug=function(Q,oe){var ge=Q,Me=0;if(this.seen.hasOwnProperty(ge)){Me=this.seen[Q];do{ge=Q+"-"+ ++Me}while(this.seen.hasOwnProperty(ge))}return oe||(this.seen[Q]=Me,this.seen[ge]=0),ge},ve.slug=function(Q,oe){void 0===oe&&(oe={});var ge=this.serialize(Q);return this.getNextSafeSlug(ge,oe.dryrun)},Zt}(),Bt=ae.defaults,Ce=Ht_unescape,pt=function(){function Zt(re){this.options=re||Bt,this.options.renderer=this.options.renderer||new Sr,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new kr,this.slugger=new Gt}Zt.parse=function(Q,oe){return new Zt(oe).parse(Q)},Zt.parseInline=function(Q,oe){return new Zt(oe).parseInline(Q)};var ve=Zt.prototype;return ve.parse=function(Q,oe){void 0===oe&&(oe=!0);var Me,$e,Re,Ie,we,Je,Ae,Ne,ft,Vt,Rt,Mn,ar,wr,Hr,Li,$i,Wr,ge="",_r=Q.length;for(Me=0;Me<_r;Me++)switch(Vt=Q[Me],Vt.type){case"space":continue;case"hr":ge+=this.renderer.hr();continue;case"heading":ge+=this.renderer.heading(this.parseInline(Vt.tokens),Vt.depth,Ce(this.parseInline(Vt.tokens,this.textRenderer)),this.slugger);continue;case"code":ge+=this.renderer.code(Vt.text,Vt.lang,Vt.escaped);continue;case"table":for(Ne="",Ae="",Ie=Vt.header.length,$e=0;$e<Ie;$e++)Ae+=this.renderer.tablecell(this.parseInline(Vt.tokens.header[$e]),{header:!0,align:Vt.align[$e]});for(Ne+=this.renderer.tablerow(Ae),ft="",Ie=Vt.cells.length,$e=0;$e<Ie;$e++){for(Ae="",we=(Je=Vt.tokens.cells[$e]).length,Re=0;Re<we;Re++)Ae+=this.renderer.tablecell(this.parseInline(Je[Re]),{header:!1,align:Vt.align[Re]});ft+=this.renderer.tablerow(Ae)}ge+=this.renderer.table(Ne,ft);continue;case"blockquote":ft=this.parse(Vt.tokens),ge+=this.renderer.blockquote(ft);continue;case"list":for(Rt=Vt.ordered,Mn=Vt.start,ar=Vt.loose,Ie=Vt.items.length,ft="",$e=0;$e<Ie;$e++)Li=(Hr=Vt.items[$e]).checked,$i=Hr.task,wr="",Hr.task&&(Wr=this.renderer.checkbox(Li),ar?Hr.tokens.length>0&&"text"===Hr.tokens[0].type?(Hr.tokens[0].text=Wr+" "+Hr.tokens[0].text,Hr.tokens[0].tokens&&Hr.tokens[0].tokens.length>0&&"text"===Hr.tokens[0].tokens[0].type&&(Hr.tokens[0].tokens[0].text=Wr+" "+Hr.tokens[0].tokens[0].text)):Hr.tokens.unshift({type:"text",text:Wr}):wr+=Wr),wr+=this.parse(Hr.tokens,ar),ft+=this.renderer.listitem(wr,$i,Li);ge+=this.renderer.list(ft,Rt,Mn);continue;case"html":ge+=this.renderer.html(Vt.text);continue;case"paragraph":ge+=this.renderer.paragraph(this.parseInline(Vt.tokens));continue;case"text":for(ft=Vt.tokens?this.parseInline(Vt.tokens):Vt.text;Me+1<_r&&"text"===Q[Me+1].type;)ft+="\n"+((Vt=Q[++Me]).tokens?this.parseInline(Vt.tokens):Vt.text);ge+=oe?this.renderer.paragraph(ft):ft;continue;default:var Bs='Token with "'+Vt.type+'" type was not found.';if(this.options.silent)return void console.error(Bs);throw new Error(Bs)}return ge},ve.parseInline=function(Q,oe){oe=oe||this.renderer;var Me,$e,ge="",Re=Q.length;for(Me=0;Me<Re;Me++)switch($e=Q[Me],$e.type){case"escape":case"text":ge+=oe.text($e.text);break;case"html":ge+=oe.html($e.text);break;case"link":ge+=oe.link($e.href,$e.title,this.parseInline($e.tokens,oe));break;case"image":ge+=oe.image($e.href,$e.title,$e.text);break;case"strong":ge+=oe.strong(this.parseInline($e.tokens,oe));break;case"em":ge+=oe.em(this.parseInline($e.tokens,oe));break;case"codespan":ge+=oe.codespan($e.text);break;case"br":ge+=oe.br();break;case"del":ge+=oe.del(this.parseInline($e.tokens,oe));break;default:var Ie='Token with "'+$e.type+'" type was not found.';if(this.options.silent)return void console.error(Ie);throw new Error(Ie)}return ge},Zt}(),Mt=Ht_merge,hn=Ht_checkSanitizeDeprecation,Ur=Ht_escape,vi=ae.getDefaults,$r=ae.changeDefaults,ci=ae.defaults;function qn(Zt,ve,re){if(typeof Zt>"u"||null===Zt)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof Zt)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(Zt)+", string expected");if("function"==typeof ve&&(re=ve,ve=null),ve=Mt({},qn.defaults,ve||{}),hn(ve),re){var oe,Q=ve.highlight;try{oe=Er.lex(Zt,ve)}catch(Re){return re(Re)}var ge=function(Ie){var we;if(!Ie)try{we=pt.parse(oe,ve)}catch(Je){Ie=Je}return ve.highlight=Q,Ie?re(Ie):re(null,we)};if(!Q||Q.length<3||(delete ve.highlight,!oe.length))return ge();var Me=0;return qn.walkTokens(oe,function(Re){"code"===Re.type&&(Me++,setTimeout(function(){Q(Re.text,Re.lang,function(Ie,we){if(Ie)return ge(Ie);null!=we&&we!==Re.text&&(Re.text=we,Re.escaped=!0),0==--Me&&ge()})},0))}),void(0===Me&&ge())}try{var $e=Er.lex(Zt,ve);return ve.walkTokens&&qn.walkTokens($e,ve.walkTokens),pt.parse($e,ve)}catch(Re){if(Re.message+="\nPlease report this to https://github.com/markedjs/marked.",ve.silent)return"<p>An error occurred:</p><pre>"+Ur(Re.message+"",!0)+"</pre>";throw Re}}return qn.options=qn.setOptions=function(Zt){return Mt(qn.defaults,Zt),$r(qn.defaults),qn},qn.getDefaults=vi,qn.defaults=ci,qn.use=function(Zt){var ve=Mt({},Zt);if(Zt.renderer&&function(){var Q=qn.defaults.renderer||new Sr,oe=function($e){var Re=Q[$e];Q[$e]=function(){for(var Ie=arguments.length,we=new Array(Ie),Je=0;Je<Ie;Je++)we[Je]=arguments[Je];var Ae=Zt.renderer[$e].apply(Q,we);return!1===Ae&&(Ae=Re.apply(Q,we)),Ae}};for(var ge in Zt.renderer)oe(ge);ve.renderer=Q}(),Zt.tokenizer&&function(){var Q=qn.defaults.tokenizer||new sn,oe=function($e){var Re=Q[$e];Q[$e]=function(){for(var Ie=arguments.length,we=new Array(Ie),Je=0;Je<Ie;Je++)we[Je]=arguments[Je];var Ae=Zt.tokenizer[$e].apply(Q,we);return!1===Ae&&(Ae=Re.apply(Q,we)),Ae}};for(var ge in Zt.tokenizer)oe(ge);ve.tokenizer=Q}(),Zt.walkTokens){var re=qn.defaults.walkTokens;ve.walkTokens=function(Q){Zt.walkTokens(Q),re&&re(Q)}}qn.setOptions(ve)},qn.walkTokens=function(Zt,ve){for(var Q,re=ye(Zt);!(Q=re()).done;){var oe=Q.value;switch(ve(oe),oe.type){case"table":for(var Me,ge=ye(oe.tokens.header);!(Me=ge()).done;)qn.walkTokens(Me.value,ve);for(var Ie,Re=ye(oe.tokens.cells);!(Ie=Re()).done;)for(var Ae,Je=ye(Ie.value);!(Ae=Je()).done;)qn.walkTokens(Ae.value,ve);break;case"list":qn.walkTokens(oe.items,ve);break;default:oe.tokens&&qn.walkTokens(oe.tokens,ve)}}},qn.parseInline=function(Zt,ve){if(typeof Zt>"u"||null===Zt)throw new Error("marked.parseInline(): input parameter is undefined or null");if("string"!=typeof Zt)throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(Zt)+", string expected");ve=Mt({},qn.defaults,ve||{}),hn(ve);try{var re=Er.lexInline(Zt,ve);return ve.walkTokens&&qn.walkTokens(re,ve.walkTokens),pt.parseInline(re,ve)}catch(Q){if(Q.message+="\nPlease report this to https://github.com/markedjs/marked.",ve.silent)return"<p>An error occurred:</p><pre>"+Ur(Q.message+"",!0)+"</pre>";throw Q}},qn.Parser=pt,qn.parser=pt.parse,qn.Renderer=Sr,qn.TextRenderer=kr,qn.Lexer=Er,qn.lexer=Er.lex,qn.Tokenizer=sn,qn.Slugger=Gt,qn.parse=qn,qn}()},1686:An=>{"use strict";const xt=(H,O)=>{let z,ye=!1;"function"==typeof O?z=O:(ye=!0===O?.cycles,z=O?.cmp);const m=new Set;return function ae(De){if(De&&De.toJSON&&"function"==typeof De.toJSON&&(De=De.toJSON()),void 0===De)return;if(null===De)return"null";if("number"==typeof De)return isFinite(De)?""+De:"null";if("object"!=typeof De)return JSON.stringify(De);if(Array.isArray(De))return`[${De.map(xe=>{var se;return null!==(se=ae(xe))&&void 0!==se?se:"null"}).join(",")}]`;if(m.has(De)){if(ye)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}m.add(De);const Be=z?Object.entries(De).sort((xe,se)=>z({key:xe[0],value:xe[1]},{key:se[0],value:se[1]})).map(xe=>xe[0]):Object.keys(De).sort(),Ve=[];for(const xe of Be){const se=ae(De[xe]);se&&Ve.push(`"${xe}":${se}`)}return m.delete(De),`{${Ve.join(",")}}`}(H)};xt.default=xt,An.exports=xt},4412:(An,xt,H)=>{"use strict";H.d(xt,{t:()=>z});var O=H(1413);class z extends O.B{constructor(m){super(),this._value=m}get value(){return this.getValue()}_subscribe(m){const ae=super._subscribe(m);return!ae.closed&&m.next(this._value),ae}getValue(){const{hasError:m,thrownError:ae,_value:De}=this;if(m)throw ae;return this._throwIfClosed(),De}next(m){super.next(this._value=m)}}},1985:(An,xt,H)=>{"use strict";H.d(xt,{c:()=>Ve});var O=H(7707),z=H(8359),ye=H(3494),m=H(1203),ae=H(1026),De=H(8071),Be=H(9786);let Ve=(()=>{class He{constructor(Oe){Oe&&(this._subscribe=Oe)}lift(Oe){const je=new He;return je.source=this,je.operator=Oe,je}subscribe(Oe,je,ht){const et=function me(He){return He&&He instanceof O.vU||function se(He){return He&&(0,De.T)(He.next)&&(0,De.T)(He.error)&&(0,De.T)(He.complete)}(He)&&(0,z.Uv)(He)}(Oe)?Oe:new O.Ms(Oe,je,ht);return(0,Be.Y)(()=>{const{operator:ct,source:Ue}=this;et.add(ct?ct.call(et,Ue):Ue?this._subscribe(et):this._trySubscribe(et))}),et}_trySubscribe(Oe){try{return this._subscribe(Oe)}catch(je){Oe.error(je)}}forEach(Oe,je){return new(je=xe(je))((ht,et)=>{const ct=new O.Ms({next:Ue=>{try{Oe(Ue)}catch(nt){et(nt),ct.unsubscribe()}},error:et,complete:ht});this.subscribe(ct)})}_subscribe(Oe){var je;return null===(je=this.source)||void 0===je?void 0:je.subscribe(Oe)}[ye.s](){return this}pipe(...Oe){return(0,m.m)(Oe)(this)}toPromise(Oe){return new(Oe=xe(Oe))((je,ht)=>{let et;this.subscribe(ct=>et=ct,ct=>ht(ct),()=>je(et))})}}return He.create=qe=>new He(qe),He})();function xe(He){var qe;return null!==(qe=He??ae.$.Promise)&&void 0!==qe?qe:Promise}},2771:(An,xt,H)=>{"use strict";H.d(xt,{m:()=>ye});var O=H(1413),z=H(6129);class ye extends O.B{constructor(ae=1/0,De=1/0,Be=z.U){super(),this._bufferSize=ae,this._windowTime=De,this._timestampProvider=Be,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=De===1/0,this._bufferSize=Math.max(1,ae),this._windowTime=Math.max(1,De)}next(ae){const{isStopped:De,_buffer:Be,_infiniteTimeWindow:Ve,_timestampProvider:xe,_windowTime:se}=this;De||(Be.push(ae),!Ve&&Be.push(xe.now()+se)),this._trimBuffer(),super.next(ae)}_subscribe(ae){this._throwIfClosed(),this._trimBuffer();const De=this._innerSubscribe(ae),{_infiniteTimeWindow:Be,_buffer:Ve}=this,xe=Ve.slice();for(let se=0;se<xe.length&&!ae.closed;se+=Be?1:2)ae.next(xe[se]);return this._checkFinalizedStatuses(ae),De}_trimBuffer(){const{_bufferSize:ae,_timestampProvider:De,_buffer:Be,_infiniteTimeWindow:Ve}=this,xe=(Ve?1:2)*ae;if(ae<1/0&&xe<Be.length&&Be.splice(0,Be.length-xe),!Ve){const se=De.now();let me=0;for(let He=1;He<Be.length&&Be[He]<=se;He+=2)me=He;me&&Be.splice(0,me+1)}}}},1413:(An,xt,H)=>{"use strict";H.d(xt,{B:()=>Be});var O=H(1985),z=H(8359);const m=(0,H(1853).L)(xe=>function(){xe(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var ae=H(7908),De=H(9786);let Be=(()=>{class xe extends O.c{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(me){const He=new Ve(this,this);return He.operator=me,He}_throwIfClosed(){if(this.closed)throw new m}next(me){(0,De.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const He of this.currentObservers)He.next(me)}})}error(me){(0,De.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=me;const{observers:He}=this;for(;He.length;)He.shift().error(me)}})}complete(){(0,De.Y)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:me}=this;for(;me.length;)me.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var me;return(null===(me=this.observers)||void 0===me?void 0:me.length)>0}_trySubscribe(me){return this._throwIfClosed(),super._trySubscribe(me)}_subscribe(me){return this._throwIfClosed(),this._checkFinalizedStatuses(me),this._innerSubscribe(me)}_innerSubscribe(me){const{hasError:He,isStopped:qe,observers:Oe}=this;return He||qe?z.Kn:(this.currentObservers=null,Oe.push(me),new z.yU(()=>{this.currentObservers=null,(0,ae.o)(Oe,me)}))}_checkFinalizedStatuses(me){const{hasError:He,thrownError:qe,isStopped:Oe}=this;He?me.error(qe):Oe&&me.complete()}asObservable(){const me=new O.c;return me.source=this,me}}return xe.create=(se,me)=>new Ve(se,me),xe})();class Ve extends Be{constructor(se,me){super(),this.destination=se,this.source=me}next(se){var me,He;null===(He=null===(me=this.destination)||void 0===me?void 0:me.next)||void 0===He||He.call(me,se)}error(se){var me,He;null===(He=null===(me=this.destination)||void 0===me?void 0:me.error)||void 0===He||He.call(me,se)}complete(){var se,me;null===(me=null===(se=this.destination)||void 0===se?void 0:se.complete)||void 0===me||me.call(se)}_subscribe(se){var me,He;return null!==(He=null===(me=this.source)||void 0===me?void 0:me.subscribe(se))&&void 0!==He?He:z.Kn}}},7707:(An,xt,H)=>{"use strict";H.d(xt,{Ms:()=>ht,vU:()=>He});var O=H(8071),z=H(8359),ye=H(1026),m=H(5334),ae=H(5343);const De=xe("C",void 0,void 0);function xe(Xe,Le,Te){return{kind:Xe,value:Le,error:Te}}var se=H(9270),me=H(9786);class He extends z.yU{constructor(Le){super(),this.isStopped=!1,Le?(this.destination=Le,(0,z.Uv)(Le)&&Le.add(this)):this.destination=nt}static create(Le,Te,at){return new ht(Le,Te,at)}next(Le){this.isStopped?Ue(function Ve(Xe){return xe("N",Xe,void 0)}(Le),this):this._next(Le)}error(Le){this.isStopped?Ue(function Be(Xe){return xe("E",void 0,Xe)}(Le),this):(this.isStopped=!0,this._error(Le))}complete(){this.isStopped?Ue(De,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Le){this.destination.next(Le)}_error(Le){try{this.destination.error(Le)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const qe=Function.prototype.bind;function Oe(Xe,Le){return qe.call(Xe,Le)}class je{constructor(Le){this.partialObserver=Le}next(Le){const{partialObserver:Te}=this;if(Te.next)try{Te.next(Le)}catch(at){et(at)}}error(Le){const{partialObserver:Te}=this;if(Te.error)try{Te.error(Le)}catch(at){et(at)}else et(Le)}complete(){const{partialObserver:Le}=this;if(Le.complete)try{Le.complete()}catch(Te){et(Te)}}}class ht extends He{constructor(Le,Te,at){let Ze;if(super(),(0,O.T)(Le)||!Le)Ze={next:Le??void 0,error:Te??void 0,complete:at??void 0};else{let it;this&&ye.$.useDeprecatedNextContext?(it=Object.create(Le),it.unsubscribe=()=>this.unsubscribe(),Ze={next:Le.next&&Oe(Le.next,it),error:Le.error&&Oe(Le.error,it),complete:Le.complete&&Oe(Le.complete,it)}):Ze=Le}this.destination=new je(Ze)}}function et(Xe){ye.$.useDeprecatedSynchronousErrorHandling?(0,me.l)(Xe):(0,m.m)(Xe)}function Ue(Xe,Le){const{onStoppedNotification:Te}=ye.$;Te&&se.f.setTimeout(()=>Te(Xe,Le))}const nt={closed:!0,next:ae.l,error:function ct(Xe){throw Xe},complete:ae.l}},8359:(An,xt,H)=>{"use strict";H.d(xt,{Kn:()=>De,yU:()=>ae,Uv:()=>Be});var O=H(8071);const ye=(0,H(1853).L)(xe=>function(me){xe(this),this.message=me?`${me.length} errors occurred during unsubscription:\n${me.map((He,qe)=>`${qe+1}) ${He.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=me});var m=H(7908);class ae{constructor(se){this.initialTeardown=se,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let se;if(!this.closed){this.closed=!0;const{_parentage:me}=this;if(me)if(this._parentage=null,Array.isArray(me))for(const Oe of me)Oe.remove(this);else me.remove(this);const{initialTeardown:He}=this;if((0,O.T)(He))try{He()}catch(Oe){se=Oe instanceof ye?Oe.errors:[Oe]}const{_finalizers:qe}=this;if(qe){this._finalizers=null;for(const Oe of qe)try{Ve(Oe)}catch(je){se=se??[],je instanceof ye?se=[...se,...je.errors]:se.push(je)}}if(se)throw new ye(se)}}add(se){var me;if(se&&se!==this)if(this.closed)Ve(se);else{if(se instanceof ae){if(se.closed||se._hasParent(this))return;se._addParent(this)}(this._finalizers=null!==(me=this._finalizers)&&void 0!==me?me:[]).push(se)}}_hasParent(se){const{_parentage:me}=this;return me===se||Array.isArray(me)&&me.includes(se)}_addParent(se){const{_parentage:me}=this;this._parentage=Array.isArray(me)?(me.push(se),me):me?[me,se]:se}_removeParent(se){const{_parentage:me}=this;me===se?this._parentage=null:Array.isArray(me)&&(0,m.o)(me,se)}remove(se){const{_finalizers:me}=this;me&&(0,m.o)(me,se),se instanceof ae&&se._removeParent(this)}}ae.EMPTY=(()=>{const xe=new ae;return xe.closed=!0,xe})();const De=ae.EMPTY;function Be(xe){return xe instanceof ae||xe&&"closed"in xe&&(0,O.T)(xe.remove)&&(0,O.T)(xe.add)&&(0,O.T)(xe.unsubscribe)}function Ve(xe){(0,O.T)(xe)?xe():xe.unsubscribe()}},1026:(An,xt,H)=>{"use strict";H.d(xt,{$:()=>O});const O={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},8793:(An,xt,H)=>{"use strict";H.d(xt,{x:()=>ae});var O=H(6365),ye=H(9326),m=H(8455);function ae(...De){return function z(){return(0,O.U)(1)}()((0,m.H)(De,(0,ye.lI)(De)))}},9030:(An,xt,H)=>{"use strict";H.d(xt,{v:()=>ye});var O=H(1985),z=H(8750);function ye(m){return new O.c(ae=>{(0,z.Tg)(m()).subscribe(ae)})}},983:(An,xt,H)=>{"use strict";H.d(xt,{w:()=>z});const z=new(H(1985).c)(ae=>ae.complete())},7468:(An,xt,H)=>{"use strict";H.d(xt,{p:()=>Ve});var O=H(1985),z=H(3073),ye=H(8750),m=H(9326),ae=H(4360),De=H(6450),Be=H(8496);function Ve(...xe){const se=(0,m.ms)(xe),{args:me,keys:He}=(0,z.D)(xe),qe=new O.c(Oe=>{const{length:je}=me;if(!je)return void Oe.complete();const ht=new Array(je);let et=je,ct=je;for(let Ue=0;Ue<je;Ue++){let nt=!1;(0,ye.Tg)(me[Ue]).subscribe((0,ae._)(Oe,Xe=>{nt||(nt=!0,ct--),ht[Ue]=Xe},()=>et--,void 0,()=>{(!et||!nt)&&(ct||Oe.next(He?(0,Be.e)(He,ht):ht),Oe.complete())}))}});return se?qe.pipe((0,De.I)(se)):qe}},8455:(An,xt,H)=>{"use strict";H.d(xt,{H:()=>Le});var O=H(8750),z=H(941),ye=H(6745),De=H(1985),Ve=H(4761),xe=H(8071),se=H(5225);function He(Te,at){if(!Te)throw new Error("Iterable cannot be null");return new De.c(Ze=>{(0,se.N)(Ze,at,()=>{const it=Te[Symbol.asyncIterator]();(0,se.N)(Ze,at,()=>{it.next().then(Ge=>{Ge.done?Ze.complete():Ze.next(Ge.value)})},0,!0)})})}var qe=H(5055),Oe=H(9858),je=H(7441),ht=H(5397),et=H(7953),ct=H(591),Ue=H(5196);function Le(Te,at){return at?function Xe(Te,at){if(null!=Te){if((0,qe.l)(Te))return function m(Te,at){return(0,O.Tg)(Te).pipe((0,ye._)(at),(0,z.Q)(at))}(Te,at);if((0,je.X)(Te))return function Be(Te,at){return new De.c(Ze=>{let it=0;return at.schedule(function(){it===Te.length?Ze.complete():(Ze.next(Te[it++]),Ze.closed||this.schedule())})})}(Te,at);if((0,Oe.y)(Te))return function ae(Te,at){return(0,O.Tg)(Te).pipe((0,ye._)(at),(0,z.Q)(at))}(Te,at);if((0,et.T)(Te))return He(Te,at);if((0,ht.x)(Te))return function me(Te,at){return new De.c(Ze=>{let it;return(0,se.N)(Ze,at,()=>{it=Te[Ve.l](),(0,se.N)(Ze,at,()=>{let Ge,nn;try{({value:Ge,done:nn}=it.next())}catch(bn){return void Ze.error(bn)}nn?Ze.complete():Ze.next(Ge)},0,!0)}),()=>(0,xe.T)(it?.return)&&it.return()})}(Te,at);if((0,Ue.U)(Te))return function nt(Te,at){return He((0,Ue.C)(Te),at)}(Te,at)}throw(0,ct.L)(Te)}(Te,at):(0,O.Tg)(Te)}},3726:(An,xt,H)=>{"use strict";H.d(xt,{R:()=>se});var O=H(8750),z=H(1985),ye=H(1397),m=H(7441),ae=H(8071),De=H(6450);const Be=["addListener","removeListener"],Ve=["addEventListener","removeEventListener"],xe=["on","off"];function se(je,ht,et,ct){if((0,ae.T)(et)&&(ct=et,et=void 0),ct)return se(je,ht,et).pipe((0,De.I)(ct));const[Ue,nt]=function Oe(je){return(0,ae.T)(je.addEventListener)&&(0,ae.T)(je.removeEventListener)}(je)?Ve.map(Xe=>Le=>je[Xe](ht,Le,et)):function He(je){return(0,ae.T)(je.addListener)&&(0,ae.T)(je.removeListener)}(je)?Be.map(me(je,ht)):function qe(je){return(0,ae.T)(je.on)&&(0,ae.T)(je.off)}(je)?xe.map(me(je,ht)):[];if(!Ue&&(0,m.X)(je))return(0,ye.Z)(Xe=>se(Xe,ht,et))((0,O.Tg)(je));if(!Ue)throw new TypeError("Invalid event target");return new z.c(Xe=>{const Le=(...Te)=>Xe.next(1<Te.length?Te:Te[0]);return Ue(Le),()=>nt(Le)})}function me(je,ht){return et=>ct=>je[et](ht,ct)}},8750:(An,xt,H)=>{"use strict";H.d(xt,{Tg:()=>qe});var O=H(1635),z=H(7441),ye=H(9858),m=H(1985),ae=H(5055),De=H(7953),Be=H(591),Ve=H(5397),xe=H(5196),se=H(8071),me=H(5334),He=H(3494);function qe(Xe){if(Xe instanceof m.c)return Xe;if(null!=Xe){if((0,ae.l)(Xe))return function Oe(Xe){return new m.c(Le=>{const Te=Xe[He.s]();if((0,se.T)(Te.subscribe))return Te.subscribe(Le);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Xe);if((0,z.X)(Xe))return function je(Xe){return new m.c(Le=>{for(let Te=0;Te<Xe.length&&!Le.closed;Te++)Le.next(Xe[Te]);Le.complete()})}(Xe);if((0,ye.y)(Xe))return function ht(Xe){return new m.c(Le=>{Xe.then(Te=>{Le.closed||(Le.next(Te),Le.complete())},Te=>Le.error(Te)).then(null,me.m)})}(Xe);if((0,De.T)(Xe))return ct(Xe);if((0,Ve.x)(Xe))return function et(Xe){return new m.c(Le=>{for(const Te of Xe)if(Le.next(Te),Le.closed)return;Le.complete()})}(Xe);if((0,xe.U)(Xe))return function Ue(Xe){return ct((0,xe.C)(Xe))}(Xe)}throw(0,Be.L)(Xe)}function ct(Xe){return new m.c(Le=>{(function nt(Xe,Le){var Te,at,Ze,it;return(0,O.sH)(this,void 0,void 0,function*(){try{for(Te=(0,O.xN)(Xe);!(at=yield Te.next()).done;)if(Le.next(at.value),Le.closed)return}catch(Ge){Ze={error:Ge}}finally{try{at&&!at.done&&(it=Te.return)&&(yield it.call(Te))}finally{if(Ze)throw Ze.error}}Le.complete()})})(Xe,Le).catch(Te=>Le.error(Te))})}},7786:(An,xt,H)=>{"use strict";H.d(xt,{h:()=>De});var O=H(6365),z=H(8750),ye=H(983),m=H(9326),ae=H(8455);function De(...Be){const Ve=(0,m.lI)(Be),xe=(0,m.R0)(Be,1/0),se=Be;return se.length?1===se.length?(0,z.Tg)(se[0]):(0,O.U)(xe)((0,ae.H)(se,Ve)):ye.w}},7673:(An,xt,H)=>{"use strict";H.d(xt,{of:()=>ye});var O=H(9326),z=H(8455);function ye(...m){const ae=(0,O.lI)(m);return(0,z.H)(m,ae)}},1584:(An,xt,H)=>{"use strict";H.d(xt,{O:()=>ae});var O=H(1985),z=H(3236),ye=H(9470);function ae(De=0,Be,Ve=z.b){let xe=-1;return null!=Be&&((0,ye.m)(Be)?Ve=Be:xe=Be),new O.c(se=>{let me=function m(De){return De instanceof Date&&!isNaN(De)}(De)?+De-Ve.now():De;me<0&&(me=0);let He=0;return Ve.schedule(function(){se.closed||(se.next(He++),0<=xe?this.schedule(void 0,xe):se.complete())},me)})}},4360:(An,xt,H)=>{"use strict";H.d(xt,{_:()=>z});var O=H(7707);function z(m,ae,De,Be,Ve){return new ye(m,ae,De,Be,Ve)}class ye extends O.vU{constructor(ae,De,Be,Ve,xe,se){super(ae),this.onFinalize=xe,this.shouldUnsubscribe=se,this._next=De?function(me){try{De(me)}catch(He){ae.error(He)}}:super._next,this._error=Ve?function(me){try{Ve(me)}catch(He){ae.error(He)}finally{this.unsubscribe()}}:super._error,this._complete=Be?function(){try{Be()}catch(me){ae.error(me)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var ae;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:De}=this;super.unsubscribe(),!De&&(null===(ae=this.onFinalize)||void 0===ae||ae.call(this))}}}},274:(An,xt,H)=>{"use strict";H.d(xt,{H:()=>ye});var O=H(1397),z=H(8071);function ye(m,ae){return(0,z.T)(ae)?(0,O.Z)(m,ae,1):(0,O.Z)(m,1)}},152:(An,xt,H)=>{"use strict";H.d(xt,{B:()=>m});var O=H(3236),z=H(9974),ye=H(4360);function m(ae,De=O.E){return(0,z.N)((Be,Ve)=>{let xe=null,se=null,me=null;const He=()=>{if(xe){xe.unsubscribe(),xe=null;const Oe=se;se=null,Ve.next(Oe)}};function qe(){const Oe=me+ae,je=De.now();if(je<Oe)return xe=this.schedule(void 0,Oe-je),void Ve.add(xe);He()}Be.subscribe((0,ye._)(Ve,Oe=>{se=Oe,me=De.now(),xe||(xe=De.schedule(qe,ae),Ve.add(xe))},()=>{He(),Ve.complete()},void 0,()=>{se=xe=null}))})}},9901:(An,xt,H)=>{"use strict";H.d(xt,{U:()=>ye});var O=H(9974),z=H(4360);function ye(m){return(0,O.N)((ae,De)=>{let Be=!1;ae.subscribe((0,z._)(De,Ve=>{Be=!0,De.next(Ve)},()=>{Be||De.next(m),De.complete()}))})}},1986:(An,xt,H)=>{"use strict";H.d(xt,{c:()=>qe});var O=H(3236),z=H(8793),ye=H(6697),m=H(9974),ae=H(4360),De=H(5343),Ve=H(3703),xe=H(1397),se=H(8750);function me(Oe,je){return je?ht=>(0,z.x)(je.pipe((0,ye.s)(1),function Be(){return(0,m.N)((Oe,je)=>{Oe.subscribe((0,ae._)(je,De.l))})}()),ht.pipe(me(Oe))):(0,xe.Z)((ht,et)=>(0,se.Tg)(Oe(ht,et)).pipe((0,ye.s)(1),(0,Ve.u)(ht)))}var He=H(1584);function qe(Oe,je=O.E){const ht=(0,He.O)(Oe,je);return me(()=>ht)}},3294:(An,xt,H)=>{"use strict";H.d(xt,{F:()=>m});var O=H(3669),z=H(9974),ye=H(4360);function m(De,Be=O.D){return De=De??ae,(0,z.N)((Ve,xe)=>{let se,me=!0;Ve.subscribe((0,ye._)(xe,He=>{const qe=Be(He);(me||!De(se,qe))&&(me=!1,se=qe,xe.next(He))}))})}function ae(De,Be){return De===Be}},5964:(An,xt,H)=>{"use strict";H.d(xt,{p:()=>ye});var O=H(9974),z=H(4360);function ye(m,ae){return(0,O.N)((De,Be)=>{let Ve=0;De.subscribe((0,z._)(Be,xe=>m.call(ae,xe,Ve++)&&Be.next(xe)))})}},980:(An,xt,H)=>{"use strict";H.d(xt,{j:()=>z});var O=H(9974);function z(ye){return(0,O.N)((m,ae)=>{try{m.subscribe(ae)}finally{ae.add(ye)}})}},1594:(An,xt,H)=>{"use strict";H.d(xt,{$:()=>Be});var O=H(9350),z=H(5964),ye=H(6697),m=H(9901),ae=H(3774),De=H(3669);function Be(Ve,xe){const se=arguments.length>=2;return me=>me.pipe(Ve?(0,z.p)((He,qe)=>Ve(He,qe,me)):De.D,(0,ye.s)(1),se?(0,m.U)(xe):(0,ae.v)(()=>new O.G))}},6354:(An,xt,H)=>{"use strict";H.d(xt,{T:()=>ye});var O=H(9974),z=H(4360);function ye(m,ae){return(0,O.N)((De,Be)=>{let Ve=0;De.subscribe((0,z._)(Be,xe=>{Be.next(m.call(ae,xe,Ve++))}))})}},3703:(An,xt,H)=>{"use strict";H.d(xt,{u:()=>z});var O=H(6354);function z(ye){return(0,O.T)(()=>ye)}},6365:(An,xt,H)=>{"use strict";H.d(xt,{U:()=>ye});var O=H(1397),z=H(3669);function ye(m=1/0){return(0,O.Z)(z.D,m)}},1397:(An,xt,H)=>{"use strict";H.d(xt,{Z:()=>Ve});var O=H(6354),z=H(8750),ye=H(9974),m=H(5225),ae=H(4360),Be=H(8071);function Ve(xe,se,me=1/0){return(0,Be.T)(se)?Ve((He,qe)=>(0,O.T)((Oe,je)=>se(He,Oe,qe,je))((0,z.Tg)(xe(He,qe))),me):("number"==typeof se&&(me=se),(0,ye.N)((He,qe)=>function De(xe,se,me,He,qe,Oe,je,ht){const et=[];let ct=0,Ue=0,nt=!1;const Xe=()=>{nt&&!et.length&&!ct&&se.complete()},Le=at=>ct<He?Te(at):et.push(at),Te=at=>{Oe&&se.next(at),ct++;let Ze=!1;(0,z.Tg)(me(at,Ue++)).subscribe((0,ae._)(se,it=>{qe?.(it),Oe?Le(it):se.next(it)},()=>{Ze=!0},void 0,()=>{if(Ze)try{for(ct--;et.length&&ct<He;){const it=et.shift();je?(0,m.N)(se,je,()=>Te(it)):Te(it)}Xe()}catch(it){se.error(it)}}))};return xe.subscribe((0,ae._)(se,Le,()=>{nt=!0,Xe()})),()=>{ht?.()}}(He,qe,xe,me)))}},941:(An,xt,H)=>{"use strict";H.d(xt,{Q:()=>m});var O=H(5225),z=H(9974),ye=H(4360);function m(ae,De=0){return(0,z.N)((Be,Ve)=>{Be.subscribe((0,ye._)(Ve,xe=>(0,O.N)(Ve,ae,()=>Ve.next(xe),De),()=>(0,O.N)(Ve,ae,()=>Ve.complete(),De),xe=>(0,O.N)(Ve,ae,()=>Ve.error(xe),De)))})}},2816:(An,xt,H)=>{"use strict";H.d(xt,{S:()=>m});var O=H(9974),z=H(4360);function m(ae,De){return(0,O.N)(function ye(ae,De,Be,Ve,xe){return(se,me)=>{let He=Be,qe=De,Oe=0;se.subscribe((0,z._)(me,je=>{const ht=Oe++;qe=He?ae(qe,je,ht):(He=!0,je),Ve&&me.next(qe)},xe&&(()=>{He&&me.next(qe),me.complete()})))}}(ae,De,arguments.length>=2,!0))}},9172:(An,xt,H)=>{"use strict";H.d(xt,{Z:()=>m});var O=H(8793),z=H(9326),ye=H(9974);function m(...ae){const De=(0,z.lI)(ae);return(0,ye.N)((Be,Ve)=>{(De?(0,O.x)(ae,Be,De):(0,O.x)(ae,Be)).subscribe(Ve)})}},6745:(An,xt,H)=>{"use strict";H.d(xt,{_:()=>z});var O=H(9974);function z(ye,m=0){return(0,O.N)((ae,De)=>{De.add(ye.schedule(()=>ae.subscribe(De),m))})}},5558:(An,xt,H)=>{"use strict";H.d(xt,{n:()=>m});var O=H(8750),z=H(9974),ye=H(4360);function m(ae,De){return(0,z.N)((Be,Ve)=>{let xe=null,se=0,me=!1;const He=()=>me&&!xe&&Ve.complete();Be.subscribe((0,ye._)(Ve,qe=>{xe?.unsubscribe();let Oe=0;const je=se++;(0,O.Tg)(ae(qe,je)).subscribe(xe=(0,ye._)(Ve,ht=>Ve.next(De?De(qe,ht,je,Oe++):ht),()=>{xe=null,He()}))},()=>{me=!0,He()}))})}},6697:(An,xt,H)=>{"use strict";H.d(xt,{s:()=>m});var O=H(983),z=H(9974),ye=H(4360);function m(ae){return ae<=0?()=>O.w:(0,z.N)((De,Be)=>{let Ve=0;De.subscribe((0,ye._)(Be,xe=>{++Ve<=ae&&(Be.next(xe),ae<=Ve&&Be.complete())}))})}},8141:(An,xt,H)=>{"use strict";H.d(xt,{M:()=>ae});var O=H(8071),z=H(9974),ye=H(4360),m=H(3669);function ae(De,Be,Ve){const xe=(0,O.T)(De)||Be||Ve?{next:De,error:Be,complete:Ve}:De;return xe?(0,z.N)((se,me)=>{var He;null===(He=xe.subscribe)||void 0===He||He.call(xe);let qe=!0;se.subscribe((0,ye._)(me,Oe=>{var je;null===(je=xe.next)||void 0===je||je.call(xe,Oe),me.next(Oe)},()=>{var Oe;qe=!1,null===(Oe=xe.complete)||void 0===Oe||Oe.call(xe),me.complete()},Oe=>{var je;qe=!1,null===(je=xe.error)||void 0===je||je.call(xe,Oe),me.error(Oe)},()=>{var Oe,je;qe&&(null===(Oe=xe.unsubscribe)||void 0===Oe||Oe.call(xe)),null===(je=xe.finalize)||void 0===je||je.call(xe)}))}):m.D}},3774:(An,xt,H)=>{"use strict";H.d(xt,{v:()=>m});var O=H(9350),z=H(9974),ye=H(4360);function m(De=ae){return(0,z.N)((Be,Ve)=>{let xe=!1;Be.subscribe((0,ye._)(Ve,se=>{xe=!0,Ve.next(se)},()=>xe?Ve.complete():Ve.error(De())))})}function ae(){return new O.G}},6780:(An,xt,H)=>{"use strict";H.d(xt,{R:()=>ae});var O=H(8359);class z extends O.yU{constructor(Be,Ve){super()}schedule(Be,Ve=0){return this}}const ye={setInterval(De,Be,...Ve){const{delegate:xe}=ye;return xe?.setInterval?xe.setInterval(De,Be,...Ve):setInterval(De,Be,...Ve)},clearInterval(De){const{delegate:Be}=ye;return(Be?.clearInterval||clearInterval)(De)},delegate:void 0};var m=H(7908);class ae extends z{constructor(Be,Ve){super(Be,Ve),this.scheduler=Be,this.work=Ve,this.pending=!1}schedule(Be,Ve=0){var xe;if(this.closed)return this;this.state=Be;const se=this.id,me=this.scheduler;return null!=se&&(this.id=this.recycleAsyncId(me,se,Ve)),this.pending=!0,this.delay=Ve,this.id=null!==(xe=this.id)&&void 0!==xe?xe:this.requestAsyncId(me,this.id,Ve),this}requestAsyncId(Be,Ve,xe=0){return ye.setInterval(Be.flush.bind(Be,this),xe)}recycleAsyncId(Be,Ve,xe=0){if(null!=xe&&this.delay===xe&&!1===this.pending)return Ve;null!=Ve&&ye.clearInterval(Ve)}execute(Be,Ve){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const xe=this._execute(Be,Ve);if(xe)return xe;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(Be,Ve){let se,xe=!1;try{this.work(Be)}catch(me){xe=!0,se=me||new Error("Scheduled action threw falsy error")}if(xe)return this.unsubscribe(),se}unsubscribe(){if(!this.closed){const{id:Be,scheduler:Ve}=this,{actions:xe}=Ve;this.work=this.state=this.scheduler=null,this.pending=!1,(0,m.o)(xe,this),null!=Be&&(this.id=this.recycleAsyncId(Ve,Be,null)),this.delay=null,super.unsubscribe()}}}},9687:(An,xt,H)=>{"use strict";H.d(xt,{q:()=>ye});var O=H(6129);class z{constructor(ae,De=z.now){this.schedulerActionCtor=ae,this.now=De}schedule(ae,De=0,Be){return new this.schedulerActionCtor(this,ae).schedule(Be,De)}}z.now=O.U.now;class ye extends z{constructor(ae,De=z.now){super(ae,De),this.actions=[],this._active=!1}flush(ae){const{actions:De}=this;if(this._active)return void De.push(ae);let Be;this._active=!0;do{if(Be=ae.execute(ae.state,ae.delay))break}while(ae=De.shift());if(this._active=!1,Be){for(;ae=De.shift();)ae.unsubscribe();throw Be}}}},3236:(An,xt,H)=>{"use strict";H.d(xt,{E:()=>ye,b:()=>m});var O=H(6780);const ye=new(H(9687).q)(O.R),m=ye},6129:(An,xt,H)=>{"use strict";H.d(xt,{U:()=>O});const O={now:()=>(O.delegate||Date).now(),delegate:void 0}},9270:(An,xt,H)=>{"use strict";H.d(xt,{f:()=>O});const O={setTimeout(z,ye,...m){const{delegate:ae}=O;return ae?.setTimeout?ae.setTimeout(z,ye,...m):setTimeout(z,ye,...m)},clearTimeout(z){const{delegate:ye}=O;return(ye?.clearTimeout||clearTimeout)(z)},delegate:void 0}},4761:(An,xt,H)=>{"use strict";H.d(xt,{l:()=>z});const z=function O(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},3494:(An,xt,H)=>{"use strict";H.d(xt,{s:()=>O});const O="function"==typeof Symbol&&Symbol.observable||"@@observable"},9350:(An,xt,H)=>{"use strict";H.d(xt,{G:()=>z});const z=(0,H(1853).L)(ye=>function(){ye(this),this.name="EmptyError",this.message="no elements in sequence"})},9326:(An,xt,H)=>{"use strict";H.d(xt,{R0:()=>De,lI:()=>ae,ms:()=>m});var O=H(8071),z=H(9470);function ye(Be){return Be[Be.length-1]}function m(Be){return(0,O.T)(ye(Be))?Be.pop():void 0}function ae(Be){return(0,z.m)(ye(Be))?Be.pop():void 0}function De(Be,Ve){return"number"==typeof ye(Be)?Be.pop():Ve}},3073:(An,xt,H)=>{"use strict";H.d(xt,{D:()=>ae});const{isArray:O}=Array,{getPrototypeOf:z,prototype:ye,keys:m}=Object;function ae(Be){if(1===Be.length){const Ve=Be[0];if(O(Ve))return{args:Ve,keys:null};if(function De(Be){return Be&&"object"==typeof Be&&z(Be)===ye}(Ve)){const xe=m(Ve);return{args:xe.map(se=>Ve[se]),keys:xe}}}return{args:Be,keys:null}}},7908:(An,xt,H)=>{"use strict";function O(z,ye){if(z){const m=z.indexOf(ye);0<=m&&z.splice(m,1)}}H.d(xt,{o:()=>O})},1853:(An,xt,H)=>{"use strict";function O(z){const m=z(ae=>{Error.call(ae),ae.stack=(new Error).stack});return m.prototype=Object.create(Error.prototype),m.prototype.constructor=m,m}H.d(xt,{L:()=>O})},8496:(An,xt,H)=>{"use strict";function O(z,ye){return z.reduce((m,ae,De)=>(m[ae]=ye[De],m),{})}H.d(xt,{e:()=>O})},9786:(An,xt,H)=>{"use strict";H.d(xt,{Y:()=>ye,l:()=>m});var O=H(1026);let z=null;function ye(ae){if(O.$.useDeprecatedSynchronousErrorHandling){const De=!z;if(De&&(z={errorThrown:!1,error:null}),ae(),De){const{errorThrown:Be,error:Ve}=z;if(z=null,Be)throw Ve}}else ae()}function m(ae){O.$.useDeprecatedSynchronousErrorHandling&&z&&(z.errorThrown=!0,z.error=ae)}},5225:(An,xt,H)=>{"use strict";function O(z,ye,m,ae=0,De=!1){const Be=ye.schedule(function(){m(),De?z.add(this.schedule(null,ae)):this.unsubscribe()},ae);if(z.add(Be),!De)return Be}H.d(xt,{N:()=>O})},3669:(An,xt,H)=>{"use strict";function O(z){return z}H.d(xt,{D:()=>O})},7441:(An,xt,H)=>{"use strict";H.d(xt,{X:()=>O});const O=z=>z&&"number"==typeof z.length&&"function"!=typeof z},7953:(An,xt,H)=>{"use strict";H.d(xt,{T:()=>z});var O=H(8071);function z(ye){return Symbol.asyncIterator&&(0,O.T)(ye?.[Symbol.asyncIterator])}},8071:(An,xt,H)=>{"use strict";function O(z){return"function"==typeof z}H.d(xt,{T:()=>O})},5055:(An,xt,H)=>{"use strict";H.d(xt,{l:()=>ye});var O=H(3494),z=H(8071);function ye(m){return(0,z.T)(m[O.s])}},5397:(An,xt,H)=>{"use strict";H.d(xt,{x:()=>ye});var O=H(4761),z=H(8071);function ye(m){return(0,z.T)(m?.[O.l])}},9858:(An,xt,H)=>{"use strict";H.d(xt,{y:()=>z});var O=H(8071);function z(ye){return(0,O.T)(ye?.then)}},5196:(An,xt,H)=>{"use strict";H.d(xt,{C:()=>ye,U:()=>m});var O=H(1635),z=H(8071);function ye(ae){return(0,O.AQ)(this,arguments,function*(){const Be=ae.getReader();try{for(;;){const{value:Ve,done:xe}=yield(0,O.N3)(Be.read());if(xe)return yield(0,O.N3)(void 0);yield yield(0,O.N3)(Ve)}}finally{Be.releaseLock()}})}function m(ae){return(0,z.T)(ae?.getReader)}},9470:(An,xt,H)=>{"use strict";H.d(xt,{m:()=>z});var O=H(8071);function z(ye){return ye&&(0,O.T)(ye.schedule)}},9974:(An,xt,H)=>{"use strict";H.d(xt,{N:()=>ye,S:()=>z});var O=H(8071);function z(m){return(0,O.T)(m?.lift)}function ye(m){return ae=>{if(z(ae))return ae.lift(function(De){try{return m(De,this)}catch(Be){this.error(Be)}});throw new TypeError("Unable to lift unknown Observable type")}}},6450:(An,xt,H)=>{"use strict";H.d(xt,{I:()=>m});var O=H(6354);const{isArray:z}=Array;function m(ae){return(0,O.T)(De=>function ye(ae,De){return z(De)?ae(...De):ae(De)}(ae,De))}},5343:(An,xt,H)=>{"use strict";function O(){}H.d(xt,{l:()=>O})},1203:(An,xt,H)=>{"use strict";H.d(xt,{F:()=>z,m:()=>ye});var O=H(3669);function z(...m){return ye(m)}function ye(m){return 0===m.length?O.D:1===m.length?m[0]:function(De){return m.reduce((Be,Ve)=>Ve(Be),De)}}},5334:(An,xt,H)=>{"use strict";H.d(xt,{m:()=>ye});var O=H(1026),z=H(9270);function ye(m){z.f.setTimeout(()=>{const{onUnhandledError:ae}=O.$;if(!ae)throw m;ae(m)})}},591:(An,xt,H)=>{"use strict";function O(z){return new TypeError(`You provided ${null!==z&&"object"==typeof z?"an invalid object":`'${z}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}H.d(xt,{L:()=>O})},177:(An,xt,H)=>{"use strict";H.d(xt,{AJ:()=>_c,MD:()=>Bo,N0:()=>Ki,QT:()=>ye,Sm:()=>ht,Sq:()=>li,VF:()=>ae,Vy:()=>Fa,Xr:()=>Yc,ZD:()=>m,_b:()=>Nt,aZ:()=>ct,bT:()=>Vs,fw:()=>et,hb:()=>Oe,hj:()=>xe,qQ:()=>Be});var O=H(4438);let z=null;function ye(){return z}function m(W){z??=W}class ae{}const Be=new O.nKC("");let Ve=(()=>{class W{historyGo(ie){throw new Error("")}static#e=this.\u0275fac=function(be){return new(be||W)};static#t=this.\u0275prov=O.jDH({token:W,factory:()=>(0,O.WQX)(se),providedIn:"platform"})}return W})();const xe=new O.nKC("");let se=(()=>{class W extends Ve{constructor(){super(),this._doc=(0,O.WQX)(Be),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ye().getBaseHref(this._doc)}onPopState(ie){const be=ye().getGlobalEventTarget(this._doc,"window");return be.addEventListener("popstate",ie,!1),()=>be.removeEventListener("popstate",ie)}onHashChange(ie){const be=ye().getGlobalEventTarget(this._doc,"window");return be.addEventListener("hashchange",ie,!1),()=>be.removeEventListener("hashchange",ie)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(ie){this._location.pathname=ie}pushState(ie,be,wt){this._history.pushState(ie,be,wt)}replaceState(ie,be,wt){this._history.replaceState(ie,be,wt)}forward(){this._history.forward()}back(){this._history.back()}historyGo(ie=0){this._history.go(ie)}getState(){return this._history.state}static#e=this.\u0275fac=function(be){return new(be||W)};static#t=this.\u0275prov=O.jDH({token:W,factory:()=>new W,providedIn:"platform"})}return W})();function me(W,ke){if(0==W.length)return ke;if(0==ke.length)return W;let ie=0;return W.endsWith("/")&&ie++,ke.startsWith("/")&&ie++,2==ie?W+ke.substring(1):1==ie?W+ke:W+"/"+ke}function He(W){const ke=W.match(/#|\?|$/),ie=ke&&ke.index||W.length;return W.slice(0,ie-("/"===W[ie-1]?1:0))+W.slice(ie)}function qe(W){return W&&"?"!==W[0]?"?"+W:W}let Oe=(()=>{class W{historyGo(ie){throw new Error("")}static#e=this.\u0275fac=function(be){return new(be||W)};static#t=this.\u0275prov=O.jDH({token:W,factory:()=>(0,O.WQX)(ht),providedIn:"root"})}return W})();const je=new O.nKC("");let ht=(()=>{class W extends Oe{constructor(ie,be){super(),this._platformLocation=ie,this._removeListenerFns=[],this._baseHref=be??this._platformLocation.getBaseHrefFromDOM()??(0,O.WQX)(Be).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(ie){this._removeListenerFns.push(this._platformLocation.onPopState(ie),this._platformLocation.onHashChange(ie))}getBaseHref(){return this._baseHref}prepareExternalUrl(ie){return me(this._baseHref,ie)}path(ie=!1){const be=this._platformLocation.pathname+qe(this._platformLocation.search),wt=this._platformLocation.hash;return wt&&ie?`${be}${wt}`:be}pushState(ie,be,wt,_n){const Gn=this.prepareExternalUrl(wt+qe(_n));this._platformLocation.pushState(ie,be,Gn)}replaceState(ie,be,wt,_n){const Gn=this.prepareExternalUrl(wt+qe(_n));this._platformLocation.replaceState(ie,be,Gn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(ie=0){this._platformLocation.historyGo?.(ie)}static#e=this.\u0275fac=function(be){return new(be||W)(O.KVO(Ve),O.KVO(je,8))};static#t=this.\u0275prov=O.jDH({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})(),et=(()=>{class W extends Oe{constructor(ie,be){super(),this._platformLocation=ie,this._baseHref="",this._removeListenerFns=[],null!=be&&(this._baseHref=be)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(ie){this._removeListenerFns.push(this._platformLocation.onPopState(ie),this._platformLocation.onHashChange(ie))}getBaseHref(){return this._baseHref}path(ie=!1){const be=this._platformLocation.hash??"#";return be.length>0?be.substring(1):be}prepareExternalUrl(ie){const be=me(this._baseHref,ie);return be.length>0?"#"+be:be}pushState(ie,be,wt,_n){let Gn=this.prepareExternalUrl(wt+qe(_n));0==Gn.length&&(Gn=this._platformLocation.pathname),this._platformLocation.pushState(ie,be,Gn)}replaceState(ie,be,wt,_n){let Gn=this.prepareExternalUrl(wt+qe(_n));0==Gn.length&&(Gn=this._platformLocation.pathname),this._platformLocation.replaceState(ie,be,Gn)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(ie=0){this._platformLocation.historyGo?.(ie)}static#e=this.\u0275fac=function(be){return new(be||W)(O.KVO(Ve),O.KVO(je,8))};static#t=this.\u0275prov=O.jDH({token:W,factory:W.\u0275fac})}return W})(),ct=(()=>{class W{constructor(ie){this._subject=new O.bkB,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=ie;const be=this._locationStrategy.getBaseHref();this._basePath=function Le(W){if(new RegExp("^(https?:)?//").test(W)){const[,ie]=W.split(/\/\/[^\/]+/);return ie}return W}(He(Xe(be))),this._locationStrategy.onPopState(wt=>{this._subject.emit({url:this.path(!0),pop:!0,state:wt.state,type:wt.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(ie=!1){return this.normalize(this._locationStrategy.path(ie))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(ie,be=""){return this.path()==this.normalize(ie+qe(be))}normalize(ie){return W.stripTrailingSlash(function nt(W,ke){if(!W||!ke.startsWith(W))return ke;const ie=ke.substring(W.length);return""===ie||["/",";","?","#"].includes(ie[0])?ie:ke}(this._basePath,Xe(ie)))}prepareExternalUrl(ie){return ie&&"/"!==ie[0]&&(ie="/"+ie),this._locationStrategy.prepareExternalUrl(ie)}go(ie,be="",wt=null){this._locationStrategy.pushState(wt,"",ie,be),this._notifyUrlChangeListeners(this.prepareExternalUrl(ie+qe(be)),wt)}replaceState(ie,be="",wt=null){this._locationStrategy.replaceState(wt,"",ie,be),this._notifyUrlChangeListeners(this.prepareExternalUrl(ie+qe(be)),wt)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(ie=0){this._locationStrategy.historyGo?.(ie)}onUrlChange(ie){return this._urlChangeListeners.push(ie),this._urlChangeSubscription??=this.subscribe(be=>{this._notifyUrlChangeListeners(be.url,be.state)}),()=>{const be=this._urlChangeListeners.indexOf(ie);this._urlChangeListeners.splice(be,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(ie="",be){this._urlChangeListeners.forEach(wt=>wt(ie,be))}subscribe(ie,be,wt){return this._subject.subscribe({next:ie,error:be,complete:wt})}static#e=this.normalizeQueryParams=qe;static#t=this.joinWithSlash=me;static#n=this.stripTrailingSlash=He;static#r=this.\u0275fac=function(be){return new(be||W)(O.KVO(Oe))};static#i=this.\u0275prov=O.jDH({token:W,factory:()=>function Ue(){return new ct((0,O.KVO)(Oe))}(),providedIn:"root"})}return W})();function Xe(W){return W.replace(/\/index.html$/,"")}function Nt(W,ke){ke=encodeURIComponent(ke);for(const ie of W.split(";")){const be=ie.indexOf("="),[wt,_n]=-1==be?[ie,""]:[ie.slice(0,be),ie.slice(be+1)];if(wt.trim()===ke)return decodeURIComponent(_n)}return null}class Mr{constructor(ke,ie,be,wt){this.$implicit=ke,this.ngForOf=ie,this.index=be,this.count=wt}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let li=(()=>{class W{set ngForOf(ie){this._ngForOf=ie,this._ngForOfDirty=!0}set ngForTrackBy(ie){this._trackByFn=ie}get ngForTrackBy(){return this._trackByFn}constructor(ie,be,wt){this._viewContainer=ie,this._template=be,this._differs=wt,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(ie){ie&&(this._template=ie)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const ie=this._ngForOf;!this._differ&&ie&&(this._differ=this._differs.find(ie).create(this.ngForTrackBy))}if(this._differ){const ie=this._differ.diff(this._ngForOf);ie&&this._applyChanges(ie)}}_applyChanges(ie){const be=this._viewContainer;ie.forEachOperation((wt,_n,Gn)=>{if(null==wt.previousIndex)be.createEmbeddedView(this._template,new Mr(wt.item,this._ngForOf,-1,-1),null===Gn?void 0:Gn);else if(null==Gn)be.remove(null===_n?void 0:_n);else if(null!==_n){const Ar=be.get(_n);be.move(Ar,Gn),xi(Ar,wt)}});for(let wt=0,_n=be.length;wt<_n;wt++){const Ar=be.get(wt).context;Ar.index=wt,Ar.count=_n,Ar.ngForOf=this._ngForOf}ie.forEachIdentityChange(wt=>{xi(be.get(wt.currentIndex),wt)})}static ngTemplateContextGuard(ie,be){return!0}static#e=this.\u0275fac=function(be){return new(be||W)(O.rXU(O.c1b),O.rXU(O.C4Q),O.rXU(O._q3))};static#t=this.\u0275dir=O.FsC({type:W,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}return W})();function xi(W,ke){W.context.$implicit=ke.item}let Vs=(()=>{class W{constructor(ie,be){this._viewContainer=ie,this._context=new gr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=be}set ngIf(ie){this._context.$implicit=this._context.ngIf=ie,this._updateView()}set ngIfThen(ie){ti("ngIfThen",ie),this._thenTemplateRef=ie,this._thenViewRef=null,this._updateView()}set ngIfElse(ie){ti("ngIfElse",ie),this._elseTemplateRef=ie,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(ie,be){return!0}static#e=this.\u0275fac=function(be){return new(be||W)(O.rXU(O.c1b),O.rXU(O.C4Q))};static#t=this.\u0275dir=O.FsC({type:W,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}return W})();class gr{constructor(){this.$implicit=null,this.ngIf=null}}function ti(W,ke){if(ke&&!ke.createEmbeddedView)throw new Error(`${W} must be a TemplateRef, but received '${(0,O.Tbb)(ke)}'.`)}let Bo=(()=>{class W{static#e=this.\u0275fac=function(be){return new(be||W)};static#t=this.\u0275mod=O.$C({type:W});static#n=this.\u0275inj=O.G2t({})}return W})();const _c="browser",Xa="server";function Fa(W){return W===Xa}let Yc=(()=>{class W{static#e=this.\u0275prov=(0,O.jDH)({token:W,providedIn:"root",factory:()=>function Ko(W){return W===_c}((0,O.WQX)(O.Agw))?new So((0,O.WQX)(Be),window):new Ul})}return W})();class So{constructor(ke,ie){this.document=ke,this.window=ie,this.offset=()=>[0,0]}setOffset(ke){this.offset=Array.isArray(ke)?()=>ke:ke}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(ke){this.window.scrollTo(ke[0],ke[1])}scrollToAnchor(ke){const ie=function Vl(W,ke){const ie=W.getElementById(ke)||W.getElementsByName(ke)[0];if(ie)return ie;if("function"==typeof W.createTreeWalker&&W.body&&"function"==typeof W.body.attachShadow){const be=W.createTreeWalker(W.body,NodeFilter.SHOW_ELEMENT);let wt=be.currentNode;for(;wt;){const _n=wt.shadowRoot;if(_n){const Gn=_n.getElementById(ke)||_n.querySelector(`[name="${ke}"]`);if(Gn)return Gn}wt=be.nextNode()}}return null}(this.document,ke);ie&&(this.scrollToElement(ie),ie.focus())}setHistoryScrollRestoration(ke){this.window.history.scrollRestoration=ke}scrollToElement(ke){const ie=ke.getBoundingClientRect(),be=ie.left+this.window.pageXOffset,wt=ie.top+this.window.pageYOffset,_n=this.offset();this.window.scrollTo(be-_n[0],wt-_n[1])}}class Ul{setOffset(ke){}getScrollPosition(){return[0,0]}scrollToPosition(ke){}scrollToAnchor(ke){}setHistoryScrollRestoration(ke){}}class Ki{}},1626:(An,xt,H)=>{"use strict";H.d(xt,{Qq:()=>$t,q1:()=>Li,yz:()=>Pt}),H(467);var z=H(4438),ye=H(7673),m=H(1985),ae=H(8455),De=H(274),Be=H(5964),Ve=H(6354),xe=H(980),se=H(5558),me=H(177);class He{}class qe{}class Oe{constructor(Dt){this.normalizedNames=new Map,this.lazyUpdate=null,Dt?"string"==typeof Dt?this.lazyInit=()=>{this.headers=new Map,Dt.split("\n").forEach(Nt=>{const wn=Nt.indexOf(":");if(wn>0){const bt=Nt.slice(0,wn),On=bt.toLowerCase(),sr=Nt.slice(wn+1).trim();this.maybeSetNormalizedName(bt,On),this.headers.has(On)?this.headers.get(On).push(sr):this.headers.set(On,[sr])}})}:typeof Headers<"u"&&Dt instanceof Headers?(this.headers=new Map,Dt.forEach((Nt,wn)=>{this.setHeaderEntries(wn,Nt)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(Dt).forEach(([Nt,wn])=>{this.setHeaderEntries(Nt,wn)})}:this.headers=new Map}has(Dt){return this.init(),this.headers.has(Dt.toLowerCase())}get(Dt){this.init();const Nt=this.headers.get(Dt.toLowerCase());return Nt&&Nt.length>0?Nt[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Dt){return this.init(),this.headers.get(Dt.toLowerCase())||null}append(Dt,Nt){return this.clone({name:Dt,value:Nt,op:"a"})}set(Dt,Nt){return this.clone({name:Dt,value:Nt,op:"s"})}delete(Dt,Nt){return this.clone({name:Dt,value:Nt,op:"d"})}maybeSetNormalizedName(Dt,Nt){this.normalizedNames.has(Nt)||this.normalizedNames.set(Nt,Dt)}init(){this.lazyInit&&(this.lazyInit instanceof Oe?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Dt=>this.applyUpdate(Dt)),this.lazyUpdate=null))}copyFrom(Dt){Dt.init(),Array.from(Dt.headers.keys()).forEach(Nt=>{this.headers.set(Nt,Dt.headers.get(Nt)),this.normalizedNames.set(Nt,Dt.normalizedNames.get(Nt))})}clone(Dt){const Nt=new Oe;return Nt.lazyInit=this.lazyInit&&this.lazyInit instanceof Oe?this.lazyInit:this,Nt.lazyUpdate=(this.lazyUpdate||[]).concat([Dt]),Nt}applyUpdate(Dt){const Nt=Dt.name.toLowerCase();switch(Dt.op){case"a":case"s":let wn=Dt.value;if("string"==typeof wn&&(wn=[wn]),0===wn.length)return;this.maybeSetNormalizedName(Dt.name,Nt);const bt=("a"===Dt.op?this.headers.get(Nt):void 0)||[];bt.push(...wn),this.headers.set(Nt,bt);break;case"d":const On=Dt.value;if(On){let sr=this.headers.get(Nt);if(!sr)return;sr=sr.filter(ei=>-1===On.indexOf(ei)),0===sr.length?(this.headers.delete(Nt),this.normalizedNames.delete(Nt)):this.headers.set(Nt,sr)}else this.headers.delete(Nt),this.normalizedNames.delete(Nt)}}setHeaderEntries(Dt,Nt){const wn=(Array.isArray(Nt)?Nt:[Nt]).map(On=>On.toString()),bt=Dt.toLowerCase();this.headers.set(bt,wn),this.maybeSetNormalizedName(Dt,bt)}forEach(Dt){this.init(),Array.from(this.normalizedNames.keys()).forEach(Nt=>Dt(this.normalizedNames.get(Nt),this.headers.get(Nt)))}}class ht{encodeKey(Dt){return nt(Dt)}encodeValue(Dt){return nt(Dt)}decodeKey(Dt){return decodeURIComponent(Dt)}decodeValue(Dt){return decodeURIComponent(Dt)}}const ct=/%(\d[a-f0-9])/gi,Ue={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function nt(ut){return encodeURIComponent(ut).replace(ct,(Dt,Nt)=>Ue[Nt]??Dt)}function Xe(ut){return`${ut}`}class Le{constructor(Dt={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Dt.encoder||new ht,Dt.fromString){if(Dt.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function et(ut,Dt){const Nt=new Map;return ut.length>0&&ut.replace(/^\?/,"").split("&").forEach(bt=>{const On=bt.indexOf("="),[sr,ei]=-1==On?[Dt.decodeKey(bt),""]:[Dt.decodeKey(bt.slice(0,On)),Dt.decodeValue(bt.slice(On+1))],Mr=Nt.get(sr)||[];Mr.push(ei),Nt.set(sr,Mr)}),Nt}(Dt.fromString,this.encoder)}else Dt.fromObject?(this.map=new Map,Object.keys(Dt.fromObject).forEach(Nt=>{const wn=Dt.fromObject[Nt],bt=Array.isArray(wn)?wn.map(Xe):[Xe(wn)];this.map.set(Nt,bt)})):this.map=null}has(Dt){return this.init(),this.map.has(Dt)}get(Dt){this.init();const Nt=this.map.get(Dt);return Nt?Nt[0]:null}getAll(Dt){return this.init(),this.map.get(Dt)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Dt,Nt){return this.clone({param:Dt,value:Nt,op:"a"})}appendAll(Dt){const Nt=[];return Object.keys(Dt).forEach(wn=>{const bt=Dt[wn];Array.isArray(bt)?bt.forEach(On=>{Nt.push({param:wn,value:On,op:"a"})}):Nt.push({param:wn,value:bt,op:"a"})}),this.clone(Nt)}set(Dt,Nt){return this.clone({param:Dt,value:Nt,op:"s"})}delete(Dt,Nt){return this.clone({param:Dt,value:Nt,op:"d"})}toString(){return this.init(),this.keys().map(Dt=>{const Nt=this.encoder.encodeKey(Dt);return this.map.get(Dt).map(wn=>Nt+"="+this.encoder.encodeValue(wn)).join("&")}).filter(Dt=>""!==Dt).join("&")}clone(Dt){const Nt=new Le({encoder:this.encoder});return Nt.cloneFrom=this.cloneFrom||this,Nt.updates=(this.updates||[]).concat(Dt),Nt}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Dt=>this.map.set(Dt,this.cloneFrom.map.get(Dt))),this.updates.forEach(Dt=>{switch(Dt.op){case"a":case"s":const Nt=("a"===Dt.op?this.map.get(Dt.param):void 0)||[];Nt.push(Xe(Dt.value)),this.map.set(Dt.param,Nt);break;case"d":if(void 0===Dt.value){this.map.delete(Dt.param);break}{let wn=this.map.get(Dt.param)||[];const bt=wn.indexOf(Xe(Dt.value));-1!==bt&&wn.splice(bt,1),wn.length>0?this.map.set(Dt.param,wn):this.map.delete(Dt.param)}}}),this.cloneFrom=this.updates=null)}}class at{constructor(){this.map=new Map}set(Dt,Nt){return this.map.set(Dt,Nt),this}get(Dt){return this.map.has(Dt)||this.map.set(Dt,Dt.defaultValue()),this.map.get(Dt)}delete(Dt){return this.map.delete(Dt),this}has(Dt){return this.map.has(Dt)}keys(){return this.map.keys()}}function it(ut){return typeof ArrayBuffer<"u"&&ut instanceof ArrayBuffer}function Ge(ut){return typeof Blob<"u"&&ut instanceof Blob}function nn(ut){return typeof FormData<"u"&&ut instanceof FormData}class Cn{constructor(Dt,Nt,wn,bt){let On;if(this.url=Nt,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Dt.toUpperCase(),function Ze(ut){switch(ut){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||bt?(this.body=void 0!==wn?wn:null,On=bt):On=wn,On&&(this.reportProgress=!!On.reportProgress,this.withCredentials=!!On.withCredentials,On.responseType&&(this.responseType=On.responseType),On.headers&&(this.headers=On.headers),On.context&&(this.context=On.context),On.params&&(this.params=On.params),this.transferCache=On.transferCache),this.headers??=new Oe,this.context??=new at,this.params){const sr=this.params.toString();if(0===sr.length)this.urlWithParams=Nt;else{const ei=Nt.indexOf("?");this.urlWithParams=Nt+(-1===ei?"?":ei<Nt.length-1?"&":"")+sr}}else this.params=new Le,this.urlWithParams=Nt}serializeBody(){return null===this.body?null:it(this.body)||Ge(this.body)||nn(this.body)||function bn(ut){return typeof URLSearchParams<"u"&&ut instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Le?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||nn(this.body)?null:Ge(this.body)?this.body.type||null:it(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Le?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Dt={}){const Nt=Dt.method||this.method,wn=Dt.url||this.url,bt=Dt.responseType||this.responseType,On=void 0!==Dt.body?Dt.body:this.body,sr=void 0!==Dt.withCredentials?Dt.withCredentials:this.withCredentials,ei=void 0!==Dt.reportProgress?Dt.reportProgress:this.reportProgress;let Mr=Dt.headers||this.headers,li=Dt.params||this.params;const xi=Dt.context??this.context;return void 0!==Dt.setHeaders&&(Mr=Object.keys(Dt.setHeaders).reduce((Ds,Vs)=>Ds.set(Vs,Dt.setHeaders[Vs]),Mr)),Dt.setParams&&(li=Object.keys(Dt.setParams).reduce((Ds,Vs)=>Ds.set(Vs,Dt.setParams[Vs]),li)),new Cn(Nt,wn,On,{params:li,headers:Mr,context:xi,reportProgress:ei,responseType:bt,withCredentials:sr})}}var qt=function(ut){return ut[ut.Sent=0]="Sent",ut[ut.UploadProgress=1]="UploadProgress",ut[ut.ResponseHeader=2]="ResponseHeader",ut[ut.DownloadProgress=3]="DownloadProgress",ut[ut.Response=4]="Response",ut[ut.User=5]="User",ut}(qt||{});class Ht{constructor(Dt,Nt=Qe.Ok,wn="OK"){this.headers=Dt.headers||new Oe,this.status=void 0!==Dt.status?Dt.status:Nt,this.statusText=Dt.statusText||wn,this.url=Dt.url||null,this.ok=this.status>=200&&this.status<300}}class lt extends Ht{constructor(Dt={}){super(Dt),this.type=qt.ResponseHeader}clone(Dt={}){return new lt({headers:Dt.headers||this.headers,status:void 0!==Dt.status?Dt.status:this.status,statusText:Dt.statusText||this.statusText,url:Dt.url||this.url||void 0})}}class Ct extends Ht{constructor(Dt={}){super(Dt),this.type=qt.Response,this.body=void 0!==Dt.body?Dt.body:null}clone(Dt={}){return new Ct({body:void 0!==Dt.body?Dt.body:this.body,headers:Dt.headers||this.headers,status:void 0!==Dt.status?Dt.status:this.status,statusText:Dt.statusText||this.statusText,url:Dt.url||this.url||void 0})}}class Pt extends Ht{constructor(Dt){super(Dt,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Dt.url||"(unknown url)"}`:`Http failure response for ${Dt.url||"(unknown url)"}: ${Dt.status} ${Dt.statusText}`,this.error=Dt.error||null}}var Qe=function(ut){return ut[ut.Continue=100]="Continue",ut[ut.SwitchingProtocols=101]="SwitchingProtocols",ut[ut.Processing=102]="Processing",ut[ut.EarlyHints=103]="EarlyHints",ut[ut.Ok=200]="Ok",ut[ut.Created=201]="Created",ut[ut.Accepted=202]="Accepted",ut[ut.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",ut[ut.NoContent=204]="NoContent",ut[ut.ResetContent=205]="ResetContent",ut[ut.PartialContent=206]="PartialContent",ut[ut.MultiStatus=207]="MultiStatus",ut[ut.AlreadyReported=208]="AlreadyReported",ut[ut.ImUsed=226]="ImUsed",ut[ut.MultipleChoices=300]="MultipleChoices",ut[ut.MovedPermanently=301]="MovedPermanently",ut[ut.Found=302]="Found",ut[ut.SeeOther=303]="SeeOther",ut[ut.NotModified=304]="NotModified",ut[ut.UseProxy=305]="UseProxy",ut[ut.Unused=306]="Unused",ut[ut.TemporaryRedirect=307]="TemporaryRedirect",ut[ut.PermanentRedirect=308]="PermanentRedirect",ut[ut.BadRequest=400]="BadRequest",ut[ut.Unauthorized=401]="Unauthorized",ut[ut.PaymentRequired=402]="PaymentRequired",ut[ut.Forbidden=403]="Forbidden",ut[ut.NotFound=404]="NotFound",ut[ut.MethodNotAllowed=405]="MethodNotAllowed",ut[ut.NotAcceptable=406]="NotAcceptable",ut[ut.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",ut[ut.RequestTimeout=408]="RequestTimeout",ut[ut.Conflict=409]="Conflict",ut[ut.Gone=410]="Gone",ut[ut.LengthRequired=411]="LengthRequired",ut[ut.PreconditionFailed=412]="PreconditionFailed",ut[ut.PayloadTooLarge=413]="PayloadTooLarge",ut[ut.UriTooLong=414]="UriTooLong",ut[ut.UnsupportedMediaType=415]="UnsupportedMediaType",ut[ut.RangeNotSatisfiable=416]="RangeNotSatisfiable",ut[ut.ExpectationFailed=417]="ExpectationFailed",ut[ut.ImATeapot=418]="ImATeapot",ut[ut.MisdirectedRequest=421]="MisdirectedRequest",ut[ut.UnprocessableEntity=422]="UnprocessableEntity",ut[ut.Locked=423]="Locked",ut[ut.FailedDependency=424]="FailedDependency",ut[ut.TooEarly=425]="TooEarly",ut[ut.UpgradeRequired=426]="UpgradeRequired",ut[ut.PreconditionRequired=428]="PreconditionRequired",ut[ut.TooManyRequests=429]="TooManyRequests",ut[ut.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",ut[ut.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",ut[ut.InternalServerError=500]="InternalServerError",ut[ut.NotImplemented=501]="NotImplemented",ut[ut.BadGateway=502]="BadGateway",ut[ut.ServiceUnavailable=503]="ServiceUnavailable",ut[ut.GatewayTimeout=504]="GatewayTimeout",ut[ut.HttpVersionNotSupported=505]="HttpVersionNotSupported",ut[ut.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",ut[ut.InsufficientStorage=507]="InsufficientStorage",ut[ut.LoopDetected=508]="LoopDetected",ut[ut.NotExtended=510]="NotExtended",ut[ut.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",ut}(Qe||{});function Tt(ut,Dt){return{body:Dt,headers:ut.headers,context:ut.context,observe:ut.observe,params:ut.params,reportProgress:ut.reportProgress,responseType:ut.responseType,withCredentials:ut.withCredentials,transferCache:ut.transferCache}}let $t=(()=>{class ut{constructor(Nt){this.handler=Nt}request(Nt,wn,bt={}){let On;if(Nt instanceof Cn)On=Nt;else{let Mr,li;Mr=bt.headers instanceof Oe?bt.headers:new Oe(bt.headers),bt.params&&(li=bt.params instanceof Le?bt.params:new Le({fromObject:bt.params})),On=new Cn(Nt,wn,void 0!==bt.body?bt.body:null,{headers:Mr,context:bt.context,params:li,reportProgress:bt.reportProgress,responseType:bt.responseType||"json",withCredentials:bt.withCredentials,transferCache:bt.transferCache})}const sr=(0,ye.of)(On).pipe((0,De.H)(Mr=>this.handler.handle(Mr)));if(Nt instanceof Cn||"events"===bt.observe)return sr;const ei=sr.pipe((0,Be.p)(Mr=>Mr instanceof Ct));switch(bt.observe||"body"){case"body":switch(On.responseType){case"arraybuffer":return ei.pipe((0,Ve.T)(Mr=>{if(null!==Mr.body&&!(Mr.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Mr.body}));case"blob":return ei.pipe((0,Ve.T)(Mr=>{if(null!==Mr.body&&!(Mr.body instanceof Blob))throw new Error("Response is not a Blob.");return Mr.body}));case"text":return ei.pipe((0,Ve.T)(Mr=>{if(null!==Mr.body&&"string"!=typeof Mr.body)throw new Error("Response is not a string.");return Mr.body}));default:return ei.pipe((0,Ve.T)(Mr=>Mr.body))}case"response":return ei;default:throw new Error(`Unreachable: unhandled observe type ${bt.observe}}`)}}delete(Nt,wn={}){return this.request("DELETE",Nt,wn)}get(Nt,wn={}){return this.request("GET",Nt,wn)}head(Nt,wn={}){return this.request("HEAD",Nt,wn)}jsonp(Nt,wn){return this.request("JSONP",Nt,{params:(new Le).append(wn,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Nt,wn={}){return this.request("OPTIONS",Nt,wn)}patch(Nt,wn,bt={}){return this.request("PATCH",Nt,Tt(bt,wn))}post(Nt,wn,bt={}){return this.request("POST",Nt,Tt(bt,wn))}put(Nt,wn,bt={}){return this.request("PUT",Nt,Tt(bt,wn))}static#e=this.\u0275fac=function(wn){return new(wn||ut)(z.KVO(He))};static#t=this.\u0275prov=z.jDH({token:ut,factory:ut.\u0275fac})}return ut})();function Or(ut,Dt){return Dt(ut)}function jr(ut,Dt){return(Nt,wn)=>Dt.intercept(Nt,{handle:bt=>ut(bt,wn)})}const Ai=new z.nKC(""),Ri=new z.nKC(""),nr=new z.nKC(""),mr=new z.nKC("");function Er(){let ut=null;return(Dt,Nt)=>{null===ut&&(ut=((0,z.WQX)(Ai,{optional:!0})??[]).reduceRight(jr,Or));const wn=(0,z.WQX)(z.TgB),bt=wn.add();return ut(Dt,Nt).pipe((0,xe.j)(()=>wn.remove(bt)))}}let Hn=(()=>{class ut extends He{constructor(Nt,wn){super(),this.backend=Nt,this.injector=wn,this.chain=null,this.pendingTasks=(0,z.WQX)(z.TgB);const bt=(0,z.WQX)(mr,{optional:!0});this.backend=bt??Nt}handle(Nt){if(null===this.chain){const bt=Array.from(new Set([...this.injector.get(Ri),...this.injector.get(nr,[])]));this.chain=bt.reduceRight((On,sr)=>function ur(ut,Dt,Nt){return(wn,bt)=>(0,z.N4e)(Nt,()=>Dt(wn,On=>ut(On,bt)))}(On,sr,this.injector),Or)}const wn=this.pendingTasks.add();return this.chain(Nt,bt=>this.backend.handle(bt)).pipe((0,xe.j)(()=>this.pendingTasks.remove(wn)))}static#e=this.\u0275fac=function(wn){return new(wn||ut)(z.KVO(qe),z.KVO(z.uvJ))};static#t=this.\u0275prov=z.jDH({token:ut,factory:ut.\u0275fac})}return ut})();const ci=/^\)\]\}',?\n/;let Fs=(()=>{class ut{constructor(Nt){this.xhrFactory=Nt}handle(Nt){if("JSONP"===Nt.method)throw new z.wOt(-2800,!1);const wn=this.xhrFactory;return(wn.\u0275loadImpl?(0,ae.H)(wn.\u0275loadImpl()):(0,ye.of)(null)).pipe((0,se.n)(()=>new m.c(On=>{const sr=wn.build();if(sr.open(Nt.method,Nt.urlWithParams),Nt.withCredentials&&(sr.withCredentials=!0),Nt.headers.forEach((qr,Ci)=>sr.setRequestHeader(qr,Ci.join(","))),Nt.headers.has("Accept")||sr.setRequestHeader("Accept","application/json, text/plain, */*"),!Nt.headers.has("Content-Type")){const qr=Nt.detectContentTypeHeader();null!==qr&&sr.setRequestHeader("Content-Type",qr)}if(Nt.responseType){const qr=Nt.responseType.toLowerCase();sr.responseType="json"!==qr?qr:"text"}const ei=Nt.serializeBody();let Mr=null;const li=()=>{if(null!==Mr)return Mr;const qr=sr.statusText||"OK",Ci=new Oe(sr.getAllResponseHeaders()),_s=function qn(ut){return"responseURL"in ut&&ut.responseURL?ut.responseURL:/^X-Request-URL:/m.test(ut.getAllResponseHeaders())?ut.getResponseHeader("X-Request-URL"):null}(sr)||Nt.url;return Mr=new lt({headers:Ci,status:sr.status,statusText:qr,url:_s}),Mr},xi=()=>{let{headers:qr,status:Ci,statusText:_s,url:br}=li(),Ui=null;Ci!==Qe.NoContent&&(Ui=typeof sr.response>"u"?sr.responseText:sr.response),0===Ci&&(Ci=Ui?Qe.Ok:0);let Mo=Ci>=200&&Ci<300;if("json"===Nt.responseType&&"string"==typeof Ui){const bs=Ui;Ui=Ui.replace(ci,"");try{Ui=""!==Ui?JSON.parse(Ui):null}catch(Gi){Ui=bs,Mo&&(Mo=!1,Ui={error:Gi,text:Ui})}}Mo?(On.next(new Ct({body:Ui,headers:qr,status:Ci,statusText:_s,url:br||void 0})),On.complete()):On.error(new Pt({error:Ui,headers:qr,status:Ci,statusText:_s,url:br||void 0}))},Ds=qr=>{const{url:Ci}=li(),_s=new Pt({error:qr,status:sr.status||0,statusText:sr.statusText||"Unknown Error",url:Ci||void 0});On.error(_s)};let Vs=!1;const gr=qr=>{Vs||(On.next(li()),Vs=!0);let Ci={type:qt.DownloadProgress,loaded:qr.loaded};qr.lengthComputable&&(Ci.total=qr.total),"text"===Nt.responseType&&sr.responseText&&(Ci.partialText=sr.responseText),On.next(Ci)},ti=qr=>{let Ci={type:qt.UploadProgress,loaded:qr.loaded};qr.lengthComputable&&(Ci.total=qr.total),On.next(Ci)};return sr.addEventListener("load",xi),sr.addEventListener("error",Ds),sr.addEventListener("timeout",Ds),sr.addEventListener("abort",Ds),Nt.reportProgress&&(sr.addEventListener("progress",gr),null!==ei&&sr.upload&&sr.upload.addEventListener("progress",ti)),sr.send(ei),On.next({type:qt.Sent}),()=>{sr.removeEventListener("error",Ds),sr.removeEventListener("abort",Ds),sr.removeEventListener("load",xi),sr.removeEventListener("timeout",Ds),Nt.reportProgress&&(sr.removeEventListener("progress",gr),null!==ei&&sr.upload&&sr.upload.removeEventListener("progress",ti)),sr.readyState!==sr.DONE&&sr.abort()}})))}static#e=this.\u0275fac=function(wn){return new(wn||ut)(z.KVO(me.N0))};static#t=this.\u0275prov=z.jDH({token:ut,factory:ut.\u0275fac})}return ut})();const Zt=new z.nKC(""),re=new z.nKC("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),oe=new z.nKC("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class ge{}let Me=(()=>{class ut{constructor(Nt,wn,bt){this.doc=Nt,this.platform=wn,this.cookieName=bt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Nt=this.doc.cookie||"";return Nt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,me._b)(Nt,this.cookieName),this.lastCookieString=Nt),this.lastToken}static#e=this.\u0275fac=function(wn){return new(wn||ut)(z.KVO(me.qQ),z.KVO(z.Agw),z.KVO(re))};static#t=this.\u0275prov=z.jDH({token:ut,factory:ut.\u0275fac})}return ut})();function $e(ut,Dt){const Nt=ut.url.toLowerCase();if(!(0,z.WQX)(Zt)||"GET"===ut.method||"HEAD"===ut.method||Nt.startsWith("http://")||Nt.startsWith("https://"))return Dt(ut);const wn=(0,z.WQX)(ge).getToken(),bt=(0,z.WQX)(oe);return null!=wn&&!ut.headers.has(bt)&&(ut=ut.clone({headers:ut.headers.set(bt,wn)})),Dt(ut)}var Ie=function(ut){return ut[ut.Interceptors=0]="Interceptors",ut[ut.LegacyInterceptors=1]="LegacyInterceptors",ut[ut.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",ut[ut.NoXsrfProtection=3]="NoXsrfProtection",ut[ut.JsonpSupport=4]="JsonpSupport",ut[ut.RequestsMadeViaParent=5]="RequestsMadeViaParent",ut[ut.Fetch=6]="Fetch",ut}(Ie||{});function Je(...ut){const Dt=[$t,Fs,Hn,{provide:He,useExisting:Hn},{provide:qe,useExisting:Fs},{provide:Ri,useValue:$e,multi:!0},{provide:Zt,useValue:!0},{provide:ge,useClass:Me}];for(const Nt of ut)Dt.push(...Nt.\u0275providers);return(0,z.EmA)(Dt)}const Ne=new z.nKC("");function ft(){return function we(ut,Dt){return{\u0275kind:ut,\u0275providers:Dt}}(Ie.LegacyInterceptors,[{provide:Ne,useFactory:Er},{provide:Ri,useExisting:Ne,multi:!0}])}let Li=(()=>{class ut{static#e=this.\u0275fac=function(wn){return new(wn||ut)};static#t=this.\u0275mod=z.$C({type:ut});static#n=this.\u0275inj=z.G2t({providers:[Je(ft())]})}return ut})()},4438:(An,xt,H)=>{"use strict";H.d(xt,{iLQ:()=>ZE,sZ2:()=>my,hnV:()=>gI,Hbi:()=>nM,o8S:()=>d_,BIS:()=>_y,gRc:()=>DI,Ql9:()=>AD,OM3:()=>Ph,Ocv:()=>ND,Z63:()=>Aa,aKT:()=>Co,uvJ:()=>ho,zcH:()=>Wc,bkB:()=>qa,$GK:()=>Nr,nKC:()=>On,zZn:()=>Ql,_q3:()=>rw,MKu:()=>iw,xe9:()=>Rx,Co$:()=>um,Vns:()=>mp,SKi:()=>Do,Xx1:()=>Ko,Agw:()=>y_,PLl:()=>Jm,sFG:()=>Gy,_9s:()=>q_,czy:()=>yf,WPN:()=>Kd,kdw:()=>oa,C4Q:()=>F,NYb:()=>xD,giA:()=>pI,xvI:()=>KC,RxE:()=>oI,c1b:()=>Gm,gXe:()=>Uo,mal:()=>Ky,L39:()=>RM,Ol2:()=>ly,w6W:()=>rE,oH4:()=>II,SmG:()=>zD,WQX:()=>Ei,naY:()=>UD,QuC:()=>Yo,EmA:()=>nl,fpN:()=>tM,HJs:()=>VM,N4e:()=>Da,O8t:()=>OM,H3F:()=>aI,H8p:()=>ya,KH2:()=>Cv,TgB:()=>Km,wOt:()=>Zn,WHO:()=>hI,e01:()=>fI,lNU:()=>Er,h9k:()=>Vp,$MX:()=>Cm,ZF7:()=>Ou,Kcf:()=>Np,e5t:()=>T_,UyX:()=>Am,cWb:()=>ld,osQ:()=>Hf,H5H:()=>DE,Zy3:()=>us,mq5:()=>wb,JZv:()=>qn,LfX:()=>ki,plB:()=>up,jNT:()=>qE,zjR:()=>mI,TL$:()=>sf,Tbb:()=>Q,rcV:()=>Zu,Mj6:()=>za,GFd:()=>cm,OA$:()=>V,aNF:()=>LT,R7$:()=>np,BMQ:()=>mE,HbH:()=>ob,AVh:()=>wE,wni:()=>dT,VBU:()=>Ca,FsC:()=>Dl,jDH:()=>Sn,G2t:()=>gi,$C:()=>Gl,EJ8:()=>xc,rXU:()=>Kp,nrm:()=>CE,bVm:()=>xx,qex:()=>vx,k0s:()=>yx,j41:()=>_x,RV6:()=>vb,xGo:()=>gl,KVO:()=>Us,kS0:()=>kf,QTQ:()=>Lm,bIt:()=>PE,lsd:()=>pT,joV:()=>rs,qSk:()=>es,XpG:()=>Jb,SdG:()=>tT,NAR:()=>eT,Y8G:()=>vE,lJ4:()=>VT,mGM:()=>fT,Njj:()=>Ms,tSv:()=>k_,eBV:()=>Hs,npT:()=>Dm,B4B:()=>Md,n$t:()=>M_,wjB:()=>FT,Aen:()=>gp,xc7:()=>EE,DNE:()=>T,EFF:()=>TT,JRh:()=>NE,SpI:()=>Ix,Lme:()=>LE,GBs:()=>hT}),H(467);let ye=null,ae=1;const De=Symbol("SIGNAL");function Be(r){const s=ye;return ye=r,s}function Oe(r){if((!at(r)||r.dirty)&&(r.dirty||r.lastCleanEpoch!==ae)){if(!r.producerMustRecompute(r)&&!nt(r))return r.dirty=!1,void(r.lastCleanEpoch=ae);r.producerRecomputeValue(r),r.dirty=!1,r.lastCleanEpoch=ae}}function nt(r){Ze(r);for(let s=0;s<r.producerNode.length;s++){const d=r.producerNode[s],g=r.producerLastReadVersion[s];if(g!==d.version||(Oe(d),g!==d.version))return!0}return!1}function Te(r,s){if(function it(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}(r),Ze(r),1===r.liveConsumerNode.length)for(let g=0;g<r.producerNode.length;g++)Te(r.producerNode[g],r.producerIndexOfThis[g]);const d=r.liveConsumerNode.length-1;if(r.liveConsumerNode[s]=r.liveConsumerNode[d],r.liveConsumerIndexOfThis[s]=r.liveConsumerIndexOfThis[d],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,s<r.liveConsumerNode.length){const g=r.liveConsumerIndexOfThis[s],x=r.liveConsumerNode[s];Ze(x),x.producerIndexOfThis[g]=s}}function at(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function Ze(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}let lt=null;var ur=H(1413),Ai=H(8359),Ri=H(4412),nr=H(6354);const Er="https://g.co/ng/security#xss";class Zn extends Error{constructor(s,d){super(us(s,d)),this.code=s}}function us(r,s){return`NG0${Math.abs(r)}${s?": "+s:""}`}function Ce(r){return{toString:r}.toString()}const Mt="__parameters__";function $r(r,s,d){return Ce(()=>{const g=function vi(r){return function(...d){if(r){const g=r(...d);for(const x in g)this[x]=g[x]}}}(s);function x(...I){if(this instanceof x)return g.apply(this,I),this;const N=new x(...I);return U.annotation=N,U;function U(q,ue,Fe){const dt=q.hasOwnProperty(Mt)?q[Mt]:Object.defineProperty(q,Mt,{value:[]})[Mt];for(;dt.length<=Fe;)dt.push(null);return(dt[Fe]=dt[Fe]||[]).push(N),q}}return d&&(x.prototype=Object.create(d.prototype)),x.prototype.ngMetadataName=r,x.annotationCls=x,x})}const qn=globalThis;function ve(r){for(let s in r)if(r[s]===ve)return s;throw Error("Could not find renamed property on target object.")}function Q(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Q).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const s=r.toString();if(null==s)return""+s;const d=s.indexOf("\n");return-1===d?s:s.substring(0,d)}function oe(r,s){return null==r||""===r?null===s?"":s:null==s||""===s?r:r+" "+s}const Me=ve({__forward_ref__:ve});function $e(r){return r.__forward_ref__=$e,r.toString=function(){return Q(this())},r}function Re(r){return Ie(r)?r():r}function Ie(r){return"function"==typeof r&&r.hasOwnProperty(Me)&&r.__forward_ref__===$e}function Sn(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function gi(r){return{providers:r.providers||[],imports:r.imports||[]}}function Ii(r){return ws(r,Dt)||ws(r,wn)}function ki(r){return null!==Ii(r)}function ws(r,s){return r.hasOwnProperty(s)?r[s]:null}function ut(r){return r&&(r.hasOwnProperty(Nt)||r.hasOwnProperty(bt))?r[Nt]:null}const Dt=ve({\u0275prov:ve}),Nt=ve({\u0275inj:ve}),wn=ve({ngInjectableDef:ve}),bt=ve({ngInjectorDef:ve});class On{constructor(s,d){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof d?this.__NG_ELEMENT_ID__=d:void 0!==d&&(this.\u0275prov=Sn({token:this,providedIn:d.providedIn||"root",factory:d.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ci(r){return r&&!!r.\u0275providers}const _s=ve({\u0275cmp:ve}),br=ve({\u0275dir:ve}),Ui=ve({\u0275pipe:ve}),Mo=ve({\u0275mod:ve}),bs=ve({\u0275fac:ve}),Gi=ve({__NG_ELEMENT_ID__:ve}),ys=ve({__NG_ENV_ID__:ve});function fi(r){return"string"==typeof r?r:null==r?"":String(r)}function Fi(r,s){throw new Zn(-201,!1)}var Nr=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}(Nr||{});let eo;function to(){return eo}function ds(r){const s=eo;return eo=r,s}function Bc(r,s,d){const g=Ii(r);return g&&"root"==g.providedIn?void 0===g.value?g.value=g.factory():g.value:d&Nr.Optional?null:void 0!==s?s:void Fi()}const Ro={},Ta="__NG_DI_FLAG__",al="ngTempTokenPath",Xo=/\n/gm,ia="__source";let hs;function wi(r){const s=hs;return hs=r,s}function Zs(r,s=Nr.Default){if(void 0===hs)throw new Zn(-203,!1);return null===hs?Bc(r,void 0,s):hs.get(r,s&Nr.Optional?null:void 0,s)}function Us(r,s=Nr.Default){return(to()||Zs)(Re(r),s)}function Ei(r,s=Nr.Default){return Us(r,Il(s))}function Il(r){return typeof r>"u"||"number"==typeof r?r:(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function La(r){const s=[];for(let d=0;d<r.length;d++){const g=Re(r[d]);if(Array.isArray(g)){if(0===g.length)throw new Zn(900,!1);let x,I=Nr.Default;for(let N=0;N<g.length;N++){const U=g[N],q=_c(U);"number"==typeof q?-1===q?x=U.token:I|=q:x=U}s.push(Us(x,I))}else s.push(Us(g))}return s}function Bo(r,s){return r[Ta]=s,r.prototype[Ta]=s,r}function _c(r){return r[Ta]}const Ko=Bo($r("Optional"),8),oa=Bo($r("SkipSelf"),4);function Qa(r,s){return r.hasOwnProperty(bs)?r[bs]:null}function Vl(r,s){r.forEach(d=>Array.isArray(d)?Vl(d,s):s(d))}function Ul(r,s,d){s>=r.length?r.push(d):r.splice(s,0,d)}function Ki(r,s){return s>=r.length-1?r.pop():r.splice(s,1)[0]}function Vo(r,s,d){let g=Ya(r,s);return g>=0?r[1|g]=d:(g=~g,function Va(r,s,d,g){let x=r.length;if(x==s)r.push(d,g);else if(1===x)r.push(g,r[0]),r[0]=d;else{for(x--,r.push(r[x-1],r[x]);x>s;)r[x]=r[x-2],x--;r[s]=d,r[s+1]=g}}(r,g,s,d)),g}function Ia(r,s){const d=Ya(r,s);if(d>=0)return r[1|d]}function Ya(r,s){return function Sa(r,s,d){let g=0,x=r.length>>d;for(;x!==g;){const I=g+(x-g>>1),N=r[I<<d];if(s===N)return I<<d;N>s?x=I:g=I+1}return~(x<<d)}(r,s,1)}const ro={},si=[],Aa=new On(""),Po=new On("",-1),_a=new On("");class zi{get(s,d=Ro){if(d===Ro){const g=new Error(`NullInjectorError: No provider for ${Q(s)}!`);throw g.name="NullInjectorError",g}return d}}var tc=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(tc||{}),Uo=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Uo||{}),za=function(r){return r[r.None=0]="None",r[r.SignalBased=1]="SignalBased",r[r.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",r}(za||{});function ns(r,s,d){let g=r.length;for(;;){const x=r.indexOf(s,d);if(-1===x)return x;if(0===x||r.charCodeAt(x-1)<=32){const I=s.length;if(x+I===g||r.charCodeAt(x+I)<=32)return x}d=x+1}}function ll(r,s,d){let g=0;for(;g<d.length;){const x=d[g];if("number"==typeof x){if(0!==x)break;g++;const I=d[g++],N=d[g++],U=d[g++];r.setAttribute(s,N,U,I)}else{const I=x,N=d[++g];cl(I)?r.setProperty(s,I,N):r.setAttribute(s,I,N),g++}}return g}function Hi(r){return 3===r||4===r||6===r}function cl(r){return 64===r.charCodeAt(0)}function nc(r,s){if(null!==s&&0!==s.length)if(null===r||0===r.length)r=s.slice();else{let d=-1;for(let g=0;g<s.length;g++){const x=s[g];"number"==typeof x?d=x:0===d||Ja(r,d,x,null,-1===d||2===d?s[++g]:null)}}return r}function Ja(r,s,d,g,x){let I=0,N=r.length;if(-1===s)N=-1;else for(;I<r.length;){const U=r[I++];if("number"==typeof U){if(U===s){N=-1;break}if(U>s){N=I-1;break}}}for(;I<r.length;){const U=r[I];if("number"==typeof U)break;if(U===d){if(null===g)return void(null!==x&&(r[I+1]=x));if(g===r[I+1])return void(r[I+2]=x)}I++,null!==g&&I++,null!==x&&I++}-1!==N&&(r.splice(N,0,s),I=N+1),r.splice(I++,0,d),null!==g&&r.splice(I++,0,g),null!==x&&r.splice(I++,0,x)}const da="ng-template";function vs(r,s,d,g){let x=0;if(g){for(;x<s.length&&"string"==typeof s[x];x+=2)if("class"===s[x]&&-1!==ns(s[x+1].toLowerCase(),d,0))return!0}else if(el(r))return!1;if(x=s.indexOf(1,x),x>-1){let I;for(;++x<s.length&&"string"==typeof(I=s[x]);)if(I.toLowerCase()===d)return!0}return!1}function el(r){return 4===r.type&&r.value!==da}function uu(r,s,d){return s===(4!==r.type||d?r.value:da)}function Sl(r,s,d){let g=4;const x=r.attrs,I=null!==x?function Ts(r){for(let s=0;s<r.length;s++)if(Hi(r[s]))return s;return r.length}(x):0;let N=!1;for(let U=0;U<s.length;U++){const q=s[U];if("number"!=typeof q){if(!N)if(4&g){if(g=2|1&g,""!==q&&!uu(r,q,d)||""===q&&1===s.length){if(wo(g))return!1;N=!0}}else if(8&g){if(null===x||!vs(r,x,q,d)){if(wo(g))return!1;N=!0}}else{const ue=s[++U],Fe=Mc(q,x,el(r),d);if(-1===Fe){if(wo(g))return!1;N=!0;continue}if(""!==ue){let dt;if(dt=Fe>I?"":x[Fe+1].toLowerCase(),2&g&&ue!==dt){if(wo(g))return!1;N=!0}}}}else{if(!N&&!wo(g)&&!wo(q))return!1;if(N&&wo(q))continue;N=!1,g=q|1&g}}return wo(g)||N}function wo(r){return!(1&r)}function Mc(r,s,d,g){if(null===s)return-1;let x=0;if(g||!d){let I=!1;for(;x<s.length;){const N=s[x];if(N===r)return x;if(3===N||6===N)I=!0;else{if(1===N||2===N){let U=s[++x];for(;"string"==typeof U;)U=s[++x];continue}if(4===N)break;if(0===N){x+=4;continue}}x+=I?1:2}return-1}return function jl(r,s){let d=r.indexOf(4);if(d>-1)for(d++;d<r.length;){const g=r[d];if("number"==typeof g)return-1;if(g===s)return d;d++}return-1}(s,r)}function Al(r,s,d=!1){for(let g=0;g<s.length;g++)if(Sl(r,s[g],d))return!0;return!1}function Uc(r,s){e:for(let d=0;d<s.length;d++){const g=s[d];if(r.length===g.length){for(let x=0;x<r.length;x++)if(r[x]!==g[x])continue e;return!0}}return!1}function Cl(r,s){return r?":not("+s.trim()+")":s}function $l(r){let s=r[0],d=1,g=2,x="",I=!1;for(;d<r.length;){let N=r[d];if("string"==typeof N)if(2&g){const U=r[++d];x+="["+N+(U.length>0?'="'+U+'"':"")+"]"}else 8&g?x+="."+N:4&g&&(x+=" "+N);else""!==x&&!wo(N)&&(s+=Cl(I,x),x=""),g=N,I=I||!wo(g);d++}return""!==x&&(s+=Cl(I,x)),s}function Ca(r){return Ce(()=>{const s=Ns(r),d={...s,decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===tc.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Uo.Emulated,styles:r.styles||si,_:null,schemas:r.schemas||null,tView:null,id:""};Ml(d);const g=r.dependencies;return d.directiveDefs=tl(g,!1),d.pipeDefs=tl(g,!0),d.id=function eu(r){let s=0;const d=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(const x of d)s=Math.imul(31,s)+x.charCodeAt(0)|0;return s+=2147483648,"c"+s}(d),d})}function Jc(r){return Bi(r)||$s(r)}function vc(r){return null!==r}function Gl(r){return Ce(()=>({type:r.type,bootstrap:r.bootstrap||si,declarations:r.declarations||si,imports:r.imports||si,exports:r.exports||si,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function ic(r,s){if(null==r)return ro;const d={};for(const g in r)if(r.hasOwnProperty(g)){const x=r[g];let I,N,U=za.None;Array.isArray(x)?(U=x[0],I=x[1],N=x[2]??I):(I=x,N=x),s?(d[I]=U!==za.None?[g,U]:g,s[I]=N):d[I]=g}return d}function Dl(r){return Ce(()=>{const s=Ns(r);return Ml(s),s})}function xc(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function Bi(r){return r[_s]||null}function $s(r){return r[br]||null}function Is(r){return r[Ui]||null}function Yo(r){const s=Bi(r)||$s(r)||Is(r);return null!==s&&s.standalone}function uo(r,s){const d=r[Mo]||null;if(!d&&!0===s)throw new Error(`Type ${Q(r)} does not have '\u0275mod' property.`);return d}function Ns(r){const s={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:s,inputTransforms:null,inputConfig:r.inputs||ro,exportAs:r.exportAs||null,standalone:!0===r.standalone,signals:!0===r.signals,selectors:r.selectors||si,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ic(r.inputs,s),outputs:ic(r.outputs),debugInfo:null}}function Ml(r){r.features?.forEach(s=>s(r))}function tl(r,s){if(!r)return null;const d=s?Is:Jc;return()=>("function"==typeof r?r():r).map(g=>d(g)).filter(vc)}function nl(r){return{\u0275providers:r}}function sc(...r){return{\u0275providers:os(0,r),\u0275fromNgModule:!0}}function os(r,...s){const d=[],g=new Set;let x;const I=N=>{d.push(N)};return Vl(s,N=>{const U=N;zc(U,I,[],g)&&(x||=[],x.push(U))}),void 0!==x&&Ec(x,I),d}function Ec(r,s){for(let d=0;d<r.length;d++){const{ngModule:g,providers:x}=r[d];Hl(x,I=>{s(I,g)})}}function zc(r,s,d,g){if(!(r=Re(r)))return!1;let x=null,I=ut(r);const N=!I&&Bi(r);if(I||N){if(N&&!N.standalone)return!1;x=r}else{const q=r.ngModule;if(I=ut(q),!I)return!1;x=q}const U=g.has(x);if(N){if(U)return!1;if(g.add(x),N.dependencies){const q="function"==typeof N.dependencies?N.dependencies():N.dependencies;for(const ue of q)zc(ue,s,d,g)}}else{if(!I)return!1;{if(null!=I.imports&&!U){let ue;g.add(x);try{Vl(I.imports,Fe=>{zc(Fe,s,d,g)&&(ue||=[],ue.push(Fe))})}finally{}void 0!==ue&&Ec(ue,s)}if(!U){const ue=Qa(x)||(()=>new x);s({provide:x,useFactory:ue,deps:si},x),s({provide:_a,useValue:x,multi:!0},x),s({provide:Aa,useValue:()=>Us(x),multi:!0},x)}const q=I.providers;if(null!=q&&!U){const ue=r;Hl(q,Fe=>{s(Fe,ue)})}}}return x!==r&&void 0!==r.providers}function Hl(r,s){for(let d of r)Ci(d)&&(d=d.\u0275providers),Array.isArray(d)?Hl(d,s):s(d)}const hu=ve({provide:String,useValue:ve});function oc(r){return null!==r&&"object"==typeof r&&hu in r}function Wl(r){return"function"==typeof r}const ya=new On(""),ac={},ha={};let ql;function Rl(){return void 0===ql&&(ql=new zi),ql}class ho{}class $a extends ho{get destroyed(){return this._destroyed}constructor(s,d,g,x){super(),this.parent=d,this.source=g,this.scopes=x,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,va(s,N=>this.processProvider(N)),this.records.set(Po,Ls(void 0,this)),x.has("environment")&&this.records.set(ho,Ls(void 0,this));const I=this.records.get(ya);null!=I&&"string"==typeof I.value&&this.scopes.add(I.value),this.injectorDefTypes=new Set(this.get(_a,si,Nr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const s=Be(null);try{for(const g of this._ngOnDestroyHooks)g.ngOnDestroy();const d=this._onDestroyHooks;this._onDestroyHooks=[];for(const g of d)g()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Be(s)}}onDestroy(s){return this.assertNotDestroyed(),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){this.assertNotDestroyed();const d=wi(this),g=ds(void 0);try{return s()}finally{wi(d),ds(g)}}get(s,d=Ro,g=Nr.Default){if(this.assertNotDestroyed(),s.hasOwnProperty(ys))return s[ys](this);g=Il(g);const I=wi(this),N=ds(void 0);try{if(!(g&Nr.SkipSelf)){let q=this.records.get(s);if(void 0===q){const ue=function lc(r){return"function"==typeof r||"object"==typeof r&&r instanceof On}(s)&&Ii(s);q=ue&&this.injectableDefInScope(ue)?Ls(wc(s),ac):null,this.records.set(s,q)}if(null!=q)return this.hydrate(s,q)}return(g&Nr.Self?Rl():this.parent).get(s,d=g&Nr.Optional&&d===Ro?null:d)}catch(U){if("NullInjectorError"===U.name){if((U[al]=U[al]||[]).unshift(Q(s)),I)throw U;return function Xa(r,s,d,g){const x=r[al];throw s[ia]&&x.unshift(s[ia]),r.message=function qo(r,s,d,g=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.slice(2):r;let x=Q(s);if(Array.isArray(s))x=s.map(Q).join(" -> ");else if("object"==typeof s){let I=[];for(let N in s)if(s.hasOwnProperty(N)){let U=s[N];I.push(N+":"+("string"==typeof U?JSON.stringify(U):Q(U)))}x=`{${I.join(", ")}}`}return`${d}${g?"("+g+")":""}[${x}]: ${r.replace(Xo,"\n  ")}`}("\n"+r.message,x,d,g),r.ngTokenPath=x,r[al]=null,r}(U,s,"R3InjectorError",this.source)}throw U}finally{ds(N),wi(I)}}resolveInjectorInitializers(){const s=Be(null),d=wi(this),g=ds(void 0);try{const I=this.get(Aa,si,Nr.Self);for(const N of I)N()}finally{wi(d),ds(g),Be(s)}}toString(){const s=[],d=this.records;for(const g of d.keys())s.push(Q(g));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Zn(205,!1)}processProvider(s){let d=Wl(s=Re(s))?s:Re(s&&s.provide);const g=function as(r){return oc(r)?Ls(void 0,r.useValue):Ls(function Pl(r,s,d){let g;if(Wl(r)){const x=Re(r);return Qa(x)||wc(x)}if(oc(r))g=()=>Re(r.useValue);else if(function gs(r){return!(!r||!r.useFactory)}(r))g=()=>r.useFactory(...La(r.deps||[]));else if(function Ps(r){return!(!r||!r.useExisting)}(r))g=()=>Us(Re(r.useExisting));else{const x=Re(r&&(r.useClass||r.provide));if(!function la(r){return!!r.deps}(r))return Qa(x)||wc(x);g=()=>new x(...La(r.deps))}return g}(r),ac)}(s);if(!Wl(s)&&!0===s.multi){let x=this.records.get(d);x||(x=Ls(void 0,ac,!0),x.factory=()=>La(x.multi),this.records.set(d,x)),d=s,x.multi.push(s)}this.records.set(d,g)}hydrate(s,d){const g=Be(null);try{return d.value===ac&&(d.value=ha,d.value=d.factory()),"object"==typeof d.value&&d.value&&function ul(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(d.value)&&this._ngOnDestroyHooks.add(d.value),d.value}finally{Be(g)}}injectableDefInScope(s){if(!s.providedIn)return!1;const d=Re(s.providedIn);return"string"==typeof d?"any"===d||this.scopes.has(d):this.injectorDefTypes.has(d)}removeOnDestroy(s){const d=this._onDestroyHooks.indexOf(s);-1!==d&&this._onDestroyHooks.splice(d,1)}}function wc(r){const s=Ii(r),d=null!==s?s.factory:Qa(r);if(null!==d)return d;if(r instanceof On)throw new Zn(204,!1);if(r instanceof Function)return function io(r){if(r.length>0)throw new Zn(204,!1);const d=function _i(r){return r&&(r[Dt]||r[wn])||null}(r);return null!==d?()=>d.factory(r):()=>new r}(r);throw new Zn(204,!1)}function Ls(r,s,d=!1){return{factory:r,value:s,multi:d?[]:void 0}}function va(r,s){for(const d of r)Array.isArray(d)?va(d,s):d&&Ci(d)?va(d.\u0275providers,s):s(d)}function Da(r,s){r instanceof $a&&r.assertNotDestroyed();const g=wi(r),x=ds(void 0);try{return s()}finally{wi(g),ds(x)}}function jc(){return void 0!==to()||null!=function sa(){return hs}()}const xs=0,lr=1,Kr=2,Di=3,Ni=4,js=5,ea=6,rl=7,qi=8,ca=9,fo=10,Si=11,dl=12,Kl=13,Ol=14,Xs=15,Rc=16,Zl=17,jo=18,Ga=19,ju=20,fa=21,hl=22,Ss=23,Oi=25,cc=1,vo=7,Gs=9,As=10;var fu=function(r){return r[r.None=0]="None",r[r.HasTransplantedViews=2]="HasTransplantedViews",r}(fu||{});function pr(r){return Array.isArray(r)&&"object"==typeof r[cc]}function zr(r){return Array.isArray(r)&&!0===r[cc]}function $u(r){return!!(4&r.flags)}function dr(r){return r.componentOffset>-1}function xn(r){return!(1&~r.flags)}function Un(r){return!!r.template}function Ao(r){return!!(512&r[Kr])}class C{constructor(s,d,g){this.previousValue=s,this.currentValue=d,this.firstChange=g}isFirstChange(){return this.firstChange}}function P(r,s,d,g){null!==s?s.applyValueToInputSignal(s,g):r[d]=g}function V(){return K}function K(r){return r.type.prototype.ngOnChanges&&(r.setInput=ce),Y}function Y(){const r=Ke(this),s=r?.current;if(s){const d=r.previous;if(d===ro)r.previous=s;else for(let g in s)d[g]=s[g];r.current=null,this.ngOnChanges(s)}}function ce(r,s,d,g,x){const I=this.declaredInputs[g],N=Ke(r)||function Ye(r,s){return r[Pe]=s}(r,{previous:ro,current:null}),U=N.current||(N.current={}),q=N.previous,ue=q[I];U[I]=new C(ue&&ue.currentValue,d,q===ro),P(r,s,x,d)}V.ngInherit=!0;const Pe="__ngSimpleChanges__";function Ke(r){return r[Pe]||null}const pe=function(r,s,d){},he="svg";let mt=!1;function It(r){for(;Array.isArray(r);)r=r[xs];return r}function Kt(r,s){return It(s[r])}function ln(r,s){return It(s[r.index])}function cn(r,s){return r.data[s]}function an(r,s){const d=s[r];return pr(d)?d:d[xs]}function dn(r){return!(128&~r[Kr])}function Nn(r,s){return null==s?null:r[s]}function Wn(r){r[Zl]=0}function Yn(r){1024&r[Kr]||(r[Kr]|=1024,dn(r)&&R(r))}function bi(r){return!!(9216&r[Kr]||r[Ss]?.dirty)}function Br(r){r[fo].changeDetectionScheduler?.notify(1),bi(r)?R(r):64&r[Kr]&&(function Ut(){return mt}()?(r[Kr]|=1024,R(r)):r[fo].changeDetectionScheduler?.notify())}function R(r){r[fo].changeDetectionScheduler?.notify();let s=ee(r);for(;null!==s&&!(8192&s[Kr])&&(s[Kr]|=8192,dn(s));)s=ee(s)}function L(r,s){if(!(256&~r[Kr]))throw new Zn(911,!1);null===r[fa]&&(r[fa]=[]),r[fa].push(s)}function ee(r){const s=r[Di];return zr(s)?s[Di]:s}const Ee={lFrame:pl(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function Rn(){return Ee.bindingsEnabled}function kn(){return null!==Ee.skipHydrationRootTNode}function Yt(){return Ee.lFrame.lView}function Tr(){return Ee.lFrame.tView}function Hs(r){return Ee.lFrame.contextLView=r,r[qi]}function Ms(r){return Ee.lFrame.contextLView=null,r}function mi(){let r=Yr();for(;null!==r&&64===r.type;)r=r.parent;return r}function Yr(){return Ee.lFrame.currentTNode}function Mi(r,s){const d=Ee.lFrame;d.currentTNode=r,d.isParent=s}function po(){return Ee.lFrame.isParent}function Rr(){Ee.lFrame.isParent=!1}function Ma(){return Ee.lFrame.bindingIndex++}function xo(r){const s=Ee.lFrame,d=s.bindingIndex;return s.bindingIndex=s.bindingIndex+r,d}function Tc(r,s){const d=Ee.lFrame;d.bindingIndex=d.bindingRootIndex=r,fl(s)}function fl(r){Ee.lFrame.currentDirectiveIndex=r}function tu(){return Ee.lFrame.currentQueryIndex}function Cu(r){Ee.lFrame.currentQueryIndex=r}function Nh(r){const s=r[lr];return 2===s.type?s.declTNode:1===s.type?r[js]:null}function mo(r,s,d){if(d&Nr.SkipSelf){let x=s,I=r;for(;!(x=x.parent,null!==x||d&Nr.Host||(x=Nh(I),null===x||(I=I[Ol],10&x.type))););if(null===x)return!1;s=x,r=I}const g=Ee.lFrame=Oc();return g.currentTNode=s,g.lView=r,!0}function kl(r){const s=Oc(),d=r[lr];Ee.lFrame=s,s.currentTNode=d.firstChild,s.lView=r,s.tView=d,s.contextLView=r,s.bindingIndex=d.bindingStartIndex,s.inI18n=!1}function Oc(){const r=Ee.lFrame,s=null===r?null:r.child;return null===s?pl(r):s}function pl(r){const s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=s),s}function Nl(){const r=Ee.lFrame;return Ee.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const ml=Nl;function pa(){const r=Nl();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Ra(){return Ee.lFrame.selectedIndex}function nu(r){Ee.lFrame.selectedIndex=r}function bo(){const r=Ee.lFrame;return cn(r.tView,r.selectedIndex)}function es(){Ee.lFrame.currentNamespace=he}function rs(){!function ru(){Ee.lFrame.currentNamespace=null}()}let go=!0;function ii(){return go}function Ll(r){go=r}function Sc(r,s){for(let d=s.directiveStart,g=s.directiveEnd;d<g;d++){const I=r.data[d].type.prototype,{ngAfterContentInit:N,ngAfterContentChecked:U,ngAfterViewInit:q,ngAfterViewChecked:ue,ngOnDestroy:Fe}=I;N&&(r.contentHooks??=[]).push(-d,N),U&&((r.contentHooks??=[]).push(d,U),(r.contentCheckHooks??=[]).push(d,U)),q&&(r.viewHooks??=[]).push(-d,q),ue&&((r.viewHooks??=[]).push(d,ue),(r.viewCheckHooks??=[]).push(d,ue)),null!=Fe&&(r.destroyHooks??=[]).push(d,Fe)}}function Vd(r,s,d){Vh(r,s,3,d)}function Bh(r,s,d,g){(3&r[Kr])===d&&Vh(r,s,d,g)}function $o(r,s){let d=r[Kr];(3&d)===s&&(d&=16383,d+=1,r[Kr]=d)}function Vh(r,s,d,g){const I=g??-1,N=s.length-1;let U=0;for(let q=void 0!==g?65535&r[Zl]:0;q<N;q++)if("number"==typeof s[q+1]){if(U=s[q],null!=g&&U>=g)break}else s[q]<0&&(r[Zl]+=65536),(U<I||-1==I)&&(Du(r,d,s,q),r[Zl]=(4294901760&r[Zl])+q+2),q++}function Eo(r,s){pe(4,r,s);const d=Be(null);try{s.call(r)}finally{Be(d),pe(5,r,s)}}function Du(r,s,d,g){const x=d[g]<0,I=d[g+1],U=r[x?-d[g]:d[g]];x?r[Kr]>>14<r[Zl]>>16&&(3&r[Kr])===s&&(r[Kr]+=16384,Eo(U,I)):Eo(U,I)}const Mu=-1;class nd{constructor(s,d,g){this.factory=s,this.resolving=!1,this.canSeeViewProviders=d,this.injectImpl=g}}function rd(r){return r!==Mu}function iu(r){return 32767&r}function ih(r,s){let d=function jh(r){return r>>16}(r),g=s;for(;d>0;)g=g[Ol],d--;return g}let sh=!0;function xd(r){const s=sh;return sh=r,s}const $h=255,Ac=5;let Gc=0;const Ru={};function Pf(r,s){const d=su(r,s);if(-1!==d)return d;const g=s[lr];g.firstCreatePass&&(r.injectorIndex=s.length,oh(g.data,r),oh(s,null),oh(g.blueprint,null));const x=Gh(r,s),I=r.injectorIndex;if(rd(x)){const N=iu(x),U=ih(x,s),q=U[lr].data;for(let ue=0;ue<8;ue++)s[I+ue]=U[N+ue]|q[N+ue]}return s[I+8]=x,I}function oh(r,s){r.push(0,0,0,0,0,0,0,0,s)}function su(r,s){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===s[r.injectorIndex+8]?-1:r.injectorIndex}function Gh(r,s){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let d=0,g=null,x=s;for(;null!==x;){if(g=kc(x),null===g)return Mu;if(d++,x=x[Ol],-1!==g.injectorIndex)return g.injectorIndex|d<<16}return Mu}function Ed(r,s,d){!function ua(r,s,d){let g;"string"==typeof d?g=d.charCodeAt(0)||0:d.hasOwnProperty(Gi)&&(g=d[Gi]),null==g&&(g=d[Gi]=Gc++);const x=g&$h;s.data[r+(x>>Ac)]|=1<<x}(r,s,d)}function Hh(r,s,d){if(d&Nr.Optional||void 0!==r)return r;Fi()}function Hu(r,s,d,g){if(d&Nr.Optional&&void 0===g&&(g=null),!(d&(Nr.Self|Nr.Host))){const x=r[ca],I=ds(void 0);try{return x?x.get(s,g,d&Nr.Optional):Bc(s,g,d&Nr.Optional)}finally{ds(I)}}return Hh(g,0,d)}function xp(r,s,d,g=Nr.Default,x){if(null!==r){if(2048&s[Kr]&&!(g&Nr.Self)){const N=function lh(r,s,d,g,x){let I=r,N=s;for(;null!==I&&null!==N&&2048&N[Kr]&&!(512&N[Kr]);){const U=Ep(I,N,d,g|Nr.Self,Ru);if(U!==Ru)return U;let q=I.parent;if(!q){const ue=N[ju];if(ue){const Fe=ue.get(d,Ru,g);if(Fe!==Ru)return Fe}q=kc(N),N=N[Ol]}I=q}return x}(r,s,d,g,Ru);if(N!==Ru)return N}const I=Ep(r,s,d,g,Ru);if(I!==Ru)return I}return Hu(s,d,g,x)}function Ep(r,s,d,g,x){const I=function Zm(r){if("string"==typeof r)return r.charCodeAt(0)||0;const s=r.hasOwnProperty(Gi)?r[Gi]:void 0;return"number"==typeof s?s>=0?s&$h:bd:s}(d);if("function"==typeof I){if(!mo(s,r,g))return g&Nr.Host?Hh(x,0,g):Hu(s,d,g,x);try{let N;if(N=I(g),null!=N||g&Nr.Optional)return N;Fi()}finally{ml()}}else if("number"==typeof I){let N=null,U=su(r,s),q=Mu,ue=g&Nr.Host?s[Xs][js]:null;for((-1===U||g&Nr.SkipSelf)&&(q=-1===U?Gh(r,s):s[U+8],q!==Mu&&sd(g,!1)?(N=s[lr],U=iu(q),s=ih(q,s)):U=-1);-1!==U;){const Fe=s[lr];if(Of(I,U,Fe.data)){const dt=id(U,s,d,N,g,ue);if(dt!==Ru)return dt}q=s[U+8],q!==Mu&&sd(g,s[lr].data[U+8]===ue)&&Of(I,U,s)?(N=Fe,U=iu(q),s=ih(q,s)):U=-1}}return x}function id(r,s,d,g,x,I){const N=s[lr],U=N.data[r+8],Fe=ah(U,N,d,null==g?dr(U)&&sh:g!=N&&!!(3&U.type),x&Nr.Host&&I===U);return null!==Fe?ou(s,N,Fe,U):Ru}function ah(r,s,d,g,x){const I=r.providerIndexes,N=s.data,U=1048575&I,q=r.directiveStart,Fe=I>>20,Wt=x?U+Fe:r.directiveEnd;for(let rn=g?U:U+Fe;rn<Wt;rn++){const vn=N[rn];if(rn<q&&d===vn||rn>=q&&vn.type===d)return rn}if(x){const rn=N[q];if(rn&&Un(rn)&&rn.type===d)return q}return null}function ou(r,s,d,g){let x=r[d];const I=s.data;if(function vd(r){return r instanceof nd}(x)){const N=x;N.resolving&&function gc(r,s){throw s&&s.join(" > "),new Zn(-200,r)}(function Pi(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():fi(r)}(I[d]));const U=xd(N.canSeeViewProviders);N.resolving=!0;const ue=N.injectImpl?ds(N.injectImpl):null;mo(r,g,Nr.Default);try{x=r[d]=N.factory(void 0,I,r,g),s.firstCreatePass&&d>=g.directiveStart&&function Fh(r,s,d){const{ngOnChanges:g,ngOnInit:x,ngDoCheck:I}=s.type.prototype;if(g){const N=K(s);(d.preOrderHooks??=[]).push(r,N),(d.preOrderCheckHooks??=[]).push(r,N)}x&&(d.preOrderHooks??=[]).push(0-r,x),I&&((d.preOrderHooks??=[]).push(r,I),(d.preOrderCheckHooks??=[]).push(r,I))}(d,I[d],s)}finally{null!==ue&&ds(ue),xd(U),N.resolving=!1,ml()}}return x}function Of(r,s,d){return!!(d[s+(r>>Ac)]&1<<r)}function sd(r,s){return!(r&Nr.Self||r&Nr.Host&&s)}class Wa{constructor(s,d){this._tNode=s,this._lView=d}get(s,d,g){return xp(this._tNode,this._lView,s,Il(g),d)}}function bd(){return new Wa(mi(),Yt())}function gl(r){return Ce(()=>{const s=r.prototype.constructor,d=s[bs]||Wh(s),g=Object.prototype;let x=Object.getPrototypeOf(r.prototype).constructor;for(;x&&x!==g;){const I=x[bs]||Wh(x);if(I&&I!==d)return I;x=Object.getPrototypeOf(x)}return I=>new I})}function Wh(r){return Ie(r)?()=>{const s=Wh(Re(r));return s&&s()}:Qa(r)}function kc(r){const s=r[lr],d=s.type;return 2===d?s.declTNode:1===d?r[js]:null}function kf(r){return function Ud(r,s){if("class"===s)return r.classes;if("style"===s)return r.styles;const d=r.attrs;if(d){const g=d.length;let x=0;for(;x<g;){const I=d[x];if(Hi(I))break;if(0===I)x+=2;else if("number"==typeof I)for(x++;x<g&&"string"==typeof d[x];)x++;else{if(I===s)return d[x+1];x+=2}}}return null}(mi(),r)}function Nf(r,s=null,d=null,g){const x=jd(r,s,d,g);return x.resolveInjectorInitializers(),x}function jd(r,s=null,d=null,g,x=new Set){const I=[d||si,sc(r)];return g=g||("object"==typeof r?void 0:Q(r)),new $a(I,s||Rl(),g||null,x)}let Ql=(()=>{class r{static#e=this.THROW_IF_NOT_FOUND=Ro;static#t=this.NULL=new zi;static create(d,g){if(Array.isArray(d))return Nf({name:""},g,d,"");{const x=d.name??"";return Nf({name:x},d.parent,d.providers,x)}}static#n=this.\u0275prov=Sn({token:r,providedIn:"any",factory:()=>Us(Po)});static#r=this.__NG_ELEMENT_ID__=-1}return r})();function Tp(r){return r.ngOriginalError}class Wc{constructor(){this._console=console}handleError(s){const d=this._findOriginalError(s);this._console.error("ERROR",s),d&&this._console.error("ORIGINAL ERROR",d)}_findOriginalError(s){let d=s&&Tp(s);for(;d&&Tp(d);)d=Tp(d);return d||null}}const uh=new On("",{providedIn:"root",factory:()=>Ei(Wc).handleError.bind(void 0)});let Pu=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=fm;static#t=this.__NG_ENV_ID__=d=>d}return r})();class yu extends Pu{constructor(s){super(),this._lView=s}onDestroy(s){return L(this._lView,s),()=>function $(r,s){if(null===r[fa])return;const d=r[fa].indexOf(s);-1!==d&&r[fa].splice(d,1)}(this._lView,s)}}function fm(){return new yu(Yt())}function _l(){return Ws(mi(),Yt())}function Ws(r,s){return new Co(ln(r,s))}let Co=(()=>{class r{constructor(d){this.nativeElement=d}static#e=this.__NG_ELEMENT_ID__=_l}return r})();function au(r){return r instanceof Co?r.nativeElement:r}function fc(r){return s=>{setTimeout(r,void 0,s)}}const qa=class yl extends ur.B{constructor(s=!1){super(),this.destroyRef=void 0,this.__isAsync=s,jc()&&(this.destroyRef=Ei(Pu,{optional:!0})??void 0)}emit(s){const d=Be(null);try{super.next(s)}finally{Be(d)}}subscribe(s,d,g){let x=s,I=d||(()=>null),N=g;if(s&&"object"==typeof s){const q=s;x=q.next?.bind(q),I=q.error?.bind(q),N=q.complete?.bind(q)}this.__isAsync&&(I=fc(I),x&&(x=fc(x)),N&&(N=fc(N)));const U=super.subscribe({next:x,error:I,complete:N});return s instanceof Ai.yU&&s.add(U),U}};function Ka(){return this._results[Symbol.iterator]()}class Ip{static#e=Symbol.iterator;get changes(){return this._changes??=new qa}constructor(s=!1){this._emitDistinctChangesOnly=s,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const d=Ip.prototype;d[Symbol.iterator]||(d[Symbol.iterator]=Ka)}get(s){return this._results[s]}map(s){return this._results.map(s)}filter(s){return this._results.filter(s)}find(s){return this._results.find(s)}reduce(s,d){return this._results.reduce(s,d)}forEach(s){this._results.forEach(s)}some(s){return this._results.some(s)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(s,d){this.dirty=!1;const g=function So(r){return r.flat(Number.POSITIVE_INFINITY)}(s);(this._changesDetected=!function Yc(r,s,d){if(r.length!==s.length)return!1;for(let g=0;g<r.length;g++){let x=r[g],I=s[g];if(d&&(x=d(x),I=d(I)),I!==x)return!1}return!0}(this._results,g,d))&&(this._results=g,this.length=g.length,this.last=g[this.length-1],this.first=g[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(s){this._onDirty=s}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function Qh(r){return!(128&~r.flags)}const S=new Map;let M=0;const ai="__ngContext__";function ks(r,s){pr(s)?(r[ai]=s[Ga],function fe(r){S.set(r[Ga],r)}(s)):r[ai]=s}function gm(r){return m_(r[dl])}function p_(r){return m_(r[Ni])}function m_(r){for(;null!==r&&!zr(r);)r=r[Ni];return r}let ym;function sf(r){ym=r}function od(){if(void 0!==ym)return ym;if(typeof document<"u")return document;throw new Zn(210,!1)}const my=new On("",{providedIn:"root",factory:()=>vm}),vm="ng",Jm=new On(""),y_=new On("",{providedIn:"platform",factory:()=>"unknown"}),_y=new On("",{providedIn:"root",factory:()=>od().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let eg=()=>null;function Mp(r,s,d=!1){return eg(r,s,d)}const Op=new On("",{providedIn:"root",factory:()=>!1});let kp,Im;function Ku(r){return function ag(){if(void 0===kp&&(kp=null,qn.trustedTypes))try{kp=qn.trustedTypes.createPolicy("angular",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return kp}()?.createHTML(r)||r}function cg(){if(void 0===Im&&(Im=null,qn.trustedTypes))try{Im=qn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Im}function df(r){return cg()?.createHTML(r)||r}function hf(r){return cg()?.createScriptURL(r)||r}class vh{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Er})`}}class b_ extends vh{getTypeName(){return"HTML"}}class Zc extends vh{getTypeName(){return"Style"}}class xy extends vh{getTypeName(){return"Script"}}class ug extends vh{getTypeName(){return"URL"}}class Sm extends vh{getTypeName(){return"ResourceURL"}}function Zu(r){return r instanceof vh?r.changingThisBreaksApplicationSecurity:r}function Ou(r,s){const d=function Yl(r){return r instanceof vh&&r.getTypeName()||null}(r);if(null!=d&&d!==s){if("ResourceURL"===d&&"URL"===s)return!0;throw new Error(`Required a safe ${s}, got a ${d} (see ${Er})`)}return d===s}function Np(r){return new b_(r)}function ld(r){return new Zc(r)}function Am(r){return new xy(r)}function Hf(r){return new ug(r)}function T_(r){return new Sm(r)}class Ey{constructor(s){this.inertDocumentHelper=s}getInertBodyElement(s){s="<body><remove></remove>"+s;try{const d=(new window.DOMParser).parseFromString(Ku(s),"text/html").body;return null===d?this.inertDocumentHelper.getInertBodyElement(s):(d.removeChild(d.firstChild),d)}catch{return null}}}class Bv{constructor(s){this.defaultDoc=s,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(s){const d=this.inertDocument.createElement("template");return d.innerHTML=Ku(s),d}}const Vv=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Cm(r){return(r=String(r)).match(Vv)?r:"unsafe:"+r}function cd(r){const s={};for(const d of r.split(","))s[d]=!0;return s}function ff(...r){const s={};for(const d of r)for(const g in d)d.hasOwnProperty(g)&&(s[g]=!0);return s}const dg=cd("area,br,col,hr,img,wbr"),I_=cd("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),hg=cd("rp,rt"),Wf=ff(dg,ff(I_,cd("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),ff(hg,cd("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ff(hg,I_)),fg=cd("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Jl=ff(fg,cd("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),cd("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Dd=cd("script,style,template");class S_{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(s){let d=s.firstChild,g=!0,x=[];for(;d;)if(d.nodeType===Node.ELEMENT_NODE?g=this.startElement(d):d.nodeType===Node.TEXT_NODE?this.chars(d.nodeValue):this.sanitizedSomething=!0,g&&d.firstChild)x.push(d),d=zv(d);else for(;d;){d.nodeType===Node.ELEMENT_NODE&&this.endElement(d);let I=xl(d);if(I){d=I;break}d=x.pop()}return this.buf.join("")}startElement(s){const d=Ty(s).toLowerCase();if(!Wf.hasOwnProperty(d))return this.sanitizedSomething=!0,!Dd.hasOwnProperty(d);this.buf.push("<"),this.buf.push(d);const g=s.attributes;for(let x=0;x<g.length;x++){const I=g.item(x),N=I.name,U=N.toLowerCase();if(!Jl.hasOwnProperty(U)){this.sanitizedSomething=!0;continue}let q=I.value;fg[U]&&(q=Cm(q)),this.buf.push(" ",N,'="',C_(q),'"')}return this.buf.push(">"),!0}endElement(s){const d=Ty(s).toLowerCase();Wf.hasOwnProperty(d)&&!dg.hasOwnProperty(d)&&(this.buf.push("</"),this.buf.push(d),this.buf.push(">"))}chars(s){this.buf.push(C_(s))}}function xl(r){const s=r.nextSibling;if(s&&r!==s.previousSibling)throw Bp(s);return s}function zv(r){const s=r.firstChild;if(s&&function Fp(r,s){return(r.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}(r,s))throw Bp(s);return s}function Ty(r){const s=r.nodeName;return"string"==typeof s?s:"FORM"}function Bp(r){return new Error(`Failed to sanitize html because the element is clobbered: ${r.outerHTML}`)}const jv=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,A_=/([^\#-~ |!])/g;function C_(r){return r.replace(/&/g,"&amp;").replace(jv,function(s){return"&#"+(1024*(s.charCodeAt(0)-55296)+(s.charCodeAt(1)-56320)+65536)+";"}).replace(A_,function(s){return"&#"+s.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let pf;function Vp(r,s){let d=null;try{pf=pf||function xh(r){const s=new Bv(r);return function wy(){try{return!!(new window.DOMParser).parseFromString(Ku(""),"text/html")}catch{return!1}}()?new Ey(s):s}(r);let g=s?String(s):"";d=pf.getInertBodyElement(g);let x=5,I=g;do{if(0===x)throw new Error("Failed to sanitize html because the input is unstable");x--,g=I,I=d.innerHTML,d=pf.getInertBodyElement(g)}while(g!==I);return Ku((new S_).sanitizeChildren(Fo(d)||d))}finally{if(d){const g=Fo(d)||d;for(;g.firstChild;)g.removeChild(g.firstChild)}}}function Fo(r){return"content"in r&&function pg(r){return r.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===r.nodeName}(r)?r.content:null}var Kd=function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r}(Kd||{});function Dm(r){const s=Rm();return s?df(s.sanitize(Kd.HTML,r)||""):Ou(r,"HTML")?df(Zu(r)):Vp(od(),fi(r))}function Md(r){const s=Rm();return s?s.sanitize(Kd.URL,r)||"":Ou(r,"URL")?Zu(r):Cm(fi(r))}function Mm(r){const s=Rm();if(s)return hf(s.sanitize(Kd.RESOURCE_URL,r)||"");if(Ou(r,"ResourceURL"))return hf(Zu(r));throw new Zn(904,!1)}function M_(r,s,d){return function Gv(r,s){return"src"===s&&("embed"===r||"frame"===r||"iframe"===r||"media"===r||"script"===r)||"href"===s&&("base"===r||"link"===r)?Mm:Md}(s,d)(r)}function Rm(){const r=Yt();return r&&r[fo].sanitizer}const Ay=/^>|^->|<!--|-->|--!>|<!-$/g,mg=/(<|>)/g,qf="\u200b$1\u200b";function k_(r){return r.ownerDocument.defaultView}function Lu(r){return r instanceof Function?r():r}var yf=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(yf||{});let Sg;function Ag(r,s){return Sg(r,s)}function vf(r,s,d,g,x){if(null!=g){let I,N=!1;zr(g)?I=g:pr(g)&&(N=!0,g=g[xs]);const U=It(g);0===r&&null!==d?null==x?Nm(s,d,U):Pd(s,d,U,x||null,!0):1===r&&null!==d?Pd(s,d,U,x||null,!0):2===r?function Ih(r,s,d){const g=Yf(r,s);g&&function wh(r,s,d,g){r.removeChild(s,d,g)}(r,g,s,d)}(s,U,N):3===r&&s.destroyNode(U),null!=I&&function Ah(r,s,d,g,x){const I=d[vo];I!==It(d)&&vf(s,r,g,I,x);for(let U=As;U<d.length;U++){const q=d[U];qp(q[lr],q,r,s,g,I)}}(s,r,I,d,x)}}function $p(r,s){return r.createComment(function R_(r){return r.replace(Ay,s=>s.replace(mg,qf))}(s))}function ud(r,s,d){return r.createElement(s,d)}function Zd(r,s){s[fo].changeDetectionScheduler?.notify(1),qp(r,s,s[Si],2,null,null)}function Dg(r,s){const d=r[Gs],g=d.indexOf(s);d.splice(g,1)}function dd(r,s){if(r.length<=As)return;const d=As+s,g=r[d];if(g){const x=g[Rc];null!==x&&x!==r&&Dg(x,g),s>0&&(r[d-1][Ni]=g[Ni]);const I=Ki(r,As+s);!function Cg(r,s){Zd(r,s),s[xs]=null,s[js]=null}(g[lr],g);const N=I[jo];null!==N&&N.detachView(I[lr]),g[Di]=null,g[Ni]=null,g[Kr]&=-129}return g}function Xd(r,s){if(!(256&s[Kr])){const d=s[Si];d.destroyNode&&qp(r,s,d,3,null,null),function L_(r){let s=r[dl];if(!s)return Ef(r[lr],r);for(;s;){let d=null;if(pr(s))d=s[dl];else{const g=s[As];g&&(d=g)}if(!d){for(;s&&!s[Ni]&&s!==r;)pr(s)&&Ef(s[lr],s),s=s[Di];null===s&&(s=r),pr(s)&&Ef(s[lr],s),d=s&&s[Ni]}s=d}}(s)}}function Ef(r,s){if(256&s[Kr])return;const d=Be(null);try{s[Kr]&=-129,s[Kr]|=256,s[Ss]&&function Xe(r){if(Ze(r),at(r))for(let s=0;s<r.producerNode.length;s++)Te(r.producerNode[s],r.producerIndexOfThis[s]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}(s[Ss]),function Kv(r,s){let d;if(null!=r&&null!=(d=r.destroyHooks))for(let g=0;g<d.length;g+=2){const x=s[d[g]];if(!(x instanceof nd)){const I=d[g+1];if(Array.isArray(I))for(let N=0;N<I.length;N+=2){const U=x[I[N]],q=I[N+1];pe(4,U,q);try{q.call(U)}finally{pe(5,U,q)}}else{pe(4,x,I);try{I.call(x)}finally{pe(5,x,I)}}}}}(r,s),function km(r,s){const d=r.cleanup,g=s[rl];if(null!==d)for(let I=0;I<d.length-1;I+=2)if("string"==typeof d[I]){const N=d[I+3];N>=0?g[N]():g[-N].unsubscribe(),I+=2}else d[I].call(g[d[I+1]]);null!==g&&(s[rl]=null);const x=s[fa];if(null!==x){s[fa]=null;for(let I=0;I<x.length;I++)(0,x[I])()}}(r,s),1===s[lr].type&&s[Si].destroy();const g=s[Rc];if(null!==g&&zr(s[Di])){g!==s[Di]&&Dg(g,s);const x=s[jo];null!==x&&x.detachView(r)}!function zt(r){S.delete(r[Ga])}(s)}finally{Be(d)}}function Gp(r,s,d){return function Ry(r,s,d){let g=s;for(;null!==g&&40&g.type;)g=(s=g).parent;if(null===g)return d[xs];{const{componentOffset:x}=g;if(x>-1){const{encapsulation:I}=r.data[g.directiveStart+x];if(I===Uo.None||I===Uo.Emulated)return null}return ln(g,d)}}(r,s.parent,d)}function Pd(r,s,d,g,x){r.insertBefore(s,d,g,x)}function Nm(r,s,d){r.appendChild(s,d)}function wf(r,s,d,g,x){null!==g?Pd(r,s,d,g,x):Nm(r,s,d)}function Yf(r,s){return r.parentNode(s)}function Rg(r,s,d){return Pg(r,s,d)}let bh,Pg=function B_(r,s,d){return 40&r.type?ln(r,d):null};function Od(r,s,d,g){const x=Gp(r,g,s),I=s[Si],U=Rg(g.parent||s[js],g,s);if(null!=x)if(Array.isArray(d))for(let q=0;q<d.length;q++)wf(I,x,d[q],U,!1);else wf(I,x,d,U,!1);void 0!==bh&&bh(I,g,s,d,x)}function Jf(r,s){if(null!==s){const d=s.type;if(3&d)return ln(s,r);if(4&d)return Th(-1,r[s.index]);if(8&d){const g=s.child;if(null!==g)return Jf(r,g);{const x=r[s.index];return zr(x)?Th(-1,x):It(x)}}if(32&d)return Ag(s,r)()||It(r[s.index]);{const g=Wp(r,s);return null!==g?Array.isArray(g)?g[0]:Jf(ee(r[Xs]),g):Jf(r,s.next)}}return null}function Wp(r,s){return null!==s?r[Xs][js].projection[s.projection]:null}function Th(r,s){const d=As+r+1;if(d<s.length){const g=s[d],x=g[lr].firstChild;if(null!==x)return Jf(g,x)}return s[vo]}function ep(r,s,d,g,x,I,N){for(;null!=d;){const U=g[d.index],q=d.type;if(N&&0===s&&(U&&ks(It(U),g),d.flags|=2),32&~d.flags)if(8&q)ep(r,s,d.child,g,x,I,!1),vf(s,r,x,U,I);else if(32&q){const ue=Ag(d,g);let Fe;for(;Fe=ue();)vf(s,r,x,Fe,I);vf(s,r,x,U,I)}else 16&q?Sh(r,s,g,d,x,I):vf(s,r,x,U,I);d=N?d.projectionNext:d.next}}function qp(r,s,d,g,x,I){ep(d,g,r.firstChild,s,x,I,!1)}function Sh(r,s,d,g,x,I){const N=d[Xs],q=N[js].projection[g.projection];if(Array.isArray(q))for(let ue=0;ue<q.length;ue++)vf(s,r,x,q[ue],I);else{let ue=q;const Fe=N[Di];Qh(g)&&(ue.flags|=128),ep(r,s,ue,Fe,x,I,!0)}}function If(r,s,d){""===d?r.removeAttribute(s,"class"):r.setAttribute(s,"class",d)}function tp(r,s,d){const{mergedAttrs:g,classes:x,styles:I}=d;null!==g&&ll(r,s,g),null!==x&&If(r,s,x),null!==I&&function kg(r,s,d){r.setAttribute(s,"style",d)}(r,s,I)}const Cs={};function np(r=1){U_(Tr(),Yt(),Ra()+r,!1)}function U_(r,s,d,g){if(!g)if(3&~s[Kr]){const I=r.preOrderHooks;null!==I&&Bh(s,I,0,d)}else{const I=r.preOrderCheckHooks;null!==I&&Vd(s,I,d)}nu(d)}function Kp(r,s=Nr.Default){const d=Yt();return null===d?Us(r,s):xp(mi(),d,Re(r),s)}function Lm(){throw new Error("invalid")}function Ng(r,s,d,g,x,I){const N=Be(null);try{let U=null;x&za.SignalBased&&(U=s[g][De]),null!==U&&void 0!==U.transformFn&&(I=U.transformFn(I)),x&za.HasDecoratorInputTransform&&(I=r.inputTransforms[g].call(s,I)),null!==r.setInput?r.setInput(s,U,I,d,g):P(s,U,g,I)}finally{Be(N)}}function Ch(r,s,d,g,x,I,N,U,q,ue,Fe){const dt=s.blueprint.slice();return dt[xs]=x,dt[Kr]=204|g,(null!==ue||r&&2048&r[Kr])&&(dt[Kr]|=2048),Wn(dt),dt[Di]=dt[Ol]=r,dt[qi]=d,dt[fo]=N||r&&r[fo],dt[Si]=U||r&&r[Si],dt[ca]=q||r&&r[ca]||null,dt[js]=I,dt[Ga]=function j(){return M++}(),dt[ea]=Fe,dt[ju]=ue,dt[Xs]=2==s.type?r[Xs]:dt,dt}function Dh(r,s,d,g,x){let I=r.data[s];if(null===I)I=function Zp(r,s,d,g,x){const I=Yr(),N=po(),q=r.data[s]=function Vm(r,s,d,g,x,I){let N=s?s.injectorIndex:-1,U=0;return kn()&&(U|=128),{type:d,index:g,insertBeforeIndex:null,injectorIndex:N,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:U,providerIndexes:0,value:x,attrs:I,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,N?I:I&&I.parent,d,s,g,x);return null===r.firstChild&&(r.firstChild=q),null!==I&&(N?null==I.child&&null!==q.parent&&(I.child=q):null===I.next&&(I.next=q,q.prev=I)),q}(r,s,d,g,x),function oo(){return Ee.lFrame.inI18n}()&&(I.flags|=32);else if(64&I.type){I.type=d,I.value=g,I.attrs=x;const N=function ri(){const r=Ee.lFrame,s=r.currentTNode;return r.isParent?s:s.parent}();I.injectorIndex=null===N?-1:N.injectorIndex}return Mi(I,!0),I}function rp(r,s,d,g){if(0===d)return-1;const x=s.length;for(let I=0;I<d;I++)s.push(g),r.blueprint.push(g),r.data.push(null);return x}function Xp(r,s,d,g,x){const I=Ra(),N=2&g;try{nu(-1),N&&s.length>Oi&&U_(r,s,Oi,!1),pe(N?2:0,x),d(g,x)}finally{nu(I),pe(N?3:1,x)}}function Qp(r,s,d){if($u(s)){const g=Be(null);try{const I=s.directiveEnd;for(let N=s.directiveStart;N<I;N++){const U=r.data[N];U.contentQueries&&U.contentQueries(1,d[N],N)}}finally{Be(g)}}}function hd(r,s,d){Rn()&&(function Vg(r,s,d,g){const x=d.directiveStart,I=d.directiveEnd;dr(d)&&function Gg(r,s,d){const g=ln(s,r),x=Fm(d);let N=16;d.signals?N=4096:d.onPush&&(N=64);const U=em(r,Ch(r,x,null,N,g,s,null,r[fo].rendererFactory.createRenderer(g,d),null,null,null));r[s.index]=U}(s,d,r.data[x+d.componentOffset]),r.firstCreatePass||Pf(d,s),ks(g,s);const N=d.initialInputs;for(let U=x;U<I;U++){const q=r.data[U],ue=ou(s,r,U,d);ks(ue,s),null!==N&&Hg(0,U-x,ue,q,0,N),Un(q)&&(an(d.index,s)[qi]=ou(s,r,U,d))}}(r,s,d,ln(d,s)),!(64&~d.flags)&&Ug(r,s,d))}function j_(r,s,d=ln){const g=s.localNames;if(null!==g){let x=s.index+1;for(let I=0;I<g.length;I+=2){const N=g[I+1],U=-1===N?d(s,r):r[N];r[x++]=U}}}function Fm(r){const s=r.tView;return null===s||s.incompleteFirstPass?r.tView=Lg(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):s}function Lg(r,s,d,g,x,I,N,U,q,ue,Fe){const dt=Oi+g,Wt=dt+x,rn=function Bm(r,s){const d=[];for(let g=0;g<s;g++)d.push(g<r?null:Cs);return d}(dt,Wt),vn="function"==typeof ue?ue():ue;return rn[lr]={type:r,blueprint:rn,template:d,queries:null,viewQuery:U,declTNode:s,data:rn.slice().fill(null,dt),bindingStartIndex:dt,expandoStartIndex:Wt,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof I?I():I,pipeRegistry:"function"==typeof N?N():N,firstChild:null,schemas:q,consts:vn,incompleteFirstPass:!1,ssrId:Fe}}let $_=()=>null;function Fg(r,s,d,g,x){for(let I in s){if(!s.hasOwnProperty(I))continue;const N=s[I];if(void 0===N)continue;g??={};let U,q=za.None;Array.isArray(N)?(U=N[0],q=N[1]):U=N;let ue=I;if(null!==x){if(!x.hasOwnProperty(I))continue;ue=x[I]}0===r?ky(g,d,ue,U,q):ky(g,d,ue,U)}return g}function ky(r,s,d,g,x){let I;r.hasOwnProperty(d)?(I=r[d]).push(s,g):I=r[d]=[s,g],void 0!==x&&I.push(x)}function Bu(r,s,d,g){if(Rn()){const x=null===g?null:{"":-1},I=function Fy(r,s){const d=r.directiveRegistry;let g=null,x=null;if(d)for(let I=0;I<d.length;I++){const N=d[I];if(Al(s,N.selectors,!1))if(g||(g=[]),Un(N))if(null!==N.findHostDirectiveDefs){const U=[];x=x||new Map,N.findHostDirectiveDefs(N,U,x),g.unshift(...U,N),zg(r,s,U.length)}else g.unshift(N),zg(r,s,0);else x=x||new Map,N.findHostDirectiveDefs?.(N,g,x),g.push(N)}return null===g?null:[g,x]}(r,d);let N,U;null===I?N=U=null:[N,U]=I,null!==N&&Mh(r,s,d,N,x,U),x&&function jg(r,s,d){if(s){const g=r.localNames=[];for(let x=0;x<s.length;x+=2){const I=d[s[x+1]];if(null==I)throw new Zn(-301,!1);g.push(s[x],I)}}}(d,g,x)}d.mergedAttrs=nc(d.mergedAttrs,d.attrs)}function Mh(r,s,d,g,x,I){for(let ue=0;ue<g.length;ue++)Ed(Pf(d,s),r,g[ue].type);!function $g(r,s,d){r.flags|=1,r.directiveStart=s,r.directiveEnd=s+d,r.providerIndexes=s}(d,r.data.length,g.length);for(let ue=0;ue<g.length;ue++){const Fe=g[ue];Fe.providersResolver&&Fe.providersResolver(Fe)}let N=!1,U=!1,q=rp(r,s,g.length,null);for(let ue=0;ue<g.length;ue++){const Fe=g[ue];d.mergedAttrs=nc(d.mergedAttrs,Fe.hostAttrs),Vy(r,d,s,q,Fe),By(q,Fe,x),null!==Fe.contentQueries&&(d.flags|=4),(null!==Fe.hostBindings||null!==Fe.hostAttrs||0!==Fe.hostVars)&&(d.flags|=64);const dt=Fe.type.prototype;!N&&(dt.ngOnChanges||dt.ngOnInit||dt.ngDoCheck)&&((r.preOrderHooks??=[]).push(d.index),N=!0),!U&&(dt.ngOnChanges||dt.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(d.index),U=!0),q++}!function Bg(r,s,d){const x=s.directiveEnd,I=r.data,N=s.attrs,U=[];let q=null,ue=null;for(let Fe=s.directiveStart;Fe<x;Fe++){const dt=I[Fe],Wt=d?d.get(dt):null,vn=Wt?Wt.outputs:null;q=Fg(0,dt.inputs,Fe,q,Wt?Wt.inputs:null),ue=Fg(1,dt.outputs,Fe,ue,vn);const Qn=null===q||null===N||el(s)?null:H_(q,Fe,N);U.push(Qn)}null!==q&&(q.hasOwnProperty("class")&&(s.flags|=8),q.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=U,s.inputs=q,s.outputs=ue}(r,d,I)}function Ug(r,s,d){const g=d.directiveStart,x=d.directiveEnd,I=d.index,N=function No(){return Ee.lFrame.currentDirectiveIndex}();try{nu(I);for(let U=g;U<x;U++){const q=r.data[U],ue=s[U];fl(U),(null!==q.hostBindings||0!==q.hostVars||null!==q.hostAttrs)&&Um(q,ue)}}finally{nu(-1),fl(N)}}function Um(r,s){null!==r.hostBindings&&r.hostBindings(1,s)}function zg(r,s,d){s.componentOffset=d,(r.components??=[]).push(s.index)}function By(r,s,d){if(d){if(s.exportAs)for(let g=0;g<s.exportAs.length;g++)d[s.exportAs[g]]=r;Un(s)&&(d[""]=r)}}function Vy(r,s,d,g,x){r.data[g]=x;const I=x.factory||(x.factory=Qa(x.type)),N=new nd(I,Un(x),Kp);r.blueprint[g]=N,d[g]=N,function Yp(r,s,d,g,x){const I=x.hostBindings;if(I){let N=r.hostBindingOpCodes;null===N&&(N=r.hostBindingOpCodes=[]);const U=~s.index;(function Ly(r){let s=r.length;for(;s>0;){const d=r[--s];if("number"==typeof d&&d<0)return d}return 0})(N)!=U&&N.push(U),N.push(d,g,I)}}(r,s,g,rp(r,d,x.hostVars,Cs),x)}function kd(r,s,d,g,x,I){const N=ln(r,s);!function pd(r,s,d,g,x,I,N){if(null==I)r.removeAttribute(s,x,d);else{const U=null==N?fi(I):N(I,g||"",x);r.setAttribute(s,x,U,d)}}(s[Si],N,I,r.value,d,g,x)}function Hg(r,s,d,g,x,I){const N=I[s];if(null!==N)for(let U=0;U<N.length;)Ng(g,d,N[U++],N[U++],N[U++],N[U++])}function H_(r,s,d){let g=null,x=0;for(;x<d.length;){const I=d[x];if(0!==I)if(5!==I){if("number"==typeof I)break;if(r.hasOwnProperty(I)){null===g&&(g=[]);const N=r[I];for(let U=0;U<N.length;U+=3)if(N[U]===s){g.push(I,N[U+1],N[U+2],d[x+1]);break}}x+=2}else x+=2;else x+=4}return g}function sp(r,s,d,g){return[r,!0,0,s,null,g,null,d,null,null]}function Jp(r,s){const d=r.contentQueries;if(null!==d){const g=Be(null);try{for(let x=0;x<d.length;x+=2){const N=d[x+1];if(-1!==N){const U=r.data[N];Cu(d[x]),U.contentQueries(2,s[N],N)}}}finally{Be(g)}}}function em(r,s){return r[dl]?r[Kl][Ni]=s:r[dl]=s,r[Kl]=s,s}function Sf(r,s,d){Cu(0);const g=Be(null);try{s(r,d)}finally{Be(g)}}function md(r){return r[rl]||(r[rl]=[])}function Yu(r){return r.cleanup||(r.cleanup=[])}function Af(r,s){const d=r[ca],g=d?d.get(Wc,null):null;g&&g.handleError(s)}function Ju(r,s,d,g,x){for(let I=0;I<d.length;){const N=d[I++],U=d[I++],q=d[I++];Ng(r.data[N],s[N],g,U,q,x)}}function vu(r,s,d){const g=Kt(s,r);!function Rd(r,s,d){r.setValue(s,d)}(r[Si],g,d)}function Kg(r,s){const d=an(s,r),g=d[lr];!function Uy(r,s){for(let d=s.length;d<r.blueprint.length;d++)s.push(r.blueprint[d])}(g,d);const x=d[xs];null!==x&&null===d[ea]&&(d[ea]=Mp(x,d[ca])),Rh(g,d,d[qi])}function Rh(r,s,d){kl(s);try{const g=r.viewQuery;null!==g&&Sf(1,g,d);const x=r.template;null!==x&&Xp(r,s,x,1,d),r.firstCreatePass&&(r.firstCreatePass=!1),s[jo]?.finishViewCreation(r),r.staticContentQueries&&Jp(r,s),r.staticViewQueries&&Sf(2,r.viewQuery,d);const I=r.components;null!==I&&function Zg(r,s){for(let d=0;d<s.length;d++)Kg(r,s[d])}(s,I)}catch(g){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),g}finally{s[Kr]&=-5,pa()}}function Df(r,s){return!s||null===s.firstChild||Qh(r)}function op(r,s,d,g=!0){const x=s[lr];if(function My(r,s,d,g){const x=As+g,I=d.length;g>0&&(d[x-1][Ni]=s),g<I-As?(s[Ni]=d[x],Ul(d,As+g,s)):(d.push(s),s[Ni]=null),s[Di]=d;const N=s[Rc];null!==N&&d!==N&&function F_(r,s){const d=r[Gs];s[Xs]!==s[Di][Di][Xs]&&(r[Kr]|=fu.HasTransplantedViews),null===d?r[Gs]=[s]:d.push(s)}(N,s);const U=s[jo];null!==U&&U.insertView(r),Br(s),s[Kr]|=128}(x,s,r,d),g){const N=Th(d,r),U=s[Si],q=Yf(U,r[vo]);null!==q&&function Qf(r,s,d,g,x,I){g[xs]=x,g[js]=s,qp(r,g,d,1,x,I)}(x,r[js],U,s,q,N)}const I=s[ea];null!==I&&null!==I.firstChild&&(I.firstChild=null)}function ap(r,s,d,g,x=!1){for(;null!==d;){const I=s[d.index];null!==I&&g.push(It(I)),zr(I)&&zy(I,g);const N=d.type;if(8&N)ap(r,s,d.child,g);else if(32&N){const U=Ag(d,s);let q;for(;q=U();)g.push(q)}else if(16&N){const U=Wp(s,d);if(Array.isArray(U))g.push(...U);else{const q=ee(s[Xs]);ap(q[lr],q,U,g,!0)}}d=x?d.projectionNext:d.next}return g}function zy(r,s){for(let d=As;d<r.length;d++){const g=r[d],x=g[lr].firstChild;null!==x&&ap(g[lr],g,x,s)}r[vo]!==r[xs]&&s.push(r[vo])}let Xg=[];const nm={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{R(r.lView)},consumerOnSignalRead(){this.lView[Ss]=this}},rm=100;function zm(r,s=!0,d=0){const g=r[fo],x=g.rendererFactory;x.begin?.();try{!function Qd(r,s){E(r,s);let d=0;for(;bi(r);){if(d===rm)throw new Zn(103,!1);d++,E(r,1)}}(r,d)}catch(N){throw s&&Af(r,N),N}finally{x.end?.(),g.inlineEffectRunner?.flush()}}function Jg(r,s,d,g){const x=s[Kr];if(!(256&~x))return;s[fo].inlineEffectRunner?.flush(),kl(s);let N=null,U=null;(function o(r){return 2!==r.type})(r)&&(U=function Qg(r){return r[Ss]??function jy(r){const s=Xg.pop()??Object.create(nm);return s.lView=r,s}(r)}(s),N=function ct(r){return r&&(r.nextProducerIndex=0),Be(r)}(U));try{Wn(s),function ps(r){return Ee.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==d&&Xp(r,s,d,2,g);const q=!(3&~x);if(q){const dt=r.preOrderCheckHooks;null!==dt&&Vd(s,dt,null)}else{const dt=r.preOrderHooks;null!==dt&&Bh(s,dt,0,null),$o(s,0)}if(function l(r){for(let s=gm(r);null!==s;s=p_(s)){if(!(s[Kr]&fu.HasTransplantedViews))continue;const d=s[Gs];for(let g=0;g<d.length;g++){Yn(d[g])}}}(s),t(s,0),null!==r.contentQueries&&Jp(r,s),q){const dt=r.contentCheckHooks;null!==dt&&Vd(s,dt)}else{const dt=r.contentHooks;null!==dt&&Bh(s,dt,1),$o(s,1)}!function z_(r,s){const d=r.hostBindingOpCodes;if(null!==d)try{for(let g=0;g<d.length;g++){const x=d[g];if(x<0)nu(~x);else{const I=x,N=d[++g],U=d[++g];Tc(N,I),U(2,s[I])}}}finally{nu(-1)}}(r,s);const ue=r.components;null!==ue&&b(s,ue,0);const Fe=r.viewQuery;if(null!==Fe&&Sf(2,Fe,g),q){const dt=r.viewCheckHooks;null!==dt&&Vd(s,dt)}else{const dt=r.viewHooks;null!==dt&&Bh(s,dt,2),$o(s,2)}if(!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),s[hl]){for(const dt of s[hl])dt();s[hl]=null}s[Kr]&=-73}catch(q){throw R(s),q}finally{null!==U&&(function Ue(r,s){if(Be(s),r&&void 0!==r.producerNode&&void 0!==r.producerIndexOfThis&&void 0!==r.producerLastReadVersion){if(at(r))for(let d=r.nextProducerIndex;d<r.producerNode.length;d++)Te(r.producerNode[d],r.producerIndexOfThis[d]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}(U,N),function Yg(r){r.lView[Ss]!==r&&(r.lView=null,Xg.push(r))}(U)),pa()}}function t(r,s){for(let d=gm(r);null!==d;d=p_(d))for(let g=As;g<d.length;g++)_(d[g],s)}function f(r,s,d){_(an(s,r),d)}function _(r,s){dn(r)&&E(r,s)}function E(r,s){const g=r[lr],x=r[Kr],I=r[Ss];let N=!!(0===s&&16&x);if(N||=!!(64&x&&0===s),N||=!!(1024&x),N||=!(!I?.dirty||!nt(I)),I&&(I.dirty=!1),r[Kr]&=-9217,N)Jg(g,r,g.template,r[qi]);else if(8192&x){t(r,1);const U=g.components;null!==U&&b(r,U,1)}}function b(r,s,d){for(let g=0;g<s.length;g++)f(r,s[g],d)}function A(r){for(r[fo].changeDetectionScheduler?.notify();r;){r[Kr]|=64;const s=ee(r);if(Ao(r)&&!s)return r;r=s}return null}class k{get rootNodes(){const s=this._lView,d=s[lr];return ap(d,s,d.firstChild,[])}constructor(s,d,g=!0){this._lView=s,this._cdRefInjectingView=d,this.notifyErrorHandler=g,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[qi]}set context(s){this._lView[qi]=s}get destroyed(){return!(256&~this._lView[Kr])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const s=this._lView[Di];if(zr(s)){const d=s[8],g=d?d.indexOf(this):-1;g>-1&&(dd(s,g),Ki(d,g))}this._attachedToViewContainer=!1}Xd(this._lView[lr],this._lView)}onDestroy(s){L(this._lView,s)}markForCheck(){A(this._cdRefInjectingView||this._lView)}detach(){this._lView[Kr]&=-129}reattach(){Br(this._lView),this._lView[Kr]|=128}detectChanges(){this._lView[Kr]|=1024,zm(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Zn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,Zd(this._lView[lr],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new Zn(902,!1);this._appRef=s,Br(this._lView)}}let F=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=ne}return r})();const G=F,J=class extends G{constructor(s,d,g){super(),this._declarationLView=s,this._declarationTContainer=d,this.elementRef=g}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(s,d){return this.createEmbeddedViewImpl(s,d)}createEmbeddedViewImpl(s,d,g){const x=function Cf(r,s,d,g){const x=Be(null);try{const I=s.tView,q=Ch(r,I,d,4096&r[Kr]?4096:16,null,s,null,null,g?.injector??null,g?.embeddedViewInjector??null,g?.dehydratedView??null);q[Rc]=r[s.index];const Fe=r[jo];return null!==Fe&&(q[jo]=Fe.createEmbeddedView(I)),Rh(I,q,d),q}finally{Be(x)}}(this._declarationLView,this._declarationTContainer,s,{embeddedViewInjector:d,dehydratedView:g});return new k(x)}};function ne(){return le(mi(),Yt())}function le(r,s){return 4&r.type?new J(s,r,Ws(r,s)):null}class pc{}class Ks{}class Fc{}class jm{resolveComponentFactory(s){throw function mc(r){const s=Error(`No component factory found for ${Q(r)}.`);return s.ngComponent=r,s}(s)}}let Ph=(()=>{class r{static#e=this.NULL=new jm}return r})();class q_{}let Gy=(()=>{class r{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function Qv(){const r=Yt(),d=an(mi().index,r);return(pr(d)?d:r)[Si]}()}return r})(),Hy=(()=>{class r{static#e=this.\u0275prov=Sn({token:r,providedIn:"root",factory:()=>null})}return r})();const $m={},xu=new Set;function Nd(r){xu.has(r)||(xu.add(r),performance?.mark?.("mark_feature_usage",{detail:{feature:r}}))}function Qc(...r){}class Do{constructor({enableLongStackTrace:s=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:g=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new qa(!1),this.onMicrotaskEmpty=new qa(!1),this.onStable=new qa(!1),this.onError=new qa(!1),typeof Zone>"u")throw new Zn(908,!1);Zone.assertZonePatched();const x=this;x._nesting=0,x._outer=x._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(x._inner=x._inner.fork(new Zone.TaskTrackingZoneSpec)),s&&Zone.longStackTraceZoneSpec&&(x._inner=x._inner.fork(Zone.longStackTraceZoneSpec)),x.shouldCoalesceEventChangeDetection=!g&&d,x.shouldCoalesceRunChangeDetection=g,x.lastRequestAnimationFrameId=-1,x.nativeRequestAnimationFrame=function Ld(){const r="function"==typeof qn.requestAnimationFrame;let s=qn[r?"requestAnimationFrame":"setTimeout"],d=qn[r?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&s&&d){const g=s[Zone.__symbol__("OriginalDelegate")];g&&(s=g);const x=d[Zone.__symbol__("OriginalDelegate")];x&&(d=x)}return{nativeRequestAnimationFrame:s,nativeCancelAnimationFrame:d}}().nativeRequestAnimationFrame,function Eu(r){const s=()=>{!function Vu(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(qn,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,Mf(r),r.isCheckStableRunning=!0,Z_(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),Mf(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(d,g,x,I,N,U)=>{if(function Wy(r){return!(!Array.isArray(r)||1!==r.length)&&!0===r[0].data?.__ignore_ng_zone__}(U))return d.invokeTask(x,I,N,U);try{return lp(r),d.invokeTask(x,I,N,U)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===I.type||r.shouldCoalesceRunChangeDetection)&&s(),X_(r)}},onInvoke:(d,g,x,I,N,U,q)=>{try{return lp(r),d.invoke(x,I,N,U,q)}finally{r.shouldCoalesceRunChangeDetection&&s(),X_(r)}},onHasTask:(d,g,x,I)=>{d.hasTask(x,I),g===x&&("microTask"==I.change?(r._hasPendingMicrotasks=I.microTask,Mf(r),Z_(r)):"macroTask"==I.change&&(r.hasPendingMacrotasks=I.macroTask))},onHandleError:(d,g,x,I)=>(d.handleError(x,I),r.runOutsideAngular(()=>r.onError.emit(I)),!1)})}(x)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Do.isInAngularZone())throw new Zn(909,!1)}static assertNotInAngularZone(){if(Do.isInAngularZone())throw new Zn(909,!1)}run(s,d,g){return this._inner.run(s,d,g)}runTask(s,d,g,x){const I=this._inner,N=I.scheduleEventTask("NgZoneEvent: "+x,s,sm,Qc,Qc);try{return I.runTask(N,d,g)}finally{I.cancelTask(N)}}runGuarded(s,d,g){return this._inner.runGuarded(s,d,g)}runOutsideAngular(s){return this._outer.run(s)}}const sm={};function Z_(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function Mf(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function lp(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function X_(r){r._nesting--,Z_(r)}class Uu{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new qa,this.onMicrotaskEmpty=new qa,this.onStable=new qa,this.onError=new qa}run(s,d,g){return s.apply(d,g)}runGuarded(s,d,g){return s.apply(d,g)}runOutsideAngular(s){return s()}runTask(s,d,g,x){return s.apply(d,g)}}var om=function(r){return r[r.EarlyRead=0]="EarlyRead",r[r.Write=1]="Write",r[r.MixedReadWrite=2]="MixedReadWrite",r[r.Read=3]="Read",r}(om||{});const qy={destroy(){}};function Ky(r,s){!s&&function W(r){if(!jc())throw new Zn(-203,!1)}();const d=s?.injector??Ei(Ql);if(!function cu(r){return"browser"===(r??Ei(Ql)).get(y_)}(d))return qy;Nd("NgAfterNextRender");const g=d.get(e_),x=g.handler??=new Xy,I=s?.phase??om.MixedReadWrite,N=()=>{x.unregister(q),U()},U=d.get(Pu).onDestroy(N),q=Da(d,()=>new Zy(I,()=>{N(),r()}));return x.register(q),{destroy:N}}class Zy{constructor(s,d){this.phase=s,this.callbackFn=d,this.zone=Ei(Do),this.errorHandler=Ei(Wc,{optional:!0}),Ei(pc,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(s){this.errorHandler?.handleError(s)}}}class Xy{constructor(){this.executingCallbacks=!1,this.buckets={[om.EarlyRead]:new Set,[om.Write]:new Set,[om.MixedReadWrite]:new Set,[om.Read]:new Set},this.deferredCallbacks=new Set}register(s){(this.executingCallbacks?this.deferredCallbacks:this.buckets[s.phase]).add(s)}unregister(s){this.buckets[s.phase].delete(s),this.deferredCallbacks.delete(s)}execute(){this.executingCallbacks=!0;for(const s of Object.values(this.buckets))for(const d of s)d.invoke();this.executingCallbacks=!1;for(const s of this.deferredCallbacks)this.buckets[s.phase].add(s);this.deferredCallbacks.clear()}destroy(){for(const s of Object.values(this.buckets))s.clear();this.deferredCallbacks.clear()}}let e_=(()=>{class r{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const d=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const g of d)g()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=Sn({token:r,providedIn:"root",factory:()=>new r})}return r})();function up(r){return!!uo(r)}function ty(r,s,d){let g=d?r.styles:null,x=d?r.classes:null,I=0;if(null!==s)for(let N=0;N<s.length;N++){const U=s[N];"number"==typeof U?I=U:1==I?x=oe(x,U):2==I&&(g=oe(g,U+": "+s[++N]+";"))}d?r.styles=g:r.stylesWithoutHost=g,d?r.classes=x:r.classesWithoutHost=x}class Jy extends Ph{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){const d=Bi(s);return new ry(d,this.ngModule)}}function n_(r){const s=[];for(const d in r){if(!r.hasOwnProperty(d))continue;const g=r[d];void 0!==g&&s.push({propName:Array.isArray(g)?g[0]:g,templateName:d})}return s}class ny{constructor(s,d){this.injector=s,this.parentInjector=d}get(s,d,g){g=Il(g);const x=this.injector.get(s,$m,g);return x!==$m||d===$m?x:this.parentInjector.get(s,d,g)}}class ry extends Fc{get inputs(){const s=this.componentDef,d=s.inputTransforms,g=n_(s.inputs);if(null!==d)for(const x of g)d.hasOwnProperty(x.propName)&&(x.transform=d[x.propName]);return g}get outputs(){return n_(this.componentDef.outputs)}constructor(s,d){super(),this.componentDef=s,this.ngModule=d,this.componentType=s.type,this.selector=function zo(r){return r.map($l).join(",")}(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!d}create(s,d,g,x){const I=Be(null);try{let N=(x=x||this.ngModule)instanceof ho?x:x?.injector;N&&null!==this.componentDef.getStandaloneInjector&&(N=this.componentDef.getStandaloneInjector(N)||N);const U=N?new ny(s,N):s,q=U.get(q_,null);if(null===q)throw new Zn(407,!1);const ue=U.get(Hy,null),Wt={rendererFactory:q,sanitizer:ue,inlineEffectRunner:null,afterRenderEventManager:U.get(e_,null),changeDetectionScheduler:U.get(pc,null)},rn=q.createRenderer(null,this.componentDef),vn=this.componentDef.selectors[0][0]||"div",Qn=g?function Py(r,s,d,g){const I=g.get(Op,!1)||d===Uo.ShadowDom,N=r.selectRootElement(s,I);return function Oy(r){$_(r)}(N),N}(rn,g,this.componentDef.encapsulation,U):ud(rn,vn,function am(r){const s=r.toLowerCase();return"svg"===s?he:"math"===s?"math":null}(vn));let Dr=512;this.componentDef.signals?Dr|=4096:this.componentDef.onPush||(Dr|=16);let Jr=null;null!==Qn&&(Jr=Mp(Qn,U,!0));const fr=Lg(0,null,null,1,0,null,null,null,null,null,null),Es=Ch(null,fr,null,Dr,null,null,Wt,rn,U,null,Jr);let na,ol;kl(Es);try{const Tu=this.componentDef;let th,Ov=null;Tu.findHostDirectiveDefs?(th=[],Ov=new Map,Tu.findHostDirectiveDefs(Tu,th,Ov),th.push(Tu)):th=[Tu];const a1=function aw(r,s){const d=r[lr],g=Oi;return r[g]=s,Dh(d,g,2,"#host",null)}(Es,Qn),UM=function lw(r,s,d,g,x,I,N){const U=x[lr];!function n0(r,s,d,g){for(const x of r)s.mergedAttrs=nc(s.mergedAttrs,x.hostAttrs);null!==s.mergedAttrs&&(ty(s,s.mergedAttrs,!0),null!==d&&tp(g,d,s))}(g,r,s,N);let q=null;null!==s&&(q=Mp(s,x[ca]));const ue=I.rendererFactory.createRenderer(s,d);let Fe=16;d.signals?Fe=4096:d.onPush&&(Fe=64);const dt=Ch(x,Fm(d),null,Fe,x[r.index],r,I,ue,null,null,q);return U.firstCreatePass&&zg(U,r,g.length-1),em(x,dt),x[r.index]=dt}(a1,Qn,Tu,th,Es,Wt,rn);ol=cn(fr,Oi),Qn&&function ev(r,s,d,g){if(g)ll(r,d,["ng-version","17.3.1"]);else{const{attrs:x,classes:I}=function yc(r){const s=[],d=[];let g=1,x=2;for(;g<r.length;){let I=r[g];if("string"==typeof I)2===x?""!==I&&s.push(I,r[++g]):8===x&&d.push(I);else{if(!wo(x))break;x=I}g++}return{attrs:s,classes:d}}(s.selectors[0]);x&&ll(r,d,x),I&&I.length>0&&If(r,d,I.join(" "))}}(rn,Tu,Qn,g),void 0!==d&&function zx(r,s,d){const g=r.projection=[];for(let x=0;x<s.length;x++){const I=d[x];g.push(null!=I?Array.from(I):null)}}(ol,this.ngContentSelectors,d),na=function Ux(r,s,d,g,x,I){const N=mi(),U=x[lr],q=ln(N,x);Mh(U,x,N,d,null,g);for(let Fe=0;Fe<d.length;Fe++)ks(ou(x,U,N.directiveStart+Fe,N),x);Ug(U,x,N),q&&ks(q,x);const ue=ou(x,U,N.directiveStart+N.componentOffset,N);if(r[qi]=x[qi]=ue,null!==I)for(const Fe of I)Fe(ue,s);return Qp(U,N,x),ue}(UM,Tu,th,Ov,Es,[jx]),Rh(fr,Es,null)}finally{pa()}return new r_(this.componentType,na,Ws(ol,Es),Es,ol)}finally{Be(I)}}}class r_ extends Ks{constructor(s,d,g,x,I){super(),this.location=g,this._rootLView=x,this._tNode=I,this.previousInputValues=null,this.instance=d,this.hostView=this.changeDetectorRef=new k(x,void 0,!1),this.componentType=s}setInput(s,d){const g=this._tNode.inputs;let x;if(null!==g&&(x=g[s])){if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),d))return;const I=this._rootLView;Ju(I[lr],I,x,s,d),this.previousInputValues.set(s,d),A(an(this._tNode.index,I))}}get injector(){return new Wa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}}function jx(){const r=mi();Sc(Yt()[lr],r)}let Gm=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=$x}return r})();function $x(){return s0(mi(),Yt())}const Gx=Gm,iy=class extends Gx{constructor(s,d,g){super(),this._lContainer=s,this._hostTNode=d,this._hostLView=g}get element(){return Ws(this._hostTNode,this._hostLView)}get injector(){return new Wa(this._hostTNode,this._hostLView)}get parentInjector(){const s=Gh(this._hostTNode,this._hostLView);if(rd(s)){const d=ih(s,this._hostLView),g=iu(s);return new Wa(d[lr].data[g+8],d)}return new Wa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){const d=V0(this._lContainer);return null!==d&&d[s]||null}get length(){return this._lContainer.length-As}createEmbeddedView(s,d,g){let x,I;"number"==typeof g?x=g:null!=g&&(x=g.index,I=g.injector);const U=s.createEmbeddedViewImpl(d||{},I,null);return this.insertImpl(U,x,Df(this._hostTNode,null)),U}createComponent(s,d,g,x,I){const N=s&&!function Ar(r){return"function"==typeof r}(s);let U;if(N)U=d;else{const vn=d||{};U=vn.index,g=vn.injector,x=vn.projectableNodes,I=vn.environmentInjector||vn.ngModuleRef}const q=N?s:new ry(Bi(s)),ue=g||this.parentInjector;if(!I&&null==q.ngModule){const Qn=(N?ue:this.parentInjector).get(ho,null);Qn&&(I=Qn)}Bi(q.componentType??{});const rn=q.create(ue,x,null,I);return this.insertImpl(rn.hostView,U,Df(this._hostTNode,null)),rn}insert(s,d){return this.insertImpl(s,d,!0)}insertImpl(s,d,g){const x=s._lView;if(function Ln(r){return zr(r[Di])}(x)){const U=this.indexOf(s);if(-1!==U)this.detach(U);else{const q=x[Di],ue=new iy(q,q[js],q[Di]);ue.detach(ue.indexOf(s))}}const I=this._adjustIndex(d),N=this._lContainer;return op(N,x,I,g),s.attachToViewContainerRef(),Ul(r0(N),I,s),s}move(s,d){return this.insert(s,d)}indexOf(s){const d=V0(this._lContainer);return null!==d?d.indexOf(s):-1}remove(s){const d=this._adjustIndex(s,-1),g=dd(this._lContainer,d);g&&(Ki(r0(this._lContainer),d),Xd(g[lr],g))}detach(s){const d=this._adjustIndex(s,-1),g=dd(this._lContainer,d);return g&&null!=Ki(r0(this._lContainer),d)?new k(g):null}_adjustIndex(s,d=0){return s??this.length+d}};function V0(r){return r[8]}function r0(r){return r[8]||(r[8]=[])}function s0(r,s){let d;const g=s[r.index];return zr(g)?d=g:(d=sp(g,s,null,r),s[r.index]=d,em(s,d)),o0(d,s,r,g),new iy(d,r,s)}let o0=function nv(r,s,d,g){if(r[vo])return;let x;x=8&d.type?It(g):function U0(r,s){const d=r[Si],g=d.createComment(""),x=ln(s,r);return Pd(d,Yf(d,x),g,function Mg(r,s){return r.nextSibling(s)}(d,x),!1),g}(s,d),r[vo]=x},tv=()=>!1;class z0{constructor(s){this.queryList=s,this.matches=null}clone(){return new z0(this.queryList)}setDirty(){this.queryList.setDirty()}}class l0{constructor(s=[]){this.queries=s}createEmbeddedView(s){const d=s.queries;if(null!==d){const g=null!==s.contentQueries?s.contentQueries[0]:d.length,x=[];for(let I=0;I<g;I++){const N=d.getByIndex(I);x.push(this.queries[N.indexInDeclarationView].clone())}return new l0(x)}return null}insertView(s){this.dirtyQueriesWithMatches(s)}detachView(s){this.dirtyQueriesWithMatches(s)}finishViewCreation(s){this.dirtyQueriesWithMatches(s)}dirtyQueriesWithMatches(s){for(let d=0;d<this.queries.length;d++)null!==iv(s,d).matches&&this.queries[d].setDirty()}}class Wx{constructor(s,d,g=null){this.flags=d,this.read=g,this.predicate="string"==typeof s?function Kx(r){return r.split(",").map(s=>s.trim())}(s):s}}class j0{constructor(s=[]){this.queries=s}elementStart(s,d){for(let g=0;g<this.queries.length;g++)this.queries[g].elementStart(s,d)}elementEnd(s){for(let d=0;d<this.queries.length;d++)this.queries[d].elementEnd(s)}embeddedTView(s){let d=null;for(let g=0;g<this.length;g++){const x=null!==d?d.length:0,I=this.getByIndex(g).embeddedTView(s,x);I&&(I.indexInDeclarationView=g,null!==d?d.push(I):d=[I])}return null!==d?new j0(d):null}template(s,d){for(let g=0;g<this.queries.length;g++)this.queries[g].template(s,d)}getByIndex(s){return this.queries[s]}get length(){return this.queries.length}track(s){this.queries.push(s)}}class hp{constructor(s,d=-1){this.metadata=s,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=d}elementStart(s,d){this.isApplyingToNode(d)&&this.matchTNode(s,d)}elementEnd(s){this._declarationNodeIndex===s.index&&(this._appliesToNextNode=!1)}template(s,d){this.elementStart(s,d)}embeddedTView(s,d){return this.isApplyingToNode(s)?(this.crossesNgTemplate=!0,this.addMatch(-s.index,d),new hp(this.metadata)):null}isApplyingToNode(s){if(this._appliesToNextNode&&1&~this.metadata.flags){const d=this._declarationNodeIndex;let g=s.parent;for(;null!==g&&8&g.type&&g.index!==d;)g=g.parent;return d===(null!==g?g.index:-1)}return this._appliesToNextNode}matchTNode(s,d){const g=this.metadata.predicate;if(Array.isArray(g))for(let x=0;x<g.length;x++){const I=g[x];this.matchTNodeWithReadOption(s,d,fp(d,I)),this.matchTNodeWithReadOption(s,d,ah(d,s,I,!1,!1))}else g===F?4&d.type&&this.matchTNodeWithReadOption(s,d,-1):this.matchTNodeWithReadOption(s,d,ah(d,s,g,!1,!1))}matchTNodeWithReadOption(s,d,g){if(null!==g){const x=this.metadata.read;if(null!==x)if(x===Co||x===Gm||x===F&&4&d.type)this.addMatch(d.index,-2);else{const I=ah(d,s,x,!1,!1);null!==I&&this.addMatch(d.index,I)}else this.addMatch(d.index,g)}}addMatch(s,d){null===this.matches?this.matches=[s,d]:this.matches.push(s,d)}}function fp(r,s){const d=r.localNames;if(null!==d)for(let g=0;g<d.length;g+=2)if(d[g]===s)return d[g+1];return null}function lm(r,s,d,g){return-1===d?function sy(r,s){return 11&r.type?Ws(r,s):4&r.type?le(r,s):null}(s,r):-2===d?function qx(r,s,d){return d===Co?Ws(s,r):d===F?le(s,r):d===Gm?s0(s,r):void 0}(r,s,g):ou(r,r[lr],d,s)}function c0(r,s,d,g){const x=s[jo].queries[g];if(null===x.matches){const I=r.data,N=d.matches,U=[];for(let q=0;null!==N&&q<N.length;q+=2){const ue=N[q];U.push(ue<0?null:lm(s,I[ue],N[q+1],d.metadata.read))}x.matches=U}return x.matches}function u0(r,s,d,g){const x=r.queries.getByIndex(d),I=x.matches;if(null!==I){const N=c0(r,s,x,d);for(let U=0;U<I.length;U+=2){const q=I[U];if(q>0)g.push(N[U/2]);else{const ue=I[U+1],Fe=s[-q];for(let dt=As;dt<Fe.length;dt++){const Wt=Fe[dt];Wt[Rc]===Wt[Di]&&u0(Wt[lr],Wt,ue,g)}if(null!==Fe[Gs]){const dt=Fe[Gs];for(let Wt=0;Wt<dt.length;Wt++){const rn=dt[Wt];u0(rn[lr],rn,ue,g)}}}}}return g}function $0(r,s,d){const g=new Ip(!(4&~d));return function Xv(r,s,d,g){const x=md(s);x.push(d),r.firstCreatePass&&Yu(r).push(g,x.length-1)}(r,s,g,g.destroy),(s[jo]??=new l0).queries.push(new z0(g))-1}function W0(r,s,d){null===r.queries&&(r.queries=new j0),r.queries.track(new hp(s,d))}function iv(r,s){return r.queries.getByIndex(s)}function K0(r,s){const d=r[lr],g=iv(d,s);return g.crossesNgTemplate?u0(d,r,s,[]):c0(d,r,g,s)}function cm(r){const s=r.inputConfig,d={};for(const g in s)if(s.hasOwnProperty(g)){const x=s[g];Array.isArray(x)&&x[3]&&(d[g]=x[3])}r.inputTransforms=d}class mp{}class um{}function rE(r,s){return new _0(r,s??null,[])}class _0 extends mp{constructor(s,d,g){super(),this._parent=d,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Jy(this);const x=uo(s);this._bootstrapComponents=Lu(x.bootstrap),this._r3Injector=jd(s,d,[{provide:mp,useValue:this},{provide:Ph,useValue:this.componentFactoryResolver},...g],Q(s),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(s)}get injector(){return this._r3Injector}destroy(){const s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(d=>d()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}}class y0 extends um{constructor(s){super(),this.moduleType=s}create(s){return new _0(this.moduleType,s,[])}}class ux extends mp{constructor(s){super(),this.componentFactoryResolver=new Jy(this),this.instance=null;const d=new $a([...s.providers,{provide:mp,useValue:this},{provide:Ph,useValue:this.componentFactoryResolver}],s.parent||Rl(),s.debugName,new Set(["environment"]));this.injector=d,s.runEnvironmentInitializers&&d.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}}function ly(r,s,d=null){return new ux({providers:r,parent:s,debugName:d,runEnvironmentInitializers:!0}).injector}let Km=(()=>{class r{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ri.t(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const d=this.taskId++;return this.pendingTasks.add(d),d}remove(d){this.pendingTasks.delete(d),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function uv(r){return!!x0(r)&&(Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r)}function x0(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Dc(r,s,d){return!Object.is(r[s],d)&&(r[s]=d,!0)}function T(r,s,d,g,x,I,N,U){const q=Yt(),ue=Tr(),Fe=r+Oi,dt=ue.firstCreatePass?function v(r,s,d,g,x,I,N,U,q){const ue=s.consts,Fe=Dh(s,r,4,N||null,Nn(ue,U));Bu(s,d,Fe,Nn(ue,q)),Sc(s,Fe);const dt=Fe.tView=Lg(2,Fe,g,x,I,s.directiveRegistry,s.pipeRegistry,null,s.schemas,ue,null);return null!==s.queries&&(s.queries.template(s,Fe),dt.queries=s.queries.embeddedTView(Fe)),Fe}(Fe,ue,q,s,d,g,x,I,N):ue.data[Fe];Mi(dt,!1);const Wt=D(ue,q,dt,r);ii()&&Od(ue,q,Wt,dt),ks(Wt,q);const rn=sp(Wt,q,Wt,dt);return q[Fe]=rn,em(q,rn),function a0(r,s,d){return tv(r,s,d)}(rn,dt,q),xn(dt)&&hd(ue,q,dt),null!=N&&j_(q,dt,U),T}let D=function X(r,s,d,g){return Ll(!0),s[Si].createComment("")};function mE(r,s,d,g){const x=Yt();return Dc(x,Ma(),s)&&(Tr(),kd(bo(),x,r,s,d,g)),mE}function vv(r,s,d,g,x,I){const U=function u(r,s,d,g){const x=Dc(r,s,d);return Dc(r,s+1,g)||x}(r,function ko(){return Ee.lFrame.bindingIndex}(),d,x);return xo(2),U?s+fi(d)+g+fi(x)+I:Cs}function mx(r,s){return r<<17|s<<2}function u_(r){return r>>17&32767}function gE(r){return 2|r}function cy(r){return(131068&r)>>2}function _E(r,s){return-131069&r|s<<2}function yE(r){return 1|r}function Jw(r,s,d,g){const x=r[d+1],I=null===s;let N=g?u_(x):cy(x),U=!1;for(;0!==N&&(!1===U||I);){const ue=r[N+1];X1(r[N],s)&&(U=!0,r[N+1]=g?yE(ue):gE(ue)),N=g?u_(ue):cy(ue)}U&&(r[d+1]=g?gE(x):yE(x))}function X1(r,s){return null===r||null==s||(Array.isArray(r)?r[1]:r)===s||!(!Array.isArray(r)||"string"!=typeof s)&&Ya(r,s)>=0}const wu={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function eb(r){return r.substring(wu.key,wu.keyEnd)}function Q1(r){return r.substring(wu.value,wu.valueEnd)}function tb(r,s){const d=wu.textEnd;return d===s?-1:(s=wu.keyEnd=function eS(r,s,d){for(;s<d&&r.charCodeAt(s)>32;)s++;return s}(r,wu.key=s,d),Sv(r,s,d))}function nb(r,s){const d=wu.textEnd;let g=wu.key=Sv(r,s,d);return d===g?-1:(g=wu.keyEnd=function tS(r,s,d){let g;for(;s<d&&(45===(g=r.charCodeAt(s))||95===g||(-33&g)>=65&&(-33&g)<=90||g>=48&&g<=57);)s++;return s}(r,g,d),g=ib(r,g,d),g=wu.value=Sv(r,g,d),g=wu.valueEnd=function nS(r,s,d){let g=-1,x=-1,I=-1,N=s,U=N;for(;N<d;){const q=r.charCodeAt(N++);if(59===q)return U;34===q||39===q?U=N=sb(r,q,N,d):s===N-4&&85===I&&82===x&&76===g&&40===q?U=N=sb(r,41,N,d):q>32&&(U=N),I=x,x=g,g=-33&q}return U}(r,g,d),ib(r,g,d))}function rb(r){wu.key=0,wu.keyEnd=0,wu.value=0,wu.valueEnd=0,wu.textEnd=r.length}function Sv(r,s,d){for(;s<d&&r.charCodeAt(s)<=32;)s++;return s}function ib(r,s,d,g){return(s=Sv(r,s,d))<d&&s++,s}function sb(r,s,d,g){let x=-1,I=d;for(;I<g;){const N=r.charCodeAt(I++);if(N==s&&92!==x)return I;x=92==N&&92===x?0:N}throw new Error}function vE(r,s,d){const g=Yt();return Dc(g,Ma(),s)&&function Xc(r,s,d,g,x,I,N,U){const q=ln(s,d);let Fe,ue=s.inputs;!U&&null!=ue&&(Fe=ue[g])?(Ju(r,d,Fe,g,x),dr(s)&&function Fu(r,s){const d=an(s,r);16&d[Kr]||(d[Kr]|=64)}(d,s.index)):3&s.type&&(g=function Ny(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(g),x=null!=N?N(x,s.value||"",g):x,I.setProperty(q,g,x))}(Tr(),bo(),g,r,s,g[Si],d,!1),vE}function xE(r,s,d,g,x){const N=x?"class":"style";Ju(r,d,s.inputs[N],N,g)}function EE(r,s,d){return _p(r,s,d,!1),EE}function wE(r,s){return _p(r,s,null,!0),wE}function gp(r){yp(cb,rS,r,!1)}function rS(r,s){for(let d=function J1(r){return rb(r),nb(r,Sv(r,0,wu.textEnd))}(s);d>=0;d=nb(s,d))cb(r,eb(s),Q1(s))}function ob(r){yp(cS,hm,r,!0)}function hm(r,s){for(let d=function Y1(r){return rb(r),tb(r,Sv(r,0,wu.textEnd))}(s);d>=0;d=tb(s,d))Vo(r,eb(s),!0)}function _p(r,s,d,g){const x=Yt(),I=Tr(),N=xo(2);I.firstUpdatePass&&lb(I,r,N,g),s!==Cs&&Dc(x,N,s)&&ub(I,I.data[Ra()],x,x[Si],r,x[N+1]=function dS(r,s){return null==r||""===r||("string"==typeof s?r+=s:"object"==typeof r&&(r=Q(Zu(r)))),r}(s,d),g,N)}function yp(r,s,d,g){const x=Tr(),I=xo(2);x.firstUpdatePass&&lb(x,null,I,g);const N=Yt();if(d!==Cs&&Dc(N,I,d)){const U=x.data[Ra()];if(hb(U,g)&&!ab(x,I)){let q=g?U.classesWithoutHost:U.stylesWithoutHost;null!==q&&(d=oe(q,d||"")),xE(x,U,N,d,g)}else!function uS(r,s,d,g,x,I,N,U){x===Cs&&(x=si);let q=0,ue=0,Fe=0<x.length?x[0]:null,dt=0<I.length?I[0]:null;for(;null!==Fe||null!==dt;){const Wt=q<x.length?x[q+1]:void 0,rn=ue<I.length?I[ue+1]:void 0;let Qn,vn=null;Fe===dt?(q+=2,ue+=2,Wt!==rn&&(vn=dt,Qn=rn)):null===dt||null!==Fe&&Fe<dt?(q+=2,vn=Fe):(ue+=2,vn=dt,Qn=rn),null!==vn&&ub(r,s,d,g,vn,Qn,N,U),Fe=q<x.length?x[q]:null,dt=ue<I.length?I[ue]:null}}(x,U,N,N[Si],N[I+1],N[I+1]=function lS(r,s,d){if(null==d||""===d)return si;const g=[],x=Zu(d);if(Array.isArray(x))for(let I=0;I<x.length;I++)r(g,x[I],!0);else if("object"==typeof x)for(const I in x)x.hasOwnProperty(I)&&r(g,I,x[I]);else"string"==typeof x&&s(g,x);return g}(r,s,d),g,I)}}function ab(r,s){return s>=r.expandoStartIndex}function lb(r,s,d,g){const x=r.data;if(null===x[d+1]){const I=x[Ra()],N=ab(r,d);hb(I,g)&&null===s&&!N&&(s=!1),s=function iS(r,s,d,g){const x=function mu(r){const s=Ee.lFrame.currentDirectiveIndex;return-1===s?null:r[s]}(r);let I=g?s.residualClasses:s.residualStyles;if(null===x)0===(g?s.classBindings:s.styleBindings)&&(d=w0(d=bE(null,r,s,d,g),s.attrs,g),I=null);else{const N=s.directiveStylingLast;if(-1===N||r[N]!==x)if(d=bE(x,r,s,d,g),null===I){let q=function sS(r,s,d){const g=d?s.classBindings:s.styleBindings;if(0!==cy(g))return r[u_(g)]}(r,s,g);void 0!==q&&Array.isArray(q)&&(q=bE(null,r,s,q[1],g),q=w0(q,s.attrs,g),function oS(r,s,d,g){r[u_(d?s.classBindings:s.styleBindings)]=g}(r,s,g,q))}else I=function aS(r,s,d){let g;const x=s.directiveEnd;for(let I=1+s.directiveStylingLast;I<x;I++)g=w0(g,r[I].hostAttrs,d);return w0(g,s.attrs,d)}(r,s,g)}return void 0!==I&&(g?s.residualClasses=I:s.residualStyles=I),d}(x,I,s,g),function K1(r,s,d,g,x,I){let N=I?s.classBindings:s.styleBindings,U=u_(N),q=cy(N);r[g]=d;let Fe,ue=!1;if(Array.isArray(d)?(Fe=d[1],(null===Fe||Ya(d,Fe)>0)&&(ue=!0)):Fe=d,x)if(0!==q){const Wt=u_(r[U+1]);r[g+1]=mx(Wt,U),0!==Wt&&(r[Wt+1]=_E(r[Wt+1],g)),r[U+1]=function W1(r,s){return 131071&r|s<<17}(r[U+1],g)}else r[g+1]=mx(U,0),0!==U&&(r[U+1]=_E(r[U+1],g)),U=g;else r[g+1]=mx(q,0),0===U?U=g:r[q+1]=_E(r[q+1],g),q=g;ue&&(r[g+1]=gE(r[g+1])),Jw(r,Fe,g,!0),Jw(r,Fe,g,!1),function Z1(r,s,d,g,x){const I=x?r.residualClasses:r.residualStyles;null!=I&&"string"==typeof s&&Ya(I,s)>=0&&(d[g+1]=yE(d[g+1]))}(s,Fe,r,g,I),N=mx(U,q),I?s.classBindings=N:s.styleBindings=N}(x,I,s,d,N,g)}}function bE(r,s,d,g,x){let I=null;const N=d.directiveEnd;let U=d.directiveStylingLast;for(-1===U?U=d.directiveStart:U++;U<N&&(I=s[U],g=w0(g,I.hostAttrs,x),I!==r);)U++;return null!==r&&(d.directiveStylingLast=U),g}function w0(r,s,d){const g=d?1:2;let x=-1;if(null!==s)for(let I=0;I<s.length;I++){const N=s[I];"number"==typeof N?x=N:x===g&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),Vo(r,N,!!d||s[++I]))}return void 0===r?null:r}function cb(r,s,d){Vo(r,s,Zu(d))}function cS(r,s,d){const g=String(s);""!==g&&!g.includes(" ")&&Vo(r,g,d)}function ub(r,s,d,g,x,I,N,U){if(!(3&s.type))return;const q=r.data,ue=q[U+1],Fe=function q1(r){return!(1&~r)}(ue)?db(q,s,d,x,cy(ue),N):void 0;gx(Fe)||(gx(I)||function H1(r){return!(2&~r)}(ue)&&(I=db(q,null,d,x,U,N)),function Tf(r,s,d,g,x){if(s)x?r.addClass(d,g):r.removeClass(d,g);else{let I=-1===g.indexOf("-")?void 0:yf.DashCase;null==x?r.removeStyle(d,g,I):("string"==typeof x&&x.endsWith("!important")&&(x=x.slice(0,-10),I|=yf.Important),r.setStyle(d,g,x,I))}}(g,N,Kt(Ra(),d),x,I))}function db(r,s,d,g,x,I){const N=null===s;let U;for(;x>0;){const q=r[x],ue=Array.isArray(q),Fe=ue?q[1]:q,dt=null===Fe;let Wt=d[x+1];Wt===Cs&&(Wt=dt?si:void 0);let rn=dt?Ia(Wt,g):Fe===g?Wt:void 0;if(ue&&!gx(rn)&&(rn=Ia(q,g)),gx(rn)&&(U=rn,N))return U;const vn=r[x+1];x=N?u_(vn):cy(vn)}if(null!==s){let q=I?s.residualClasses:s.residualStyles;null!=q&&(U=Ia(q,g))}return U}function gx(r){return void 0!==r}function hb(r,s){return!!(r.flags&(s?8:16))}function _x(r,s,d,g){const x=Yt(),I=Tr(),N=Oi+r,U=x[Si],q=I.firstCreatePass?function kS(r,s,d,g,x,I){const N=s.consts,q=Dh(s,r,2,g,Nn(N,x));return Bu(s,d,q,Nn(N,I)),null!==q.attrs&&ty(q,q.attrs,!1),null!==q.mergedAttrs&&ty(q,q.mergedAttrs,!0),null!==s.queries&&s.queries.elementStart(s,q),q}(N,I,x,s,d,g):I.data[N],ue=gb(I,x,q,U,s,r);x[N]=ue;const Fe=xn(q);return Mi(q,!0),tp(U,ue,q),!function h(r){return!(32&~r.flags)}(q)&&ii()&&Od(I,x,ue,q),0===function en(){return Ee.lFrame.elementDepthCount}()&&ks(ue,x),function Lt(){Ee.lFrame.elementDepthCount++}(),Fe&&(hd(I,x,q),Qp(I,q,x)),null!==g&&j_(x,q),_x}function yx(){let r=mi();po()?Rr():(r=r.parent,Mi(r,!1));const s=r;(function Bn(r){return Ee.skipHydrationRootTNode===r})(s)&&function ui(){Ee.skipHydrationRootTNode=null}(),function gn(){Ee.lFrame.elementDepthCount--}();const d=Tr();return d.firstCreatePass&&(Sc(d,r),$u(r)&&d.queries.elementEnd(r)),null!=s.classesWithoutHost&&function ao(r){return!!(8&r.flags)}(s)&&xE(d,s,Yt(),s.classesWithoutHost,!0),null!=s.stylesWithoutHost&&function Lo(r){return!!(16&r.flags)}(s)&&xE(d,s,Yt(),s.stylesWithoutHost,!1),yx}function CE(r,s,d,g){return _x(r,s,d,g),yx(),CE}let gb=(r,s,d,g,x,I)=>(Ll(!0),ud(g,x,function To(){return Ee.lFrame.currentNamespace}()));function vx(r,s,d){const g=Yt(),x=Tr(),I=r+Oi,N=x.firstCreatePass?function FS(r,s,d,g,x){const I=s.consts,N=Nn(I,g),U=Dh(s,r,8,"ng-container",N);return null!==N&&ty(U,N,!0),Bu(s,d,U,Nn(I,x)),null!==s.queries&&s.queries.elementStart(s,U),U}(I,x,g,s,d):x.data[I];Mi(N,!0);const U=yb(x,g,N,r);return g[I]=U,ii()&&Od(x,g,U,N),ks(U,g),xn(N)&&(hd(x,g,N),Qp(x,N,g)),null!=d&&j_(g,N),vx}function xx(){let r=mi();const s=Tr();return po()?Rr():(r=r.parent,Mi(r,!1)),s.firstCreatePass&&(Sc(s,r),$u(r)&&s.queries.elementEnd(r)),xx}let yb=(r,s,d,g)=>(Ll(!0),$p(s[Si],""));function vb(){return Yt()}const uy=void 0;var zS=["en",[["a","p"],["AM","PM"],uy],[["AM","PM"],uy,uy],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],uy,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],uy,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",uy,"{1} 'at' {0}",uy],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function US(r){const d=Math.floor(Math.abs(r)),g=r.toString().replace(/^[^.]*\.?/,"").length;return 1===d&&0===g?1:5}];let Av={};function DE(r){const s=function jS(r){return r.toLowerCase().replace(/_/g,"-")}(r);let d=bb(s);if(d)return d;const g=s.split("-")[0];if(d=bb(g),d)return d;if("en"===g)return zS;throw new Zn(701,!1)}function wb(r){return DE(r)[Cv.PluralCase]}function bb(r){return r in Av||(Av[r]=qn.ng&&qn.ng.common&&qn.ng.common.locales&&qn.ng.common.locales[r]),Av[r]}var Cv=function(r){return r[r.LocaleId=0]="LocaleId",r[r.DayPeriodsFormat=1]="DayPeriodsFormat",r[r.DayPeriodsStandalone=2]="DayPeriodsStandalone",r[r.DaysFormat=3]="DaysFormat",r[r.DaysStandalone=4]="DaysStandalone",r[r.MonthsFormat=5]="MonthsFormat",r[r.MonthsStandalone=6]="MonthsStandalone",r[r.Eras=7]="Eras",r[r.FirstDayOfWeek=8]="FirstDayOfWeek",r[r.WeekendRange=9]="WeekendRange",r[r.DateFormat=10]="DateFormat",r[r.TimeFormat=11]="TimeFormat",r[r.DateTimeFormat=12]="DateTimeFormat",r[r.NumberSymbols=13]="NumberSymbols",r[r.NumberFormats=14]="NumberFormats",r[r.CurrencyCode=15]="CurrencyCode",r[r.CurrencySymbol=16]="CurrencySymbol",r[r.CurrencyName=17]="CurrencyName",r[r.Currencies=18]="Currencies",r[r.Directionality=19]="Directionality",r[r.PluralCase=20]="PluralCase",r[r.ExtraData=21]="ExtraData",r}(Cv||{});const Dv="en-US";let Tb=Dv;function PE(r,s,d,g){const x=Yt(),I=Tr(),N=mi();return function OE(r,s,d,g,x,I,N){const U=xn(g),ue=r.firstCreatePass&&Yu(r),Fe=s[qi],dt=md(s);let Wt=!0;if(3&g.type||N){const Qn=ln(g,s),Dr=N?N(Qn):Qn,Jr=dt.length,fr=N?na=>N(It(na[g.index])):g.index;let Es=null;if(!N&&U&&(Es=function BA(r,s,d,g){const x=r.cleanup;if(null!=x)for(let I=0;I<x.length-1;I+=2){const N=x[I];if(N===d&&x[I+1]===g){const U=s[rl],q=x[I+2];return U.length>q?U[q]:null}"string"==typeof N&&(I+=2)}return null}(r,s,x,g.index)),null!==Es)(Es.__ngLastListenerFn__||Es).__ngNextListenerFn__=I,Es.__ngLastListenerFn__=I,Wt=!1;else{I=Yb(g,s,Fe,I,!1);const na=d.listen(Dr,x,I);dt.push(I,na),ue&&ue.push(x,fr,Jr,Jr+1)}}else I=Yb(g,s,Fe,I,!1);const rn=g.outputs;let vn;if(Wt&&null!==rn&&(vn=rn[x])){const Qn=vn.length;if(Qn)for(let Dr=0;Dr<Qn;Dr+=2){const ol=s[vn[Dr]][vn[Dr+1]].subscribe(I),Tu=dt.length;dt.push(I,ol),ue&&ue.push(x,g.index,Tu,-(Tu+1))}}}(I,x,x[Si],N,r,s,g),PE}function Qb(r,s,d,g){const x=Be(null);try{return pe(6,s,d),!1!==d(g)}catch(I){return Af(r,I),!1}finally{pe(7,s,d),Be(x)}}function Yb(r,s,d,g,x){return function I(N){if(N===Function)return g;A(r.componentOffset>-1?an(r.index,s):s);let q=Qb(s,d,g,N),ue=I.__ngNextListenerFn__;for(;ue;)q=Qb(s,d,ue,N)&&q,ue=ue.__ngNextListenerFn__;return x&&!1===q&&N.preventDefault(),q}}function Jb(r=1){return function Lh(r){return(Ee.lFrame.contextLView=function Xr(r,s){for(;r>0;)s=s[Ol],r--;return s}(r,Ee.lFrame.contextLView))[qi]}(r)}function VA(r,s){let d=null;const g=function rc(r){const s=r.attrs;if(null!=s){const d=s.indexOf(5);if(!(1&d))return s[d+1]}return null}(r);for(let x=0;x<s.length;x++){const I=s[x];if("*"!==I){if(null===g?Al(r,I,!0):Uc(g,I))return x}else d=x}return d}function eT(r){const s=Yt()[Xs][js];if(!s.projection){const g=s.projection=function zl(r,s){const d=[];for(let g=0;g<r;g++)d.push(s);return d}(r?r.length:1,null),x=g.slice();let I=s.child;for(;null!==I;){const N=r?VA(I,r):0;null!==N&&(x[N]?x[N].projectionNext=I:g[N]=I,x[N]=I),I=I.next}}}function tT(r,s=0,d){const g=Yt(),x=Tr(),I=Dh(x,Oi+r,16,null,d||null);null===I.projection&&(I.projection=s),Rr(),(!g[ea]||kn())&&32&~I.flags&&function V_(r,s,d){Sh(s[Si],0,s,d,Gp(r,d,s),Rg(d.parent||s[js],d,s))}(x,g,I)}function dT(r,s,d,g){!function H0(r,s,d,g){const x=Tr();if(x.firstCreatePass){const I=mi();W0(x,new Wx(s,d,g),I.index),function q0(r,s){const d=r.contentQueries||(r.contentQueries=[]);s!==(d.length?d[d.length-1]:-1)&&d.push(r.queries.length-1,s)}(x,r),!(2&~d)&&(x.staticContentQueries=!0)}return $0(x,Yt(),d)}(r,s,d,g)}function hT(r,s,d){!function G0(r,s,d){const g=Tr();return g.firstCreatePass&&(W0(g,new Wx(r,s,d),-1),!(2&~s)&&(g.staticViewQueries=!0)),$0(g,Yt(),s)}(r,s,d)}function fT(r){const s=Yt(),d=Tr(),g=tu();Cu(g+1);const x=iv(d,g);if(r.dirty&&function Kn(r){return!(4&~r[Kr])}(s)===!(2&~x.metadata.flags)){if(null===x.matches)r.reset([]);else{const I=K0(s,g);r.reset(I,au),r.notifyOnChanges()}return!0}return!1}function pT(){return function Rf(r,s){return r[jo].queries[s].queryList}(Yt(),tu())}function TT(r,s=""){const d=Yt(),g=Tr(),x=r+Oi,I=g.firstCreatePass?Dh(g,x,1,s,null):g.data[x],N=IT(g,d,I,s,r);d[x]=N,ii()&&Od(g,d,N,I),Mi(I,!1)}let IT=(r,s,d,g,x)=>(Ll(!0),function xf(r,s){return r.createText(s)}(s[Si],g));function NE(r){return Ix("",r,""),NE}function Ix(r,s,d){const g=Yt(),x=function yv(r,s,d,g){return Dc(r,Ma(),d)?s+fi(d)+g:Cs}(g,r,s,d);return x!==Cs&&vu(g,Ra(),x),Ix}function LE(r,s,d,g,x){const I=Yt(),N=vv(I,r,s,d,g,x);return N!==Cs&&vu(I,Ra(),N),LE}let lC=(()=>{class r{constructor(d){this._injector=d,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(d){if(!d.standalone)return null;if(!this.cachedInjectors.has(d)){const g=os(0,d.type),x=g.length>0?ly([g],this._injector,`Standalone[${d.type.name}]`):null;this.cachedInjectors.set(d,x)}return this.cachedInjectors.get(d)}ngOnDestroy(){try{for(const d of this.cachedInjectors.values())null!==d&&d.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=Sn({token:r,providedIn:"environment",factory:()=>new r(Us(ho))})}return r})();function LT(r){Nd("NgStandalone"),r.getStandaloneInjector=s=>s.get(lC).getOrCreateStandaloneInjector(r)}function FT(r,s,d){const g=r.\u0275cmp;g.directiveDefs=tl(s,!1),g.pipeDefs=tl(d,!0)}function VT(r,s,d){const g=function Qs(){const r=Ee.lFrame;let s=r.bindingRootIndex;return-1===s&&(s=r.bindingRootIndex=r.tView.bindingStartIndex),s}()+r,x=Yt();return x[g]===Cs?function Oh(r,s,d){return r[s]=d}(x,g,d?s.call(d):s()):function l_(r,s){return r[s]}(x,g)}class oI{constructor(s){this.full=s;const d=s.split(".");this.major=d[0],this.minor=d[1],this.patch=d.slice(2).join(".")}}const KC=new oI("17.3.1");let aI=(()=>{class r{log(d){console.log(d)}warn(d){console.warn(d)}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();const hI=new On(""),fI=new On("");let WE,xD=(()=>{class r{constructor(d,g,x){this._ngZone=d,this.registry=g,this._pendingCount=0,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,WE||(function ED(r){WE=r}(x),x.addToWindow(g)),this._watchAngularEvents(),d.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Do.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let d=this._callbacks.pop();clearTimeout(d.timeoutId),d.doneCb()}});else{let d=this.getPendingTasks();this._callbacks=this._callbacks.filter(g=>!g.updateCb||!g.updateCb(d)||(clearTimeout(g.timeoutId),!1))}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(d=>({source:d.source,creationLocation:d.creationLocation,data:d.data})):[]}addCallback(d,g,x){let I=-1;g&&g>0&&(I=setTimeout(()=>{this._callbacks=this._callbacks.filter(N=>N.timeoutId!==I),d()},g)),this._callbacks.push({doneCb:d,timeoutId:I,updateCb:x})}whenStable(d,g,x){if(x&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(d,g,x),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(d){this.registry.registerApplication(d,this)}unregisterApplication(d){this.registry.unregisterApplication(d)}findProviders(d,g,x){return[]}static#e=this.\u0275fac=function(g){return new(g||r)(Us(Do),Us(pI),Us(fI))};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac})}return r})(),pI=(()=>{class r{constructor(){this._applications=new Map}registerApplication(d,g){this._applications.set(d,g)}unregisterApplication(d){this._applications.delete(d)}unregisterAllApplications(){this._applications.clear()}getTestability(d){return this._applications.get(d)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(d,g=!0){return WE?.findTestabilityInTree(this,d,g)??null}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})();function qE(r){return!!r&&"function"==typeof r.then}function mI(r){return!!r&&"function"==typeof r.subscribe}const gI=new On("");let KE=(()=>{class r{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,g)=>{this.resolve=d,this.reject=g}),this.appInits=Ei(gI,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const d=[];for(const x of this.appInits){const I=x();if(qE(I))d.push(I);else if(mI(I)){const N=new Promise((U,q)=>{I.subscribe({complete:U,error:q})});d.push(N)}}const g=()=>{this.done=!0,this.resolve()};Promise.all(d).then(()=>{g()}).catch(x=>{this.reject(x)}),0===d.length&&g(),this.initialized=!0}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const ZE=new On("");function vI(r,s){return Array.isArray(s)?s.reduce(vI,r):{...r,...s}}let d_=(()=>{class r{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ei(uh),this.afterRenderEffectManager=Ei(e_),this.externalTestViews=new Set,this.beforeRender=new ur.B,this.afterTick=new ur.B,this.componentTypes=[],this.components=[],this.isStable=Ei(Km).hasPendingTasks.pipe((0,nr.T)(d=>!d)),this._injector=Ei(ho)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(d,g){const x=d instanceof Fc;if(!this._injector.get(KE).done)throw!x&&Yo(d),new Zn(405,!1);let N;N=x?d:this._injector.get(Ph).resolveComponentFactory(d),this.componentTypes.push(N.componentType);const U=function wD(r){return r.isBoundToModule}(N)?void 0:this._injector.get(mp),ue=N.create(Ql.NULL,[],g||N.selector,U),Fe=ue.location.nativeElement,dt=ue.injector.get(hI,null);return dt?.registerApplication(Fe),ue.onDestroy(()=>{this.detachView(ue.hostView),Dx(this.components,ue),dt?.unregisterApplication(Fe)}),this._loadComponent(ue),ue}tick(){this._tick(!0)}_tick(d){if(this._runningTick)throw new Zn(101,!1);const g=Be(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(d)}catch(x){this.internalErrorHandler(x)}finally{this.afterTick.next(),this._runningTick=!1,Be(g)}}detectChangesInAttachedViews(d){let g=0;const x=this.afterRenderEffectManager;for(;;){if(g===rm)throw new Zn(103,!1);if(d){const I=0===g;this.beforeRender.next(I);for(let{_lView:N,notifyErrorHandler:U}of this._views)TD(N,I,U)}if(g++,x.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:I})=>XE(I))&&(x.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:I})=>XE(I))))break}}attachView(d){const g=d;this._views.push(g),g.attachToAppRef(this)}detachView(d){const g=d;Dx(this._views,g),g.detachFromAppRef()}_loadComponent(d){this.attachView(d.hostView),this.tick(),this.components.push(d);const g=this._injector.get(ZE,[]);[...this._bootstrapListeners,...g].forEach(x=>x(d))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(d=>d()),this._views.slice().forEach(d=>d.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(d){return this._destroyListeners.push(d),()=>Dx(this._destroyListeners,d)}destroy(){if(this._destroyed)throw new Zn(406,!1);const d=this._injector;d.destroy&&!d.destroyed&&d.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function Dx(r,s){const d=r.indexOf(s);d>-1&&r.splice(d,1)}function TD(r,s,d){!s&&!XE(r)||function ID(r,s,d){let g;d?(g=0,r[Kr]|=1024):g=64&r[Kr]?0:1,zm(r,s,g)}(r,d,s)}function XE(r){return bi(r)}class SD{constructor(s,d){this.ngModuleFactory=s,this.componentFactories=d}}let AD=(()=>{class r{compileModuleSync(d){return new y0(d)}compileModuleAsync(d){return Promise.resolve(this.compileModuleSync(d))}compileModuleAndAllComponentsSync(d){const g=this.compileModuleSync(d),I=Lu(uo(d).declarations).reduce((N,U)=>{const q=Bi(U);return q&&N.push(new ry(q)),N},[]);return new SD(g,I)}compileModuleAndAllComponentsAsync(d){return Promise.resolve(this.compileModuleAndAllComponentsSync(d))}clearCache(){}clearCacheFor(d){}getModuleId(d){}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),MD=(()=>{class r{constructor(){this.zone=Ei(Do),this.applicationRef=Ei(d_)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function RD(){const r=Ei(Do),s=Ei(Wc);return d=>r.runOutsideAngular(()=>s.handleError(d))}let OD=(()=>{class r{constructor(){this.subscription=new Ai.yU,this.initialized=!1,this.zone=Ei(Do),this.pendingTasks=Ei(Km)}initialize(){if(this.initialized)return;this.initialized=!0;let d=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(d=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Do.assertNotInAngularZone(),queueMicrotask(()=>{null!==d&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(d),d=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Do.assertInAngularZone(),d??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(g){return new(g||r)};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();const Rx=new On("",{providedIn:"root",factory:()=>Ei(Rx,Nr.Optional|Nr.SkipSelf)||function kD(){return typeof $localize<"u"&&$localize.locale||Dv}()}),ND=new On("",{providedIn:"root",factory:()=>"USD"}),QE=new On("");let bI=(()=>{class r{constructor(d){this._injector=d,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(d,g){const x=function Q_(r="zone.js",s){return"noop"===r?new Uu:"zone.js"===r?new Do(s):r}(g?.ngZone,function wI(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}({eventCoalescing:g?.ngZoneEventCoalescing,runCoalescing:g?.ngZoneRunCoalescing}));return x.run(()=>{const I=function cx(r,s,d){return new _0(r,s,d)}(d.moduleType,this.injector,function EI(r){return[{provide:Do,useFactory:r},{provide:Aa,multi:!0,useFactory:()=>{const s=Ei(MD,{optional:!0});return()=>s.initialize()}},{provide:Aa,multi:!0,useFactory:()=>{const s=Ei(OD);return()=>{s.initialize()}}},{provide:uh,useFactory:RD}]}(()=>x)),N=I.injector.get(Wc,null);return x.runOutsideAngular(()=>{const U=x.onError.subscribe({next:q=>{N.handleError(q)}});I.onDestroy(()=>{Dx(this._modules,I),U.unsubscribe()})}),function yI(r,s,d){try{const g=d();return qE(g)?g.catch(x=>{throw s.runOutsideAngular(()=>r.handleError(x)),x}):g}catch(g){throw s.runOutsideAngular(()=>r.handleError(g)),g}}(N,x,()=>{const U=I.injector.get(KE);return U.runInitializers(),U.donePromise.then(()=>(function Ib(r){"string"==typeof r&&(Tb=r.toLowerCase().replace(/_/g,"-"))}(I.injector.get(Rx,Dv)||Dv),this._moduleDoBootstrap(I),I))})})}bootstrapModule(d,g=[]){const x=vI({},g);return function DD(r,s,d){const g=new y0(d);return Promise.resolve(g)}(0,0,d).then(I=>this.bootstrapModuleFactory(I,x))}_moduleDoBootstrap(d){const g=d.injector.get(d_);if(d._bootstrapComponents.length>0)d._bootstrapComponents.forEach(x=>g.bootstrap(x));else{if(!d.instance.ngDoBootstrap)throw new Zn(-403,!1);d.instance.ngDoBootstrap(g)}this._modules.push(d)}onDestroy(d){this._destroyListeners.push(d)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Zn(404,!1);this._modules.slice().forEach(g=>g.destroy()),this._destroyListeners.forEach(g=>g());const d=this._injector.get(QE,null);d&&(d.forEach(g=>g()),d.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(g){return new(g||r)(Us(Ql))};static#t=this.\u0275prov=Sn({token:r,factory:r.\u0275fac,providedIn:"platform"})}return r})(),h_=null;const TI=new On("");function II(r,s,d=[]){const g=`Platform: ${s}`,x=new On(g);return(I=[])=>{let N=YE();if(!N||N.injector.get(TI,!1)){const U=[...d,...I,{provide:x,useValue:!0}];r?r(U):function FD(r){if(h_&&!h_.get(TI,!1))throw new Zn(400,!1);(function _I(){!function Pt(r){lt=r}(()=>{throw new Zn(600,!1)})})(),h_=r;const s=r.get(bI);(function AI(r){r.get(Jm,null)?.forEach(d=>d())})(r)}(function SI(r=[],s){return Ql.create({name:s,providers:[{provide:ya,useValue:"platform"},{provide:QE,useValue:new Set([()=>h_=null])},...r]})}(U,g))}return function BD(r){const s=YE();if(!s)throw new Zn(401,!1);return s}()}}function YE(){return h_?.get(bI)??null}function UD(){return!1}function zD(){}let DI=(()=>{class r{static#e=this.__NG_ELEMENT_ID__=jD}return r})();function jD(r){return function $D(r,s,d){if(dr(r)&&!d){const g=an(r.index,s);return new k(g,g)}return 47&r.type?new k(s[Xs],s):null}(mi(),Yt(),!(16&~r))}class OI{constructor(){}supports(s){return uv(s)}create(s){return new KD(s)}}const qD=(r,s)=>s;class KD{constructor(s){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=s||qD}forEachItem(s){let d;for(d=this._itHead;null!==d;d=d._next)s(d)}forEachOperation(s){let d=this._itHead,g=this._removalsHead,x=0,I=null;for(;d||g;){const N=!g||d&&d.currentIndex<NI(g,x,I)?d:g,U=NI(N,x,I),q=N.currentIndex;if(N===g)x--,g=g._nextRemoved;else if(d=d._next,null==N.previousIndex)x++;else{I||(I=[]);const ue=U-x,Fe=q-x;if(ue!=Fe){for(let Wt=0;Wt<ue;Wt++){const rn=Wt<I.length?I[Wt]:I[Wt]=0,vn=rn+Wt;Fe<=vn&&vn<ue&&(I[Wt]=rn+1)}I[N.previousIndex]=Fe-ue}}U!==q&&s(N,U,q)}}forEachPreviousItem(s){let d;for(d=this._previousItHead;null!==d;d=d._nextPrevious)s(d)}forEachAddedItem(s){let d;for(d=this._additionsHead;null!==d;d=d._nextAdded)s(d)}forEachMovedItem(s){let d;for(d=this._movesHead;null!==d;d=d._nextMoved)s(d)}forEachRemovedItem(s){let d;for(d=this._removalsHead;null!==d;d=d._nextRemoved)s(d)}forEachIdentityChange(s){let d;for(d=this._identityChangesHead;null!==d;d=d._nextIdentityChange)s(d)}diff(s){if(null==s&&(s=[]),!uv(s))throw new Zn(900,!1);return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let x,I,N,d=this._itHead,g=!1;if(Array.isArray(s)){this.length=s.length;for(let U=0;U<this.length;U++)I=s[U],N=this._trackByFn(U,I),null!==d&&Object.is(d.trackById,N)?(g&&(d=this._verifyReinsertion(d,I,N,U)),Object.is(d.item,I)||this._addIdentityChange(d,I)):(d=this._mismatch(d,I,N,U),g=!0),d=d._next}else x=0,function fx(r,s){if(Array.isArray(r))for(let d=0;d<r.length;d++)s(r[d]);else{const d=r[Symbol.iterator]();let g;for(;!(g=d.next()).done;)s(g.value)}}(s,U=>{N=this._trackByFn(x,U),null!==d&&Object.is(d.trackById,N)?(g&&(d=this._verifyReinsertion(d,U,N,x)),Object.is(d.item,U)||this._addIdentityChange(d,U)):(d=this._mismatch(d,U,N,x),g=!0),d=d._next,x++}),this.length=x;return this._truncate(d),this.collection=s,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let s;for(s=this._previousItHead=this._itHead;null!==s;s=s._next)s._nextPrevious=s._next;for(s=this._additionsHead;null!==s;s=s._nextAdded)s.previousIndex=s.currentIndex;for(this._additionsHead=this._additionsTail=null,s=this._movesHead;null!==s;s=s._nextMoved)s.previousIndex=s.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(s,d,g,x){let I;return null===s?I=this._itTail:(I=s._prev,this._remove(s)),null!==(s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null))?(Object.is(s.item,d)||this._addIdentityChange(s,d),this._reinsertAfter(s,I,x)):null!==(s=null===this._linkedRecords?null:this._linkedRecords.get(g,x))?(Object.is(s.item,d)||this._addIdentityChange(s,d),this._moveAfter(s,I,x)):s=this._addAfter(new ZD(d,g),I,x),s}_verifyReinsertion(s,d,g,x){let I=null===this._unlinkedRecords?null:this._unlinkedRecords.get(g,null);return null!==I?s=this._reinsertAfter(I,s._prev,x):s.currentIndex!=x&&(s.currentIndex=x,this._addToMoves(s,x)),s}_truncate(s){for(;null!==s;){const d=s._next;this._addToRemovals(this._unlink(s)),s=d}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(s,d,g){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(s);const x=s._prevRemoved,I=s._nextRemoved;return null===x?this._removalsHead=I:x._nextRemoved=I,null===I?this._removalsTail=x:I._prevRemoved=x,this._insertAfter(s,d,g),this._addToMoves(s,g),s}_moveAfter(s,d,g){return this._unlink(s),this._insertAfter(s,d,g),this._addToMoves(s,g),s}_addAfter(s,d,g){return this._insertAfter(s,d,g),this._additionsTail=null===this._additionsTail?this._additionsHead=s:this._additionsTail._nextAdded=s,s}_insertAfter(s,d,g){const x=null===d?this._itHead:d._next;return s._next=x,s._prev=d,null===x?this._itTail=s:x._prev=s,null===d?this._itHead=s:d._next=s,null===this._linkedRecords&&(this._linkedRecords=new kI),this._linkedRecords.put(s),s.currentIndex=g,s}_remove(s){return this._addToRemovals(this._unlink(s))}_unlink(s){null!==this._linkedRecords&&this._linkedRecords.remove(s);const d=s._prev,g=s._next;return null===d?this._itHead=g:d._next=g,null===g?this._itTail=d:g._prev=d,s}_addToMoves(s,d){return s.previousIndex===d||(this._movesTail=null===this._movesTail?this._movesHead=s:this._movesTail._nextMoved=s),s}_addToRemovals(s){return null===this._unlinkedRecords&&(this._unlinkedRecords=new kI),this._unlinkedRecords.put(s),s.currentIndex=null,s._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=s,s._prevRemoved=null):(s._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=s),s}_addIdentityChange(s,d){return s.item=d,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=s:this._identityChangesTail._nextIdentityChange=s,s}}class ZD{constructor(s,d){this.item=s,this.trackById=d,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class XD{constructor(){this._head=null,this._tail=null}add(s){null===this._head?(this._head=this._tail=s,s._nextDup=null,s._prevDup=null):(this._tail._nextDup=s,s._prevDup=this._tail,s._nextDup=null,this._tail=s)}get(s,d){let g;for(g=this._head;null!==g;g=g._nextDup)if((null===d||d<=g.currentIndex)&&Object.is(g.trackById,s))return g;return null}remove(s){const d=s._prevDup,g=s._nextDup;return null===d?this._head=g:d._nextDup=g,null===g?this._tail=d:g._prevDup=d,null===this._head}}class kI{constructor(){this.map=new Map}put(s){const d=s.trackById;let g=this.map.get(d);g||(g=new XD,this.map.set(d,g)),g.add(s)}get(s,d){const x=this.map.get(s);return x?x.get(s,d):null}remove(s){const d=s.trackById;return this.map.get(d).remove(s)&&this.map.delete(d),s}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function NI(r,s,d){const g=r.previousIndex;if(null===g)return g;let x=0;return d&&g<d.length&&(x=d[g]),g+s+x}class LI{constructor(){}supports(s){return s instanceof Map||x0(s)}create(){return new QD}}class QD{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(s){let d;for(d=this._mapHead;null!==d;d=d._next)s(d)}forEachPreviousItem(s){let d;for(d=this._previousMapHead;null!==d;d=d._nextPrevious)s(d)}forEachChangedItem(s){let d;for(d=this._changesHead;null!==d;d=d._nextChanged)s(d)}forEachAddedItem(s){let d;for(d=this._additionsHead;null!==d;d=d._nextAdded)s(d)}forEachRemovedItem(s){let d;for(d=this._removalsHead;null!==d;d=d._nextRemoved)s(d)}diff(s){if(s){if(!(s instanceof Map||x0(s)))throw new Zn(900,!1)}else s=new Map;return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let d=this._mapHead;if(this._appendAfter=null,this._forEach(s,(g,x)=>{if(d&&d.key===x)this._maybeAddToChanges(d,g),this._appendAfter=d,d=d._next;else{const I=this._getOrCreateRecordForKey(x,g);d=this._insertBeforeOrAppend(d,I)}}),d){d._prev&&(d._prev._next=null),this._removalsHead=d;for(let g=d;null!==g;g=g._nextRemoved)g===this._mapHead&&(this._mapHead=null),this._records.delete(g.key),g._nextRemoved=g._next,g.previousValue=g.currentValue,g.currentValue=null,g._prev=null,g._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(s,d){if(s){const g=s._prev;return d._next=s,d._prev=g,s._prev=d,g&&(g._next=d),s===this._mapHead&&(this._mapHead=d),this._appendAfter=s,s}return this._appendAfter?(this._appendAfter._next=d,d._prev=this._appendAfter):this._mapHead=d,this._appendAfter=d,null}_getOrCreateRecordForKey(s,d){if(this._records.has(s)){const x=this._records.get(s);this._maybeAddToChanges(x,d);const I=x._prev,N=x._next;return I&&(I._next=N),N&&(N._prev=I),x._next=null,x._prev=null,x}const g=new YD(s);return this._records.set(s,g),g.currentValue=d,this._addToAdditions(g),g}_reset(){if(this.isDirty){let s;for(this._previousMapHead=this._mapHead,s=this._previousMapHead;null!==s;s=s._next)s._nextPrevious=s._next;for(s=this._changesHead;null!==s;s=s._nextChanged)s.previousValue=s.currentValue;for(s=this._additionsHead;null!=s;s=s._nextAdded)s.previousValue=s.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(s,d){Object.is(d,s.currentValue)||(s.previousValue=s.currentValue,s.currentValue=d,this._addToChanges(s))}_addToAdditions(s){null===this._additionsHead?this._additionsHead=this._additionsTail=s:(this._additionsTail._nextAdded=s,this._additionsTail=s)}_addToChanges(s){null===this._changesHead?this._changesHead=this._changesTail=s:(this._changesTail._nextChanged=s,this._changesTail=s)}_forEach(s,d){s instanceof Map?s.forEach(d):Object.keys(s).forEach(g=>d(s[g],g))}}class YD{constructor(s){this.key=s,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function FI(){return new rw([new OI])}let rw=(()=>{class r{static#e=this.\u0275prov=Sn({token:r,providedIn:"root",factory:FI});constructor(d){this.factories=d}static create(d,g){if(null!=g){const x=g.factories.slice();d=d.concat(x)}return new r(d)}static extend(d){return{provide:r,useFactory:g=>r.create(d,g||FI()),deps:[[r,new oa,new Ko]]}}find(d){const g=this.factories.find(x=>x.supports(d));if(null!=g)return g;throw new Zn(901,!1)}}return r})();function BI(){return new iw([new LI])}let iw=(()=>{class r{static#e=this.\u0275prov=Sn({token:r,providedIn:"root",factory:BI});constructor(d){this.factories=d}static create(d,g){if(g){const x=g.factories.slice();d=d.concat(x)}return new r(d)}static extend(d){return{provide:r,useFactory:g=>r.create(d,g||BI()),deps:[[r,new oa,new Ko]]}}find(d){const g=this.factories.find(x=>x.supports(d));if(g)return g;throw new Zn(901,!1)}}return r})();const tM=II(null,"core",[]);let nM=(()=>{class r{constructor(d){}static#e=this.\u0275fac=function(g){return new(g||r)(Us(d_))};static#t=this.\u0275mod=Gl({type:r});static#n=this.\u0275inj=gi({})}return r})();function RM(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}function OM(r){const s=Be(null);try{return r()}finally{Be(s)}}function VM(r){const s=Bi(r);if(!s)return null;const d=new ry(s);return{get selector(){return d.selector},get type(){return d.componentType},get inputs(){return d.inputs},get outputs(){return d.outputs},get ngContentSelectors(){return d.ngContentSelectors},get isStandalone(){return s.standalone},get isSignal(){return s.signals}}}},5947:(An,xt,H)=>{"use strict";H.d(xt,{Qe:()=>l_,cM:()=>Dc});var O=H(177),z=H(4438),ye=H(574),m=H(9253),De=(H(4998),H(1413)),Be=H(7673),Ve=H(1985),xe=H(8455),se=H(7786),me=H(941),He=H(5558),qe=H(6354),Oe=H(2771),je=H(8750),ht=H(7707),et=H(9974);function Ue(u,e,...i){if(!0===e)return void u();if(!1===e)return;const h=new ht.Ms({next:()=>{h.unsubscribe(),u()}});return(0,je.Tg)(e(...i)).subscribe(h)}function nt(u,e,i){let h,v=!1;return u&&"object"==typeof u?({bufferSize:h=1/0,windowTime:e=1/0,refCount:v=!1,scheduler:i}=u):h=u??1/0,function ct(u={}){const{connector:e=(()=>new De.B),resetOnError:i=!0,resetOnComplete:h=!0,resetOnRefCountZero:v=!0}=u;return T=>{let D,X,te,_e=0,ze=!1,vt=!1;const Xt=()=>{X?.unsubscribe(),X=void 0},un=()=>{Xt(),D=te=void 0,ze=vt=!1},yr=()=>{const Ir=D;un(),Ir?.unsubscribe()};return(0,et.N)((Ir,xr)=>{_e++,!vt&&!ze&&Xt();const hi=te=te??e();xr.add(()=>{_e--,0===_e&&!vt&&!ze&&(X=Ue(yr,v))}),hi.subscribe(xr),!D&&_e>0&&(D=new ht.Ms({next:Xi=>hi.next(Xi),error:Xi=>{vt=!0,Xt(),X=Ue(un,i,Xi),hi.error(Xi)},complete:()=>{ze=!0,Xt(),X=Ue(un,h),hi.complete()}}),(0,je.Tg)(Ir).subscribe(D))})(T)}}({connector:()=>new Oe.m(h,e,i),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:v})}var Xe=H(1594),Le=H(8071);function Te(u,e){return(0,Le.T)(e)?(0,He.n)(()=>u,e):(0,He.n)(()=>u)}var at=H(6745),Ze=H(5964),it=H(762);const nn=new z.nKC("angularfire2.auth.use-emulator"),bn=new z.nKC("angularfire2.auth.settings"),Cn=new z.nKC("angularfire2.auth.tenant-id"),qt=new z.nKC("angularfire2.auth.langugage-code"),Ht=new z.nKC("angularfire2.auth.use-device-language"),lt=new z.nKC("angularfire.auth.persistence"),Ct=(u,e,i,h,v,T,D,X)=>(0,m.BM)(`${u.name}.auth`,"AngularFireAuth",u.name,()=>{const te=e.runOutsideAngular(()=>u.auth());if(i&&te.useEmulator(...i),h&&(te.tenantId=h),te.languageCode=v,T&&te.useDeviceLanguage(),D)for(const[_e,ze]of Object.entries(D))te.settings[_e]=ze;return X&&te.setPersistence(X),te},[i,h,v,T,D,X]);let Pt=(()=>{class u{authState;idToken;user;idTokenResult;credential;constructor(i,h,v,T,D,X,te,_e,ze,vt,Xt,un){const yr=new De.B,Ir=(0,Be.of)(void 0).pipe((0,me.Q)(D.outsideAngular),(0,He.n)(()=>T.runOutsideAngular(()=>Promise.resolve().then(H.bind(H,4998)))),(0,qe.T)(()=>(0,m.iB)(i,T,h)),(0,qe.T)(xr=>Ct(xr,T,X,_e,ze,vt,te,Xt)),nt({bufferSize:1,refCount:!1}));if((0,O.Vy)(v))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Be.of)(null);else{Ir.pipe((0,Xe.$)()).subscribe();const xr=Ir.pipe((0,He.n)(ni=>ni.getRedirectResult().then(Ji=>Ji,()=>null)),ye.U0,nt({bufferSize:1,refCount:!1})),hi=Ir.pipe((0,He.n)(ni=>new Ve.c(Ji=>({unsubscribe:T.runOutsideAngular(()=>ni.onAuthStateChanged(Js=>Ji.next(Js),Js=>Ji.error(Js),()=>Ji.complete()))})))),Xi=Ir.pipe((0,He.n)(ni=>new Ve.c(Ji=>({unsubscribe:T.runOutsideAngular(()=>ni.onIdTokenChanged(Js=>Ji.next(Js),Js=>Ji.error(Js),()=>Ji.complete()))}))));this.authState=xr.pipe(Te(hi),(0,at._)(D.outsideAngular),(0,me.Q)(D.insideAngular)),this.user=xr.pipe(Te(Xi),(0,at._)(D.outsideAngular),(0,me.Q)(D.insideAngular)),this.idToken=this.user.pipe((0,He.n)(ni=>ni?(0,xe.H)(ni.getIdToken()):(0,Be.of)(null))),this.idTokenResult=this.user.pipe((0,He.n)(ni=>ni?(0,xe.H)(ni.getIdTokenResult()):(0,Be.of)(null))),this.credential=(0,se.h)(xr,yr,this.authState.pipe((0,Ze.p)(ni=>!ni))).pipe((0,qe.T)(ni=>ni?.user?ni:null),(0,at._)(D.outsideAngular),(0,me.Q)(D.insideAngular))}return(0,m.Gt)(this,Ir,T,{spy:{apply:(xr,hi,Xi)=>{(xr.startsWith("signIn")||xr.startsWith("createUser"))&&Xi.then(ni=>yr.next(ni))}}})}static \u0275fac=function(h){return new(h||u)(z.KVO(m.rx),z.KVO(m.uP,8),z.KVO(z.Agw),z.KVO(z.SKi),z.KVO(ye.u0),z.KVO(nn,8),z.KVO(bn,8),z.KVO(Cn,8),z.KVO(qt,8),z.KVO(Ht,8),z.KVO(lt,8),z.KVO(ye.Jv,8))};static \u0275prov=z.jDH({token:u,factory:u.\u0275fac,providedIn:"any"})}return u})();var Tt=H(3236),$t=H(9172),Qt=H(4360);function sn(){return(0,et.N)((u,e)=>{let i,h=!1;u.subscribe((0,Qt._)(e,v=>{const T=i;i=v,h&&e.next([T,v]),h=!0}))})}var nr,mn=H(2816),Vn=H(3294),Fr=H(9574),Ot=H(467),on=H(2979),Or=H(8779),jr=H(8041),ur=H(1401),Ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ri={},mr=mr||{},Er=Ai||self;function Zn(u){var e=typeof u;return"array"==(e="object"!=e?e:u?Array.isArray(u)?"array":e:"null")||"object"==e&&"number"==typeof u.length}function us(u){var e=typeof u;return"object"==e&&null!=u||"function"==e}var Sr="closure_uid_"+(1e9*Math.random()>>>0),kr=0;function Gt(u,e,i){return u.call.apply(u.bind,arguments)}function Bt(u,e,i){if(!u)throw Error();if(2<arguments.length){var h=Array.prototype.slice.call(arguments,2);return function(){var v=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(v,h),u.apply(e,v)}}return function(){return u.apply(e,arguments)}}function Ce(u,e,i){return(Ce=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Gt:Bt).apply(null,arguments)}function pt(u,e){var i=Array.prototype.slice.call(arguments,1);return function(){var h=i.slice();return h.push.apply(h,arguments),u.apply(this,h)}}function Mt(u,e){function i(){}i.prototype=e.prototype,u.$=e.prototype,u.prototype=new i,u.prototype.constructor=u,u.ac=function(h,v,T){for(var D=Array(arguments.length-2),X=2;X<arguments.length;X++)D[X-2]=arguments[X];return e.prototype[v].apply(h,D)}}function hn(){this.s=this.s,this.o=this.o}hn.prototype.s=!1,hn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function Hn(u){Object.prototype.hasOwnProperty.call(u,Sr)&&u[Sr]||(u[Sr]=++kr)}(this)},hn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vi=Array.prototype.indexOf?function(u,e){return Array.prototype.indexOf.call(u,e,void 0)}:function(u,e){if("string"==typeof u)return"string"!=typeof e||1!=e.length?-1:u.indexOf(e,0);for(let i=0;i<u.length;i++)if(i in u&&u[i]===e)return i;return-1};function $r(u){const e=u.length;if(0<e){const i=Array(e);for(let h=0;h<e;h++)i[h]=u[h];return i}return[]}function ci(u,e){for(let i=1;i<arguments.length;i++){const h=arguments[i];if(Zn(h)){const v=u.length||0,T=h.length||0;u.length=v+T;for(let D=0;D<T;D++)u[v+D]=h[D]}else u.push(h)}}function qn(u,e){this.type=u,this.g=this.target=e,this.defaultPrevented=!1}qn.prototype.h=function(){this.defaultPrevented=!0};var Fs=function(){if(!Er.addEventListener||!Object.defineProperty)return!1;var u=!1,e=Object.defineProperty({},"passive",{get:function(){u=!0}});try{const i=()=>{};Er.addEventListener("test",i,e),Er.removeEventListener("test",i,e)}catch{}return u}();function Zt(u){return/^[\s\xa0]*$/.test(u)}function ve(){var u=Er.navigator;return u&&(u=u.userAgent)?u:""}function re(u){return-1!=ve().indexOf(u)}function Q(u){return Q[" "](u),u}Q[" "]=function(){};var Ae,u,ge=re("Opera"),Me=re("Trident")||re("MSIE"),$e=re("Edge"),Re=$e||Me,Ie=re("Gecko")&&!(-1!=ve().toLowerCase().indexOf("webkit")&&!re("Edge"))&&!(re("Trident")||re("MSIE"))&&!re("Edge"),we=-1!=ve().toLowerCase().indexOf("webkit")&&!re("Edge");function Je(){var u=Er.document;return u?u.documentMode:void 0}e:{var Ne="",ft=(u=ve(),Ie?/rv:([^\);]+)(\)|;)/.exec(u):$e?/Edge\/([\d\.]+)/.exec(u):Me?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(u):we?/WebKit\/(\S+)/.exec(u):ge?/(?:Version)[ \/]?(\S+)/.exec(u):void 0);if(ft&&(Ne=ft?ft[1]:""),Me){var Vt=Je();if(null!=Vt&&Vt>parseFloat(Ne)){Ae=String(Vt);break e}}Ae=Ne}var ar=Er.document&&Me&&(Je()||parseInt(Ae,10))||void 0;function wr(u,e){if(qn.call(this,u?u.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,u){var i=this.type=u.type,h=u.changedTouches&&u.changedTouches.length?u.changedTouches[0]:null;if(this.target=u.target||u.srcElement,this.g=e,e=u.relatedTarget){if(Ie){e:{try{Q(e.nodeName);var v=!0;break e}catch{}v=!1}v||(e=null)}}else"mouseover"==i?e=u.fromElement:"mouseout"==i&&(e=u.toElement);this.relatedTarget=e,h?(this.clientX=void 0!==h.clientX?h.clientX:h.pageX,this.clientY=void 0!==h.clientY?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0):(this.clientX=void 0!==u.clientX?u.clientX:u.pageX,this.clientY=void 0!==u.clientY?u.clientY:u.pageY,this.screenX=u.screenX||0,this.screenY=u.screenY||0),this.button=u.button,this.key=u.key||"",this.ctrlKey=u.ctrlKey,this.altKey=u.altKey,this.shiftKey=u.shiftKey,this.metaKey=u.metaKey,this.pointerId=u.pointerId||0,this.pointerType="string"==typeof u.pointerType?u.pointerType:Hr[u.pointerType]||"",this.state=u.state,this.i=u,u.defaultPrevented&&wr.$.h.call(this)}}Mt(wr,qn);var Hr={2:"touch",3:"pen",4:"mouse"};wr.prototype.h=function(){wr.$.h.call(this);var u=this.i;u.preventDefault?u.preventDefault():u.returnValue=!1};var Li="closure_listenable_"+(1e6*Math.random()|0),$i=0;function Wr(u,e,i,h,v){this.listener=u,this.proxy=null,this.src=e,this.type=i,this.capture=!!h,this.la=v,this.key=++$i,this.fa=this.ia=!1}function _r(u){u.fa=!0,u.listener=null,u.proxy=null,u.src=null,u.la=null}function Bs(u,e,i){for(const h in u)e.call(i,u[h],h,u)}function wa(u){const e={};for(const i in u)e[i]=u[i];return e}const In="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Jt(u,e){let i,h;for(let v=1;v<arguments.length;v++){for(i in h=arguments[v],h)u[i]=h[i];for(let T=0;T<In.length;T++)i=In[T],Object.prototype.hasOwnProperty.call(h,i)&&(u[i]=h[i])}}function Sn(u){this.src=u,this.g={},this.h=0}function Gr(u,e){var i=e.type;if(i in u.g){var T,h=u.g[i],v=vi(h,e);(T=0<=v)&&Array.prototype.splice.call(h,v,1),T&&(_r(e),0==u.g[i].length&&(delete u.g[i],u.h--))}}function gi(u,e,i,h){for(var v=0;v<u.length;++v){var T=u[v];if(!T.fa&&T.listener==e&&T.capture==!!i&&T.la==h)return v}return-1}Sn.prototype.add=function(u,e,i,h,v){var T=u.toString();(u=this.g[T])||(u=this.g[T]=[],this.h++);var D=gi(u,e,h,v);return-1<D?(e=u[D],i||(e.ia=!1)):((e=new Wr(e,this.src,T,!!h,v)).ia=i,u.push(e)),e};var Ii="closure_lm_"+(1e6*Math.random()|0),ki={};function ws(u,e,i,h,v){if(h&&h.once)return Dt(u,e,i,h,v);if(Array.isArray(e)){for(var T=0;T<e.length;T++)ws(u,e[T],i,h,v);return null}return i=Mr(i),u&&u[Li]?u.O(e,i,us(h)?!!h.capture:!!h,v):_i(u,e,i,!1,h,v)}function _i(u,e,i,h,v,T){if(!e)throw Error("Invalid event type");var D=us(v)?!!v.capture:!!v,X=sr(u);if(X||(u[Ii]=X=new Sn(u)),(i=X.add(e,i,h,D,T)).proxy)return i;if(h=function ut(){const e=On;return function u(i){return e.call(u.src,u.listener,i)}}(),i.proxy=h,h.src=u,h.listener=i,u.addEventListener)Fs||(v=D),void 0===v&&(v=!1),u.addEventListener(e.toString(),h,v);else if(u.attachEvent)u.attachEvent(bt(e.toString()),h);else{if(!u.addListener||!u.removeListener)throw Error("addEventListener and attachEvent are unavailable.");u.addListener(h)}return i}function Dt(u,e,i,h,v){if(Array.isArray(e)){for(var T=0;T<e.length;T++)Dt(u,e[T],i,h,v);return null}return i=Mr(i),u&&u[Li]?u.P(e,i,us(h)?!!h.capture:!!h,v):_i(u,e,i,!0,h,v)}function Nt(u,e,i,h,v){if(Array.isArray(e))for(var T=0;T<e.length;T++)Nt(u,e[T],i,h,v);else h=us(h)?!!h.capture:!!h,i=Mr(i),u&&u[Li]?(u=u.i,(e=String(e).toString())in u.g&&-1<(i=gi(T=u.g[e],i,h,v))&&(_r(T[i]),Array.prototype.splice.call(T,i,1),0==T.length&&(delete u.g[e],u.h--))):u&&(u=sr(u))&&(e=u.g[e.toString()],u=-1,e&&(u=gi(e,i,h,v)),(i=-1<u?e[u]:null)&&wn(i))}function wn(u){if("number"!=typeof u&&u&&!u.fa){var e=u.src;if(e&&e[Li])Gr(e.i,u);else{var i=u.type,h=u.proxy;e.removeEventListener?e.removeEventListener(i,h,u.capture):e.detachEvent?e.detachEvent(bt(i),h):e.addListener&&e.removeListener&&e.removeListener(h),(i=sr(e))?(Gr(i,u),0==i.h&&(i.src=null,e[Ii]=null)):_r(u)}}}function bt(u){return u in ki?ki[u]:ki[u]="on"+u}function On(u,e){if(u.fa)u=!0;else{e=new wr(e,this);var i=u.listener,h=u.la||u.src;u.ia&&wn(u),u=i.call(h,e)}return u}function sr(u){return(u=u[Ii])instanceof Sn?u:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mr(u){return"function"==typeof u?u:(u[ei]||(u[ei]=function(e){return u.handleEvent(e)}),u[ei])}function li(){hn.call(this),this.i=new Sn(this),this.S=this,this.J=null}function xi(u,e){var i,h=u.J;if(h)for(i=[];h;h=h.J)i.push(h);if(u=u.S,h=e.type||e,"string"==typeof e)e=new qn(e,u);else if(e instanceof qn)e.target=e.target||u;else{var v=e;Jt(e=new qn(h,u),v)}if(v=!0,i)for(var T=i.length-1;0<=T;T--){var D=e.g=i[T];v=Ds(D,h,!0,e)&&v}if(v=Ds(D=e.g=u,h,!0,e)&&v,v=Ds(D,h,!1,e)&&v,i)for(T=0;T<i.length;T++)v=Ds(D=e.g=i[T],h,!1,e)&&v}function Ds(u,e,i,h){if(!(e=u.i.g[String(e)]))return!0;e=e.concat();for(var v=!0,T=0;T<e.length;++T){var D=e[T];if(D&&!D.fa&&D.capture==i){var X=D.listener,te=D.la||D.src;D.ia&&Gr(u.i,D),v=!1!==X.call(te,h)&&v}}return v&&!h.defaultPrevented}Mt(li,hn),li.prototype[Li]=!0,li.prototype.removeEventListener=function(u,e,i,h){Nt(this,u,e,i,h)},li.prototype.N=function(){if(li.$.N.call(this),this.i){var e,u=this.i;for(e in u.g){for(var i=u.g[e],h=0;h<i.length;h++)_r(i[h]);delete u.g[e],u.h--}}this.J=null},li.prototype.O=function(u,e,i,h){return this.i.add(String(u),e,!1,i,h)},li.prototype.P=function(u,e,i,h){return this.i.add(String(u),e,!0,i,h)};var Vs=Er.JSON.stringify;function ti(){var u=Gi;let e=null;return u.g&&(e=u.g,u.g=u.g.next,u.g||(u.h=null),e.next=null),e}var Ci=new class gr{constructor(e,i){this.i=e,this.j=i,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new _s,u=>u.reset());class _s{constructor(){this.next=this.g=this.h=null}set(e,i){this.h=e,this.g=i,this.next=null}reset(){this.next=this.g=this.h=null}}function br(u){var e=1;u=u.split(":");const i=[];for(;0<e&&u.length;)i.push(u.shift()),e--;return u.length&&i.push(u.join(":")),i}function Ui(u){Er.setTimeout(()=>{throw u},0)}let Mo,bs=!1,Gi=new class qr{constructor(){this.h=this.g=null}add(e,i){const h=Ci.get();h.set(e,i),this.h?this.h.next=h:this.g=h,this.h=h}},ys=()=>{const u=Er.Promise.resolve(void 0);Mo=()=>{u.then(fi)}};var fi=()=>{for(var u;u=ti();){try{u.h.call(u.g)}catch(i){Ui(i)}var e=Ci;e.j(u),100>e.h&&(e.h++,u.next=e.g,e.g=u)}bs=!1};function Pi(u,e){li.call(this),this.h=u||1,this.g=e||Er,this.j=Ce(this.qb,this),this.l=Date.now()}function Fl(u){u.ga=!1,u.T&&(u.g.clearTimeout(u.T),u.T=null)}function Wo(u,e,i){if("function"==typeof u)i&&(u=Ce(u,i));else{if(!u||"function"!=typeof u.handleEvent)throw Error("Invalid listener argument");u=Ce(u.handleEvent,u)}return 2147483647<Number(e)?-1:Er.setTimeout(u,e||0)}function gc(u){u.g=Wo(()=>{u.g=null,u.i&&(u.i=!1,gc(u))},u.j);const e=u.h;u.h=null,u.m.apply(null,e)}Mt(Pi,li),(nr=Pi.prototype).ga=!1,nr.T=null,nr.qb=function(){if(this.ga){var u=Date.now()-this.l;0<u&&u<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-u):(this.T&&(this.g.clearTimeout(this.T),this.T=null),xi(this,"tick"),this.ga&&(Fl(this),this.start()))}},nr.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},nr.N=function(){Pi.$.N.call(this),Fl(this),delete this.g};class Iu extends hn{constructor(e,i){super(),this.m=e,this.j=i,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:gc(this)}N(){super.N(),this.g&&(Er.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function bl(u){hn.call(this),this.h=u,this.g={}}Mt(bl,hn);var Fi=[];function Nr(u,e,i,h){Array.isArray(i)||(i&&(Fi[0]=i.toString()),i=Fi);for(var v=0;v<i.length;v++){var T=ws(e,i[v],h||u.handleEvent,!1,u.h||u);if(!T)break;u.g[T.key]=T}}function eo(u){Bs(u.g,function(e,i){this.g.hasOwnProperty(i)&&wn(e)},u),u.g={}}function to(){this.g=!0}function Tl(u,e,i,h){u.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Ro(u,e){if(!u.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(u=0;u<i.length;u++)if(Array.isArray(i[u])){var h=i[u];if(!(2>h.length)){var v=h[1];if(Array.isArray(v)&&!(1>v.length)){var T=v[0];if("noop"!=T&&"stop"!=T&&"close"!=T)for(var D=1;D<v.length;D++)v[D]=""}}}return Vs(i)}catch{return e}}(u,i)+(h?" "+h:"")})}bl.prototype.N=function(){bl.$.N.call(this),eo(this)},bl.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},to.prototype.Ea=function(){this.g=!1},to.prototype.info=function(){};var Ta={},al=null;function no(){return al=al||new li}function Xo(u){qn.call(this,Ta.Ta,u)}function Za(u){const e=no();xi(e,new Xo(e))}function ia(u,e){qn.call(this,Ta.STAT_EVENT,u),this.stat=e}function hs(u){const e=no();xi(e,new ia(e,u))}function sa(u,e){qn.call(this,Ta.Ua,u),this.size=e}function wi(u,e){if("function"!=typeof u)throw Error("Fn must not be null and must be a function");return Er.setTimeout(function(){u()},e)}Ta.Ta="serverreachability",Mt(Xo,qn),Ta.STAT_EVENT="statevent",Mt(ia,qn),Ta.Ua="timingevent",Mt(sa,qn);var Zs={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Us={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ga(){}function Il(){}ga.prototype.h=null;var Xa,La={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Bo(){qn.call(this,"d")}function _c(){qn.call(this,"c")}function qo(){}function Qo(u,e,i,h){this.l=u,this.j=e,this.m=i,this.W=h||1,this.U=new bl(this),this.P=Fa,this.V=new Pi(u=Re?125:void 0),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ko}function Ko(){this.i=null,this.g="",this.h=!1}Mt(Bo,qn),Mt(_c,qn),Mt(qo,ga),qo.prototype.g=function(){return new XMLHttpRequest},qo.prototype.i=function(){return{}},Xa=new qo;var Fa=45e3,oa={},Bl={};function Qa(u,e,i){u.L=1,u.A=tc(si(e)),u.u=i,u.S=!0,Yc(u,null)}function Yc(u,e){u.G=Date.now(),Ki(u),u.B=si(u.A);var i=u.B,h=u.W;Array.isArray(h)||(h=[String(h)]),Sl(i.i,"t",h),u.o=0,i=u.l.J,u.h=new Ko,u.g=jc(u.l,i?e:null,!u.u),0<u.O&&(u.M=new Iu(Ce(u.Pa,u,u.g),u.O)),Nr(u.U,u.g,"readystatechange",u.nb),e=u.I?wa(u.I):{},u.u?(u.v||(u.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",u.g.ha(u.B,u.v,u.u,e)):(u.v="GET",u.g.ha(u.B,u.v,null,e)),Za(),function ds(u,e,i,h,v,T){u.info(function(){if(u.g)if(T)for(var D="",X=T.split("&"),te=0;te<X.length;te++){var _e=X[te].split("=");if(1<_e.length){var ze=_e[0];_e=_e[1];var vt=ze.split("_");D=2<=vt.length&&"type"==vt[1]?D+(ze+"=")+_e+"&":D+(ze+"=redacted&")}}else D=null;else D=T;return"XMLHTTP REQ ("+h+") [attempt "+v+"]: "+e+"\n"+i+"\n"+D})}(u.j,u.v,u.B,u.m,u.W,u.u)}function So(u){return!!u.g&&"GET"==u.v&&2!=u.L&&u.l.Ha}function Vl(u,e,i){let v,h=!0;for(;!u.J&&u.o<i.length;){if(v=Ul(u,i),v==Bl){4==e&&(u.s=4,hs(14),h=!1),Tl(u.j,u.m,null,"[Incomplete Response]");break}if(v==oa){u.s=4,hs(15),Tl(u.j,u.m,i,"[Invalid Chunk]"),h=!1;break}Tl(u.j,u.m,v,null),Vc(u,v)}So(u)&&0!=u.o&&(u.h.g=u.h.g.slice(u.o),u.o=0),4!=e||0!=i.length||u.h.h||(u.s=1,hs(16),h=!1),u.i=u.i&&h,h?0<i.length&&!u.ba&&(u.ba=!0,(e=u.l).g==u&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),as(e),e.M=!0,hs(11))):(Tl(u.j,u.m,i,"[Invalid Chunked Response]"),Va(u),Ba(u))}function Ul(u,e){var i=u.o,h=e.indexOf("\n",i);return-1==h?Bl:(i=Number(e.substring(i,h)),isNaN(i)?oa:(h+=1)+i>e.length?Bl:(e=e.slice(h,h+i),u.o=h+i,e))}function Ki(u){u.Y=Date.now()+u.P,zl(u,u.P)}function zl(u,e){if(null!=u.C)throw Error("WatchDog timer not null");u.C=wi(Ce(u.lb,u),e)}function aa(u){u.C&&(Er.clearTimeout(u.C),u.C=null)}function Ba(u){0==u.l.H||u.J||la(u.l,u)}function Va(u){aa(u);var e=u.M;e&&"function"==typeof e.sa&&e.sa(),u.M=null,Fl(u.V),eo(u.U),u.g&&(e=u.g,u.g=null,e.abort(),e.sa())}function Vc(u,e){try{var i=u.l;if(0!=i.H&&(i.g==u||Cl(i.i,u)))if(!u.K&&Cl(i.i,u)&&3==i.H){try{var h=i.Ja.g.parse(e)}catch{h=null}if(Array.isArray(h)&&3==h.length){var v=h;if(0==v[0]){e:if(!i.u){if(i.g){if(!(i.g.G+3e3<u.G))break e;Ls(i),ya(i)}io(i),hs(18)}}else i.Fa=v[1],0<i.Fa-i.V&&37500>v[2]&&i.G&&0==i.A&&!i.v&&(i.v=wi(Ce(i.ib,i),6e3));if(1>=Uc(i.i)&&i.oa){try{i.oa()}catch{}i.oa=void 0}}else lc(i,11)}else if((u.K||i.g==u)&&Ls(i),!Zt(e))for(v=i.Ja.g.parse(e),e=0;e<v.length;e++){let _e=v[e];if(i.V=_e[0],_e=_e[1],2==i.H)if("c"==_e[0]){i.K=_e[1],i.pa=_e[2];const ze=_e[3];null!=ze&&(i.ra=ze,i.l.info("VER="+i.ra));const vt=_e[4];null!=vt&&(i.Ga=vt,i.l.info("SVER="+i.Ga));const Xt=_e[5];null!=Xt&&"number"==typeof Xt&&0<Xt&&(i.L=h=1.5*Xt,i.l.info("backChannelRequestTimeoutMs_="+h)),h=i;const un=u.g;if(un){const yr=un.g?un.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(yr){var T=h.i;T.g||-1==yr.indexOf("spdy")&&-1==yr.indexOf("quic")&&-1==yr.indexOf("h2")||(T.j=T.l,T.g=new Set,T.h&&($l(T,T.h),T.h=null))}if(h.F){const Ir=un.g?un.g.getResponseHeader("X-HTTP-Session-Id"):null;Ir&&(h.Da=Ir,zi(h.I,h.F,Ir))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-u.G,i.l.info("Handshake RTT: "+i.S+"ms"));var D=u;if((h=i).wa=Da(h,h.J?h.pa:null,h.Y),D.K){zo(h.i,D);var X=D,te=h.L;te&&X.setTimeout(te),X.C&&(aa(X),Ki(X)),h.g=D}else wc(h);0<i.j.length&&ha(i)}else"stop"!=_e[0]&&"close"!=_e[0]||lc(i,7);else 3==i.H&&("stop"==_e[0]||"close"==_e[0]?"stop"==_e[0]?lc(i,7):ja(i):"noop"!=_e[0]&&i.h&&i.h.Aa(_e),i.A=0)}Za()}catch{}}function Ya(u,e){if(u.forEach&&"function"==typeof u.forEach)u.forEach(e,void 0);else if(Zn(u)||"string"==typeof u)Array.prototype.forEach.call(u,e,void 0);else for(var i=function Ia(u){if(u.ta&&"function"==typeof u.ta)return u.ta();if(!u.Z||"function"!=typeof u.Z){if(typeof Map<"u"&&u instanceof Map)return Array.from(u.keys());if(!(typeof Set<"u"&&u instanceof Set)){if(Zn(u)||"string"==typeof u){var e=[];u=u.length;for(var i=0;i<u;i++)e.push(i);return e}e=[],i=0;for(const h in u)e[i++]=h;return e}}}(u),h=function Vo(u){if(u.Z&&"function"==typeof u.Z)return u.Z();if(typeof Map<"u"&&u instanceof Map||typeof Set<"u"&&u instanceof Set)return Array.from(u.values());if("string"==typeof u)return u.split("");if(Zn(u)){for(var e=[],i=u.length,h=0;h<i;h++)e.push(u[h]);return e}for(h in e=[],i=0,u)e[i++]=u[h];return e}(u),v=h.length,T=0;T<v;T++)e.call(void 0,h[T],i&&i[T],u)}(nr=Qo.prototype).setTimeout=function(u){this.P=u},nr.nb=function(u){u=u.target;const e=this.M;e&&3==yo(u)?e.l():this.Pa(u)},nr.Pa=function(u){try{if(u==this.g)e:{const ze=yo(this.g);var e=this.g.Ia();if(this.g.da(),!(3>ze)&&(3!=ze||Re||this.g&&(this.h.h||this.g.ja()||Hl(this.g)))){this.J||4!=ze||7==e||Za(),aa(this);var i=this.g.da();this.ca=i;t:if(So(this)){var h=Hl(this.g);u="";var v=h.length,T=4==yo(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Va(this),Ba(this);var D="";break t}this.h.i=new Er.TextDecoder}for(e=0;e<v;e++)this.h.h=!0,u+=this.h.i.decode(h[e],{stream:T&&e==v-1});h.length=0,this.h.g+=u,this.o=0,D=this.h.g}else D=this.g.ja();if(this.i=200==i,function Bc(u,e,i,h,v,T,D){u.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+v+"]: "+e+"\n"+i+"\n"+T+" "+D})}(this.j,this.v,this.B,this.m,this.W,ze,i),this.i){if(this.aa&&!this.K){t:{if(this.g){var X,te=this.g;if((X=te.g?te.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Zt(X)){var _e=X;break t}}_e=null}if(!(i=_e)){this.i=!1,this.s=3,hs(12),Va(this),Ba(this);break e}Tl(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vc(this,i)}this.S?(Vl(this,ze,D),Re&&this.i&&3==ze&&(Nr(this.U,this.V,"tick",this.mb),this.V.start())):(Tl(this.j,this.m,D,null),Vc(this,D)),4==ze&&Va(this),this.i&&!this.J&&(4==ze?la(this.l,this):(this.i=!1,Ki(this)))}else(function hu(u){const e={};u=(u.g&&2<=yo(u)&&u.g.getAllResponseHeaders()||"").split("\r\n");for(let h=0;h<u.length;h++){if(Zt(u[h]))continue;var i=br(u[h]);const v=i[0];if("string"!=typeof(i=i[1]))continue;i=i.trim();const T=e[v]||[];e[v]=T,T.push(i)}!function ra(u,e){for(const i in u)e.call(void 0,u[i],i,u)}(e,function(h){return h.join(", ")})})(this.g),400==i&&0<D.indexOf("Unknown SID")?(this.s=3,hs(12)):(this.s=0,hs(13)),Va(this),Ba(this)}}}catch{}},nr.mb=function(){if(this.g){var u=yo(this.g),e=this.g.ja();this.o<e.length&&(aa(this),Vl(this,u,e),this.i&&4!=u&&Ki(this))}},nr.cancel=function(){this.J=!0,Va(this)},nr.lb=function(){this.C=null;const u=Date.now();0<=u-this.Y?(function ba(u,e){u.info(function(){return"TIMEOUT: "+e})}(this.j,this.B),2!=this.L&&(Za(),hs(17)),Va(this),this.s=2,Ba(this)):zl(this,this.Y-u)};var Ua=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ro(u){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,u instanceof ro){this.h=u.h,Aa(this,u.j),this.s=u.s,this.g=u.g,Po(this,u.m),this.l=u.l;var e=u.i,i=new da;i.i=e.i,e.g&&(i.g=new Map(e.g),i.h=e.h),_a(this,i),this.o=u.o}else u&&(e=String(u).match(Ua))?(this.h=!1,Aa(this,e[1]||"",!0),this.s=Uo(e[2]||""),this.g=Uo(e[3]||"",!0),Po(this,e[4]),this.l=Uo(e[5]||"",!0),_a(this,e[6]||"",!0),this.o=Uo(e[7]||"")):(this.h=!1,this.i=new da(null,this.h))}function si(u){return new ro(u)}function Aa(u,e,i){u.j=i?Uo(e,!0):e,u.j&&(u.j=u.j.replace(/:$/,""))}function Po(u,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);u.m=e}else u.m=null}function _a(u,e,i){e instanceof da?(u.i=e,function Mc(u,e){e&&!u.j&&(vs(u),u.i=null,u.g.forEach(function(i,h){var v=h.toLowerCase();h!=v&&(el(this,h),Sl(this,v,i))},u)),u.j=e}(u.i,u.h)):(i||(e=za(e,nc)),u.i=new da(e,u.h))}function zi(u,e,i){u.i.set(e,i)}function tc(u){return zi(u,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),u}function Uo(u,e){return u?e?decodeURI(u.replace(/%25/g,"%2525")):decodeURIComponent(u):""}function za(u,e,i){return"string"==typeof u?(u=encodeURI(u).replace(e,ns),i&&(u=u.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u):null}function ns(u){return"%"+((u=u.charCodeAt(0))>>4&15).toString(16)+(15&u).toString(16)}ro.prototype.toString=function(){var u=[],e=this.j;e&&u.push(za(e,ll,!0),":");var i=this.g;return(i||"file"==e)&&(u.push("//"),(e=this.s)&&u.push(za(e,ll,!0),"@"),u.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&u.push(":",String(i))),(i=this.l)&&(this.g&&"/"!=i.charAt(0)&&u.push("/"),u.push(za(i,"/"==i.charAt(0)?cl:Hi,!0))),(i=this.i.toString())&&u.push("?",i),(i=this.o)&&u.push("#",za(i,Ja)),u.join("")};var ll=/[#\/\?@]/g,Hi=/[#\?:]/g,cl=/[#\?]/g,nc=/[#\?@]/g,Ja=/#/g;function da(u,e){this.h=this.g=null,this.i=u||null,this.j=!!e}function vs(u){u.g||(u.g=new Map,u.h=0,u.i&&function Sa(u,e){if(u){u=u.split("&");for(var i=0;i<u.length;i++){var h=u[i].indexOf("="),v=null;if(0<=h){var T=u[i].substring(0,h);v=u[i].substring(h+1)}else T=u[i];e(T,v?decodeURIComponent(v.replace(/\+/g," ")):"")}}}(u.i,function(e,i){u.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}function el(u,e){vs(u),e=wo(u,e),u.g.has(e)&&(u.i=null,u.h-=u.g.get(e).length,u.g.delete(e))}function uu(u,e){return vs(u),e=wo(u,e),u.g.has(e)}function Sl(u,e,i){el(u,e),0<i.length&&(u.i=null,u.g.set(wo(u,e),$r(i)),u.h+=i.length)}function wo(u,e){return e=String(e),u.j&&(e=e.toLowerCase()),e}(nr=da.prototype).add=function(u,e){vs(this),this.i=null,u=wo(this,u);var i=this.g.get(u);return i||this.g.set(u,i=[]),i.push(e),this.h+=1,this},nr.forEach=function(u,e){vs(this),this.g.forEach(function(i,h){i.forEach(function(v){u.call(e,v,h,this)},this)},this)},nr.ta=function(){vs(this);const u=Array.from(this.g.values()),e=Array.from(this.g.keys()),i=[];for(let h=0;h<e.length;h++){const v=u[h];for(let T=0;T<v.length;T++)i.push(e[h])}return i},nr.Z=function(u){vs(this);let e=[];if("string"==typeof u)uu(this,u)&&(e=e.concat(this.g.get(wo(this,u))));else{u=Array.from(this.g.values());for(let i=0;i<u.length;i++)e=e.concat(u[i])}return e},nr.set=function(u,e){return vs(this),this.i=null,uu(this,u=wo(this,u))&&(this.h-=this.g.get(u).length),this.g.set(u,[e]),this.h+=1,this},nr.get=function(u,e){return u&&0<(u=this.Z(u)).length?String(u[0]):e},nr.toString=function(){if(this.i)return this.i;if(!this.g)return"";const u=[],e=Array.from(this.g.keys());for(var i=0;i<e.length;i++){var h=e[i];const T=encodeURIComponent(String(h)),D=this.Z(h);for(h=0;h<D.length;h++){var v=T;""!==D[h]&&(v+="="+encodeURIComponent(String(D[h]))),u.push(v)}}return this.i=u.join("&")};var Al=class{constructor(u,e){this.g=u,this.map=e}};function rc(u){this.l=u||Ts,u=Er.PerformanceNavigationTiming?0<(u=Er.performance.getEntriesByType("navigation")).length&&("hq"==u[0].nextHopProtocol||"h2"==u[0].nextHopProtocol):!!(Er.g&&Er.g.Ka&&Er.g.Ka()&&Er.g.Ka().dc),this.j=u?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ts=10;function jl(u){return!!u.h||!!u.g&&u.g.size>=u.j}function Uc(u){return u.h?1:u.g?u.g.size:0}function Cl(u,e){return u.h?u.h==e:!!u.g&&u.g.has(e)}function $l(u,e){u.g?u.g.add(e):u.h=e}function zo(u,e){u.h&&u.h==e?u.h=null:u.g&&u.g.has(e)&&u.g.delete(e)}function yc(u){if(null!=u.h)return u.i.concat(u.h.F);if(null!=u.g&&0!==u.g.size){let e=u.i;for(const i of u.g.values())e=e.concat(i.F);return e}return $r(u.i)}rc.prototype.cancel=function(){if(this.i=yc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const u of this.g.values())u.cancel();this.g.clear()}};var Ca=class{stringify(u){return Er.JSON.stringify(u,void 0)}parse(u){return Er.JSON.parse(u,void 0)}};function Jc(){this.g=new Ca}function vc(u,e,i){const h=i||"";try{Ya(u,function(v,T){let D=v;us(v)&&(D=Vs(v)),e.push(h+T+"="+encodeURIComponent(D))})}catch(v){throw e.push(h+"type="+encodeURIComponent("_badmap")),v}}function ic(u,e,i,h,v){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,v(h)}catch{}}function Dl(u){this.l=u.ec||null,this.j=u.ob||!1}function xc(u,e){li.call(this),this.F=u,this.u=e,this.m=void 0,this.readyState=Bi,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Mt(Dl,ga),Dl.prototype.g=function(){return new xc(this.l,this.j)},Dl.prototype.i=function(u){return function(){return u}}({}),Mt(xc,li);var Bi=0;function $s(u){u.j.read().then(u.Xa.bind(u)).catch(u.ka.bind(u))}function Is(u){u.readyState=4,u.l=null,u.j=null,u.A=null,Yo(u)}function Yo(u){u.onreadystatechange&&u.onreadystatechange.call(u)}(nr=xc.prototype).open=function(u,e){if(this.readyState!=Bi)throw this.abort(),Error("Error reopening a connection");this.C=u,this.B=e,this.readyState=1,Yo(this)},nr.send=function(u){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};u&&(e.body=u),(this.F||Er).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},nr.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Is(this)),this.readyState=Bi},nr.$a=function(u){if(this.g&&(this.l=u,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=u.headers,this.readyState=2,Yo(this)),this.g&&(this.readyState=3,Yo(this),this.g)))if("arraybuffer"===this.responseType)u.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Er.ReadableStream<"u"&&"body"in u){if(this.j=u.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;$s(this)}else u.text().then(this.Za.bind(this),this.ka.bind(this))},nr.Xa=function(u){if(this.g){if(this.u&&u.value)this.response.push(u.value);else if(!this.u){var e=u.value?u.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!u.done}))&&(this.response=this.responseText+=e)}u.done?Is(this):Yo(this),3==this.readyState&&$s(this)}},nr.Za=function(u){this.g&&(this.response=this.responseText=u,Is(this))},nr.Ya=function(u){this.g&&(this.response=u,Is(this))},nr.ka=function(){this.g&&Is(this)},nr.setRequestHeader=function(u,e){this.v.append(u,e)},nr.getResponseHeader=function(u){return this.h&&this.h.get(u.toLowerCase())||""},nr.getAllResponseHeaders=function(){if(!this.h)return"";const u=[],e=this.h.entries();for(var i=e.next();!i.done;)u.push((i=i.value)[0]+": "+i[1]),i=e.next();return u.join("\r\n")},Object.defineProperty(xc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(u){this.m=u?"include":"same-origin"}});var uo=Er.JSON.parse;function Ns(u){li.call(this),this.headers=new Map,this.u=u||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Ml,this.L=this.M=!1}Mt(Ns,li);var Ml="",tl=/^https?$/i,du=["POST","PUT"];function nl(u,e){u.h=!1,u.g&&(u.l=!0,u.g.abort(),u.l=!1),u.j=e,u.m=5,sc(u),Ec(u)}function sc(u){u.F||(u.F=!0,xi(u,"complete"),xi(u,"error"))}function os(u){if(u.h&&typeof mr<"u"&&(!u.C[1]||4!=yo(u)||2!=u.da()))if(u.v&&4==yo(u))Wo(u.La,0,u);else if(xi(u,"readystatechange"),4==yo(u)){u.h=!1;try{const D=u.da();e:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var i;if(!(i=e)){var h;if(h=0===D){var v=String(u.I).match(Ua)[1]||null;!v&&Er.self&&Er.self.location&&(v=Er.self.location.protocol.slice(0,-1)),h=!tl.test(v?v.toLowerCase():"")}i=h}if(i)xi(u,"complete"),xi(u,"success");else{u.m=6;try{var T=2<yo(u)?u.g.statusText:""}catch{T=""}u.j=T+" ["+u.da()+"]",sc(u)}}finally{Ec(u)}}}function Ec(u,e){if(u.g){zc(u);const i=u.g,h=u.C[0]?()=>{}:null;u.g=null,u.C=null,e||xi(u,"ready");try{i.onreadystatechange=h}catch{}}}function zc(u){u.g&&u.L&&(u.g.ontimeout=null),u.A&&(Er.clearTimeout(u.A),u.A=null)}function yo(u){return u.g?u.g.readyState:0}function Hl(u){try{if(!u.g)return null;if("response"in u.g)return u.g.response;switch(u.K){case Ml:case"text":return u.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in u.g)return u.g.mozResponseArrayBuffer}return null}catch{return null}}function oc(u){let e="";return Bs(u,function(i,h){e+=h,e+=":",e+=i,e+="\r\n"}),e}function Ps(u,e,i){e:{for(h in i){var h=!1;break e}h=!0}h||(i=oc(i),"string"==typeof u?null!=i&&encodeURIComponent(String(i)):zi(u,e,i))}function gs(u,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[u]||e}function Wl(u){this.Ga=0,this.j=[],this.l=new to,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=gs("failFast",!1,u),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=gs("baseRetryDelayMs",5e3,u),this.hb=gs("retryDelaySeedMs",1e4,u),this.eb=gs("forwardChannelMaxRetries",2,u),this.xa=gs("forwardChannelRequestTimeoutMs",2e4,u),this.va=u&&u.xmlHttpFactory||void 0,this.Ha=u&&u.useFetchStreams||!1,this.L=void 0,this.J=u&&u.supportsCrossDomainXhr||!1,this.K="",this.i=new rc(u&&u.concurrentRequestLimit),this.Ja=new Jc,this.P=u&&u.fastHandshake||!1,this.O=u&&u.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=u&&u.bc||!1,u&&u.Ea&&this.l.Ea(),u&&u.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&u&&u.detectBufferingProxy||!1,this.qa=void 0,u&&u.longPollingTimeout&&0<u.longPollingTimeout&&(this.qa=u.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function ja(u){if(ac(u),3==u.H){var e=u.W++,i=si(u.I);if(zi(i,"SID",u.K),zi(i,"RID",e),zi(i,"TYPE","terminate"),ho(u,i),(e=new Qo(u,u.l,e)).L=2,e.A=tc(si(i)),i=!1,Er.navigator&&Er.navigator.sendBeacon)try{i=Er.navigator.sendBeacon(e.A.toString(),"")}catch{}!i&&Er.Image&&((new Image).src=e.A,i=!0),i||(e.g=jc(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ki(e)}va(u)}function ya(u){u.g&&(as(u),u.g.cancel(),u.g=null)}function ac(u){ya(u),u.u&&(Er.clearTimeout(u.u),u.u=null),Ls(u),u.i.cancel(),u.m&&("number"==typeof u.m&&Er.clearTimeout(u.m),u.m=null)}function ha(u){if(!jl(u.i)&&!u.m){u.m=!0;var e=u.Na;Mo||ys(),bs||(Mo(),bs=!0),Gi.add(e,u),u.C=0}}function Rl(u,e){var i;i=e?e.m:u.W++;const h=si(u.I);zi(h,"SID",u.K),zi(h,"RID",i),zi(h,"AID",u.V),ho(u,h),u.o&&u.s&&Ps(h,u.o,u.s),i=new Qo(u,u.l,i,u.C+1),null===u.o&&(i.I=u.s),e&&(u.j=e.F.concat(u.j)),e=$a(u,i,1e3),i.setTimeout(Math.round(.5*u.xa)+Math.round(.5*u.xa*Math.random())),$l(u.i,i),Qa(i,h,e)}function ho(u,e){u.na&&Bs(u.na,function(i,h){zi(e,h,i)}),u.h&&Ya({},function(i,h){zi(e,h,i)})}function $a(u,e,i){i=Math.min(u.j.length,i);var h=u.h?Ce(u.h.Va,u.h,u):null;e:{var v=u.j;let T=-1;for(;;){const D=["count="+i];-1==T?0<i?(T=v[0].g,D.push("ofs="+T)):T=0:D.push("ofs="+T);let X=!0;for(let te=0;te<i;te++){let _e=v[te].g;const ze=v[te].map;if(_e-=T,0>_e)T=Math.max(0,v[te].g-100),X=!1;else try{vc(ze,D,"req"+_e+"_")}catch{h&&h(ze)}}if(X){h=D.join("&");break e}}}return u=u.j.splice(0,i),e.F=u,h}function wc(u){if(!u.g&&!u.u){u.ba=1;var e=u.Ma;Mo||ys(),bs||(Mo(),bs=!0),Gi.add(e,u),u.A=0}}function io(u){return!(u.g||u.u||3<=u.A||(u.ba++,u.u=wi(Ce(u.Ma,u),ul(u,u.A)),u.A++,0))}function as(u){null!=u.B&&(Er.clearTimeout(u.B),u.B=null)}function Pl(u){u.g=new Qo(u,u.l,"rpc",u.ba),null===u.o&&(u.g.I=u.s),u.g.O=0;var e=si(u.wa);zi(e,"RID","rpc"),zi(e,"SID",u.K),zi(e,"AID",u.V),zi(e,"CI",u.G?"0":"1"),!u.G&&u.qa&&zi(e,"TO",u.qa),zi(e,"TYPE","xmlhttp"),ho(u,e),u.o&&u.s&&Ps(e,u.o,u.s),u.L&&u.g.setTimeout(u.L);var i=u.g;u=u.pa,i.L=1,i.A=tc(si(e)),i.u=null,i.S=!0,Yc(i,u)}function Ls(u){null!=u.v&&(Er.clearTimeout(u.v),u.v=null)}function la(u,e){var i=null;if(u.g==e){Ls(u),as(u),u.g=null;var h=2}else{if(!Cl(u.i,e))return;i=e.F,zo(u.i,e),h=1}if(0!=u.H)if(e.i)if(1==h){i=e.u?e.u.length:0,e=Date.now()-e.G;var v=u.C;xi(h=no(),new sa(h,i)),ha(u)}else wc(u);else if(3==(v=e.s)||0==v&&0<e.ca||!(1==h&&function ql(u,e){return!(Uc(u.i)>=u.i.j-(u.m?1:0)||(u.m?(u.j=e.F.concat(u.j),0):1==u.H||2==u.H||u.C>=(u.cb?0:u.eb)||(u.m=wi(Ce(u.Na,u,e),ul(u,u.C)),u.C++,0)))}(u,e)||2==h&&io(u)))switch(i&&0<i.length&&(e=u.i,e.i=e.i.concat(i)),v){case 1:lc(u,5);break;case 4:lc(u,10);break;case 3:lc(u,6);break;default:lc(u,2)}}function ul(u,e){let i=u.ab+Math.floor(Math.random()*u.hb);return u.isActive()||(i*=2),i*e}function lc(u,e){if(u.l.info("Error code "+e),2==e){var i=null;u.h&&(i=null);var h=Ce(u.pb,u);i||(i=new ro("//www.google.com/images/cleardot.gif"),Er.location&&"http"==Er.location.protocol||Aa(i,"https"),tc(i)),function Gl(u,e){const i=new to;if(Er.Image){const h=new Image;h.onload=pt(ic,i,h,"TestLoadImage: loaded",!0,e),h.onerror=pt(ic,i,h,"TestLoadImage: error",!1,e),h.onabort=pt(ic,i,h,"TestLoadImage: abort",!1,e),h.ontimeout=pt(ic,i,h,"TestLoadImage: timeout",!1,e),Er.setTimeout(function(){h.ontimeout&&h.ontimeout()},1e4),h.src=u}else e(!1)}(i.toString(),h)}else hs(2);u.H=0,u.h&&u.h.za(e),va(u),ac(u)}function va(u){if(u.H=0,u.ma=[],u.h){const e=yc(u.i);(0!=e.length||0!=u.j.length)&&(ci(u.ma,e),ci(u.ma,u.j),u.i.i.length=0,$r(u.j),u.j.length=0),u.h.ya()}}function Da(u,e,i){var h=i instanceof ro?si(i):new ro(i);if(""!=h.g)e&&(h.g=e+"."+h.g),Po(h,h.m);else{var v=Er.location;h=v.protocol,e=e?e+"."+v.hostname:v.hostname,v=+v.port;var T=new ro(null);h&&Aa(T,h),e&&(T.g=e),v&&Po(T,v),i&&(T.l=i),h=T}return e=u.Da,(i=u.F)&&e&&zi(h,i,e),zi(h,"VER",u.ra),ho(u,h),h}function jc(u,e,i){if(e&&!u.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ns(u.Ha&&!u.va?new Dl({ob:i}):u.va)).Oa(u.J),e}function W(){}function ke(){if(Me&&!(10<=Number(ar)))throw Error("Environmental error: no available transport.")}function ie(u,e){li.call(this),this.g=new Wl(e),this.l=u,this.h=e&&e.messageUrlParams||null,u=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(u?u["X-Client-Protocol"]="webchannel":u={"X-Client-Protocol":"webchannel"}),this.g.s=u,u=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(u?u["X-WebChannel-Content-Type"]=e.messageContentType:u={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(u?u["X-WebChannel-Client-Profile"]=e.Ca:u={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=u,(u=e&&e.cc)&&!Zt(u)&&(this.g.o=u),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Zt(e)&&(this.g.F=e,null!==(u=this.h)&&e in u&&e in(u=this.h)&&delete u[e]),this.j=new _n(this)}function be(u){Bo.call(this),u.__headers__&&(this.headers=u.__headers__,this.statusCode=u.__status__,delete u.__headers__,delete u.__status__);var e=u.__sm__;if(e){e:{for(const i in e){u=i;break e}u=void 0}(this.i=u)&&(u=this.i,e=null!==e&&u in e?e[u]:void 0),this.data=e}else this.data=u}function wt(){_c.call(this),this.status=1}function _n(u){this.g=u}function Ar(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Xn(u,e,i){i||(i=0);var h=Array(16);if("string"==typeof e)for(var v=0;16>v;++v)h[v]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(v=0;16>v;++v)h[v]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;var T=u.g[3],D=(e=u.g[0])+(T^(i=u.g[1])&((v=u.g[2])^T))+h[0]+3614090360&4294967295;D=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=(i=(v=(T=(e=i+(D<<7&4294967295|D>>>25))+((D=T+(v^e&(i^v))+h[1]+3905402710&4294967295)<<12&4294967295|D>>>20))+((D=v+(i^T&(e^i))+h[2]+606105819&4294967295)<<17&4294967295|D>>>15))+((D=i+(e^v&(T^e))+h[3]+3250441966&4294967295)<<22&4294967295|D>>>10))+((D=e+(T^i&(v^T))+h[4]+4118548399&4294967295)<<7&4294967295|D>>>25))+((D=T+(v^e&(i^v))+h[5]+1200080426&4294967295)<<12&4294967295|D>>>20))+((D=v+(i^T&(e^i))+h[6]+2821735955&4294967295)<<17&4294967295|D>>>15))+((D=i+(e^v&(T^e))+h[7]+4249261313&4294967295)<<22&4294967295|D>>>10))+((D=e+(T^i&(v^T))+h[8]+1770035416&4294967295)<<7&4294967295|D>>>25))+((D=T+(v^e&(i^v))+h[9]+2336552879&4294967295)<<12&4294967295|D>>>20))+((D=v+(i^T&(e^i))+h[10]+4294925233&4294967295)<<17&4294967295|D>>>15))+((D=i+(e^v&(T^e))+h[11]+2304563134&4294967295)<<22&4294967295|D>>>10))+((D=e+(T^i&(v^T))+h[12]+1804603682&4294967295)<<7&4294967295|D>>>25))+((D=T+(v^e&(i^v))+h[13]+4254626195&4294967295)<<12&4294967295|D>>>20))+((D=v+(i^T&(e^i))+h[14]+2792965006&4294967295)<<17&4294967295|D>>>15))+((D=i+(e^v&(T^e))+h[15]+1236535329&4294967295)<<22&4294967295|D>>>10))+((D=e+(v^T&(i^v))+h[1]+4129170786&4294967295)<<5&4294967295|D>>>27))+((D=T+(i^v&(e^i))+h[6]+3225465664&4294967295)<<9&4294967295|D>>>23))+((D=v+(e^i&(T^e))+h[11]+643717713&4294967295)<<14&4294967295|D>>>18))+((D=i+(T^e&(v^T))+h[0]+3921069994&4294967295)<<20&4294967295|D>>>12))+((D=e+(v^T&(i^v))+h[5]+3593408605&4294967295)<<5&4294967295|D>>>27))+((D=T+(i^v&(e^i))+h[10]+38016083&4294967295)<<9&4294967295|D>>>23))+((D=v+(e^i&(T^e))+h[15]+3634488961&4294967295)<<14&4294967295|D>>>18))+((D=i+(T^e&(v^T))+h[4]+3889429448&4294967295)<<20&4294967295|D>>>12))+((D=e+(v^T&(i^v))+h[9]+568446438&4294967295)<<5&4294967295|D>>>27))+((D=T+(i^v&(e^i))+h[14]+3275163606&4294967295)<<9&4294967295|D>>>23))+((D=v+(e^i&(T^e))+h[3]+4107603335&4294967295)<<14&4294967295|D>>>18))+((D=i+(T^e&(v^T))+h[8]+1163531501&4294967295)<<20&4294967295|D>>>12))+((D=e+(v^T&(i^v))+h[13]+2850285829&4294967295)<<5&4294967295|D>>>27))+((D=T+(i^v&(e^i))+h[2]+4243563512&4294967295)<<9&4294967295|D>>>23))+((D=v+(e^i&(T^e))+h[7]+1735328473&4294967295)<<14&4294967295|D>>>18))+((D=i+(T^e&(v^T))+h[12]+2368359562&4294967295)<<20&4294967295|D>>>12))+((D=e+(i^v^T)+h[5]+4294588738&4294967295)<<4&4294967295|D>>>28))+((D=T+(e^i^v)+h[8]+2272392833&4294967295)<<11&4294967295|D>>>21))+((D=v+(T^e^i)+h[11]+1839030562&4294967295)<<16&4294967295|D>>>16))+((D=i+(v^T^e)+h[14]+4259657740&4294967295)<<23&4294967295|D>>>9))+((D=e+(i^v^T)+h[1]+2763975236&4294967295)<<4&4294967295|D>>>28))+((D=T+(e^i^v)+h[4]+1272893353&4294967295)<<11&4294967295|D>>>21))+((D=v+(T^e^i)+h[7]+4139469664&4294967295)<<16&4294967295|D>>>16))+((D=i+(v^T^e)+h[10]+3200236656&4294967295)<<23&4294967295|D>>>9))+((D=e+(i^v^T)+h[13]+681279174&4294967295)<<4&4294967295|D>>>28))+((D=T+(e^i^v)+h[0]+3936430074&4294967295)<<11&4294967295|D>>>21))+((D=v+(T^e^i)+h[3]+3572445317&4294967295)<<16&4294967295|D>>>16))+((D=i+(v^T^e)+h[6]+76029189&4294967295)<<23&4294967295|D>>>9))+((D=e+(i^v^T)+h[9]+3654602809&4294967295)<<4&4294967295|D>>>28))+((D=T+(e^i^v)+h[12]+3873151461&4294967295)<<11&4294967295|D>>>21))+((D=v+(T^e^i)+h[15]+530742520&4294967295)<<16&4294967295|D>>>16))+((D=i+(v^T^e)+h[2]+3299628645&4294967295)<<23&4294967295|D>>>9))+((D=e+(v^(i|~T))+h[0]+4096336452&4294967295)<<6&4294967295|D>>>26))+((D=T+(i^(e|~v))+h[7]+1126891415&4294967295)<<10&4294967295|D>>>22))+((D=v+(e^(T|~i))+h[14]+2878612391&4294967295)<<15&4294967295|D>>>17))+((D=i+(T^(v|~e))+h[5]+4237533241&4294967295)<<21&4294967295|D>>>11))+((D=e+(v^(i|~T))+h[12]+1700485571&4294967295)<<6&4294967295|D>>>26))+((D=T+(i^(e|~v))+h[3]+2399980690&4294967295)<<10&4294967295|D>>>22))+((D=v+(e^(T|~i))+h[10]+4293915773&4294967295)<<15&4294967295|D>>>17))+((D=i+(T^(v|~e))+h[1]+2240044497&4294967295)<<21&4294967295|D>>>11))+((D=e+(v^(i|~T))+h[8]+1873313359&4294967295)<<6&4294967295|D>>>26))+((D=T+(i^(e|~v))+h[15]+4264355552&4294967295)<<10&4294967295|D>>>22))+((D=v+(e^(T|~i))+h[6]+2734768916&4294967295)<<15&4294967295|D>>>17))+((D=i+(T^(v|~e))+h[13]+1309151649&4294967295)<<21&4294967295|D>>>11))+((T=(e=i+((D=e+(v^(i|~T))+h[4]+4149444226&4294967295)<<6&4294967295|D>>>26))+((D=T+(i^(e|~v))+h[11]+3174756917&4294967295)<<10&4294967295|D>>>22))^((v=T+((D=v+(e^(T|~i))+h[2]+718787259&4294967295)<<15&4294967295|D>>>17))|~e))+h[9]+3951481745&4294967295,u.g[0]=u.g[0]+e&4294967295,u.g[1]=u.g[1]+(v+(D<<21&4294967295|D>>>11))&4294967295,u.g[2]=u.g[2]+v&4294967295,u.g[3]=u.g[3]+T&4294967295}function Qr(u,e){this.h=e;for(var i=[],h=!0,v=u.length-1;0<=v;v--){var T=0|u[v];h&&T==e||(i[v]=T,h=!1)}this.g=i}(nr=Ns.prototype).Oa=function(u){this.M=u},nr.ha=function(u,e,i,h){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+u);e=e?e.toUpperCase():"GET",this.I=u,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Xa.g(),this.C=function Ei(u){return u.h||(u.h=u.i())}(this.u?this.u:Xa),this.g.onreadystatechange=Ce(this.La,this);try{this.G=!0,this.g.open(e,String(u),!0),this.G=!1}catch(T){return void nl(this,T)}if(u=i||"",i=new Map(this.headers),h)if(Object.getPrototypeOf(h)===Object.prototype)for(var v in h)i.set(v,h[v]);else{if("function"!=typeof h.keys||"function"!=typeof h.get)throw Error("Unknown input type for opt_headers: "+String(h));for(const T of h.keys())i.set(T,h.get(T))}h=Array.from(i.keys()).find(T=>"content-type"==T.toLowerCase()),v=Er.FormData&&u instanceof Er.FormData,!(0<=vi(du,e))||h||v||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[T,D]of i)this.g.setRequestHeader(T,D);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{zc(this),0<this.B&&((this.L=function eu(u){return Me&&"number"==typeof u.timeout&&void 0!==u.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ce(this.ua,this)):this.A=Wo(this.ua,this.B,this)),this.v=!0,this.g.send(u),this.v=!1}catch(T){nl(this,T)}},nr.ua=function(){typeof mr<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xi(this,"timeout"),this.abort(8))},nr.abort=function(u){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=u||7,xi(this,"complete"),xi(this,"abort"),Ec(this))},nr.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ec(this,!0)),Ns.$.N.call(this)},nr.La=function(){this.s||(this.G||this.v||this.l?os(this):this.kb())},nr.kb=function(){os(this)},nr.isActive=function(){return!!this.g},nr.da=function(){try{return 2<yo(this)?this.g.status:-1}catch{return-1}},nr.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},nr.Wa=function(u){if(this.g){var e=this.g.responseText;return u&&0==e.indexOf(u)&&(e=e.substring(u.length)),uo(e)}},nr.Ia=function(){return this.m},nr.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(nr=Wl.prototype).ra=8,nr.H=1,nr.Na=function(u){if(this.m)if(this.m=null,1==this.H){if(!u){this.W=Math.floor(1e5*Math.random()),u=this.W++;const v=new Qo(this,this.l,u);let T=this.s;if(this.U&&(T?(T=wa(T),Jt(T,this.U)):T=this.U),null!==this.o||this.O||(v.I=T,T=null),this.P)e:{for(var e=0,i=0;i<this.j.length;i++){var h=this.j[i];if(void 0===(h="__data__"in h.map&&"string"==typeof(h=h.map.__data__)?h.length:void 0))break;if(4096<(e+=h)){e=i;break e}if(4096===e||i===this.j.length-1){e=i+1;break e}}e=1e3}else e=1e3;e=$a(this,v,e),zi(i=si(this.I),"RID",u),zi(i,"CVER",22),this.F&&zi(i,"X-HTTP-Session-Id",this.F),ho(this,i),T&&(this.O?e="headers="+encodeURIComponent(String(oc(T)))+"&"+e:this.o&&Ps(i,this.o,T)),$l(this.i,v),this.bb&&zi(i,"TYPE","init"),this.P?(zi(i,"$req",e),zi(i,"SID","null"),v.aa=!0,Qa(v,i,null)):Qa(v,i,e),this.H=2}}else 3==this.H&&(u?Rl(this,u):0==this.j.length||jl(this.i)||Rl(this))},nr.Ma=function(){if(this.u=null,Pl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var u=2*this.S;this.l.info("BP detection timer enabled: "+u),this.B=wi(Ce(this.jb,this),u)}},nr.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,hs(10),ya(this),Pl(this))},nr.ib=function(){null!=this.v&&(this.v=null,ya(this),io(this),hs(19))},nr.pb=function(u){u?(this.l.info("Successfully pinged google.com"),hs(2)):(this.l.info("Failed to ping google.com"),hs(1))},nr.isActive=function(){return!!this.h&&this.h.isActive(this)},(nr=W.prototype).Ba=function(){},nr.Aa=function(){},nr.za=function(){},nr.ya=function(){},nr.isActive=function(){return!0},nr.Va=function(){},ke.prototype.g=function(u,e){return new ie(u,e)},Mt(ie,li),ie.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var u=this.g,e=this.l,i=this.h||void 0;hs(0),u.Y=e,u.na=i||{},u.G=u.aa,u.I=Da(u,null,u.Y),ha(u)},ie.prototype.close=function(){ja(this.g)},ie.prototype.u=function(u){var e=this.g;if("string"==typeof u){var i={};i.__data__=u,u=i}else this.v&&((i={}).__data__=Vs(u),u=i);e.j.push(new Al(e.fb++,u)),3==e.H&&ha(e)},ie.prototype.N=function(){this.g.h=null,delete this.j,ja(this.g),delete this.g,ie.$.N.call(this)},Mt(be,Bo),Mt(wt,_c),Mt(_n,W),_n.prototype.Ba=function(){xi(this.g,"a")},_n.prototype.Aa=function(u){xi(this.g,new be(u))},_n.prototype.za=function(u){xi(this.g,new wt)},_n.prototype.ya=function(){xi(this.g,"b")},Mt(Ar,function Gn(){this.blockSize=-1}),Ar.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Ar.prototype.j=function(u,e){void 0===e&&(e=u.length);for(var i=e-this.blockSize,h=this.m,v=this.h,T=0;T<e;){if(0==v)for(;T<=i;)Xn(this,u,T),T+=this.blockSize;if("string"==typeof u){for(;T<e;)if(h[v++]=u.charCodeAt(T++),v==this.blockSize){Xn(this,h),v=0;break}}else for(;T<e;)if(h[v++]=u[T++],v==this.blockSize){Xn(this,h),v=0;break}}this.h=v,this.i+=e},Ar.prototype.l=function(){var u=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);u[0]=128;for(var e=1;e<u.length-8;++e)u[e]=0;var i=8*this.i;for(e=u.length-8;e<u.length;++e)u[e]=255&i,i/=256;for(this.j(u),u=Array(16),e=i=0;4>e;++e)for(var h=0;32>h;h+=8)u[i++]=this.g[e]>>>h&255;return u};var zs={};function Wi(u){return-128<=u&&128>u?function oe(u,e){var i=zs;return Object.prototype.hasOwnProperty.call(i,u)?i[u]:i[u]=e(u)}(u,function(e){return new Qr([0|e],0>e?-1:0)}):new Qr([0|u],0>u?-1:0)}function fs(u){if(isNaN(u)||!isFinite(u))return Jo;if(0>u)return Ni(fs(-u));for(var e=[],i=1,h=0;u>=i;h++)e[h]=u/i|0,i*=so;return new Qr(e,0)}var so=4294967296,Jo=Wi(0),xs=Wi(1),lr=Wi(16777216);function Kr(u){if(0!=u.h)return!1;for(var e=0;e<u.g.length;e++)if(0!=u.g[e])return!1;return!0}function Di(u){return-1==u.h}function Ni(u){for(var e=u.g.length,i=[],h=0;h<e;h++)i[h]=~u.g[h];return new Qr(i,~u.h).add(xs)}function js(u,e){return u.add(Ni(e))}function ea(u,e){for(;(65535&u[e])!=u[e];)u[e+1]+=u[e]>>>16,u[e]&=65535,e++}function rl(u,e){this.g=u,this.h=e}function qi(u,e){if(Kr(e))throw Error("division by zero");if(Kr(u))return new rl(Jo,Jo);if(Di(u))return e=qi(Ni(u),e),new rl(Ni(e.g),Ni(e.h));if(Di(e))return e=qi(u,Ni(e)),new rl(Ni(e.g),e.h);if(30<u.g.length){if(Di(u)||Di(e))throw Error("slowDivide_ only works with positive integers.");for(var i=xs,h=e;0>=h.X(u);)i=ca(i),h=ca(h);var v=fo(i,1),T=fo(h,1);for(h=fo(h,2),i=fo(i,2);!Kr(h);){var D=T.add(h);0>=D.X(u)&&(v=v.add(i),T=D),h=fo(h,1),i=fo(i,1)}return e=js(u,v.R(e)),new rl(v,e)}for(v=Jo;0<=u.X(e);){for(i=Math.max(1,Math.floor(u.ea()/e.ea())),h=48>=(h=Math.ceil(Math.log(i)/Math.LN2))?1:Math.pow(2,h-48),D=(T=fs(i)).R(e);Di(D)||0<D.X(u);)D=(T=fs(i-=h)).R(e);Kr(T)&&(T=xs),v=v.add(T),u=js(u,D)}return new rl(v,u)}function ca(u){for(var e=u.g.length+1,i=[],h=0;h<e;h++)i[h]=u.D(h)<<1|u.D(h-1)>>>31;return new Qr(i,u.h)}function fo(u,e){var i=e>>5;e%=32;for(var h=u.g.length-i,v=[],T=0;T<h;T++)v[T]=0<e?u.D(T+i)>>>e|u.D(T+i+1)<<32-e:u.D(T+i);return new Qr(v,u.h)}(nr=Qr.prototype).ea=function(){if(Di(this))return-Ni(this).ea();for(var u=0,e=1,i=0;i<this.g.length;i++){var h=this.D(i);u+=(0<=h?h:so+h)*e,e*=so}return u},nr.toString=function(u){if(2>(u=u||10)||36<u)throw Error("radix out of range: "+u);if(Kr(this))return"0";if(Di(this))return"-"+Ni(this).toString(u);for(var e=fs(Math.pow(u,6)),i=this,h="";;){var v=qi(i,e).g,T=((0<(i=js(i,v.R(e))).g.length?i.g[0]:i.h)>>>0).toString(u);if(Kr(i=v))return T+h;for(;6>T.length;)T="0"+T;h=T+h}},nr.D=function(u){return 0>u?0:u<this.g.length?this.g[u]:this.h},nr.X=function(u){return Di(u=js(this,u))?-1:Kr(u)?0:1},nr.abs=function(){return Di(this)?Ni(this):this},nr.add=function(u){for(var e=Math.max(this.g.length,u.g.length),i=[],h=0,v=0;v<=e;v++){var T=h+(65535&this.D(v))+(65535&u.D(v)),D=(T>>>16)+(this.D(v)>>>16)+(u.D(v)>>>16);h=D>>>16,i[v]=(D&=65535)<<16|(T&=65535)}return new Qr(i,-2147483648&i[i.length-1]?-1:0)},nr.R=function(u){if(Kr(this)||Kr(u))return Jo;if(Di(this))return Di(u)?Ni(this).R(Ni(u)):Ni(Ni(this).R(u));if(Di(u))return Ni(this.R(Ni(u)));if(0>this.X(lr)&&0>u.X(lr))return fs(this.ea()*u.ea());for(var e=this.g.length+u.g.length,i=[],h=0;h<2*e;h++)i[h]=0;for(h=0;h<this.g.length;h++)for(var v=0;v<u.g.length;v++){var T=this.D(h)>>>16,D=65535&this.D(h),X=u.D(v)>>>16,te=65535&u.D(v);i[2*h+2*v]+=D*te,ea(i,2*h+2*v),i[2*h+2*v+1]+=T*te,ea(i,2*h+2*v+1),i[2*h+2*v+1]+=D*X,ea(i,2*h+2*v+1),i[2*h+2*v+2]+=T*X,ea(i,2*h+2*v+2)}for(h=0;h<e;h++)i[h]=i[2*h+1]<<16|i[2*h];for(h=e;h<2*e;h++)i[h]=0;return new Qr(i,0)},nr.gb=function(u){return qi(this,u).h},nr.and=function(u){for(var e=Math.max(this.g.length,u.g.length),i=[],h=0;h<e;h++)i[h]=this.D(h)&u.D(h);return new Qr(i,this.h&u.h)},nr.or=function(u){for(var e=Math.max(this.g.length,u.g.length),i=[],h=0;h<e;h++)i[h]=this.D(h)|u.D(h);return new Qr(i,this.h|u.h)},nr.xor=function(u){for(var e=Math.max(this.g.length,u.g.length),i=[],h=0;h<e;h++)i[h]=this.D(h)^u.D(h);return new Qr(i,this.h^u.h)},ke.prototype.createWebChannel=ke.prototype.g,ie.prototype.send=ie.prototype.u,ie.prototype.open=ie.prototype.m,ie.prototype.close=ie.prototype.close,Zs.NO_ERROR=0,Zs.TIMEOUT=8,Zs.HTTP_ERROR=6,Us.COMPLETE="complete",Il.EventType=La,La.OPEN="a",La.CLOSE="b",La.ERROR="c",La.MESSAGE="d",li.prototype.listen=li.prototype.O,Ns.prototype.listenOnce=Ns.prototype.P,Ns.prototype.getLastError=Ns.prototype.Sa,Ns.prototype.getLastErrorCode=Ns.prototype.Ia,Ns.prototype.getStatus=Ns.prototype.da,Ns.prototype.getResponseJson=Ns.prototype.Wa,Ns.prototype.getResponseText=Ns.prototype.ja,Ns.prototype.send=Ns.prototype.ha,Ns.prototype.setWithCredentials=Ns.prototype.Oa,Ar.prototype.digest=Ar.prototype.l,Ar.prototype.reset=Ar.prototype.reset,Ar.prototype.update=Ar.prototype.j,Qr.prototype.add=Qr.prototype.add,Qr.prototype.multiply=Qr.prototype.R,Qr.prototype.modulo=Qr.prototype.gb,Qr.prototype.compare=Qr.prototype.X,Qr.prototype.toNumber=Qr.prototype.ea,Qr.prototype.toString=Qr.prototype.toString,Qr.prototype.getBits=Qr.prototype.D,Qr.fromNumber=fs,Qr.fromString=function ji(u,e){if(0==u.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==u.charAt(0))return Ni(ji(u.substring(1),e));if(0<=u.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=fs(Math.pow(e,8)),h=Jo,v=0;v<u.length;v+=8){var T=Math.min(8,u.length-v),D=parseInt(u.substring(v,v+T),e);8>T?(T=fs(Math.pow(e,T)),h=h.R(T).add(fs(D))):h=(h=h.R(i)).add(fs(D))}return h};var Si=Ri.createWebChannelTransport=function(){return new ke},dl=Ri.getStatEventTarget=function(){return no()},Kl=Ri.ErrorCode=Zs,Ol=Ri.EventType=Us,Xs=Ri.Event=Ta,Rc=Ri.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},jo=(Ri.FetchXmlHttpFactory=Dl,Ri.WebChannel=Il),Ga=Ri.XhrIo=Ns,ju=Ri.Md5=Ar,fa=Ri.Integer=Qr;const hl="@firebase/firestore";class Ss{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ss.UNAUTHENTICATED=new Ss(null),Ss.GOOGLE_CREDENTIALS=new Ss("google-credentials-uid"),Ss.FIRST_PARTY=new Ss("first-party-uid"),Ss.MOCK_USER=new Ss("mock-user");let Oi="10.9.0";const cc=new jr.Vy("@firebase/firestore");function ta(){return cc.logLevel}function zn(u,...e){if(cc.logLevel<=jr.$b.DEBUG){const i=e.map(fu);cc.debug(`Firestore (${Oi}): ${u}`,...i)}}function Gs(u,...e){if(cc.logLevel<=jr.$b.ERROR){const i=e.map(fu);cc.error(`Firestore (${Oi}): ${u}`,...i)}}function As(u,...e){if(cc.logLevel<=jr.$b.WARN){const i=e.map(fu);cc.warn(`Firestore (${Oi}): ${u}`,...i)}}function fu(u){if("string"==typeof u)return u;try{return JSON.stringify(u)}catch{return u}}function pr(u="Unexpected state"){const e=`FIRESTORE (${Oi}) INTERNAL ASSERTION FAILED: `+u;throw Gs(e),new Error(e)}function zr(u,e){u||pr()}function dr(u,e){return u}const xn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Un extends ur.g{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ao{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}class Cr{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class pu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(Ss.UNAUTHENTICATED))}shutdown(){}}class $c{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class bc{constructor(e){this.t=e,this.currentUser=Ss.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){var h=this;let v=this.i;const T=_e=>this.i!==v?(v=this.i,i(_e)):Promise.resolve();let D=new Ao;this.o=()=>{this.i++,this.currentUser=this.u(),D.resolve(),D=new Ao,e.enqueueRetryable(()=>T(this.currentUser))};const X=()=>{const _e=D;e.enqueueRetryable((0,Ot.A)(function*(){yield _e.promise,yield T(h.currentUser)}))},te=_e=>{zn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=_e,this.auth.addAuthTokenListener(this.o),X()};this.t.onInit(_e=>te(_e)),setTimeout(()=>{if(!this.auth){const _e=this.t.getImmediate({optional:!0});_e?te(_e):(zn("FirebaseAuthCredentialsProvider","Auth not yet detected"),D.resolve(),D=new Ao)}},0),X()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(h=>this.i!==e?(zn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):h?(zr("string"==typeof h.accessToken),new Cr(h.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return zr(null===e||"string"==typeof e),new Ss(e)}}class uc{constructor(e,i,h){this.l=e,this.h=i,this.P=h,this.type="FirstParty",this.user=Ss.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class vr{constructor(e,i,h){this.l=e,this.h=i,this.P=h}getToken(){return Promise.resolve(new uc(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(Ss.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Su{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class _d{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,i){const h=T=>{null!=T.error&&zn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${T.error.message}`);const D=T.token!==this.R;return this.R=T.token,zn("FirebaseAppCheckTokenProvider",`Received ${D?"new":"existing"} token.`),D?i(T.token):Promise.resolve()};this.o=T=>{e.enqueueRetryable(()=>h(T))};const v=T=>{zn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=T,this.appCheck.addTokenListener(this.o)};this.A.onInit(T=>v(T)),setTimeout(()=>{if(!this.appCheck){const T=this.A.getImmediate({optional:!0});T?v(T):zn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(zr("string"==typeof i.token),this.R=i.token,new Su(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Gu(u){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(u);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(i);else for(let h=0;h<u;h++)i[h]=Math.floor(256*Math.random());return i}class td{static newId(){const i=62*Math.floor(256/62);let h="";for(;h.length<20;){const v=Gu(40);for(let T=0;T<v.length;++T)h.length<20&&v[T]<i&&(h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(v[T]%62))}return h}}function Qi(u,e){return u<e?-1:u>e?1:0}function Pc(u,e,i){return u.length===e.length&&u.every((h,v)=>i(h,e[v]))}function nh(u){return u+"\0"}class Oo{constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Un(xn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Un(xn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<-62135596800)throw new Un(xn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Un(xn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Oo.fromMillis(Date.now())}static fromDate(e){return Oo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),h=Math.floor(1e6*(e-1e3*i));return new Oo(i,h)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Qi(this.nanoseconds,e.nanoseconds):Qi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class pi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new pi(e)}static min(){return new pi(new Oo(0,0))}static max(){return new pi(new Oo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Au{constructor(e,i,h){void 0===i?i=0:i>e.length&&pr(),void 0===h?h=e.length-i:h>e.length-i&&pr(),this.segments=e,this.offset=i,this.len=h}get length(){return this.len}isEqual(e){return 0===Au.comparator(this,e)}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Au?e.forEach(h=>{i.push(h)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,h=this.limit();i<h;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const h=Math.min(e.length,i.length);for(let v=0;v<h;v++){const T=e.get(v),D=i.get(v);if(T<D)return-1;if(T>D)return 1}return e.length<i.length?-1:e.length>i.length?1:0}}class Z extends Au{construct(e,i,h){return new Z(e,i,h)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const h of e){if(h.indexOf("//")>=0)throw new Un(xn.INVALID_ARGUMENT,`Invalid segment (${h}). Paths must not contain // in them.`);i.push(...h.split("/").filter(v=>v.length>0))}return new Z(i)}static emptyPath(){return new Z([])}}const c=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class n extends Au{construct(e,i,h){return new n(e,i,h)}static isValidIdentifier(e){return c.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new n(["__name__"])}static fromServerFormat(e){const i=[];let h="",v=0;const T=()=>{if(0===h.length)throw new Un(xn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(h),h=""};let D=!1;for(;v<e.length;){const X=e[v];if("\\"===X){if(v+1===e.length)throw new Un(xn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const te=e[v+1];if("\\"!==te&&"."!==te&&"`"!==te)throw new Un(xn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);h+=te,v+=2}else"`"===X?(D=!D,v++):"."!==X||D?(h+=X,v++):(T(),v++)}if(T(),D)throw new Un(xn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(i)}static emptyPath(){return new n([])}}class a{constructor(e){this.path=e}static fromPath(e){return new a(Z.fromString(e))}static fromName(e){return new a(Z.fromString(e).popFirst(5))}static empty(){return new a(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Z.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,i){return Z.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new a(new Z(e.slice()))}}class p{constructor(e,i,h,v){this.indexId=e,this.collectionGroup=i,this.fields=h,this.indexState=v}}function y(u){return u.fields.find(e=>2===e.kind)}function w(u){return u.fields.filter(e=>2!==e.kind)}p.UNKNOWN_ID=-1;class P{constructor(e,i){this.fieldPath=e,this.kind=i}}class K{constructor(e,i){this.sequenceNumber=e,this.offset=i}static empty(){return new K(0,Pe.min())}}function Y(u,e){const i=u.toTimestamp().seconds,h=u.toTimestamp().nanoseconds+1,v=pi.fromTimestamp(1e9===h?new Oo(i+1,0):new Oo(i,h));return new Pe(v,a.empty(),e)}function ce(u){return new Pe(u.readTime,u.key,-1)}class Pe{constructor(e,i,h){this.readTime=e,this.documentKey=i,this.largestBatchId=h}static min(){return new Pe(pi.min(),a.empty(),-1)}static max(){return new Pe(pi.max(),a.empty(),-1)}}function Ke(u,e){let i=u.readTime.compareTo(e.readTime);return 0!==i?i:(i=a.comparator(u.documentKey,e.documentKey),0!==i?i:Qi(u.largestBatchId,e.largestBatchId))}const Ye="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rt{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function ot(u){return pe.apply(this,arguments)}function pe(){return pe=(0,Ot.A)(function*(u){if(u.code!==xn.FAILED_PRECONDITION||u.message!==Ye)throw u;zn("LocalStore","Unexpectedly lost primary lease")}),pe.apply(this,arguments)}class he{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&pr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new he((h,v)=>{this.nextCallback=T=>{this.wrapSuccess(e,T).next(h,v)},this.catchCallback=T=>{this.wrapFailure(i,T).next(h,v)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof he?i:he.resolve(i)}catch(i){return he.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):he.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):he.reject(i)}static resolve(e){return new he((i,h)=>{i(e)})}static reject(e){return new he((i,h)=>{h(e)})}static waitFor(e){return new he((i,h)=>{let v=0,T=0,D=!1;e.forEach(X=>{++v,X.next(()=>{++T,D&&T===v&&i()},te=>h(te))}),D=!0,T===v&&i()})}static or(e){let i=he.resolve(!1);for(const h of e)i=i.next(v=>v?he.resolve(v):h());return i}static forEach(e,i){const h=[];return e.forEach((v,T)=>{h.push(i.call(this,v,T))}),this.waitFor(h)}static mapArray(e,i){return new he((h,v)=>{const T=e.length,D=new Array(T);let X=0;for(let te=0;te<T;te++){const _e=te;i(e[_e]).next(ze=>{D[_e]=ze,++X,X===T&&h(D)},ze=>v(ze))}})}static doWhile(e,i){return new he((h,v)=>{const T=()=>{!0===e()?i().next(()=>{T()},v):h()};T()})}}class gt{constructor(e,i){this.action=e,this.transaction=i,this.aborted=!1,this.V=new Ao,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{i.error?this.V.reject(new jt(e,i.error)):this.V.resolve()},this.transaction.onerror=h=>{const v=rr(h.target.error);this.V.reject(new jt(e,v))}}static open(e,i,h,v){try{return new gt(i,e.transaction(v,h))}catch(T){throw new jt(i,T)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(zn("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const i=this.transaction.objectStore(e);return new tn(i)}}class mt{constructor(e,i,h){this.name=e,this.version=i,this.p=h,12.2===mt.S((0,ur.ZQ)())&&Gs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return zn("SimpleDb","Removing database:",e),Kt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,ur.zW)())return!1;if(mt.C())return!0;const e=(0,ur.ZQ)(),i=mt.S(e),h=0<i&&i<10,v=mt.v(e),T=0<v&&v<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||h||T)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,i){return e.store(i)}static S(e){const i=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),h=i?i[1].split("_").slice(0,2).join("."):"-1";return Number(h)}static v(e){const i=e.match(/Android ([\d.]+)/i),h=i?i[1].split(".").slice(0,2).join("."):"-1";return Number(h)}O(e){var i=this;return(0,Ot.A)(function*(){return i.db||(zn("SimpleDb","Opening database:",i.name),i.db=yield new Promise((h,v)=>{const T=indexedDB.open(i.name,i.version);T.onsuccess=D=>{h(D.target.result)},T.onblocked=()=>{v(new jt(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},T.onerror=D=>{const X=D.target.error;v("VersionError"===X.name?new Un(xn.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===X.name?new Un(xn.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+X):new jt(e,X))},T.onupgradeneeded=D=>{zn("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',D.oldVersion),i.p.N(D.target.result,T.transaction,D.oldVersion,i.version).next(()=>{zn("SimpleDb","Database upgrade to version "+i.version+" complete")})}})),i.L&&(i.db.onversionchange=h=>i.L(h)),i.db})()}B(e){this.L=e,this.db&&(this.db.onversionchange=i=>e(i))}runTransaction(e,i,h,v){var T=this;return(0,Ot.A)(function*(){const D="readonly"===i;let X=0;for(;;){++X;try{T.db=yield T.O(e);const te=gt.open(T.db,e,D?"readonly":"readwrite",h),_e=v(te).next(ze=>(te.g(),ze)).catch(ze=>(te.abort(ze),he.reject(ze))).toPromise();return _e.catch(()=>{}),yield te.m,_e}catch(te){const _e=te,ze="FirebaseError"!==_e.name&&X<3;if(zn("SimpleDb","Transaction failed with error:",_e.message,"Retrying:",ze),T.close(),!ze)return Promise.reject(_e)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Ut{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Kt(this.k.delete())}}class jt extends Un{constructor(e,i){super(xn.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${i}`),this.name="IndexedDbTransactionError"}}function It(u){return"IndexedDbTransactionError"===u.name}class tn{constructor(e){this.store=e}put(e,i){let h;return void 0!==i?(zn("SimpleDb","PUT",this.store.name,e,i),h=this.store.put(i,e)):(zn("SimpleDb","PUT",this.store.name,"<auto-key>",e),h=this.store.put(e)),Kt(h)}add(e){return zn("SimpleDb","ADD",this.store.name,e,e),Kt(this.store.add(e))}get(e){return Kt(this.store.get(e)).next(i=>(void 0===i&&(i=null),zn("SimpleDb","GET",this.store.name,e,i),i))}delete(e){return zn("SimpleDb","DELETE",this.store.name,e),Kt(this.store.delete(e))}count(){return zn("SimpleDb","COUNT",this.store.name),Kt(this.store.count())}W(e,i){const h=this.options(e,i),v=h.index?this.store.index(h.index):this.store;if("function"==typeof v.getAll){const T=v.getAll(h.range);return new he((D,X)=>{T.onerror=te=>{X(te.target.error)},T.onsuccess=te=>{D(te.target.result)}})}{const T=this.cursor(h),D=[];return this.G(T,(X,te)=>{D.push(te)}).next(()=>D)}}j(e,i){const h=this.store.getAll(e,null===i?void 0:i);return new he((v,T)=>{h.onerror=D=>{T(D.target.error)},h.onsuccess=D=>{v(D.target.result)}})}H(e,i){zn("SimpleDb","DELETE ALL",this.store.name);const h=this.options(e,i);h.J=!1;const v=this.cursor(h);return this.G(v,(T,D,X)=>X.delete())}Y(e,i){let h;i?h=e:(h={},i=e);const v=this.cursor(h);return this.G(v,i)}Z(e){const i=this.cursor({});return new he((h,v)=>{i.onerror=T=>{const D=rr(T.target.error);v(D)},i.onsuccess=T=>{const D=T.target.result;D?e(D.primaryKey,D.value).next(X=>{X?D.continue():h()}):h()}})}G(e,i){const h=[];return new he((v,T)=>{e.onerror=D=>{T(D.target.error)},e.onsuccess=D=>{const X=D.target.result;if(!X)return void v();const te=new Ut(X),_e=i(X.primaryKey,X.value,te);if(_e instanceof he){const ze=_e.catch(vt=>(te.done(),he.reject(vt)));h.push(ze)}te.isDone?v():null===te.$?X.continue():X.continue(te.$)}}).next(()=>he.waitFor(h))}options(e,i){let h;return void 0!==e&&("string"==typeof e?h=e:i=e),{index:h,range:i}}cursor(e){let i="next";if(e.reverse&&(i="prev"),e.index){const h=this.store.index(e.index);return e.J?h.openKeyCursor(e.range,i):h.openCursor(e.range,i)}return this.store.openCursor(e.range,i)}}function Kt(u){return new he((e,i)=>{u.onsuccess=h=>{e(h.target.result)},u.onerror=h=>{const v=rr(h.target.error);i(v)}})}let ln=!1;function rr(u){const e=mt.S((0,ur.ZQ)());if(e>=12.2&&e<13){const i="An internal error was encountered in the Indexed Database server";if(u.message.indexOf(i)>=0){const h=new Un("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${i}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ln||(ln=!0,setTimeout(()=>{throw h},0)),h}}return u}class cn{constructor(e,i){this.asyncQueue=e,this.X=i,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ee(e){var i=this;zn("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,Ot.A)(function*(){i.task=null;try{zn("IndexBackfiller",`Documents written: ${yield i.X.te()}`)}catch(h){It(h)?zn("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",h):yield ot(h)}yield i.ee(6e4)}))}}class Dn{constructor(e,i){this.localStore=e,this.persistence=i}te(e=50){var i=this;return(0,Ot.A)(function*(){return i.persistence.runTransaction("Backfill Indexes","readwrite-primary",h=>i.ne(h,e))})()}ne(e,i){const h=new Set;let v=i,T=!0;return he.doWhile(()=>!0===T&&v>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(D=>{if(null!==D&&!h.has(D))return zn("IndexBackfiller",`Processing collection: ${D}`),this.re(e,D,v).next(X=>{v-=X,h.add(D)});T=!1})).next(()=>i-v)}re(e,i,h){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,i).next(v=>this.localStore.localDocuments.getNextDocuments(e,i,v,h).next(T=>{const D=T.changes;return this.localStore.indexManager.updateIndexEntries(e,D).next(()=>this.ie(v,T)).next(X=>(zn("IndexBackfiller",`Updating offset: ${X}`),this.localStore.indexManager.updateCollectionGroup(e,i,X))).next(()=>D.size)}))}ie(e,i){let h=e;return i.changes.forEach((v,T)=>{const D=ce(T);Ke(D,h)>0&&(h=D)}),new Pe(h.readTime,h.documentKey,Math.max(i.batchId,e.largestBatchId))}}let an=(()=>{class u{constructor(i,h){this.previousValue=i,h&&(h.sequenceNumberHandler=v=>this.se(v),this.oe=v=>h.writeSequenceNumber(v))}se(i){return this.previousValue=Math.max(i,this.previousValue),this.previousValue}next(){const i=++this.previousValue;return this.oe&&this.oe(i),i}}return u._e=-1,u})();function Kn(u){return null==u}function dn(u){return 0===u&&1/u==-1/0}function Ln(u){return"number"==typeof u&&Number.isInteger(u)&&!dn(u)&&u<=Number.MAX_SAFE_INTEGER&&u>=Number.MIN_SAFE_INTEGER}function Nn(u){let e="";for(let i=0;i<u.length;i++)e.length>0&&(e=Yn(e)),e=Wn(u.get(i),e);return Yn(e)}function Wn(u,e){let i=e;const h=u.length;for(let v=0;v<h;v++){const T=u.charAt(v);switch(T){case"\0":i+="\x01\x10";break;case"\x01":i+="\x01\x11";break;default:i+=T}}return i}function Yn(u){return u+"\x01\x01"}function Xr(u){const e=u.length;if(zr(e>=2),2===e)return zr("\x01"===u.charAt(0)&&"\x01"===u.charAt(1)),Z.emptyPath();const i=e-2,h=[];let v="";for(let T=0;T<e;){const D=u.indexOf("\x01",T);switch((D<0||D>i)&&pr(),u.charAt(D+1)){case"\x01":const X=u.substring(T,D);let te;0===v.length?te=X:(v+=X,te=v,v=""),h.push(te);break;case"\x10":v+=u.substring(T,D),v+="\0";break;case"\x11":v+=u.substring(T,D+1);break;default:pr()}T=D+2}return new Z(h)}const bi=["userId","batchId"];function Br(u,e){return[u,Nn(e)]}function R(u,e,i){return[u,Nn(e),i]}const L={},$=["prefixPath","collectionGroup","readTime","documentId"],ee=["prefixPath","collectionGroup","documentId"],Ee=["collectionGroup","readTime","prefixPath","documentId"],st=["canonicalId","targetId"],Et=["targetId","path"],en=["path","targetId"],Lt=["collectionId","parent"],gn=["indexId","uid"],Rn=["uid","sequenceNumber"],kn=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Bn=["indexId","uid","orderedDocumentKey"],Jn=["userId","collectionPath","documentId"],er=["userId","collectionPath","largestBatchId"],Vr=["userId","collectionGroup","largestBatchId"],ui=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Yt=[...ui,"documentOverlays"],Tr=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Hs=Tr,Ms=[...Hs,"indexConfiguration","indexState","indexEntries"];class mi extends rt{constructor(e,i){super(),this.ae=e,this.currentSequenceNumber=i}}function Yr(u,e){const i=dr(u);return mt.M(i.ae,e)}function ri(u){let e=0;for(const i in u)Object.prototype.hasOwnProperty.call(u,i)&&e++;return e}function Mi(u,e){for(const i in u)Object.prototype.hasOwnProperty.call(u,i)&&e(i,u[i])}function po(u){for(const e in u)if(Object.prototype.hasOwnProperty.call(u,e))return!1;return!0}class Rr{constructor(e,i){this.comparator=e,this.root=i||Rs.EMPTY}insert(e,i){return new Rr(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Rs.BLACK,null,null))}remove(e){return new Rr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Rs.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const h=this.comparator(e,i.key);if(0===h)return i.value;h<0?i=i.left:h>0&&(i=i.right)}return null}indexOf(e){let i=0,h=this.root;for(;!h.isEmpty();){const v=this.comparator(e,h.key);if(0===v)return i+h.left.size;v<0?h=h.left:(i+=h.left.size+1,h=h.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,h)=>(e(i,h),!1))}toString(){const e=[];return this.inorderTraversal((i,h)=>(e.push(`${i}:${h}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ls(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ls(this.root,e,this.comparator,!1)}getReverseIterator(){return new ls(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ls(this.root,e,this.comparator,!0)}}class ls{constructor(e,i,h,v){this.isReverse=v,this.nodeStack=[];let T=1;for(;!e.isEmpty();)if(T=i?h(e.key,i):1,i&&v&&(T*=-1),T<0)e=this.isReverse?e.left:e.right;else{if(0===T){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Rs{constructor(e,i,h,v,T){this.key=e,this.value=i,this.color=h??Rs.RED,this.left=v??Rs.EMPTY,this.right=T??Rs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,h,v,T){return new Rs(e??this.key,i??this.value,h??this.color,v??this.left,T??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,h){let v=this;const T=h(e,v.key);return v=T<0?v.copy(null,null,null,v.left.insert(e,i,h),null):0===T?v.copy(null,i,null,null,null):v.copy(null,null,null,null,v.right.insert(e,i,h)),v.fixUp()}removeMin(){if(this.left.isEmpty())return Rs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let h,v=this;if(i(e,v.key)<0)v.left.isEmpty()||v.left.isRed()||v.left.left.isRed()||(v=v.moveRedLeft()),v=v.copy(null,null,null,v.left.remove(e,i),null);else{if(v.left.isRed()&&(v=v.rotateRight()),v.right.isEmpty()||v.right.isRed()||v.right.left.isRed()||(v=v.moveRedRight()),0===i(e,v.key)){if(v.right.isEmpty())return Rs.EMPTY;h=v.right.min(),v=v.copy(h.key,h.value,null,null,v.right.removeMin())}v=v.copy(null,null,null,null,v.right.remove(e,i))}return v.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Rs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Rs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw pr();const e=this.left.check();if(e!==this.right.check())throw pr();return e+(this.isRed()?0:1)}}Rs.EMPTY=null,Rs.RED=!0,Rs.BLACK=!1,Rs.EMPTY=new class{constructor(){this.size=0}get key(){throw pr()}get value(){throw pr()}get color(){throw pr()}get left(){throw pr()}get right(){throw pr()}copy(e,i,h,v,T){return this}insert(e,i,h){return new Rs(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Yi{constructor(e){this.comparator=e,this.data=new Rr(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,h)=>(e(i),!1))}forEachInRange(e,i){const h=this.data.getIteratorFrom(e[0]);for(;h.hasNext();){const v=h.getNext();if(this.comparator(v.key,e[1])>=0)return;i(v.key)}}forEachWhile(e,i){let h;for(h=void 0!==i?this.data.getIteratorFrom(i):this.data.getIterator();h.hasNext();)if(!e(h.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new Qs(this.data.getIterator())}getIteratorFrom(e){return new Qs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(h=>{i=i.add(h)}),i}isEqual(e){if(!(e instanceof Yi)||this.size!==e.size)return!1;const i=this.data.getIterator(),h=e.data.getIterator();for(;i.hasNext();){const v=i.getNext().key,T=h.getNext().key;if(0!==this.comparator(v,T))return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new Yi(this.comparator);return i.data=e,i}}class Qs{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ko(u){return u.hasNext()?u.getNext():void 0}class ps{constructor(e){this.fields=e,e.sort(n.comparator)}static empty(){return new ps([])}unionWith(e){let i=new Yi(n.comparator);for(const h of this.fields)i=i.add(h);for(const h of e)i=i.add(h);return new ps(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return Pc(this.fields,e.fields,(i,h)=>i.isEqual(h))}}class Ma extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class oo{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(v){try{return atob(v)}catch(T){throw typeof DOMException<"u"&&T instanceof DOMException?new Ma("Invalid base64 string: "+T):T}}(e);return new oo(i)}static fromUint8Array(e){const i=function(v){let T="";for(let D=0;D<v.length;++D)T+=String.fromCharCode(v[D]);return T}(e);return new oo(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(i){const h=new Uint8Array(i.length);for(let v=0;v<i.length;v++)h[v]=i.charCodeAt(v);return h}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Qi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}oo.EMPTY_BYTE_STRING=new oo("");const Ha=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Tc(u){if(zr(!!u),"string"==typeof u){let e=0;const i=Ha.exec(u);if(zr(!!i),i[1]){let v=i[1];v=(v+"000000000").substr(0,9),e=Number(v)}const h=new Date(u);return{seconds:Math.floor(h.getTime()/1e3),nanos:e}}return{seconds:No(u.seconds),nanos:No(u.nanos)}}function No(u){return"number"==typeof u?u:"string"==typeof u?Number(u):0}function fl(u){return"string"==typeof u?oo.fromBase64String(u):oo.fromUint8Array(u)}function mu(u){var e,i;return"server_timestamp"===(null===(i=((null===(e=u?.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function tu(u){const e=u.mapValue.fields.__previous_value__;return mu(e)?tu(e):e}function Cu(u){const e=Tc(u.mapValue.fields.__local_write_time__.timestampValue);return new Oo(e.seconds,e.nanos)}class Nh{constructor(e,i,h,v,T,D,X,te,_e){this.databaseId=e,this.appId=i,this.persistenceKey=h,this.host=v,this.ssl=T,this.forceLongPolling=D,this.autoDetectLongPolling=X,this.longPollingOptions=te,this.useFetchStreams=_e}}class mo{constructor(e,i){this.projectId=e,this.database=i||"(default)"}static empty(){return new mo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof mo&&e.projectId===this.projectId&&e.database===this.database}}const kl={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Oc={nullValue:"NULL_VALUE"};function pl(u){return"nullValue"in u?0:"booleanValue"in u?1:"integerValue"in u||"doubleValue"in u?2:"timestampValue"in u?3:"stringValue"in u?5:"bytesValue"in u?6:"referenceValue"in u?7:"geoPointValue"in u?8:"arrayValue"in u?9:"mapValue"in u?mu(u)?4:Ll(u)?9007199254740991:10:pr()}function Nl(u,e){if(u===e)return!0;const i=pl(u);if(i!==pl(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return u.booleanValue===e.booleanValue;case 4:return Cu(u).isEqual(Cu(e));case 3:return function(v,T){if("string"==typeof v.timestampValue&&"string"==typeof T.timestampValue&&v.timestampValue.length===T.timestampValue.length)return v.timestampValue===T.timestampValue;const D=Tc(v.timestampValue),X=Tc(T.timestampValue);return D.seconds===X.seconds&&D.nanos===X.nanos}(u,e);case 5:return u.stringValue===e.stringValue;case 6:return T=e,fl(u.bytesValue).isEqual(fl(T.bytesValue));case 7:return u.referenceValue===e.referenceValue;case 8:return function(v,T){return No(v.geoPointValue.latitude)===No(T.geoPointValue.latitude)&&No(v.geoPointValue.longitude)===No(T.geoPointValue.longitude)}(u,e);case 2:return function(v,T){if("integerValue"in v&&"integerValue"in T)return No(v.integerValue)===No(T.integerValue);if("doubleValue"in v&&"doubleValue"in T){const D=No(v.doubleValue),X=No(T.doubleValue);return D===X?dn(D)===dn(X):isNaN(D)&&isNaN(X)}return!1}(u,e);case 9:return Pc(u.arrayValue.values||[],e.arrayValue.values||[],Nl);case 10:return function(v,T){const D=v.mapValue.fields||{},X=T.mapValue.fields||{};if(ri(D)!==ri(X))return!1;for(const te in D)if(D.hasOwnProperty(te)&&(void 0===X[te]||!Nl(D[te],X[te])))return!1;return!0}(u,e);default:return pr()}var T}function ml(u,e){return void 0!==(u.values||[]).find(i=>Nl(i,e))}function pa(u,e){if(u===e)return 0;const i=pl(u),h=pl(e);if(i!==h)return Qi(i,h);switch(i){case 0:case 9007199254740991:return 0;case 1:return Qi(u.booleanValue,e.booleanValue);case 2:return function(T,D){const X=No(T.integerValue||T.doubleValue),te=No(D.integerValue||D.doubleValue);return X<te?-1:X>te?1:X===te?0:isNaN(X)?isNaN(te)?0:-1:1}(u,e);case 3:return Lh(u.timestampValue,e.timestampValue);case 4:return Lh(Cu(u),Cu(e));case 5:return Qi(u.stringValue,e.stringValue);case 6:return function(T,D){const X=fl(T),te=fl(D);return X.compareTo(te)}(u.bytesValue,e.bytesValue);case 7:return function(T,D){const X=T.split("/"),te=D.split("/");for(let _e=0;_e<X.length&&_e<te.length;_e++){const ze=Qi(X[_e],te[_e]);if(0!==ze)return ze}return Qi(X.length,te.length)}(u.referenceValue,e.referenceValue);case 8:return function(T,D){const X=Qi(No(T.latitude),No(D.latitude));return 0!==X?X:Qi(No(T.longitude),No(D.longitude))}(u.geoPointValue,e.geoPointValue);case 9:return function(T,D){const X=T.values||[],te=D.values||[];for(let _e=0;_e<X.length&&_e<te.length;++_e){const ze=pa(X[_e],te[_e]);if(ze)return ze}return Qi(X.length,te.length)}(u.arrayValue,e.arrayValue);case 10:return function(T,D){if(T===kl.mapValue&&D===kl.mapValue)return 0;if(T===kl.mapValue)return 1;if(D===kl.mapValue)return-1;const X=T.fields||{},te=Object.keys(X),_e=D.fields||{},ze=Object.keys(_e);te.sort(),ze.sort();for(let vt=0;vt<te.length&&vt<ze.length;++vt){const Xt=Qi(te[vt],ze[vt]);if(0!==Xt)return Xt;const un=pa(X[te[vt]],_e[ze[vt]]);if(0!==un)return un}return Qi(te.length,ze.length)}(u.mapValue,e.mapValue);default:throw pr()}}function Lh(u,e){if("string"==typeof u&&"string"==typeof e&&u.length===e.length)return Qi(u,e);const i=Tc(u),h=Tc(e),v=Qi(i.seconds,h.seconds);return 0!==v?v:Qi(i.nanos,h.nanos)}function Ra(u){return nu(u)}function nu(u){return"nullValue"in u?"null":"booleanValue"in u?""+u.booleanValue:"integerValue"in u?""+u.integerValue:"doubleValue"in u?""+u.doubleValue:"timestampValue"in u?function(i){const h=Tc(i);return`time(${h.seconds},${h.nanos})`}(u.timestampValue):"stringValue"in u?u.stringValue:"bytesValue"in u?fl(u.bytesValue).toBase64():"referenceValue"in u?a.fromName(u.referenceValue).toString():"geoPointValue"in u?function(i){return`geo(${i.latitude},${i.longitude})`}(u.geoPointValue):"arrayValue"in u?function(i){let h="[",v=!0;for(const T of i.values||[])v?v=!1:h+=",",h+=nu(T);return h+"]"}(u.arrayValue):"mapValue"in u?function(i){const h=Object.keys(i.fields||{}).sort();let v="{",T=!0;for(const D of h)T?T=!1:v+=",",v+=`${D}:${nu(i.fields[D])}`;return v+"}"}(u.mapValue):pr()}function es(u,e){return{referenceValue:`projects/${u.projectId}/databases/${u.database}/documents/${e.path.canonicalString()}`}}function Ic(u){return!!u&&"integerValue"in u}function rs(u){return!!u&&"arrayValue"in u}function ru(u){return!!u&&"nullValue"in u}function To(u){return!!u&&"doubleValue"in u&&isNaN(Number(u.doubleValue))}function go(u){return!!u&&"mapValue"in u}function ii(u){if(u.geoPointValue)return{geoPointValue:Object.assign({},u.geoPointValue)};if(u.timestampValue&&"object"==typeof u.timestampValue)return{timestampValue:Object.assign({},u.timestampValue)};if(u.mapValue){const e={mapValue:{fields:{}}};return Mi(u.mapValue.fields,(i,h)=>e.mapValue.fields[i]=ii(h)),e}if(u.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(u.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=ii(u.arrayValue.values[i]);return e}return Object.assign({},u)}function Ll(u){return"__max__"===(((u.mapValue||{}).fields||{}).__type__||{}).stringValue}function Fh(u){return"nullValue"in u?Oc:"booleanValue"in u?{booleanValue:!1}:"integerValue"in u||"doubleValue"in u?{doubleValue:NaN}:"timestampValue"in u?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in u?{stringValue:""}:"bytesValue"in u?{bytesValue:""}:"referenceValue"in u?es(mo.empty(),a.empty()):"geoPointValue"in u?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in u?{arrayValue:{}}:"mapValue"in u?{mapValue:{}}:pr()}function Sc(u){return"nullValue"in u?{booleanValue:!1}:"booleanValue"in u?{doubleValue:NaN}:"integerValue"in u||"doubleValue"in u?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in u?{stringValue:""}:"stringValue"in u?{bytesValue:""}:"bytesValue"in u?es(mo.empty(),a.empty()):"referenceValue"in u?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in u?{arrayValue:{}}:"arrayValue"in u?{mapValue:{}}:"mapValue"in u?kl:pr()}function Vd(u,e){const i=pa(u.value,e.value);return 0!==i?i:u.inclusive&&!e.inclusive?-1:!u.inclusive&&e.inclusive?1:0}function Bh(u,e){const i=pa(u.value,e.value);return 0!==i?i:u.inclusive&&!e.inclusive?1:!u.inclusive&&e.inclusive?-1:0}class $o{constructor(e){this.value=e}static empty(){return new $o({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let h=0;h<e.length-1;++h)if(i=(i.mapValue.fields||{})[e.get(h)],!go(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=ii(i)}setAll(e){let i=n.emptyPath(),h={},v=[];e.forEach((D,X)=>{if(!i.isImmediateParentOf(X)){const te=this.getFieldsMap(i);this.applyChanges(te,h,v),h={},v=[],i=X.popLast()}D?h[X.lastSegment()]=ii(D):v.push(X.lastSegment())});const T=this.getFieldsMap(i);this.applyChanges(T,h,v)}delete(e){const i=this.field(e.popLast());go(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Nl(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let h=0;h<e.length;++h){let v=i.mapValue.fields[e.get(h)];go(v)&&v.mapValue.fields||(v={mapValue:{fields:{}}},i.mapValue.fields[e.get(h)]=v),i=v}return i.mapValue.fields}applyChanges(e,i,h){Mi(i,(v,T)=>e[v]=T);for(const v of h)delete e[v]}clone(){return new $o(ii(this.value))}}function Vh(u){const e=[];return Mi(u.fields,(i,h)=>{const v=new n([i]);if(go(h)){const T=Vh(h.mapValue).fields;if(0===T.length)e.push(v);else for(const D of T)e.push(v.child(D))}else e.push(v)}),new ps(e)}class Eo{constructor(e,i,h,v,T,D,X){this.key=e,this.documentType=i,this.version=h,this.readTime=v,this.createTime=T,this.data=D,this.documentState=X}static newInvalidDocument(e){return new Eo(e,0,pi.min(),pi.min(),pi.min(),$o.empty(),0)}static newFoundDocument(e,i,h,v){return new Eo(e,1,i,pi.min(),h,v,0)}static newNoDocument(e,i){return new Eo(e,2,i,pi.min(),pi.min(),$o.empty(),0)}static newUnknownDocument(e,i){return new Eo(e,3,i,pi.min(),pi.min(),$o.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(pi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=$o.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=$o.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=pi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Eo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Eo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Du{constructor(e,i){this.position=e,this.inclusive=i}}function Mu(u,e,i){let h=0;for(let v=0;v<u.position.length;v++){const T=e[v],D=u.position[v];if(h=T.field.isKeyField()?a.comparator(a.fromName(D.referenceValue),i.key):pa(D,i.data.field(T.field)),"desc"===T.dir&&(h*=-1),0!==h)break}return h}function nd(u,e){if(null===u)return null===e;if(null===e||u.inclusive!==e.inclusive||u.position.length!==e.position.length)return!1;for(let i=0;i<u.position.length;i++)if(!Nl(u.position[i],e.position[i]))return!1;return!0}class vd{constructor(e,i="asc"){this.field=e,this.dir=i}}function rh(u,e){return u.dir===e.dir&&u.field.isEqual(e.field)}class vp{}class ao extends vp{constructor(e,i,h){super(),this.field=e,this.op=i,this.value=h}static create(e,i,h){return e.isKeyField()?"in"===i||"not-in"===i?this.createKeyFieldInFilter(e,i,h):new dc(e,i,h):"array-contains"===i?new Ru(e,h):"in"===i?new ua(e,h):"not-in"===i?new Pf(e,h):"array-contains-any"===i?new oh(e,h):new ao(e,i,h)}static createKeyFieldInFilter(e,i,h){return"in"===i?new $h(e,h):new Ac(e,h)}matches(e){const i=e.data.field(this.field);return"!="===this.op?null!==i&&this.matchesComparison(pa(i,this.value)):null!==i&&pl(this.value)===pl(i)&&this.matchesComparison(pa(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return pr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Lo extends vp{constructor(e,i){super(),this.filters=e,this.op=i,this.ue=null}static create(e,i){return new Lo(e,i)}matches(e){return Uh(this)?void 0===this.filters.find(i=>!i.matches(e)):void 0!==this.filters.find(i=>i.matches(e))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Uh(u){return"and"===u.op}function zh(u){return"or"===u.op}function rd(u){return iu(u)&&Uh(u)}function iu(u){for(const e of u.filters)if(e instanceof Lo)return!1;return!0}function jh(u){if(u instanceof ao)return u.field.canonicalString()+u.op.toString()+Ra(u.value);if(rd(u))return u.filters.map(e=>jh(e)).join(",");{const e=u.filters.map(i=>jh(i)).join(",");return`${u.op}(${e})`}}function ih(u,e){return u instanceof ao?(h=u,(v=e)instanceof ao&&h.op===v.op&&h.field.isEqual(v.field)&&Nl(h.value,v.value)):u instanceof Lo?function(h,v){return v instanceof Lo&&h.op===v.op&&h.filters.length===v.filters.length&&h.filters.reduce((T,D,X)=>T&&ih(D,v.filters[X]),!0)}(u,e):void pr();var h,v}function sh(u,e){const i=u.filters.concat(e);return Lo.create(i,u.op)}function xd(u){return u instanceof ao?`${(i=u).field.canonicalString()} ${i.op} ${Ra(i.value)}`:u instanceof Lo?function(i){return i.op.toString()+" {"+i.getFilters().map(xd).join(" ,")+"}"}(u):"Filter";var i}class dc extends ao{constructor(e,i,h){super(e,i,h),this.key=a.fromName(h.referenceValue)}matches(e){const i=a.comparator(e.key,this.key);return this.matchesComparison(i)}}class $h extends ao{constructor(e,i){super(e,"in",i),this.keys=Gc(0,i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class Ac extends ao{constructor(e,i){super(e,"not-in",i),this.keys=Gc(0,i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function Gc(u,e){var i;return((null===(i=e.arrayValue)||void 0===i?void 0:i.values)||[]).map(h=>a.fromName(h.referenceValue))}class Ru extends ao{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return rs(i)&&ml(i.arrayValue,this.value)}}class ua extends ao{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return null!==i&&ml(this.value.arrayValue,i)}}class Pf extends ao{constructor(e,i){super(e,"not-in",i)}matches(e){if(ml(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return null!==i&&!ml(this.value.arrayValue,i)}}class oh extends ao{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!rs(i)||!i.arrayValue.values)&&i.arrayValue.values.some(h=>ml(this.value.arrayValue,h))}}class su{constructor(e,i=null,h=[],v=[],T=null,D=null,X=null){this.path=e,this.collectionGroup=i,this.orderBy=h,this.filters=v,this.limit=T,this.startAt=D,this.endAt=X,this.ce=null}}function Gh(u,e=null,i=[],h=[],v=null,T=null,D=null){return new su(u,e,i,h,v,T,D)}function Ed(u){const e=dr(u);if(null===e.ce){let i=e.path.canonicalString();null!==e.collectionGroup&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(h=>jh(h)).join(","),i+="|ob:",i+=e.orderBy.map(h=>{return(T=h).field.canonicalString()+T.dir;var T}).join(","),Kn(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(h=>Ra(h)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(h=>Ra(h)).join(",")),e.ce=i}return e.ce}function Ud(u,e){if(u.limit!==e.limit||u.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<u.orderBy.length;i++)if(!rh(u.orderBy[i],e.orderBy[i]))return!1;if(u.filters.length!==e.filters.length)return!1;for(let i=0;i<u.filters.length;i++)if(!ih(u.filters[i],e.filters[i]))return!1;return u.collectionGroup===e.collectionGroup&&!!u.path.isEqual(e.path)&&!!nd(u.startAt,e.startAt)&&nd(u.endAt,e.endAt)}function Hh(u){return a.isDocumentKey(u.path)&&null===u.collectionGroup&&0===u.filters.length}function Hu(u,e){return u.filters.filter(i=>i instanceof ao&&i.field.isEqual(e))}function xp(u,e,i){let h=Oc,v=!0;for(const T of Hu(u,e)){let D=Oc,X=!0;switch(T.op){case"<":case"<=":D=Fh(T.value);break;case"==":case"in":case">=":D=T.value;break;case">":D=T.value,X=!1;break;case"!=":case"not-in":D=Oc}Vd({value:h,inclusive:v},{value:D,inclusive:X})<0&&(h=D,v=X)}if(null!==i)for(let T=0;T<u.orderBy.length;++T)if(u.orderBy[T].field.isEqual(e)){const D=i.position[T];Vd({value:h,inclusive:v},{value:D,inclusive:i.inclusive})<0&&(h=D,v=i.inclusive);break}return{value:h,inclusive:v}}function Ep(u,e,i){let h=kl,v=!0;for(const T of Hu(u,e)){let D=kl,X=!0;switch(T.op){case">=":case">":D=Sc(T.value),X=!1;break;case"==":case"in":case"<=":D=T.value;break;case"<":D=T.value,X=!1;break;case"!=":case"not-in":D=kl}Bh({value:h,inclusive:v},{value:D,inclusive:X})>0&&(h=D,v=X)}if(null!==i)for(let T=0;T<u.orderBy.length;++T)if(u.orderBy[T].field.isEqual(e)){const D=i.position[T];Bh({value:h,inclusive:v},{value:D,inclusive:i.inclusive})>0&&(h=D,v=i.inclusive);break}return{value:h,inclusive:v}}class id{constructor(e,i=null,h=[],v=[],T=null,D="F",X=null,te=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=h,this.filters=v,this.limit=T,this.limitType=D,this.startAt=X,this.endAt=te,this.le=null,this.he=null,this.Pe=null}}function ah(u,e,i,h,v,T,D,X){return new id(u,e,i,h,v,T,D,X)}function ou(u){return new id(u)}function Zm(u){return 0===u.filters.length&&null===u.limit&&null==u.startAt&&null==u.endAt&&(0===u.explicitOrderBy.length||1===u.explicitOrderBy.length&&u.explicitOrderBy[0].field.isKeyField())}function Of(u){return null!==u.collectionGroup}function sd(u){const e=dr(u);if(null===e.le){e.le=[];const i=new Set;for(const T of e.explicitOrderBy)e.le.push(T),i.add(T.field.canonicalString());const h=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(D){let X=new Yi(n.comparator);return D.filters.forEach(te=>{te.getFlattenedFilters().forEach(_e=>{_e.isInequality()&&(X=X.add(_e.field))})}),X})(e).forEach(T=>{i.has(T.canonicalString())||T.isKeyField()||e.le.push(new vd(T,h))}),i.has(n.keyField().canonicalString())||e.le.push(new vd(n.keyField(),h))}return e.le}function ma(u){const e=dr(u);return e.he||(e.he=function wd(u,e){if("F"===u.limitType)return Gh(u.path,u.collectionGroup,e,u.filters,u.limit,u.startAt,u.endAt);{e=e.map(v=>new vd(v.field,"desc"===v.dir?"asc":"desc"));const i=u.endAt?new Du(u.endAt.position,u.endAt.inclusive):null,h=u.startAt?new Du(u.startAt.position,u.startAt.inclusive):null;return Gh(u.path,u.collectionGroup,e,u.filters,u.limit,i,h)}}(e,sd(u))),e.he}function Wa(u,e){const i=u.filters.concat([e]);return new id(u.path,u.collectionGroup,u.explicitOrderBy.slice(),i,u.limit,u.limitType,u.startAt,u.endAt)}function bd(u,e,i){return new id(u.path,u.collectionGroup,u.explicitOrderBy.slice(),u.filters.slice(),e,i,u.startAt,u.endAt)}function gl(u,e){return Ud(ma(u),ma(e))&&u.limitType===e.limitType}function Wh(u){return`${Ed(ma(u))}|lt:${u.limitType}`}function lh(u){return`Query(target=${function(i){let h=i.path.canonicalString();return null!==i.collectionGroup&&(h+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(h+=`, filters: [${i.filters.map(v=>xd(v)).join(", ")}]`),Kn(i.limit)||(h+=", limit: "+i.limit),i.orderBy.length>0&&(h+=`, orderBy: [${i.orderBy.map(v=>{return`${(D=v).field.canonicalString()} (${D.dir})`;var D}).join(", ")}]`),i.startAt&&(h+=", startAt: ",h+=i.startAt.inclusive?"b:":"a:",h+=i.startAt.position.map(v=>Ra(v)).join(",")),i.endAt&&(h+=", endAt: ",h+=i.endAt.inclusive?"a:":"b:",h+=i.endAt.position.map(v=>Ra(v)).join(",")),`Target(${h})`}(ma(u))}; limitType=${u.limitType})`}function kc(u,e){return e.isFoundDocument()&&function(h,v){const T=v.key.path;return null!==h.collectionGroup?v.key.hasCollectionId(h.collectionGroup)&&h.path.isPrefixOf(T):a.isDocumentKey(h.path)?h.path.isEqual(T):h.path.isImmediateParentOf(T)}(u,e)&&function(h,v){for(const T of sd(h))if(!T.field.isKeyField()&&null===v.data.field(T.field))return!1;return!0}(u,e)&&function(h,v){for(const T of h.filters)if(!T.matches(v))return!1;return!0}(u,e)&&(v=e,!((h=u).startAt&&!function(D,X,te){const _e=Mu(D,X,te);return D.inclusive?_e<=0:_e<0}(h.startAt,sd(h),v)||h.endAt&&!function(D,X,te){const _e=Mu(D,X,te);return D.inclusive?_e>=0:_e>0}(h.endAt,sd(h),v)));var h,v}function kf(u){return u.collectionGroup||(u.path.length%2==1?u.path.lastSegment():u.path.get(u.path.length-2))}function zd(u){return(e,i)=>{let h=!1;for(const v of sd(u)){const T=qh(v,e,i);if(0!==T)return T;h=h||v.field.isKeyField()}return 0}}function qh(u,e,i){const h=u.field.isKeyField()?a.comparator(e.key,i.key):function(T,D,X){const te=D.data.field(T),_e=X.data.field(T);return null!==te&&null!==_e?pa(te,_e):pr()}(u.field,e,i);switch(u.dir){case"asc":return h;case"desc":return-1*h;default:return pr()}}class il{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),h=this.inner[i];if(void 0!==h)for(const[v,T]of h)if(this.equalsFn(v,e))return T}has(e){return void 0!==this.get(e)}set(e,i){const h=this.mapKeyFn(e),v=this.inner[h];if(void 0===v)return this.inner[h]=[[e,i]],void this.innerSize++;for(let T=0;T<v.length;T++)if(this.equalsFn(v[T][0],e))return void(v[T]=[e,i]);v.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),h=this.inner[i];if(void 0===h)return!1;for(let v=0;v<h.length;v++)if(this.equalsFn(h[v][0],e))return 1===h.length?delete this.inner[i]:h.splice(v,1),this.innerSize--,!0;return!1}forEach(e){Mi(this.inner,(i,h)=>{for(const[v,T]of h)e(v,T)})}isEmpty(){return po(this.inner)}size(){return this.innerSize}}const Xl=new Rr(a.comparator);function Hc(){return Xl}const Kh=new Rr(a.comparator);function Zh(...u){let e=Kh;for(const i of u)e=e.insert(i.key,i);return e}function Xm(u){let e=Kh;return u.forEach((i,h)=>e=e.insert(i,h.overlayedDocument)),e}function gu(){return _u()}function Wu(){return _u()}function _u(){return new il(u=>u.toString(),(u,e)=>u.isEqual(e))}const wp=new Rr(a.comparator),bp=new Yi(a.comparator);function Os(...u){let e=bp;for(const i of u)e=e.add(i);return e}const Nf=new Yi(Qi);function jd(){return Nf}function Ql(u,e){if(u.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:dn(e)?"-0":e}}function hc(u){return{integerValue:""+u}}function qu(u,e){return Ln(e)?hc(e):Ql(u,e)}class ch{constructor(){this._=void 0}}function Tp(u,e,i){return u instanceof Pu?function(v,T){const D={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:v.seconds,nanos:v.nanoseconds}}}};return T&&mu(T)&&(T=tu(T)),T&&(D.fields.__previous_value__=T),{mapValue:D}}(i,e):u instanceof yu?fm(u,e):u instanceof Cc?pm(u,e):function(v,T){const D=uh(v,T),X=f_(D)+f_(v.Ie);return Ic(D)&&Ic(v.Ie)?hc(X):Ql(v.serializer,X)}(u,e)}function Wc(u,e,i){return u instanceof yu?fm(u,e):u instanceof Cc?pm(u,e):i}function uh(u,e){return u instanceof Lf?Ic(h=e)||(T=h)&&"doubleValue"in T?e:{integerValue:0}:null;var h,T}class Pu extends ch{}class yu extends ch{constructor(e){super(),this.elements=e}}function fm(u,e){const i=Ff(e);for(const h of u.elements)i.some(v=>Nl(v,h))||i.push(h);return{arrayValue:{values:i}}}class Cc extends ch{constructor(e){super(),this.elements=e}}function pm(u,e){let i=Ff(e);for(const h of u.elements)i=i.filter(v=>!Nl(v,h));return{arrayValue:{values:i}}}class Lf extends ch{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function f_(u){return No(u.integerValue||u.doubleValue)}function Ff(u){return rs(u)&&u.arrayValue.values?u.arrayValue.values.slice():[]}class Xh{constructor(e,i){this.field=e,this.transform=i}}class Ws{constructor(e,i){this.version=e,this.transformResults=i}}class Co{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Co}static exists(e){return new Co(void 0,e)}static updateTime(e){return new Co(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function au(u,e){return void 0!==u.updateTime?e.isFoundDocument()&&e.version.isEqual(u.updateTime):void 0===u.exists||u.exists===e.isFoundDocument()}class yl{}function fc(u,e){if(!u.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return u.isNoDocument()?new S(u.key,Co.none()):new dh(u.key,u.data,Co.none());{const i=u.data,h=$o.empty();let v=new Yi(n.comparator);for(let T of e.fields)if(!v.has(T)){let D=i.field(T);null===D&&T.length>1&&(T=T.popLast(),D=i.field(T)),null===D?h.delete(T):h.set(T,D),v=v.add(T)}return new qc(u.key,h,new ps(v.toArray()),Co.none())}}function qa(u,e,i){u instanceof dh?function(v,T,D){const X=v.value.clone(),te=Qh(v.fieldTransforms,T,D.transformResults);X.setAll(te),T.convertToFoundDocument(D.version,X).setHasCommittedMutations()}(u,e,i):u instanceof qc?function(v,T,D){if(!au(v.precondition,T))return void T.convertToUnknownDocument(D.version);const X=Qh(v.fieldTransforms,T,D.transformResults),te=T.data;te.setAll(Bf(v)),te.setAll(X),T.convertToFoundDocument(D.version,te).setHasCommittedMutations()}(u,e,i):e.convertToNoDocument(i.version).setHasCommittedMutations()}function Ka(u,e,i,h){return u instanceof dh?function(T,D,X,te){if(!au(T.precondition,D))return X;const _e=T.value.clone(),ze=B(T.fieldTransforms,te,D);return _e.setAll(ze),D.convertToFoundDocument(D.version,_e).setHasLocalMutations(),null}(u,e,i,h):u instanceof qc?function(T,D,X,te){if(!au(T.precondition,D))return X;const _e=B(T.fieldTransforms,te,D),ze=D.data;return ze.setAll(Bf(T)),ze.setAll(_e),D.convertToFoundDocument(D.version,ze).setHasLocalMutations(),null===X?null:X.unionWith(T.fieldMask.fields).unionWith(T.fieldTransforms.map(vt=>vt.field))}(u,e,i,h):(X=i,au(u.precondition,D=e)?(D.convertToNoDocument(D.version).setHasLocalMutations(),null):X);var D,X}function Ip(u,e){let i=null;for(const h of u.fieldTransforms){const v=e.data.field(h.field),T=uh(h.transform,v||null);null!=T&&(null===i&&(i=$o.empty()),i.set(h.field,T))}return i||null}function xa(u,e){return u.type===e.type&&!!u.key.isEqual(e.key)&&!!u.precondition.isEqual(e.precondition)&&(v=e.fieldTransforms,!!(void 0===(h=u.fieldTransforms)&&void 0===v||h&&v&&Pc(h,v,(T,D)=>function _l(u,e){return u.field.isEqual(e.field)&&(v=e.transform,(h=u.transform)instanceof yu&&v instanceof yu||h instanceof Cc&&v instanceof Cc?Pc(h.elements,v.elements,Nl):h instanceof Lf&&v instanceof Lf?Nl(h.Ie,v.Ie):h instanceof Pu&&v instanceof Pu);var h,v}(T,D))))&&(0===u.type?u.value.isEqual(e.value):1!==u.type||u.data.isEqual(e.data)&&u.fieldMask.isEqual(e.fieldMask));var h,v}class dh extends yl{constructor(e,i,h,v=[]){super(),this.key=e,this.value=i,this.precondition=h,this.fieldTransforms=v,this.type=0}getFieldMask(){return null}}class qc extends yl{constructor(e,i,h,v,T=[]){super(),this.key=e,this.data=i,this.fieldMask=h,this.precondition=v,this.fieldTransforms=T,this.type=1}getFieldMask(){return this.fieldMask}}function Bf(u){const e=new Map;return u.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const h=u.data.field(i);e.set(i,h)}}),e}function Qh(u,e,i){const h=new Map;zr(u.length===i.length);for(let v=0;v<i.length;v++){const T=u[v],D=T.transform,X=e.data.field(T.field);h.set(T.field,Wc(D,X,i[v]))}return h}function B(u,e,i){const h=new Map;for(const v of u){const T=v.transform,D=i.data.field(v.field);h.set(v.field,Tp(T,D,e))}return h}class S extends yl{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class M extends yl{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class j{constructor(e,i,h,v){this.batchId=e,this.localWriteTime=i,this.baseMutations=h,this.mutations=v}applyToRemoteDocument(e,i){const h=i.mutationResults;for(let v=0;v<this.mutations.length;v++){const T=this.mutations[v];T.key.isEqual(e.key)&&qa(T,e,h[v])}}applyToLocalView(e,i){for(const h of this.baseMutations)h.key.isEqual(e.key)&&(i=Ka(h,e,i,this.localWriteTime));for(const h of this.mutations)h.key.isEqual(e.key)&&(i=Ka(h,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const h=Wu();return this.mutations.forEach(v=>{const T=e.get(v.key),D=T.overlayedDocument;let X=this.applyToLocalView(D,T.mutatedFields);X=i.has(v.key)?null:X;const te=fc(D,X);null!==te&&h.set(v.key,te),D.isValidDocument()||D.convertToNoDocument(pi.min())}),h}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Os())}isEqual(e){return this.batchId===e.batchId&&Pc(this.mutations,e.mutations,(i,h)=>xa(i,h))&&Pc(this.baseMutations,e.baseMutations,(i,h)=>xa(i,h))}}class fe{constructor(e,i,h,v){this.batch=e,this.commitVersion=i,this.mutationResults=h,this.docVersions=v}static from(e,i,h){zr(e.mutations.length===h.length);let v=function(){return wp}();const T=e.mutations;for(let D=0;D<T.length;D++)v=v.insert(T[D].key,h[D].version);return new fe(e,i,h,v)}}class We{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class fn{constructor(e,i){this.count=e,this.unchangedNames=i}}var Tn,ir;function oi(u){switch(u){default:return pr();case xn.CANCELLED:case xn.UNKNOWN:case xn.DEADLINE_EXCEEDED:case xn.RESOURCE_EXHAUSTED:case xn.INTERNAL:case xn.UNAVAILABLE:case xn.UNAUTHENTICATED:return!1;case xn.INVALID_ARGUMENT:case xn.NOT_FOUND:case xn.ALREADY_EXISTS:case xn.PERMISSION_DENIED:case xn.FAILED_PRECONDITION:case xn.ABORTED:case xn.OUT_OF_RANGE:case xn.UNIMPLEMENTED:case xn.DATA_LOSS:return!0}}function ai(u){if(void 0===u)return Gs("GRPC error has no .code"),xn.UNKNOWN;switch(u){case Tn.OK:return xn.OK;case Tn.CANCELLED:return xn.CANCELLED;case Tn.UNKNOWN:return xn.UNKNOWN;case Tn.DEADLINE_EXCEEDED:return xn.DEADLINE_EXCEEDED;case Tn.RESOURCE_EXHAUSTED:return xn.RESOURCE_EXHAUSTED;case Tn.INTERNAL:return xn.INTERNAL;case Tn.UNAVAILABLE:return xn.UNAVAILABLE;case Tn.UNAUTHENTICATED:return xn.UNAUTHENTICATED;case Tn.INVALID_ARGUMENT:return xn.INVALID_ARGUMENT;case Tn.NOT_FOUND:return xn.NOT_FOUND;case Tn.ALREADY_EXISTS:return xn.ALREADY_EXISTS;case Tn.PERMISSION_DENIED:return xn.PERMISSION_DENIED;case Tn.FAILED_PRECONDITION:return xn.FAILED_PRECONDITION;case Tn.ABORTED:return xn.ABORTED;case Tn.OUT_OF_RANGE:return xn.OUT_OF_RANGE;case Tn.UNIMPLEMENTED:return xn.UNIMPLEMENTED;case Tn.DATA_LOSS:return xn.DATA_LOSS;default:return pr()}}(ir=Tn||(Tn={}))[ir.OK=0]="OK",ir[ir.CANCELLED=1]="CANCELLED",ir[ir.UNKNOWN=2]="UNKNOWN",ir[ir.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ir[ir.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ir[ir.NOT_FOUND=5]="NOT_FOUND",ir[ir.ALREADY_EXISTS=6]="ALREADY_EXISTS",ir[ir.PERMISSION_DENIED=7]="PERMISSION_DENIED",ir[ir.UNAUTHENTICATED=16]="UNAUTHENTICATED",ir[ir.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ir[ir.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ir[ir.ABORTED=10]="ABORTED",ir[ir.OUT_OF_RANGE=11]="OUT_OF_RANGE",ir[ir.UNIMPLEMENTED=12]="UNIMPLEMENTED",ir[ir.INTERNAL=13]="INTERNAL",ir[ir.UNAVAILABLE=14]="UNAVAILABLE",ir[ir.DATA_LOSS=15]="DATA_LOSS";function Nc(){return new TextEncoder}const hh=new fa([4294967295,4294967295],0);function Sp(u){const e=Nc().encode(u),i=new ju;return i.update(e),new Uint8Array(i.digest())}function Yh(u){const e=new DataView(u.buffer),i=e.getUint32(0,!0),h=e.getUint32(4,!0),v=e.getUint32(8,!0),T=e.getUint32(12,!0);return[new fa([i,h],0),new fa([v,T],0)]}class Jh{constructor(e,i,h){if(this.bitmap=e,this.padding=i,this.hashCount=h,i<0||i>=8)throw new fh(`Invalid padding: ${i}`);if(h<0)throw new fh(`Invalid hash count: ${h}`);if(e.length>0&&0===this.hashCount)throw new fh(`Invalid hash count: ${h}`);if(0===e.length&&0!==i)throw new fh(`Invalid padding when bitmap length is 0: ${i}`);this.Te=8*e.length-i,this.Ee=fa.fromNumber(this.Te)}de(e,i,h){let v=e.add(i.multiply(fa.fromNumber(h)));return 1===v.compare(hh)&&(v=new fa([v.getBits(0),v.getBits(1)],0)),v.modulo(this.Ee).toNumber()}Ae(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const i=Sp(e),[h,v]=Yh(i);for(let T=0;T<this.hashCount;T++){const D=this.de(h,v,T);if(!this.Ae(D))return!1}return!0}static create(e,i,h){const v=e%8==0?0:8-e%8,T=new Uint8Array(Math.ceil(e/8)),D=new Jh(T,v,i);return h.forEach(X=>D.insert(X)),D}insert(e){if(0===this.Te)return;const i=Sp(e),[h,v]=Yh(i);for(let T=0;T<this.hashCount;T++){const D=this.de(h,v,T);this.Re(D)}}Re(e){const i=Math.floor(e/8);this.bitmap[i]|=1<<e%8}}class fh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class lu{constructor(e,i,h,v,T){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=h,this.documentUpdates=v,this.resolvedLimboDocuments=T}static createSynthesizedRemoteEventForCurrentChange(e,i,h){const v=new Map;return v.set(e,ph.createSynthesizedTargetChangeForCurrentChange(e,i,h)),new lu(pi.min(),v,new Rr(Qi),Hc(),Os())}}class ph{constructor(e,i,h,v,T){this.resumeToken=e,this.current=i,this.addedDocuments=h,this.modifiedDocuments=v,this.removedDocuments=T}static createSynthesizedTargetChangeForCurrentChange(e,i,h){return new ph(h,i,Os(),Os(),Os())}}class ef{constructor(e,i,h,v){this.Ve=e,this.removedTargetIds=i,this.key=h,this.me=v}}class Td{constructor(e,i){this.targetId=e,this.fe=i}}class tf{constructor(e,i,h=oo.EMPTY_BYTE_STRING,v=null){this.state=e,this.targetIds=i,this.resumeToken=h,this.cause=v}}class mm{constructor(){this.ge=0,this.pe=p_(),this.ye=oo.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=Os(),i=Os(),h=Os();return this.pe.forEach((v,T)=>{switch(T){case 0:e=e.add(v);break;case 2:i=i.add(v);break;case 1:h=h.add(v);break;default:pr()}}),new ph(this.ye,this.we,e,i,h)}Fe(){this.Se=!1,this.pe=p_()}Me(e,i){this.Se=!0,this.pe=this.pe.insert(e,i)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,zr(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class Ap{constructor(e){this.Be=e,this.ke=new Map,this.qe=Hc(),this.Qe=gm(),this.Ke=new Rr(Qi)}$e(e){for(const i of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(i,e.me):this.We(i,e.key,e.me);for(const i of e.removedTargetIds)this.We(i,e.key,e.me)}Ge(e){this.forEachTarget(e,i=>{const h=this.ze(i);switch(e.state){case 0:this.je(i)&&h.Ce(e.resumeToken);break;case 1:h.Ne(),h.be||h.Fe(),h.Ce(e.resumeToken);break;case 2:h.Ne(),h.be||this.removeTarget(i);break;case 3:this.je(i)&&(h.Le(),h.Ce(e.resumeToken));break;case 4:this.je(i)&&(this.He(i),h.Ce(e.resumeToken));break;default:pr()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.ke.forEach((h,v)=>{this.je(v)&&i(v)})}Je(e){const i=e.targetId,h=e.fe.count,v=this.Ye(i);if(v){const T=v.target;if(Hh(T))if(0===h){const D=new a(T.path);this.We(i,D,Eo.newNoDocument(D,pi.min()))}else zr(1===h);else{const D=this.Ze(i);if(D!==h){const X=this.Xe(e),te=X?this.et(X,e,D):1;0!==te&&(this.He(i),this.Ke=this.Ke.insert(i,2===te?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Xe(e){const i=e.fe.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:h="",padding:v=0},hashCount:T=0}=i;let D,X;try{D=fl(h).toUint8Array()}catch(te){if(te instanceof Ma)return As("Decoding the base64 bloom filter in existence filter failed ("+te.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw te}try{X=new Jh(D,v,T)}catch(te){return As(te instanceof fh?"BloomFilter error: ":"Applying bloom filter failed: ",te),null}return 0===X.Te?null:X}et(e,i,h){return i.fe.count===h-this.rt(e,i.targetId)?0:2}rt(e,i){const h=this.Be.getRemoteKeysForTarget(i);let v=0;return h.forEach(T=>{const D=this.Be.nt(),X=`projects/${D.projectId}/databases/${D.database}/documents/${T.path.canonicalString()}`;e.mightContain(X)||(this.We(i,T,null),v++)}),v}it(e){const i=new Map;this.ke.forEach((T,D)=>{const X=this.Ye(D);if(X){if(T.current&&Hh(X.target)){const te=new a(X.target.path);null!==this.qe.get(te)||this.st(D,te)||this.We(D,te,Eo.newNoDocument(te,e))}T.De&&(i.set(D,T.ve()),T.Fe())}});let h=Os();this.Qe.forEach((T,D)=>{let X=!0;D.forEachWhile(te=>{const _e=this.Ye(te);return!_e||"TargetPurposeLimboResolution"===_e.purpose||(X=!1,!1)}),X&&(h=h.add(T))}),this.qe.forEach((T,D)=>D.setReadTime(e));const v=new lu(e,i,this.Ke,this.qe,h);return this.qe=Hc(),this.Qe=gm(),this.Ke=new Rr(Qi),v}Ue(e,i){if(!this.je(e))return;const h=this.st(e,i.key)?2:0;this.ze(e).Me(i.key,h),this.qe=this.qe.insert(i.key,i),this.Qe=this.Qe.insert(i.key,this.ot(i.key).add(e))}We(e,i,h){if(!this.je(e))return;const v=this.ze(e);this.st(e,i)?v.Me(i,1):v.xe(i),this.Qe=this.Qe.insert(i,this.ot(i).delete(e)),h&&(this.qe=this.qe.insert(i,h))}removeTarget(e){this.ke.delete(e)}Ze(e){const i=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let i=this.ke.get(e);return i||(i=new mm,this.ke.set(e,i)),i}ot(e){let i=this.Qe.get(e);return i||(i=new Yi(Qi),this.Qe=this.Qe.insert(e,i)),i}je(e){const i=null!==this.Ye(e);return i||zn("WatchChangeAggregator","Detected inactive target",e),i}Ye(e){const i=this.ke.get(e);return i&&i.be?null:this.Be._t(e)}He(e){this.ke.set(e,new mm),this.Be.getRemoteKeysForTarget(e).forEach(i=>{this.We(e,i,null)})}st(e,i){return this.Be.getRemoteKeysForTarget(e).has(i)}}function gm(){return new Rr(a.comparator)}function p_(){return new Rr(a.comparator)}const m_={asc:"ASCENDING",desc:"DESCENDING"},Qm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},g_={and:"AND",or:"OR"};class hy{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function Ym(u,e){return u.useProto3Json||Kn(e)?e:{value:e}}function nf(u,e){return u.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function __(u,e){return u.useProto3Json?e.toBase64():e.toUint8Array()}function fy(u,e){return nf(u,e.toTimestamp())}function vl(u){return zr(!!u),pi.fromTimestamp(function(i){const h=Tc(i);return new Oo(h.seconds,h.nanos)}(u))}function Id(u,e){return Kc(u,e).canonicalString()}function Kc(u,e){const i=(v=u,new Z(["projects",v.projectId,"databases",v.database])).child("documents");var v;return void 0===e?i:i.child(e)}function kv(u){const e=Z.fromString(u);return zr(af(e)),e}function rf(u,e){return Id(u.databaseId,e.path)}function $d(u,e){const i=kv(e);if(i.get(1)!==u.databaseId.projectId)throw new Un(xn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+u.databaseId.projectId);if(i.get(3)!==u.databaseId.database)throw new Un(xn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+u.databaseId.database);return new a(Cp(i))}function py(u,e){return Id(u.databaseId,e)}function Nv(u){const e=kv(u);return 4===e.length?Z.emptyPath():Cp(e)}function _m(u){return new Z(["projects",u.databaseId.projectId,"databases",u.databaseId.database]).canonicalString()}function Cp(u){return zr(u.length>4&&"documents"===u.get(4)),u.popFirst(5)}function ym(u,e,i){return{name:rf(u,e),fields:i.value.mapValue.fields}}function sf(u,e,i){const h=$d(u,e.name),v=vl(e.updateTime),T=e.createTime?vl(e.createTime):pi.min(),D=new $o({mapValue:{fields:e.fields}}),X=Eo.newFoundDocument(h,v,T,D);return i&&X.setHasCommittedMutations(),i?X.setHasCommittedMutations():X}function vm(u,e){let i;if(e instanceof dh)i={update:ym(u,e.key,e.value)};else if(e instanceof S)i={delete:rf(u,e.key)};else if(e instanceof qc)i={update:ym(u,e.key,e.data),updateMask:gh(e.fieldMask)};else{if(!(e instanceof M))return pr();i={verify:rf(u,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(h=>function(T,D){const X=D.transform;if(X instanceof Pu)return{fieldPath:D.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(X instanceof yu)return{fieldPath:D.field.canonicalString(),appendMissingElements:{values:X.elements}};if(X instanceof Cc)return{fieldPath:D.field.canonicalString(),removeAllFromArray:{values:X.elements}};if(X instanceof Lf)return{fieldPath:D.field.canonicalString(),increment:X.Ie};throw pr()}(0,h))),e.precondition.isNone||(i.currentDocument=void 0!==(T=e.precondition).updateTime?{updateTime:fy(u,T.updateTime)}:void 0!==T.exists?{exists:T.exists}:pr()),i;var T}function Jm(u,e){const i=e.currentDocument?void 0!==(T=e.currentDocument).updateTime?Co.updateTime(vl(T.updateTime)):void 0!==T.exists?Co.exists(T.exists):Co.none():Co.none(),h=e.updateTransforms?e.updateTransforms.map(v=>function(D,X){let te=null;"setToServerValue"in X?(zr("REQUEST_TIME"===X.setToServerValue),te=new Pu):"appendMissingElements"in X?te=new yu(X.appendMissingElements.values||[]):"removeAllFromArray"in X?te=new Cc(X.removeAllFromArray.values||[]):"increment"in X?te=new Lf(D,X.increment):pr();const _e=n.fromServerFormat(X.fieldPath);return new Xh(_e,te)}(u,v)):[];var T;if(e.update){const v=$d(u,e.update.name),T=new $o({mapValue:{fields:e.update.fields}});if(e.updateMask){const D=new ps((e.updateMask.fieldPaths||[]).map(ze=>n.fromServerFormat(ze)));return new qc(v,T,D,i,h)}return new dh(v,T,i,h)}if(e.delete){const v=$d(u,e.delete);return new S(v,i)}if(e.verify){const v=$d(u,e.verify);return new M(v,i)}return pr()}function Lv(u,e){return{documents:[py(u,e.path)]}}function gy(u,e){const i={structuredQuery:{}},h=e.path;let v;null!==e.collectionGroup?(v=h,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(v=h.popLast(),i.structuredQuery.from=[{collectionId:h.lastSegment()}]),i.parent=py(u,v);const T=function(_e){if(0!==_e.length)return Vf(Lo.create(_e,"and"))}(e.filters);T&&(i.structuredQuery.where=T);const D=function(_e){if(0!==_e.length)return _e.map(ze=>{return{field:Sd((Xt=ze).field),direction:xm(Xt.dir)};var Xt})}(e.orderBy);D&&(i.structuredQuery.orderBy=D);const X=Ym(u,e.limit);return null!==X&&(i.structuredQuery.limit=X),e.startAt&&(i.structuredQuery.startAt={before:(_e=e.startAt).inclusive,values:_e.position}),e.endAt&&(i.structuredQuery.endAt=function(_e){return{before:!_e.inclusive,values:_e.position}}(e.endAt)),{ut:i,parent:v};var _e}function _y(u){let e=Nv(u.parent);const i=u.structuredQuery,h=i.from?i.from.length:0;let v=null;if(h>0){zr(1===h);const ze=i.from[0];ze.allDescendants?v=ze.collectionId:e=e.child(ze.collectionId)}let T=[];i.where&&(T=function(vt){const Xt=yy(vt);return Xt instanceof Lo&&rd(Xt)?Xt.getFilters():[Xt]}(i.where));let D=[];i.orderBy&&(D=i.orderBy.map(Xt=>{return new vd(mh((yr=Xt).field),function(xr){switch(xr){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(yr.direction));var yr}));let X=null;i.limit&&(X=function(vt){let Xt;return Xt="object"==typeof vt?vt.value:vt,Kn(Xt)?null:Xt}(i.limit));let te=null;var vt;i.startAt&&(te=new Du((vt=i.startAt).values||[],!!vt.before));let _e=null;return i.endAt&&(_e=function(vt){return new Du(vt.values||[],!vt.before)}(i.endAt)),ah(e,v,D,T,X,"F",te,_e)}function yy(u){return void 0!==u.unaryFilter?function(i){switch(i.unaryFilter.op){case"IS_NAN":const h=mh(i.unaryFilter.field);return ao.create(h,"==",{doubleValue:NaN});case"IS_NULL":const v=mh(i.unaryFilter.field);return ao.create(v,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const T=mh(i.unaryFilter.field);return ao.create(T,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const D=mh(i.unaryFilter.field);return ao.create(D,"!=",{nullValue:"NULL_VALUE"});default:return pr()}}(u):void 0!==u.fieldFilter?ao.create(mh((i=u).fieldFilter.field),function(v){switch(v){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return pr()}}(i.fieldFilter.op),i.fieldFilter.value):void 0!==u.compositeFilter?function(i){return Lo.create(i.compositeFilter.filters.map(h=>yy(h)),function(v){switch(v){case"AND":return"and";case"OR":return"or";default:return pr()}}(i.compositeFilter.op))}(u):pr();var i}function xm(u){return m_[u]}function N0(u){return Qm[u]}function Pa(u){return g_[u]}function Sd(u){return{fieldPath:u.canonicalString()}}function mh(u){return n.fromServerFormat(u.fieldPath)}function Vf(u){return u instanceof ao?function(i){if("=="===i.op){if(To(i.value))return{unaryFilter:{field:Sd(i.field),op:"IS_NAN"}};if(ru(i.value))return{unaryFilter:{field:Sd(i.field),op:"IS_NULL"}}}else if("!="===i.op){if(To(i.value))return{unaryFilter:{field:Sd(i.field),op:"IS_NOT_NAN"}};if(ru(i.value))return{unaryFilter:{field:Sd(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Sd(i.field),op:N0(i.op),value:i.value}}}(u):u instanceof Lo?function(i){const h=i.getFilters().map(v=>Vf(v));return 1===h.length?h[0]:{compositeFilter:{op:Pa(i.op),filters:h}}}(u):pr()}function gh(u){const e=[];return u.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function af(u){return u.length>=4&&"projects"===u.get(0)&&"databases"===u.get(2)}class ad{constructor(e,i,h,v,T=pi.min(),D=pi.min(),X=oo.EMPTY_BYTE_STRING,te=null){this.target=e,this.targetId=i,this.purpose=h,this.sequenceNumber=v,this.snapshotVersion=T,this.lastLimboFreeSnapshotVersion=D,this.resumeToken=X,this.expectedCount=te}withSequenceNumber(e){return new ad(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new ad(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ad(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ad(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Uf{constructor(e){this.ct=e}}function _h(u,e){const i=e.key,h={prefixPath:i.getCollectionPath().popLast().toArray(),collectionGroup:i.collectionGroup,documentId:i.path.lastSegment(),readTime:cf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())h.document={name:rf(T=u.ct,(D=e).key),fields:D.data.value.mapValue.fields,updateTime:nf(T,D.version.toTimestamp()),createTime:nf(T,D.createTime.toTimestamp())};else if(e.isNoDocument())h.noDocument={path:i.path.toArray(),readTime:Ad(e.version)};else{if(!e.isUnknownDocument())return pr();h.unknownDocument={path:i.path.toArray(),version:Ad(e.version)}}var T,D;return h}function cf(u){const e=u.toTimestamp();return[e.seconds,e.nanoseconds]}function Ad(u){const e=u.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Gd(u){const e=new Oo(u.seconds,u.nanoseconds);return pi.fromTimestamp(e)}function zf(u,e){const i=(e.baseMutations||[]).map(T=>Jm(u.ct,T));for(let T=0;T<e.mutations.length-1;++T)T+1<e.mutations.length&&void 0!==e.mutations[T+1].transform&&(e.mutations[T].updateTransforms=e.mutations[T+1].transform.fieldTransforms,e.mutations.splice(T+1,1),++T);const h=e.mutations.map(T=>Jm(u.ct,T)),v=Oo.fromMillis(e.localWriteTimeMs);return new j(e.batchId,v,i,h)}function Cd(u){const e=Gd(u.readTime),i=void 0!==u.lastLimboFreeSnapshotVersion?Gd(u.lastLimboFreeSnapshotVersion):pi.min();let h;return h=void 0!==u.query.documents?(zr(1===(T=u.query).documents.length),ma(ou(Nv(T.documents[0])))):function(T){return ma(_y(T))}(u.query),new ad(h,u.targetId,"TargetPurposeListen",u.lastListenSequenceNumber,e,i,oo.fromBase64String(u.resumeToken));var T}function Dp(u,e){const i=Ad(e.snapshotVersion),h=Ad(e.lastLimboFreeSnapshotVersion);let v;v=Hh(e.target)?Lv(u.ct,e.target):gy(u.ct,e.target).ut;const T=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ed(e.target),readTime:i,resumeToken:T,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:h,query:v}}function Em(u){const e=_y({parent:u.parent,structuredQuery:u.structuredQuery});return"LAST"===u.limitType?bd(e,e.limit,"L"):e}function eg(u,e){return new We(e.largestBatchId,Jm(u.ct,e.overlayMutation))}function tg(u,e){const i=e.path.lastSegment();return[u,Nn(e.path.popLast()),i]}function ng(u,e,i,h){return{indexId:u,uid:e,sequenceNumber:i,readTime:Ad(h.readTime),documentKey:Nn(h.documentKey.path),largestBatchId:h.largestBatchId}}class Mp{getBundleMetadata(e,i){return x_(e).get(i).next(h=>{if(h)return{id:(T=h).bundleId,createTime:Gd(T.createTime),version:T.version};var T})}saveBundleMetadata(e,i){return x_(e).put({bundleId:(v=i).id,createTime:Ad(vl(v.createTime)),version:v.version});var v}getNamedQuery(e,i){return vy(e).get(i).next(h=>{if(h)return{name:(T=h).name,query:Em(T.bundledQuery),readTime:Gd(T.readTime)};var T})}saveNamedQuery(e,i){return vy(e).put({name:(v=i).name,readTime:Ad(vl(v.readTime)),bundledQuery:v.bundledQuery});var v}}function x_(u){return Yr(u,"bundles")}function vy(u){return Yr(u,"namedQueries")}class rg{constructor(e,i){this.serializer=e,this.userId=i}static lt(e,i){return new rg(e,i.uid||"")}getOverlay(e,i){return yh(e).get(tg(this.userId,i)).next(h=>h?eg(this.serializer,h):null)}getOverlays(e,i){const h=gu();return he.forEach(i,v=>this.getOverlay(e,v).next(T=>{null!==T&&h.set(v,T)})).next(()=>h)}saveOverlays(e,i,h){const v=[];return h.forEach((T,D)=>{const X=new We(i,D);v.push(this.ht(e,X))}),he.waitFor(v)}removeOverlaysForBatchId(e,i,h){const v=new Set;i.forEach(D=>v.add(Nn(D.getCollectionPath())));const T=[];return v.forEach(D=>{const X=IDBKeyRange.bound([this.userId,D,h],[this.userId,D,h+1],!1,!0);T.push(yh(e).H("collectionPathOverlayIndex",X))}),he.waitFor(T)}getOverlaysForCollection(e,i,h){const v=gu(),T=Nn(i),D=IDBKeyRange.bound([this.userId,T,h],[this.userId,T,Number.POSITIVE_INFINITY],!0);return yh(e).W("collectionPathOverlayIndex",D).next(X=>{for(const te of X){const _e=eg(this.serializer,te);v.set(_e.getKey(),_e)}return v})}getOverlaysForCollectionGroup(e,i,h,v){const T=gu();let D;const X=IDBKeyRange.bound([this.userId,i,h],[this.userId,i,Number.POSITIVE_INFINITY],!0);return yh(e).Y({index:"collectionGroupOverlayIndex",range:X},(te,_e,ze)=>{const vt=eg(this.serializer,_e);T.size()<v||vt.largestBatchId===D?(T.set(vt.getKey(),vt),D=vt.largestBatchId):ze.done()}).next(()=>T)}ht(e,i){return yh(e).put(function(v,T,D){const[X,te,_e]=tg(T,D.mutation.key);return{userId:T,collectionPath:te,documentId:_e,collectionGroup:D.mutation.key.getCollectionGroup(),largestBatchId:D.largestBatchId,overlayMutation:vm(v.ct,D.mutation)}}(this.serializer,this.userId,i))}}function yh(u){return Yr(u,"documentOverlays")}class uf{constructor(){}Pt(e,i){this.It(e,i),i.Tt()}It(e,i){if("nullValue"in e)this.Et(i,5);else if("booleanValue"in e)this.Et(i,10),i.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(i,15),i.dt(No(e.integerValue));else if("doubleValue"in e){const h=No(e.doubleValue);isNaN(h)?this.Et(i,13):(this.Et(i,15),dn(h)?i.dt(0):i.dt(h))}else if("timestampValue"in e){const h=e.timestampValue;this.Et(i,20),"string"==typeof h?i.At(h):(i.At(`${h.seconds||""}`),i.dt(h.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,i),this.Vt(i);else if("bytesValue"in e)this.Et(i,30),i.ft(fl(e.bytesValue)),this.Vt(i);else if("referenceValue"in e)this.gt(e.referenceValue,i);else if("geoPointValue"in e){const h=e.geoPointValue;this.Et(i,45),i.dt(h.latitude||0),i.dt(h.longitude||0)}else"mapValue"in e?Ll(e)?this.Et(i,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,i),this.Vt(i)):"arrayValue"in e?(this.wt(e.arrayValue,i),this.Vt(i)):pr()}Rt(e,i){this.Et(i,25),this.St(e,i)}St(e,i){i.At(e)}yt(e,i){const h=e.fields||{};this.Et(i,55);for(const v of Object.keys(h))this.Rt(v,i),this.It(h[v],i)}wt(e,i){const h=e.values||[];this.Et(i,50);for(const v of h)this.It(v,i)}gt(e,i){this.Et(i,37),a.fromName(e).path.forEach(h=>{this.Et(i,60),this.St(h,i)})}Et(e,i){e.dt(i)}Vt(e){e.dt(2)}}function E_(u){if(0===u)return 8;let e=0;return!(u>>4)&&(e+=4,u<<=4),!(u>>6)&&(e+=2,u<<=2),!(u>>7)&&(e+=1),e}function wm(u){const e=64-function(h){let v=0;for(let T=0;T<8;++T){const D=E_(255&h[T]);if(v+=D,8!==D)break}return v}(u);return Math.ceil(e/8)}uf.bt=new uf;class L0{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){const i=e[Symbol.iterator]();let h=i.next();for(;!h.done;)this.Ct(h.value),h=i.next();this.vt()}Ft(e){const i=e[Symbol.iterator]();let h=i.next();for(;!h.done;)this.Mt(h.value),h=i.next();this.xt()}Ot(e){for(const i of e){const h=i.charCodeAt(0);if(h<128)this.Ct(h);else if(h<2048)this.Ct(960|h>>>6),this.Ct(128|63&h);else if(i<"\ud800"||"\udbff"<i)this.Ct(480|h>>>12),this.Ct(128|63&h>>>6),this.Ct(128|63&h);else{const v=i.codePointAt(0);this.Ct(240|v>>>18),this.Ct(128|63&v>>>12),this.Ct(128|63&v>>>6),this.Ct(128|63&v)}}this.vt()}Nt(e){for(const i of e){const h=i.charCodeAt(0);if(h<128)this.Mt(h);else if(h<2048)this.Mt(960|h>>>6),this.Mt(128|63&h);else if(i<"\ud800"||"\udbff"<i)this.Mt(480|h>>>12),this.Mt(128|63&h>>>6),this.Mt(128|63&h);else{const v=i.codePointAt(0);this.Mt(240|v>>>18),this.Mt(128|63&v>>>12),this.Mt(128|63&v>>>6),this.Mt(128|63&v)}}this.xt()}Lt(e){const i=this.Bt(e),h=wm(i);this.kt(1+h),this.buffer[this.position++]=255&h;for(let v=i.length-h;v<i.length;++v)this.buffer[this.position++]=255&i[v]}qt(e){const i=this.Bt(e),h=wm(i);this.kt(1+h),this.buffer[this.position++]=~(255&h);for(let v=i.length-h;v<i.length;++v)this.buffer[this.position++]=~(255&i[v])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){const i=function(T){const D=new DataView(new ArrayBuffer(8));return D.setFloat64(0,T,!1),new Uint8Array(D.buffer)}(e),h=!!(128&i[0]);i[0]^=h?255:128;for(let v=1;v<i.length;++v)i[v]^=h?255:0;return i}Ct(e){const i=255&e;0===i?(this.Kt(0),this.Kt(255)):255===i?(this.Kt(255),this.Kt(0)):this.Kt(i)}Mt(e){const i=255&e;0===i?(this.Ut(0),this.Ut(255)):255===i?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){const i=e+this.position;if(i<=this.buffer.length)return;let h=2*this.buffer.length;h<i&&(h=i);const v=new Uint8Array(h);v.set(this.buffer),this.buffer=v}}class Fv{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class Hd{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class bm{constructor(){this.Gt=new L0,this.zt=new Fv(this.Gt),this.jt=new Hd(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class Wd{constructor(e,i,h,v){this.indexId=e,this.documentKey=i,this.arrayValue=h,this.directionalValue=v}Jt(){const e=this.directionalValue.length,i=0===e||255===this.directionalValue[e-1]?e+1:e,h=new Uint8Array(i);return h.set(this.directionalValue,0),i!==e?h.set([0],this.directionalValue.length):++h[h.length-1],new Wd(this.indexId,this.documentKey,this.arrayValue,h)}}function qd(u,e){let i=u.indexId-e.indexId;return 0!==i?i:(i=w_(u.arrayValue,e.arrayValue),0!==i?i:(i=w_(u.directionalValue,e.directionalValue),0!==i?i:a.comparator(u.documentKey,e.documentKey)))}function w_(u,e){for(let i=0;i<u.length&&i<e.length;++i){const h=u[i]-e[i];if(0!==h)return h}return u.length-e.length}class ig{constructor(e){this.Yt=new Yi((i,h)=>n.comparator(i.field,h.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(const i of e.filters){const h=i;h.isInequality()?this.Yt=this.Yt.add(h):this.Xt.push(h)}}get en(){return this.Yt.size>1}tn(e){if(zr(e.collectionGroup===this.collectionId),this.en)return!1;const i=y(e);if(void 0!==i&&!this.nn(i))return!1;const h=w(e);let v=new Set,T=0,D=0;for(;T<h.length&&this.nn(h[T]);++T)v=v.add(h[T].fieldPath.canonicalString());if(T===h.length)return!0;if(this.Yt.size>0){const X=this.Yt.getIterator().getNext();if(!v.has(X.field.canonicalString())){const te=h[T];if(!this.rn(X,te)||!this.sn(this.Zt[D++],te))return!1}++T}for(;T<h.length;++T)if(D>=this.Zt.length||!this.sn(this.Zt[D++],h[T]))return!1;return!0}on(){if(this.en)return null;let e=new Yi(n.comparator);const i=[];for(const h of this.Xt)if(!h.field.isKeyField())if("array-contains"===h.op||"array-contains-any"===h.op)i.push(new P(h.field,2));else{if(e.has(h.field))continue;e=e.add(h.field),i.push(new P(h.field,0))}for(const h of this.Zt)h.field.isKeyField()||e.has(h.field)||(e=e.add(h.field),i.push(new P(h.field,"asc"===h.dir?0:1)));return new p(p.UNKNOWN_ID,this.collectionId,i,K.empty())}nn(e){for(const i of this.Xt)if(this.rn(i,e))return!0;return!1}rn(e,i){return!(void 0===e||!e.field.isEqual(i.fieldPath))&&2===i.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,i){return!!e.field.isEqual(i.fieldPath)&&(0===i.kind&&"asc"===e.dir||1===i.kind&&"desc"===e.dir)}}function sg(u){var e,i;if(zr(u instanceof ao||u instanceof Lo),u instanceof ao){if(u instanceof ua){const v=(null===(i=null===(e=u.value.arrayValue)||void 0===e?void 0:e.values)||void 0===i?void 0:i.map(T=>ao.create(u.field,"==",T)))||[];return Lo.create(v,"or")}return u}const h=u.filters.map(v=>sg(v));return Lo.create(h,u.op)}function og(u){if(0===u.getFilters().length)return[];const e=jf(sg(u));return zr(Op(e)),Rp(e)||Pp(e)?[e]:e.getFilters()}function Rp(u){return u instanceof ao}function Pp(u){return u instanceof Lo&&rd(u)}function Op(u){return Rp(u)||Pp(u)||function(i){if(i instanceof Lo&&zh(i)){for(const h of i.getFilters())if(!Rp(h)&&!Pp(h))return!1;return!0}return!1}(u)}function jf(u){if(zr(u instanceof ao||u instanceof Lo),u instanceof ao)return u;if(1===u.filters.length)return jf(u.filters[0]);const e=u.filters.map(h=>jf(h));let i=Lo.create(e,u.op);return i=Ku(i),Op(i)?i:(zr(i instanceof Lo),zr(Uh(i)),zr(i.filters.length>1),i.filters.reduce((h,v)=>kp(h,v)))}function kp(u,e){let i;return zr(u instanceof ao||u instanceof Lo),zr(e instanceof ao||e instanceof Lo),i=u instanceof ao?e instanceof ao?Lo.create([u,e],"and"):ag(u,e):e instanceof ao?ag(e,u):function(v,T){if(zr(v.filters.length>0&&T.filters.length>0),Uh(v)&&Uh(T))return sh(v,T.getFilters());const D=zh(v)?v:T,X=zh(v)?T:v,te=D.filters.map(_e=>kp(_e,X));return Lo.create(te,"or")}(u,e),Ku(i)}function ag(u,e){if(Uh(e))return sh(e,u.getFilters());{const i=e.filters.map(h=>kp(u,h));return Lo.create(i,"or")}}function Ku(u){if(zr(u instanceof ao||u instanceof Lo),u instanceof ao)return u;const e=u.getFilters();if(1===e.length)return Ku(e[0]);if(iu(u))return u;const i=e.map(v=>Ku(v)),h=[];return i.forEach(v=>{v instanceof ao?h.push(v):v instanceof Lo&&(v.op===u.op?h.push(...v.filters):h.push(v))}),1===h.length?h[0]:Lo.create(h,u.op)}class Tm{constructor(){this._n=new lg}addToCollectionParentIndex(e,i){return this._n.add(i),he.resolve()}getCollectionParents(e,i){return he.resolve(this._n.getEntries(i))}addFieldIndex(e,i){return he.resolve()}deleteFieldIndex(e,i){return he.resolve()}deleteAllFieldIndexes(e){return he.resolve()}createTargetIndexes(e,i){return he.resolve()}getDocumentsMatchingTarget(e,i){return he.resolve(null)}getIndexType(e,i){return he.resolve(0)}getFieldIndexes(e,i){return he.resolve([])}getNextCollectionGroupToUpdate(e){return he.resolve(null)}getMinOffset(e,i){return he.resolve(Pe.min())}getMinOffsetFromCollectionGroup(e,i){return he.resolve(Pe.min())}updateCollectionGroup(e,i,h){return he.resolve()}updateIndexEntries(e,i){return he.resolve()}}class lg{constructor(){this.index={}}add(e){const i=e.lastSegment(),h=e.popLast(),v=this.index[i]||new Yi(Z.comparator),T=!v.has(h);return this.index[i]=v.add(h),T}has(e){const i=e.lastSegment(),h=e.popLast(),v=this.index[i];return v&&v.has(h)}getEntries(e){return(this.index[e]||new Yi(Z.comparator)).toArray()}}const $f=new Uint8Array(0);class Im{constructor(e,i){this.databaseId=i,this.an=new lg,this.un=new il(h=>Ed(h),(h,v)=>Ud(h,v)),this.uid=e.uid||""}addToCollectionParentIndex(e,i){if(!this.an.has(i)){const h=i.lastSegment(),v=i.popLast();e.addOnCommittedListener(()=>{this.an.add(i)});const T={collectionId:h,parent:Nn(v)};return cg(e).put(T)}return he.resolve()}getCollectionParents(e,i){const h=[],v=IDBKeyRange.bound([i,""],[nh(i),""],!1,!0);return cg(e).W(v).next(T=>{for(const D of T){if(D.collectionId!==i)break;h.push(Xr(D.parent))}return h})}addFieldIndex(e,i){const h=Gf(e),v={indexId:(X=i).indexId,collectionGroup:X.collectionGroup,fields:X.fields.map(te=>[te.fieldPath.canonicalString(),te.kind])};var X;delete v.indexId;const T=h.add(v);if(i.indexState){const D=hf(e);return T.next(X=>{D.put(ng(X,this.uid,i.indexState.sequenceNumber,i.indexState.offset))})}return T.next()}deleteFieldIndex(e,i){const h=Gf(e),v=hf(e),T=df(e);return h.delete(i.indexId).next(()=>v.delete(IDBKeyRange.bound([i.indexId],[i.indexId+1],!1,!0))).next(()=>T.delete(IDBKeyRange.bound([i.indexId],[i.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const i=Gf(e),h=df(e),v=hf(e);return i.H().next(()=>h.H()).next(()=>v.H())}createTargetIndexes(e,i){return he.forEach(this.cn(i),h=>this.getIndexType(e,h).next(v=>{if(0===v||1===v){const T=new ig(h).on();if(null!=T)return this.addFieldIndex(e,T)}}))}getDocumentsMatchingTarget(e,i){const h=df(e);let v=!0;const T=new Map;return he.forEach(this.cn(i),D=>this.ln(e,D).next(X=>{v&&(v=!!X),T.set(D,X)})).next(()=>{if(v){let D=Os();const X=[];return he.forEach(T,(te,_e)=>{var ni;zn("IndexedDbIndexManager",`Using index ${ni=te,`id=${ni.indexId}|cg=${ni.collectionGroup}|f=${ni.fields.map(Ji=>`${Ji.fieldPath}:${Ji.kind}`).join(",")}`} to execute ${Ed(i)}`);const ze=function(ni,Ji){const Js=y(Ji);if(void 0===Js)return null;for(const Ho of Hu(ni,Js.fieldPath))switch(Ho.op){case"array-contains-any":return Ho.value.arrayValue.values||[];case"array-contains":return[Ho.value]}return null}(_e,te),vt=function(ni,Ji){const Js=new Map;for(const Ho of w(Ji))for(const ec of Hu(ni,Ho.fieldPath))switch(ec.op){case"==":case"in":Js.set(Ho.fieldPath.canonicalString(),ec.value);break;case"not-in":case"!=":return Js.set(Ho.fieldPath.canonicalString(),ec.value),Array.from(Js.values())}return null}(_e,te),Xt=function(ni,Ji){const Js=[];let Ho=!0;for(const ec of w(Ji)){const Fd=0===ec.kind?xp(ni,ec.fieldPath,ni.startAt):Ep(ni,ec.fieldPath,ni.startAt);Js.push(Fd.value),Ho&&(Ho=Fd.inclusive)}return new Du(Js,Ho)}(_e,te),un=function(ni,Ji){const Js=[];let Ho=!0;for(const ec of w(Ji)){const Fd=0===ec.kind?Ep(ni,ec.fieldPath,ni.endAt):xp(ni,ec.fieldPath,ni.endAt);Js.push(Fd.value),Ho&&(Ho=Fd.inclusive)}return new Du(Js,Ho)}(_e,te),yr=this.hn(te,_e,Xt),Ir=this.hn(te,_e,un),xr=this.Pn(te,_e,vt),hi=this.In(te.indexId,ze,yr,Xt.inclusive,Ir,un.inclusive,xr);return he.forEach(hi,Xi=>h.j(Xi,i.limit).next(ni=>{ni.forEach(Ji=>{const Js=a.fromSegments(Ji.documentKey);D.has(Js)||(D=D.add(Js),X.push(Js))})}))}).next(()=>X)}return he.resolve(null)})}cn(e){let i=this.un.get(e);return i||(i=0===e.filters.length?[e]:og(Lo.create(e.filters,"and")).map(h=>Gh(e.path,e.collectionGroup,e.orderBy,h.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,i),i)}In(e,i,h,v,T,D,X){const te=(null!=i?i.length:1)*Math.max(h.length,T.length),_e=te/(null!=i?i.length:1),ze=[];for(let vt=0;vt<te;++vt){const Xt=i?this.Tn(i[vt/_e]):$f,un=this.En(e,Xt,h[vt%_e],v),yr=this.dn(e,Xt,T[vt%_e],D),Ir=X.map(xr=>this.En(e,Xt,xr,!0));ze.push(...this.createRange(un,yr,Ir))}return ze}En(e,i,h,v){const T=new Wd(e,a.empty(),i,h);return v?T:T.Jt()}dn(e,i,h,v){const T=new Wd(e,a.empty(),i,h);return v?T.Jt():T}ln(e,i){const h=new ig(i),v=null!=i.collectionGroup?i.collectionGroup:i.path.lastSegment();return this.getFieldIndexes(e,v).next(T=>{let D=null;for(const X of T)h.tn(X)&&(!D||X.fields.length>D.fields.length)&&(D=X);return D})}getIndexType(e,i){let h=2;const v=this.cn(i);return he.forEach(v,T=>this.ln(e,T).next(D=>{D?0!==h&&D.fields.length<function(te){let _e=new Yi(n.comparator),ze=!1;for(const vt of te.filters)for(const Xt of vt.getFlattenedFilters())Xt.field.isKeyField()||("array-contains"===Xt.op||"array-contains-any"===Xt.op?ze=!0:_e=_e.add(Xt.field));for(const vt of te.orderBy)vt.field.isKeyField()||(_e=_e.add(vt.field));return _e.size+(ze?1:0)}(T)&&(h=1):h=0})).next(()=>null!==i.limit&&v.length>1&&2===h?1:h)}An(e,i){const h=new bm;for(const v of w(e)){const T=i.data.field(v.fieldPath);if(null==T)return null;const D=h.Ht(v.kind);uf.bt.Pt(T,D)}return h.Wt()}Tn(e){const i=new bm;return uf.bt.Pt(e,i.Ht(0)),i.Wt()}Rn(e,i){const h=new bm;return uf.bt.Pt(es(this.databaseId,i),h.Ht(function(T){const D=w(T);return 0===D.length?0:D[D.length-1].kind}(e))),h.Wt()}Pn(e,i,h){if(null===h)return[];let v=[];v.push(new bm);let T=0;for(const D of w(e)){const X=h[T++];for(const te of v)if(this.Vn(i,D.fieldPath)&&rs(X))v=this.mn(v,D,X);else{const _e=te.Ht(D.kind);uf.bt.Pt(X,_e)}}return this.fn(v)}hn(e,i,h){return this.Pn(e,i,h.position)}fn(e){const i=[];for(let h=0;h<e.length;++h)i[h]=e[h].Wt();return i}mn(e,i,h){const v=[...e],T=[];for(const D of h.arrayValue.values||[])for(const X of v){const te=new bm;te.seed(X.Wt()),uf.bt.Pt(D,te.Ht(i.kind)),T.push(te)}return T}Vn(e,i){return!!e.filters.find(h=>h instanceof ao&&h.field.isEqual(i)&&("in"===h.op||"not-in"===h.op))}getFieldIndexes(e,i){const h=Gf(e),v=hf(e);return(i?h.W("collectionGroupIndex",IDBKeyRange.bound(i,i)):h.W()).next(T=>{const D=[];return he.forEach(T,X=>v.get([X.indexId,this.uid]).next(te=>{D.push(function(ze,vt){const Xt=vt?new K(vt.sequenceNumber,new Pe(Gd(vt.readTime),new a(Xr(vt.documentKey)),vt.largestBatchId)):K.empty(),un=ze.fields.map(([yr,Ir])=>new P(n.fromServerFormat(yr),Ir));return new p(ze.indexId,ze.collectionGroup,un,Xt)}(X,te))})).next(()=>D)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(i=>0===i.length?null:(i.sort((h,v)=>{const T=h.indexState.sequenceNumber-v.indexState.sequenceNumber;return 0!==T?T:Qi(h.collectionGroup,v.collectionGroup)}),i[0].collectionGroup))}updateCollectionGroup(e,i,h){const v=Gf(e),T=hf(e);return this.gn(e).next(D=>v.W("collectionGroupIndex",IDBKeyRange.bound(i,i)).next(X=>he.forEach(X,te=>T.put(ng(te.indexId,this.uid,D,h)))))}updateIndexEntries(e,i){const h=new Map;return he.forEach(i,(v,T)=>{const D=h.get(v.collectionGroup);return(D?he.resolve(D):this.getFieldIndexes(e,v.collectionGroup)).next(X=>(h.set(v.collectionGroup,X),he.forEach(X,te=>this.pn(e,v,te).next(_e=>{const ze=this.yn(T,te);return _e.isEqual(ze)?he.resolve():this.wn(e,T,te,_e,ze)}))))})}Sn(e,i,h,v){return df(e).put({indexId:v.indexId,uid:this.uid,arrayValue:v.arrayValue,directionalValue:v.directionalValue,orderedDocumentKey:this.Rn(h,i.key),documentKey:i.key.path.toArray()})}bn(e,i,h,v){return df(e).delete([v.indexId,this.uid,v.arrayValue,v.directionalValue,this.Rn(h,i.key),i.key.path.toArray()])}pn(e,i,h){const v=df(e);let T=new Yi(qd);return v.Y({index:"documentKeyIndex",range:IDBKeyRange.only([h.indexId,this.uid,this.Rn(h,i)])},(D,X)=>{T=T.add(new Wd(h.indexId,i,X.arrayValue,X.directionalValue))}).next(()=>T)}yn(e,i){let h=new Yi(qd);const v=this.An(i,e);if(null==v)return h;const T=y(i);if(null!=T){const D=e.data.field(T.fieldPath);if(rs(D))for(const X of D.arrayValue.values||[])h=h.add(new Wd(i.indexId,e.key,this.Tn(X),v))}else h=h.add(new Wd(i.indexId,e.key,$f,v));return h}wn(e,i,h,v,T){zn("IndexedDbIndexManager","Updating index entries for document '%s'",i.key);const D=[];return function(te,_e,ze,vt,Xt){const un=te.getIterator(),yr=_e.getIterator();let Ir=ko(un),xr=ko(yr);for(;Ir||xr;){let hi=!1,Xi=!1;if(Ir&&xr){const ni=ze(Ir,xr);ni<0?Xi=!0:ni>0&&(hi=!0)}else null!=Ir?Xi=!0:hi=!0;hi?(vt(xr),xr=ko(yr)):Xi?(Xt(Ir),Ir=ko(un)):(Ir=ko(un),xr=ko(yr))}}(v,T,qd,X=>{D.push(this.Sn(e,i,h,X))},X=>{D.push(this.bn(e,i,h,X))}),he.waitFor(D)}gn(e){let i=1;return hf(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(h,v,T)=>{T.done(),i=v.sequenceNumber+1}).next(()=>i)}createRange(e,i,h){h=h.sort((D,X)=>qd(D,X)).filter((D,X,te)=>!X||0!==qd(D,te[X-1]));const v=[];v.push(e);for(const D of h){const X=qd(D,e),te=qd(D,i);if(0===X)v[0]=e.Jt();else if(X>0&&te<0)v.push(D),v.push(D.Jt());else if(te>0)break}v.push(i);const T=[];for(let D=0;D<v.length;D+=2){if(this.Dn(v[D],v[D+1]))return[];T.push(IDBKeyRange.bound([v[D].indexId,this.uid,v[D].arrayValue,v[D].directionalValue,$f,[]],[v[D+1].indexId,this.uid,v[D+1].arrayValue,v[D+1].directionalValue,$f,[]]))}return T}Dn(e,i){return qd(e,i)>0}getMinOffsetFromCollectionGroup(e,i){return this.getFieldIndexes(e,i).next(vh)}getMinOffset(e,i){return he.mapArray(this.cn(i),h=>this.ln(e,h).next(v=>v||pr())).next(vh)}}function cg(u){return Yr(u,"collectionParents")}function df(u){return Yr(u,"indexEntries")}function Gf(u){return Yr(u,"indexConfiguration")}function hf(u){return Yr(u,"indexState")}function vh(u){zr(0!==u.length);let e=u[0].indexState.offset,i=e.largestBatchId;for(let h=1;h<u.length;h++){const v=u[h].indexState.offset;Ke(v,e)<0&&(e=v),i<v.largestBatchId&&(i=v.largestBatchId)}return new Pe(e.readTime,e.documentKey,i)}const b_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Zc{constructor(e,i,h){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=h}static withCacheSize(e){return new Zc(e,Zc.DEFAULT_COLLECTION_PERCENTILE,Zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function xy(u,e,i){const h=u.store("mutations"),v=u.store("documentMutations"),T=[],D=IDBKeyRange.only(i.batchId);let X=0;const te=h.Y({range:D},(ze,vt,Xt)=>(X++,Xt.delete()));T.push(te.next(()=>{zr(1===X)}));const _e=[];for(const ze of i.mutations){const vt=R(e,ze.key.path,i.batchId);T.push(v.delete(vt)),_e.push(ze.key)}return he.waitFor(T).next(()=>_e)}function ug(u){if(!u)return 0;let e;if(u.document)e=u.document;else if(u.unknownDocument)e=u.unknownDocument;else{if(!u.noDocument)throw pr();e=u.noDocument}return JSON.stringify(e).length}Zc.DEFAULT_COLLECTION_PERCENTILE=10,Zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zc.DEFAULT=new Zc(41943040,Zc.DEFAULT_COLLECTION_PERCENTILE,Zc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zc.DISABLED=new Zc(-1,0,0);class Sm{constructor(e,i,h,v){this.userId=e,this.serializer=i,this.indexManager=h,this.referenceDelegate=v,this.Cn={}}static lt(e,i,h,v){zr(""!==e.uid);const T=e.isAuthenticated()?e.uid:"";return new Sm(T,i,h,v)}checkEmpty(e){let i=!0;const h=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ou(e).Y({index:"userMutationsIndex",range:h},(v,T,D)=>{i=!1,D.done()}).next(()=>i)}addMutationBatch(e,i,h,v){const T=Yl(e),D=Ou(e);return D.add({}).next(X=>{zr("number"==typeof X);const te=new j(X,i,h,v),_e=function(un,yr,Ir){const xr=Ir.baseMutations.map(Xi=>vm(un.ct,Xi)),hi=Ir.mutations.map(Xi=>vm(un.ct,Xi));return{userId:yr,batchId:Ir.batchId,localWriteTimeMs:Ir.localWriteTime.toMillis(),baseMutations:xr,mutations:hi}}(this.serializer,this.userId,te),ze=[];let vt=new Yi((Xt,un)=>Qi(Xt.canonicalString(),un.canonicalString()));for(const Xt of v){const un=R(this.userId,Xt.key.path,X);vt=vt.add(Xt.key.path.popLast()),ze.push(D.put(_e)),ze.push(T.put(un,L))}return vt.forEach(Xt=>{ze.push(this.indexManager.addToCollectionParentIndex(e,Xt))}),e.addOnCommittedListener(()=>{this.Cn[X]=te.keys()}),he.waitFor(ze).next(()=>te)})}lookupMutationBatch(e,i){return Ou(e).get(i).next(h=>h?(zr(h.userId===this.userId),zf(this.serializer,h)):null)}vn(e,i){return this.Cn[i]?he.resolve(this.Cn[i]):this.lookupMutationBatch(e,i).next(h=>{if(h){const v=h.keys();return this.Cn[i]=v,v}return null})}getNextMutationBatchAfterBatchId(e,i){const h=i+1,v=IDBKeyRange.lowerBound([this.userId,h]);let T=null;return Ou(e).Y({index:"userMutationsIndex",range:v},(D,X,te)=>{X.userId===this.userId&&(zr(X.batchId>=h),T=zf(this.serializer,X)),te.done()}).next(()=>T)}getHighestUnacknowledgedBatchId(e){const i=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let h=-1;return Ou(e).Y({index:"userMutationsIndex",range:i,reverse:!0},(v,T,D)=>{h=T.batchId,D.done()}).next(()=>h)}getAllMutationBatches(e){const i=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ou(e).W("userMutationsIndex",i).next(h=>h.map(v=>zf(this.serializer,v)))}getAllMutationBatchesAffectingDocumentKey(e,i){const h=Br(this.userId,i.path),v=IDBKeyRange.lowerBound(h),T=[];return Yl(e).Y({range:v},(D,X,te)=>{const[_e,ze,vt]=D,Xt=Xr(ze);if(_e===this.userId&&i.path.isEqual(Xt))return Ou(e).get(vt).next(un=>{if(!un)throw pr();zr(un.userId===this.userId),T.push(zf(this.serializer,un))});te.done()}).next(()=>T)}getAllMutationBatchesAffectingDocumentKeys(e,i){let h=new Yi(Qi);const v=[];return i.forEach(T=>{const D=Br(this.userId,T.path),X=IDBKeyRange.lowerBound(D),te=Yl(e).Y({range:X},(_e,ze,vt)=>{const[Xt,un,yr]=_e,Ir=Xr(un);Xt===this.userId&&T.path.isEqual(Ir)?h=h.add(yr):vt.done()});v.push(te)}),he.waitFor(v).next(()=>this.Fn(e,h))}getAllMutationBatchesAffectingQuery(e,i){const h=i.path,v=h.length+1,T=Br(this.userId,h),D=IDBKeyRange.lowerBound(T);let X=new Yi(Qi);return Yl(e).Y({range:D},(te,_e,ze)=>{const[vt,Xt,un]=te,yr=Xr(Xt);vt===this.userId&&h.isPrefixOf(yr)?yr.length===v&&(X=X.add(un)):ze.done()}).next(()=>this.Fn(e,X))}Fn(e,i){const h=[],v=[];return i.forEach(T=>{v.push(Ou(e).get(T).next(D=>{if(null===D)throw pr();zr(D.userId===this.userId),h.push(zf(this.serializer,D))}))}),he.waitFor(v).next(()=>h)}removeMutationBatch(e,i){return xy(e.ae,this.userId,i).next(h=>(e.addOnCommittedListener(()=>{this.Mn(i.batchId)}),he.forEach(h,v=>this.referenceDelegate.markPotentiallyOrphaned(e,v))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(i=>{if(!i)return he.resolve();const h=IDBKeyRange.lowerBound(function(D){return[D]}(this.userId)),v=[];return Yl(e).Y({range:h},(T,D,X)=>{if(T[0]===this.userId){const te=Xr(T[1]);v.push(te)}else X.done()}).next(()=>{zr(0===v.length)})})}containsKey(e,i){return Zu(e,this.userId,i)}xn(e){return Np(e).get(this.userId).next(i=>i||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Zu(u,e,i){const h=Br(e,i.path),v=h[1],T=IDBKeyRange.lowerBound(h);let D=!1;return Yl(u).Y({range:T,J:!0},(X,te,_e)=>{const[ze,vt,Xt]=X;ze===e&&vt===v&&(D=!0),_e.done()}).next(()=>D)}function Ou(u){return Yr(u,"mutations")}function Yl(u){return Yr(u,"documentMutations")}function Np(u){return Yr(u,"mutationQueues")}class ld{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new ld(0)}static Ln(){return new ld(-1)}}class Am{constructor(e,i){this.referenceDelegate=e,this.serializer=i}allocateTargetId(e){return this.Bn(e).next(i=>{const h=new ld(i.highestTargetId);return i.highestTargetId=h.next(),this.kn(e,i).next(()=>i.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(i=>pi.fromTimestamp(new Oo(i.lastRemoteSnapshotVersion.seconds,i.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(i=>i.highestListenSequenceNumber)}setTargetsMetadata(e,i,h){return this.Bn(e).next(v=>(v.highestListenSequenceNumber=i,h&&(v.lastRemoteSnapshotVersion=h.toTimestamp()),i>v.highestListenSequenceNumber&&(v.highestListenSequenceNumber=i),this.kn(e,v)))}addTargetData(e,i){return this.qn(e,i).next(()=>this.Bn(e).next(h=>(h.targetCount+=1,this.Qn(i,h),this.kn(e,h))))}updateTargetData(e,i){return this.qn(e,i)}removeTargetData(e,i){return this.removeMatchingKeysForTargetId(e,i.targetId).next(()=>Hf(e).delete(i.targetId)).next(()=>this.Bn(e)).next(h=>(zr(h.targetCount>0),h.targetCount-=1,this.kn(e,h)))}removeTargets(e,i,h){let v=0;const T=[];return Hf(e).Y((D,X)=>{const te=Cd(X);te.sequenceNumber<=i&&null===h.get(te.targetId)&&(v++,T.push(this.removeTargetData(e,te)))}).next(()=>he.waitFor(T)).next(()=>v)}forEachTarget(e,i){return Hf(e).Y((h,v)=>{const T=Cd(v);i(T)})}Bn(e){return T_(e).get("targetGlobalKey").next(i=>(zr(null!==i),i))}kn(e,i){return T_(e).put("targetGlobalKey",i)}qn(e,i){return Hf(e).put(Dp(this.serializer,i))}Qn(e,i){let h=!1;return e.targetId>i.highestTargetId&&(i.highestTargetId=e.targetId,h=!0),e.sequenceNumber>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e.sequenceNumber,h=!0),h}getTargetCount(e){return this.Bn(e).next(i=>i.targetCount)}getTargetData(e,i){const h=Ed(i),v=IDBKeyRange.bound([h,Number.NEGATIVE_INFINITY],[h,Number.POSITIVE_INFINITY]);let T=null;return Hf(e).Y({range:v,index:"queryTargetsIndex"},(D,X,te)=>{const _e=Cd(X);Ud(i,_e.target)&&(T=_e,te.done())}).next(()=>T)}addMatchingKeys(e,i,h){const v=[],T=xh(e);return i.forEach(D=>{const X=Nn(D.path);v.push(T.put({targetId:h,path:X})),v.push(this.referenceDelegate.addReference(e,h,D))}),he.waitFor(v)}removeMatchingKeys(e,i,h){const v=xh(e);return he.forEach(i,T=>{const D=Nn(T.path);return he.waitFor([v.delete([h,D]),this.referenceDelegate.removeReference(e,h,T)])})}removeMatchingKeysForTargetId(e,i){const h=xh(e),v=IDBKeyRange.bound([i],[i+1],!1,!0);return h.delete(v)}getMatchingKeysForTargetId(e,i){const h=IDBKeyRange.bound([i],[i+1],!1,!0),v=xh(e);let T=Os();return v.Y({range:h,J:!0},(D,X,te)=>{const _e=Xr(D[1]),ze=new a(_e);T=T.add(ze)}).next(()=>T)}containsKey(e,i){const h=Nn(i.path),v=IDBKeyRange.bound([h],[nh(h)],!1,!0);let T=0;return xh(e).Y({index:"documentTargetsIndex",J:!0,range:v},([D,X],te,_e)=>{0!==D&&(T++,_e.done())}).next(()=>T>0)}_t(e,i){return Hf(e).get(i).next(h=>h?Cd(h):null)}}function Hf(u){return Yr(u,"targets")}function T_(u){return Yr(u,"targetGlobal")}function xh(u){return Yr(u,"targetDocuments")}function Ey([u,e],[i,h]){const v=Qi(u,i);return 0===v?Qi(e,h):v}class Bv{constructor(e){this.Kn=e,this.buffer=new Yi(Ey),this.$n=0}Un(){return++this.$n}Wn(e){const i=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(i);else{const h=this.buffer.last();Ey(i,h)<0&&(this.buffer=this.buffer.delete(h).add(i))}}get maxValue(){return this.buffer.last()[0]}}class wy{constructor(e,i,h){this.garbageCollector=e,this.asyncQueue=i,this.localStore=h,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){var i=this;zn("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,Ot.A)(function*(){i.Gn=null;try{yield i.localStore.collectGarbage(i.garbageCollector)}catch(h){It(h)?zn("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",h):yield ot(h)}yield i.zn(3e5)}))}}class Vv{constructor(e,i){this.jn=e,this.params=i}calculateTargetCount(e,i){return this.jn.Hn(e).next(h=>Math.floor(i/100*h))}nthSequenceNumber(e,i){if(0===i)return he.resolve(an._e);const h=new Bv(i);return this.jn.forEachTarget(e,v=>h.Wn(v.sequenceNumber)).next(()=>this.jn.Jn(e,v=>h.Wn(v))).next(()=>h.maxValue)}removeTargets(e,i,h){return this.jn.removeTargets(e,i,h)}removeOrphanedDocuments(e,i){return this.jn.removeOrphanedDocuments(e,i)}collect(e,i){return-1===this.params.cacheSizeCollectionThreshold?(zn("LruGarbageCollector","Garbage collection skipped; disabled"),he.resolve(b_)):this.getCacheSize(e).next(h=>h<this.params.cacheSizeCollectionThreshold?(zn("LruGarbageCollector",`Garbage collection skipped; Cache size ${h} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),b_):this.Yn(e,i))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,i){let h,v,T,D,X,te,_e;const ze=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(vt=>(vt>this.params.maximumSequenceNumbersToCollect?(zn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${vt}`),v=this.params.maximumSequenceNumbersToCollect):v=vt,D=Date.now(),this.nthSequenceNumber(e,v))).next(vt=>(h=vt,X=Date.now(),this.removeTargets(e,h,i))).next(vt=>(T=vt,te=Date.now(),this.removeOrphanedDocuments(e,h))).next(vt=>(_e=Date.now(),ta()<=jr.$b.DEBUG&&zn("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${D-ze}ms\n\tDetermined least recently used ${v} in `+(X-D)+`ms\n\tRemoved ${T} targets in `+(te-X)+`ms\n\tRemoved ${vt} documents in `+(_e-te)+`ms\nTotal Duration: ${_e-ze}ms`),he.resolve({didRun:!0,sequenceNumbersCollected:v,targetsRemoved:T,documentsRemoved:vt})))}}class cd{constructor(e,i){this.db=e,this.garbageCollector=function Cm(u,e){return new Vv(u,e)}(this,i)}Hn(e){const i=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(h=>i.next(v=>h+v))}Zn(e){let i=0;return this.Jn(e,h=>{i++}).next(()=>i)}forEachTarget(e,i){return this.db.getTargetCache().forEachTarget(e,i)}Jn(e,i){return this.Xn(e,(h,v)=>i(v))}addReference(e,i,h){return ff(e,h)}removeReference(e,i,h){return ff(e,h)}removeTargets(e,i,h){return this.db.getTargetCache().removeTargets(e,i,h)}markPotentiallyOrphaned(e,i){return ff(e,i)}er(e,i){return function(v,T){let D=!1;return Np(v).Z(X=>Zu(v,X,T).next(te=>(te&&(D=!0),he.resolve(!te)))).next(()=>D)}(e,i)}removeOrphanedDocuments(e,i){const h=this.db.getRemoteDocumentCache().newChangeBuffer(),v=[];let T=0;return this.Xn(e,(D,X)=>{if(X<=i){const te=this.er(e,D).next(_e=>{if(!_e)return T++,h.getEntry(e,D).next(()=>(h.removeEntry(D,pi.min()),xh(e).delete([0,Nn(D.path)])))});v.push(te)}}).next(()=>he.waitFor(v)).next(()=>h.apply(e)).next(()=>T)}removeTarget(e,i){const h=i.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,h)}updateLimboDocument(e,i){return ff(e,i)}Xn(e,i){const h=xh(e);let v,T=an._e;return h.Y({index:"documentTargetsIndex"},([D,X],{path:te,sequenceNumber:_e})=>{0===D?(T!==an._e&&i(new a(Xr(v)),T),T=_e,v=te):T=an._e}).next(()=>{T!==an._e&&i(new a(Xr(v)),T)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ff(u,e){return xh(u).put((v=u.currentSequenceNumber,{targetId:0,path:Nn(e.path),sequenceNumber:v}));var v}class dg{constructor(){this.changes=new il(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Eo.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const h=this.changes.get(i);return void 0!==h?he.resolve(h):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class I_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,i,h){return Lp(e).put(h)}removeEntry(e,i,h){return Lp(e).delete(function(T,D){const X=T.path.toArray();return[X.slice(0,X.length-2),X[X.length-2],cf(D),X[X.length-1]]}(i,h))}updateMetadata(e,i){return this.getMetadata(e).next(h=>(h.byteSize+=i,this.tr(e,h)))}getEntry(e,i){let h=Eo.newInvalidDocument(i);return Lp(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Wf(i))},(v,T)=>{h=this.nr(i,T)}).next(()=>h)}rr(e,i){let h={size:0,document:Eo.newInvalidDocument(i)};return Lp(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Wf(i))},(v,T)=>{h={document:this.nr(i,T),size:ug(T)}}).next(()=>h)}getEntries(e,i){let h=Hc();return this.ir(e,i,(v,T)=>{const D=this.nr(v,T);h=h.insert(v,D)}).next(()=>h)}sr(e,i){let h=Hc(),v=new Rr(a.comparator);return this.ir(e,i,(T,D)=>{const X=this.nr(T,D);h=h.insert(T,X),v=v.insert(T,ug(D))}).next(()=>({documents:h,_r:v}))}ir(e,i,h){if(i.isEmpty())return he.resolve();let v=new Yi(by);i.forEach(te=>v=v.add(te));const T=IDBKeyRange.bound(Wf(v.first()),Wf(v.last())),D=v.getIterator();let X=D.getNext();return Lp(e).Y({index:"documentKeyIndex",range:T},(te,_e,ze)=>{const vt=a.fromSegments([..._e.prefixPath,_e.collectionGroup,_e.documentId]);for(;X&&by(X,vt)<0;)h(X,null),X=D.getNext();X&&X.isEqual(vt)&&(h(X,_e),X=D.hasNext()?D.getNext():null),X?ze.U(Wf(X)):ze.done()}).next(()=>{for(;X;)h(X,null),X=D.hasNext()?D.getNext():null})}getDocumentsMatchingQuery(e,i,h,v,T){const D=i.path,X=[D.popLast().toArray(),D.lastSegment(),cf(h.readTime),h.documentKey.path.isEmpty()?"":h.documentKey.path.lastSegment()],te=[D.popLast().toArray(),D.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Lp(e).W(IDBKeyRange.bound(X,te,!0)).next(_e=>{T?.incrementDocumentReadCount(_e.length);let ze=Hc();for(const vt of _e){const Xt=this.nr(a.fromSegments(vt.prefixPath.concat(vt.collectionGroup,vt.documentId)),vt);Xt.isFoundDocument()&&(kc(i,Xt)||v.has(Xt.key))&&(ze=ze.insert(Xt.key,Xt))}return ze})}getAllFromCollectionGroup(e,i,h,v){let T=Hc();const D=fg(i,h),X=fg(i,Pe.max());return Lp(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(D,X,!0)},(te,_e,ze)=>{const vt=this.nr(a.fromSegments(_e.prefixPath.concat(_e.collectionGroup,_e.documentId)),_e);T=T.insert(vt.key,vt),T.size===v&&ze.done()}).next(()=>T)}newChangeBuffer(e){return new F0(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(i=>i.byteSize)}getMetadata(e){return Uv(e).get("remoteDocumentGlobalKey").next(i=>(zr(!!i),i))}tr(e,i){return Uv(e).put("remoteDocumentGlobalKey",i)}nr(e,i){if(i){const h=function lf(u,e){let i;if(e.document)i=sf(u.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const h=a.fromSegments(e.noDocument.path),v=Gd(e.noDocument.readTime);i=Eo.newNoDocument(h,v),e.hasCommittedMutations&&i.setHasCommittedMutations()}else{if(!e.unknownDocument)return pr();{const h=a.fromSegments(e.unknownDocument.path),v=Gd(e.unknownDocument.version);i=Eo.newUnknownDocument(h,v)}}return e.readTime&&i.setReadTime(function(v){const T=new Oo(v[0],v[1]);return pi.fromTimestamp(T)}(e.readTime)),i}(this.serializer,i);if(!h.isNoDocument()||!h.version.isEqual(pi.min()))return h}return Eo.newInvalidDocument(e)}}function hg(u){return new I_(u)}class F0 extends dg{constructor(e,i){super(),this.ar=e,this.trackRemovals=i,this.ur=new il(h=>h.toString(),(h,v)=>h.isEqual(v))}applyChanges(e){const i=[];let h=0,v=new Yi((T,D)=>Qi(T.canonicalString(),D.canonicalString()));return this.changes.forEach((T,D)=>{const X=this.ur.get(T);if(i.push(this.ar.removeEntry(e,T,X.readTime)),D.isValidDocument()){const te=_h(this.ar.serializer,D);v=v.add(T.path.popLast());const _e=ug(te);h+=_e-X.size,i.push(this.ar.addEntry(e,T,te))}else if(h-=X.size,this.trackRemovals){const te=_h(this.ar.serializer,D.convertToNoDocument(pi.min()));i.push(this.ar.addEntry(e,T,te))}}),v.forEach(T=>{i.push(this.ar.indexManager.addToCollectionParentIndex(e,T))}),i.push(this.ar.updateMetadata(e,h)),he.waitFor(i)}getFromCache(e,i){return this.ar.rr(e,i).next(h=>(this.ur.set(i,{size:h.size,readTime:h.document.readTime}),h.document))}getAllFromCache(e,i){return this.ar.sr(e,i).next(({documents:h,_r:v})=>(v.forEach((T,D)=>{this.ur.set(T,{size:D,readTime:h.get(T).readTime})}),h))}}function Uv(u){return Yr(u,"remoteDocumentGlobal")}function Lp(u){return Yr(u,"remoteDocumentsV14")}function Wf(u){const e=u.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function fg(u,e){const i=e.documentKey.path.toArray();return[u,cf(e.readTime),i.slice(0,i.length-2),i.length>0?i[i.length-1]:""]}function by(u,e){const i=u.path.toArray(),h=e.path.toArray();let v=0;for(let T=0;T<i.length-2&&T<h.length-2;++T)if(v=Qi(i[T],h[T]),v)return v;return v=Qi(i.length,h.length),v||(v=Qi(i[i.length-2],h[h.length-2]),v||Qi(i[i.length-1],h[h.length-1]))}class B0{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}class Jl{constructor(e,i,h,v){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=h,this.indexManager=v}getDocument(e,i){let h=null;return this.documentOverlayCache.getOverlay(e,i).next(v=>(h=v,this.remoteDocumentCache.getEntry(e,i))).next(v=>(null!==h&&Ka(h.mutation,v,ps.empty(),Oo.now()),v))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(h=>this.getLocalViewOfDocuments(e,h,Os()).next(()=>h))}getLocalViewOfDocuments(e,i,h=Os()){const v=gu();return this.populateOverlays(e,v,i).next(()=>this.computeViews(e,i,v,h).next(T=>{let D=Zh();return T.forEach((X,te)=>{D=D.insert(X,te.overlayedDocument)}),D}))}getOverlayedDocuments(e,i){const h=gu();return this.populateOverlays(e,h,i).next(()=>this.computeViews(e,i,h,Os()))}populateOverlays(e,i,h){const v=[];return h.forEach(T=>{i.has(T)||v.push(T)}),this.documentOverlayCache.getOverlays(e,v).next(T=>{T.forEach((D,X)=>{i.set(D,X)})})}computeViews(e,i,h,v){let T=Hc();const D=_u(),X=_u();return i.forEach((te,_e)=>{const ze=h.get(_e.key);v.has(_e.key)&&(void 0===ze||ze.mutation instanceof qc)?T=T.insert(_e.key,_e):void 0!==ze?(D.set(_e.key,ze.mutation.getFieldMask()),Ka(ze.mutation,_e,ze.mutation.getFieldMask(),Oo.now())):D.set(_e.key,ps.empty())}),this.recalculateAndSaveOverlays(e,T).next(te=>(te.forEach((_e,ze)=>D.set(_e,ze)),i.forEach((_e,ze)=>{var vt;return X.set(_e,new B0(ze,null!==(vt=D.get(_e))&&void 0!==vt?vt:null))}),X))}recalculateAndSaveOverlays(e,i){const h=_u();let v=new Rr((D,X)=>D-X),T=Os();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(D=>{for(const X of D)X.keys().forEach(te=>{const _e=i.get(te);if(null===_e)return;let ze=h.get(te)||ps.empty();ze=X.applyToLocalView(_e,ze),h.set(te,ze);const vt=(v.get(X.batchId)||Os()).add(te);v=v.insert(X.batchId,vt)})}).next(()=>{const D=[],X=v.getReverseIterator();for(;X.hasNext();){const te=X.getNext(),_e=te.key,ze=te.value,vt=Wu();ze.forEach(Xt=>{if(!T.has(Xt)){const un=fc(i.get(Xt),h.get(Xt));null!==un&&vt.set(Xt,un),T=T.add(Xt)}}),D.push(this.documentOverlayCache.saveOverlays(e,_e,vt))}return he.waitFor(D)}).next(()=>h)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(h=>this.recalculateAndSaveOverlays(e,h))}getDocumentsMatchingQuery(e,i,h,v){return a.isDocumentKey((D=i).path)&&null===D.collectionGroup&&0===D.filters.length?this.getDocumentsMatchingDocumentQuery(e,i.path):Of(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,h,v):this.getDocumentsMatchingCollectionQuery(e,i,h,v);var D}getNextDocuments(e,i,h,v){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,h,v).next(T=>{const D=v-T.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,h.largestBatchId,v-T.size):he.resolve(gu());let X=-1,te=T;return D.next(_e=>he.forEach(_e,(ze,vt)=>(X<vt.largestBatchId&&(X=vt.largestBatchId),T.get(ze)?he.resolve():this.remoteDocumentCache.getEntry(e,ze).next(Xt=>{te=te.insert(ze,Xt)}))).next(()=>this.populateOverlays(e,_e,T)).next(()=>this.computeViews(e,te,_e,Os())).next(ze=>({batchId:X,changes:Xm(ze)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new a(i)).next(h=>{let v=Zh();return h.isFoundDocument()&&(v=v.insert(h.key,h)),v})}getDocumentsMatchingCollectionGroupQuery(e,i,h,v){const T=i.collectionGroup;let D=Zh();return this.indexManager.getCollectionParents(e,T).next(X=>he.forEach(X,te=>{const _e=(vt=i,Xt=te.child(T),new id(Xt,null,vt.explicitOrderBy.slice(),vt.filters.slice(),vt.limit,vt.limitType,vt.startAt,vt.endAt));var vt,Xt;return this.getDocumentsMatchingCollectionQuery(e,_e,h,v).next(ze=>{ze.forEach((vt,Xt)=>{D=D.insert(vt,Xt)})})}).next(()=>D))}getDocumentsMatchingCollectionQuery(e,i,h,v){let T;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,h.largestBatchId).next(D=>(T=D,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,h,T,v))).next(D=>{T.forEach((te,_e)=>{const ze=_e.getKey();null===D.get(ze)&&(D=D.insert(ze,Eo.newInvalidDocument(ze)))});let X=Zh();return D.forEach((te,_e)=>{const ze=T.get(te);void 0!==ze&&Ka(ze.mutation,_e,ps.empty(),Oo.now()),kc(i,_e)&&(X=X.insert(te,_e))}),X})}}class Dd{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,i){return he.resolve(this.cr.get(i))}saveBundleMetadata(e,i){return this.cr.set(i.id,{id:(v=i).id,version:v.version,createTime:vl(v.createTime)}),he.resolve();var v}getNamedQuery(e,i){return he.resolve(this.lr.get(i))}saveNamedQuery(e,i){return this.lr.set(i.name,{name:(v=i).name,query:Em(v.bundledQuery),readTime:vl(v.readTime)}),he.resolve();var v}}class S_{constructor(){this.overlays=new Rr(a.comparator),this.hr=new Map}getOverlay(e,i){return he.resolve(this.overlays.get(i))}getOverlays(e,i){const h=gu();return he.forEach(i,v=>this.getOverlay(e,v).next(T=>{null!==T&&h.set(v,T)})).next(()=>h)}saveOverlays(e,i,h){return h.forEach((v,T)=>{this.ht(e,i,T)}),he.resolve()}removeOverlaysForBatchId(e,i,h){const v=this.hr.get(h);return void 0!==v&&(v.forEach(T=>this.overlays=this.overlays.remove(T)),this.hr.delete(h)),he.resolve()}getOverlaysForCollection(e,i,h){const v=gu(),T=i.length+1,D=new a(i.child("")),X=this.overlays.getIteratorFrom(D);for(;X.hasNext();){const te=X.getNext().value,_e=te.getKey();if(!i.isPrefixOf(_e.path))break;_e.path.length===T&&te.largestBatchId>h&&v.set(te.getKey(),te)}return he.resolve(v)}getOverlaysForCollectionGroup(e,i,h,v){let T=new Rr((_e,ze)=>_e-ze);const D=this.overlays.getIterator();for(;D.hasNext();){const _e=D.getNext().value;if(_e.getKey().getCollectionGroup()===i&&_e.largestBatchId>h){let ze=T.get(_e.largestBatchId);null===ze&&(ze=gu(),T=T.insert(_e.largestBatchId,ze)),ze.set(_e.getKey(),_e)}}const X=gu(),te=T.getIterator();for(;te.hasNext()&&(te.getNext().value.forEach((_e,ze)=>X.set(_e,ze)),!(X.size()>=v)););return he.resolve(X)}ht(e,i,h){const v=this.overlays.get(h.key);if(null!==v){const D=this.hr.get(v.largestBatchId).delete(h.key);this.hr.set(v.largestBatchId,D)}this.overlays=this.overlays.insert(h.key,new We(i,h));let T=this.hr.get(i);void 0===T&&(T=Os(),this.hr.set(i,T)),this.hr.set(i,T.add(h.key))}}class Fp{constructor(){this.Pr=new Yi(xl.Ir),this.Tr=new Yi(xl.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,i){const h=new xl(e,i);this.Pr=this.Pr.add(h),this.Tr=this.Tr.add(h)}dr(e,i){e.forEach(h=>this.addReference(h,i))}removeReference(e,i){this.Ar(new xl(e,i))}Rr(e,i){e.forEach(h=>this.removeReference(h,i))}Vr(e){const i=new a(new Z([])),h=new xl(i,e),v=new xl(i,e+1),T=[];return this.Tr.forEachInRange([h,v],D=>{this.Ar(D),T.push(D.key)}),T}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const i=new a(new Z([])),h=new xl(i,e),v=new xl(i,e+1);let T=Os();return this.Tr.forEachInRange([h,v],D=>{T=T.add(D.key)}),T}containsKey(e){const i=new xl(e,0),h=this.Pr.firstAfterOrEqual(i);return null!==h&&e.isEqual(h.key)}}class xl{constructor(e,i){this.key=e,this.pr=i}static Ir(e,i){return a.comparator(e.key,i.key)||Qi(e.pr,i.pr)}static Er(e,i){return Qi(e.pr,i.pr)||a.comparator(e.key,i.key)}}class zv{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.yr=1,this.wr=new Yi(xl.Ir)}checkEmpty(e){return he.resolve(0===this.mutationQueue.length)}addMutationBatch(e,i,h,v){const T=this.yr;this.yr++;const D=new j(T,i,h,v);this.mutationQueue.push(D);for(const X of v)this.wr=this.wr.add(new xl(X.key,T)),this.indexManager.addToCollectionParentIndex(e,X.key.path.popLast());return he.resolve(D)}lookupMutationBatch(e,i){return he.resolve(this.Sr(i))}getNextMutationBatchAfterBatchId(e,i){const v=this.br(i+1),T=v<0?0:v;return he.resolve(this.mutationQueue.length>T?this.mutationQueue[T]:null)}getHighestUnacknowledgedBatchId(){return he.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return he.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const h=new xl(i,0),v=new xl(i,Number.POSITIVE_INFINITY),T=[];return this.wr.forEachInRange([h,v],D=>{const X=this.Sr(D.pr);T.push(X)}),he.resolve(T)}getAllMutationBatchesAffectingDocumentKeys(e,i){let h=new Yi(Qi);return i.forEach(v=>{const T=new xl(v,0),D=new xl(v,Number.POSITIVE_INFINITY);this.wr.forEachInRange([T,D],X=>{h=h.add(X.pr)})}),he.resolve(this.Dr(h))}getAllMutationBatchesAffectingQuery(e,i){const h=i.path,v=h.length+1;let T=h;a.isDocumentKey(T)||(T=T.child(""));const D=new xl(new a(T),0);let X=new Yi(Qi);return this.wr.forEachWhile(te=>{const _e=te.key.path;return!!h.isPrefixOf(_e)&&(_e.length===v&&(X=X.add(te.pr)),!0)},D),he.resolve(this.Dr(X))}Dr(e){const i=[];return e.forEach(h=>{const v=this.Sr(h);null!==v&&i.push(v)}),i}removeMutationBatch(e,i){zr(0===this.Cr(i.batchId,"removed")),this.mutationQueue.shift();let h=this.wr;return he.forEach(i.mutations,v=>{const T=new xl(v.key,i.batchId);return h=h.delete(T),this.referenceDelegate.markPotentiallyOrphaned(e,v.key)}).next(()=>{this.wr=h})}Mn(e){}containsKey(e,i){const h=new xl(i,0),v=this.wr.firstAfterOrEqual(h);return he.resolve(i.isEqual(v&&v.key))}performConsistencyCheck(e){return he.resolve()}Cr(e,i){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const i=this.br(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}class Ty{constructor(e){this.vr=e,this.docs=new Rr(a.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const h=i.key,v=this.docs.get(h),T=v?v.size:0,D=this.vr(i);return this.docs=this.docs.insert(h,{document:i.mutableCopy(),size:D}),this.size+=D-T,this.indexManager.addToCollectionParentIndex(e,h.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const h=this.docs.get(i);return he.resolve(h?h.document.mutableCopy():Eo.newInvalidDocument(i))}getEntries(e,i){let h=Hc();return i.forEach(v=>{const T=this.docs.get(v);h=h.insert(v,T?T.document.mutableCopy():Eo.newInvalidDocument(v))}),he.resolve(h)}getDocumentsMatchingQuery(e,i,h,v){let T=Hc();const D=i.path,X=new a(D.child("")),te=this.docs.getIteratorFrom(X);for(;te.hasNext();){const{key:_e,value:{document:ze}}=te.getNext();if(!D.isPrefixOf(_e.path))break;_e.path.length>D.length+1||Ke(ce(ze),h)<=0||(v.has(ze.key)||kc(i,ze))&&(T=T.insert(ze.key,ze.mutableCopy()))}return he.resolve(T)}getAllFromCollectionGroup(e,i,h,v){pr()}Fr(e,i){return he.forEach(this.docs,h=>i(h))}newChangeBuffer(e){return new Bp(this)}getSize(e){return he.resolve(this.size)}}class Bp extends dg{constructor(e){super(),this.ar=e}applyChanges(e){const i=[];return this.changes.forEach((h,v)=>{v.isValidDocument()?i.push(this.ar.addEntry(e,v)):this.ar.removeEntry(h)}),he.waitFor(i)}getFromCache(e,i){return this.ar.getEntry(e,i)}getAllFromCache(e,i){return this.ar.getEntries(e,i)}}class jv{constructor(e){this.persistence=e,this.Mr=new il(i=>Ed(i),Ud),this.lastRemoteSnapshotVersion=pi.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Fp,this.targetCount=0,this.Lr=ld.Nn()}forEachTarget(e,i){return this.Mr.forEach((h,v)=>i(v)),he.resolve()}getLastRemoteSnapshotVersion(e){return he.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return he.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),he.resolve(this.highestTargetId)}setTargetsMetadata(e,i,h){return h&&(this.lastRemoteSnapshotVersion=h),i>this.Or&&(this.Or=i),he.resolve()}qn(e){this.Mr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Lr=new ld(i),this.highestTargetId=i),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,i){return this.qn(i),this.targetCount+=1,he.resolve()}updateTargetData(e,i){return this.qn(i),he.resolve()}removeTargetData(e,i){return this.Mr.delete(i.target),this.Nr.Vr(i.targetId),this.targetCount-=1,he.resolve()}removeTargets(e,i,h){let v=0;const T=[];return this.Mr.forEach((D,X)=>{X.sequenceNumber<=i&&null===h.get(X.targetId)&&(this.Mr.delete(D),T.push(this.removeMatchingKeysForTargetId(e,X.targetId)),v++)}),he.waitFor(T).next(()=>v)}getTargetCount(e){return he.resolve(this.targetCount)}getTargetData(e,i){const h=this.Mr.get(i)||null;return he.resolve(h)}addMatchingKeys(e,i,h){return this.Nr.dr(i,h),he.resolve()}removeMatchingKeys(e,i,h){this.Nr.Rr(i,h);const v=this.persistence.referenceDelegate,T=[];return v&&i.forEach(D=>{T.push(v.markPotentiallyOrphaned(e,D))}),he.waitFor(T)}removeMatchingKeysForTargetId(e,i){return this.Nr.Vr(i),he.resolve()}getMatchingKeysForTargetId(e,i){const h=this.Nr.gr(i);return he.resolve(h)}containsKey(e,i){return he.resolve(this.Nr.containsKey(i))}}class A_{constructor(e,i){this.Br={},this.overlays={},this.kr=new an(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new jv(this),this.indexManager=new Tm,this.remoteDocumentCache=new Ty(h=>this.referenceDelegate.Kr(h)),this.serializer=new Uf(i),this.$r=new Dd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new S_,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let h=this.Br[e.toKey()];return h||(h=new zv(i,this.referenceDelegate),this.Br[e.toKey()]=h),h}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,i,h){zn("MemoryPersistence","Starting transaction:",e);const v=new C_(this.kr.next());return this.referenceDelegate.Ur(),h(v).next(T=>this.referenceDelegate.Wr(v).next(()=>T)).toPromise().then(T=>(v.raiseOnCommittedEvent(),T))}Gr(e,i){return he.or(Object.values(this.Br).map(h=>()=>h.containsKey(e,i)))}}class C_ extends rt{constructor(e){super(),this.currentSequenceNumber=e}}class pf{constructor(e){this.persistence=e,this.zr=new Fp,this.jr=null}static Hr(e){return new pf(e)}get Jr(){if(this.jr)return this.jr;throw pr()}addReference(e,i,h){return this.zr.addReference(h,i),this.Jr.delete(h.toString()),he.resolve()}removeReference(e,i,h){return this.zr.removeReference(h,i),this.Jr.add(h.toString()),he.resolve()}markPotentiallyOrphaned(e,i){return this.Jr.add(i.toString()),he.resolve()}removeTarget(e,i){this.zr.Vr(i.targetId).forEach(v=>this.Jr.add(v.toString()));const h=this.persistence.getTargetCache();return h.getMatchingKeysForTargetId(e,i.targetId).next(v=>{v.forEach(T=>this.Jr.add(T.toString()))}).next(()=>h.removeTargetData(e,i))}Ur(){this.jr=new Set}Wr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return he.forEach(this.Jr,h=>{const v=a.fromPath(h);return this.Yr(e,v).next(T=>{T||i.removeEntry(v,pi.min())})}).next(()=>(this.jr=null,i.apply(e)))}updateLimboDocument(e,i){return this.Yr(e,i).next(h=>{h?this.Jr.delete(i.toString()):this.Jr.add(i.toString())})}Kr(e){return 0}Yr(e,i){return he.or([()=>he.resolve(this.zr.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Gr(e,i)])}}class Fo{constructor(e){this.serializer=e}N(e,i,h,v){const T=new gt("createOrUpgrade",i);var te;h<1&&v>=1&&(e.createObjectStore("owner"),(te=e).createObjectStore("mutationQueues",{keyPath:"userId"}),te.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",bi,{unique:!0}),te.createObjectStore("documentMutations"),pg(e),function(te){te.createObjectStore("remoteDocuments")}(e));let D=he.resolve();return h<3&&v>=3&&(0!==h&&(function(te){te.deleteObjectStore("targetDocuments"),te.deleteObjectStore("targets"),te.deleteObjectStore("targetGlobal")}(e),pg(e)),D=D.next(()=>function(te){const _e=te.store("targetGlobal"),ze={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:pi.min().toTimestamp(),targetCount:0};return _e.put("targetGlobalKey",ze)}(T))),h<4&&v>=4&&(0!==h&&(D=D.next(()=>function(te,_e){return _e.store("mutations").W().next(ze=>{te.deleteObjectStore("mutations"),te.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",bi,{unique:!0});const vt=_e.store("mutations"),Xt=ze.map(un=>vt.put(un));return he.waitFor(Xt)})}(e,T))),D=D.next(()=>{!function(te){te.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),h<5&&v>=5&&(D=D.next(()=>this.Xr(T))),h<6&&v>=6&&(D=D.next(()=>(function(te){te.createObjectStore("remoteDocumentGlobal")}(e),this.ei(T)))),h<7&&v>=7&&(D=D.next(()=>this.ti(T))),h<8&&v>=8&&(D=D.next(()=>this.ni(e,T))),h<9&&v>=9&&(D=D.next(()=>{!function(te){te.objectStoreNames.contains("remoteDocumentChanges")&&te.deleteObjectStore("remoteDocumentChanges")}(e)})),h<10&&v>=10&&(D=D.next(()=>this.ri(T))),h<11&&v>=11&&(D=D.next(()=>{(function(te){te.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(te){te.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),h<12&&v>=12&&(D=D.next(()=>{!function(te){const _e=te.createObjectStore("documentOverlays",{keyPath:Jn});_e.createIndex("collectionPathOverlayIndex",er,{unique:!1}),_e.createIndex("collectionGroupOverlayIndex",Vr,{unique:!1})}(e)})),h<13&&v>=13&&(D=D.next(()=>function(te){const _e=te.createObjectStore("remoteDocumentsV14",{keyPath:$});_e.createIndex("documentKeyIndex",ee),_e.createIndex("collectionGroupIndex",Ee)}(e)).next(()=>this.ii(e,T)).next(()=>e.deleteObjectStore("remoteDocuments"))),h<14&&v>=14&&(D=D.next(()=>this.si(e,T))),h<15&&v>=15&&(D=D.next(()=>function(te){te.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),te.createObjectStore("indexState",{keyPath:gn}).createIndex("sequenceNumberIndex",Rn,{unique:!1}),te.createObjectStore("indexEntries",{keyPath:kn}).createIndex("documentKeyIndex",Bn,{unique:!1})}(e))),D}ei(e){let i=0;return e.store("remoteDocuments").Y((h,v)=>{i+=ug(v)}).next(()=>{const h={byteSize:i};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",h)})}Xr(e){const i=e.store("mutationQueues"),h=e.store("mutations");return i.W().next(v=>he.forEach(v,T=>{const D=IDBKeyRange.bound([T.userId,-1],[T.userId,T.lastAcknowledgedBatchId]);return h.W("userMutationsIndex",D).next(X=>he.forEach(X,te=>{zr(te.userId===T.userId);const _e=zf(this.serializer,te);return xy(e,T.userId,_e).next(()=>{})}))}))}ti(e){const i=e.store("targetDocuments"),h=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(v=>{const T=[];return h.Y((D,X)=>{const te=new Z(D),_e=[0,Nn(te)];T.push(i.get(_e).next(ze=>ze?he.resolve():i.put({targetId:0,path:Nn(te),sequenceNumber:v.highestListenSequenceNumber})))}).next(()=>he.waitFor(T))})}ni(e,i){e.createObjectStore("collectionParents",{keyPath:Lt});const h=i.store("collectionParents"),v=new lg,T=D=>{if(v.add(D)){const X=D.lastSegment(),te=D.popLast();return h.put({collectionId:X,parent:Nn(te)})}};return i.store("remoteDocuments").Y({J:!0},(D,X)=>{const te=new Z(D);return T(te.popLast())}).next(()=>i.store("documentMutations").Y({J:!0},([D,X,te],_e)=>{const ze=Xr(X);return T(ze.popLast())}))}ri(e){const i=e.store("targets");return i.Y((h,v)=>{const T=Cd(v),D=Dp(this.serializer,T);return i.put(D)})}ii(e,i){const h=i.store("remoteDocuments"),v=[];return h.Y((T,D)=>{const X=i.store("remoteDocumentsV14"),te=(vt=D,vt.document?new a(Z.fromString(vt.document.name).popFirst(5)):vt.noDocument?a.fromSegments(vt.noDocument.path):vt.unknownDocument?a.fromSegments(vt.unknownDocument.path):pr()).path.toArray(),_e={prefixPath:te.slice(0,te.length-2),collectionGroup:te[te.length-2],documentId:te[te.length-1],readTime:D.readTime||[0,0],unknownDocument:D.unknownDocument,noDocument:D.noDocument,document:D.document,hasCommittedMutations:!!D.hasCommittedMutations};var vt;v.push(X.put(_e))}).next(()=>he.waitFor(v))}si(e,i){const h=i.store("mutations"),v=hg(this.serializer),T=new A_(pf.Hr,this.serializer.ct);return h.W().next(D=>{const X=new Map;return D.forEach(te=>{var _e;let ze=null!==(_e=X.get(te.userId))&&void 0!==_e?_e:Os();zf(this.serializer,te).keys().forEach(vt=>ze=ze.add(vt)),X.set(te.userId,ze)}),he.forEach(X,(te,_e)=>{const ze=new Ss(_e),vt=rg.lt(this.serializer,ze),Xt=T.getIndexManager(ze),un=Sm.lt(ze,this.serializer,Xt,T.referenceDelegate);return new Jl(v,un,vt,Xt).recalculateAndSaveOverlaysForDocumentKeys(new mi(i,an._e),te).next()})})}}function pg(u){u.createObjectStore("targetDocuments",{keyPath:Et}).createIndex("documentTargetsIndex",en,{unique:!0}),u.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",st,{unique:!0}),u.createObjectStore("targetGlobal")}const Kd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Dm{constructor(e,i,h,v,T,D,X,te,_e,ze,vt=15){if(this.allowTabSynchronization=e,this.persistenceKey=i,this.clientId=h,this.oi=T,this.window=D,this.document=X,this._i=_e,this.ai=ze,this.ui=vt,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=Xt=>Promise.resolve(),!Dm.D())throw new Un(xn.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new cd(this,v),this.Ti=i+"main",this.serializer=new Uf(te),this.Ei=new mt(this.Ti,this.ui,new Fo(this.serializer)),this.Qr=new Am(this.referenceDelegate,this.serializer),this.remoteDocumentCache=hg(this.serializer),this.$r=new Mp,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===ze&&Gs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Un(xn.FAILED_PRECONDITION,Kd);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new an(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){var i=this;return this.Ii=function(){var h=(0,Ot.A)(function*(v){if(i.started)return e(v)});return function(v){return h.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B(function(){var i=(0,Ot.A)(function*(h){null===h.newVersion&&(yield e())});return function(h){return i.apply(this,arguments)}}())}setNetworkEnabled(e){var i=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget((0,Ot.A)(function*(){i.started&&(yield i.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Md(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(i=>{i||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(i=>this.isPrimary&&!i?this.yi(e).next(()=>!1):!!i&&this.wi(e).next(()=>!0))).catch(e=>{if(It(e))return zn("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return zn("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return Xu(e).get("owner").next(i=>he.resolve(this.Si(i)))}bi(e){return Md(e).delete(this.clientId)}Di(){var e=this;return(0,Ot.A)(function*(){if(e.isPrimary&&!e.Ci(e.Pi,18e5)){e.Pi=Date.now();const i=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",h=>{const v=Yr(h,"clientMetadata");return v.W().next(T=>{const D=e.vi(T,18e5),X=T.filter(te=>-1===D.indexOf(te));return he.forEach(X,te=>v.delete(te.clientId)).next(()=>X)})}).catch(()=>[]);if(e.di)for(const h of i)e.di.removeItem(e.Fi(h.clientId))}})()}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?he.resolve(!0):Xu(e).get("owner").next(i=>{if(null!==i&&this.Ci(i.leaseTimestampMs,5e3)&&!this.Mi(i.ownerId)){if(this.Si(i)&&this.networkEnabled)return!0;if(!this.Si(i)){if(!i.allowTabSynchronization)throw new Un(xn.FAILED_PRECONDITION,Kd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Md(e).W().next(h=>void 0===this.vi(h,5e3).find(v=>!(this.clientId===v.clientId||!(!this.networkEnabled&&v.networkEnabled||!this.inForeground&&v.inForeground&&this.networkEnabled===v.networkEnabled))))}).next(i=>(this.isPrimary!==i&&zn("IndexedDbPersistence",`Client ${i?"is":"is not"} eligible for a primary lease.`),i))}shutdown(){var e=this;return(0,Ot.A)(function*(){e.qr=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Oi(),e.Ni(),yield e.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],i=>{const h=new mi(i,an._e);return e.yi(h).next(()=>e.bi(h))}),e.Ei.close(),e.Li()})()}vi(e,i){return e.filter(h=>this.Ci(h.updateTimeMs,i)&&!this.Mi(h.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Md(e).W().next(i=>this.vi(i,18e5).map(h=>h.clientId)))}get started(){return this.qr}getMutationQueue(e,i){return Sm.lt(e,this.serializer,i,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Im(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return rg.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,i,h){zn("IndexedDbPersistence","Starting transaction:",e);const v="readonly"===i?"readonly":"readwrite",T=15===(te=this.ui)?Ms:14===te?Hs:13===te?Tr:12===te?Yt:11===te?ui:void pr();var te;let D;return this.Ei.runTransaction(e,v,T,X=>(D=new mi(X,this.kr?this.kr.next():an._e),"readwrite-primary"===i?this.gi(D).next(te=>!!te||this.pi(D)).next(te=>{if(!te)throw Gs(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new Un(xn.FAILED_PRECONDITION,Ye);return h(D)}).next(te=>this.wi(D).next(()=>te)):this.ki(D).next(()=>h(D)))).then(X=>(D.raiseOnCommittedEvent(),X))}ki(e){return Xu(e).get("owner").next(i=>{if(null!==i&&this.Ci(i.leaseTimestampMs,5e3)&&!this.Mi(i.ownerId)&&!this.Si(i)&&!(this.ai||this.allowTabSynchronization&&i.allowTabSynchronization))throw new Un(xn.FAILED_PRECONDITION,Kd)})}wi(e){const i={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Xu(e).put("owner",i)}static D(){return mt.D()}yi(e){const i=Xu(e);return i.get("owner").next(h=>this.Si(h)?(zn("IndexedDbPersistence","Releasing primary lease."),i.delete("owner")):he.resolve())}Ci(e,i){const h=Date.now();return!(e<h-i||e>h&&(Gs(`Detected an update time that is in the future: ${e} > ${h}`),1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const i=/(?:Version|Mobile)\/1[456]/;(0,ur.nr)()&&(navigator.appVersion.match(i)||navigator.userAgent.match(i))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var i;try{const h=null!==(null===(i=this.di)||void 0===i?void 0:i.getItem(this.Fi(e)));return zn("IndexedDbPersistence",`Client '${e}' ${h?"is":"is not"} zombied in LocalStorage`),h}catch(h){return Gs("IndexedDbPersistence","Failed to get zombied client id.",h),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){Gs("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Xu(u){return Yr(u,"owner")}function Md(u){return Yr(u,"clientMetadata")}function Mm(u,e){let i=u.projectId;return u.isDefaultDatabase||(i+="."+u.database),"firestore/"+e+"/"+i+"/"}class D_{constructor(e,i,h,v){this.targetId=e,this.fromCache=i,this.qi=h,this.Qi=v}static Ki(e,i){let h=Os(),v=Os();for(const T of i.docChanges)switch(T.type){case 0:h=h.add(T.doc.key);break;case 1:v=v.add(T.doc.key)}return new D_(e,i.fromCache,h,v)}}class $v{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Iy{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=(0,ur.nr)()?8:mt.v((0,ur.ZQ)())>0?6:4}initialize(e,i){this.zi=e,this.indexManager=i,this.$i=!0}getDocumentsMatchingQuery(e,i,h,v){const T={result:null};return this.ji(e,i).next(D=>{T.result=D}).next(()=>{if(!T.result)return this.Hi(e,i,v,h).next(D=>{T.result=D})}).next(()=>{if(T.result)return;const D=new $v;return this.Ji(e,i,D).next(X=>{if(T.result=X,this.Ui)return this.Yi(e,i,D,X.size)})}).next(()=>T.result)}Yi(e,i,h,v){return h.documentReadCount<this.Wi?(ta()<=jr.$b.DEBUG&&zn("QueryEngine","SDK will not create cache indexes for query:",lh(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),he.resolve()):(ta()<=jr.$b.DEBUG&&zn("QueryEngine","Query:",lh(i),"scans",h.documentReadCount,"local documents and returns",v,"documents as results."),h.documentReadCount>this.Gi*v?(ta()<=jr.$b.DEBUG&&zn("QueryEngine","The SDK decides to create cache indexes for query:",lh(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ma(i))):he.resolve())}ji(e,i){if(Zm(i))return he.resolve(null);let h=ma(i);return this.indexManager.getIndexType(e,h).next(v=>0===v?null:(null!==i.limit&&1===v&&(i=bd(i,null,"F"),h=ma(i)),this.indexManager.getDocumentsMatchingTarget(e,h).next(T=>{const D=Os(...T);return this.zi.getDocuments(e,D).next(X=>this.indexManager.getMinOffset(e,h).next(te=>{const _e=this.Zi(i,X);return this.Xi(i,_e,D,te.readTime)?this.ji(e,bd(i,null,"F")):this.es(e,_e,i,te)}))})))}Hi(e,i,h,v){return Zm(i)||v.isEqual(pi.min())?he.resolve(null):this.zi.getDocuments(e,h).next(T=>{const D=this.Zi(i,T);return this.Xi(i,D,h,v)?he.resolve(null):(ta()<=jr.$b.DEBUG&&zn("QueryEngine","Re-using previous result from %s to execute query: %s",v.toString(),lh(i)),this.es(e,D,i,Y(v,-1)).next(X=>X))})}Zi(e,i){let h=new Yi(zd(e));return i.forEach((v,T)=>{kc(e,T)&&(h=h.add(T))}),h}Xi(e,i,h,v){if(null===e.limit)return!1;if(h.size!==i.size)return!0;const T="F"===e.limitType?i.last():i.first();return!!T&&(T.hasPendingWrites||T.version.compareTo(v)>0)}Ji(e,i,h){return ta()<=jr.$b.DEBUG&&zn("QueryEngine","Using full collection scan to execute query:",lh(i)),this.zi.getDocumentsMatchingQuery(e,i,Pe.min(),h)}es(e,i,h,v){return this.zi.getDocumentsMatchingQuery(e,h,v).next(T=>(i.forEach(D=>{T=T.insert(D.key,D)}),T))}}class Gv{constructor(e,i,h,v){this.persistence=e,this.ts=i,this.serializer=v,this.ns=new Rr(Qi),this.rs=new il(T=>Ed(T),Ud),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(h)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Jl(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.ns))}}function M_(u,e,i,h){return new Gv(u,e,i,h)}function Hv(u,e){return Sy.apply(this,arguments)}function Sy(){return Sy=(0,Ot.A)(function*(u,e){const i=dr(u);return yield i.persistence.runTransaction("Handle user change","readonly",h=>{let v;return i.mutationQueue.getAllMutationBatches(h).next(T=>(v=T,i._s(e),i.mutationQueue.getAllMutationBatches(h))).next(T=>{const D=[],X=[];let te=Os();for(const _e of v){D.push(_e.batchId);for(const ze of _e.mutations)te=te.add(ze.key)}for(const _e of T){X.push(_e.batchId);for(const ze of _e.mutations)te=te.add(ze.key)}return i.localDocuments.getDocuments(h,te).next(_e=>({us:_e,removedBatchIds:D,addedBatchIds:X}))})})}),Sy.apply(this,arguments)}function Ay(u){const e=dr(u);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Qr.getLastRemoteSnapshotVersion(i))}function qf(u,e,i){let h=Os(),v=Os();return i.forEach(T=>h=h.add(T)),e.getEntries(u,h).next(T=>{let D=Hc();return i.forEach((X,te)=>{const _e=T.get(X);te.isFoundDocument()!==_e.isFoundDocument()&&(v=v.add(X)),te.isNoDocument()&&te.version.isEqual(pi.min())?(e.removeEntry(X,te.readTime),D=D.insert(X,te)):!_e.isValidDocument()||te.version.compareTo(_e.version)>0||0===te.version.compareTo(_e.version)&&_e.hasPendingWrites?(e.addEntry(te),D=D.insert(X,te)):zn("LocalStore","Ignoring outdated watch update for ",X,". Current version:",_e.version," Watch version:",te.version)}),{cs:D,ls:v}})}function R_(u,e){const i=dr(u);return i.persistence.runTransaction("Get next mutation batch","readonly",h=>(void 0===e&&(e=-1),i.mutationQueue.getNextMutationBatchAfterBatchId(h,e)))}function Eh(u,e){const i=dr(u);return i.persistence.runTransaction("Allocate target","readwrite",h=>{let v;return i.Qr.getTargetData(h,e).next(T=>T?(v=T,he.resolve(v)):i.Qr.allocateTargetId(h).next(D=>(v=new ad(e,D,"TargetPurposeListen",h.currentSequenceNumber),i.Qr.addTargetData(h,v).next(()=>v))))}).then(h=>{const v=i.ns.get(h.targetId);return(null===v||h.snapshotVersion.compareTo(v.snapshotVersion)>0)&&(i.ns=i.ns.insert(h.targetId,h),i.rs.set(e,h.targetId)),h})}function mf(u,e,i){return P_.apply(this,arguments)}function P_(){return P_=(0,Ot.A)(function*(u,e,i){const h=dr(u),v=h.ns.get(e),T=i?"readwrite":"readwrite-primary";try{i||(yield h.persistence.runTransaction("Release target",T,D=>h.persistence.referenceDelegate.removeTarget(D,v)))}catch(D){if(!It(D))throw D;zn("LocalStore",`Failed to update sequence numbers for target ${e}: ${D}`)}h.ns=h.ns.remove(e),h.rs.delete(v.target)}),P_.apply(this,arguments)}function gg(u,e,i){const h=dr(u);let v=pi.min(),T=Os();return h.persistence.runTransaction("Execute query","readwrite",D=>function(te,_e,ze){const vt=dr(te),Xt=vt.rs.get(ze);return void 0!==Xt?he.resolve(vt.ns.get(Xt)):vt.Qr.getTargetData(_e,ze)}(h,D,ma(e)).next(X=>{if(X)return v=X.lastLimboFreeSnapshotVersion,h.Qr.getMatchingKeysForTargetId(D,X.targetId).next(te=>{T=te})}).next(()=>h.ts.getDocumentsMatchingQuery(D,e,i?v:pi.min(),i?T:Os())).next(X=>(Up(h,kf(e),X),{documents:X,hs:T})))}function Cy(u,e){const i=dr(u),h=dr(i.Qr),v=i.ns.get(e);return v?Promise.resolve(v.target):i.persistence.runTransaction("Get target data","readonly",T=>h._t(T,e).next(D=>D?D.target:null))}function O_(u,e){const i=dr(u),h=i.ss.get(e)||pi.min();return i.persistence.runTransaction("Get new document changes","readonly",v=>i.os.getAllFromCollectionGroup(v,e,Y(h,-1),Number.MAX_SAFE_INTEGER)).then(v=>(Up(i,e,v),v))}function Up(u,e,i){let h=u.ss.get(e)||pi.min();i.forEach((v,T)=>{T.readTime.compareTo(h)>0&&(h=T.readTime)}),u.ss.set(e,h)}function _g(){return _g=(0,Ot.A)(function*(u,e,i,h){const v=dr(u);let T=Os(),D=Hc();for(const _e of i){const ze=e.Ps(_e.metadata.name);_e.document&&(T=T.add(ze));const vt=e.Is(_e);vt.setReadTime(e.Ts(_e.metadata.readTime)),D=D.insert(ze,vt)}const X=v.os.newChangeBuffer({trackRemovals:!0}),te=yield Eh(v,(ze=h,ma(ou(Z.fromString(`__bundle__/docs/${ze}`)))));var ze;return v.persistence.runTransaction("Apply bundle documents","readwrite",_e=>qf(_e,X,D).next(ze=>(X.apply(_e),ze)).next(ze=>v.Qr.removeMatchingKeysForTargetId(_e,te.targetId).next(()=>v.Qr.addMatchingKeys(_e,T,te.targetId)).next(()=>v.localDocuments.getLocalViewOfDocuments(_e,ze.cs,ze.ls)).next(()=>ze.cs)))}),_g.apply(this,arguments)}function yg(u,e){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,Ot.A)(function*(u,e,i=Os()){const h=yield Eh(u,ma(Em(e.bundledQuery))),v=dr(u);return v.persistence.runTransaction("Save named query","readwrite",T=>{const D=vl(e.readTime);if(h.snapshotVersion.compareTo(D)>=0)return v.$r.saveNamedQuery(T,e);const X=h.withResumeToken(oo.EMPTY_BYTE_STRING,D);return v.ns=v.ns.insert(X.targetId,X),v.Qr.updateTargetData(T,X).next(()=>v.Qr.removeMatchingKeysForTargetId(T,h.targetId)).next(()=>v.Qr.addMatchingKeys(T,i,h.targetId)).next(()=>v.$r.saveNamedQuery(T,e))})}),Nu.apply(this,arguments)}function Dy(u,e){return`firestore_clients_${u}_${e}`}function Pm(u,e,i){let h=`firestore_mutations_${u}_${i}`;return e.isAuthenticated()&&(h+=`_${e.uid}`),h}function Kf(u,e){return`firestore_targets_${u}_${e}`}class Om{constructor(e,i,h,v){this.user=e,this.batchId=i,this.state=h,this.error=v}static Es(e,i,h){const v=JSON.parse(h);let T,D="object"==typeof v&&-1!==["pending","acknowledged","rejected"].indexOf(v.state)&&(void 0===v.error||"object"==typeof v.error);return D&&v.error&&(D="string"==typeof v.error.message&&"string"==typeof v.error.code,D&&(T=new Un(v.error.code,v.error.message))),D?new Om(e,i,v.state,T):(Gs("SharedClientState",`Failed to parse mutation state for ID '${i}': ${h}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gf{constructor(e,i,h){this.targetId=e,this.state=i,this.error=h}static Es(e,i){const h=JSON.parse(i);let v,T="object"==typeof h&&-1!==["not-current","current","rejected"].indexOf(h.state)&&(void 0===h.error||"object"==typeof h.error);return T&&h.error&&(T="string"==typeof h.error.message&&"string"==typeof h.error.code,T&&(v=new Un(h.error.code,h.error.message))),T?new gf(e,h.state,v):(Gs("SharedClientState",`Failed to parse target state for ID '${e}': ${i}`),null)}ds(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Zf{constructor(e,i){this.clientId=e,this.activeTargetIds=i}static Es(e,i){const h=JSON.parse(i);let v="object"==typeof h&&h.activeTargetIds instanceof Array,T=jd();for(let D=0;v&&D<h.activeTargetIds.length;++D)v=Ln(h.activeTargetIds[D]),T=T.add(h.activeTargetIds[D]);return v?new Zf(e,T):(Gs("SharedClientState",`Failed to parse client data for instance '${e}': ${i}`),null)}}class Xf{constructor(e,i){this.clientId=e,this.onlineState=i}static Es(e){const i=JSON.parse(e);return"object"==typeof i&&-1!==["Unknown","Online","Offline"].indexOf(i.onlineState)&&"string"==typeof i.clientId?new Xf(i.clientId,i.onlineState):(Gs("SharedClientState",`Failed to parse online state: ${e}`),null)}}class zp{constructor(){this.activeTargetIds=jd()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vg{constructor(e,i,h,v,T){this.window=e,this.oi=i,this.persistenceKey=h,this.Vs=v,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new Rr(Qi),this.started=!1,this.ys=[];const D=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=T,this.ws=Dy(this.persistenceKey,this.Vs),this.Ss=`firestore_sequence_number_${this.persistenceKey}`,this.ps=this.ps.insert(this.Vs,new zp),this.bs=new RegExp(`^firestore_clients_${D}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${D}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${D}_(\\d+)$`),this.vs=`firestore_online_state_${this.persistenceKey}`,this.Fs=function(te){return`firestore_bundle_loaded_v2_${te}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,Ot.A)(function*(){const i=yield e.syncEngine.Bi();for(const v of i){if(v===e.Vs)continue;const T=e.getItem(Dy(e.persistenceKey,v));if(T){const D=Zf.Es(v,T);D&&(e.ps=e.ps.insert(D.clientId,D))}}e.Ms();const h=e.storage.getItem(e.vs);if(h){const v=e.xs(h);v&&e.Os(v)}for(const v of e.ys)e.gs(v);e.ys=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let i=!1;return this.ps.forEach((h,v)=>{v.activeTargetIds.has(e)&&(i=!0)}),i}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,i,h){this.Ls(e,i,h),this.Bs(e)}addLocalQueryTarget(e){let i="not-current";if(this.isActiveQueryTarget(e)){const h=this.storage.getItem(Kf(this.persistenceKey,e));if(h){const v=gf.Es(e,h);v&&(i=v.state)}}return this.ks.As(e),this.Ms(),i}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Kf(this.persistenceKey,e))}updateQueryState(e,i,h){this.qs(e,i,h)}handleUserChange(e,i,h){i.forEach(v=>{this.Bs(v)}),this.currentUser=e,h.forEach(v=>{this.addPendingMutation(v)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){const i=this.storage.getItem(e);return zn("SharedClientState","READ",e,i),i}setItem(e,i){zn("SharedClientState","SET",e,i),this.storage.setItem(e,i)}removeItem(e){zn("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){var i=this;const h=e;if(h.storageArea===this.storage){if(zn("SharedClientState","EVENT",h.key,h.newValue),h.key===this.ws)return void Gs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable((0,Ot.A)(function*(){if(i.started){if(null!==h.key)if(i.bs.test(h.key)){if(null==h.newValue){const v=i.$s(h.key);return i.Us(v,null)}{const v=i.Ws(h.key,h.newValue);if(v)return i.Us(v.clientId,v)}}else if(i.Ds.test(h.key)){if(null!==h.newValue){const v=i.Gs(h.key,h.newValue);if(v)return i.zs(v)}}else if(i.Cs.test(h.key)){if(null!==h.newValue){const v=i.js(h.key,h.newValue);if(v)return i.Hs(v)}}else if(h.key===i.vs){if(null!==h.newValue){const v=i.xs(h.newValue);if(v)return i.Os(v)}}else if(h.key===i.Ss){const v=function(D){let X=an._e;if(null!=D)try{const te=JSON.parse(D);zr("number"==typeof te),X=te}catch(te){Gs("SharedClientState","Failed to read sequence number from WebStorage",te)}return X}(h.newValue);v!==an._e&&i.sequenceNumberHandler(v)}else if(h.key===i.Fs){const v=i.Js(h.newValue);yield Promise.all(v.map(T=>i.syncEngine.Ys(T)))}}else i.ys.push(h)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,i,h){const v=new Om(this.currentUser,e,i,h),T=Pm(this.persistenceKey,this.currentUser,e);this.setItem(T,v.ds())}Bs(e){const i=Pm(this.persistenceKey,this.currentUser,e);this.removeItem(i)}Qs(e){this.storage.setItem(this.vs,JSON.stringify({clientId:this.Vs,onlineState:e}))}qs(e,i,h){const v=Kf(this.persistenceKey,e),T=new gf(e,i,h);this.setItem(v,T.ds())}Ks(e){const i=JSON.stringify(Array.from(e));this.setItem(this.Fs,i)}$s(e){const i=this.bs.exec(e);return i?i[1]:null}Ws(e,i){const h=this.$s(e);return Zf.Es(h,i)}Gs(e,i){const h=this.Ds.exec(e),v=Number(h[1]);return Om.Es(new Ss(void 0!==h[2]?h[2]:null),v,i)}js(e,i){const h=this.Cs.exec(e),v=Number(h[1]);return gf.Es(v,i)}xs(e){return Xf.Es(e)}Js(e){return JSON.parse(e)}zs(e){var i=this;return(0,Ot.A)(function*(){if(e.user.uid===i.currentUser.uid)return i.syncEngine.Zs(e.batchId,e.state,e.error);zn("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,i){const h=i?this.ps.insert(e,i):this.ps.remove(e),v=this.Ns(this.ps),T=this.Ns(h),D=[],X=[];return T.forEach(te=>{v.has(te)||D.push(te)}),v.forEach(te=>{T.has(te)||X.push(te)}),this.syncEngine.eo(D,X).then(()=>{this.ps=h})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let i=jd();return e.forEach((h,v)=>{i=i.unionWith(v.activeTargetIds)}),i}}class xg{constructor(){this.no=new zp,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,h){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,i,h){this.ro[e]=i}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new zp,Promise.resolve()}handleUserChange(e,i,h){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class k_{io(e){}shutdown(){}}class Eg{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){zn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){zn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let jp=null;function _f(){return null===jp?jp=268435456+Math.round(2147483648*Math.random()):jp++,"0x"+jp.toString(16)}const Lu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class cu{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Lc="WebChannelConnection";class Wv extends class{constructor(i){this.databaseInfo=i,this.databaseId=i.databaseId;const h=i.ssl?"https":"http",v=encodeURIComponent(this.databaseId.projectId),T=encodeURIComponent(this.databaseId.database);this.fo=h+"://"+i.host,this.po=`projects/${v}/databases/${T}`,this.yo="(default)"===this.databaseId.database?`project_id=${v}`:`project_id=${v}&database_id=${T}`}get wo(){return!1}So(i,h,v,T,D){const X=_f(),te=this.bo(i,h.toUriEncodedString());zn("RestConnection",`Sending RPC '${i}' ${X}:`,te,v);const _e={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(_e,T,D),this.Co(i,te,_e,v).then(ze=>(zn("RestConnection",`Received RPC '${i}' ${X}: `,ze),ze),ze=>{throw As("RestConnection",`RPC '${i}' ${X} failed with error: `,ze,"url: ",te,"request:",v),ze})}vo(i,h,v,T,D,X){return this.So(i,h,v,T,D)}Do(i,h,v){i["X-Goog-Api-Client"]="gl-js/ fire/"+Oi,i["Content-Type"]="text/plain",this.databaseInfo.appId&&(i["X-Firebase-GMPID"]=this.databaseInfo.appId),h&&h.headers.forEach((T,D)=>i[D]=T),v&&v.headers.forEach((T,D)=>i[D]=T)}bo(i,h){return`${this.fo}/v1/${h}:${Lu[i]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,i,h,v){const T=_f();return new Promise((D,X)=>{const te=new Ga;te.setWithCredentials(!0),te.listenOnce(Ol.COMPLETE,()=>{try{switch(te.getLastErrorCode()){case Kl.NO_ERROR:const ze=te.getResponseJson();zn(Lc,`XHR for RPC '${e}' ${T} received:`,JSON.stringify(ze)),D(ze);break;case Kl.TIMEOUT:zn(Lc,`RPC '${e}' ${T} timed out`),X(new Un(xn.DEADLINE_EXCEEDED,"Request time out"));break;case Kl.HTTP_ERROR:const vt=te.getStatus();if(zn(Lc,`RPC '${e}' ${T} failed with status:`,vt,"response text:",te.getResponseText()),vt>0){let Xt=te.getResponseJson();Array.isArray(Xt)&&(Xt=Xt[0]);const un=Xt?.error;if(un&&un.status&&un.message){const yr=function(xr){const hi=xr.toLowerCase().replace(/_/g,"-");return Object.values(xn).indexOf(hi)>=0?hi:xn.UNKNOWN}(un.status);X(new Un(yr,un.message))}else X(new Un(xn.UNKNOWN,"Server responded with status "+te.getStatus()))}else X(new Un(xn.UNAVAILABLE,"Connection failed."));break;default:pr()}}finally{zn(Lc,`RPC '${e}' ${T} completed.`)}});const _e=JSON.stringify(v);zn(Lc,`RPC '${e}' ${T} sending request:`,v),te.send(i,"POST",_e,h,15)})}Fo(e,i,h){const v=_f(),T=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],D=Si(),X=dl(),te={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},_e=this.longPollingOptions.timeoutSeconds;void 0!==_e&&(te.longPollingTimeout=Math.round(1e3*_e)),this.useFetchStreams&&(te.useFetchStreams=!0),this.Do(te.initMessageHeaders,i,h),te.encodeInitMessageHeaders=!0;const ze=T.join("");zn(Lc,`Creating RPC '${e}' stream ${v}: ${ze}`,te);const vt=D.createWebChannel(ze,te);let Xt=!1,un=!1;const yr=new cu({lo:xr=>{un?zn(Lc,`Not sending because RPC '${e}' stream ${v} is closed:`,xr):(Xt||(zn(Lc,`Opening RPC '${e}' stream ${v} transport.`),vt.open(),Xt=!0),zn(Lc,`RPC '${e}' stream ${v} sending:`,xr),vt.send(xr))},ho:()=>vt.close()}),Ir=(xr,hi,Xi)=>{xr.listen(hi,ni=>{try{Xi(ni)}catch(Ji){setTimeout(()=>{throw Ji},0)}})};return Ir(vt,jo.EventType.OPEN,()=>{un||zn(Lc,`RPC '${e}' stream ${v} transport opened.`)}),Ir(vt,jo.EventType.CLOSE,()=>{un||(un=!0,zn(Lc,`RPC '${e}' stream ${v} transport closed`),yr.Vo())}),Ir(vt,jo.EventType.ERROR,xr=>{un||(un=!0,As(Lc,`RPC '${e}' stream ${v} transport errored:`,xr),yr.Vo(new Un(xn.UNAVAILABLE,"The operation could not be completed")))}),Ir(vt,jo.EventType.MESSAGE,xr=>{var hi;if(!un){const Xi=xr.data[0];zr(!!Xi);const Ji=Xi.error||(null===(hi=Xi[0])||void 0===hi?void 0:hi.error);if(Ji){zn(Lc,`RPC '${e}' stream ${v} received error:`,Ji);const Js=Ji.status;let Ho=function(dv){const dm=Tn[dv];if(void 0!==dm)return ai(dm)}(Js),ec=Ji.message;void 0===Ho&&(Ho=xn.INTERNAL,ec="Unknown error status: "+Js+" with message "+Ji.message),un=!0,yr.Vo(new Un(Ho,ec)),vt.close()}else zn(Lc,`RPC '${e}' stream ${v} received:`,Xi),yr.mo(Xi)}}),Ir(X,Xs.STAT_EVENT,xr=>{xr.stat===Rc.PROXY?zn(Lc,`RPC '${e}' stream ${v} detected buffering proxy`):xr.stat===Rc.NOPROXY&&zn(Lc,`RPC '${e}' stream ${v} detected no buffering proxy`)}),setTimeout(()=>{yr.Ro()},0),yr}}function N_(){return typeof window<"u"?window:null}function wg(){return typeof document<"u"?document:null}function bg(u){return new hy(u,!0)}class Tg{constructor(e,i,h=1e3,v=1.5,T=6e4){this.oi=e,this.timerId=i,this.Mo=h,this.xo=v,this.Oo=T,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const i=Math.floor(this.No+this.Qo()),h=Math.max(0,Date.now()-this.Bo),v=Math.max(0,i-h);v>0&&zn("ExponentialBackoff",`Backing off for ${v} ms (base delay: ${this.No} ms, delay with jitter: ${i} ms, last attempt: ${h} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,v,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Ig{constructor(e,i,h,v,T,D,X,te){this.oi=e,this.$o=h,this.Uo=v,this.connection=T,this.authCredentialsProvider=D,this.appCheckCredentialsProvider=X,this.listener=te,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Tg(e,i)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}stop(){var e=this;return(0,Ot.A)(function*(){e.Ho()&&(yield e.close(0))})()}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){var e=this;return(0,Ot.A)(function*(){if(e.Jo())return e.close(0)})()}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,i){var h=this;return(0,Ot.A)(function*(){h.n_(),h.r_(),h.jo.cancel(),h.Wo++,4!==e?h.jo.reset():i&&i.code===xn.RESOURCE_EXHAUSTED?(Gs(i.toString()),Gs("Using maximum backoff delay to prevent overloading the backend."),h.jo.ko()):i&&i.code===xn.UNAUTHENTICATED&&3!==h.state&&(h.authCredentialsProvider.invalidateToken(),h.appCheckCredentialsProvider.invalidateToken()),null!==h.stream&&(h.i_(),h.stream.close(),h.stream=null),h.state=e,yield h.listener.To(i)})()}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),i=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([h,v])=>{this.Wo===i&&this.o_(h,v)},h=>{e(()=>{const v=new Un(xn.UNKNOWN,"Fetching auth token failed: "+h.message);return this.__(v)})})}o_(e,i){const h=this.s_(this.Wo);this.stream=this.a_(e,i),this.stream.Po(()=>{h(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(v=>{h(()=>this.__(v))}),this.stream.onMessage(v=>{h(()=>this.onMessage(v))})}Yo(){var e=this;this.state=5,this.jo.qo((0,Ot.A)(function*(){e.state=0,e.start()}))}__(e){return zn("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return i=>{this.oi.enqueueAndForget(()=>this.Wo===e?i():(zn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class qv extends Ig{constructor(e,i,h,v,T,D){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,h,v,D),this.serializer=T}a_(e,i){return this.connection.Fo("Listen",e,i)}onMessage(e){this.jo.reset();const i=function my(u,e){let i;if("targetChange"in e){const h="NO_CHANGE"===(_e=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===_e?1:"REMOVE"===_e?2:"CURRENT"===_e?3:"RESET"===_e?4:pr(),v=e.targetChange.targetIds||[],T=function(_e,ze){return _e.useProto3Json?(zr(void 0===ze||"string"==typeof ze),oo.fromBase64String(ze||"")):(zr(void 0===ze||ze instanceof Uint8Array),oo.fromUint8Array(ze||new Uint8Array))}(u,e.targetChange.resumeToken),D=e.targetChange.cause,X=D&&function(_e){const ze=void 0===_e.code?xn.UNKNOWN:ai(_e.code);return new Un(ze,_e.message||"")}(D);i=new tf(h,v,T,X||null)}else if("documentChange"in e){const h=e.documentChange,v=$d(u,h.document.name),T=vl(h.document.updateTime),D=h.document.createTime?vl(h.document.createTime):pi.min(),X=new $o({mapValue:{fields:h.document.fields}}),te=Eo.newFoundDocument(v,T,D,X);i=new ef(h.targetIds||[],h.removedTargetIds||[],te.key,te)}else if("documentDelete"in e){const h=e.documentDelete,v=$d(u,h.document),T=h.readTime?vl(h.readTime):pi.min(),D=Eo.newNoDocument(v,T);i=new ef([],h.removedTargetIds||[],D.key,D)}else if("documentRemove"in e){const h=e.documentRemove,v=$d(u,h.document);i=new ef([],h.removedTargetIds||[],v,null)}else{if(!("filter"in e))return pr();{const h=e.filter,{count:v=0,unchangedNames:T}=h,D=new fn(v,T);i=new Td(h.targetId,D)}}var _e;return i}(this.serializer,e),h=function(T){if(!("targetChange"in T))return pi.min();const D=T.targetChange;return D.targetIds&&D.targetIds.length?pi.min():D.readTime?vl(D.readTime):pi.min()}(e);return this.listener.u_(i,h)}c_(e){const i={};i.database=_m(this.serializer),i.addTarget=function(T,D){let X;const te=D.target;if(X=Hh(te)?{documents:Lv(T,te)}:{query:gy(T,te).ut},X.targetId=D.targetId,D.resumeToken.approximateByteSize()>0){X.resumeToken=__(T,D.resumeToken);const _e=Ym(T,D.expectedCount);null!==_e&&(X.expectedCount=_e)}else if(D.snapshotVersion.compareTo(pi.min())>0){X.readTime=nf(T,D.snapshotVersion.toTimestamp());const _e=Ym(T,D.expectedCount);null!==_e&&(X.expectedCount=_e)}return X}(this.serializer,e);const h=function v_(u,e){const i=function(v){switch(v){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return pr()}}(e.purpose);return null==i?null:{"goog-listen-tags":i}}(0,e);h&&(i.labels=h),this.t_(i)}l_(e){const i={};i.database=_m(this.serializer),i.removeTarget=e,this.t_(i)}}class yf extends Ig{constructor(e,i,h,v,T,D){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,h,v,D),this.serializer=T,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,i){return this.connection.Fo("Write",e,i)}onMessage(e){if(zr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const i=function y_(u,e){return u&&u.length>0?(zr(void 0!==e),u.map(i=>function(v,T){let D=vl(v.updateTime?v.updateTime:T);return D.isEqual(pi.min())&&(D=vl(T)),new Ws(D,v.transformResults||[])}(i,e))):[]}(e.writeResults,e.commitTime),h=vl(e.commitTime);return this.listener.T_(h,i)}return zr(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=_m(this.serializer),this.t_(e)}I_(e){const i={streamToken:this.lastStreamToken,writes:e.map(h=>vm(this.serializer,h))};this.t_(i)}}class Sg extends class{}{constructor(e,i,h,v){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=h,this.serializer=v,this.A_=!1}R_(){if(this.A_)throw new Un(xn.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,h,v){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([T,D])=>this.connection.So(e,Kc(i,h),v,T,D)).catch(T=>{throw"FirebaseError"===T.name?(T.code===xn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),T):new Un(xn.UNKNOWN,T.toString())})}vo(e,i,h,v,T){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([D,X])=>this.connection.vo(e,Kc(i,h),v,D,X,T)).catch(D=>{throw"FirebaseError"===D.name?(D.code===xn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),D):new Un(xn.UNKNOWN,D.toString())})}terminate(){this.A_=!0,this.connection.terminate()}}class vf{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const i=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Gs(i),this.g_=!1):zn("OnlineStateTracker",i)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class xf{constructor(e,i,h,v,T){var D=this;this.localStore=e,this.datastore=i,this.asyncQueue=h,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=T,this.M_.io(X=>{h.enqueueAndForget((0,Ot.A)(function*(){var te;dd(D)&&(zn("RemoteStore","Restarting streams for network reachability change."),yield(te=(0,Ot.A)(function*(ze){const vt=dr(ze);vt.v_.add(4),yield ud(vt),vt.x_.set("Unknown"),vt.v_.delete(4),yield Rd(vt)}),function _e(ze){return te.apply(this,arguments)})(D))}))}),this.x_=new vf(h,v)}}function Rd(u){return $p.apply(this,arguments)}function $p(){return $p=(0,Ot.A)(function*(u){if(dd(u))for(const e of u.F_)yield e(!0)}),$p.apply(this,arguments)}function ud(u){return Cg.apply(this,arguments)}function Cg(){return Cg=(0,Ot.A)(function*(u){for(const e of u.F_)yield e(!1)}),Cg.apply(this,arguments)}function Qf(u,e){const i=dr(u);i.C_.has(e.targetId)||(i.C_.set(e.targetId,e),Dg(i)?F_(i):Ah(i).Jo()&&L_(i,e))}function Zd(u,e){const i=dr(u),h=Ah(i);i.C_.delete(e),h.Jo()&&My(i,e),0===i.C_.size&&(h.Jo()?h.Xo():dd(i)&&i.x_.set("Unknown"))}function L_(u,e){if(u.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(pi.min())>0){const i=u.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}Ah(u).c_(e)}function My(u,e){u.O_.Oe(e),Ah(u).l_(e)}function F_(u){u.O_=new Ap({getRemoteKeysForTarget:e=>u.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>u.C_.get(e)||null,nt:()=>u.datastore.serializer.databaseId}),Ah(u).start(),u.x_.p_()}function Dg(u){return dd(u)&&!Ah(u).Ho()&&u.C_.size>0}function dd(u){return 0===dr(u).v_.size}function Xd(u){u.O_=void 0}function Ef(u){return km.apply(this,arguments)}function km(){return km=(0,Ot.A)(function*(u){u.C_.forEach((e,i)=>{L_(u,e)})}),km.apply(this,arguments)}function Kv(u,e){return Gp.apply(this,arguments)}function Gp(){return Gp=(0,Ot.A)(function*(u,e){Xd(u),Dg(u)?(u.x_.S_(e),F_(u)):u.x_.set("Unknown")}),Gp.apply(this,arguments)}function Ry(u,e,i){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,Ot.A)(function*(u,e,i){if(u.x_.set("Online"),e instanceof tf&&2===e.state&&e.cause)try{yield(h=(0,Ot.A)(function*(T,D){const X=D.cause;for(const te of D.targetIds)T.C_.has(te)&&(yield T.remoteSyncer.rejectListen(te,X),T.C_.delete(te),T.O_.removeTarget(te))}),function v(T,D){return h.apply(this,arguments)})(u,e)}catch(h){zn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),h),yield Nm(u,h)}else if(e instanceof ef?u.O_.$e(e):e instanceof Td?u.O_.Je(e):u.O_.Ge(e),!i.isEqual(pi.min()))try{const h=yield Ay(u.localStore);i.compareTo(h)>=0&&(yield function(T,D){const X=T.O_.it(D);return X.targetChanges.forEach((te,_e)=>{if(te.resumeToken.approximateByteSize()>0){const ze=T.C_.get(_e);ze&&T.C_.set(_e,ze.withResumeToken(te.resumeToken,D))}}),X.targetMismatches.forEach((te,_e)=>{const ze=T.C_.get(te);if(!ze)return;T.C_.set(te,ze.withResumeToken(oo.EMPTY_BYTE_STRING,ze.snapshotVersion)),My(T,te);const vt=new ad(ze.target,te,_e,ze.sequenceNumber);L_(T,vt)}),T.remoteSyncer.applyRemoteEvent(X)}(u,i))}catch(h){zn("RemoteStore","Failed to raise snapshot:",h),yield Nm(u,h)}var h}),Pd.apply(this,arguments)}function Nm(u,e,i){return wf.apply(this,arguments)}function wf(){return wf=(0,Ot.A)(function*(u,e,i){if(!It(e))throw e;u.v_.add(1),yield ud(u),u.x_.set("Offline"),i||(i=()=>Ay(u.localStore)),u.asyncQueue.enqueueRetryable((0,Ot.A)(function*(){zn("RemoteStore","Retrying IndexedDB access"),yield i(),u.v_.delete(1),yield Rd(u)}))}),wf.apply(this,arguments)}function wh(u,e){return e().catch(i=>Nm(u,i,e))}function Hp(u){return Yf.apply(this,arguments)}function Yf(){return Yf=(0,Ot.A)(function*(u){const e=dr(u),i=Tf(e);let h=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;Mg(e);)try{const v=yield R_(e.localStore,h);if(null===v){0===e.D_.length&&i.Xo();break}h=v.batchId,Rg(e,v)}catch(v){yield Nm(e,v)}B_(e)&&Pg(e)}),Yf.apply(this,arguments)}function Mg(u){return dd(u)&&u.D_.length<10}function Rg(u,e){u.D_.push(e);const i=Tf(u);i.Jo()&&i.P_&&i.I_(e.mutations)}function B_(u){return dd(u)&&!Tf(u).Ho()&&u.D_.length>0}function Pg(u){Tf(u).start()}function bh(u){return Og.apply(this,arguments)}function Og(){return Og=(0,Ot.A)(function*(u){Tf(u).d_()}),Og.apply(this,arguments)}function Od(u){return Jf.apply(this,arguments)}function Jf(){return Jf=(0,Ot.A)(function*(u){const e=Tf(u);for(const i of u.D_)e.I_(i.mutations)}),Jf.apply(this,arguments)}function Wp(u,e,i){return Th.apply(this,arguments)}function Th(){return Th=(0,Ot.A)(function*(u,e,i){const h=u.D_.shift(),v=fe.from(h,e,i);yield wh(u,()=>u.remoteSyncer.applySuccessfulWrite(v)),yield Hp(u)}),Th.apply(this,arguments)}function Ih(u,e){return bf.apply(this,arguments)}function bf(){return bf=(0,Ot.A)(function*(u,e){var i;e&&Tf(u).P_&&(yield(i=(0,Ot.A)(function*(v,T){if(oi(X=T.code)&&X!==xn.ABORTED){const D=v.D_.shift();Tf(v).Zo(),yield wh(v,()=>v.remoteSyncer.rejectFailedWrite(D.batchId,T)),yield Hp(v)}var X}),function h(v,T){return i.apply(this,arguments)})(u,e)),B_(u)&&Pg(u)}),bf.apply(this,arguments)}function ep(u,e){return qp.apply(this,arguments)}function qp(){return qp=(0,Ot.A)(function*(u,e){const i=dr(u);i.asyncQueue.verifyOperationInProgress(),zn("RemoteStore","RemoteStore received new credentials");const h=dd(i);i.v_.add(3),yield ud(i),h&&i.x_.set("Unknown"),yield i.remoteSyncer.handleCredentialChange(e),i.v_.delete(3),yield Rd(i)}),qp.apply(this,arguments)}function V_(u,e){return Sh.apply(this,arguments)}function Sh(){return Sh=(0,Ot.A)(function*(u,e){const i=dr(u);e?(i.v_.delete(2),yield Rd(i)):e||(i.v_.add(2),yield ud(i),i.x_.set("Unknown"))}),Sh.apply(this,arguments)}function Ah(u){return u.N_||(u.N_=function(i,h,v){const T=dr(i);return T.R_(),new qv(h,T.connection,T.authCredentials,T.appCheckCredentials,T.serializer,v)}(u.datastore,u.asyncQueue,{Po:Ef.bind(null,u),To:Kv.bind(null,u),u_:Ry.bind(null,u)}),u.F_.push(function(){var e=(0,Ot.A)(function*(i){i?(u.N_.Zo(),Dg(u)?F_(u):u.x_.set("Unknown")):(yield u.N_.stop(),Xd(u))});return function(i){return e.apply(this,arguments)}}())),u.N_}function Tf(u){return u.L_||(u.L_=function(i,h,v){const T=dr(i);return T.R_(),new yf(h,T.connection,T.authCredentials,T.appCheckCredentials,T.serializer,v)}(u.datastore,u.asyncQueue,{Po:bh.bind(null,u),To:Ih.bind(null,u),E_:Od.bind(null,u),T_:Wp.bind(null,u)}),u.F_.push(function(){var e=(0,Ot.A)(function*(i){i?(u.L_.Zo(),yield Hp(u)):(yield u.L_.stop(),u.D_.length>0&&(zn("RemoteStore",`Stopping write stream with ${u.D_.length} pending writes`),u.D_=[]))});return function(i){return e.apply(this,arguments)}}())),u.L_}class kg{constructor(e,i,h,v,T){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=h,this.op=v,this.removalCallback=T,this.deferred=new Ao,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(D=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,h,v,T){const D=Date.now()+h,X=new kg(e,i,D,v,T);return X.start(h),X}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Un(xn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function If(u,e){if(Gs("AsyncQueue",`${e}: ${u}`),It(u))return new Un(xn.UNAVAILABLE,`${e}: ${u}`);throw u}class tp{constructor(e){this.comparator=e?(i,h)=>e(i,h)||a.comparator(i.key,h.key):(i,h)=>a.comparator(i.key,h.key),this.keyedMap=Zh(),this.sortedSet=new Rr(this.comparator)}static emptySet(e){return new tp(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,h)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof tp)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),h=e.sortedSet.getIterator();for(;i.hasNext();){const v=i.getNext().key,T=h.getNext().key;if(!v.isEqual(T))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,i){const h=new tp;return h.comparator=this.comparator,h.keyedMap=e,h.sortedSet=i,h}}class Cs{constructor(){this.B_=new Rr(a.comparator)}track(e){const i=e.doc.key,h=this.B_.get(i);h?0!==e.type&&3===h.type?this.B_=this.B_.insert(i,e):3===e.type&&1!==h.type?this.B_=this.B_.insert(i,{type:h.type,doc:e.doc}):2===e.type&&2===h.type?this.B_=this.B_.insert(i,{type:2,doc:e.doc}):2===e.type&&0===h.type?this.B_=this.B_.insert(i,{type:0,doc:e.doc}):1===e.type&&0===h.type?this.B_=this.B_.remove(i):1===e.type&&2===h.type?this.B_=this.B_.insert(i,{type:1,doc:h.doc}):0===e.type&&1===h.type?this.B_=this.B_.insert(i,{type:2,doc:e.doc}):pr():this.B_=this.B_.insert(i,e)}k_(){const e=[];return this.B_.inorderTraversal((i,h)=>{e.push(h)}),e}}class np{constructor(e,i,h,v,T,D,X,te,_e){this.query=e,this.docs=i,this.oldDocs=h,this.docChanges=v,this.mutatedKeys=T,this.fromCache=D,this.syncStateChanged=X,this.excludesMetadataChanges=te,this.hasCachedResults=_e}static fromInitialDocuments(e,i,h,v,T){const D=[];return i.forEach(X=>{D.push({type:0,doc:X})}),new np(e,i,tp.emptySet(i),D,h,v,!0,!1,T)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&gl(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,h=e.docChanges;if(i.length!==h.length)return!1;for(let v=0;v<i.length;v++)if(i[v].type!==h[v].type||!i[v].doc.isEqual(h[v].doc))return!1;return!0}}class U_{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}}class Kp{constructor(){this.queries=new il(e=>Wh(e),gl),this.onlineState="Unknown",this.W_=new Set}}function Lm(u,e){return Ng.apply(this,arguments)}function Ng(){return Ng=(0,Ot.A)(function*(u,e){const i=dr(u);let h=3;const v=e.query;let T=i.queries.get(v);T?!T.K_()&&e.U_()&&(h=2):(T=new U_,h=e.U_()?0:1);try{switch(h){case 0:T.q_=yield i.onListen(v,!0);break;case 1:T.q_=yield i.onListen(v,!1);break;case 2:yield i.onFirstRemoteStoreListen(v)}}catch(D){const X=If(D,`Initialization of query '${lh(e.query)}' failed`);return void e.onError(X)}i.queries.set(v,T),T.Q_.push(e),e.G_(i.onlineState),T.q_&&e.z_(T.q_)&&rp(i)}),Ng.apply(this,arguments)}function z_(u,e){return Ch.apply(this,arguments)}function Ch(){return Ch=(0,Ot.A)(function*(u,e){const i=dr(u),h=e.query;let v=3;const T=i.queries.get(h);if(T){const D=T.Q_.indexOf(e);D>=0&&(T.Q_.splice(D,1),0===T.Q_.length?v=e.U_()?0:1:!T.K_()&&e.U_()&&(v=2))}switch(v){case 0:return i.queries.delete(h),i.onUnlisten(h,!0);case 1:return i.queries.delete(h),i.onUnlisten(h,!1);case 2:return i.onLastRemoteStoreUnlisten(h);default:return}}),Ch.apply(this,arguments)}function Dh(u,e){const i=dr(u);let h=!1;for(const v of e){const D=i.queries.get(v.query);if(D){for(const X of D.Q_)X.z_(v)&&(h=!0);D.q_=v}}h&&rp(i)}function Zp(u,e,i){const h=dr(u),v=h.queries.get(e);if(v)for(const T of v.Q_)T.onError(i);h.queries.delete(e)}function rp(u){u.W_.forEach(e=>{e.next()})}var Xp,Qp;(Qp=Xp||(Xp={})).j_="default",Qp.Cache="cache";class hd{constructor(e,i,h){this.query=e,this.H_=i,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=h||{}}z_(e){if(!this.options.includeMetadataChanges){const h=[];for(const v of e.docChanges)3!==v.type&&h.push(v);e=new np(e.query,e.docs,e.oldDocs,h,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),i=!0):this.X_(e,this.onlineState)&&(this.ea(e),i=!0),this.Y_=e,i}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let i=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),i=!0),i}X_(e,i){return!e.fromCache||!this.U_()||(!this.options.ta||!("Offline"!==i))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===i)}Z_(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}ea(e){e=np.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==Xp.Cache}}class j_{constructor(e,i){this.na=e,this.byteLength=i}ra(){return"metadata"in this.na}}class Fm{constructor(e){this.serializer=e}Ps(e){return $d(this.serializer,e)}Is(e){return e.metadata.exists?sf(this.serializer,e.document,!1):Eo.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return vl(e)}}class Lg{constructor(e,i,h){this.ia=e,this.localStore=i,this.serializer=h,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Bm(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let i=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++i;const h=Z.fromString(e.na.documentMetadata.name);this.collectionGroups.add(h.get(h.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++i);return i!==this.progress.documentsLoaded?(this.progress.documentsLoaded=i,Object.assign({},this.progress)):null}oa(e){const i=new Map,h=new Fm(this.serializer);for(const v of e)if(v.metadata.queries){const T=h.Ps(v.metadata.name);for(const D of v.metadata.queries){const X=(i.get(D)||Os()).add(T);i.set(D,X)}}return i}complete(){var e=this;return(0,Ot.A)(function*(){const i=yield function ku(u,e,i,h){return _g.apply(this,arguments)}(e.localStore,new Fm(e.serializer),e.documents,e.ia.id),h=e.oa(e.documents);for(const v of e.queries)yield yg(e.localStore,v,h.get(v.name));return e.progress.taskState="Success",{progress:e.progress,_a:e.collectionGroups,aa:i}})()}}function Bm(u){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:u.totalDocuments,totalBytes:u.totalBytes}}class Py{constructor(e){this.key=e}}class Oy{constructor(e){this.key=e}}class $_{constructor(e,i){this.query=e,this.ua=i,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=Os(),this.mutatedKeys=Os(),this.ha=zd(e),this.Pa=new tp(this.ha)}get Ia(){return this.ua}Ta(e,i){const h=i?i.Ea:new Cs,v=i?i.Pa:this.Pa;let T=i?i.mutatedKeys:this.mutatedKeys,D=v,X=!1;const te="F"===this.query.limitType&&v.size===this.query.limit?v.last():null,_e="L"===this.query.limitType&&v.size===this.query.limit?v.first():null;if(e.inorderTraversal((ze,vt)=>{const Xt=v.get(ze),un=kc(this.query,vt)?vt:null,yr=!!Xt&&this.mutatedKeys.has(Xt.key),Ir=!!un&&(un.hasLocalMutations||this.mutatedKeys.has(un.key)&&un.hasCommittedMutations);let xr=!1;Xt&&un?Xt.data.isEqual(un.data)?yr!==Ir&&(h.track({type:3,doc:un}),xr=!0):this.da(Xt,un)||(h.track({type:2,doc:un}),xr=!0,(te&&this.ha(un,te)>0||_e&&this.ha(un,_e)<0)&&(X=!0)):!Xt&&un?(h.track({type:0,doc:un}),xr=!0):Xt&&!un&&(h.track({type:1,doc:Xt}),xr=!0,(te||_e)&&(X=!0)),xr&&(un?(D=D.add(un),T=Ir?T.add(ze):T.delete(ze)):(D=D.delete(ze),T=T.delete(ze)))}),null!==this.query.limit)for(;D.size>this.query.limit;){const ze="F"===this.query.limitType?D.last():D.first();D=D.delete(ze.key),T=T.delete(ze.key),h.track({type:1,doc:ze})}return{Pa:D,Ea:h,Xi:X,mutatedKeys:T}}da(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,h,v){const T=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;const D=e.Ea.k_();D.sort((ze,vt)=>function(un,yr){const Ir=xr=>{switch(xr){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return pr()}};return Ir(un)-Ir(yr)}(ze.type,vt.type)||this.ha(ze.doc,vt.doc)),this.Aa(h),v=null!=v&&v;const X=i&&!v?this.Ra():[],te=0===this.la.size&&this.current&&!v?1:0,_e=te!==this.ca;return this.ca=te,0!==D.length||_e?{snapshot:new np(this.query,e.Pa,T,D,e.mutatedKeys,0===te,_e,!1,!!h&&h.resumeToken.approximateByteSize()>0),Va:X}:{Va:X}}G_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Cs,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(i=>this.ua=this.ua.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.ua=this.ua.delete(i)),this.current=e.current)}Ra(){if(!this.current)return[];const e=this.la;this.la=Os(),this.Pa.forEach(h=>{this.ma(h.key)&&(this.la=this.la.add(h.key))});const i=[];return e.forEach(h=>{this.la.has(h)||i.push(new Oy(h))}),this.la.forEach(h=>{e.has(h)||i.push(new Py(h))}),i}fa(e){this.ua=e.hs,this.la=Os();const i=this.Ta(e.documents);return this.applyChanges(i,!0)}ga(){return np.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class Zv{constructor(e,i,h){this.query=e,this.targetId=i,this.view=h}}class G_{constructor(e){this.key=e,this.pa=!1}}class Xv{constructor(e,i,h,v,T,D){this.localStore=e,this.remoteStore=i,this.eventManager=h,this.sharedClientState=v,this.currentUser=T,this.maxConcurrentLimboResolutions=D,this.ya={},this.wa=new il(X=>Wh(X),gl),this.Sa=new Map,this.ba=new Set,this.Da=new Rr(a.comparator),this.Ca=new Map,this.va=new Fp,this.Fa={},this.Ma=new Map,this.xa=ld.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}function Vm(u,e){return Fg.apply(this,arguments)}function Fg(){return Fg=(0,Ot.A)(function*(u,e,i=!0){const h=nm(u);let v;const T=h.wa.get(e);return T?(h.sharedClientState.addLocalQueryTarget(T.targetId),v=T.view.ga()):v=yield Ny(h,e,i,!0),v}),Fg.apply(this,arguments)}function ky(u,e){return Bg.apply(this,arguments)}function Bg(){return Bg=(0,Ot.A)(function*(u,e){const i=nm(u);yield Ny(i,e,!0,!1)}),Bg.apply(this,arguments)}function Ny(u,e,i,h){return Xc.apply(this,arguments)}function Xc(){return Xc=(0,Ot.A)(function*(u,e,i,h){const v=yield Eh(u.localStore,ma(e)),T=v.targetId,D=i?u.sharedClientState.addLocalQueryTarget(T):"not-current";let X;return h&&(X=yield Fu(u,e,T,"current"===D,v.resumeToken)),u.isPrimaryClient&&i&&Qf(u.remoteStore,v),X}),Xc.apply(this,arguments)}function Fu(u,e,i,h,v){return fd.apply(this,arguments)}function fd(){return fd=(0,Ot.A)(function*(u,e,i,h,v){u.Na=(vt,Xt,un)=>{return(yr=(0,Ot.A)(function*(xr,hi,Xi,ni){let Ji=hi.view.Ta(Xi);Ji.Xi&&(Ji=yield gg(xr.localStore,hi.query,!1).then(({documents:Fd})=>hi.view.Ta(Fd,Ji)));const Js=ni&&ni.targetChanges.get(hi.targetId),Ho=ni&&null!=ni.targetMismatches.get(hi.targetId),ec=hi.view.applyChanges(Ji,xr.isPrimaryClient,Js,Ho);return em(xr,hi.targetId,ec.Va),ec.snapshot}),function Ir(xr,hi,Xi,ni){return yr.apply(this,arguments)})(u,vt,Xt,un);var yr};const T=yield gg(u.localStore,e,!0),D=new $_(e,T.hs),X=D.Ta(T.documents),te=ph.createSynthesizedTargetChangeForCurrentChange(i,h&&"Offline"!==u.onlineState,v),_e=D.applyChanges(X,u.isPrimaryClient,te);em(u,i,_e.Va);const ze=new Zv(e,i,D);return u.wa.set(e,ze),u.Sa.has(i)?u.Sa.get(i).push(e):u.Sa.set(i,[e]),_e.snapshot}),fd.apply(this,arguments)}function ip(u,e,i){return Bu.apply(this,arguments)}function Bu(){return Bu=(0,Ot.A)(function*(u,e,i){const h=dr(u),v=h.wa.get(e),T=h.Sa.get(v.targetId);if(T.length>1)return h.Sa.set(v.targetId,T.filter(D=>!gl(D,e))),void h.wa.delete(e);h.isPrimaryClient?(h.sharedClientState.removeLocalQueryTarget(v.targetId),h.sharedClientState.isActiveQueryTarget(v.targetId)||(yield mf(h.localStore,v.targetId,!1).then(()=>{h.sharedClientState.clearQueryState(v.targetId),i&&Zd(h.remoteStore,v.targetId),sp(h,v.targetId)}).catch(ot))):(sp(h,v.targetId),yield mf(h.localStore,v.targetId,!0))}),Bu.apply(this,arguments)}function Mh(u,e){return Yp.apply(this,arguments)}function Yp(){return Yp=(0,Ot.A)(function*(u,e){const i=dr(u),h=i.wa.get(e),v=i.Sa.get(h.targetId);i.isPrimaryClient&&1===v.length&&(i.sharedClientState.removeLocalQueryTarget(h.targetId),Zd(i.remoteStore,h.targetId))}),Yp.apply(this,arguments)}function Vg(){return Vg=(0,Ot.A)(function*(u,e,i){const h=rm(u);try{const v=yield function(D,X){const te=dr(D),_e=Oo.now(),ze=X.reduce((un,yr)=>un.add(yr.key),Os());let vt,Xt;return te.persistence.runTransaction("Locally write mutations","readwrite",un=>{let yr=Hc(),Ir=Os();return te.os.getEntries(un,ze).next(xr=>{yr=xr,yr.forEach((hi,Xi)=>{Xi.isValidDocument()||(Ir=Ir.add(hi))})}).next(()=>te.localDocuments.getOverlayedDocuments(un,yr)).next(xr=>{vt=xr;const hi=[];for(const Xi of X){const ni=Ip(Xi,vt.get(Xi.key).overlayedDocument);null!=ni&&hi.push(new qc(Xi.key,ni,Vh(ni.value.mapValue),Co.exists(!0)))}return te.mutationQueue.addMutationBatch(un,_e,hi,X)}).next(xr=>{Xt=xr;const hi=xr.applyToLocalDocumentSet(vt,Ir);return te.documentOverlayCache.saveOverlays(un,xr.batchId,hi)})}).then(()=>({batchId:Xt.batchId,changes:Xm(vt)}))}(h.localStore,e);h.sharedClientState.addPendingMutation(v.batchId),function(D,X,te){let _e=D.Fa[D.currentUser.toKey()];_e||(_e=new Rr(Qi)),_e=_e.insert(X,te),D.Fa[D.currentUser.toKey()]=_e}(h,v.batchId,i),yield md(h,v.changes),yield Hp(h.remoteStore)}catch(v){const T=If(v,"Failed to persist write");i.reject(T)}}),Vg.apply(this,arguments)}function Ug(u,e){return Um.apply(this,arguments)}function Um(){return Um=(0,Ot.A)(function*(u,e){const i=dr(u);try{const h=yield function mg(u,e){const i=dr(u),h=e.snapshotVersion;let v=i.ns;return i.persistence.runTransaction("Apply remote event","readwrite-primary",T=>{const D=i.os.newChangeBuffer({trackRemovals:!0});v=i.ns;const X=[];e.targetChanges.forEach((ze,vt)=>{const Xt=v.get(vt);if(!Xt)return;X.push(i.Qr.removeMatchingKeys(T,ze.removedDocuments,vt).next(()=>i.Qr.addMatchingKeys(T,ze.addedDocuments,vt)));let un=Xt.withSequenceNumber(T.currentSequenceNumber);var Ir,xr,hi;null!==e.targetMismatches.get(vt)?un=un.withResumeToken(oo.EMPTY_BYTE_STRING,pi.min()).withLastLimboFreeSnapshotVersion(pi.min()):ze.resumeToken.approximateByteSize()>0&&(un=un.withResumeToken(ze.resumeToken,h)),v=v.insert(vt,un),xr=un,hi=ze,(0===(Ir=Xt).resumeToken.approximateByteSize()||xr.snapshotVersion.toMicroseconds()-Ir.snapshotVersion.toMicroseconds()>=3e8||hi.addedDocuments.size+hi.modifiedDocuments.size+hi.removedDocuments.size>0)&&X.push(i.Qr.updateTargetData(T,un))});let te=Hc(),_e=Os();if(e.documentUpdates.forEach(ze=>{e.resolvedLimboDocuments.has(ze)&&X.push(i.persistence.referenceDelegate.updateLimboDocument(T,ze))}),X.push(qf(T,D,e.documentUpdates).next(ze=>{te=ze.cs,_e=ze.ls})),!h.isEqual(pi.min())){const ze=i.Qr.getLastRemoteSnapshotVersion(T).next(vt=>i.Qr.setTargetsMetadata(T,T.currentSequenceNumber,h));X.push(ze)}return he.waitFor(X).next(()=>D.apply(T)).next(()=>i.localDocuments.getLocalViewOfDocuments(T,te,_e)).next(()=>te)}).then(T=>(i.ns=v,T))}(i.localStore,e);e.targetChanges.forEach((v,T)=>{const D=i.Ca.get(T);D&&(zr(v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size<=1),v.addedDocuments.size>0?D.pa=!0:v.modifiedDocuments.size>0?zr(D.pa):v.removedDocuments.size>0&&(zr(D.pa),D.pa=!1))}),yield md(i,h,e)}catch(h){yield ot(h)}}),Um.apply(this,arguments)}function Fy(u,e,i){const h=dr(u);if(h.isPrimaryClient&&0===i||!h.isPrimaryClient&&1===i){const v=[];h.wa.forEach((T,D)=>{const X=D.view.G_(e);X.snapshot&&v.push(X.snapshot)}),function(D,X){const te=dr(D);te.onlineState=X;let _e=!1;te.queries.forEach((ze,vt)=>{for(const Xt of vt.Q_)Xt.G_(X)&&(_e=!0)}),_e&&rp(te)}(h.eventManager,e),v.length&&h.ya.u_(v),h.onlineState=e,h.isPrimaryClient&&h.sharedClientState.setOnlineState(e)}}function zg(u,e,i){return jg.apply(this,arguments)}function jg(){return jg=(0,Ot.A)(function*(u,e,i){const h=dr(u);h.sharedClientState.updateQueryState(e,"rejected",i);const v=h.Ca.get(e),T=v&&v.key;if(T){let D=new Rr(a.comparator);D=D.insert(T,Eo.newNoDocument(T,pi.min()));const X=Os().add(T),te=new lu(pi.min(),new Map,new Rr(Qi),D,X);yield Ug(h,te),h.Da=h.Da.remove(T),h.Ca.delete(e),Wg(h)}else yield mf(h.localStore,e,!1).then(()=>sp(h,e,i)).catch(ot)}),jg.apply(this,arguments)}function By(u,e){return $g.apply(this,arguments)}function $g(){return $g=(0,Ot.A)(function*(u,e){const i=dr(u),h=e.batch.batchId;try{const v=yield function Rm(u,e){const i=dr(u);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",h=>{const v=e.batch.keys(),T=i.os.newChangeBuffer({trackRemovals:!0});return function(X,te,_e,ze){const vt=_e.batch,Xt=vt.keys();let un=he.resolve();return Xt.forEach(yr=>{un=un.next(()=>ze.getEntry(te,yr)).next(Ir=>{const xr=_e.docVersions.get(yr);zr(null!==xr),Ir.version.compareTo(xr)<0&&(vt.applyToRemoteDocument(Ir,_e),Ir.isValidDocument()&&(Ir.setReadTime(_e.commitVersion),ze.addEntry(Ir)))})}),un.next(()=>X.mutationQueue.removeMutationBatch(te,vt))}(i,h,e,T).next(()=>T.apply(h)).next(()=>i.mutationQueue.performConsistencyCheck(h)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(h,v,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,function(X){let te=Os();for(let _e=0;_e<X.mutationResults.length;++_e)X.mutationResults[_e].transformResults.length>0&&(te=te.add(X.batch.mutations[_e].key));return te}(e))).next(()=>i.localDocuments.getDocuments(h,v))})}(i.localStore,e);H_(i,h,null),Hg(i,h),i.sharedClientState.updateMutationState(h,"acknowledged"),yield md(i,v)}catch(v){yield ot(v)}}),$g.apply(this,arguments)}function Vy(u,e,i){return Gg.apply(this,arguments)}function Gg(){return Gg=(0,Ot.A)(function*(u,e,i){const h=dr(u);try{const v=yield function(D,X){const te=dr(D);return te.persistence.runTransaction("Reject batch","readwrite-primary",_e=>{let ze;return te.mutationQueue.lookupMutationBatch(_e,X).next(vt=>(zr(null!==vt),ze=vt.keys(),te.mutationQueue.removeMutationBatch(_e,vt))).next(()=>te.mutationQueue.performConsistencyCheck(_e)).next(()=>te.documentOverlayCache.removeOverlaysForBatchId(_e,ze,X)).next(()=>te.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(_e,ze)).next(()=>te.localDocuments.getDocuments(_e,ze))})}(h.localStore,e);H_(h,e,i),Hg(h,e),h.sharedClientState.updateMutationState(e,"rejected",i),yield md(h,v)}catch(v){yield ot(v)}}),Gg.apply(this,arguments)}function pd(){return pd=(0,Ot.A)(function*(u,e){const i=dr(u);dd(i.remoteStore)||zn("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const h=yield function(D){const X=dr(D);return X.persistence.runTransaction("Get highest unacknowledged batch id","readonly",te=>X.mutationQueue.getHighestUnacknowledgedBatchId(te))}(i.localStore);if(-1===h)return void e.resolve();const v=i.Ma.get(h)||[];v.push(e),i.Ma.set(h,v)}catch(h){const v=If(h,"Initialization of waitForPendingWrites() operation failed");e.reject(v)}}),pd.apply(this,arguments)}function Hg(u,e){(u.Ma.get(e)||[]).forEach(i=>{i.resolve()}),u.Ma.delete(e)}function H_(u,e,i){const h=dr(u);let v=h.Fa[h.currentUser.toKey()];if(v){const T=v.get(e);T&&(i?T.reject(i):T.resolve(),v=v.remove(e)),h.Fa[h.currentUser.toKey()]=v}}function sp(u,e,i=null){u.sharedClientState.removeLocalQueryTarget(e);for(const h of u.Sa.get(e))u.wa.delete(h),i&&u.ya.La(h,i);u.Sa.delete(e),u.isPrimaryClient&&u.va.Vr(e).forEach(h=>{u.va.containsKey(h)||Jp(u,h)})}function Jp(u,e){u.ba.delete(e.path.canonicalString());const i=u.Da.get(e);null!==i&&(Zd(u.remoteStore,i),u.Da=u.Da.remove(e),u.Ca.delete(i),Wg(u))}function em(u,e,i){for(const h of i)h instanceof Py?(u.va.addReference(h.key,e),Sf(u,h)):h instanceof Oy?(zn("SyncEngine","Document no longer in limbo: "+h.key),u.va.removeReference(h.key,e),u.va.containsKey(h.key)||Jp(u,h.key)):pr()}function Sf(u,e){const i=e.key,h=i.path.canonicalString();u.Da.get(i)||u.ba.has(h)||(zn("SyncEngine","New document in limbo: "+i),u.ba.add(h),Wg(u))}function Wg(u){for(;u.ba.size>0&&u.Da.size<u.maxConcurrentLimboResolutions;){const e=u.ba.values().next().value;u.ba.delete(e);const i=new a(Z.fromString(e)),h=u.xa.next();u.Ca.set(h,new G_(i)),u.Da=u.Da.insert(i,h),Qf(u.remoteStore,new ad(ma(ou(i.path)),h,"TargetPurposeLimboResolution",an._e))}}function md(u,e,i){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,Ot.A)(function*(u,e,i){const h=dr(u),v=[],T=[],D=[];var X;h.wa.isEmpty()||(h.wa.forEach((X,te)=>{D.push(h.Na(te,e,i).then(_e=>{if((_e||i)&&h.isPrimaryClient&&h.sharedClientState.updateQueryState(te.targetId,_e?.fromCache?"not-current":"current"),_e){v.push(_e);const ze=D_.Ki(te.targetId,_e);T.push(ze)}}))}),yield Promise.all(D),h.ya.u_(v),yield(X=(0,Ot.A)(function*(_e,ze){const vt=dr(_e);try{yield vt.persistence.runTransaction("notifyLocalViewChanges","readwrite",Xt=>he.forEach(ze,un=>he.forEach(un.qi,yr=>vt.persistence.referenceDelegate.addReference(Xt,un.targetId,yr)).next(()=>he.forEach(un.Qi,yr=>vt.persistence.referenceDelegate.removeReference(Xt,un.targetId,yr)))))}catch(Xt){if(!It(Xt))throw Xt;zn("LocalStore","Failed to update sequence numbers: "+Xt)}for(const Xt of ze){const un=Xt.targetId;if(!Xt.fromCache){const yr=vt.ns.get(un),xr=yr.withLastLimboFreeSnapshotVersion(yr.snapshotVersion);vt.ns=vt.ns.insert(un,xr)}}}),function te(_e,ze){return X.apply(this,arguments)})(h.localStore,T))}),Yu.apply(this,arguments)}function qg(u,e){return Af.apply(this,arguments)}function Af(){return Af=(0,Ot.A)(function*(u,e){const i=dr(u);if(!i.currentUser.isEqual(e)){zn("SyncEngine","User change. New user:",e.toKey());const h=yield Hv(i.localStore,e);i.currentUser=e,(T=i).Ma.forEach(X=>{X.forEach(te=>{te.reject(new Un(xn.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),T.Ma.clear(),i.sharedClientState.handleUserChange(e,h.removedBatchIds,h.addedBatchIds),yield md(i,h.us)}var T}),Af.apply(this,arguments)}function Ju(u,e){const i=dr(u),h=i.Ca.get(e);if(h&&h.pa)return Os().add(h.key);{let v=Os();const T=i.Sa.get(e);if(!T)return v;for(const D of T){const X=i.wa.get(D);v=v.unionWith(X.view.Ia)}return v}}function vu(u,e){return Kg.apply(this,arguments)}function Kg(){return Kg=(0,Ot.A)(function*(u,e){const i=dr(u),h=yield gg(i.localStore,e.query,!0),v=e.view.fa(h);return i.isPrimaryClient&&em(i,e.targetId,v.Va),v}),Kg.apply(this,arguments)}function Uy(u,e){return Rh.apply(this,arguments)}function Rh(){return Rh=(0,Ot.A)(function*(u,e){const i=dr(u);return O_(i.localStore,e).then(h=>md(i,h))}),Rh.apply(this,arguments)}function Zg(u,e,i,h){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,Ot.A)(function*(u,e,i,h){const v=dr(u),T=yield function(X,te){const _e=dr(X),ze=dr(_e.mutationQueue);return _e.persistence.runTransaction("Lookup mutation documents","readonly",vt=>ze.vn(vt,te).next(Xt=>Xt?_e.localDocuments.getDocuments(vt,Xt):he.resolve(null)))}(v.localStore,e);var te;null!==T?("pending"===i?yield Hp(v.remoteStore):"acknowledged"===i||"rejected"===i?(H_(v,e,h||null),Hg(v,e),te=e,dr(dr(v.localStore).mutationQueue).Mn(te)):pr(),yield md(v,T)):zn("SyncEngine","Cannot apply mutation batch with id: "+e)}),Cf.apply(this,arguments)}function Df(){return Df=(0,Ot.A)(function*(u,e){const i=dr(u);if(nm(i),rm(i),!0===e&&!0!==i.Oa){const h=i.sharedClientState.getAllActiveQueryTargets(),v=yield op(i,h.toArray());i.Oa=!0,yield V_(i.remoteStore,!0);for(const T of v)Qf(i.remoteStore,T)}else if(!1===e&&!1!==i.Oa){const h=[];let v=Promise.resolve();i.Sa.forEach((T,D)=>{i.sharedClientState.isLocalQueryTarget(D)?h.push(D):v=v.then(()=>(sp(i,D),mf(i.localStore,D,!0))),Zd(i.remoteStore,D)}),yield v,yield op(i,h),function(D){const X=dr(D);X.Ca.forEach((te,_e)=>{Zd(X.remoteStore,_e)}),X.va.mr(),X.Ca=new Map,X.Da=new Rr(a.comparator)}(i),i.Oa=!1,yield V_(i.remoteStore,!1)}}),Df.apply(this,arguments)}function op(u,e,i){return tm.apply(this,arguments)}function tm(){return tm=(0,Ot.A)(function*(u,e,i){const h=dr(u),v=[],T=[];for(const D of e){let X;const te=h.Sa.get(D);if(te&&0!==te.length){X=yield Eh(h.localStore,ma(te[0]));for(const _e of te){const ze=h.wa.get(_e),vt=yield vu(h,ze);vt.snapshot&&T.push(vt.snapshot)}}else{const _e=yield Cy(h.localStore,D);X=yield Eh(h.localStore,_e),yield Fu(h,ap(_e),D,!1,X.resumeToken)}v.push(X)}return h.ya.u_(T),v}),tm.apply(this,arguments)}function ap(u){return ah(u.path,u.collectionGroup,u.orderBy,u.filters,u.limit,"F",u.startAt,u.endAt)}function zy(u){return i=dr(u).localStore,dr(dr(i).persistence).Bi();var i}function Xg(u,e,i,h){return Qg.apply(this,arguments)}function Qg(){return Qg=(0,Ot.A)(function*(u,e,i,h){const v=dr(u);if(v.Oa)return void zn("SyncEngine","Ignoring unexpected query state notification.");const T=v.Sa.get(e);if(T&&T.length>0)switch(i){case"current":case"not-current":{const D=yield O_(v.localStore,kf(T[0])),X=lu.createSynthesizedRemoteEventForCurrentChange(e,"current"===i,oo.EMPTY_BYTE_STRING);yield md(v,D,X);break}case"rejected":yield mf(v.localStore,e,!0),sp(v,e,h);break;default:pr()}}),Qg.apply(this,arguments)}function jy(u,e,i){return Yg.apply(this,arguments)}function Yg(){return Yg=(0,Ot.A)(function*(u,e,i){const h=nm(u);if(h.Oa){for(const v of e){if(h.Sa.has(v)&&h.sharedClientState.isActiveQueryTarget(v)){zn("SyncEngine","Adding an already active target "+v);continue}const T=yield Cy(h.localStore,v),D=yield Eh(h.localStore,T);yield Fu(h,ap(T),D.targetId,!1,D.resumeToken),Qf(h.remoteStore,D)}for(const v of i)h.Sa.has(v)&&(yield mf(h.localStore,v,!1).then(()=>{Zd(h.remoteStore,v),sp(h,v)}).catch(ot))}}),Yg.apply(this,arguments)}function nm(u){const e=dr(u);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ug.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ju.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=zg.bind(null,e),e.ya.u_=Dh.bind(null,e.eventManager),e.ya.La=Zp.bind(null,e.eventManager),e}function rm(u){const e=dr(u);return e.remoteStore.remoteSyncer.applySuccessfulWrite=By.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vy.bind(null,e),e}class Qd{constructor(){this.synchronizeTabs=!1}initialize(e){var i=this;return(0,Ot.A)(function*(){i.serializer=bg(e.databaseInfo.databaseId),i.sharedClientState=i.createSharedClientState(e),i.persistence=i.createPersistence(e),yield i.persistence.start(),i.localStore=i.createLocalStore(e),i.gcScheduler=i.createGarbageCollectionScheduler(e,i.localStore),i.indexBackfillerScheduler=i.createIndexBackfillerScheduler(e,i.localStore)})()}createGarbageCollectionScheduler(e,i){return null}createIndexBackfillerScheduler(e,i){return null}createLocalStore(e){return M_(this.persistence,new Iy,e.initialUser,this.serializer)}createPersistence(e){return new A_(pf.Hr,this.serializer)}createSharedClientState(e){return new xg}terminate(){var e=this;return(0,Ot.A)(function*(){var i,h;null===(i=e.gcScheduler)||void 0===i||i.stop(),null===(h=e.indexBackfillerScheduler)||void 0===h||h.stop(),e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Jg extends Qd{constructor(e,i,h){super(),this.ka=e,this.cacheSizeBytes=i,this.forceOwnership=h,this.synchronizeTabs=!1}initialize(e){var i=()=>super.initialize,h=this;return(0,Ot.A)(function*(){yield i().call(h,e),yield h.ka.initialize(h,e),yield rm(h.ka.syncEngine),yield Hp(h.ka.remoteStore),yield h.persistence.fi(()=>(h.gcScheduler&&!h.gcScheduler.started&&h.gcScheduler.start(),h.indexBackfillerScheduler&&!h.indexBackfillerScheduler.started&&h.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return M_(this.persistence,new Iy,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,i){return new wy(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,i)}createIndexBackfillerScheduler(e,i){const h=new Dn(i,this.persistence);return new cn(e.asyncQueue,h)}createPersistence(e){const i=Mm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),h=void 0!==this.cacheSizeBytes?Zc.withCacheSize(this.cacheSizeBytes):Zc.DEFAULT;return new Dm(this.synchronizeTabs,i,e.clientId,h,e.asyncQueue,N_(),wg(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new xg}}class o extends Jg{constructor(e,i){super(e,i,!1),this.ka=e,this.cacheSizeBytes=i,this.synchronizeTabs=!0}initialize(e){var i=()=>super.initialize,h=this;return(0,Ot.A)(function*(){yield i().call(h,e);const v=h.ka.syncEngine;h.sharedClientState instanceof vg&&(h.sharedClientState.syncEngine={Zs:Zg.bind(null,v),Xs:Xg.bind(null,v),eo:jy.bind(null,v),Bi:zy.bind(null,v),Ys:Uy.bind(null,v)},yield h.sharedClientState.start()),yield h.persistence.fi(function(){var T=(0,Ot.A)(function*(D){yield function W_(u,e){return Df.apply(this,arguments)}(h.ka.syncEngine,D),h.gcScheduler&&(D&&!h.gcScheduler.started?h.gcScheduler.start():D||h.gcScheduler.stop()),h.indexBackfillerScheduler&&(D&&!h.indexBackfillerScheduler.started?h.indexBackfillerScheduler.start():D||h.indexBackfillerScheduler.stop())});return function(D){return T.apply(this,arguments)}}())})()}createSharedClientState(e){const i=N_();if(!vg.D(i))throw new Un(xn.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const h=Mm(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new vg(i,e.asyncQueue,h,e.clientId,e.initialUser)}}class t{initialize(e,i){var h=this;return(0,Ot.A)(function*(){h.localStore||(h.localStore=e.localStore,h.sharedClientState=e.sharedClientState,h.datastore=h.createDatastore(i),h.remoteStore=h.createRemoteStore(i),h.eventManager=h.createEventManager(i),h.syncEngine=h.createSyncEngine(i,!e.synchronizeTabs),h.sharedClientState.onlineStateHandler=v=>Fy(h.syncEngine,v,1),h.remoteStore.remoteSyncer.handleCredentialChange=qg.bind(null,h.syncEngine),yield V_(h.remoteStore,h.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Kp}createDatastore(e){const i=bg(e.databaseInfo.databaseId),h=new Wv(e.databaseInfo);return new Sg(e.authCredentials,e.appCheckCredentials,h,i)}createRemoteStore(e){return h=this.localStore,v=this.datastore,T=e.asyncQueue,D=i=>Fy(this.syncEngine,i,0),X=Eg.D()?new Eg:new k_,new xf(h,v,T,D,X);var h,v,T,D,X}createSyncEngine(e,i){return function(v,T,D,X,te,_e,ze){const vt=new Xv(v,T,D,X,te,_e);return ze&&(vt.Oa=!0),vt}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}terminate(){var e=this;return(0,Ot.A)(function*(){var i,h;yield(h=(0,Ot.A)(function*(T){const D=dr(T);zn("RemoteStore","RemoteStore shutting down."),D.v_.add(5),yield ud(D),D.M_.shutdown(),D.x_.set("Unknown")}),function v(T){return h.apply(this,arguments)})(e.remoteStore),null===(i=e.datastore)||void 0===i||i.terminate()})()}}function l(u,e=10240){let i=0;return{read:()=>(0,Ot.A)(function*(){if(i<u.byteLength){const h={value:u.slice(i,i+e),done:!1};return i+=e,h}return{done:!0}})(),cancel:()=>(0,Ot.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class f{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):Gs("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,i){this.muted||setTimeout(()=>{this.muted||e(i)},0)}}class _{constructor(e,i){this.Ka=e,this.serializer=i,this.metadata=new Ao,this.buffer=new Uint8Array,this.$a=new TextDecoder("utf-8"),this.Ua().then(h=>{h&&h.ra()?this.metadata.resolve(h.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(h?.na)}`))},h=>this.metadata.reject(h))}close(){return this.Ka.cancel()}getMetadata(){var e=this;return(0,Ot.A)(function*(){return e.metadata.promise})()}Ba(){var e=this;return(0,Ot.A)(function*(){return yield e.getMetadata(),e.Ua()})()}Ua(){var e=this;return(0,Ot.A)(function*(){const i=yield e.Wa();if(null===i)return null;const h=e.$a.decode(i),v=Number(h);isNaN(v)&&e.Ga(`length string (${h}) is not valid number`);const T=yield e.za(v);return new j_(JSON.parse(T),i.length+v)})()}ja(){return this.buffer.findIndex(e=>123===e)}Wa(){var e=this;return(0,Ot.A)(function*(){for(;e.ja()<0&&!(yield e.Ha()););if(0===e.buffer.length)return null;const i=e.ja();i<0&&e.Ga("Reached the end of bundle when a length string is expected.");const h=e.buffer.slice(0,i);return e.buffer=e.buffer.slice(i),h})()}za(e){var i=this;return(0,Ot.A)(function*(){for(;i.buffer.length<e;)(yield i.Ha())&&i.Ga("Reached the end of bundle when more is expected.");const h=i.$a.decode(i.buffer.slice(0,e));return i.buffer=i.buffer.slice(e),h})()}Ga(e){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ha(){var e=this;return(0,Ot.A)(function*(){const i=yield e.Ka.read();if(!i.done){const h=new Uint8Array(e.buffer.length+i.value.length);h.set(e.buffer),h.set(i.value,e.buffer.length),e.buffer=h}return i.done})()}}class E{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var i=this;return(0,Ot.A)(function*(){if(i.ensureCommitNotCalled(),i.mutations.length>0)throw i.lastTransactionError=new Un(xn.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),i.lastTransactionError;const h=yield(v=(0,Ot.A)(function*(D,X){const te=dr(D),_e={documents:X.map(un=>rf(te.serializer,un))},ze=yield te.vo("BatchGetDocuments",te.serializer.databaseId,Z.emptyPath(),_e,X.length),vt=new Map;ze.forEach(un=>{const yr=function od(u,e){return"found"in e?function(h,v){zr(!!v.found);const T=$d(h,v.found.name),D=vl(v.found.updateTime),X=v.found.createTime?vl(v.found.createTime):pi.min(),te=new $o({mapValue:{fields:v.found.fields}});return Eo.newFoundDocument(T,D,X,te)}(u,e):"missing"in e?function(h,v){zr(!!v.missing),zr(!!v.readTime);const T=$d(h,v.missing),D=vl(v.readTime);return Eo.newNoDocument(T,D)}(u,e):pr()}(te.serializer,un);vt.set(yr.key.toString(),yr)});const Xt=[];return X.forEach(un=>{const yr=vt.get(un.toString());zr(!!yr),Xt.push(yr)}),Xt}),function T(D,X){return v.apply(this,arguments)})(i.datastore,e);var v;return h.forEach(v=>i.recordVersion(v)),h})()}set(e,i){this.write(i.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,i){try{this.write(i.toMutation(e,this.preconditionForUpdate(e)))}catch(h){this.lastTransactionError=h}this.writtenDocs.add(e.toString())}delete(e){this.write(new S(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,Ot.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const i=e.readVersions;var h;e.mutations.forEach(h=>{i.delete(h.key.toString())}),i.forEach((h,v)=>{const T=a.fromPath(v);e.mutations.push(new M(T,e.precondition(T)))}),yield(h=(0,Ot.A)(function*(T,D){const X=dr(T),te={writes:D.map(_e=>vm(X.serializer,_e))};yield X.So("Commit",X.serializer.databaseId,Z.emptyPath(),te)}),function v(T,D){return h.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let i;if(e.isFoundDocument())i=e.version;else{if(!e.isNoDocument())throw pr();i=pi.min()}const h=this.readVersions.get(e.key.toString());if(h){if(!i.isEqual(h))throw new Un(xn.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),i)}precondition(e){const i=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&i?i.isEqual(pi.min())?Co.exists(!1):Co.updateTime(i):Co.none()}preconditionForUpdate(e){const i=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&i){if(i.isEqual(pi.min()))throw new Un(xn.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Co.updateTime(i)}return Co.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class b{constructor(e,i,h,v,T){this.asyncQueue=e,this.datastore=i,this.options=h,this.updateFunction=v,this.deferred=T,this.Ja=h.maxAttempts,this.jo=new Tg(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){var e=this;this.jo.qo((0,Ot.A)(function*(){const i=new E(e.datastore),h=e.Xa(i);h&&h.then(v=>{e.asyncQueue.enqueueAndForget(()=>i.commit().then(()=>{e.deferred.resolve(v)}).catch(T=>{e.eu(T)}))}).catch(v=>{e.eu(v)})}))}Xa(e){try{const i=this.updateFunction(e);return!Kn(i)&&i.catch&&i.then?i:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(i){return this.deferred.reject(i),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(e)}tu(e){if("FirebaseError"===e.name){const i=e.code;return"aborted"===i||"failed-precondition"===i||"already-exists"===i||!oi(i)}return!1}}class A{constructor(e,i,h,v){var T=this;this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=h,this.databaseInfo=v,this.user=Ss.UNAUTHENTICATED,this.clientId=td.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(h,function(){var D=(0,Ot.A)(function*(X){zn("FirestoreClient","Received user=",X.uid),yield T.authCredentialListener(X),T.user=X});return function(X){return D.apply(this,arguments)}}()),this.appCheckCredentials.start(h,D=>(zn("FirestoreClient","Received new app check token=",D),this.appCheckCredentialListener(D,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Un(xn.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const i=new Ao;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,Ot.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),i.resolve()}catch(h){const v=If(h,"Failed to shutdown persistence");i.reject(v)}})),i.promise}}function k(u,e){return F.apply(this,arguments)}function F(){return F=(0,Ot.A)(function*(u,e){u.asyncQueue.verifyOperationInProgress(),zn("FirestoreClient","Initializing OfflineComponentProvider");const i=u.configuration;yield e.initialize(i);let h=i.initialUser;u.setCredentialChangeListener(function(){var v=(0,Ot.A)(function*(T){h.isEqual(T)||(yield Hv(e.localStore,T),h=T)});return function(T){return v.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>u.terminate()),u._offlineComponents=e}),F.apply(this,arguments)}function G(u,e){return J.apply(this,arguments)}function J(){return J=(0,Ot.A)(function*(u,e){u.asyncQueue.verifyOperationInProgress();const i=yield le(u);zn("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(i,u.configuration),u.setCredentialChangeListener(h=>ep(e.remoteStore,h)),u.setAppCheckTokenChangeListener((h,v)=>ep(e.remoteStore,v)),u._onlineComponents=e}),J.apply(this,arguments)}function ne(u){return"FirebaseError"===u.name?u.code===xn.FAILED_PRECONDITION||u.code===xn.UNIMPLEMENTED:!(typeof DOMException<"u"&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code}function le(u){return de.apply(this,arguments)}function de(){return de=(0,Ot.A)(function*(u){if(!u._offlineComponents)if(u._uninitializedComponentsProvider){zn("FirestoreClient","Using user provided OfflineComponentProvider");try{yield k(u,u._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!ne(i))throw i;As("Error using user provided cache. Falling back to memory cache: "+i),yield k(u,new Qd)}}else zn("FirestoreClient","Using default OfflineComponentProvider"),yield k(u,new Qd);return u._offlineComponents}),de.apply(this,arguments)}function Se(u){return tt.apply(this,arguments)}function tt(){return tt=(0,Ot.A)(function*(u){return u._onlineComponents||(u._uninitializedComponentsProvider?(zn("FirestoreClient","Using user provided OnlineComponentProvider"),yield G(u,u._uninitializedComponentsProvider._online)):(zn("FirestoreClient","Using default OnlineComponentProvider"),yield G(u,new t))),u._onlineComponents}),tt.apply(this,arguments)}function _t(u){return le(u).then(e=>e.persistence)}function At(u){return le(u).then(e=>e.localStore)}function yt(u){return Se(u).then(e=>e.remoteStore)}function St(u){return Se(u).then(e=>e.syncEngine)}function kt(u){return yn.apply(this,arguments)}function yn(){return yn=(0,Ot.A)(function*(u){const e=yield Se(u),i=e.eventManager;return i.onListen=Vm.bind(null,e.syncEngine),i.onUnlisten=ip.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=ky.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=Mh.bind(null,e.syncEngine),i}),yn.apply(this,arguments)}function En(u,e,i={}){const h=new Ao;return u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return function(T,D,X,te,_e){const ze=new f({next:Xt=>{D.enqueueAndForget(()=>z_(T,vt));const un=Xt.docs.has(X);!un&&Xt.fromCache?_e.reject(new Un(xn.UNAVAILABLE,"Failed to get document because the client is offline.")):un&&Xt.fromCache&&te&&"server"===te.source?_e.reject(new Un(xn.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):_e.resolve(Xt)},error:Xt=>_e.reject(Xt)}),vt=new hd(ou(X.path),ze,{includeMetadataChanges:!0,ta:!0});return Lm(T,vt)}(yield kt(u),u.asyncQueue,e,i,h)})),h.promise}function jn(u,e,i={}){const h=new Ao;return u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return function(T,D,X,te,_e){const ze=new f({next:Xt=>{D.enqueueAndForget(()=>z_(T,vt)),Xt.fromCache&&"server"===te.source?_e.reject(new Un(xn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):_e.resolve(Xt)},error:Xt=>_e.reject(Xt)}),vt=new hd(X,ze,{includeMetadataChanges:!0,ta:!0});return Lm(T,vt)}(yield kt(u),u.asyncQueue,e,i,h)})),h.promise}function is(u){const e={};return void 0!==u.timeoutSeconds&&(e.timeoutSeconds=u.timeoutSeconds),e}const hr=new Map;function di(u,e,i){if(!i)throw new Un(xn.INVALID_ARGUMENT,`Function ${u}() cannot be called with an empty ${e}.`)}function Zi(u,e,i,h){if(!0===e&&!0===h)throw new Un(xn.INVALID_ARGUMENT,`${u} and ${i} cannot be used together.`)}function lo(u){if(!a.isDocumentKey(u))throw new Un(xn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${u} has ${u.length}.`)}function ss(u){if(a.isDocumentKey(u))throw new Un(xn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${u} has ${u.length}.`)}function Ti(u){if(void 0===u)return"undefined";if(null===u)return"null";if("string"==typeof u)return u.length>20&&(u=`${u.substring(0,20)}...`),JSON.stringify(u);if("number"==typeof u||"boolean"==typeof u)return""+u;if("object"==typeof u){if(u instanceof Array)return"an array";{const e=(h=u).constructor?h.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var h;return"function"==typeof u?"a function":pr()}function yi(u,e){if("_delegate"in u&&(u=u._delegate),!(u instanceof e)){if(e.name===u.constructor.name)throw new Un(xn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=Ti(u);throw new Un(xn.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return u}function cs(u,e){if(e<=0)throw new Un(xn.INVALID_ARGUMENT,`Function ${u}() requires a positive number, but it was: ${e}.`)}class ts{constructor(e){var i,h;if(void 0===e.host){if(void 0!==e.ssl)throw new Un(xn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(i=e.ssl)||void 0===i||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Un(xn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Zi("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=is(null!==(h=e.experimentalLongPollingOptions)&&void 0!==h?h:{}),function(T){if(void 0!==T.timeoutSeconds){if(isNaN(T.timeoutSeconds))throw new Un(xn.INVALID_ARGUMENT,`invalid long polling timeout: ${T.timeoutSeconds} (must not be NaN)`);if(T.timeoutSeconds<5)throw new Un(xn.INVALID_ARGUMENT,`invalid long polling timeout: ${T.timeoutSeconds} (minimum allowed value is 5)`);if(T.timeoutSeconds>30)throw new Un(xn.INVALID_ARGUMENT,`invalid long polling timeout: ${T.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ys{constructor(e,i,h,v){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=h,this._app=v,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ts({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Un(xn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Un(xn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ts(e),void 0!==e.credentials&&(this._authCredentials=function(h){if(!h)return new pu;switch(h.type){case"firstParty":return new vr(h.sessionIndex||"0",h.iamToken||null,h.authTokenFactory||null);case"provider":return h.client;default:throw new Un(xn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const h=hr.get(i);h&&(zn("ComponentProvider","Removing Datastore"),hr.delete(i),h.terminate())}(this),Promise.resolve()}}class ms{constructor(e,i,h){this.converter=i,this._query=h,this.type="query",this.firestore=e}withConverter(e){return new ms(this.firestore,e,this._query)}}class Vi{constructor(e,i,h){this.converter=i,this._key=h,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Io(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Vi(this.firestore,e,this._key)}}class Io extends ms{constructor(e,i,h){super(e,i,ou(h)),this._path=h,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Vi(this.firestore,null,new a(e))}withConverter(e){return new Io(this.firestore,e,this._path)}}function Oa(u,e,...i){if(u=(0,ur.Ku)(u),di("collection","path",e),u instanceof Ys){const h=Z.fromString(e,...i);return ss(h),new Io(u,null,h)}{if(!(u instanceof Vi||u instanceof Io))throw new Un(xn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const h=u._path.child(Z.fromString(e,...i));return ss(h),new Io(u.firestore,null,h)}}function _o(u,e,...i){if(u=(0,ur.Ku)(u),1===arguments.length&&(e=td.newId()),di("doc","path",e),u instanceof Ys){const h=Z.fromString(e,...i);return lo(h),new Vi(u,null,new a(h))}{if(!(u instanceof Vi||u instanceof Io))throw new Un(xn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const h=u._path.child(Z.fromString(e,...i));return lo(h),new Vi(u.firestore,u instanceof Io?u.converter:null,new a(h))}}function wl(u,e){return u=(0,ur.Ku)(u),e=(0,ur.Ku)(e),(u instanceof Vi||u instanceof Io)&&(e instanceof Vi||e instanceof Io)&&u.firestore===e.firestore&&u.path===e.path&&u.converter===e.converter}function ka(u,e){return u=(0,ur.Ku)(u),e=(0,ur.Ku)(e),u instanceof ms&&e instanceof ms&&u.firestore===e.firestore&&gl(u._query,e._query)&&u.converter===e.converter}class Na{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Tg(this,"async_queue_retry"),this.cu=()=>{const i=wg();i&&zn("AsyncQueue","Visibility state changed to "+i.visibilityState),this.jo.Ko()};const e=wg();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;const i=wg();i&&"function"==typeof i.removeEventListener&&i.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});const i=new Ao;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){var e=this;return(0,Ot.A)(function*(){if(0!==e.ru.length){try{yield e.ru[0](),e.ru.shift(),e.jo.reset()}catch(i){if(!It(i))throw i;zn("AsyncQueue","Operation failed with retryable error: "+i)}e.ru.length>0&&e.jo.qo(()=>e.Pu())}})()}hu(e){const i=this.nu.then(()=>(this._u=!0,e().catch(h=>{throw this.ou=h,this._u=!1,Gs("INTERNAL UNHANDLED ERROR: ",function(D){let X=D.message||"";return D.stack&&(X=D.stack.includes(D.message)?D.stack:D.message+"\n"+D.stack),X}(h)),h}).then(h=>(this._u=!1,h))));return this.nu=i,i}enqueueAfterDelay(e,i,h){this.lu(),this.uu.indexOf(e)>-1&&(i=0);const v=kg.createAndSchedule(this,e,i,h,T=>this.Iu(T));return this.su.push(v),v}lu(){this.ou&&pr()}verifyOperationInProgress(){}Tu(){var e=this;return(0,Ot.A)(function*(){let i;do{i=e.nu,yield i}while(i!==e.nu)})()}Eu(e){for(const i of this.su)if(i.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((i,h)=>i.targetTimeMs-h.targetTimeMs);for(const i of this.su)if(i.skipDelay(),"all"!==e&&i.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){const i=this.su.indexOf(e);this.su.splice(i,1)}}function co(u){return function(i,h){if("object"!=typeof i||null===i)return!1;const v=i;for(const T of["next","error","complete"])if(T in v&&"function"==typeof v[T])return!0;return!1}(u)}class sl{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ao,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,i,h){this._progressObserver={next:e,error:i,complete:h}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,i){return this._taskCompletionResolver.promise.then(e,i)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class qs extends Ys{constructor(e,i,h,v){super(e,i,h,v),this.type="firestore",this._queue=new Na,this._persistenceKey=v?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Fc(this),this._firestoreClient.terminate()}}function Ks(u){return u._firestoreClient||Fc(u),u._firestoreClient.verifyNotTerminated(),u._firestoreClient}function Fc(u){var e,i,h;const v=u._freezeSettings(),T=(te=(null===(e=u._app)||void 0===e?void 0:e.options.appId)||"",new Nh(u._databaseId,te,u._persistenceKey,(ze=v).host,ze.ssl,ze.experimentalForceLongPolling,ze.experimentalAutoDetectLongPolling,is(ze.experimentalLongPollingOptions),ze.useFetchStreams));var te,ze;u._firestoreClient=new A(u._authCredentials,u._appCheckCredentials,u._queue,T),null!==(i=v.localCache)&&void 0!==i&&i._offlineComponentProvider&&null!==(h=v.localCache)&&void 0!==h&&h._onlineComponentProvider&&(u._firestoreClient._uninitializedComponentsProvider={_offlineKind:v.localCache.kind,_offline:v.localCache._offlineComponentProvider,_online:v.localCache._onlineComponentProvider})}function im(u,e,i){const h=new Ao;return u.asyncQueue.enqueue((0,Ot.A)(function*(){try{yield k(u,i),yield G(u,e),h.resolve()}catch(v){const T=v;if(!ne(T))throw T;As("Error enabling indexeddb cache. Falling back to memory cache: "+T),h.reject(T)}})).then(()=>h.promise)}function K_(u){if(u._initialized||u._terminated)throw new Un(xn.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Qc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qc(oo.fromBase64String(e))}catch(i){throw new Un(xn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new Qc(oo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ld{constructor(...e){for(let i=0;i<e.length;++i)if(0===e[i].length)throw new Un(xn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new n(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Do{constructor(e){this._methodName=e}}class sm{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Un(xn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Un(xn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Qi(this._lat,e._lat)||Qi(this._long,e._long)}}const Z_=/^__.*__$/;class Vu{constructor(e,i,h){this.data=e,this.fieldMask=i,this.fieldTransforms=h}toMutation(e,i){return null!==this.fieldMask?new qc(e,this.data,this.fieldMask,i,this.fieldTransforms):new dh(e,this.data,i,this.fieldTransforms)}}class Eu{constructor(e,i,h){this.data=e,this.fieldMask=i,this.fieldTransforms=h}toMutation(e,i){return new qc(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function Mf(u){switch(u){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw pr()}}class lp{constructor(e,i,h,v,T,D){this.settings=e,this.databaseId=i,this.serializer=h,this.ignoreUndefinedProperties=v,void 0===T&&this.Ru(),this.fieldTransforms=T||[],this.fieldMask=D||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new lp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var i;const h=null===(i=this.path)||void 0===i?void 0:i.child(e),v=this.mu({path:h,gu:!1});return v.pu(e),v}yu(e){var i;const h=null===(i=this.path)||void 0===i?void 0:i.child(e),v=this.mu({path:h,gu:!1});return v.Ru(),v}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return t_(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return void 0!==this.fieldMask.find(i=>e.isPrefixOf(i))||void 0!==this.fieldTransforms.find(i=>e.isPrefixOf(i.field))}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(0===e.length)throw this.Su("Document fields must not be empty");if(Mf(this.Vu)&&Z_.test(e))throw this.Su('Document fields cannot begin and end with "__"')}}class X_{constructor(e,i,h){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=h||bg(e)}Cu(e,i,h,v=!1){return new lp({Vu:e,methodName:i,Du:h,path:n.emptyPath(),gu:!1,bu:v},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Uu(u){const e=u._freezeSettings(),i=bg(u._databaseId);return new X_(u._databaseId,!!e.ignoreUndefinedProperties,i)}function Wy(u,e,i,h,v,T={}){const D=u.Cu(T.merge||T.mergeFields?2:0,e,i,v);Qy("Data must be an object, but it was:",D,h);const X=up(h,D);let te,_e;if(T.merge)te=new ps(D.fieldMask),_e=D.fieldTransforms;else if(T.mergeFields){const ze=[];for(const vt of T.mergeFields){const Xt=dp(e,vt,i);if(!D.contains(Xt))throw new Un(xn.INVALID_ARGUMENT,`Field '${Xt}' is specified in your field mask but missing from your input data.`);e0(ze,Xt)||ze.push(Xt)}te=new ps(ze),_e=D.fieldTransforms.filter(vt=>te.covers(vt.field))}else te=null,_e=D.fieldTransforms;return new Vu(new $o(X),te,_e)}class Q_ extends Do{_toFieldTransform(e){if(2!==e.Vu)throw e.Su(1===e.Vu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Q_}}function om(u,e,i){return new lp({Vu:3,Du:e.settings.Du,methodName:u._methodName,gu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class qy extends Do{_toFieldTransform(e){return new Xh(e.path,new Pu)}isEqual(e){return e instanceof qy}}class Y_ extends Do{constructor(e,i){super(e),this.vu=i}_toFieldTransform(e){const i=om(this,e,!0),h=this.vu.map(T=>cp(T,i)),v=new yu(h);return new Xh(e.path,v)}isEqual(e){return e instanceof Y_&&(0,ur.bD)(this.vu,e.vu)}}class Jv extends Do{constructor(e,i){super(e),this.vu=i}_toFieldTransform(e){const i=om(this,e,!0),h=this.vu.map(T=>cp(T,i)),v=new Cc(h);return new Xh(e.path,v)}isEqual(e){return e instanceof Jv&&(0,ur.bD)(this.vu,e.vu)}}class Ky extends Do{constructor(e,i){super(e),this.Fu=i}_toFieldTransform(e){const i=new Lf(e.serializer,qu(e.serializer,this.Fu));return new Xh(e.path,i)}isEqual(e){return e instanceof Ky&&this.Fu===e.Fu}}function Zy(u,e,i,h){const v=u.Cu(1,e,i);Qy("Data must be an object, but it was:",v,h);const T=[],D=$o.empty();Mi(h,(te,_e)=>{const ze=Yy(e,te,i);_e=(0,ur.Ku)(_e);const vt=v.yu(ze);if(_e instanceof Q_)T.push(ze);else{const Xt=cp(_e,vt);null!=Xt&&(T.push(ze),D.set(ze,Xt))}});const X=new ps(T);return new Eu(D,X,v.fieldTransforms)}function Xy(u,e,i,h,v,T){const D=u.Cu(1,e,i),X=[dp(e,h,i)],te=[v];if(T.length%2!=0)throw new Un(xn.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let Xt=0;Xt<T.length;Xt+=2)X.push(dp(e,T[Xt])),te.push(T[Xt+1]);const _e=[],ze=$o.empty();for(let Xt=X.length-1;Xt>=0;--Xt)if(!e0(_e,X[Xt])){const un=X[Xt];let yr=te[Xt];yr=(0,ur.Ku)(yr);const Ir=D.yu(un);if(yr instanceof Q_)_e.push(un);else{const xr=cp(yr,Ir);null!=xr&&(_e.push(un),ze.set(un,xr))}}const vt=new ps(_e);return new Eu(ze,vt,D.fieldTransforms)}function e_(u,e,i,h=!1){return cp(i,u.Cu(h?4:3,e))}function cp(u,e){if(J_(u=(0,ur.Ku)(u)))return Qy("Unsupported field value:",e,u),up(u,e);if(u instanceof Do)return function(h,v){if(!Mf(v.Vu))throw v.Su(`${h._methodName}() can only be used with update() and set()`);if(!v.path)throw v.Su(`${h._methodName}() is not currently supported inside arrays`);const T=h._toFieldTransform(v);T&&v.fieldTransforms.push(T)}(u,e),null;if(void 0===u&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),u instanceof Array){if(e.settings.gu&&4!==e.Vu)throw e.Su("Nested arrays are not supported");return function(h,v){const T=[];let D=0;for(const X of h){let te=cp(X,v.wu(D));null==te&&(te={nullValue:"NULL_VALUE"}),T.push(te),D++}return{arrayValue:{values:T}}}(u,e)}return function(h,v){if(null===(h=(0,ur.Ku)(h)))return{nullValue:"NULL_VALUE"};if("number"==typeof h)return qu(v.serializer,h);if("boolean"==typeof h)return{booleanValue:h};if("string"==typeof h)return{stringValue:h};if(h instanceof Date){const T=Oo.fromDate(h);return{timestampValue:nf(v.serializer,T)}}if(h instanceof Oo){const T=new Oo(h.seconds,1e3*Math.floor(h.nanoseconds/1e3));return{timestampValue:nf(v.serializer,T)}}if(h instanceof sm)return{geoPointValue:{latitude:h.latitude,longitude:h.longitude}};if(h instanceof Qc)return{bytesValue:__(v.serializer,h._byteString)};if(h instanceof Vi){const T=v.databaseId,D=h.firestore._databaseId;if(!D.isEqual(T))throw v.Su(`Document reference is for database ${D.projectId}/${D.database} but should be for database ${T.projectId}/${T.database}`);return{referenceValue:Id(h.firestore._databaseId||v.databaseId,h._key.path)}}throw v.Su(`Unsupported field value: ${Ti(h)}`)}(u,e)}function up(u,e){const i={};return po(u)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Mi(u,(h,v)=>{const T=cp(v,e.fu(h));null!=T&&(i[h]=T)}),{mapValue:{fields:i}}}function J_(u){return!("object"!=typeof u||null===u||u instanceof Array||u instanceof Date||u instanceof Oo||u instanceof sm||u instanceof Qc||u instanceof Vi||u instanceof Do)}function Qy(u,e,i){if(!J_(i)||"object"!=typeof(v=i)||null===v||Object.getPrototypeOf(v)!==Object.prototype&&null!==Object.getPrototypeOf(v)){const h=Ti(i);throw e.Su("an object"===h?u+" a custom object":u+" "+h)}var v}function dp(u,e,i){if((e=(0,ur.Ku)(e))instanceof Ld)return e._internalPath;if("string"==typeof e)return Yy(u,e);throw t_("Field path arguments must be of type string or ",u,!1,void 0,i)}const Vx=new RegExp("[~\\*/\\[\\]]");function Yy(u,e,i){if(e.search(Vx)>=0)throw t_(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,u,!1,void 0,i);try{return new Ld(...e.split("."))._internalPath}catch{throw t_(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,u,!1,void 0,i)}}function t_(u,e,i,h,v){const T=h&&!h.isEmpty(),D=void 0!==v;let X=`Function ${e}() called with invalid data`;i&&(X+=" (via `toFirestore()`)"),X+=". ";let te="";return(T||D)&&(te+=" (found",T&&(te+=` in field ${h}`),D&&(te+=` in document ${v}`),te+=")"),new Un(xn.INVALID_ARGUMENT,X+u+te)}function e0(u,e){return u.some(i=>i.isEqual(e))}class Yd{constructor(e,i,h,v,T){this._firestore=e,this._userDataWriter=i,this._key=h,this._document=v,this._converter=T}get id(){return this._key.path.lastSegment()}get ref(){return new Vi(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ey(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(t0("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i)}}}class ey extends Yd{data(){return super.data()}}function t0(u,e){return"string"==typeof e?Yy(u,e):e instanceof Ld?e._internalPath:e._delegate._internalPath}function ty(u){if("L"===u.limitType&&0===u.explicitOrderBy.length)throw new Un(xn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jy{}class n_ extends Jy{}function am(u,e,...i){let h=[];e instanceof Jy&&h.push(e),h=h.concat(i),function(T){const D=T.filter(te=>te instanceof r_).length,X=T.filter(te=>te instanceof ny).length;if(D>1||D>0&&X>0)throw new Un(xn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(h);for(const v of h)u=v._apply(u);return u}class ny extends n_{constructor(e,i,h){super(),this._field=e,this._op=i,this._value=h,this.type="where"}static _create(e,i,h){return new ny(e,i,h)}_apply(e){const i=this._parse(e);return tv(e._query,i),new ms(e.firestore,e.converter,Wa(e._query,i))}_parse(e){const i=Uu(e.firestore);return function(T,D,X,te,_e,ze,vt){let Xt;if(_e.isKeyField()){if("array-contains"===ze||"array-contains-any"===ze)throw new Un(xn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${ze}' queries on documentId().`);if("in"===ze||"not-in"===ze){o0(vt,ze);const un=[];for(const yr of vt)un.push(U0(te,T,yr));Xt={arrayValue:{values:un}}}else Xt=U0(te,T,vt)}else"in"!==ze&&"not-in"!==ze&&"array-contains-any"!==ze||o0(vt,ze),Xt=e_(X,"where",vt,"in"===ze||"not-in"===ze);return ao.create(_e,ze,Xt)}(e._query,0,i,e.firestore._databaseId,this._field,this._op,this._value)}}class r_ extends Jy{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new r_(e,i)}_parse(e){const i=this._queryConstraints.map(h=>h._parse(e)).filter(h=>h.getFilters().length>0);return 1===i.length?i[0]:Lo.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return 0===i.getFilters().length?e:(function(v,T){let D=v;const X=T.getFlattenedFilters();for(const te of X)tv(D,te),D=Wa(D,te)}(e._query,i),new ms(e.firestore,e.converter,Wa(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class n0 extends n_{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new n0(e,i)}_apply(e){const i=function(v,T,D){if(null!==v.startAt)throw new Un(xn.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==v.endAt)throw new Un(xn.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new vd(T,D)}(e._query,this._field,this._direction);return new ms(e.firestore,e.converter,function(v,T){const D=v.explicitOrderBy.concat([T]);return new id(v.path,v.collectionGroup,D,v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)}(e._query,i))}}class ev extends n_{constructor(e,i,h){super(),this.type=e,this._limit=i,this._limitType=h}static _create(e,i,h){return new ev(e,i,h)}_apply(e){return new ms(e.firestore,e.converter,bd(e._query,this._limit,this._limitType))}}class Gm extends n_{constructor(e,i,h){super(),this.type=e,this._docOrFields=i,this._inclusive=h}static _create(e,i,h){return new Gm(e,i,h)}_apply(e){const i=s0(e,this.type,this._docOrFields,this._inclusive);return new ms(e.firestore,e.converter,(T=i,new id((v=e._query).path,v.collectionGroup,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,T,v.endAt)));var v,T}}class iy extends n_{constructor(e,i,h){super(),this.type=e,this._docOrFields=i,this._inclusive=h}static _create(e,i,h){return new iy(e,i,h)}_apply(e){const i=s0(e,this.type,this._docOrFields,this._inclusive);return new ms(e.firestore,e.converter,(T=i,new id((v=e._query).path,v.collectionGroup,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,T)));var v,T}}function s0(u,e,i,h){if(i[0]=(0,ur.Ku)(i[0]),i[0]instanceof Yd)return function(T,D,X,te,_e){if(!te)throw new Un(xn.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${X}().`);const ze=[];for(const vt of sd(T))if(vt.field.isKeyField())ze.push(es(D,te.key));else{const Xt=te.data.field(vt.field);if(mu(Xt))throw new Un(xn.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+vt.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===Xt){const un=vt.field.canonicalString();throw new Un(xn.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${un}' (used as the orderBy) does not exist.`)}ze.push(Xt)}return new Du(ze,_e)}(u._query,u.firestore._databaseId,e,i[0]._document,h);{const v=Uu(u.firestore);return function(D,X,te,_e,ze,vt){const Xt=D.explicitOrderBy;if(ze.length>Xt.length)throw new Un(xn.INVALID_ARGUMENT,`Too many arguments provided to ${_e}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const un=[];for(let yr=0;yr<ze.length;yr++){const Ir=ze[yr];if(Xt[yr].field.isKeyField()){if("string"!=typeof Ir)throw new Un(xn.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${_e}(), but got a ${typeof Ir}`);if(!Of(D)&&-1!==Ir.indexOf("/"))throw new Un(xn.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${_e}() must be a plain document ID, but '${Ir}' contains a slash.`);const xr=D.path.child(Z.fromString(Ir));if(!a.isDocumentKey(xr))throw new Un(xn.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${_e}() must result in a valid document path, but '${xr}' is not because it contains an odd number of segments.`);const hi=new a(xr);un.push(es(X,hi))}else{const xr=e_(te,_e,Ir);un.push(xr)}}return new Du(un,vt)}(u._query,u.firestore._databaseId,v,e,i,h)}}function U0(u,e,i){if("string"==typeof(i=(0,ur.Ku)(i))){if(""===i)throw new Un(xn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Of(e)&&-1!==i.indexOf("/"))throw new Un(xn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const h=e.path.child(Z.fromString(i));if(!a.isDocumentKey(h))throw new Un(xn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${h}' is not because it has an odd number of segments (${h.length}).`);return es(u,new a(h))}if(i instanceof Vi)return es(u,i._key);throw new Un(xn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ti(i)}.`)}function o0(u,e){if(!Array.isArray(u)||0===u.length)throw new Un(xn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function tv(u,e){const i=function(v,T){for(const D of v)for(const X of D.getFlattenedFilters())if(T.indexOf(X.op)>=0)return X.op;return null}(u.filters,function(v){switch(v){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Un(xn.INVALID_ARGUMENT,i===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class nv{convertValue(e,i="none"){switch(pl(e)){case 0:return null;case 1:return e.booleanValue;case 2:return No(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(fl(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 10:return this.convertObject(e.mapValue,i);default:throw pr()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const h={};return Mi(e,(v,T)=>{h[v]=this.convertValue(T,i)}),h}convertGeoPoint(e){return new sm(No(e.latitude),No(e.longitude))}convertArray(e,i){return(e.values||[]).map(h=>this.convertValue(h,i))}convertServerTimestamp(e,i){switch(i){case"previous":const h=tu(e);return null==h?null:this.convertValue(h,i);case"estimate":return this.convertTimestamp(Cu(e));default:return null}}convertTimestamp(e){const i=Tc(e);return new Oo(i.seconds,i.nanos)}convertDocumentKey(e,i){const h=Z.fromString(e);zr(af(h));const v=new mo(h.get(1),h.get(3)),T=new a(h.popFirst(5));return v.isEqual(i)||Gs(`Document ${T} contains a document reference within a different database (${v.projectId}/${v.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),T}}function rv(u,e,i){let h;return h=u?i&&(i.merge||i.mergeFields)?u.toFirestore(e,i):u.toFirestore(e):e,h}class Hx extends nv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qc(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Vi(this.firestore,null,i)}}class hp{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fp extends Yd{constructor(e,i,h,v,T,D){super(e,i,h,v,D),this._firestore=e,this._firestoreImpl=e,this.metadata=T}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new sy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const h=this._document.data.field(t0("DocumentSnapshot.get",e));if(null!==h)return this._userDataWriter.convertValue(h,i.serverTimestamps)}}}class sy extends fp{data(e={}){return super.data(e)}}class lm{constructor(e,i,h,v){this._firestore=e,this._userDataWriter=i,this._snapshot=v,this.metadata=new hp(v.hasPendingWrites,v.fromCache),this.query=h}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,i){this._snapshot.docs.forEach(h=>{e.call(i,new sy(this._firestore,this._userDataWriter,h.key,h,new hp(this._snapshot.mutatedKeys.has(h.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Un(xn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(v,T){if(v._snapshot.oldDocs.isEmpty()){let D=0;return v._snapshot.docChanges.map(X=>({type:"added",doc:new sy(v._firestore,v._userDataWriter,X.doc.key,X.doc,new hp(v._snapshot.mutatedKeys.has(X.doc.key),v._snapshot.fromCache),v.query.converter),oldIndex:-1,newIndex:D++}))}{let D=v._snapshot.oldDocs;return v._snapshot.docChanges.filter(X=>T||3!==X.type).map(X=>{const te=new sy(v._firestore,v._userDataWriter,X.doc.key,X.doc,new hp(v._snapshot.mutatedKeys.has(X.doc.key),v._snapshot.fromCache),v.query.converter);let _e=-1,ze=-1;return 0!==X.type&&(_e=D.indexOf(X.doc.key),D=D.delete(X.doc.key)),1!==X.type&&(D=D.add(X.doc),ze=D.indexOf(X.doc.key)),{type:qx(X.type),doc:te,oldIndex:_e,newIndex:ze}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function qx(u){switch(u){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return pr()}}function c0(u,e){return u instanceof fp&&e instanceof fp?u._firestore===e._firestore&&u._key.isEqual(e._key)&&(null===u._document?null===e._document:u._document.isEqual(e._document))&&u._converter===e._converter:u instanceof lm&&e instanceof lm&&u._firestore===e._firestore&&ka(u.query,e.query)&&u.metadata.isEqual(e.metadata)&&u._snapshot.isEqual(e._snapshot)}class Rf extends nv{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qc(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Vi(this.firestore,null,i)}}function q0(u,e,i){u=yi(u,Vi);const h=yi(u.firestore,qs),v=rv(u.converter,e,i);return i_(h,[Wy(Uu(h),"setDoc",u._key,v,null!==u.converter,i).toMutation(u._key,Co.none())])}function iv(u,e,i,...h){u=yi(u,Vi);const v=yi(u.firestore,qs),T=Uu(v);let D;return D="string"==typeof(e=(0,ur.Ku)(e))||e instanceof Ld?Xy(T,"updateDoc",u._key,e,i,h):Zy(T,"updateDoc",u._key,e),i_(v,[D.toMutation(u._key,Co.exists(!0))])}function Zx(u,...e){var i,h,v;u=(0,ur.Ku)(u);let T={includeMetadataChanges:!1,source:"default"},D=0;"object"!=typeof e[D]||co(e[D])||(T=e[D],D++);const X={includeMetadataChanges:T.includeMetadataChanges,source:T.source};if(co(e[D])){const vt=e[D];e[D]=null===(i=vt.next)||void 0===i?void 0:i.bind(vt),e[D+1]=null===(h=vt.error)||void 0===h?void 0:h.bind(vt),e[D+2]=null===(v=vt.complete)||void 0===v?void 0:v.bind(vt)}let te,_e,ze;if(u instanceof Vi)_e=yi(u.firestore,qs),ze=ou(u._key.path),te={next:vt=>{e[D]&&e[D](sv(_e,u,vt))},error:e[D+1],complete:e[D+2]};else{const vt=yi(u,ms);_e=yi(vt.firestore,qs),ze=vt._query;const Xt=new Rf(_e);te={next:un=>{e[D]&&e[D](new lm(_e,Xt,vt,un))},error:e[D+1],complete:e[D+2]},ty(u._query)}return function(Xt,un,yr,Ir){const xr=new f(Ir),hi=new hd(un,xr,yr);return Xt.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return Lm(yield kt(Xt),hi)})),()=>{xr.Qa(),Xt.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return z_(yield kt(Xt),hi)}))}}(Ks(_e),ze,X,te)}function i_(u,e){return function(h,v){const T=new Ao;return h.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return function Ly(u,e,i){return Vg.apply(this,arguments)}(yield St(h),v,T)})),T.promise}(Ks(u),e)}function sv(u,e,i){const h=i.docs.get(e._key),v=new Rf(u);return new fp(u,v,e._key,h,new hp(i.hasPendingWrites,i.fromCache),e.converter)}const mw={maxAttempts:5};class h0{constructor(e,i){this._firestore=e,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=Uu(e)}set(e,i,h){this._verifyNotCommitted();const v=pp(e,this._firestore),T=rv(v.converter,i,h),D=Wy(this._dataReader,"WriteBatch.set",v._key,T,null!==v.converter,h);return this._mutations.push(D.toMutation(v._key,Co.none())),this}update(e,i,h,...v){this._verifyNotCommitted();const T=pp(e,this._firestore);let D;return D="string"==typeof(i=(0,ur.Ku)(i))||i instanceof Ld?Xy(this._dataReader,"WriteBatch.update",T._key,i,h,v):Zy(this._dataReader,"WriteBatch.update",T._key,i),this._mutations.push(D.toMutation(T._key,Co.exists(!0))),this}delete(e){this._verifyNotCommitted();const i=pp(e,this._firestore);return this._mutations=this._mutations.concat(new S(i._key,Co.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Un(xn.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pp(u,e){if((u=(0,ur.Ku)(u)).firestore!==e)throw new Un(xn.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return u}class gw extends class{constructor(i,h){this._firestore=i,this._transaction=h,this._dataReader=Uu(i)}get(i){const h=pp(i,this._firestore),v=new Hx(this._firestore);return this._transaction.lookup([h._key]).then(T=>{if(!T||1!==T.length)return pr();const D=T[0];if(D.isFoundDocument())return new Yd(this._firestore,v,D.key,D,h.converter);if(D.isNoDocument())return new Yd(this._firestore,v,h._key,null,h.converter);throw pr()})}set(i,h,v){const T=pp(i,this._firestore),D=rv(T.converter,h,v),X=Wy(this._dataReader,"Transaction.set",T._key,D,null!==T.converter,v);return this._transaction.set(T._key,X),this}update(i,h,v,...T){const D=pp(i,this._firestore);let X;return X="string"==typeof(h=(0,ur.Ku)(h))||h instanceof Ld?Xy(this._dataReader,"Transaction.update",D._key,h,v,T):Zy(this._dataReader,"Transaction.update",D._key,h),this._transaction.update(D._key,X),this}delete(i){const h=pp(i,this._firestore);return this._transaction.delete(h._key),this}}{constructor(e,i){super(e,i),this._firestore=e}get(e){const i=pp(e,this._firestore),h=new Rf(this._firestore);return super.get(e).then(v=>new fp(this._firestore,h,i._key,v._document,new hp(!1,!1),i.converter))}}function p0(u,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Un("invalid-argument",`Invalid options passed to function ${u}(): You cannot specify both "merge" and "mergeFields".`);return e}function m0(){if(typeof Uint8Array>"u")throw new Un("unimplemented","Uint8Arrays are not available in this environment.")}function Jx(){if(!function xo(){return typeof atob<"u"}())throw new Un("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(e,i=!0){Oi=on.SDK_VERSION,(0,on._registerComponent)(new Or.uA("firestore",(h,{instanceIdentifier:v,options:T})=>{const D=h.getProvider("app").getImmediate(),X=new qs(new bc(h.getProvider("auth-internal")),new _d(h.getProvider("app-check-internal")),function(_e,ze){if(!Object.prototype.hasOwnProperty.apply(_e.options,["projectId"]))throw new Un(xn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mo(_e.options.projectId,ze)}(D,v),D);return T=Object.assign({useFetchStreams:i},T),X._setSettings(T),X},"PUBLIC").setMultipleInstances(!0)),(0,on.registerVersion)(hl,"4.5.0",e),(0,on.registerVersion)(hl,"4.5.0","esm2017")}();class o_{constructor(e){this._delegate=e}static fromBase64String(e){return Jx(),new o_(Qc.fromBase64String(e))}static fromUint8Array(e){return m0(),new o_(Qc.fromUint8Array(e))}toBase64(){return Jx(),this._delegate.toBase64()}toUint8Array(){return m0(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function rx(u){return function eE(u,e){if("object"!=typeof u||null===u)return!1;const i=u;for(const h of e)if(h in i&&"function"==typeof i[h])return!0;return!1}(u,["next","error","complete"])}class ix{enableIndexedDbPersistence(e,i){return function mc(u,e){K_(u=yi(u,qs));const i=Ks(u);if(i._uninitializedComponentsProvider)throw new Un(xn.FAILED_PRECONDITION,"SDK cache is already specified.");As("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const h=u._freezeSettings(),v=new t;return im(i,v,new Jg(v,h.cacheSizeBytes,e?.forceOwnership))}(e._delegate,{forceOwnership:i})}enableMultiTabIndexedDbPersistence(e){return function gd(u){K_(u=yi(u,qs));const e=Ks(u);if(e._uninitializedComponentsProvider)throw new Un(xn.FAILED_PRECONDITION,"SDK cache is already specified.");As("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const i=u._freezeSettings(),h=new t;return im(e,h,new o(h,i.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function jm(u){if(u._initialized&&!u._terminated)throw new Un(xn.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ao;return u._queue.enqueueAndForgetEvenWhileRestricted((0,Ot.A)(function*(){try{yield(i=(0,Ot.A)(function*(v){if(!mt.D())return Promise.resolve();const T=v+"main";yield mt.delete(T)}),function h(v){return i.apply(this,arguments)})(Mm(u._databaseId,u._persistenceKey)),e.resolve()}catch(i){e.reject(i)}var i})),e.promise}(e._delegate)}}class g0{constructor(e,i,h){this._delegate=i,this._persistenceProvider=h,this.INTERNAL={delete:()=>this.terminate()},e instanceof mo||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const i=this._delegate._getSettings();!e.merge&&i.host!==e.host&&As("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},i),e)).merge,this._delegate._setSettings(e)}useEmulator(e,i,h={}){!function Go(u,e,i,h={}){var v;const T=(u=yi(u,Ys))._getSettings(),D=`${e}:${i}`;if("firestore.googleapis.com"!==T.host&&T.host!==D&&As("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),u._setSettings(Object.assign(Object.assign({},T),{host:D,ssl:!1})),h.mockUserToken){let X,te;if("string"==typeof h.mockUserToken)X=h.mockUserToken,te=Ss.MOCK_USER;else{X=(0,ur.Fy)(h.mockUserToken,null===(v=u._app)||void 0===v?void 0:v.options.projectId);const _e=h.mockUserToken.sub||h.mockUserToken.user_id;if(!_e)throw new Un(xn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");te=new Ss(_e)}u._authCredentials=new $c(new Cr(X,te))}}(this._delegate,e,i,h)}enableNetwork(){return function q_(u){return function pn(u){return u.asyncQueue.enqueue((0,Ot.A)(function*(){const e=yield _t(u),i=yield yt(u);return e.setNetworkEnabled(!0),function(v){const T=dr(v);return T.v_.delete(0),Rd(T)}(i)}))}(Ks(u=yi(u,qs)))}(this._delegate)}disableNetwork(){return function Gy(u){return function Fn(u){return u.asyncQueue.enqueue((0,Ot.A)(function*(){const e=yield _t(u),i=yield yt(u);return e.setNetworkEnabled(!1),(h=(0,Ot.A)(function*(T){const D=dr(T);D.v_.add(0),yield ud(D),D.x_.set("Offline")}),function v(T){return h.apply(this,arguments)})(i);var h}))}(Ks(u=yi(u,qs)))}(this._delegate)}enablePersistence(e){let i=!1,h=!1;return e&&(i=!!e.synchronizeTabs,h=!!e.experimentalForceOwningTab,Zi("synchronizeTabs",i,"experimentalForceOwningTab",h)),i?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,h)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Ph(u){return function(i){const h=new Ao;return i.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return function kd(u,e){return pd.apply(this,arguments)}(yield St(i),h)})),h.promise}(Ks(u=yi(u,qs)))}(this._delegate)}onSnapshotsInSync(e){return function uw(u,e){return function tr(u,e){const i=new f(e);return u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return v=yield kt(u),T=i,dr(v).W_.add(T),void T.next();var v,T})),()=>{i.Qa(),u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return v=yield kt(u),T=i,void dr(v).W_.delete(T);var v,T}))}}(Ks(u=yi(u,qs)),co(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new Un("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Wm(this,Oa(this._delegate,e))}catch(i){throw ed(i,"collection()","Firestore.collection()")}}doc(e){try{return new Jd(this,_o(this._delegate,e))}catch(i){throw ed(i,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new zu(this,function El(u,e){if(u=yi(u,Ys),di("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Un(xn.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ms(u,null,(h=e,new id(Z.emptyPath(),h)));var h}(this._delegate,e))}catch(i){throw ed(i,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function _w(u,e,i){u=yi(u,qs);const h=Object.assign(Object.assign({},mw),i);return function(T){if(T.maxAttempts<1)throw new Un(xn.INVALID_ARGUMENT,"Max attempts must be at least 1")}(h),function(T,D,X){const te=new Ao;return T.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){const _e=yield function Ft(u){return Se(u).then(e=>e.datastore)}(T);new b(T.asyncQueue,_e,X,D,te).Ya()})),te.promise}(Ks(u),v=>e(new gw(u,v)),h)}(this._delegate,i=>e(new oy(this,i)))}batch(){return Ks(this._delegate),new sx(new h0(this._delegate,e=>i_(this._delegate,e)))}loadBundle(e){return function Hy(u,e){const i=Ks(u=yi(u,qs)),h=new sl;return function cr(u,e,i,h){const v=function(D,X){let te;return te="string"==typeof D?Nc().encode(D):D,ze=function(ze,vt){if(ze instanceof Uint8Array)return l(ze,void 0);if(ze instanceof ArrayBuffer)return l(new Uint8Array(ze),void 0);if(ze instanceof ReadableStream)return ze.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(te),new _(ze,X);var ze}(i,bg(e));u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){!function zm(u,e,i){const h=dr(u);var v;(v=(0,Ot.A)(function*(D,X,te){try{const _e=yield X.getMetadata();if(yield function(yr,Ir){const xr=dr(yr),hi=vl(Ir.createTime);return xr.persistence.runTransaction("hasNewerBundle","readonly",Xi=>xr.$r.getBundleMetadata(Xi,Ir.id)).then(Xi=>!!Xi&&Xi.createTime.compareTo(hi)>=0)}(D.localStore,_e))return yield X.close(),te._completeWith({taskState:"Success",documentsLoaded:(yr=_e).totalDocuments,bytesLoaded:yr.totalBytes,totalDocuments:yr.totalDocuments,totalBytes:yr.totalBytes}),Promise.resolve(new Set);te._updateProgress(Bm(_e));const ze=new Lg(_e,D.localStore,X.serializer);let vt=yield X.Ba();for(;vt;){const un=yield ze.sa(vt);un&&te._updateProgress(un),vt=yield X.Ba()}const Xt=yield ze.complete();return yield md(D,Xt.aa,void 0),yield function(yr,Ir){const xr=dr(yr);return xr.persistence.runTransaction("Save bundle","readwrite",hi=>xr.$r.saveBundleMetadata(hi,Ir))}(D.localStore,_e),te._completeWith(Xt.progress),Promise.resolve(Xt._a)}catch(_e){return As("SyncEngine",`Loading bundle failed with ${_e}`),te._failWith(_e),Promise.resolve(new Set)}var yr}),function T(D,X,te){return v.apply(this,arguments)})(h,e,i).then(v=>{h.sharedClientState.notifyBundleLoaded(v)})}(yield St(u),v,h)}))}(i,u._databaseId,e,h),h}(this._delegate,e)}namedQuery(e){return function $m(u,e){return function Pn(u,e){return u.asyncQueue.enqueue((0,Ot.A)(function*(){return function(h,v){const T=dr(h);return T.persistence.runTransaction("Get named query","readonly",D=>T.$r.getNamedQuery(D,v))}(yield At(u),e)}))}(Ks(u=yi(u,qs)),e).then(i=>i?new ms(u,null,i.query):null)}(this._delegate,e).then(i=>i?new zu(this,i):null)}}class cv extends nv{constructor(e){super(),this.firestore=e}convertBytes(e){return new o_(new Qc(e))}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return Jd.forKey(i,this.firestore,null)}}class oy{constructor(e,i){this._firestore=e,this._delegate=i,this._userDataWriter=new cv(e)}get(e){const i=cm(e);return this._delegate.get(i).then(h=>new ay(this._firestore,new fp(this._firestore._delegate,this._userDataWriter,h._key,h._document,h.metadata,i.converter)))}set(e,i,h){const v=cm(e);return h?(p0("Transaction.set",h),this._delegate.set(v,i,h)):this._delegate.set(v,i),this}update(e,i,h,...v){const T=cm(e);return 2===arguments.length?this._delegate.update(T,i):this._delegate.update(T,i,h,...v),this}delete(e){const i=cm(e);return this._delegate.delete(i),this}}class sx{constructor(e){this._delegate=e}set(e,i,h){const v=cm(e);return h?(p0("WriteBatch.set",h),this._delegate.set(v,i,h)):this._delegate.set(v,i),this}update(e,i,h,...v){const T=cm(e);return 2===arguments.length?this._delegate.update(T,i):this._delegate.update(T,i,h,...v),this}delete(e){const i=cm(e);return this._delegate.delete(i),this}commit(){return this._delegate.commit()}}class Hm{constructor(e,i,h){this._firestore=e,this._userDataWriter=i,this._delegate=h}fromFirestore(e,i){const h=new sy(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new a_(this._firestore,h),i??{})}toFirestore(e,i){return i?this._delegate.toFirestore(e,i):this._delegate.toFirestore(e)}static getInstance(e,i){const h=Hm.INSTANCES;let v=h.get(e);v||(v=new WeakMap,h.set(e,v));let T=v.get(i);return T||(T=new Hm(e,new cv(e),i),v.set(i,T)),T}}Hm.INSTANCES=new WeakMap;class Jd{constructor(e,i){this.firestore=e,this._delegate=i,this._userDataWriter=new cv(e)}static forPath(e,i,h){if(e.length%2!=0)throw new Un("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Jd(i,new Vi(i._delegate,h,new a(e)))}static forKey(e,i,h){return new Jd(i,new Vi(i._delegate,h,e))}get id(){return this._delegate.id}get parent(){return new Wm(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Wm(this.firestore,Oa(this._delegate,e))}catch(i){throw ed(i,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ur.Ku)(e))instanceof Vi&&wl(this._delegate,e)}set(e,i){i=p0("DocumentReference.set",i);try{return i?q0(this._delegate,e,i):q0(this._delegate,e)}catch(h){throw ed(h,"setDoc()","DocumentReference.set()")}}update(e,i,...h){try{return 1===arguments.length?iv(this._delegate,e):iv(this._delegate,e,i,...h)}catch(v){throw ed(v,"updateDoc()","DocumentReference.update()")}}delete(){return function K0(u){return i_(yi(u.firestore,qs),[new S(u._key,Co.none())])}(this._delegate)}onSnapshot(...e){const i=ox(e),h=ax(e,v=>new ay(this.firestore,new fp(this.firestore._delegate,this._userDataWriter,v._key,v._document,v.metadata,this._delegate.converter)));return Zx(this._delegate,i,h)}get(e){let i;return i="cache"===e?.source?function $0(u){u=yi(u,Vi);const e=yi(u.firestore,qs),i=Ks(e),h=new Rf(e);return function or(u,e){const i=new Ao;return u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return(h=(0,Ot.A)(function*(T,D,X){try{const te=yield function(ze,vt){const Xt=dr(ze);return Xt.persistence.runTransaction("read document","readonly",un=>Xt.localDocuments.getDocument(un,vt))}(T,D);te.isFoundDocument()?X.resolve(te):te.isNoDocument()?X.resolve(null):X.reject(new Un(xn.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(te){const _e=If(te,`Failed to get document '${D} from cache`);X.reject(_e)}}),function v(T,D,X){return h.apply(this,arguments)})(yield At(u),e,i);var h})),i.promise}(i,u._key).then(v=>new fp(e,h,u._key,v,new hp(null!==v&&v.hasLocalMutations,!0),u.converter))}(this._delegate):"server"===e?.source?function G0(u){u=yi(u,Vi);const e=yi(u.firestore,qs);return En(Ks(e),u._key,{source:"server"}).then(i=>sv(e,u,i))}(this._delegate):function u0(u){u=yi(u,Vi);const e=yi(u.firestore,qs);return En(Ks(e),u._key).then(i=>sv(e,u,i))}(this._delegate),i.then(h=>new ay(this.firestore,new fp(this.firestore._delegate,this._userDataWriter,h._key,h._document,h.metadata,this._delegate.converter)))}withConverter(e){return new Jd(this.firestore,this._delegate.withConverter(e?Hm.getInstance(this.firestore,e):null))}}function ed(u,e,i){return u.message=u.message.replace(e,i),u}function ox(u){for(const e of u)if("object"==typeof e&&!rx(e))return e;return{}}function ax(u,e){var i,h;let v;return v=rx(u[0])?u[0]:rx(u[1])?u[1]:"function"==typeof u[0]?{next:u[0],error:u[1],complete:u[2]}:{next:u[1],error:u[2],complete:u[3]},{next:T=>{v.next&&v.next(e(T))},error:null===(i=v.error)||void 0===i?void 0:i.bind(v),complete:null===(h=v.complete)||void 0===h?void 0:h.bind(v)}}class ay{constructor(e,i){this._firestore=e,this._delegate=i}get ref(){return new Jd(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,i){return this._delegate.get(e,i)}isEqual(e){return c0(this._delegate,e._delegate)}}class a_ extends ay{data(e){const i=this._delegate.data(e);return this._delegate._converter||function $u(u,e){u||pr()}(void 0!==i),i}}class zu{constructor(e,i){this.firestore=e,this._delegate=i,this._userDataWriter=new cv(e)}where(e,i,h){try{return new zu(this.firestore,am(this._delegate,function ry(u,e,i){const h=e,v=t0("where",u);return ny._create(v,h,i)}(e,i,h)))}catch(v){throw ed(v,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,i){try{return new zu(this.firestore,am(this._delegate,function Ux(u,e="asc"){const i=e,h=t0("orderBy",u);return n0._create(h,i)}(e,i)))}catch(h){throw ed(h,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new zu(this.firestore,am(this._delegate,function zx(u){return cs("limit",u),ev._create("limit",u,"F")}(e)))}catch(i){throw ed(i,"limit()","Query.limit()")}}limitToLast(e){try{return new zu(this.firestore,am(this._delegate,function jx(u){return cs("limitToLast",u),ev._create("limitToLast",u,"L")}(e)))}catch(i){throw ed(i,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new zu(this.firestore,am(this._delegate,function $x(...u){return Gm._create("startAt",u,!0)}(...e)))}catch(i){throw ed(i,"startAt()","Query.startAt()")}}startAfter(...e){try{return new zu(this.firestore,am(this._delegate,function Gx(...u){return Gm._create("startAfter",u,!1)}(...e)))}catch(i){throw ed(i,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new zu(this.firestore,am(this._delegate,function V0(...u){return iy._create("endBefore",u,!1)}(...e)))}catch(i){throw ed(i,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new zu(this.firestore,am(this._delegate,function r0(...u){return iy._create("endAt",u,!0)}(...e)))}catch(i){throw ed(i,"endAt()","Query.endAt()")}}isEqual(e){return ka(this._delegate,e._delegate)}get(e){let i;return i="cache"===e?.source?function Kx(u){u=yi(u,ms);const e=yi(u.firestore,qs),i=Ks(e),h=new Rf(e);return function $n(u,e){const i=new Ao;return u.asyncQueue.enqueueAndForget((0,Ot.A)(function*(){return(h=(0,Ot.A)(function*(T,D,X){try{const te=yield gg(T,D,!0),_e=new $_(D,te.hs),ze=_e.Ta(te.documents),vt=_e.applyChanges(ze,!1);X.resolve(vt.snapshot)}catch(te){const _e=If(te,`Failed to execute query '${D} against cache`);X.reject(_e)}}),function v(T,D,X){return h.apply(this,arguments)})(yield At(u),e,i);var h})),i.promise}(i,u._query).then(v=>new lm(e,h,u,v))}(this._delegate):"server"===e?.source?function W0(u){u=yi(u,ms);const e=yi(u.firestore,qs),i=Ks(e),h=new Rf(e);return jn(i,u._query,{source:"server"}).then(v=>new lm(e,h,u,v))}(this._delegate):function H0(u){u=yi(u,ms);const e=yi(u.firestore,qs),i=Ks(e),h=new Rf(e);return ty(u._query),jn(i,u._query).then(v=>new lm(e,h,u,v))}(this._delegate),i.then(h=>new lx(this.firestore,new lm(this.firestore._delegate,this._userDataWriter,this._delegate,h._snapshot)))}onSnapshot(...e){const i=ox(e),h=ax(e,v=>new lx(this.firestore,new lm(this.firestore._delegate,this._userDataWriter,this._delegate,v._snapshot)));return Zx(this._delegate,i,h)}withConverter(e){return new zu(this.firestore,this._delegate.withConverter(e?Hm.getInstance(this.firestore,e):null))}}class nE{constructor(e,i){this._firestore=e,this._delegate=i}get type(){return this._delegate.type}get doc(){return new a_(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class lx{constructor(e,i){this._firestore=e,this._delegate=i}get query(){return new zu(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new a_(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(i=>new nE(this._firestore,i))}forEach(e,i){this._delegate.forEach(h=>{e.call(i,new a_(this._firestore,h))})}isEqual(e){return c0(this._delegate,e._delegate)}}class Wm extends zu{constructor(e,i){super(e,i),this.firestore=e,this._delegate=i}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Jd(this.firestore,e):null}doc(e){try{return new Jd(this.firestore,void 0===e?_o(this._delegate):_o(this._delegate,e))}catch(i){throw ed(i,"doc()","CollectionReference.doc()")}}add(e){return function Z0(u,e){const i=yi(u.firestore,qs),h=_o(u),v=rv(u.converter,e);return i_(i,[Wy(Uu(u.firestore),"addDoc",h._key,v,null!==u.converter,{}).toMutation(h._key,Co.exists(!1))]).then(()=>h)}(this._delegate,e).then(i=>new Jd(this.firestore,i))}isEqual(e){return wl(this._delegate,e._delegate)}withConverter(e){return new Wm(this.firestore,this._delegate.withConverter(e?Hm.getInstance(this.firestore,e):null))}}function cm(u){return yi(u,Vi)}class mp{constructor(...e){this._delegate=new Ld(...e)}static documentId(){return new mp(n.keyField().canonicalString())}isEqual(e){return(e=(0,ur.Ku)(e))instanceof Ld&&this._delegate._internalPath.isEqual(e._internalPath)}}class um{constructor(e){this._delegate=e}static serverTimestamp(){const e=function vw(){return new qy("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new um(e)}static delete(){const e=function yw(){return new Q_("deleteField")}();return e._methodName="FieldValue.delete",new um(e)}static arrayUnion(...e){const i=function xw(...u){return new Y_("arrayUnion",u)}(...e);return i._methodName="FieldValue.arrayUnion",new um(i)}static arrayRemove(...e){const i=function Ew(...u){return new Jv("arrayRemove",u)}(...e);return i._methodName="FieldValue.arrayRemove",new um(i)}static increment(e){const i=function ww(u){return new Ky("increment",u)}(e);return i._methodName="FieldValue.increment",new um(i)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const rE={Firestore:g0,GeoPoint:sm,Timestamp:Oo,Blob:o_,Transaction:oy,WriteBatch:sx,DocumentReference:Jd,DocumentSnapshot:ay,Query:zu,QueryDocumentSnapshot:a_,QuerySnapshot:lx,CollectionReference:Wm,FieldPath:mp,FieldValue:um,setLogLevel:function tE(u){!function vo(u){cc.setLogLevel(u)}(u)},CACHE_SIZE_UNLIMITED:-1};function cx(u,e){return function y0(u,e=Tt.E){return new Ve.c(i=>{let h;return null!=e?e.schedule(()=>{h=u.onSnapshot({includeMetadataChanges:!0},i)}):h=u.onSnapshot({includeMetadataChanges:!0},i),()=>{h?.()}})}(u,e)}function ly(u,e){return cx(u,e).pipe((0,qe.T)(i=>({payload:i,type:"query"})))}!function _0(u){(function Iw(u,e){u.INTERNAL.registerComponent(new Or.uA("firestore-compat",i=>{const h=i.getProvider("app-compat").getImmediate(),v=i.getProvider("firestore").getImmediate();return e(h,v)},"PUBLIC").setServiceProps(Object.assign({},rE)))})(u,(e,i)=>new g0(e,i,new ix)),u.registerVersion("@firebase/firestore-compat","0.3.27")}(Fr.A);class dx{ref;afs;constructor(e,i){this.ref=e,this.afs=i}set(e,i){return this.ref.set(e,i)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,i){const h=this.ref.collection(e),{ref:v,query:T}=Oh(h,i);return new sE(v,T,this.afs)}snapshotChanges(){return function ux(u,e){return cx(u,e).pipe((0,$t.Z)(void 0),sn(),(0,qe.T)(i=>{const[h,v]=i;return v.exists?h?.exists?{payload:v,type:"modified"}:{payload:v,type:"added"}:{payload:v,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ye.U0)}valueChanges(e={}){return this.snapshotChanges().pipe((0,qe.T)(({payload:i})=>e.idField?{...i.data(),[e.idField]:i.id}:i.data()))}get(e){return(0,xe.H)(this.ref.get(e)).pipe(ye.U0)}}function qm(u,e){return ly(u,e).pipe((0,$t.Z)(void 0),sn(),(0,qe.T)(i=>{const[h,v]=i,T=v.payload.docChanges(),D=T.map(X=>({type:X.type,payload:X}));return h&&JSON.stringify(h.payload.metadata)!==JSON.stringify(v.payload.metadata)&&v.payload.docs.forEach((X,te)=>{const _e=T.find(vt=>vt.doc.ref.isEqual(X.ref)),ze=h?.payload.docs.find(vt=>vt.ref.isEqual(X.ref));_e&&JSON.stringify(_e.doc.metadata)===JSON.stringify(X.metadata)||!_e&&ze&&JSON.stringify(ze.metadata)===JSON.stringify(X.metadata)||D.push({type:"modified",payload:{oldIndex:te,newIndex:te,type:"modified",doc:X}})}),D}))}function iE(u,e,i){return qm(u,i).pipe((0,mn.S)((h,v)=>function Sw(u,e,i){return e.forEach(h=>{i.indexOf(h.type)>-1&&(u=function Aw(u,e){switch(e.type){case"added":if(!u[e.newIndex]||!u[e.newIndex].doc.ref.isEqual(e.doc.ref))return v0(u,e.newIndex,0,e);break;case"modified":if(null==u[e.oldIndex]||u[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const i=u.slice();return i.splice(e.oldIndex,1),i.splice(e.newIndex,0,e),i}return v0(u,e.newIndex,1,e)}break;case"removed":if(u[e.oldIndex]&&u[e.oldIndex].doc.ref.isEqual(e.doc.ref))return v0(u,e.oldIndex,1)}return u}(u,h))}),u}(h,v.map(T=>T.payload),e),[]),(0,Vn.F)(),(0,qe.T)(h=>h.map(v=>({type:v.type,payload:v}))))}function v0(u,e,i,...h){const v=u.slice();return v.splice(e,i,...h),v}function Km(u){return(!u||0===u.length)&&(u=["added","removed","modified"]),u}class sE{ref;query;afs;constructor(e,i,h){this.ref=e,this.query=i,this.afs=h}stateChanges(e){let i=qm(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(i=i.pipe((0,qe.T)(h=>h.filter(v=>e.indexOf(v.type)>-1)))),i.pipe((0,$t.Z)(void 0),sn(),(0,Ze.p)(([h,v])=>v.length>0||!h),(0,qe.T)(([,h])=>h),ye.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,mn.S)((i,h)=>[...i,...h],[]))}snapshotChanges(e){const i=Km(e);return iE(this.query,i,this.afs.schedulers.outsideAngular).pipe(ye.U0)}valueChanges(e={}){return ly(this.query,this.afs.schedulers.outsideAngular).pipe((0,qe.T)(i=>i.payload.docs.map(h=>e.idField?{...h.data(),[e.idField]:h.id}:h.data())),ye.U0)}get(e){return(0,xe.H)(this.query.get(e)).pipe(ye.U0)}add(e){return this.ref.add(e)}doc(e){return new dx(this.ref.doc(e),this.afs)}}class uv{query;afs;constructor(e,i){this.query=e,this.afs=i}stateChanges(e){return e&&0!==e.length?qm(this.query,this.afs.schedulers.outsideAngular).pipe((0,qe.T)(i=>i.filter(h=>e.indexOf(h.type)>-1)),(0,Ze.p)(i=>i.length>0),ye.U0):qm(this.query,this.afs.schedulers.outsideAngular).pipe(ye.U0)}auditTrail(e){return this.stateChanges(e).pipe((0,mn.S)((i,h)=>[...i,...h],[]))}snapshotChanges(e){const i=Km(e);return iE(this.query,i,this.afs.schedulers.outsideAngular).pipe(ye.U0)}valueChanges(e={}){return ly(this.query,this.afs.schedulers.outsideAngular).pipe((0,qe.T)(h=>h.payload.docs.map(v=>e.idField?{[e.idField]:v.id,...v.data()}:v.data())),ye.U0)}get(e){return(0,xe.H)(this.query.get(e)).pipe(ye.U0)}}const hx=new z.nKC("angularfire2.enableFirestorePersistence"),fx=new z.nKC("angularfire2.firestore.persistenceSettings"),x0=new z.nKC("angularfire2.firestore.settings"),oE=new z.nKC("angularfire2.firestore.use-emulator");function Oh(u,e=(i=>i)){return{query:e(u),ref:u}}let l_=(()=>{class u{schedulers;firestore;persistenceEnabled$;constructor(i,h,v,T,D,X,te,_e,ze,vt,Xt,un,yr,Ir,xr,hi,Xi){this.schedulers=te;const ni=(0,m.iB)(i,X,h),Ji=ze;vt&&Ct(ni,X,Xt,yr,Ir,xr,un,hi),[this.firestore,this.persistenceEnabled$]=(0,m.BM)(`${ni.name}.firestore`,"AngularFirestore",ni.name,()=>{const Js=X.runOutsideAngular(()=>ni.firestore());if(T&&Js.settings(T),Ji&&Js.useEmulator(...Ji),v&&!(0,O.Vy)(D)){const Ho=()=>{try{return(0,xe.H)(Js.enablePersistence(_e||void 0).then(()=>!0,()=>!1))}catch(ec){return typeof console<"u"&&console.warn(ec),(0,Be.of)(!1)}};return[Js,X.runOutsideAngular(Ho)]}return[Js,(0,Be.of)(!1)]},[T,Ji,v])}collection(i,h){let v;v="string"==typeof i?this.firestore.collection(i):i;const{ref:T,query:D}=Oh(v,h),X=this.schedulers.ngZone.run(()=>T);return new sE(X,D,this)}collectionGroup(i,h){const v=h||(D=>D),T=this.firestore.collectionGroup(i);return new uv(v(T),this)}doc(i){let h;h="string"==typeof i?this.firestore.doc(i):i;const v=this.schedulers.ngZone.run(()=>h);return new dx(v,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(h){return new(h||u)(z.KVO(m.rx),z.KVO(m.uP,8),z.KVO(hx,8),z.KVO(x0,8),z.KVO(z.Agw),z.KVO(z.SKi),z.KVO(ye.u0),z.KVO(fx,8),z.KVO(oE,8),z.KVO(Pt,8),z.KVO(nn,8),z.KVO(bn,8),z.KVO(Cn,8),z.KVO(qt,8),z.KVO(Ht,8),z.KVO(lt,8),z.KVO(ye.Jv,8))};static \u0275prov=z.jDH({token:u,factory:u.\u0275fac,providedIn:"any"})}return u})(),Dc=(()=>{class u{constructor(){it.A.registerVersion("angularfire",ye.xv.full,"fst-compat")}static enablePersistence(i){return{ngModule:u,providers:[{provide:hx,useValue:!0},{provide:fx,useValue:i}]}}static \u0275fac=function(h){return new(h||u)};static \u0275mod=z.$C({type:u});static \u0275inj=z.G2t({providers:[l_]})}return u})()},9253:(An,xt,H)=>{"use strict";H.d(xt,{BM:()=>Oe,Gt:()=>ae,bf:()=>qe,e7:()=>De,iB:()=>se,rx:()=>Ve,uP:()=>xe});var O=H(4438),z=H(574),ye=H(762);const m=["ngOnDestroy"],ae=(ct,Ue,nt,Xe={})=>new Proxy(ct,{get:(Le,Te)=>nt.runOutsideAngular(()=>{if(ct[Te])return Xe?.spy?.get&&Xe.spy.get(Te,ct[Te]),ct[Te];if(m.indexOf(Te)>-1)return()=>{};const at=Ue.toPromise().then(Ze=>{const it=Ze?.[Te];return"function"==typeof it?it.bind(Ze):it?.then?it.then(Ge=>nt.run(()=>Ge)):nt.run(()=>it)});return new Proxy(()=>{},{get:(Ze,it)=>at[it],apply:(Ze,it,Ge)=>at.then(nn=>{const bn=nn?.(...Ge);return Xe?.spy?.apply&&Xe.spy.apply(Te,Ge,bn),bn})})})}),De=(ct,Ue)=>{Ue.forEach(nt=>{Object.getOwnPropertyNames(nt.prototype||nt).forEach(Xe=>{Object.defineProperty(ct.prototype,Xe,Object.getOwnPropertyDescriptor(nt.prototype||nt,Xe))})})};class Be{constructor(Ue){return Ue}}const Ve=new O.nKC("angularfire2.app.options"),xe=new O.nKC("angularfire2.app.name");function se(ct,Ue,nt){const Le="object"==typeof nt&&nt||{};Le.name=Le.name||"string"==typeof nt&&nt||"[DEFAULT]";const at=ye.A.apps.filter(Ze=>Ze&&Ze.name===Le.name)[0]||Ue.runOutsideAngular(()=>ye.A.initializeApp(ct,Le));try{if(JSON.stringify(ct)!==JSON.stringify(at.options)){const Ze=!!module.hot;me("error",`${at.name} Firebase App already initialized with different options${Ze?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Be(at)}const me=(ct,...Ue)=>{(0,O.naY)()&&typeof console<"u"&&console[ct](...Ue)},He={provide:Be,useFactory:se,deps:[Ve,O.SKi,[new O.Xx1,xe]]};let qe=(()=>{class ct{static initializeApp(nt,Xe){return{ngModule:ct,providers:[{provide:Ve,useValue:nt},{provide:xe,useValue:Xe}]}}constructor(nt){ye.A.registerVersion("angularfire",z.xv.full,"core"),ye.A.registerVersion("angularfire",z.xv.full,"app-compat"),ye.A.registerVersion("angular",O.xvI.full,nt.toString())}static \u0275fac=function(Xe){return new(Xe||ct)(O.KVO(O.Agw))};static \u0275mod=O.$C({type:ct});static \u0275inj=O.G2t({providers:[He]})}return ct})();function Oe(ct,Ue,nt,Xe,Le){const[,Te,at]=globalThis.\u0275AngularfireInstanceCache.find(Ze=>Ze[0]===ct)||[];if(Te)return function je(ct,Ue){try{return ct.toString()===Ue.toString()}catch{return ct===Ue}}(Le,at)||(et("error",`${Ue} was already initialized on the ${nt} Firebase App with different settings.${ht?" You may need to reload as Firebase is not HMR aware.":""}`),et("warn",{is:Le,was:at})),Te;{const Ze=Xe();return globalThis.\u0275AngularfireInstanceCache.push([ct,Ze,Le]),Ze}}const ht=typeof module<"u"&&!!module.hot,et=(ct,...Ue)=>{(0,O.naY)()&&typeof console<"u"&&console[ct](...Ue)};globalThis.\u0275AngularfireInstanceCache||=[]},574:(An,xt,H)=>{"use strict";H.d(xt,{xv:()=>je,U0:()=>Cn,u0:()=>at,Jv:()=>Ue});var O=H(4438),z=H(2979);(0,z.registerVersion)("firebase","10.9.0","app");var ae=H(6780),Be=H(9687);const xe=new class Ve extends Be.q{}(class De extends ae.R{constructor(Pt,Qe){super(Pt,Qe),this.scheduler=Pt,this.work=Qe}schedule(Pt,Qe=0){return Qe>0?super.schedule(Pt,Qe):(this.delay=Qe,this.state=Pt,this.scheduler.flush(this),this)}execute(Pt,Qe){return Qe>0||this.closed?super.execute(Pt,Qe):this._execute(Pt,Qe)}requestAsyncId(Pt,Qe,Tt=0){return null!=Tt&&Tt>0||null==Tt&&this.delay>0?super.requestAsyncId(Pt,Qe,Tt):(Pt.flush(this),0)}});var me=H(3236),He=H(8141),qe=H(6745),Oe=H(941);const je=new O.RxE("ANGULARFIRE2_VERSION");class Ue{constructor(){return((Ct,Pt)=>{const Qe=(0,z.getApps)(),Tt=[];return Qe.forEach($t=>{$t.container.getProvider(Ct).instances.forEach(sn=>{Tt.includes(sn)||Tt.push(sn)})}),Tt})(nt)}}const nt="app-check";function Xe(){}class Le{zone;delegate;constructor(Pt,Qe=xe){this.zone=Pt,this.delegate=Qe}now(){return this.delegate.now()}schedule(Pt,Qe,Tt){const $t=this.zone;return this.delegate.schedule(function(sn){$t.runGuarded(()=>{Pt.apply(this,[sn])})},Qe,Tt)}}class Te{zone;task=null;constructor(Pt){this.zone=Pt}call(Pt,Qe){const Tt=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Xe,{},Xe,Xe)),Qe.pipe((0,He.M)({next:Tt,complete:Tt,error:Tt})).subscribe(Pt).add(Tt)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}let at=(()=>{class Ct{ngZone;outsideAngular;insideAngular;constructor(Qe){this.ngZone=Qe,this.outsideAngular=Qe.runOutsideAngular(()=>new Le(Zone.current)),this.insideAngular=Qe.run(()=>new Le(Zone.current,me.E)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(Tt){return new(Tt||Ct)(O.KVO(O.SKi))};static \u0275prov=O.jDH({token:Ct,factory:Ct.\u0275fac,providedIn:"root"})}return Ct})();function Cn(Ct){return function qt(Ct){return function(Qe){return(Qe=Qe.lift(new Te(Ct.ngZone))).pipe((0,qe._)(Ct.outsideAngular),(0,Oe.Q)(Ct.insideAngular))}}(function Ze(){const Ct=globalThis.\u0275AngularFireScheduler;if(!Ct)throw new Error("Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using\nprovideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).");return Ct}())(Ct)}},9574:(An,xt,H)=>{"use strict";H.d(xt,{A:()=>je});var O=H(1401),z=H(8779),ye=H(2979),m=H(8041);class ae{constructor(et,ct){this._delegate=et,this.firebase=ct,(0,ye._addComponent)(et,new z.uA("app-compat",()=>this,"PUBLIC")),this.container=et.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(et){this._delegate.automaticDataCollectionEnabled=et}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(et=>{this._delegate.checkDestroyed(),et()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,ye.deleteApp)(this._delegate)))}_getService(et,ct=ye._DEFAULT_ENTRY_NAME){var Ue;this._delegate.checkDestroyed();const nt=this._delegate.container.getProvider(et);return!nt.isInitialized()&&"EXPLICIT"===(null===(Ue=nt.getComponent())||void 0===Ue?void 0:Ue.instantiationMode)&&nt.initialize(),nt.getImmediate({identifier:ct})}_removeServiceInstance(et,ct=ye._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(et).clearInstance(ct)}_addComponent(et){(0,ye._addComponent)(this._delegate,et)}_addOrOverwriteComponent(et){(0,ye._addOrOverwriteComponent)(this._delegate,et)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Be=new O.FA("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),se=function xe(){const ht=function Ve(ht){const et={},ct={__esModule:!0,initializeApp:function Xe(Ze,it={}){const Ge=ye.initializeApp(Ze,it);if((0,O.gR)(et,Ge.name))return et[Ge.name];const nn=new ht(Ge,ct);return et[Ge.name]=nn,nn},app:nt,registerVersion:ye.registerVersion,setLogLevel:ye.setLogLevel,onLog:ye.onLog,apps:null,SDK_VERSION:ye.SDK_VERSION,INTERNAL:{registerComponent:function Te(Ze){const it=Ze.name,Ge=it.replace("-compat","");if(ye._registerComponent(Ze)&&"PUBLIC"===Ze.type){const nn=(bn=nt())=>{if("function"!=typeof bn[Ge])throw Be.create("invalid-app-argument",{appName:it});return bn[Ge]()};void 0!==Ze.serviceProps&&(0,O.zw)(nn,Ze.serviceProps),ct[Ge]=nn,ht.prototype[Ge]=function(...bn){return this._getService.bind(this,it).apply(this,Ze.multipleInstances?bn:[])}}return"PUBLIC"===Ze.type?ct[Ge]:null},removeApp:function Ue(Ze){delete et[Ze]},useAsService:function at(Ze,it){return"serverAuth"===it?null:it},modularAPIs:ye}};function nt(Ze){if(!(0,O.gR)(et,Ze=Ze||ye._DEFAULT_ENTRY_NAME))throw Be.create("no-app",{appName:Ze});return et[Ze]}return ct.default=ct,Object.defineProperty(ct,"apps",{get:function Le(){return Object.keys(et).map(Ze=>et[Ze])}}),nt.App=ht,ct}(ae);return ht.INTERNAL=Object.assign(Object.assign({},ht.INTERNAL),{createFirebaseNamespace:xe,extendNamespace:function et(ct){(0,O.zw)(ht,ct)},createSubscribe:O.tD,ErrorFactory:O.FA,deepExtend:O.zw}),ht}(),me=new m.Vy("@firebase/app-compat");if((0,O.Bd)()&&void 0!==self.firebase){me.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const ht=self.firebase.SDK_VERSION;ht&&ht.indexOf("LITE")>=0&&me.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const je=se;!function Oe(ht){(0,ye.registerVersion)("@firebase/app-compat","0.2.29",ht)}()},2979:(An,xt,H)=>{"use strict";H.r(xt),H.d(xt,{FirebaseError:()=>m.g,SDK_VERSION:()=>ve,_DEFAULT_ENTRY_NAME:()=>Gt,_addComponent:()=>Mt,_addOrOverwriteComponent:()=>hn,_apps:()=>Ce,_clearComponents:()=>ci,_components:()=>pt,_getProvider:()=>vi,_registerComponent:()=>Ur,_removeServiceInstance:()=>$r,deleteApp:()=>ge,getApp:()=>Q,getApps:()=>oe,initializeApp:()=>re,onLog:()=>Re,registerVersion:()=>$e,setLogLevel:()=>Ie});var O=H(467),z=H(8779),ye=H(8041),m=H(1401);const ae=(In,Jt)=>Jt.some(Sn=>In instanceof Sn);let De,Be;const se=new WeakMap,me=new WeakMap,He=new WeakMap,qe=new WeakMap,Oe=new WeakMap;let et={get(In,Jt,Sn){if(In instanceof IDBTransaction){if("done"===Jt)return me.get(In);if("objectStoreNames"===Jt)return In.objectStoreNames||He.get(In);if("store"===Jt)return Sn.objectStoreNames[1]?void 0:Sn.objectStore(Sn.objectStoreNames[0])}return Xe(In[Jt])},set:(In,Jt,Sn)=>(In[Jt]=Sn,!0),has:(In,Jt)=>In instanceof IDBTransaction&&("done"===Jt||"store"===Jt)||Jt in In};function nt(In){return"function"==typeof In?function Ue(In){return In!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function xe(){return Be||(Be=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(In)?function(...Jt){return In.apply(Le(this),Jt),Xe(se.get(this))}:function(...Jt){return Xe(In.apply(Le(this),Jt))}:function(Jt,...Sn){const Gr=In.call(Le(this),Jt,...Sn);return He.set(Gr,Jt.sort?Jt.sort():[Jt]),Xe(Gr)}}(In):(In instanceof IDBTransaction&&function ht(In){if(me.has(In))return;const Jt=new Promise((Sn,Gr)=>{const gi=()=>{In.removeEventListener("complete",Ii),In.removeEventListener("error",ki),In.removeEventListener("abort",ki)},Ii=()=>{Sn(),gi()},ki=()=>{Gr(In.error||new DOMException("AbortError","AbortError")),gi()};In.addEventListener("complete",Ii),In.addEventListener("error",ki),In.addEventListener("abort",ki)});me.set(In,Jt)}(In),ae(In,function Ve(){return De||(De=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(In,et):In)}function Xe(In){if(In instanceof IDBRequest)return function je(In){const Jt=new Promise((Sn,Gr)=>{const gi=()=>{In.removeEventListener("success",Ii),In.removeEventListener("error",ki)},Ii=()=>{Sn(Xe(In.result)),gi()},ki=()=>{Gr(In.error),gi()};In.addEventListener("success",Ii),In.addEventListener("error",ki)});return Jt.then(Sn=>{Sn instanceof IDBCursor&&se.set(Sn,In)}).catch(()=>{}),Oe.set(Jt,In),Jt}(In);if(qe.has(In))return qe.get(In);const Jt=nt(In);return Jt!==In&&(qe.set(In,Jt),Oe.set(Jt,In)),Jt}const Le=In=>Oe.get(In),Ze=["get","getKey","getAll","getAllKeys","count"],it=["put","add","delete","clear"],Ge=new Map;function nn(In,Jt){if(!(In instanceof IDBDatabase)||Jt in In||"string"!=typeof Jt)return;if(Ge.get(Jt))return Ge.get(Jt);const Sn=Jt.replace(/FromIndex$/,""),Gr=Jt!==Sn,gi=it.includes(Sn);if(!(Sn in(Gr?IDBIndex:IDBObjectStore).prototype)||!gi&&!Ze.includes(Sn))return;const Ii=function(){var ki=(0,O.A)(function*(ws,..._i){const ut=this.transaction(ws,gi?"readwrite":"readonly");let Dt=ut.store;return Gr&&(Dt=Dt.index(_i.shift())),(yield Promise.all([Dt[Sn](..._i),gi&&ut.done]))[0]});return function(_i){return ki.apply(this,arguments)}}();return Ge.set(Jt,Ii),Ii}!function ct(In){et=In(et)}(In=>({...In,get:(Jt,Sn,Gr)=>nn(Jt,Sn)||In.get(Jt,Sn,Gr),has:(Jt,Sn)=>!!nn(Jt,Sn)||In.has(Jt,Sn)}));class bn{constructor(Jt){this.container=Jt}getPlatformInfoString(){return this.container.getProviders().map(Sn=>{if(function Cn(In){const Jt=In.getComponent();return"VERSION"===Jt?.type}(Sn)){const Gr=Sn.getImmediate();return`${Gr.library}/${Gr.version}`}return null}).filter(Sn=>Sn).join(" ")}}const qt="@firebase/app",lt=new ye.Vy("@firebase/app"),Gt="[DEFAULT]",Bt={[qt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Ce=new Map,pt=new Map;function Mt(In,Jt){try{In.container.addComponent(Jt)}catch(Sn){lt.debug(`Component ${Jt.name} failed to register with FirebaseApp ${In.name}`,Sn)}}function hn(In,Jt){In.container.addOrOverwriteComponent(Jt)}function Ur(In){const Jt=In.name;if(pt.has(Jt))return lt.debug(`There were multiple attempts to register component ${Jt}.`),!1;pt.set(Jt,In);for(const Sn of Ce.values())Mt(Sn,In);return!0}function vi(In,Jt){const Sn=In.container.getProvider("heartbeat").getImmediate({optional:!0});return Sn&&Sn.triggerHeartbeat(),In.container.getProvider(Jt)}function $r(In,Jt,Sn=Gt){vi(In,Jt).clearInstance(Sn)}function ci(){pt.clear()}const Fs=new m.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Zt{constructor(Jt,Sn,Gr){this._isDeleted=!1,this._options=Object.assign({},Jt),this._config=Object.assign({},Sn),this._name=Sn.name,this._automaticDataCollectionEnabled=Sn.automaticDataCollectionEnabled,this._container=Gr,this.container.addComponent(new z.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(Jt){this.checkDestroyed(),this._automaticDataCollectionEnabled=Jt}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(Jt){this._isDeleted=Jt}checkDestroyed(){if(this.isDeleted)throw Fs.create("app-deleted",{appName:this._name})}}const ve="10.9.0";function re(In,Jt={}){let Sn=In;"object"!=typeof Jt&&(Jt={name:Jt});const Gr=Object.assign({name:Gt,automaticDataCollectionEnabled:!1},Jt),gi=Gr.name;if("string"!=typeof gi||!gi)throw Fs.create("bad-app-name",{appName:String(gi)});if(Sn||(Sn=(0,m.T9)()),!Sn)throw Fs.create("no-options");const Ii=Ce.get(gi);if(Ii){if((0,m.bD)(Sn,Ii.options)&&(0,m.bD)(Gr,Ii.config))return Ii;throw Fs.create("duplicate-app",{appName:gi})}const ki=new z.h1(gi);for(const _i of pt.values())ki.addComponent(_i);const ws=new Zt(Sn,Gr,ki);return Ce.set(gi,ws),ws}function Q(In=Gt){const Jt=Ce.get(In);if(!Jt&&In===Gt&&(0,m.T9)())return re();if(!Jt)throw Fs.create("no-app",{appName:In});return Jt}function oe(){return Array.from(Ce.values())}function ge(In){return Me.apply(this,arguments)}function Me(){return(Me=(0,O.A)(function*(In){const Jt=In.name;Ce.has(Jt)&&(Ce.delete(Jt),yield Promise.all(In.container.getProviders().map(Sn=>Sn.delete())),In.isDeleted=!0)})).apply(this,arguments)}function $e(In,Jt,Sn){var Gr;let gi=null!==(Gr=Bt[In])&&void 0!==Gr?Gr:In;Sn&&(gi+=`-${Sn}`);const Ii=gi.match(/\s|\//),ki=Jt.match(/\s|\//);if(Ii||ki){const ws=[`Unable to register library "${gi}" with version "${Jt}":`];return Ii&&ws.push(`library name "${gi}" contains illegal characters (whitespace or "/")`),Ii&&ki&&ws.push("and"),ki&&ws.push(`version name "${Jt}" contains illegal characters (whitespace or "/")`),void lt.warn(ws.join(" "))}Ur(new z.uA(`${gi}-version`,()=>({library:gi,version:Jt}),"VERSION"))}function Re(In,Jt){if(null!==In&&"function"!=typeof In)throw Fs.create("invalid-log-argument");(0,ye.Ey)(In,Jt)}function Ie(In){(0,ye.He)(In)}const we="firebase-heartbeat-database",Je=1,Ae="firebase-heartbeat-store";let Ne=null;function ft(){return Ne||(Ne=function Te(In,Jt,{blocked:Sn,upgrade:Gr,blocking:gi,terminated:Ii}={}){const ki=indexedDB.open(In,Jt),ws=Xe(ki);return Gr&&ki.addEventListener("upgradeneeded",_i=>{Gr(Xe(ki.result),_i.oldVersion,_i.newVersion,Xe(ki.transaction),_i)}),Sn&&ki.addEventListener("blocked",_i=>Sn(_i.oldVersion,_i.newVersion,_i)),ws.then(_i=>{Ii&&_i.addEventListener("close",()=>Ii()),gi&&_i.addEventListener("versionchange",ut=>gi(ut.oldVersion,ut.newVersion,ut))}).catch(()=>{}),ws}(we,Je,{upgrade:(In,Jt)=>{if(0===Jt)try{In.createObjectStore(Ae)}catch(Sn){console.warn(Sn)}}}).catch(In=>{throw Fs.create("idb-open",{originalErrorMessage:In.message})})),Ne}function Rt(){return(Rt=(0,O.A)(function*(In){try{const Sn=(yield ft()).transaction(Ae),Gr=yield Sn.objectStore(Ae).get(wr(In));return yield Sn.done,Gr}catch(Jt){if(Jt instanceof m.g)lt.warn(Jt.message);else{const Sn=Fs.create("idb-get",{originalErrorMessage:Jt?.message});lt.warn(Sn.message)}}})).apply(this,arguments)}function Mn(In,Jt){return ar.apply(this,arguments)}function ar(){return(ar=(0,O.A)(function*(In,Jt){try{const Gr=(yield ft()).transaction(Ae,"readwrite");yield Gr.objectStore(Ae).put(Jt,wr(In)),yield Gr.done}catch(Sn){if(Sn instanceof m.g)lt.warn(Sn.message);else{const Gr=Fs.create("idb-set",{originalErrorMessage:Sn?.message});lt.warn(Gr.message)}}})).apply(this,arguments)}function wr(In){return`${In.name}!${In.options.appId}`}class $i{constructor(Jt){this.container=Jt,this._heartbeatsCache=null;const Sn=this.container.getProvider("app").getImmediate();this._storage=new Bs(Sn),this._heartbeatsCachePromise=this._storage.read().then(Gr=>(this._heartbeatsCache=Gr,Gr))}triggerHeartbeat(){var Jt=this;return(0,O.A)(function*(){var Sn,Gr;const Ii=Jt.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),ki=Wr();if((null!=(null===(Sn=Jt._heartbeatsCache)||void 0===Sn?void 0:Sn.heartbeats)||(Jt._heartbeatsCache=yield Jt._heartbeatsCachePromise,null!=(null===(Gr=Jt._heartbeatsCache)||void 0===Gr?void 0:Gr.heartbeats)))&&Jt._heartbeatsCache.lastSentHeartbeatDate!==ki&&!Jt._heartbeatsCache.heartbeats.some(ws=>ws.date===ki))return Jt._heartbeatsCache.heartbeats.push({date:ki,agent:Ii}),Jt._heartbeatsCache.heartbeats=Jt._heartbeatsCache.heartbeats.filter(ws=>{const _i=new Date(ws.date).valueOf();return Date.now()-_i<=2592e6}),Jt._storage.overwrite(Jt._heartbeatsCache)})()}getHeartbeatsHeader(){var Jt=this;return(0,O.A)(function*(){var Sn;if(null===Jt._heartbeatsCache&&(yield Jt._heartbeatsCachePromise),null==(null===(Sn=Jt._heartbeatsCache)||void 0===Sn?void 0:Sn.heartbeats)||0===Jt._heartbeatsCache.heartbeats.length)return"";const Gr=Wr(),{heartbeatsToSend:gi,unsentEntries:Ii}=function _r(In,Jt=1024){const Sn=[];let Gr=In.slice();for(const gi of In){const Ii=Sn.find(ki=>ki.agent===gi.agent);if(Ii){if(Ii.dates.push(gi.date),ra(Sn)>Jt){Ii.dates.pop();break}}else if(Sn.push({agent:gi.agent,dates:[gi.date]}),ra(Sn)>Jt){Sn.pop();break}Gr=Gr.slice(1)}return{heartbeatsToSend:Sn,unsentEntries:Gr}}(Jt._heartbeatsCache.heartbeats),ki=(0,m.Uj)(JSON.stringify({version:2,heartbeats:gi}));return Jt._heartbeatsCache.lastSentHeartbeatDate=Gr,Ii.length>0?(Jt._heartbeatsCache.heartbeats=Ii,yield Jt._storage.overwrite(Jt._heartbeatsCache)):(Jt._heartbeatsCache.heartbeats=[],Jt._storage.overwrite(Jt._heartbeatsCache)),ki})()}}function Wr(){return(new Date).toISOString().substring(0,10)}class Bs{constructor(Jt){this.app=Jt,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,O.A)(function*(){return!!(0,m.zW)()&&(0,m.eX)().then(()=>!0).catch(()=>!1)})()}read(){var Jt=this;return(0,O.A)(function*(){if(yield Jt._canUseIndexedDBPromise){const Gr=yield function Vt(In){return Rt.apply(this,arguments)}(Jt.app);return Gr?.heartbeats?Gr:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(Jt){var Sn=this;return(0,O.A)(function*(){var Gr;if(yield Sn._canUseIndexedDBPromise){const Ii=yield Sn.read();return Mn(Sn.app,{lastSentHeartbeatDate:null!==(Gr=Jt.lastSentHeartbeatDate)&&void 0!==Gr?Gr:Ii.lastSentHeartbeatDate,heartbeats:Jt.heartbeats})}})()}add(Jt){var Sn=this;return(0,O.A)(function*(){var Gr;if(yield Sn._canUseIndexedDBPromise){const Ii=yield Sn.read();return Mn(Sn.app,{lastSentHeartbeatDate:null!==(Gr=Jt.lastSentHeartbeatDate)&&void 0!==Gr?Gr:Ii.lastSentHeartbeatDate,heartbeats:[...Ii.heartbeats,...Jt.heartbeats]})}})()}}function ra(In){return(0,m.Uj)(JSON.stringify({version:2,heartbeats:In})).length}!function wa(In){Ur(new z.uA("platform-logger",Jt=>new bn(Jt),"PRIVATE")),Ur(new z.uA("heartbeat",Jt=>new $i(Jt),"PRIVATE")),$e(qt,"0.9.29",In),$e(qt,"0.9.29","esm2017"),$e("fire-js","")}("")},8779:(An,xt,H)=>{"use strict";H.d(xt,{h1:()=>Ve,uA:()=>ye});var O=H(467),z=H(1401);class ye{constructor(se,me,He){this.name=se,this.instanceFactory=me,this.type=He,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(se){return this.instantiationMode=se,this}setMultipleInstances(se){return this.multipleInstances=se,this}setServiceProps(se){return this.serviceProps=se,this}setInstanceCreatedCallback(se){return this.onInstanceCreated=se,this}}const m="[DEFAULT]";class ae{constructor(se,me){this.name=se,this.container=me,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(se){const me=this.normalizeInstanceIdentifier(se);if(!this.instancesDeferred.has(me)){const He=new z.cY;if(this.instancesDeferred.set(me,He),this.isInitialized(me)||this.shouldAutoInitialize())try{const qe=this.getOrInitializeService({instanceIdentifier:me});qe&&He.resolve(qe)}catch{}}return this.instancesDeferred.get(me).promise}getImmediate(se){var me;const He=this.normalizeInstanceIdentifier(se?.identifier),qe=null!==(me=se?.optional)&&void 0!==me&&me;if(!this.isInitialized(He)&&!this.shouldAutoInitialize()){if(qe)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:He})}catch(Oe){if(qe)return null;throw Oe}}getComponent(){return this.component}setComponent(se){if(se.name!==this.name)throw Error(`Mismatching Component ${se.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=se,this.shouldAutoInitialize()){if(function Be(xe){return"EAGER"===xe.instantiationMode}(se))try{this.getOrInitializeService({instanceIdentifier:m})}catch{}for(const[me,He]of this.instancesDeferred.entries()){const qe=this.normalizeInstanceIdentifier(me);try{const Oe=this.getOrInitializeService({instanceIdentifier:qe});He.resolve(Oe)}catch{}}}}clearInstance(se=m){this.instancesDeferred.delete(se),this.instancesOptions.delete(se),this.instances.delete(se)}delete(){var se=this;return(0,O.A)(function*(){const me=Array.from(se.instances.values());yield Promise.all([...me.filter(He=>"INTERNAL"in He).map(He=>He.INTERNAL.delete()),...me.filter(He=>"_delete"in He).map(He=>He._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(se=m){return this.instances.has(se)}getOptions(se=m){return this.instancesOptions.get(se)||{}}initialize(se={}){const{options:me={}}=se,He=this.normalizeInstanceIdentifier(se.instanceIdentifier);if(this.isInitialized(He))throw Error(`${this.name}(${He}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const qe=this.getOrInitializeService({instanceIdentifier:He,options:me});for(const[Oe,je]of this.instancesDeferred.entries())He===this.normalizeInstanceIdentifier(Oe)&&je.resolve(qe);return qe}onInit(se,me){var He;const qe=this.normalizeInstanceIdentifier(me),Oe=null!==(He=this.onInitCallbacks.get(qe))&&void 0!==He?He:new Set;Oe.add(se),this.onInitCallbacks.set(qe,Oe);const je=this.instances.get(qe);return je&&se(je,qe),()=>{Oe.delete(se)}}invokeOnInitCallbacks(se,me){const He=this.onInitCallbacks.get(me);if(He)for(const qe of He)try{qe(se,me)}catch{}}getOrInitializeService({instanceIdentifier:se,options:me={}}){let He=this.instances.get(se);if(!He&&this.component&&(He=this.component.instanceFactory(this.container,{instanceIdentifier:(xe=se,xe===m?void 0:xe),options:me}),this.instances.set(se,He),this.instancesOptions.set(se,me),this.invokeOnInitCallbacks(He,se),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,se,He)}catch{}var xe;return He||null}normalizeInstanceIdentifier(se=m){return this.component?this.component.multipleInstances?se:m:se}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Ve{constructor(se){this.name=se,this.providers=new Map}addComponent(se){const me=this.getProvider(se.name);if(me.isComponentSet())throw new Error(`Component ${se.name} has already been registered with ${this.name}`);me.setComponent(se)}addOrOverwriteComponent(se){this.getProvider(se.name).isComponentSet()&&this.providers.delete(se.name),this.addComponent(se)}getProvider(se){if(this.providers.has(se))return this.providers.get(se);const me=new ae(se,this);return this.providers.set(se,me),me}getProviders(){return Array.from(this.providers.values())}}},762:(An,xt,H)=>{"use strict";H.d(xt,{A:()=>O.A});var O=H(9574);O.A.registerVersion("firebase","10.9.0","app-compat")},4998:(An,xt,H)=>{"use strict";H.r(xt);var O=H(467),z=H(9574),ye=H(1401),m=H(2979),ae=H(8041),De=H(1635),Be=H(8779);const xe={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"};const je=function qe(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},ht=function Oe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},et=new ye.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ue=new ae.Vy("@firebase/auth");function Xe(B,...S){Ue.logLevel<=ae.$b.ERROR&&Ue.error(`Auth (${m.SDK_VERSION}): ${B}`,...S)}function Le(B,...S){throw it(B,...S)}function Te(B,...S){return it(B,...S)}function at(B,S,M){const j=Object.assign(Object.assign({},ht()),{[S]:M});return new ye.FA("auth","Firebase",j).create(S,{appName:B.name})}function Ze(B,S,M){if(!(S instanceof M))throw M.name!==S.constructor.name&&Le(B,"argument-error"),at(B,"argument-error",`Type of ${S.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function it(B,...S){if("string"!=typeof B){const M=S[0],j=[...S.slice(1)];return j[0]&&(j[0].appName=B.name),B._errorFactory.create(M,...j)}return et.create(B,...S)}function Ge(B,S,...M){if(!B)throw it(S,...M)}function nn(B){const S="INTERNAL ASSERTION FAILED: "+B;throw Xe(S),new Error(S)}function bn(B,S){B||nn(S)}function Cn(){var B;return typeof self<"u"&&(null===(B=self.location)||void 0===B?void 0:B.href)||""}function qt(){return"http:"===Ht()||"https:"===Ht()}function Ht(){var B;return typeof self<"u"&&(null===(B=self.location)||void 0===B?void 0:B.protocol)||null}class Pt{constructor(S,M){this.shortDelay=S,this.longDelay=M,bn(M>S,"Short delay should be less than long delay!"),this.isMobile=(0,ye.jZ)()||(0,ye.lV)()}get(){return function lt(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(qt()||(0,ye.sr)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Qe(B,S){bn(B.emulator,"Emulator should always be set here");const{url:M}=B.emulator;return S?`${M}${S.startsWith("/")?S.slice(1):S}`:M}class Tt{static initialize(S,M,j){this.fetchImpl=S,M&&(this.headersImpl=M),j&&(this.responseImpl=j)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:typeof globalThis<"u"&&globalThis.fetch?globalThis.fetch:typeof fetch<"u"?fetch:void nn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:typeof globalThis<"u"&&globalThis.Headers?globalThis.Headers:typeof Headers<"u"?Headers:void nn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:typeof globalThis<"u"&&globalThis.Response?globalThis.Response:typeof Response<"u"?Response:void nn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const $t={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Qt=new Pt(3e4,6e4);function sn(B,S){return B.tenantId&&!S.tenantId?Object.assign(Object.assign({},S),{tenantId:B.tenantId}):S}function mn(B,S,M,j){return Vn.apply(this,arguments)}function Vn(){return(Vn=(0,O.A)(function*(B,S,M,j,fe={}){return Fr(B,fe,(0,O.A)(function*(){let We={},zt={};j&&("GET"===S?zt=j:We={body:JSON.stringify(j)});const fn=(0,ye.Am)(Object.assign({key:B.config.apiKey},zt)).slice(1),Tn=yield B._getAdditionalHeaders();return Tn["Content-Type"]="application/json",B.languageCode&&(Tn["X-Firebase-Locale"]=B.languageCode),Tt.fetch()(jr(B,B.config.apiHost,M,fn),Object.assign({method:S,headers:Tn,referrerPolicy:"no-referrer"},We))}))})).apply(this,arguments)}function Fr(B,S,M){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,O.A)(function*(B,S,M){B._canInitEmulator=!1;const j=Object.assign(Object.assign({},$t),S);try{const fe=new Ai(B),We=yield Promise.race([M(),fe.promise]);fe.clearNetworkTimeout();const zt=yield We.json();if("needConfirmation"in zt)throw Ri(B,"account-exists-with-different-credential",zt);if(We.ok&&!("errorMessage"in zt))return zt;{const fn=We.ok?zt.errorMessage:zt.error.message,[Tn,ir]=fn.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===Tn)throw Ri(B,"credential-already-in-use",zt);if("EMAIL_EXISTS"===Tn)throw Ri(B,"email-already-in-use",zt);if("USER_DISABLED"===Tn)throw Ri(B,"user-disabled",zt);const oi=j[Tn]||Tn.toLowerCase().replace(/[_\s]+/g,"-");if(ir)throw at(B,oi,ir);Le(B,oi)}}catch(fe){if(fe instanceof ye.g)throw fe;Le(B,"network-request-failed",{message:String(fe)})}})).apply(this,arguments)}function on(B,S,M,j){return Or.apply(this,arguments)}function Or(){return(Or=(0,O.A)(function*(B,S,M,j,fe={}){const We=yield mn(B,S,M,j,fe);return"mfaPendingCredential"in We&&Le(B,"multi-factor-auth-required",{_serverResponse:We}),We})).apply(this,arguments)}function jr(B,S,M,j){const fe=`${S}${M}?${j}`;return B.config.emulator?Qe(B.config,fe):`${B.config.apiScheme}://${fe}`}function ur(B){switch(B){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Ai{constructor(S){this.auth=S,this.timer=null,this.promise=new Promise((M,j)=>{this.timer=setTimeout(()=>j(Te(this.auth,"network-request-failed")),Qt.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ri(B,S,M){const j={appName:B.name};M.email&&(j.email=M.email),M.phoneNumber&&(j.phoneNumber=M.phoneNumber);const fe=Te(B,S,j);return fe.customData._tokenResponse=M,fe}function nr(B){return void 0!==B&&void 0!==B.getResponse}function mr(B){return void 0!==B&&void 0!==B.enterprise}class Er{constructor(S){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===S.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=S.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=S.recaptchaEnforcementState}getProviderEnforcementState(S){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const M of this.recaptchaEnforcementState)if(M.provider&&M.provider===S)return ur(M.enforcementState);return null}isProviderEnabled(S){return"ENFORCE"===this.getProviderEnforcementState(S)||"AUDIT"===this.getProviderEnforcementState(S)}}function us(){return(us=(0,O.A)(function*(B){return(yield mn(B,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Hn(B,S){return Sr.apply(this,arguments)}function Sr(){return(Sr=(0,O.A)(function*(B,S){return mn(B,"GET","/v2/recaptchaConfig",sn(B,S))})).apply(this,arguments)}function Gt(){return(Gt=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:delete",S)})).apply(this,arguments)}function Ce(){return(Ce=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:update",S)})).apply(this,arguments)}function Mt(){return(Mt=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:lookup",S)})).apply(this,arguments)}function hn(B){if(B)try{const S=new Date(Number(B));if(!isNaN(S.getTime()))return S.toUTCString()}catch{}}function $r(){return($r=(0,O.A)(function*(B,S=!1){const M=(0,ye.Ku)(B),j=yield M.getIdToken(S),fe=qn(j);Ge(fe&&fe.exp&&fe.auth_time&&fe.iat,M.auth,"internal-error");const We="object"==typeof fe.firebase?fe.firebase:void 0,zt=We?.sign_in_provider;return{claims:fe,token:j,authTime:hn(ci(fe.auth_time)),issuedAtTime:hn(ci(fe.iat)),expirationTime:hn(ci(fe.exp)),signInProvider:zt||null,signInSecondFactor:We?.sign_in_second_factor||null}})).apply(this,arguments)}function ci(B){return 1e3*Number(B)}function qn(B){const[S,M,j]=B.split(".");if(void 0===S||void 0===M||void 0===j)return Xe("JWT malformed, contained fewer than 3 sections"),null;try{const fe=(0,ye.u)(M);return fe?JSON.parse(fe):(Xe("Failed to decode base64 JWT payload"),null)}catch(fe){return Xe("Caught error parsing JWT payload as JSON",fe?.toString()),null}}function Zt(B,S){return ve.apply(this,arguments)}function ve(){return(ve=(0,O.A)(function*(B,S,M=!1){if(M)return S;try{return yield S}catch(j){throw j instanceof ye.g&&function re({code:B}){return"auth/user-disabled"===B||"auth/user-token-expired"===B}(j)&&B.auth.currentUser===B&&(yield B.auth.signOut()),j}})).apply(this,arguments)}class Q{constructor(S){this.user=S,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(S){var M;if(S){const j=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),j}{this.errorBackoff=3e4;const fe=(null!==(M=this.user.stsTokenManager.expirationTime)&&void 0!==M?M:0)-Date.now()-3e5;return Math.max(0,fe)}}schedule(S=!1){var M=this;if(!this.isRunning)return;const j=this.getInterval(S);this.timerId=setTimeout((0,O.A)(function*(){yield M.iteration()}),j)}iteration(){var S=this;return(0,O.A)(function*(){try{yield S.user.getIdToken(!0)}catch(M){return void("auth/network-request-failed"===M?.code&&S.schedule(!0))}S.schedule()})()}}class oe{constructor(S,M){this.createdAt=S,this.lastLoginAt=M,this._initializeTime()}_initializeTime(){this.lastSignInTime=hn(this.lastLoginAt),this.creationTime=hn(this.createdAt)}_copy(S){this.createdAt=S.createdAt,this.lastLoginAt=S.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function ge(B){return Me.apply(this,arguments)}function Me(){return Me=(0,O.A)(function*(B){var S;const M=B.auth,j=yield B.getIdToken(),fe=yield Zt(B,function pt(B,S){return Mt.apply(this,arguments)}(M,{idToken:j}));Ge(fe?.users.length,M,"internal-error");const We=fe.users[0];B._notifyReloadListener(We);const zt=null!==(S=We.providerUserInfo)&&void 0!==S&&S.length?function we(B){return B.map(S=>{var{providerId:M}=S,j=(0,De.Tt)(S,["providerId"]);return{providerId:M,uid:j.rawId||"",displayName:j.displayName||null,email:j.email||null,phoneNumber:j.phoneNumber||null,photoURL:j.photoUrl||null}})}(We.providerUserInfo):[],fn=function Ie(B,S){return[...B.filter(j=>!S.some(fe=>fe.providerId===j.providerId)),...S]}(B.providerData,zt),oi=!!B.isAnonymous&&!(B.email&&We.passwordHash||fn?.length),ai={uid:We.localId,displayName:We.displayName||null,photoURL:We.photoUrl||null,email:We.email||null,emailVerified:We.emailVerified||!1,phoneNumber:We.phoneNumber||null,tenantId:We.tenantId||null,providerData:fn,metadata:new oe(We.createdAt,We.lastLoginAt),isAnonymous:oi};Object.assign(B,ai)}),Me.apply(this,arguments)}function Re(){return(Re=(0,O.A)(function*(B){const S=(0,ye.Ku)(B);yield ge(S),yield S.auth._persistUserIfCurrent(S),S.auth._notifyListenersIfCurrent(S)})).apply(this,arguments)}function Ae(){return(Ae=(0,O.A)(function*(B,S){const M=yield Fr(B,{},(0,O.A)(function*(){const j=(0,ye.Am)({grant_type:"refresh_token",refresh_token:S}).slice(1),{tokenApiHost:fe,apiKey:We}=B.config,zt=jr(B,fe,"/v1/token",`key=${We}`),fn=yield B._getAdditionalHeaders();return fn["Content-Type"]="application/x-www-form-urlencoded",Tt.fetch()(zt,{method:"POST",headers:fn,body:j})}));return{accessToken:M.access_token,expiresIn:M.expires_in,refreshToken:M.refresh_token}})).apply(this,arguments)}function ft(){return(ft=(0,O.A)(function*(B,S){return mn(B,"POST","/v2/accounts:revokeToken",sn(B,S))})).apply(this,arguments)}class Vt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(S){Ge(S.idToken,"internal-error"),Ge(typeof S.idToken<"u","internal-error"),Ge(typeof S.refreshToken<"u","internal-error");const M="expiresIn"in S&&typeof S.expiresIn<"u"?Number(S.expiresIn):function Fs(B){const S=qn(B);return Ge(S,"internal-error"),Ge(typeof S.exp<"u","internal-error"),Ge(typeof S.iat<"u","internal-error"),Number(S.exp)-Number(S.iat)}(S.idToken);this.updateTokensAndExpiration(S.idToken,S.refreshToken,M)}getToken(S,M=!1){var j=this;return(0,O.A)(function*(){return Ge(!j.accessToken||j.refreshToken,S,"user-token-expired"),M||!j.accessToken||j.isExpired?j.refreshToken?(yield j.refresh(S,j.refreshToken),j.accessToken):null:j.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(S,M){var j=this;return(0,O.A)(function*(){const{accessToken:fe,refreshToken:We,expiresIn:zt}=yield function Je(B,S){return Ae.apply(this,arguments)}(S,M);j.updateTokensAndExpiration(fe,We,Number(zt))})()}updateTokensAndExpiration(S,M,j){this.refreshToken=M||null,this.accessToken=S||null,this.expirationTime=Date.now()+1e3*j}static fromJSON(S,M){const{refreshToken:j,accessToken:fe,expirationTime:We}=M,zt=new Vt;return j&&(Ge("string"==typeof j,"internal-error",{appName:S}),zt.refreshToken=j),fe&&(Ge("string"==typeof fe,"internal-error",{appName:S}),zt.accessToken=fe),We&&(Ge("number"==typeof We,"internal-error",{appName:S}),zt.expirationTime=We),zt}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(S){this.accessToken=S.accessToken,this.refreshToken=S.refreshToken,this.expirationTime=S.expirationTime}_clone(){return Object.assign(new Vt,this.toJSON())}_performRefresh(){return nn("not implemented")}}function Rt(B,S){Ge("string"==typeof B||typeof B>"u","internal-error",{appName:S})}class Mn{constructor(S){var{uid:M,auth:j,stsTokenManager:fe}=S,We=(0,De.Tt)(S,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Q(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=M,this.auth=j,this.stsTokenManager=fe,this.accessToken=fe.accessToken,this.displayName=We.displayName||null,this.email=We.email||null,this.emailVerified=We.emailVerified||!1,this.phoneNumber=We.phoneNumber||null,this.photoURL=We.photoURL||null,this.isAnonymous=We.isAnonymous||!1,this.tenantId=We.tenantId||null,this.providerData=We.providerData?[...We.providerData]:[],this.metadata=new oe(We.createdAt||void 0,We.lastLoginAt||void 0)}getIdToken(S){var M=this;return(0,O.A)(function*(){const j=yield Zt(M,M.stsTokenManager.getToken(M.auth,S));return Ge(j,M.auth,"internal-error"),M.accessToken!==j&&(M.accessToken=j,yield M.auth._persistUserIfCurrent(M),M.auth._notifyListenersIfCurrent(M)),j})()}getIdTokenResult(S){return function vi(B){return $r.apply(this,arguments)}(this,S)}reload(){return function $e(B){return Re.apply(this,arguments)}(this)}_assign(S){this!==S&&(Ge(this.uid===S.uid,this.auth,"internal-error"),this.displayName=S.displayName,this.photoURL=S.photoURL,this.email=S.email,this.emailVerified=S.emailVerified,this.phoneNumber=S.phoneNumber,this.isAnonymous=S.isAnonymous,this.tenantId=S.tenantId,this.providerData=S.providerData.map(M=>Object.assign({},M)),this.metadata._copy(S.metadata),this.stsTokenManager._assign(S.stsTokenManager))}_clone(S){const M=new Mn(Object.assign(Object.assign({},this),{auth:S,stsTokenManager:this.stsTokenManager._clone()}));return M.metadata._copy(this.metadata),M}_onReload(S){Ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=S,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(S){this.reloadListener?this.reloadListener(S):this.reloadUserInfo=S}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(S,M=!1){var j=this;return(0,O.A)(function*(){let fe=!1;S.idToken&&S.idToken!==j.stsTokenManager.accessToken&&(j.stsTokenManager.updateFromServerResponse(S),fe=!0),M&&(yield ge(j)),yield j.auth._persistUserIfCurrent(j),fe&&j.auth._notifyListenersIfCurrent(j)})()}delete(){var S=this;return(0,O.A)(function*(){const M=yield S.getIdToken();return yield Zt(S,function kr(B,S){return Gt.apply(this,arguments)}(S.auth,{idToken:M})),S.stsTokenManager.clearRefreshToken(),S.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(S=>Object.assign({},S)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(S,M){var j,fe,We,zt,fn,Tn,ir,oi;const ai=null!==(j=M.displayName)&&void 0!==j?j:void 0,ks=null!==(fe=M.email)&&void 0!==fe?fe:void 0,Nc=null!==(We=M.phoneNumber)&&void 0!==We?We:void 0,hh=null!==(zt=M.photoURL)&&void 0!==zt?zt:void 0,Sp=null!==(fn=M.tenantId)&&void 0!==fn?fn:void 0,Yh=null!==(Tn=M._redirectEventId)&&void 0!==Tn?Tn:void 0,Jh=null!==(ir=M.createdAt)&&void 0!==ir?ir:void 0,fh=null!==(oi=M.lastLoginAt)&&void 0!==oi?oi:void 0,{uid:lu,emailVerified:ph,isAnonymous:ef,providerData:Td,stsTokenManager:tf}=M;Ge(lu&&tf,S,"internal-error");const mm=Vt.fromJSON(this.name,tf);Ge("string"==typeof lu,S,"internal-error"),Rt(ai,S.name),Rt(ks,S.name),Ge("boolean"==typeof ph,S,"internal-error"),Ge("boolean"==typeof ef,S,"internal-error"),Rt(Nc,S.name),Rt(hh,S.name),Rt(Sp,S.name),Rt(Yh,S.name),Rt(Jh,S.name),Rt(fh,S.name);const Ap=new Mn({uid:lu,auth:S,email:ks,emailVerified:ph,displayName:ai,isAnonymous:ef,photoURL:hh,phoneNumber:Nc,tenantId:Sp,stsTokenManager:mm,createdAt:Jh,lastLoginAt:fh});return Td&&Array.isArray(Td)&&(Ap.providerData=Td.map(gm=>Object.assign({},gm))),Yh&&(Ap._redirectEventId=Yh),Ap}static _fromIdTokenResponse(S,M,j=!1){return(0,O.A)(function*(){const fe=new Vt;fe.updateFromServerResponse(M);const We=new Mn({uid:M.localId,auth:S,stsTokenManager:fe,isAnonymous:j});return yield ge(We),We})()}}const ar=new Map;function wr(B){bn(B instanceof Function,"Expected a class definition");let S=ar.get(B);return S?(bn(S instanceof B,"Instance stored in cache mismatched with class"),S):(S=new B,ar.set(B,S),S)}const Li=(()=>{class B{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,O.A)(function*(){return!0})()}_set(M,j){var fe=this;return(0,O.A)(function*(){fe.storage[M]=j})()}_get(M){var j=this;return(0,O.A)(function*(){const fe=j.storage[M];return void 0===fe?null:fe})()}_remove(M){var j=this;return(0,O.A)(function*(){delete j.storage[M]})()}_addListener(M,j){}_removeListener(M,j){}}return B.type="NONE",B})();function $i(B,S,M){return`firebase:${B}:${S}:${M}`}class Wr{constructor(S,M,j){this.persistence=S,this.auth=M,this.userKey=j;const{config:fe,name:We}=this.auth;this.fullUserKey=$i(this.userKey,fe.apiKey,We),this.fullPersistenceKey=$i("persistence",fe.apiKey,We),this.boundEventHandler=M._onStorageEvent.bind(M),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(S){return this.persistence._set(this.fullUserKey,S.toJSON())}getCurrentUser(){var S=this;return(0,O.A)(function*(){const M=yield S.persistence._get(S.fullUserKey);return M?Mn._fromJSON(S.auth,M):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(S){var M=this;return(0,O.A)(function*(){if(M.persistence===S)return;const j=yield M.getCurrentUser();return yield M.removeCurrentUser(),M.persistence=S,j?M.setCurrentUser(j):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(S,M,j="authUser"){return(0,O.A)(function*(){if(!M.length)return new Wr(wr(Li),S,j);const fe=(yield Promise.all(M.map(function(){var ir=(0,O.A)(function*(oi){if(yield oi._isAvailable())return oi});return function(oi){return ir.apply(this,arguments)}}()))).filter(ir=>ir);let We=fe[0]||wr(Li);const zt=$i(j,S.config.apiKey,S.name);let fn=null;for(const ir of M)try{const oi=yield ir._get(zt);if(oi){const ai=Mn._fromJSON(S,oi);ir!==We&&(fn=ai),We=ir;break}}catch{}const Tn=fe.filter(ir=>ir._shouldAllowMigration);return We._shouldAllowMigration&&Tn.length?(We=Tn[0],fn&&(yield We._set(zt,fn.toJSON())),yield Promise.all(M.map(function(){var ir=(0,O.A)(function*(oi){if(oi!==We)try{yield oi._remove(zt)}catch{}});return function(oi){return ir.apply(this,arguments)}}())),new Wr(We,S,j)):new Wr(We,S,j)})()}}function _r(B){const S=B.toLowerCase();if(S.includes("opera/")||S.includes("opr/")||S.includes("opios/"))return"Opera";if(In(S))return"IEMobile";if(S.includes("msie")||S.includes("trident/"))return"IE";if(S.includes("edge/"))return"Edge";if(Bs(S))return"Firefox";if(S.includes("silk/"))return"Silk";if(Sn(S))return"Blackberry";if(Gr(S))return"Webos";if(ra(S))return"Safari";if((S.includes("chrome/")||wa(S))&&!S.includes("edge/"))return"Chrome";if(Jt(S))return"Android";{const j=B.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===j?.length)return j[1]}return"Other"}function Bs(B=(0,ye.ZQ)()){return/firefox\//i.test(B)}function ra(B=(0,ye.ZQ)()){const S=B.toLowerCase();return S.includes("safari/")&&!S.includes("chrome/")&&!S.includes("crios/")&&!S.includes("android")}function wa(B=(0,ye.ZQ)()){return/crios\//i.test(B)}function In(B=(0,ye.ZQ)()){return/iemobile/i.test(B)}function Jt(B=(0,ye.ZQ)()){return/android/i.test(B)}function Sn(B=(0,ye.ZQ)()){return/blackberry/i.test(B)}function Gr(B=(0,ye.ZQ)()){return/webos/i.test(B)}function gi(B=(0,ye.ZQ)()){return/iphone|ipad|ipod/i.test(B)||/macintosh/i.test(B)&&/mobile/i.test(B)}function _i(B=(0,ye.ZQ)()){return gi(B)||Jt(B)||Gr(B)||Sn(B)||/windows phone/i.test(B)||In(B)}function Dt(B,S=[]){let M;switch(B){case"Browser":M=_r((0,ye.ZQ)());break;case"Worker":M=`${_r((0,ye.ZQ)())}-${B}`;break;default:M=B}const j=S.length?S.join(","):"FirebaseCore-web";return`${M}/JsCore/${m.SDK_VERSION}/${j}`}class Nt{constructor(S){this.auth=S,this.queue=[]}pushCallback(S,M){const j=We=>new Promise((zt,fn)=>{try{zt(S(We))}catch(Tn){fn(Tn)}});j.onAbort=M,this.queue.push(j);const fe=this.queue.length-1;return()=>{this.queue[fe]=()=>Promise.resolve()}}runMiddleware(S){var M=this;return(0,O.A)(function*(){if(M.auth.currentUser===S)return;const j=[];try{for(const fe of M.queue)yield fe(S),fe.onAbort&&j.push(fe.onAbort)}catch(fe){j.reverse();for(const We of j)try{We()}catch{}throw M.auth._errorFactory.create("login-blocked",{originalMessage:fe?.message})}})()}}function bt(){return(bt=(0,O.A)(function*(B,S={}){return mn(B,"GET","/v2/passwordPolicy",sn(B,S))})).apply(this,arguments)}class sr{constructor(S){var M,j,fe,We;const zt=S.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(M=zt.minPasswordLength)&&void 0!==M?M:6,zt.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=zt.maxPasswordLength),void 0!==zt.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=zt.containsLowercaseCharacter),void 0!==zt.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=zt.containsUppercaseCharacter),void 0!==zt.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=zt.containsNumericCharacter),void 0!==zt.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=zt.containsNonAlphanumericCharacter),this.enforcementState=S.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(fe=null===(j=S.allowedNonAlphanumericCharacters)||void 0===j?void 0:j.join(""))&&void 0!==fe?fe:"",this.forceUpgradeOnSignin=null!==(We=S.forceUpgradeOnSignin)&&void 0!==We&&We,this.schemaVersion=S.schemaVersion}validatePassword(S){var M,j,fe,We,zt,fn;const Tn={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(S,Tn),this.validatePasswordCharacterOptions(S,Tn),Tn.isValid&&(Tn.isValid=null===(M=Tn.meetsMinPasswordLength)||void 0===M||M),Tn.isValid&&(Tn.isValid=null===(j=Tn.meetsMaxPasswordLength)||void 0===j||j),Tn.isValid&&(Tn.isValid=null===(fe=Tn.containsLowercaseLetter)||void 0===fe||fe),Tn.isValid&&(Tn.isValid=null===(We=Tn.containsUppercaseLetter)||void 0===We||We),Tn.isValid&&(Tn.isValid=null===(zt=Tn.containsNumericCharacter)||void 0===zt||zt),Tn.isValid&&(Tn.isValid=null===(fn=Tn.containsNonAlphanumericCharacter)||void 0===fn||fn),Tn}validatePasswordLengthOptions(S,M){const j=this.customStrengthOptions.minPasswordLength,fe=this.customStrengthOptions.maxPasswordLength;j&&(M.meetsMinPasswordLength=S.length>=j),fe&&(M.meetsMaxPasswordLength=S.length<=fe)}validatePasswordCharacterOptions(S,M){let j;this.updatePasswordCharacterOptionsStatuses(M,!1,!1,!1,!1);for(let fe=0;fe<S.length;fe++)j=S.charAt(fe),this.updatePasswordCharacterOptionsStatuses(M,j>="a"&&j<="z",j>="A"&&j<="Z",j>="0"&&j<="9",this.allowedNonAlphanumericCharacters.includes(j))}updatePasswordCharacterOptionsStatuses(S,M,j,fe,We){this.customStrengthOptions.containsLowercaseLetter&&(S.containsLowercaseLetter||(S.containsLowercaseLetter=M)),this.customStrengthOptions.containsUppercaseLetter&&(S.containsUppercaseLetter||(S.containsUppercaseLetter=j)),this.customStrengthOptions.containsNumericCharacter&&(S.containsNumericCharacter||(S.containsNumericCharacter=fe)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(S.containsNonAlphanumericCharacter||(S.containsNonAlphanumericCharacter=We))}}class ei{constructor(S,M,j,fe){this.app=S,this.heartbeatServiceProvider=M,this.appCheckServiceProvider=j,this.config=fe,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new li(this),this.idTokenSubscription=new li(this),this.beforeStateQueue=new Nt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=et,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=S.name,this.clientVersion=fe.sdkClientVersion}_initializeWithPersistence(S,M){var j=this;return M&&(this._popupRedirectResolver=wr(M)),this._initializationPromise=this.queue((0,O.A)(function*(){var fe,We;if(!j._deleted&&(j.persistenceManager=yield Wr.create(j,S),!j._deleted)){if(null!==(fe=j._popupRedirectResolver)&&void 0!==fe&&fe._shouldInitProactively)try{yield j._popupRedirectResolver._initialize(j)}catch{}yield j.initializeCurrentUser(M),j.lastNotifiedUid=(null===(We=j.currentUser)||void 0===We?void 0:We.uid)||null,!j._deleted&&(j._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var S=this;return(0,O.A)(function*(){if(S._deleted)return;const M=yield S.assertedPersistence.getCurrentUser();if(S.currentUser||M){if(S.currentUser&&M&&S.currentUser.uid===M.uid)return S._currentUser._assign(M),void(yield S.currentUser.getIdToken());yield S._updateCurrentUser(M,!0)}})()}initializeCurrentUser(S){var M=this;return(0,O.A)(function*(){var j;const fe=yield M.assertedPersistence.getCurrentUser();let We=fe,zt=!1;if(S&&M.config.authDomain){yield M.getOrInitRedirectPersistenceManager();const fn=null===(j=M.redirectUser)||void 0===j?void 0:j._redirectEventId,Tn=We?._redirectEventId,ir=yield M.tryRedirectSignIn(S);(!fn||fn===Tn)&&ir?.user&&(We=ir.user,zt=!0)}if(!We)return M.directlySetCurrentUser(null);if(!We._redirectEventId){if(zt)try{yield M.beforeStateQueue.runMiddleware(We)}catch(fn){We=fe,M._popupRedirectResolver._overrideRedirectResult(M,()=>Promise.reject(fn))}return We?M.reloadAndSetCurrentUserOrClear(We):M.directlySetCurrentUser(null)}return Ge(M._popupRedirectResolver,M,"argument-error"),yield M.getOrInitRedirectPersistenceManager(),M.redirectUser&&M.redirectUser._redirectEventId===We._redirectEventId?M.directlySetCurrentUser(We):M.reloadAndSetCurrentUserOrClear(We)})()}tryRedirectSignIn(S){var M=this;return(0,O.A)(function*(){let j=null;try{j=yield M._popupRedirectResolver._completeRedirectFn(M,S,!0)}catch{yield M._setRedirectUser(null)}return j})()}reloadAndSetCurrentUserOrClear(S){var M=this;return(0,O.A)(function*(){try{yield ge(S)}catch(j){if("auth/network-request-failed"!==j?.code)return M.directlySetCurrentUser(null)}return M.directlySetCurrentUser(S)})()}useDeviceLanguage(){this.languageCode=function Ct(){if(typeof navigator>"u")return null;const B=navigator;return B.languages&&B.languages[0]||B.language||null}()}_delete(){var S=this;return(0,O.A)(function*(){S._deleted=!0})()}updateCurrentUser(S){var M=this;return(0,O.A)(function*(){const j=S?(0,ye.Ku)(S):null;return j&&Ge(j.auth.config.apiKey===M.config.apiKey,M,"invalid-user-token"),M._updateCurrentUser(j&&j._clone(M))})()}_updateCurrentUser(S,M=!1){var j=this;return(0,O.A)(function*(){if(!j._deleted)return S&&Ge(j.tenantId===S.tenantId,j,"tenant-id-mismatch"),M||(yield j.beforeStateQueue.runMiddleware(S)),j.queue((0,O.A)(function*(){yield j.directlySetCurrentUser(S),j.notifyAuthListeners()}))})()}signOut(){var S=this;return(0,O.A)(function*(){return yield S.beforeStateQueue.runMiddleware(null),(S.redirectPersistenceManager||S._popupRedirectResolver)&&(yield S._setRedirectUser(null)),S._updateCurrentUser(null,!0)})()}setPersistence(S){var M=this;return this.queue((0,O.A)(function*(){yield M.assertedPersistence.setPersistence(wr(S))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(S){var M=this;return(0,O.A)(function*(){M._getPasswordPolicyInternal()||(yield M._updatePasswordPolicy());const j=M._getPasswordPolicyInternal();return j.schemaVersion!==M.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(M._errorFactory.create("unsupported-password-policy-schema-version",{})):j.validatePassword(S)})()}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){var S=this;return(0,O.A)(function*(){const M=yield function wn(B){return bt.apply(this,arguments)}(S),j=new sr(M);null===S.tenantId?S._projectPasswordPolicy=j:S._tenantPasswordPolicies[S.tenantId]=j})()}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(S){this._errorFactory=new ye.FA("auth","Firebase",S())}onAuthStateChanged(S,M,j){return this.registerStateListener(this.authStateSubscription,S,M,j)}beforeAuthStateChanged(S,M){return this.beforeStateQueue.pushCallback(S,M)}onIdTokenChanged(S,M,j){return this.registerStateListener(this.idTokenSubscription,S,M,j)}authStateReady(){return new Promise((S,M)=>{if(this.currentUser)S();else{const j=this.onAuthStateChanged(()=>{j(),S()},M)}})}revokeAccessToken(S){var M=this;return(0,O.A)(function*(){if(M.currentUser){const j=yield M.currentUser.getIdToken(),fe={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:S,idToken:j};null!=M.tenantId&&(fe.tenantId=M.tenantId),yield function Ne(B,S){return ft.apply(this,arguments)}(M,fe)}})()}toJSON(){var S;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(S=this._currentUser)||void 0===S?void 0:S.toJSON()}}_setRedirectUser(S,M){var j=this;return(0,O.A)(function*(){const fe=yield j.getOrInitRedirectPersistenceManager(M);return null===S?fe.removeCurrentUser():fe.setCurrentUser(S)})()}getOrInitRedirectPersistenceManager(S){var M=this;return(0,O.A)(function*(){if(!M.redirectPersistenceManager){const j=S&&wr(S)||M._popupRedirectResolver;Ge(j,M,"argument-error"),M.redirectPersistenceManager=yield Wr.create(M,[wr(j._redirectPersistence)],"redirectUser"),M.redirectUser=yield M.redirectPersistenceManager.getCurrentUser()}return M.redirectPersistenceManager})()}_redirectUserForId(S){var M=this;return(0,O.A)(function*(){var j,fe;return M._isInitialized&&(yield M.queue((0,O.A)(function*(){}))),(null===(j=M._currentUser)||void 0===j?void 0:j._redirectEventId)===S?M._currentUser:(null===(fe=M.redirectUser)||void 0===fe?void 0:fe._redirectEventId)===S?M.redirectUser:null})()}_persistUserIfCurrent(S){var M=this;return(0,O.A)(function*(){if(S===M.currentUser)return M.queue((0,O.A)(function*(){return M.directlySetCurrentUser(S)}))})()}_notifyListenersIfCurrent(S){S===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var S,M;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const j=null!==(M=null===(S=this.currentUser)||void 0===S?void 0:S.uid)&&void 0!==M?M:null;this.lastNotifiedUid!==j&&(this.lastNotifiedUid=j,this.authStateSubscription.next(this.currentUser))}registerStateListener(S,M,j,fe){if(this._deleted)return()=>{};const We="function"==typeof M?M:M.next.bind(M);let zt=!1;const fn=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ge(fn,this,"internal-error"),fn.then(()=>{zt||We(this.currentUser)}),"function"==typeof M){const Tn=S.addObserver(M,j,fe);return()=>{zt=!0,Tn()}}{const Tn=S.addObserver(M);return()=>{zt=!0,Tn()}}}directlySetCurrentUser(S){var M=this;return(0,O.A)(function*(){M.currentUser&&M.currentUser!==S&&M._currentUser._stopProactiveRefresh(),S&&M.isProactiveRefreshEnabled&&S._startProactiveRefresh(),M.currentUser=S,S?yield M.assertedPersistence.setCurrentUser(S):yield M.assertedPersistence.removeCurrentUser()})()}queue(S){return this.operations=this.operations.then(S,S),this.operations}get assertedPersistence(){return Ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(S){!S||this.frameworks.includes(S)||(this.frameworks.push(S),this.frameworks.sort(),this.clientVersion=Dt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var S=this;return(0,O.A)(function*(){var M;const j={"X-Client-Version":S.clientVersion};S.app.options.appId&&(j["X-Firebase-gmpid"]=S.app.options.appId);const fe=yield null===(M=S.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===M?void 0:M.getHeartbeatsHeader();fe&&(j["X-Firebase-Client"]=fe);const We=yield S._getAppCheckToken();return We&&(j["X-Firebase-AppCheck"]=We),j})()}_getAppCheckToken(){var S=this;return(0,O.A)(function*(){var M;const j=yield null===(M=S.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===M?void 0:M.getToken();return j?.error&&function nt(B,...S){Ue.logLevel<=ae.$b.WARN&&Ue.warn(`Auth (${m.SDK_VERSION}): ${B}`,...S)}(`Error while retrieving App Check token: ${j.error}`),j?.token})()}}function Mr(B){return(0,ye.Ku)(B)}class li{constructor(S){this.auth=S,this.observer=null,this.addObserver=(0,ye.tD)(M=>this.observer=M)}get next(){return Ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let xi={loadJS:()=>(0,O.A)(function*(){throw new Error("Unable to load external scripts")})(),recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Vs(B){return xi.loadJS(B)}function Ci(B){return`__${B}${Math.floor(1e6*Math.random())}`}class Ui{constructor(S){this.type="recaptcha-enterprise",this.auth=Mr(S)}verify(S="verify",M=!1){var j=this;return(0,O.A)(function*(){function We(){return We=(0,O.A)(function*(fn){if(!M){if(null==fn.tenantId&&null!=fn._agentRecaptchaConfig)return fn._agentRecaptchaConfig.siteKey;if(null!=fn.tenantId&&void 0!==fn._tenantRecaptchaConfigs[fn.tenantId])return fn._tenantRecaptchaConfigs[fn.tenantId].siteKey}return new Promise(function(){var Tn=(0,O.A)(function*(ir,oi){Hn(fn,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(ai=>{if(void 0!==ai.recaptchaKey){const ks=new Er(ai);return null==fn.tenantId?fn._agentRecaptchaConfig=ks:fn._tenantRecaptchaConfigs[fn.tenantId]=ks,ir(ks.siteKey)}oi(new Error("recaptcha Enterprise site key undefined"))}).catch(ai=>{oi(ai)})});return function(ir,oi){return Tn.apply(this,arguments)}}())}),We.apply(this,arguments)}function zt(fn,Tn,ir){const oi=window.grecaptcha;mr(oi)?oi.enterprise.ready(()=>{oi.enterprise.execute(fn,{action:S}).then(ai=>{Tn(ai)}).catch(()=>{Tn("NO_RECAPTCHA")})}):ir(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((fn,Tn)=>{(function fe(fn){return We.apply(this,arguments)})(j.auth).then(ir=>{if(!M&&mr(window.grecaptcha))zt(ir,fn,Tn);else{if(typeof window>"u")return void Tn(new Error("RecaptchaVerifier is only supported in browser"));let oi=function ti(){return xi.recaptchaEnterpriseScript}();0!==oi.length&&(oi+=ir),Vs(oi).then(()=>{zt(ir,fn,Tn)}).catch(ai=>{Tn(ai)})}}).catch(ir=>{Tn(ir)})})})()}}function Mo(B,S,M){return bs.apply(this,arguments)}function bs(){return(bs=(0,O.A)(function*(B,S,M,j=!1){const fe=new Ui(B);let We;try{We=yield fe.verify(M)}catch{We=yield fe.verify(M,!0)}const zt=Object.assign({},S);return Object.assign(zt,j?{captchaResp:We}:{captchaResponse:We}),Object.assign(zt,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(zt,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),zt})).apply(this,arguments)}function Gi(B,S,M,j){return ys.apply(this,arguments)}function ys(){return ys=(0,O.A)(function*(B,S,M,j){var fe;if(null!==(fe=B._getRecaptchaConfig())&&void 0!==fe&&fe.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const We=yield Mo(B,S,M,"getOobCode"===M);return j(B,We)}return j(B,S).catch(function(){var We=(0,O.A)(function*(zt){if("auth/missing-recaptcha-token"===zt.code){console.log(`${M} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const fn=yield Mo(B,S,M,"getOobCode"===M);return j(B,fn)}return Promise.reject(zt)});return function(zt){return We.apply(this,arguments)}}())}),ys.apply(this,arguments)}function Iu(B){const S=B.indexOf(":");return S<0?"":B.substr(0,S+1)}function Fi(B){if(!B)return null;const S=Number(B);return isNaN(S)?null:S}class eo{constructor(S,M){this.providerId=S,this.signInMethod=M}toJSON(){return nn("not implemented")}_getIdTokenResponse(S){return nn("not implemented")}_linkToIdToken(S,M){return nn("not implemented")}_getReauthenticationResolver(S){return nn("not implemented")}}function to(B,S){return ds.apply(this,arguments)}function ds(){return(ds=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:resetPassword",sn(B,S))})).apply(this,arguments)}function Tl(){return(Tl=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:update",S)})).apply(this,arguments)}function ba(B,S){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:signUp",S)})).apply(this,arguments)}function al(){return(al=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:update",sn(B,S))})).apply(this,arguments)}function no(B,S){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithPassword",sn(B,S))})).apply(this,arguments)}function Za(B,S){return ia.apply(this,arguments)}function ia(){return(ia=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:sendOobCode",sn(B,S))})).apply(this,arguments)}function sa(){return(sa=(0,O.A)(function*(B,S){return Za(B,S)})).apply(this,arguments)}function wi(B,S){return Zs.apply(this,arguments)}function Zs(){return(Zs=(0,O.A)(function*(B,S){return Za(B,S)})).apply(this,arguments)}function Us(B,S){return ga.apply(this,arguments)}function ga(){return(ga=(0,O.A)(function*(B,S){return Za(B,S)})).apply(this,arguments)}function Il(){return(Il=(0,O.A)(function*(B,S){return Za(B,S)})).apply(this,arguments)}function Bo(){return(Bo=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithEmailLink",sn(B,S))})).apply(this,arguments)}function Xa(){return(Xa=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithEmailLink",sn(B,S))})).apply(this,arguments)}class qo extends eo{constructor(S,M,j,fe=null){super("password",j),this._email=S,this._password=M,this._tenantId=fe}static _fromEmailAndPassword(S,M){return new qo(S,M,"password")}static _fromEmailAndCode(S,M,j=null){return new qo(S,M,"emailLink",j)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(S){const M="string"==typeof S?JSON.parse(S):S;if(M?.email&&M?.password){if("password"===M.signInMethod)return this._fromEmailAndPassword(M.email,M.password);if("emailLink"===M.signInMethod)return this._fromEmailAndCode(M.email,M.password,M.tenantId)}return null}_getIdTokenResponse(S){var M=this;return(0,O.A)(function*(){switch(M.signInMethod){case"password":return Gi(S,{returnSecureToken:!0,email:M._email,password:M._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",no);case"emailLink":return function La(B,S){return Bo.apply(this,arguments)}(S,{email:M._email,oobCode:M._password});default:Le(S,"internal-error")}})()}_linkToIdToken(S,M){var j=this;return(0,O.A)(function*(){switch(j.signInMethod){case"password":return Gi(S,{idToken:M,returnSecureToken:!0,email:j._email,password:j._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ba);case"emailLink":return function _c(B,S){return Xa.apply(this,arguments)}(S,{idToken:M,email:j._email,oobCode:j._password});default:Le(S,"internal-error")}})()}_getReauthenticationResolver(S){return this._getIdTokenResponse(S)}}function Qo(B,S){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithIdp",sn(B,S))})).apply(this,arguments)}class oa extends eo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(S){const M=new oa(S.providerId,S.signInMethod);return S.idToken||S.accessToken?(S.idToken&&(M.idToken=S.idToken),S.accessToken&&(M.accessToken=S.accessToken),S.nonce&&!S.pendingToken&&(M.nonce=S.nonce),S.pendingToken&&(M.pendingToken=S.pendingToken)):S.oauthToken&&S.oauthTokenSecret?(M.accessToken=S.oauthToken,M.secret=S.oauthTokenSecret):Le("argument-error"),M}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(S){const M="string"==typeof S?JSON.parse(S):S,{providerId:j,signInMethod:fe}=M,We=(0,De.Tt)(M,["providerId","signInMethod"]);if(!j||!fe)return null;const zt=new oa(j,fe);return zt.idToken=We.idToken||void 0,zt.accessToken=We.accessToken||void 0,zt.secret=We.secret,zt.nonce=We.nonce,zt.pendingToken=We.pendingToken||null,zt}_getIdTokenResponse(S){return Qo(S,this.buildRequest())}_linkToIdToken(S,M){const j=this.buildRequest();return j.idToken=M,Qo(S,j)}_getReauthenticationResolver(S){const M=this.buildRequest();return M.autoCreate=!1,Qo(S,M)}buildRequest(){const S={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)S.pendingToken=this.pendingToken;else{const M={};this.idToken&&(M.id_token=this.idToken),this.accessToken&&(M.access_token=this.accessToken),this.secret&&(M.oauth_token_secret=this.secret),M.providerId=this.providerId,this.nonce&&!this.pendingToken&&(M.nonce=this.nonce),S.postBody=(0,ye.Am)(M)}return S}}function Qa(){return(Qa=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:sendVerificationCode",sn(B,S))})).apply(this,arguments)}function So(){return(So=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithPhoneNumber",sn(B,S))})).apply(this,arguments)}function Ul(){return(Ul=(0,O.A)(function*(B,S){const M=yield on(B,"POST","/v1/accounts:signInWithPhoneNumber",sn(B,S));if(M.temporaryProof)throw Ri(B,"account-exists-with-different-credential",M);return M})).apply(this,arguments)}const Ki={USER_NOT_FOUND:"user-not-found"};function aa(){return(aa=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithPhoneNumber",sn(B,Object.assign(Object.assign({},S),{operation:"REAUTH"})),Ki)})).apply(this,arguments)}class Ba extends eo{constructor(S){super("phone","phone"),this.params=S}static _fromVerification(S,M){return new Ba({verificationId:S,verificationCode:M})}static _fromTokenResponse(S,M){return new Ba({phoneNumber:S,temporaryProof:M})}_getIdTokenResponse(S){return function Yc(B,S){return So.apply(this,arguments)}(S,this._makeVerificationRequest())}_linkToIdToken(S,M){return function Vl(B,S){return Ul.apply(this,arguments)}(S,Object.assign({idToken:M},this._makeVerificationRequest()))}_getReauthenticationResolver(S){return function zl(B,S){return aa.apply(this,arguments)}(S,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:S,phoneNumber:M,verificationId:j,verificationCode:fe}=this.params;return S&&M?{temporaryProof:S,phoneNumber:M}:{sessionInfo:j,code:fe}}toJSON(){const S={providerId:this.providerId};return this.params.phoneNumber&&(S.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(S.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(S.verificationCode=this.params.verificationCode),this.params.verificationId&&(S.verificationId=this.params.verificationId),S}static fromJSON(S){"string"==typeof S&&(S=JSON.parse(S));const{verificationId:M,verificationCode:j,phoneNumber:fe,temporaryProof:We}=S;return j||M||fe||We?new Ba({verificationId:M,verificationCode:j,phoneNumber:fe,temporaryProof:We}):null}}class Vo{constructor(S){var M,j,fe,We,zt,fn;const Tn=(0,ye.I9)((0,ye.hp)(S)),ir=null!==(M=Tn.apiKey)&&void 0!==M?M:null,oi=null!==(j=Tn.oobCode)&&void 0!==j?j:null,ai=function Va(B){switch(B){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(fe=Tn.mode)&&void 0!==fe?fe:null);Ge(ir&&oi&&ai,"argument-error"),this.apiKey=ir,this.operation=ai,this.code=oi,this.continueUrl=null!==(We=Tn.continueUrl)&&void 0!==We?We:null,this.languageCode=null!==(zt=Tn.languageCode)&&void 0!==zt?zt:null,this.tenantId=null!==(fn=Tn.tenantId)&&void 0!==fn?fn:null}static parseLink(S){const M=function Vc(B){const S=(0,ye.I9)((0,ye.hp)(B)).link,M=S?(0,ye.I9)((0,ye.hp)(S)).deep_link_id:null,j=(0,ye.I9)((0,ye.hp)(B)).deep_link_id;return(j?(0,ye.I9)((0,ye.hp)(j)).link:null)||j||M||S||B}(S);try{return new Vo(M)}catch{return null}}}let Ya=(()=>{class B{constructor(){this.providerId=B.PROVIDER_ID}static credential(M,j){return qo._fromEmailAndPassword(M,j)}static credentialWithLink(M,j){const fe=Vo.parseLink(j);return Ge(fe,"argument-error"),qo._fromEmailAndCode(M,fe.code,fe.tenantId)}}return B.PROVIDER_ID="password",B.EMAIL_PASSWORD_SIGN_IN_METHOD="password",B.EMAIL_LINK_SIGN_IN_METHOD="emailLink",B})();class Ua{constructor(S){this.providerId=S,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(S){this.defaultLanguageCode=S}setCustomParameters(S){return this.customParameters=S,this}getCustomParameters(){return this.customParameters}}class Sa extends Ua{constructor(){super(...arguments),this.scopes=[]}addScope(S){return this.scopes.includes(S)||this.scopes.push(S),this}getScopes(){return[...this.scopes]}}class ro extends Sa{static credentialFromJSON(S){const M="string"==typeof S?JSON.parse(S):S;return Ge("providerId"in M&&"signInMethod"in M,"argument-error"),oa._fromParams(M)}credential(S){return this._credential(Object.assign(Object.assign({},S),{nonce:S.rawNonce}))}_credential(S){return Ge(S.idToken||S.accessToken,"argument-error"),oa._fromParams(Object.assign(Object.assign({},S),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(S){return ro.oauthCredentialFromTaggedObject(S)}static credentialFromError(S){return ro.oauthCredentialFromTaggedObject(S.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:S}){if(!S)return null;const{oauthIdToken:M,oauthAccessToken:j,oauthTokenSecret:fe,pendingToken:We,nonce:zt,providerId:fn}=S;if(!j&&!fe&&!M&&!We||!fn)return null;try{return new ro(fn)._credential({idToken:M,accessToken:j,nonce:zt,pendingToken:We})}catch{return null}}}let si=(()=>{class B extends Sa{constructor(){super("facebook.com")}static credential(M){return oa._fromParams({providerId:B.PROVIDER_ID,signInMethod:B.FACEBOOK_SIGN_IN_METHOD,accessToken:M})}static credentialFromResult(M){return B.credentialFromTaggedObject(M)}static credentialFromError(M){return B.credentialFromTaggedObject(M.customData||{})}static credentialFromTaggedObject({_tokenResponse:M}){if(!M||!("oauthAccessToken"in M)||!M.oauthAccessToken)return null;try{return B.credential(M.oauthAccessToken)}catch{return null}}}return B.FACEBOOK_SIGN_IN_METHOD="facebook.com",B.PROVIDER_ID="facebook.com",B})(),Aa=(()=>{class B extends Sa{constructor(){super("google.com"),this.addScope("profile")}static credential(M,j){return oa._fromParams({providerId:B.PROVIDER_ID,signInMethod:B.GOOGLE_SIGN_IN_METHOD,idToken:M,accessToken:j})}static credentialFromResult(M){return B.credentialFromTaggedObject(M)}static credentialFromError(M){return B.credentialFromTaggedObject(M.customData||{})}static credentialFromTaggedObject({_tokenResponse:M}){if(!M)return null;const{oauthIdToken:j,oauthAccessToken:fe}=M;if(!j&&!fe)return null;try{return B.credential(j,fe)}catch{return null}}}return B.GOOGLE_SIGN_IN_METHOD="google.com",B.PROVIDER_ID="google.com",B})(),Po=(()=>{class B extends Sa{constructor(){super("github.com")}static credential(M){return oa._fromParams({providerId:B.PROVIDER_ID,signInMethod:B.GITHUB_SIGN_IN_METHOD,accessToken:M})}static credentialFromResult(M){return B.credentialFromTaggedObject(M)}static credentialFromError(M){return B.credentialFromTaggedObject(M.customData||{})}static credentialFromTaggedObject({_tokenResponse:M}){if(!M||!("oauthAccessToken"in M)||!M.oauthAccessToken)return null;try{return B.credential(M.oauthAccessToken)}catch{return null}}}return B.GITHUB_SIGN_IN_METHOD="github.com",B.PROVIDER_ID="github.com",B})();class zi extends eo{constructor(S,M){super(S,S),this.pendingToken=M}_getIdTokenResponse(S){return Qo(S,this.buildRequest())}_linkToIdToken(S,M){const j=this.buildRequest();return j.idToken=M,Qo(S,j)}_getReauthenticationResolver(S){const M=this.buildRequest();return M.autoCreate=!1,Qo(S,M)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(S){const M="string"==typeof S?JSON.parse(S):S,{providerId:j,signInMethod:fe,pendingToken:We}=M;return j&&fe&&We&&j===fe?new zi(j,We):null}static _create(S,M){return new zi(S,M)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Uo extends Ua{constructor(S){Ge(S.startsWith("saml."),"argument-error"),super(S)}static credentialFromResult(S){return Uo.samlCredentialFromTaggedObject(S)}static credentialFromError(S){return Uo.samlCredentialFromTaggedObject(S.customData||{})}static credentialFromJSON(S){const M=zi.fromJSON(S);return Ge(M,"argument-error"),M}static samlCredentialFromTaggedObject({_tokenResponse:S}){if(!S)return null;const{pendingToken:M,providerId:j}=S;if(!M||!j)return null;try{return zi._create(j,M)}catch{return null}}}let za=(()=>{class B extends Sa{constructor(){super("twitter.com")}static credential(M,j){return oa._fromParams({providerId:B.PROVIDER_ID,signInMethod:B.TWITTER_SIGN_IN_METHOD,oauthToken:M,oauthTokenSecret:j})}static credentialFromResult(M){return B.credentialFromTaggedObject(M)}static credentialFromError(M){return B.credentialFromTaggedObject(M.customData||{})}static credentialFromTaggedObject({_tokenResponse:M}){if(!M)return null;const{oauthAccessToken:j,oauthTokenSecret:fe}=M;if(!j||!fe)return null;try{return B.credential(j,fe)}catch{return null}}}return B.TWITTER_SIGN_IN_METHOD="twitter.com",B.PROVIDER_ID="twitter.com",B})();function ns(B,S){return ll.apply(this,arguments)}function ll(){return(ll=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signUp",sn(B,S))})).apply(this,arguments)}class Hi{constructor(S){this.user=S.user,this.providerId=S.providerId,this._tokenResponse=S._tokenResponse,this.operationType=S.operationType}static _fromIdTokenResponse(S,M,j,fe=!1){return(0,O.A)(function*(){const We=yield Mn._fromIdTokenResponse(S,j,fe),zt=cl(j);return new Hi({user:We,providerId:zt,_tokenResponse:j,operationType:M})})()}static _forOperation(S,M,j){return(0,O.A)(function*(){yield S._updateTokensIfNecessary(j,!0);const fe=cl(j);return new Hi({user:S,providerId:fe,_tokenResponse:j,operationType:M})})()}}function cl(B){return B.providerId?B.providerId:"phoneNumber"in B?"phone":null}function Ja(){return(Ja=(0,O.A)(function*(B){var S;const M=Mr(B);if(yield M._initializationPromise,null!==(S=M.currentUser)&&void 0!==S&&S.isAnonymous)return new Hi({user:M.currentUser,providerId:null,operationType:"signIn"});const j=yield ns(M,{returnSecureToken:!0}),fe=yield Hi._fromIdTokenResponse(M,"signIn",j,!0);return yield M._updateCurrentUser(fe.user),fe})).apply(this,arguments)}class da extends ye.g{constructor(S,M,j,fe){var We;super(M.code,M.message),this.operationType=j,this.user=fe,Object.setPrototypeOf(this,da.prototype),this.customData={appName:S.name,tenantId:null!==(We=S.tenantId)&&void 0!==We?We:void 0,_serverResponse:M.customData._serverResponse,operationType:j}}static _fromErrorAndOperation(S,M,j,fe){return new da(S,M,j,fe)}}function vs(B,S,M,j){return("reauthenticate"===S?M._getReauthenticationResolver(B):M._getIdTokenResponse(B)).catch(We=>{throw"auth/multi-factor-auth-required"===We.code?da._fromErrorAndOperation(B,We,S,j):We})}function el(B){return new Set(B.map(({providerId:S})=>S).filter(S=>!!S))}function Sl(){return Sl=(0,O.A)(function*(B,S){const M=(0,ye.Ku)(B);yield Al(!0,M,S);const{providerUserInfo:j}=yield function Bt(B,S){return Ce.apply(this,arguments)}(M.auth,{idToken:yield M.getIdToken(),deleteProvider:[S]}),fe=el(j||[]);return M.providerData=M.providerData.filter(We=>fe.has(We.providerId)),fe.has("phone")||(M.phoneNumber=null),yield M.auth._persistUserIfCurrent(M),M}),Sl.apply(this,arguments)}function wo(B,S){return Mc.apply(this,arguments)}function Mc(){return(Mc=(0,O.A)(function*(B,S,M=!1){const j=yield Zt(B,S._linkToIdToken(B.auth,yield B.getIdToken()),M);return Hi._forOperation(B,"link",j)})).apply(this,arguments)}function Al(B,S,M){return rc.apply(this,arguments)}function rc(){return(rc=(0,O.A)(function*(B,S,M){yield ge(S);const fe=!1===B?"provider-already-linked":"no-such-provider";Ge(el(S.providerData).has(M)===B,S.auth,fe)})).apply(this,arguments)}function Ts(B,S){return jl.apply(this,arguments)}function jl(){return(jl=(0,O.A)(function*(B,S,M=!1){const{auth:j}=B,fe="reauthenticate";try{const We=yield Zt(B,vs(j,fe,S,B),M);Ge(We.idToken,j,"internal-error");const zt=qn(We.idToken);Ge(zt,j,"internal-error");const{sub:fn}=zt;return Ge(B.uid===fn,j,"user-mismatch"),Hi._forOperation(B,fe,We)}catch(We){throw"auth/user-not-found"===We?.code&&Le(j,"user-mismatch"),We}})).apply(this,arguments)}function Uc(B,S){return Cl.apply(this,arguments)}function Cl(){return(Cl=(0,O.A)(function*(B,S,M=!1){const j="signIn",fe=yield vs(B,j,S),We=yield Hi._fromIdTokenResponse(B,j,fe);return M||(yield B._updateCurrentUser(We.user)),We})).apply(this,arguments)}function $l(B,S){return zo.apply(this,arguments)}function zo(){return(zo=(0,O.A)(function*(B,S){return Uc(Mr(B),S)})).apply(this,arguments)}function yc(B,S){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,O.A)(function*(B,S){const M=(0,ye.Ku)(B);return yield Al(!1,M,S.providerId),wo(M,S)})).apply(this,arguments)}function Jc(B,S){return vc.apply(this,arguments)}function vc(){return(vc=(0,O.A)(function*(B,S){return Ts((0,ye.Ku)(B),S)})).apply(this,arguments)}function ic(){return(ic=(0,O.A)(function*(B,S){return on(B,"POST","/v1/accounts:signInWithCustomToken",sn(B,S))})).apply(this,arguments)}function xc(){return xc=(0,O.A)(function*(B,S){const M=Mr(B),j=yield function Gl(B,S){return ic.apply(this,arguments)}(M,{token:S,returnSecureToken:!0}),fe=yield Hi._fromIdTokenResponse(M,"signIn",j);return yield M._updateCurrentUser(fe.user),fe}),xc.apply(this,arguments)}class Bi{constructor(S,M){this.factorId=S,this.uid=M.mfaEnrollmentId,this.enrollmentTime=new Date(M.enrolledAt).toUTCString(),this.displayName=M.displayName}static _fromServerResponse(S,M){return"phoneInfo"in M?$s._fromServerResponse(S,M):"totpInfo"in M?Is._fromServerResponse(S,M):Le(S,"internal-error")}}class $s extends Bi{constructor(S){super("phone",S),this.phoneNumber=S.phoneInfo}static _fromServerResponse(S,M){return new $s(M)}}class Is extends Bi{constructor(S){super("totp",S)}static _fromServerResponse(S,M){return new Is(M)}}function Yo(B,S,M){var j;Ge((null===(j=M.url)||void 0===j?void 0:j.length)>0,B,"invalid-continue-uri"),Ge(typeof M.dynamicLinkDomain>"u"||M.dynamicLinkDomain.length>0,B,"invalid-dynamic-link-domain"),S.continueUrl=M.url,S.dynamicLinkDomain=M.dynamicLinkDomain,S.canHandleCodeInApp=M.handleCodeInApp,M.iOS&&(Ge(M.iOS.bundleId.length>0,B,"missing-ios-bundle-id"),S.iOSBundleId=M.iOS.bundleId),M.android&&(Ge(M.android.packageName.length>0,B,"missing-android-pkg-name"),S.androidInstallApp=M.android.installApp,S.androidMinimumVersionCode=M.android.minimumVersion,S.androidPackageName=M.android.packageName)}function uo(B){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,O.A)(function*(B){const S=Mr(B);S._getPasswordPolicyInternal()&&(yield S._updatePasswordPolicy())})).apply(this,arguments)}function tl(){return(tl=(0,O.A)(function*(B,S,M){const j=Mr(B),fe={requestType:"PASSWORD_RESET",email:S,clientType:"CLIENT_TYPE_WEB"};M&&Yo(j,fe,M),yield Gi(j,fe,"getOobCode",wi)})).apply(this,arguments)}function eu(){return eu=(0,O.A)(function*(B,S,M){yield to((0,ye.Ku)(B),{oobCode:S,newPassword:M}).catch(function(){var j=(0,O.A)(function*(fe){throw"auth/password-does-not-meet-requirements"===fe.code&&uo(B),fe});return function(fe){return j.apply(this,arguments)}}())}),eu.apply(this,arguments)}function sc(){return sc=(0,O.A)(function*(B,S){yield function Ta(B,S){return al.apply(this,arguments)}((0,ye.Ku)(B),{oobCode:S})}),sc.apply(this,arguments)}function os(B,S){return Ec.apply(this,arguments)}function Ec(){return(Ec=(0,O.A)(function*(B,S){const M=(0,ye.Ku)(B),j=yield to(M,{oobCode:S}),fe=j.requestType;switch(Ge(fe,M,"internal-error"),fe){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ge(j.newEmail,M,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ge(j.mfaInfo,M,"internal-error");default:Ge(j.email,M,"internal-error")}let We=null;return j.mfaInfo&&(We=Bi._fromServerResponse(Mr(M),j.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===j.requestType?j.newEmail:j.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===j.requestType?j.email:j.newEmail)||null,multiFactorInfo:We},operation:fe}})).apply(this,arguments)}function yo(){return(yo=(0,O.A)(function*(B,S){const{data:M}=yield os((0,ye.Ku)(B),S);return M.email})).apply(this,arguments)}function hu(){return(hu=(0,O.A)(function*(B,S,M){const j=Mr(B),zt=yield Gi(j,{returnSecureToken:!0,email:S,password:M,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ns).catch(Tn=>{throw"auth/password-does-not-meet-requirements"===Tn.code&&uo(B),Tn}),fn=yield Hi._fromIdTokenResponse(j,"signIn",zt);return yield j._updateCurrentUser(fn.user),fn})).apply(this,arguments)}function gs(){return(gs=(0,O.A)(function*(B,S,M){const j=Mr(B),fe={requestType:"EMAIL_SIGNIN",email:S,clientType:"CLIENT_TYPE_WEB"};(function We(zt,fn){Ge(fn.handleCodeInApp,j,"argument-error"),fn&&Yo(j,zt,fn)})(fe,M),yield Gi(j,fe,"getOobCode",Us)})).apply(this,arguments)}function ya(){return(ya=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B),fe=Ya.credentialWithLink(S,M||Cn());return Ge(fe._tenantId===(j.tenantId||null),j,"tenant-id-mismatch"),$l(j,fe)})).apply(this,arguments)}function ha(){return(ha=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:createAuthUri",sn(B,S))})).apply(this,arguments)}function Rl(){return Rl=(0,O.A)(function*(B,S){const j={identifier:S,continueUri:qt()?Cn():"http://localhost"},{signinMethods:fe}=yield function ac(B,S){return ha.apply(this,arguments)}((0,ye.Ku)(B),j);return fe||[]}),Rl.apply(this,arguments)}function $a(){return $a=(0,O.A)(function*(B,S){const M=(0,ye.Ku)(B),fe={requestType:"VERIFY_EMAIL",idToken:yield B.getIdToken()};S&&Yo(M.auth,fe,S);const{email:We}=yield function hs(B,S){return sa.apply(this,arguments)}(M.auth,fe);We!==B.email&&(yield B.reload())}),$a.apply(this,arguments)}function io(){return io=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B),We={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield B.getIdToken(),newEmail:S};M&&Yo(j.auth,We,M);const{email:zt}=yield function Ei(B,S){return Il.apply(this,arguments)}(j.auth,We);zt!==B.email&&(yield B.reload())}),io.apply(this,arguments)}function Pl(){return(Pl=(0,O.A)(function*(B,S){return mn(B,"POST","/v1/accounts:update",S)})).apply(this,arguments)}function la(){return la=(0,O.A)(function*(B,{displayName:S,photoURL:M}){if(void 0===S&&void 0===M)return;const j=(0,ye.Ku)(B),We={idToken:yield j.getIdToken(),displayName:S,photoUrl:M,returnSecureToken:!0},zt=yield Zt(j,function as(B,S){return Pl.apply(this,arguments)}(j.auth,We));j.displayName=zt.displayName||null,j.photoURL=zt.photoUrl||null;const fn=j.providerData.find(({providerId:Tn})=>"password"===Tn);fn&&(fn.displayName=j.displayName,fn.photoURL=j.photoURL),yield j._updateTokensIfNecessary(zt)}),la.apply(this,arguments)}function va(B,S,M){return Da.apply(this,arguments)}function Da(){return Da=(0,O.A)(function*(B,S,M){const{auth:j}=B,We={idToken:yield B.getIdToken(),returnSecureToken:!0};S&&(We.email=S),M&&(We.password=M);const zt=yield Zt(B,function Bc(B,S){return Tl.apply(this,arguments)}(j,We));yield B._updateTokensIfNecessary(zt,!0)}),Da.apply(this,arguments)}class W{constructor(S,M,j={}){this.isNewUser=S,this.providerId=M,this.profile=j}}class ke extends W{constructor(S,M,j,fe){super(S,M,j),this.username=fe}}class ie extends W{constructor(S,M){super(S,"facebook.com",M)}}class be extends ke{constructor(S,M){super(S,"github.com",M,"string"==typeof M?.login?M?.login:null)}}class wt extends W{constructor(S,M){super(S,"google.com",M)}}class _n extends ke{constructor(S,M,j){super(S,"twitter.com",M,j)}}function Gn(B){const{user:S,_tokenResponse:M}=B;return S.isAnonymous&&!M?{providerId:null,isNewUser:!1,profile:null}:function jc(B){var S,M;if(!B)return null;const{providerId:j}=B,fe=B.rawUserInfo?JSON.parse(B.rawUserInfo):{},We=B.isNewUser||"identitytoolkit#SignupNewUserResponse"===B.kind;if(!j&&B?.idToken){const zt=null===(M=null===(S=qn(B.idToken))||void 0===S?void 0:S.firebase)||void 0===M?void 0:M.sign_in_provider;if(zt)return new W(We,"anonymous"!==zt&&"custom"!==zt?zt:null)}if(!j)return null;switch(j){case"facebook.com":return new ie(We,fe);case"github.com":return new be(We,fe);case"google.com":return new wt(We,fe);case"twitter.com":return new _n(We,fe,B.screenName||null);case"custom":case"anonymous":return new W(We,null);default:return new W(We,j,fe)}}(M)}class Ni{constructor(S,M,j){this.type=S,this.credential=M,this.user=j}static _fromIdtoken(S,M){return new Ni("enroll",S,M)}static _fromMfaPendingCredential(S){return new Ni("signin",S)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(S){var M,j;if(S?.multiFactorSession){if(null!==(M=S.multiFactorSession)&&void 0!==M&&M.pendingCredential)return Ni._fromMfaPendingCredential(S.multiFactorSession.pendingCredential);if(null!==(j=S.multiFactorSession)&&void 0!==j&&j.idToken)return Ni._fromIdtoken(S.multiFactorSession.idToken)}return null}}class js{constructor(S,M,j){this.session=S,this.hints=M,this.signInResolver=j}static _fromError(S,M){const j=Mr(S),fe=M.customData._serverResponse,We=(fe.mfaInfo||[]).map(fn=>Bi._fromServerResponse(j,fn));Ge(fe.mfaPendingCredential,j,"internal-error");const zt=Ni._fromMfaPendingCredential(fe.mfaPendingCredential);return new js(zt,We,function(){var fn=(0,O.A)(function*(Tn){const ir=yield Tn._process(j,zt);delete fe.mfaInfo,delete fe.mfaPendingCredential;const oi=Object.assign(Object.assign({},fe),{idToken:ir.idToken,refreshToken:ir.refreshToken});switch(M.operationType){case"signIn":const ai=yield Hi._fromIdTokenResponse(j,M.operationType,oi);return yield j._updateCurrentUser(ai.user),ai;case"reauthenticate":return Ge(M.user,j,"internal-error"),Hi._forOperation(M.user,M.operationType,oi);default:Le(j,"internal-error")}});return function(Tn){return fn.apply(this,arguments)}}())}resolveSignIn(S){var M=this;return(0,O.A)(function*(){return M.signInResolver(S)})()}}class dl{constructor(S){this.user=S,this.enrolledFactors=[],S._onReload(M=>{M.mfaInfo&&(this.enrolledFactors=M.mfaInfo.map(j=>Bi._fromServerResponse(S.auth,j)))})}static _fromUser(S){return new dl(S)}getSession(){var S=this;return(0,O.A)(function*(){return Ni._fromIdtoken(yield S.user.getIdToken(),S.user)})()}enroll(S,M){var j=this;return(0,O.A)(function*(){const fe=S,We=yield j.getSession(),zt=yield Zt(j.user,fe._process(j.user.auth,We,M));return yield j.user._updateTokensIfNecessary(zt),j.user.reload()})()}unenroll(S){var M=this;return(0,O.A)(function*(){const j="string"==typeof S?S:S.uid,fe=yield M.user.getIdToken();try{const We=yield Zt(M.user,function Si(B,S){return mn(B,"POST","/v2/accounts/mfaEnrollment:withdraw",sn(B,S))}(M.user.auth,{idToken:fe,mfaEnrollmentId:j}));M.enrolledFactors=M.enrolledFactors.filter(({uid:zt})=>zt!==j),yield M.user._updateTokensIfNecessary(We),yield M.user.reload()}catch(We){throw We}})()}}const Kl=new WeakMap,Xs="__sak";class Rc{constructor(S,M){this.storageRetriever=S,this.type=M}_isAvailable(){try{return this.storage?(this.storage.setItem(Xs,"1"),this.storage.removeItem(Xs),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(S,M){return this.storage.setItem(S,JSON.stringify(M)),Promise.resolve()}_get(S){const M=this.storage.getItem(S);return Promise.resolve(M?JSON.parse(M):null)}_remove(S){return this.storage.removeItem(S),Promise.resolve()}get storage(){return this.storageRetriever()}}const fa=(()=>{class B extends Rc{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(M,j)=>this.onStorageEvent(M,j),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Zl(){const B=(0,ye.ZQ)();return ra(B)||gi(B)}()&&function ut(){try{return!(!window||window===window.top)}catch{return!1}}(),this.fallbackToPolling=_i(),this._shouldAllowMigration=!0}forAllChangedKeys(M){for(const j of Object.keys(this.listeners)){const fe=this.storage.getItem(j),We=this.localCache[j];fe!==We&&M(j,We,fe)}}onStorageEvent(M,j=!1){if(!M.key)return void this.forAllChangedKeys((fn,Tn,ir)=>{this.notifyListeners(fn,ir)});const fe=M.key;if(j?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const fn=this.storage.getItem(fe);if(M.newValue!==fn)null!==M.newValue?this.storage.setItem(fe,M.newValue):this.storage.removeItem(fe);else if(this.localCache[fe]===M.newValue&&!j)return}const We=()=>{const fn=this.storage.getItem(fe);!j&&this.localCache[fe]===fn||this.notifyListeners(fe,fn)},zt=this.storage.getItem(fe);!function ws(){return(0,ye.lT)()&&10===document.documentMode}()||zt===M.newValue||M.newValue===M.oldValue?We():setTimeout(We,10)}notifyListeners(M,j){this.localCache[M]=j;const fe=this.listeners[M];if(fe)for(const We of Array.from(fe))We(j&&JSON.parse(j))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((M,j,fe)=>{this.onStorageEvent(new StorageEvent("storage",{key:M,oldValue:j,newValue:fe}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(M,j){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[M]||(this.listeners[M]=new Set,this.localCache[M]=this.storage.getItem(M)),this.listeners[M].add(j)}_removeListener(M,j){this.listeners[M]&&(this.listeners[M].delete(j),0===this.listeners[M].size&&delete this.listeners[M]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(M,j){var fe=()=>super._set,We=this;return(0,O.A)(function*(){yield fe().call(We,M,j),We.localCache[M]=JSON.stringify(j)})()}_get(M){var j=()=>super._get,fe=this;return(0,O.A)(function*(){const We=yield j().call(fe,M);return fe.localCache[M]=JSON.stringify(We),We})()}_remove(M){var j=()=>super._remove,fe=this;return(0,O.A)(function*(){yield j().call(fe,M),delete fe.localCache[M]})()}}return B.type="LOCAL",B})(),Ss=(()=>{class B extends Rc{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(M,j){}_removeListener(M,j){}}return B.type="SESSION",B})();let cc=(()=>{class B{constructor(M){this.eventTarget=M,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(M){const j=this.receivers.find(We=>We.isListeningto(M));if(j)return j;const fe=new B(M);return this.receivers.push(fe),fe}isListeningto(M){return this.eventTarget===M}handleEvent(M){var j=this;return(0,O.A)(function*(){const fe=M,{eventId:We,eventType:zt,data:fn}=fe.data,Tn=j.handlersMap[zt];if(!Tn?.size)return;fe.ports[0].postMessage({status:"ack",eventId:We,eventType:zt});const ir=Array.from(Tn).map(function(){var ai=(0,O.A)(function*(ks){return ks(fe.origin,fn)});return function(ks){return ai.apply(this,arguments)}}()),oi=yield function Oi(B){return Promise.all(B.map(function(){var S=(0,O.A)(function*(M){try{return{fulfilled:!0,value:yield M}}catch(j){return{fulfilled:!1,reason:j}}});return function(M){return S.apply(this,arguments)}}()))}(ir);fe.ports[0].postMessage({status:"done",eventId:We,eventType:zt,response:oi})})()}_subscribe(M,j){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[M]||(this.handlersMap[M]=new Set),this.handlersMap[M].add(j)}_unsubscribe(M,j){this.handlersMap[M]&&j&&this.handlersMap[M].delete(j),(!j||0===this.handlersMap[M].size)&&delete this.handlersMap[M],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return B.receivers=[],B})();function ta(B="",S=10){let M="";for(let j=0;j<S;j++)M+=Math.floor(10*Math.random());return B+M}class vo{constructor(S){this.target=S,this.handlers=new Set}removeMessageHandler(S){S.messageChannel&&(S.messageChannel.port1.removeEventListener("message",S.onMessage),S.messageChannel.port1.close()),this.handlers.delete(S)}_send(S,M,j=50){var fe=this;return(0,O.A)(function*(){const We=typeof MessageChannel<"u"?new MessageChannel:null;if(!We)throw new Error("connection_unavailable");let zt,fn;return new Promise((Tn,ir)=>{const oi=ta("",20);We.port1.start();const ai=setTimeout(()=>{ir(new Error("unsupported_event"))},j);fn={messageChannel:We,onMessage(ks){const Nc=ks;if(Nc.data.eventId===oi)switch(Nc.data.status){case"ack":clearTimeout(ai),zt=setTimeout(()=>{ir(new Error("timeout"))},3e3);break;case"done":clearTimeout(zt),Tn(Nc.data.response);break;default:clearTimeout(ai),clearTimeout(zt),ir(new Error("invalid_response"))}}},fe.handlers.add(fn),We.port1.addEventListener("message",fn.onMessage),fe.target.postMessage({eventType:S,eventId:oi,data:M},[We.port2])}).finally(()=>{fn&&fe.removeMessageHandler(fn)})})()}}function zn(){return window}function As(){return typeof zn().WorkerGlobalScope<"u"&&"function"==typeof zn().importScripts}function pr(){return(pr=(0,O.A)(function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})).apply(this,arguments)}const dr="firebaseLocalStorageDb",Un="firebaseLocalStorage",Ao="fbase_key";class Cr{constructor(S){this.request=S}toPromise(){return new Promise((S,M)=>{this.request.addEventListener("success",()=>{S(this.request.result)}),this.request.addEventListener("error",()=>{M(this.request.error)})})}}function pu(B,S){return B.transaction([Un],S?"readwrite":"readonly").objectStore(Un)}function bc(){const B=indexedDB.open(dr,1);return new Promise((S,M)=>{B.addEventListener("error",()=>{M(B.error)}),B.addEventListener("upgradeneeded",()=>{const j=B.result;try{j.createObjectStore(Un,{keyPath:Ao})}catch(fe){M(fe)}}),B.addEventListener("success",(0,O.A)(function*(){const j=B.result;j.objectStoreNames.contains(Un)?S(j):(j.close(),yield function $c(){const B=indexedDB.deleteDatabase(dr);return new Cr(B).toPromise()}(),S(yield bc()))}))})}function uc(B,S,M){return vr.apply(this,arguments)}function vr(){return(vr=(0,O.A)(function*(B,S,M){const j=pu(B,!0).put({[Ao]:S,value:M});return new Cr(j).toPromise()})).apply(this,arguments)}function _d(){return(_d=(0,O.A)(function*(B,S){const M=pu(B,!1).get(S),j=yield new Cr(M).toPromise();return void 0===j?null:j.value})).apply(this,arguments)}function yd(B,S){const M=pu(B,!0).delete(S);return new Cr(M).toPromise()}const Pc=(()=>{class B{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var M=this;return(0,O.A)(function*(){return M.db||(M.db=yield bc()),M.db})()}_withRetries(M){var j=this;return(0,O.A)(function*(){let fe=0;for(;;)try{const We=yield j._openDb();return yield M(We)}catch(We){if(fe++>3)throw We;j.db&&(j.db.close(),j.db=void 0)}})()}initializeServiceWorkerMessaging(){var M=this;return(0,O.A)(function*(){return As()?M.initializeReceiver():M.initializeSender()})()}initializeReceiver(){var M=this;return(0,O.A)(function*(){M.receiver=cc._getInstance(function $u(){return As()?self:null}()),M.receiver._subscribe("keyChanged",function(){var j=(0,O.A)(function*(fe,We){return{keyProcessed:(yield M._poll()).includes(We.key)}});return function(fe,We){return j.apply(this,arguments)}}()),M.receiver._subscribe("ping",function(){var j=(0,O.A)(function*(fe,We){return["keyChanged"]});return function(fe,We){return j.apply(this,arguments)}}())})()}initializeSender(){var M=this;return(0,O.A)(function*(){var j,fe;if(M.activeServiceWorker=yield function fu(){return pr.apply(this,arguments)}(),!M.activeServiceWorker)return;M.sender=new vo(M.activeServiceWorker);const We=yield M.sender._send("ping",{},800);We&&null!==(j=We[0])&&void 0!==j&&j.fulfilled&&null!==(fe=We[0])&&void 0!==fe&&fe.value.includes("keyChanged")&&(M.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(M){var j=this;return(0,O.A)(function*(){if(j.sender&&j.activeServiceWorker&&function zr(){var B;return(null===(B=navigator?.serviceWorker)||void 0===B?void 0:B.controller)||null}()===j.activeServiceWorker)try{yield j.sender._send("keyChanged",{key:M},j.serviceWorkerReceiverAvailable?800:50)}catch{}})()}_isAvailable(){return(0,O.A)(function*(){try{if(!indexedDB)return!1;const M=yield bc();return yield uc(M,Xs,"1"),yield yd(M,Xs),!0}catch{}return!1})()}_withPendingWrite(M){var j=this;return(0,O.A)(function*(){j.pendingWrites++;try{yield M()}finally{j.pendingWrites--}})()}_set(M,j){var fe=this;return(0,O.A)(function*(){return fe._withPendingWrite((0,O.A)(function*(){return yield fe._withRetries(We=>uc(We,M,j)),fe.localCache[M]=j,fe.notifyServiceWorker(M)}))})()}_get(M){var j=this;return(0,O.A)(function*(){const fe=yield j._withRetries(We=>function Su(B,S){return _d.apply(this,arguments)}(We,M));return j.localCache[M]=fe,fe})()}_remove(M){var j=this;return(0,O.A)(function*(){return j._withPendingWrite((0,O.A)(function*(){return yield j._withRetries(fe=>yd(fe,M)),delete j.localCache[M],j.notifyServiceWorker(M)}))})()}_poll(){var M=this;return(0,O.A)(function*(){const j=yield M._withRetries(zt=>{const fn=pu(zt,!1).getAll();return new Cr(fn).toPromise()});if(!j)return[];if(0!==M.pendingWrites)return[];const fe=[],We=new Set;if(0!==j.length)for(const{fbase_key:zt,value:fn}of j)We.add(zt),JSON.stringify(M.localCache[zt])!==JSON.stringify(fn)&&(M.notifyListeners(zt,fn),fe.push(zt));for(const zt of Object.keys(M.localCache))M.localCache[zt]&&!We.has(zt)&&(M.notifyListeners(zt,null),fe.push(zt));return fe})()}notifyListeners(M,j){this.localCache[M]=j;const fe=this.listeners[M];if(fe)for(const We of Array.from(fe))We(j)}startPolling(){var M=this;this.stopPolling(),this.pollTimer=setInterval((0,O.A)(function*(){return M._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(M,j){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[M]||(this.listeners[M]=new Set,this._get(M)),this.listeners[M].add(j)}_removeListener(M,j){this.listeners[M]&&(this.listeners[M].delete(j),0===this.listeners[M].size&&delete this.listeners[M]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return B.type="LOCAL",B})(),c=1e12;class n{constructor(S){this.auth=S,this.counter=c,this._widgets=new Map}render(S,M){const j=this.counter;return this._widgets.set(j,new a(S,this.auth.name,M||{})),this.counter++,j}reset(S){var M;const j=S||c;null===(M=this._widgets.get(j))||void 0===M||M.delete(),this._widgets.delete(j)}getResponse(S){var M;return(null===(M=this._widgets.get(S||c))||void 0===M?void 0:M.getResponse())||""}execute(S){var M=this;return(0,O.A)(function*(){var j;return null===(j=M._widgets.get(S||c))||void 0===j||j.execute(),""})()}}class a{constructor(S,M,j){this.params=j,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const fe="string"==typeof S?document.getElementById(S):S;Ge(fe,"argument-error",{appName:M}),this.container=fe,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function p(B){const S=[],M="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let j=0;j<B;j++)S.push(M.charAt(Math.floor(62*Math.random())));return S.join("")}(50);const{callback:S,"expired-callback":M}=this.params;if(S)try{S(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,M)try{M()}catch{}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const y=Ci("rcb"),w=new Pt(3e4,6e4);class C{constructor(){var S;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(S=zn().grecaptcha)||void 0===S||!S.render)}load(S,M=""){return Ge(function P(B){return B.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(B)}(M),S,"argument-error"),this.shouldResolveImmediately(M)&&nr(zn().grecaptcha)?Promise.resolve(zn().grecaptcha):new Promise((j,fe)=>{const We=zn().setTimeout(()=>{fe(Te(S,"network-request-failed"))},w.get());zn()[y]=()=>{zn().clearTimeout(We),delete zn()[y];const fn=zn().grecaptcha;if(!fn||!nr(fn))return void fe(Te(S,"internal-error"));const Tn=fn.render;fn.render=(ir,oi)=>{const ai=Tn(ir,oi);return this.counter++,ai},this.hostLanguage=M,j(fn)},Vs(`${function gr(){return xi.recaptchaV2Script}()}?${(0,ye.Am)({onload:y,render:"explicit",hl:M})}`).catch(()=>{clearTimeout(We),fe(Te(S,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(S){var M;return!(null===(M=zn().grecaptcha)||void 0===M||!M.render)&&(S===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class V{load(S){return(0,O.A)(function*(){return new n(S)})()}clearedOneInstance(){}}const K="recaptcha",Y={theme:"light",type:"image"};class ce{constructor(S,M,j=Object.assign({},Y)){this.parameters=j,this.type=K,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Mr(S),this.isInvisible="invisible"===this.parameters.size,Ge(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const fe="string"==typeof M?document.getElementById(M):M;Ge(fe,this.auth,"argument-error"),this.container=fe,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new V:new C,this.validateStartingState()}verify(){var S=this;return(0,O.A)(function*(){S.assertNotDestroyed();const M=yield S.render(),j=S.getAssertedRecaptcha();return j.getResponse(M)||new Promise(We=>{const zt=fn=>{fn&&(S.tokenChangeListeners.delete(zt),We(fn))};S.tokenChangeListeners.add(zt),S.isInvisible&&j.execute(M)})})()}render(){try{this.assertNotDestroyed()}catch(S){return Promise.reject(S)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(S=>{throw this.renderPromise=null,S})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(S=>{this.container.removeChild(S)})}validateStartingState(){Ge(!this.parameters.sitekey,this.auth,"argument-error"),Ge(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ge(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(S){return M=>{if(this.tokenChangeListeners.forEach(j=>j(M)),"function"==typeof S)S(M);else if("string"==typeof S){const j=zn()[S];"function"==typeof j&&j(M)}}}assertNotDestroyed(){Ge(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var S=this;return(0,O.A)(function*(){if(yield S.init(),!S.widgetId){let M=S.container;if(!S.isInvisible){const j=document.createElement("div");M.appendChild(j),M=j}S.widgetId=S.getAssertedRecaptcha().render(M,S.parameters)}return S.widgetId})()}init(){var S=this;return(0,O.A)(function*(){Ge(qt()&&!As(),S.auth,"internal-error"),yield function Pe(){let B=null;return new Promise(S=>{"complete"!==document.readyState?(B=()=>S(),window.addEventListener("load",B)):S()}).catch(S=>{throw B&&window.removeEventListener("load",B),S})}(),S.recaptcha=yield S._recaptchaLoader.load(S.auth,S.auth.languageCode||void 0);const M=yield function Zn(B){return us.apply(this,arguments)}(S.auth);Ge(M,S.auth,"internal-error"),S.parameters.sitekey=M})()}getAssertedRecaptcha(){return Ge(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ke{constructor(S,M){this.verificationId=S,this.onConfirmation=M}confirm(S){const M=Ba._fromVerification(this.verificationId,S);return this.onConfirmation(M)}}function rt(){return(rt=(0,O.A)(function*(B,S,M){const j=Mr(B),fe=yield mt(j,S,(0,ye.Ku)(M));return new Ke(fe,We=>$l(j,We))})).apply(this,arguments)}function pe(){return(pe=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B);yield Al(!1,j,"phone");const fe=yield mt(j.auth,S,(0,ye.Ku)(M));return new Ke(fe,We=>yc(j,We))})).apply(this,arguments)}function gt(){return(gt=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B),fe=yield mt(j.auth,S,(0,ye.Ku)(M));return new Ke(fe,We=>Jc(j,We))})).apply(this,arguments)}function mt(B,S,M){return Ut.apply(this,arguments)}function Ut(){return Ut=(0,O.A)(function*(B,S,M){var j;const fe=yield M.verify();try{let We;if(Ge("string"==typeof fe,B,"argument-error"),Ge(M.type===K,B,"argument-error"),We="string"==typeof S?{phoneNumber:S}:S,"session"in We){const zt=We.session;if("phoneNumber"in We)return Ge("enroll"===zt.type,B,"internal-error"),(yield function rl(B,S){return mn(B,"POST","/v2/accounts/mfaEnrollment:start",sn(B,S))}(B,{idToken:zt.credential,phoneEnrollmentInfo:{phoneNumber:We.phoneNumber,recaptchaToken:fe}})).phoneSessionInfo.sessionInfo;{Ge("signin"===zt.type,B,"internal-error");const fn=(null===(j=We.multiFactorHint)||void 0===j?void 0:j.uid)||We.multiFactorUid;return Ge(fn,B,"missing-multi-factor-info"),(yield function nh(B,S){return mn(B,"POST","/v2/accounts/mfaSignIn:start",sn(B,S))}(B,{mfaPendingCredential:zt.credential,mfaEnrollmentId:fn,phoneSignInInfo:{recaptchaToken:fe}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:zt}=yield function Bl(B,S){return Qa.apply(this,arguments)}(B,{phoneNumber:We.phoneNumber,recaptchaToken:fe});return zt}}finally{M._reset()}}),Ut.apply(this,arguments)}function It(){return(It=(0,O.A)(function*(B,S){yield wo((0,ye.Ku)(B),S)})).apply(this,arguments)}let tn=(()=>{class B{constructor(M){this.providerId=B.PROVIDER_ID,this.auth=Mr(M)}verifyPhoneNumber(M,j){return mt(this.auth,M,(0,ye.Ku)(j))}static credential(M,j){return Ba._fromVerification(M,j)}static credentialFromResult(M){return B.credentialFromTaggedObject(M)}static credentialFromError(M){return B.credentialFromTaggedObject(M.customData||{})}static credentialFromTaggedObject({_tokenResponse:M}){if(!M)return null;const{phoneNumber:j,temporaryProof:fe}=M;return j&&fe?Ba._fromTokenResponse(j,fe):null}}return B.PROVIDER_ID="phone",B.PHONE_SIGN_IN_METHOD="phone",B})();function Kt(B,S){return S?wr(S):(Ge(B._popupRedirectResolver,B,"argument-error"),B._popupRedirectResolver)}class ln extends eo{constructor(S){super("custom","custom"),this.params=S}_getIdTokenResponse(S){return Qo(S,this._buildIdpRequest())}_linkToIdToken(S,M){return Qo(S,this._buildIdpRequest(M))}_getReauthenticationResolver(S){return Qo(S,this._buildIdpRequest())}_buildIdpRequest(S){const M={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return S&&(M.idToken=S),M}}function rr(B){return Uc(B.auth,new ln(B),B.bypassAuthState)}function cn(B){const{auth:S,user:M}=B;return Ge(M,S,"internal-error"),Ts(M,new ln(B),B.bypassAuthState)}function Dn(B){return an.apply(this,arguments)}function an(){return(an=(0,O.A)(function*(B){const{auth:S,user:M}=B;return Ge(M,S,"internal-error"),wo(M,new ln(B),B.bypassAuthState)})).apply(this,arguments)}class Kn{constructor(S,M,j,fe,We=!1){this.auth=S,this.resolver=j,this.user=fe,this.bypassAuthState=We,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(M)?M:[M]}execute(){var S=this;return new Promise(function(){var M=(0,O.A)(function*(j,fe){S.pendingPromise={resolve:j,reject:fe};try{S.eventManager=yield S.resolver._initialize(S.auth),yield S.onExecution(),S.eventManager.registerConsumer(S)}catch(We){S.reject(We)}});return function(j,fe){return M.apply(this,arguments)}}())}onAuthEvent(S){var M=this;return(0,O.A)(function*(){const{urlResponse:j,sessionId:fe,postBody:We,tenantId:zt,error:fn,type:Tn}=S;if(fn)return void M.reject(fn);const ir={auth:M.auth,requestUri:j,sessionId:fe,tenantId:zt||void 0,postBody:We||void 0,user:M.user,bypassAuthState:M.bypassAuthState};try{M.resolve(yield M.getIdpTask(Tn)(ir))}catch(oi){M.reject(oi)}})()}onError(S){this.reject(S)}getIdpTask(S){switch(S){case"signInViaPopup":case"signInViaRedirect":return rr;case"linkViaPopup":case"linkViaRedirect":return Dn;case"reauthViaPopup":case"reauthViaRedirect":return cn;default:Le(this.auth,"internal-error")}}resolve(S){bn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(S),this.unregisterAndCleanUp()}reject(S){bn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(S),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const dn=new Pt(2e3,1e4);function Nn(){return(Nn=(0,O.A)(function*(B,S,M){const j=Mr(B);Ze(B,S,Ua);const fe=Kt(j,M);return new Br(j,"signInViaPopup",S,fe).executeNotNull()})).apply(this,arguments)}function Yn(){return(Yn=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B);Ze(j.auth,S,Ua);const fe=Kt(j.auth,M);return new Br(j.auth,"reauthViaPopup",S,fe,j).executeNotNull()})).apply(this,arguments)}function bi(){return(bi=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B);Ze(j.auth,S,Ua);const fe=Kt(j.auth,M);return new Br(j.auth,"linkViaPopup",S,fe,j).executeNotNull()})).apply(this,arguments)}let Br=(()=>{class B extends Kn{constructor(M,j,fe,We,zt){super(M,j,We,zt),this.provider=fe,this.authWindow=null,this.pollId=null,B.currentPopupAction&&B.currentPopupAction.cancel(),B.currentPopupAction=this}executeNotNull(){var M=this;return(0,O.A)(function*(){const j=yield M.execute();return Ge(j,M.auth,"internal-error"),j})()}onExecution(){var M=this;return(0,O.A)(function*(){bn(1===M.filter.length,"Popup operations only handle one event");const j=ta();M.authWindow=yield M.resolver._openPopup(M.auth,M.provider,M.filter[0],j),M.authWindow.associatedEvent=j,M.resolver._originValidation(M.auth).catch(fe=>{M.reject(fe)}),M.resolver._isIframeWebStorageSupported(M.auth,fe=>{fe||M.reject(Te(M.auth,"web-storage-unsupported"))}),M.pollUserCancellation()})()}get eventId(){var M;return(null===(M=this.authWindow)||void 0===M?void 0:M.associatedEvent)||null}cancel(){this.reject(Te(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,B.currentPopupAction=null}pollUserCancellation(){const M=()=>{var j,fe;this.pollId=null!==(fe=null===(j=this.authWindow)||void 0===j?void 0:j.window)&&void 0!==fe&&fe.closed?window.setTimeout(()=>{this.pollId=null,this.reject(Te(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(M,dn.get())};M()}}return B.currentPopupAction=null,B})();const R="pendingRedirect",L=new Map;class $ extends Kn{constructor(S,M,j=!1){super(S,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],M,void 0,j),this.eventId=null}execute(){var S=()=>super.execute,M=this;return(0,O.A)(function*(){let j=L.get(M.auth._key());if(!j){try{const We=(yield function ee(B,S){return Ee.apply(this,arguments)}(M.resolver,M.auth))?yield S().call(M):null;j=()=>Promise.resolve(We)}catch(fe){j=()=>Promise.reject(fe)}L.set(M.auth._key(),j)}return M.bypassAuthState||L.set(M.auth._key(),()=>Promise.resolve(null)),j()})()}onAuthEvent(S){var M=()=>super.onAuthEvent,j=this;return(0,O.A)(function*(){if("signInViaRedirect"===S.type)return M().call(j,S);if("unknown"!==S.type){if(S.eventId){const fe=yield j.auth._redirectUserForId(S.eventId);if(fe)return j.user=fe,M().call(j,S);j.resolve(null)}}else j.resolve(null)})()}onExecution(){return(0,O.A)(function*(){})()}cleanUp(){}}function Ee(){return(Ee=(0,O.A)(function*(B,S){const M=Rn(S),j=gn(B);if(!(yield j._isAvailable()))return!1;const fe="true"===(yield j._get(M));return yield j._remove(M),fe})).apply(this,arguments)}function st(B,S){return Et.apply(this,arguments)}function Et(){return(Et=(0,O.A)(function*(B,S){return gn(B)._set(Rn(S),"true")})).apply(this,arguments)}function Lt(B,S){L.set(B._key(),S)}function gn(B){return wr(B._redirectPersistence)}function Rn(B){return $i(R,B.config.apiKey,B.name)}function kn(B,S,M){return function Bn(B,S,M){return Jn.apply(this,arguments)}(B,S,M)}function Jn(){return(Jn=(0,O.A)(function*(B,S,M){const j=Mr(B);Ze(B,S,Ua),yield j._initializationPromise;const fe=Kt(j,M);return yield st(fe,j),fe._openRedirect(j,S,"signInViaRedirect")})).apply(this,arguments)}function er(B,S,M){return function Vr(B,S,M){return ui.apply(this,arguments)}(B,S,M)}function ui(){return(ui=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B);Ze(j.auth,S,Ua),yield j.auth._initializationPromise;const fe=Kt(j.auth,M);yield st(fe,j.auth);const We=yield Mi(j);return fe._openRedirect(j.auth,S,"reauthViaRedirect",We)})).apply(this,arguments)}function Yt(B,S,M){return function Tr(B,S,M){return Hs.apply(this,arguments)}(B,S,M)}function Hs(){return(Hs=(0,O.A)(function*(B,S,M){const j=(0,ye.Ku)(B);Ze(j.auth,S,Ua),yield j.auth._initializationPromise;const fe=Kt(j.auth,M);yield Al(!1,j,S.providerId),yield st(fe,j.auth);const We=yield Mi(j);return fe._openRedirect(j.auth,S,"linkViaRedirect",We)})).apply(this,arguments)}function mi(){return(mi=(0,O.A)(function*(B,S){return yield Mr(B)._initializationPromise,Yr(B,S,!1)})).apply(this,arguments)}function Yr(B,S){return ri.apply(this,arguments)}function ri(){return(ri=(0,O.A)(function*(B,S,M=!1){const j=Mr(B),fe=Kt(j,S),zt=yield new $(j,fe,M).execute();return zt&&!M&&(delete zt.user._redirectEventId,yield j._persistUserIfCurrent(zt.user),yield j._setRedirectUser(null,S)),zt})).apply(this,arguments)}function Mi(B){return po.apply(this,arguments)}function po(){return(po=(0,O.A)(function*(B){const S=ta(`${B.uid}:::`);return B._redirectEventId=S,yield B.auth._setRedirectUser(B),yield B.auth._persistUserIfCurrent(B),S})).apply(this,arguments)}class ls{constructor(S){this.auth=S,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(S){this.consumers.add(S),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,S)&&(this.sendToConsumer(this.queuedRedirectEvent,S),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(S){this.consumers.delete(S)}onEvent(S){if(this.hasEventBeenHandled(S))return!1;let M=!1;return this.consumers.forEach(j=>{this.isEventForConsumer(S,j)&&(M=!0,this.sendToConsumer(S,j),this.saveEventToCache(S))}),this.hasHandledPotentialRedirect||!function Qs(B){switch(B.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Yi(B);default:return!1}}(S)||(this.hasHandledPotentialRedirect=!0,M||(this.queuedRedirectEvent=S,M=!0)),M}sendToConsumer(S,M){var j;if(S.error&&!Yi(S)){const fe=(null===(j=S.error.code)||void 0===j?void 0:j.split("auth/")[1])||"internal-error";M.onError(Te(this.auth,fe))}else M.onAuthEvent(S)}isEventForConsumer(S,M){const j=null===M.eventId||!!S.eventId&&S.eventId===M.eventId;return M.filter.includes(S.type)&&j}hasEventBeenHandled(S){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Rs(S))}saveEventToCache(S){this.cachedEventUids.add(Rs(S)),this.lastProcessedEventTime=Date.now()}}function Rs(B){return[B.type,B.eventId,B.sessionId,B.tenantId].filter(S=>S).join("-")}function Yi({type:B,error:S}){return"unknown"===B&&"auth/no-auth-event"===S?.code}function ko(B){return ps.apply(this,arguments)}function ps(){return(ps=(0,O.A)(function*(B,S={}){return mn(B,"GET","/v1/projects",S)})).apply(this,arguments)}const Ma=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xo=/^https?/;function Ha(){return(Ha=(0,O.A)(function*(B){if(B.config.emulator)return;const{authorizedDomains:S}=yield ko(B);for(const M of S)try{if(Tc(M))return}catch{}Le(B,"unauthorized-domain")})).apply(this,arguments)}function Tc(B){const S=Cn(),{protocol:M,hostname:j}=new URL(S);if(B.startsWith("chrome-extension://")){const zt=new URL(B);return""===zt.hostname&&""===j?"chrome-extension:"===M&&B.replace("chrome-extension://","")===S.replace("chrome-extension://",""):"chrome-extension:"===M&&zt.hostname===j}if(!xo.test(M))return!1;if(Ma.test(B))return j===B;const fe=B.replace(/\./g,"\\.");return new RegExp("^(.+\\."+fe+"|"+fe+")$","i").test(j)}const No=new Pt(3e4,6e4);function fl(){const B=zn().___jsl;if(B?.H)for(const S of Object.keys(B.H))if(B.H[S].r=B.H[S].r||[],B.H[S].L=B.H[S].L||[],B.H[S].r=[...B.H[S].L],B.CP)for(let M=0;M<B.CP.length;M++)B.CP[M]=null}let tu=null;const Nh=new Pt(5e3,15e3),mo="__/auth/iframe",kl="emulator/auth/iframe",Oc={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pl=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Nl(B){const S=B.config;Ge(S.authDomain,B,"auth-domain-config-required");const M=S.emulator?Qe(S,kl):`https://${B.config.authDomain}/${mo}`,j={apiKey:S.apiKey,appName:B.name,v:m.SDK_VERSION},fe=pl.get(B.config.apiHost);fe&&(j.eid=fe);const We=B._getFrameworks();return We.length&&(j.fw=We.join(",")),`${M}?${(0,ye.Am)(j).slice(1)}`}function pa(){return pa=(0,O.A)(function*(B){const S=yield function Cu(B){return tu=tu||function mu(B){return new Promise((S,M)=>{var j,fe,We;function zt(){fl(),gapi.load("gapi.iframes",{callback:()=>{S(gapi.iframes.getContext())},ontimeout:()=>{fl(),M(Te(B,"network-request-failed"))},timeout:No.get()})}if(null!==(fe=null===(j=zn().gapi)||void 0===j?void 0:j.iframes)&&void 0!==fe&&fe.Iframe)S(gapi.iframes.getContext());else{if(null===(We=zn().gapi)||void 0===We||!We.load){const fn=Ci("iframefcb");return zn()[fn]=()=>{gapi.load?zt():M(Te(B,"network-request-failed"))},Vs(`${function qr(){return xi.gapiScript}()}?onload=${fn}`).catch(Tn=>M(Tn))}zt()}}).catch(S=>{throw tu=null,S})}(B),tu}(B),M=zn().gapi;return Ge(M,B,"internal-error"),S.open({where:document.body,url:Nl(B),messageHandlersFilter:M.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Oc,dontclear:!0},j=>new Promise(function(){var fe=(0,O.A)(function*(We,zt){yield j.restyle({setHideOnLeave:!1});const fn=Te(B,"network-request-failed"),Tn=zn().setTimeout(()=>{zt(fn)},Nh.get());function ir(){zn().clearTimeout(Tn),We(j)}j.ping(ir).then(ir,()=>{zt(fn)})});return function(We,zt){return fe.apply(this,arguments)}}()))}),pa.apply(this,arguments)}const Lh={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Ic{constructor(S){this.window=S,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}const To="__/auth/handler",go="emulator/auth/handler",ii=encodeURIComponent("fac");function Ll(B,S,M,j,fe,We){return Fh.apply(this,arguments)}function Fh(){return(Fh=(0,O.A)(function*(B,S,M,j,fe,We){Ge(B.config.authDomain,B,"auth-domain-config-required"),Ge(B.config.apiKey,B,"invalid-api-key");const zt={apiKey:B.config.apiKey,appName:B.name,authType:M,redirectUrl:j,v:m.SDK_VERSION,eventId:fe};if(S instanceof Ua){S.setDefaultLanguage(B.languageCode),zt.providerId=S.providerId||"",(0,ye.Im)(S.getCustomParameters())||(zt.customParameters=JSON.stringify(S.getCustomParameters()));for(const[oi,ai]of Object.entries(We||{}))zt[oi]=ai}if(S instanceof Sa){const oi=S.getScopes().filter(ai=>""!==ai);oi.length>0&&(zt.scopes=oi.join(","))}B.tenantId&&(zt.tid=B.tenantId);const fn=zt;for(const oi of Object.keys(fn))void 0===fn[oi]&&delete fn[oi];const Tn=yield B._getAppCheckToken(),ir=Tn?`#${ii}=${encodeURIComponent(Tn)}`:"";return`${function Sc({config:B}){return B.emulator?Qe(B,go):`https://${B.authDomain}/${To}`}(B)}?${(0,ye.Am)(fn).slice(1)}${ir}`})).apply(this,arguments)}const Vd="webStorageSupport",$o=class Bh{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ss,this._completeRedirectFn=Yr,this._overrideRedirectResult=Lt}_openPopup(S,M,j,fe){var We=this;return(0,O.A)(function*(){var zt;bn(null===(zt=We.eventManagers[S._key()])||void 0===zt?void 0:zt.manager,"_initialize() not called before _openPopup()");const fn=yield Ll(S,M,j,Cn(),fe);return function rs(B,S,M,j=500,fe=600){const We=Math.max((window.screen.availHeight-fe)/2,0).toString(),zt=Math.max((window.screen.availWidth-j)/2,0).toString();let fn="";const Tn=Object.assign(Object.assign({},Lh),{width:j.toString(),height:fe.toString(),top:We,left:zt}),ir=(0,ye.ZQ)().toLowerCase();M&&(fn=wa(ir)?"_blank":M),Bs(ir)&&(S=S||"http://localhost",Tn.scrollbars="yes");const oi=Object.entries(Tn).reduce((ks,[Nc,hh])=>`${ks}${Nc}=${hh},`,"");if(function ki(B=(0,ye.ZQ)()){var S;return gi(B)&&!(null===(S=window.navigator)||void 0===S||!S.standalone)}(ir)&&"_self"!==fn)return function ru(B,S){const M=document.createElement("a");M.href=B,M.target=S;const j=document.createEvent("MouseEvent");j.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),M.dispatchEvent(j)}(S||"",fn),new Ic(null);const ai=window.open(S||"",fn,oi);Ge(ai,B,"popup-blocked");try{ai.focus()}catch{}return new Ic(ai)}(S,fn,ta())})()}_openRedirect(S,M,j,fe){var We=this;return(0,O.A)(function*(){return yield We._originValidation(S),function Gs(B){zn().location.href=B}(yield Ll(S,M,j,Cn(),fe)),new Promise(()=>{})})()}_initialize(S){const M=S._key();if(this.eventManagers[M]){const{manager:fe,promise:We}=this.eventManagers[M];return fe?Promise.resolve(fe):(bn(We,"If manager is not set, promise should be"),We)}const j=this.initAndGetManager(S);return this.eventManagers[M]={promise:j},j.catch(()=>{delete this.eventManagers[M]}),j}initAndGetManager(S){var M=this;return(0,O.A)(function*(){const j=yield function ml(B){return pa.apply(this,arguments)}(S),fe=new ls(S);return j.register("authEvent",We=>(Ge(We?.authEvent,S,"invalid-auth-event"),{status:fe.onEvent(We.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),M.eventManagers[S._key()]={manager:fe},M.iframes[S._key()]=j,fe})()}_isIframeWebStorageSupported(S,M){this.iframes[S._key()].send(Vd,{type:Vd},fe=>{var We;const zt=null===(We=fe?.[0])||void 0===We?void 0:We[Vd];void 0!==zt&&M(!!zt),Le(S,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(S){const M=S._key();return this.originValidationPromises[M]||(this.originValidationPromises[M]=function oo(B){return Ha.apply(this,arguments)}(S)),this.originValidationPromises[M]}get _shouldInitProactively(){return _i()||ra()||gi()}};class Vh{constructor(S){this.factorId=S}_process(S,M,j){switch(M.type){case"enroll":return this._finalizeEnroll(S,M.credential,j);case"signin":return this._finalizeSignIn(S,M.credential);default:return nn("unexpected MultiFactorSessionType")}}}class Eo extends Vh{constructor(S){super("phone"),this.credential=S}static _fromCredential(S){return new Eo(S)}_finalizeEnroll(S,M,j){return function qi(B,S){return mn(B,"POST","/v2/accounts/mfaEnrollment:finalize",sn(B,S))}(S,{idToken:M,displayName:j,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(S,M){return function Oo(B,S){return mn(B,"POST","/v2/accounts/mfaSignIn:finalize",sn(B,S))}(S,{mfaPendingCredential:M,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Du=(()=>{class B{constructor(){}static assertion(M){return Eo._fromCredential(M)}}return B.FACTOR_ID="phone",B})();var vp="@firebase/auth";class Lo{constructor(S){this.auth=S,this.internalListeners=new Map}getUid(){var S;return this.assertAuthConfigured(),(null===(S=this.auth.currentUser)||void 0===S?void 0:S.uid)||null}getToken(S){var M=this;return(0,O.A)(function*(){return M.assertAuthConfigured(),yield M.auth._initializationPromise,M.auth.currentUser?{accessToken:yield M.auth.currentUser.getIdToken(S)}:null})()}addAuthTokenListener(S){if(this.assertAuthConfigured(),this.internalListeners.has(S))return;const M=this.auth.onIdTokenChanged(j=>{S(j?.stsTokenManager.accessToken||null)});this.internalListeners.set(S,M),this.updateProactiveRefresh()}removeAuthTokenListener(S){this.assertAuthConfigured();const M=this.internalListeners.get(S);M&&(this.internalListeners.delete(S),M(),this.updateProactiveRefresh())}assertAuthConfigured(){Ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function dc(){return window}(0,ye.XA)("authIdTokenMaxAge"),function Ds(B){xi=B}({loadJS:B=>new Promise((S,M)=>{const j=document.createElement("script");j.setAttribute("src",B),j.onload=S,j.onerror=fe=>{const We=Te("internal-error");We.customData=fe,M(We)},j.type="text/javascript",j.charset="UTF-8",function xd(){var B,S;return null!==(S=null===(B=document.getElementsByTagName("head"))||void 0===B?void 0:B[0])&&void 0!==S?S:document}().appendChild(j)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),function zh(B){(0,m._registerComponent)(new Be.uA("auth",(S,{options:M})=>{const j=S.getProvider("app").getImmediate(),fe=S.getProvider("heartbeat"),We=S.getProvider("app-check-internal"),{apiKey:zt,authDomain:fn}=j.options;Ge(zt&&!zt.includes(":"),"invalid-api-key",{appName:j.name});const Tn={apiKey:zt,authDomain:fn,clientPlatform:B,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Dt(B)},ir=new ei(j,fe,We,Tn);return function Wo(B,S){const M=S?.persistence||[],j=(Array.isArray(M)?M:[M]).map(wr);S?.errorMap&&B._updateErrorMap(S.errorMap),B._initializeWithPersistence(j,S?.popupRedirectResolver)}(ir,M),ir},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((S,M,j)=>{S.getProvider("auth-internal").initialize()})),(0,m._registerComponent)(new Be.uA("auth-internal",S=>{const M=Mr(S.getProvider("auth").getImmediate());return new Lo(M)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,m.registerVersion)(vp,"1.6.2",function Uh(B){switch(B){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(B)),(0,m.registerVersion)(vp,"1.6.2","esm2017")}("Browser");function Gc(){return Gc=(0,O.A)(function*(B,S,M){var j;const{BuildInfo:fe}=dc();bn(S.sessionId,"AuthEvent did not contain a session ID");const We=yield function Ed(B){return Ud.apply(this,arguments)}(S.sessionId),zt={};return gi()?zt.ibi=fe.packageName:Jt()?zt.apn=fe.packageName:Le(B,"operation-not-supported-in-this-environment"),fe.displayName&&(zt.appDisplayName=fe.displayName),zt.sessionId=We,Ll(B,M,S.type,void 0,null!==(j=S.eventId)&&void 0!==j?j:void 0,zt)}),Gc.apply(this,arguments)}function ua(){return(ua=(0,O.A)(function*(B){const{BuildInfo:S}=dc(),M={};gi()?M.iosBundleId=S.packageName:Jt()?M.androidPackageName=S.packageName:Le(B,"operation-not-supported-in-this-environment"),yield ko(B,M)})).apply(this,arguments)}function su(){return(su=(0,O.A)(function*(B,S,M){const{cordova:j}=dc();let fe=()=>{};try{yield new Promise((We,zt)=>{let fn=null;function Tn(){var ai;We();const ks=null===(ai=j.plugins.browsertab)||void 0===ai?void 0:ai.close;"function"==typeof ks&&ks(),"function"==typeof M?.close&&M.close()}function ir(){fn||(fn=window.setTimeout(()=>{zt(Te(B,"redirect-cancelled-by-user"))},2e3))}function oi(){"visible"===document?.visibilityState&&ir()}S.addPassiveListener(Tn),document.addEventListener("resume",ir,!1),Jt()&&document.addEventListener("visibilitychange",oi,!1),fe=()=>{S.removePassiveListener(Tn),document.removeEventListener("resume",ir,!1),document.removeEventListener("visibilitychange",oi,!1),fn&&window.clearTimeout(fn)}})}finally{fe()}})).apply(this,arguments)}function Ud(){return(Ud=(0,O.A)(function*(B){const S=function Hh(B){if(bn(/[0-9a-zA-Z]+/.test(B),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(B);const S=new ArrayBuffer(B.length),M=new Uint8Array(S);for(let j=0;j<B.length;j++)M[j]=B.charCodeAt(j);return M}(B),M=yield crypto.subtle.digest("SHA-256",S);return Array.from(new Uint8Array(M)).map(fe=>fe.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}class xp extends ls{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(S=>{this.resolveInialized=S})}addPassiveListener(S){this.passiveListeners.add(S)}removePassiveListener(S){this.passiveListeners.delete(S)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(S){return this.resolveInialized(),this.passiveListeners.forEach(M=>M(S)),super.onEvent(S)}initialized(){var S=this;return(0,O.A)(function*(){yield S.initPromise})()}}function ah(B){return ou.apply(this,arguments)}function ou(){return(ou=(0,O.A)(function*(B){const S=yield sd()._get(ma(B));return S&&(yield sd()._remove(ma(B))),S})).apply(this,arguments)}function Of(){const B=[];for(let M=0;M<20;M++){const j=Math.floor(62*Math.random());B.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(j))}return B.join("")}function sd(){return wr(fa)}function ma(B){return $i("authEvent",B.config.apiKey,B.name)}function bd(B){if(!B?.includes("?"))return{};const[S,...M]=B.split("?");return(0,ye.I9)(M.join("?"))}const lh=class Wh{constructor(){this._redirectPersistence=Ss,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Yr,this._overrideRedirectResult=Lt}_initialize(S){var M=this;return(0,O.A)(function*(){const j=S._key();let fe=M.eventManagers.get(j);return fe||(fe=new xp(S),M.eventManagers.set(j,fe),M.attachCallbackListeners(S,fe)),fe})()}_openPopup(S){Le(S,"operation-not-supported-in-this-environment")}_openRedirect(S,M,j,fe){var We=this;return(0,O.A)(function*(){!function Gh(B){var S,M,j,fe,We,zt,fn,Tn,ir,oi;const ai=dc();Ge("function"==typeof(null===(S=ai?.universalLinks)||void 0===S?void 0:S.subscribe),B,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Ge(typeof(null===(M=ai?.BuildInfo)||void 0===M?void 0:M.packageName)<"u",B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Ge("function"==typeof(null===(We=null===(fe=null===(j=ai?.cordova)||void 0===j?void 0:j.plugins)||void 0===fe?void 0:fe.browsertab)||void 0===We?void 0:We.openUrl),B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ge("function"==typeof(null===(Tn=null===(fn=null===(zt=ai?.cordova)||void 0===zt?void 0:zt.plugins)||void 0===fn?void 0:fn.browsertab)||void 0===Tn?void 0:Tn.isAvailable),B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ge("function"==typeof(null===(oi=null===(ir=ai?.cordova)||void 0===ir?void 0:ir.InAppBrowser)||void 0===oi?void 0:oi.open),B,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(S);const zt=yield We._initialize(S);yield zt.initialized(),zt.resetRedirect(),function en(){L.clear()}(),yield We._originValidation(S);const fn=function Ep(B,S,M=null){return{type:S,eventId:M,urlResponse:null,sessionId:Of(),postBody:null,tenantId:B.tenantId,error:Te(B,"no-auth-event")}}(S,j,fe);yield function id(B,S){return sd()._set(ma(B),S)}(S,fn);const Tn=yield function Ac(B,S,M){return Gc.apply(this,arguments)}(S,fn,M),ir=yield function Pf(B){const{cordova:S}=dc();return new Promise(M=>{S.plugins.browsertab.isAvailable(j=>{let fe=null;j?S.plugins.browsertab.openUrl(B):fe=S.InAppBrowser.open(B,function Ii(B=(0,ye.ZQ)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(B)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(B)}()?"_blank":"_system","location=yes"),M(fe)})})}(Tn);return function oh(B,S,M){return su.apply(this,arguments)}(S,zt,ir)})()}_isIframeWebStorageSupported(S,M){throw new Error("Method not implemented.")}_originValidation(S){const M=S._key();return this.originValidationPromises[M]||(this.originValidationPromises[M]=function Ru(B){return ua.apply(this,arguments)}(S)),this.originValidationPromises[M]}attachCallbackListeners(S,M){const{universalLinks:j,handleOpenURL:fe,BuildInfo:We}=dc(),zt=setTimeout((0,O.A)(function*(){yield ah(S),M.onEvent(kc())}),500),fn=function(){var oi=(0,O.A)(function*(ai){clearTimeout(zt);const ks=yield ah(S);let Nc=null;ks&&ai?.url&&(Nc=function Zm(B,S){var M,j;const fe=function Wa(B){const S=bd(B),M=S.link?decodeURIComponent(S.link):void 0,j=bd(M).link,fe=S.deep_link_id?decodeURIComponent(S.deep_link_id):void 0;return bd(fe).link||fe||j||M||B}(S);if(fe.includes("/__/auth/callback")){const We=bd(fe),zt=We.firebaseError?function wd(B){try{return JSON.parse(B)}catch{return null}}(decodeURIComponent(We.firebaseError)):null,fn=null===(j=null===(M=zt?.code)||void 0===M?void 0:M.split("auth/"))||void 0===j?void 0:j[1],Tn=fn?Te(fn):null;return Tn?{type:B.type,eventId:B.eventId,tenantId:B.tenantId,error:Tn,urlResponse:null,sessionId:null,postBody:null}:{type:B.type,eventId:B.eventId,tenantId:B.tenantId,sessionId:B.sessionId,urlResponse:fe,postBody:null}}return null}(ks,ai.url)),M.onEvent(Nc||kc())});return function(ks){return oi.apply(this,arguments)}}();typeof j<"u"&&"function"==typeof j.subscribe&&j.subscribe(null,fn);const Tn=fe,ir=`${We.packageName.toLowerCase()}://`;dc().handleOpenURL=function(){var oi=(0,O.A)(function*(ai){if(ai.toLowerCase().startsWith(ir)&&fn({url:ai}),"function"==typeof Tn)try{Tn(ai)}catch(ks){console.error(ks)}});return function(ai){return oi.apply(this,arguments)}}()}};function kc(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Te("no-auth-event")}}function Xl(){var B;return(null===(B=self?.location)||void 0===B?void 0:B.protocol)||null}function Kh(B=(0,ye.ZQ)()){return!("file:"!==Xl()&&"ionic:"!==Xl()&&"capacitor:"!==Xl()||!B.toLowerCase().match(/iphone|ipad|ipod|android/))}function _u(){try{const B=self.localStorage,S=ta();if(B)return B.setItem(S,"1"),B.removeItem(S),!function Wu(B=(0,ye.ZQ)()){return function Xm(){return(0,ye.lT)()&&11===document?.documentMode}()||function gu(B=(0,ye.ZQ)()){return/Edge\/\d+/.test(B)}(B)}()||(0,ye.zW)()}catch{return wp()&&(0,ye.zW)()}return!1}function wp(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function bp(){return(function Hc(){return"http:"===Xl()||"https:"===Xl()}()||(0,ye.sr)()||Kh())&&!function Zh(){return(0,ye.lV)()||(0,ye.Ll)()}()&&_u()&&!wp()}function Os(){return Kh()&&typeof document<"u"}function jd(){return(jd=(0,O.A)(function*(){return!!Os()&&new Promise(B=>{const S=setTimeout(()=>{B(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(S),B(!0)})})})).apply(this,arguments)}const hc={LOCAL:"local",NONE:"none",SESSION:"session"},qu=Ge,ch="persistence";function Wc(B){return uh.apply(this,arguments)}function uh(){return(uh=(0,O.A)(function*(B){yield B._initializationPromise;const S=yu(),M=$i(ch,B.config.apiKey,B.name);S&&S.setItem(M,B._getPersistence())})).apply(this,arguments)}function yu(){var B;try{return(null===(B=function Ql(){return typeof window<"u"?window:null}())||void 0===B?void 0:B.sessionStorage)||null}catch{return null}}const fm=Ge;class Cc{constructor(){this.browserResolver=wr($o),this.cordovaResolver=wr(lh),this.underlyingResolver=null,this._redirectPersistence=Ss,this._completeRedirectFn=Yr,this._overrideRedirectResult=Lt}_initialize(S){var M=this;return(0,O.A)(function*(){return yield M.selectUnderlyingResolver(),M.assertedUnderlyingResolver._initialize(S)})()}_openPopup(S,M,j,fe){var We=this;return(0,O.A)(function*(){return yield We.selectUnderlyingResolver(),We.assertedUnderlyingResolver._openPopup(S,M,j,fe)})()}_openRedirect(S,M,j,fe){var We=this;return(0,O.A)(function*(){return yield We.selectUnderlyingResolver(),We.assertedUnderlyingResolver._openRedirect(S,M,j,fe)})()}_isIframeWebStorageSupported(S,M){this.assertedUnderlyingResolver._isIframeWebStorageSupported(S,M)}_originValidation(S){return this.assertedUnderlyingResolver._originValidation(S)}get _shouldInitProactively(){return Os()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return fm(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var S=this;return(0,O.A)(function*(){if(S.underlyingResolver)return;const M=yield function Nf(){return jd.apply(this,arguments)}();S.underlyingResolver=M?S.cordovaResolver:S.browserResolver})()}}function pm(B){return B.unwrap()}function f_(B){return Xh(B)}function Xh(B){const{_tokenResponse:S}=B instanceof ye.g?B.customData:B;if(!S)return null;if(!(B instanceof ye.g)&&"temporaryProof"in S&&"phoneNumber"in S)return tn.credentialFromResult(B);const M=S.providerId;if(!M||M===xe.PASSWORD)return null;let j;switch(M){case xe.GOOGLE:j=Aa;break;case xe.FACEBOOK:j=si;break;case xe.GITHUB:j=Po;break;case xe.TWITTER:j=za;break;default:const{oauthIdToken:fe,oauthAccessToken:We,oauthTokenSecret:zt,pendingToken:fn,nonce:Tn}=S;return We||zt||fe||fn?fn?M.startsWith("saml.")?zi._create(M,fn):oa._fromParams({providerId:M,signInMethod:M,pendingToken:fn,idToken:fe,accessToken:We}):new ro(M).credential({idToken:fe,accessToken:We,rawNonce:Tn}):null}return B instanceof ye.g?j.credentialFromError(B):j.credentialFromResult(B)}function _l(B,S){return S.catch(M=>{throw M instanceof ye.g&&function Ff(B,S){var M;const j=null===(M=S.customData)||void 0===M?void 0:M._tokenResponse;if("auth/multi-factor-auth-required"===S?.code)S.resolver=new au(B,function ea(B,S){var M;const j=(0,ye.Ku)(B),fe=S;return Ge(S.customData.operationType,j,"argument-error"),Ge(null===(M=fe.customData._serverResponse)||void 0===M?void 0:M.mfaPendingCredential,j,"argument-error"),js._fromError(j,fe)}(B,S));else if(j){const fe=Xh(S),We=S;fe&&(We.credential=fe,We.tenantId=j.tenantId||void 0,We.email=j.email||void 0,We.phoneNumber=j.phoneNumber||void 0)}}(B,M),M}).then(M=>{const fe=M.user;return{operationType:M.operationType,credential:f_(M),additionalUserInfo:Gn(M),user:yl.getOrCreate(fe)}})}function Ws(B,S){return Co.apply(this,arguments)}function Co(){return(Co=(0,O.A)(function*(B,S){const M=yield S;return{verificationId:M.verificationId,confirm:j=>_l(B,M.confirm(j))}})).apply(this,arguments)}class au{constructor(S,M){this.resolver=M,this.auth=function Lf(B){return B.wrapped()}(S)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(S){return _l(pm(this.auth),this.resolver.resolveSignIn(S))}}class yl{constructor(S){this._delegate=S,this.multiFactor=function Ol(B){const S=(0,ye.Ku)(B);return Kl.has(S)||Kl.set(S,dl._fromUser(S)),Kl.get(S)}(S)}static getOrCreate(S){return yl.USER_MAP.has(S)||yl.USER_MAP.set(S,new yl(S)),yl.USER_MAP.get(S)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(S){return this._delegate.getIdTokenResult(S)}getIdToken(S){return this._delegate.getIdToken(S)}linkAndRetrieveDataWithCredential(S){return this.linkWithCredential(S)}linkWithCredential(S){var M=this;return(0,O.A)(function*(){return _l(M.auth,yc(M._delegate,S))})()}linkWithPhoneNumber(S,M){var j=this;return(0,O.A)(function*(){return Ws(j.auth,function ot(B,S,M){return pe.apply(this,arguments)}(j._delegate,S,M))})()}linkWithPopup(S){var M=this;return(0,O.A)(function*(){return _l(M.auth,function Xr(B,S,M){return bi.apply(this,arguments)}(M._delegate,S,Cc))})()}linkWithRedirect(S){var M=this;return(0,O.A)(function*(){return yield Wc(Mr(M.auth)),Yt(M._delegate,S,Cc)})()}reauthenticateAndRetrieveDataWithCredential(S){return this.reauthenticateWithCredential(S)}reauthenticateWithCredential(S){var M=this;return(0,O.A)(function*(){return _l(M.auth,Jc(M._delegate,S))})()}reauthenticateWithPhoneNumber(S,M){return Ws(this.auth,function he(B,S,M){return gt.apply(this,arguments)}(this._delegate,S,M))}reauthenticateWithPopup(S){return _l(this.auth,function Wn(B,S,M){return Yn.apply(this,arguments)}(this._delegate,S,Cc))}reauthenticateWithRedirect(S){var M=this;return(0,O.A)(function*(){return yield Wc(Mr(M.auth)),er(M._delegate,S,Cc)})()}sendEmailVerification(S){return function ho(B,S){return $a.apply(this,arguments)}(this._delegate,S)}unlink(S){var M=this;return(0,O.A)(function*(){return yield function uu(B,S){return Sl.apply(this,arguments)}(M._delegate,S),M})()}updateEmail(S){return function ul(B,S){return va((0,ye.Ku)(B),S,null)}(this._delegate,S)}updatePassword(S){return function lc(B,S){return va((0,ye.Ku)(B),null,S)}(this._delegate,S)}updatePhoneNumber(S){return function jt(B,S){return It.apply(this,arguments)}(this._delegate,S)}updateProfile(S){return function Ls(B,S){return la.apply(this,arguments)}(this._delegate,S)}verifyBeforeUpdateEmail(S,M){return function wc(B,S,M){return io.apply(this,arguments)}(this._delegate,S,M)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}yl.USER_MAP=new WeakMap;const fc=Ge;let qa=(()=>{class B{constructor(M,j){if(this.app=M,j.isInitialized())return this._delegate=j.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:fe}=M.options;fc(fe,"invalid-api-key",{appName:M.name}),fc(fe,"invalid-api-key",{appName:M.name});const We=typeof window<"u"?Cc:void 0;this._delegate=j.initialize({options:{persistence:Ip(fe,M.name),popupRedirectResolver:We}}),this._delegate._updateErrorMap(je),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?yl.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(M){this._delegate.languageCode=M}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(M){this._delegate.tenantId=M}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(M,j){!function gc(B,S,M){const j=Mr(B);Ge(j._canInitEmulator,j,"emulator-config-failed"),Ge(/^https?:\/\//.test(S),j,"invalid-emulator-scheme");const fe=!!M?.disableWarnings,We=Iu(S),{host:zt,port:fn}=function bl(B){const S=Iu(B),M=/(\/\/)?([^?#/]+)/.exec(B.substr(S.length));if(!M)return{host:"",port:null};const j=M[2].split("@").pop()||"",fe=/^(\[[^\]]+\])(:|$)/.exec(j);if(fe){const We=fe[1];return{host:We,port:Fi(j.substr(We.length+1))}}{const[We,zt]=j.split(":");return{host:We,port:Fi(zt)}}}(S);j.config.emulator={url:`${We}//${zt}${null===fn?"":`:${fn}`}/`},j.settings.appVerificationDisabledForTesting=!0,j.emulatorConfig=Object.freeze({host:zt,port:fn,protocol:We.replace(":",""),options:Object.freeze({disableWarnings:fe})}),fe||function Nr(){function B(){const S=document.createElement("p"),M=S.style;S.innerText="Running in emulator mode. Do not use with production credentials.",M.position="fixed",M.width="100%",M.backgroundColor="#ffffff",M.border=".1em solid #000000",M.color="#b50000",M.bottom="0px",M.left="0px",M.margin="0px",M.zIndex="10000",M.textAlign="center",S.classList.add("firebase-emulator-warning"),document.body.appendChild(S)}typeof console<"u"&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",B):B())}()}(this._delegate,M,j)}applyActionCode(M){return function nl(B,S){return sc.apply(this,arguments)}(this._delegate,M)}checkActionCode(M){return os(this._delegate,M)}confirmPasswordReset(M,j){return function du(B,S,M){return eu.apply(this,arguments)}(this._delegate,M,j)}createUserWithEmailAndPassword(M,j){var fe=this;return(0,O.A)(function*(){return _l(fe._delegate,function Hl(B,S,M){return hu.apply(this,arguments)}(fe._delegate,M,j))})()}fetchProvidersForEmail(M){return this.fetchSignInMethodsForEmail(M)}fetchSignInMethodsForEmail(M){return function ql(B,S){return Rl.apply(this,arguments)}(this._delegate,M)}isSignInWithEmailLink(M){return function Wl(B,S){const M=Vo.parseLink(S);return"EMAIL_SIGNIN"===M?.operation}(0,M)}getRedirectResult(){var M=this;return(0,O.A)(function*(){fc(bp(),M._delegate,"operation-not-supported-in-this-environment");const j=yield function Ms(B,S){return mi.apply(this,arguments)}(M._delegate,Cc);return j?_l(M._delegate,Promise.resolve(j)):{credential:null,user:null}})()}addFrameworkForLogging(M){!function kf(B,S){Mr(B)._logFramework(S)}(this._delegate,M)}onAuthStateChanged(M,j,fe){const{next:We,error:zt,complete:fn}=Ka(M,j,fe);return this._delegate.onAuthStateChanged(We,zt,fn)}onIdTokenChanged(M,j,fe){const{next:We,error:zt,complete:fn}=Ka(M,j,fe);return this._delegate.onIdTokenChanged(We,zt,fn)}sendSignInLinkToEmail(M,j){return function Ps(B,S,M){return gs.apply(this,arguments)}(this._delegate,M,j)}sendPasswordResetEmail(M,j){return function Ml(B,S,M){return tl.apply(this,arguments)}(this._delegate,M,j||void 0)}setPersistence(M){var j=this;return(0,O.A)(function*(){let fe;switch(function Tp(B,S){qu(Object.values(hc).includes(S),B,"invalid-persistence-type"),(0,ye.lV)()?qu(S!==hc.SESSION,B,"unsupported-persistence-type"):(0,ye.Ll)()?qu(S===hc.NONE,B,"unsupported-persistence-type"):wp()?qu(S===hc.NONE||S===hc.LOCAL&&(0,ye.zW)(),B,"unsupported-persistence-type"):qu(S===hc.NONE||_u(),B,"unsupported-persistence-type")}(j._delegate,M),M){case hc.SESSION:fe=Ss;break;case hc.LOCAL:fe=(yield wr(Pc)._isAvailable())?Pc:fa;break;case hc.NONE:fe=Li;break;default:return Le("argument-error",{appName:j._delegate.name})}return j._delegate.setPersistence(fe)})()}signInAndRetrieveDataWithCredential(M){return this.signInWithCredential(M)}signInAnonymously(){return _l(this._delegate,function nc(B){return Ja.apply(this,arguments)}(this._delegate))}signInWithCredential(M){return _l(this._delegate,$l(this._delegate,M))}signInWithCustomToken(M){return _l(this._delegate,function Dl(B,S){return xc.apply(this,arguments)}(this._delegate,M))}signInWithEmailAndPassword(M,j){return _l(this._delegate,function oc(B,S,M){return $l((0,ye.Ku)(B),Ya.credential(S,M)).catch(function(){var j=(0,O.A)(function*(fe){throw"auth/password-does-not-meet-requirements"===fe.code&&uo(B),fe});return function(fe){return j.apply(this,arguments)}}())}(this._delegate,M,j))}signInWithEmailLink(M,j){return _l(this._delegate,function ja(B,S,M){return ya.apply(this,arguments)}(this._delegate,M,j))}signInWithPhoneNumber(M,j){return Ws(this._delegate,function Ye(B,S,M){return rt.apply(this,arguments)}(this._delegate,M,j))}signInWithPopup(M){var j=this;return(0,O.A)(function*(){return fc(bp(),j._delegate,"operation-not-supported-in-this-environment"),_l(j._delegate,function Ln(B,S,M){return Nn.apply(this,arguments)}(j._delegate,M,Cc))})()}signInWithRedirect(M){var j=this;return(0,O.A)(function*(){return fc(bp(),j._delegate,"operation-not-supported-in-this-environment"),yield Wc(j._delegate),kn(j._delegate,M,Cc)})()}updateCurrentUser(M){return this._delegate.updateCurrentUser(M)}verifyPasswordResetCode(M){return function zc(B,S){return yo.apply(this,arguments)}(this._delegate,M)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return B.Persistence=hc,B})();function Ka(B,S,M){let j=B;"function"!=typeof B&&({next:j,error:S,complete:M}=B);const fe=j;return{next:zt=>fe(zt&&yl.getOrCreate(zt)),error:S,complete:M}}function Ip(B,S){const M=function Pu(B,S){const M=yu();if(!M)return[];const j=$i(ch,B,S);switch(M.getItem(j)){case hc.NONE:return[Li];case hc.LOCAL:return[Pc,Ss];case hc.SESSION:return[Ss];default:return[]}}(B,S);if(typeof self<"u"&&!M.includes(Pc)&&M.push(Pc),typeof window<"u")for(const j of[fa,Ss])M.includes(j)||M.push(j);return M.includes(Li)||M.push(Li),M}class xa{constructor(){this.providerId="phone",this._delegate=new tn(pm(z.A.auth()))}static credential(S,M){return tn.credential(S,M)}verifyPhoneNumber(S,M){return this._delegate.verifyPhoneNumber(S,M)}unwrap(){return this._delegate}}xa.PHONE_SIGN_IN_METHOD=tn.PHONE_SIGN_IN_METHOD,xa.PROVIDER_ID=tn.PROVIDER_ID;const dh=Ge;class qc{constructor(S,M,j=z.A.app()){var fe;dh(null===(fe=j.options)||void 0===fe?void 0:fe.apiKey,"invalid-api-key",{appName:j.name}),this._delegate=new ce(j.auth(),S,M),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Qh(B){B.INTERNAL.registerComponent(new Be.uA("auth-compat",S=>{const M=S.getProvider("app-compat").getImmediate(),j=S.getProvider("auth");return new qa(M,j)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Ya,FacebookAuthProvider:si,GithubAuthProvider:Po,GoogleAuthProvider:Aa,OAuthProvider:ro,SAMLAuthProvider:Uo,PhoneAuthProvider:xa,PhoneMultiFactorGenerator:Du,RecaptchaVerifier:qc,TwitterAuthProvider:za,Auth:qa,AuthCredential:eo,Error:ye.g}).setInstantiationMode("LAZY").setMultipleInstances(!1)),B.registerVersion("@firebase/auth-compat","0.5.4")}(z.A)},345:(An,xt,H)=>{"use strict";H.d(xt,{Bb:()=>Ri,hE:()=>Er,sG:()=>Or,up:()=>ci});var O=H(4438),z=H(177);class ye extends z.VF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class m extends ye{static makeCurrent(){(0,z.ZD)(new m)}onAndCancel(Ie,we,Je){return Ie.addEventListener(we,Je),()=>{Ie.removeEventListener(we,Je)}}dispatchEvent(Ie,we){Ie.dispatchEvent(we)}remove(Ie){Ie.parentNode&&Ie.parentNode.removeChild(Ie)}createElement(Ie,we){return(we=we||this.getDefaultDocument()).createElement(Ie)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Ie){return Ie.nodeType===Node.ELEMENT_NODE}isShadowRoot(Ie){return Ie instanceof DocumentFragment}getGlobalEventTarget(Ie,we){return"window"===we?window:"document"===we?Ie:"body"===we?Ie.body:null}getBaseHref(Ie){const we=function De(){return ae=ae||document.querySelector("base"),ae?ae.getAttribute("href"):null}();return null==we?null:function Be(Re){return new URL(Re,document.baseURI).pathname}(we)}resetBaseElement(){ae=null}getUserAgent(){return window.navigator.userAgent}getCookie(Ie){return(0,z._b)(document.cookie,Ie)}}let ae=null,xe=(()=>{class Re{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(Je){return new(Je||Re)};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac})}return Re})();const se=new O.nKC("");let me=(()=>{class Re{constructor(we,Je){this._zone=Je,this._eventNameToPlugin=new Map,we.forEach(Ae=>{Ae.manager=this}),this._plugins=we.slice().reverse()}addEventListener(we,Je,Ae){return this._findPluginFor(Je).addEventListener(we,Je,Ae)}getZone(){return this._zone}_findPluginFor(we){let Je=this._eventNameToPlugin.get(we);if(Je)return Je;if(Je=this._plugins.find(Ne=>Ne.supports(we)),!Je)throw new O.wOt(5101,!1);return this._eventNameToPlugin.set(we,Je),Je}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(se),O.KVO(O.SKi))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac})}return Re})();class He{constructor(Ie){this._doc=Ie}}const qe="ng-app-id";let Oe=(()=>{class Re{constructor(we,Je,Ae,Ne={}){this.doc=we,this.appId=Je,this.nonce=Ae,this.platformId=Ne,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=(0,z.Vy)(Ne),this.resetHostNodes()}addStyles(we){for(const Je of we)1===this.changeUsageCount(Je,1)&&this.onStyleAdded(Je)}removeStyles(we){for(const Je of we)this.changeUsageCount(Je,-1)<=0&&this.onStyleRemoved(Je)}ngOnDestroy(){const we=this.styleNodesInDOM;we&&(we.forEach(Je=>Je.remove()),we.clear());for(const Je of this.getAllStyles())this.onStyleRemoved(Je);this.resetHostNodes()}addHost(we){this.hostNodes.add(we);for(const Je of this.getAllStyles())this.addStyleToHost(we,Je)}removeHost(we){this.hostNodes.delete(we)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(we){for(const Je of this.hostNodes)this.addStyleToHost(Je,we)}onStyleRemoved(we){const Je=this.styleRef;Je.get(we)?.elements?.forEach(Ae=>Ae.remove()),Je.delete(we)}collectServerRenderedStyles(){const we=this.doc.head?.querySelectorAll(`style[${qe}="${this.appId}"]`);if(we?.length){const Je=new Map;return we.forEach(Ae=>{null!=Ae.textContent&&Je.set(Ae.textContent,Ae)}),Je}return null}changeUsageCount(we,Je){const Ae=this.styleRef;if(Ae.has(we)){const Ne=Ae.get(we);return Ne.usage+=Je,Ne.usage}return Ae.set(we,{usage:Je,elements:[]}),Je}getStyleElement(we,Je){const Ae=this.styleNodesInDOM,Ne=Ae?.get(Je);if(Ne?.parentNode===we)return Ae.delete(Je),Ne.removeAttribute(qe),Ne;{const ft=this.doc.createElement("style");return this.nonce&&ft.setAttribute("nonce",this.nonce),ft.textContent=Je,this.platformIsServer&&ft.setAttribute(qe,this.appId),we.appendChild(ft),ft}}addStyleToHost(we,Je){const Ae=this.getStyleElement(we,Je),Ne=this.styleRef,ft=Ne.get(Je)?.elements;ft?ft.push(Ae):Ne.set(Je,{elements:[Ae],usage:1})}resetHostNodes(){const we=this.hostNodes;we.clear(),we.add(this.doc.head)}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(z.qQ),O.KVO(O.sZ2),O.KVO(O.BIS,8),O.KVO(O.Agw))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac})}return Re})();const je={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ht=/%COMP%/g,Xe=new O.nKC("",{providedIn:"root",factory:()=>!0});function at(Re,Ie){return Ie.map(we=>we.replace(ht,Re))}let Ze=(()=>{class Re{constructor(we,Je,Ae,Ne,ft,Vt,Rt,Mn=null){this.eventManager=we,this.sharedStylesHost=Je,this.appId=Ae,this.removeStylesOnCompDestroy=Ne,this.doc=ft,this.platformId=Vt,this.ngZone=Rt,this.nonce=Mn,this.rendererByCompId=new Map,this.platformIsServer=(0,z.Vy)(Vt),this.defaultRenderer=new it(we,ft,Rt,this.platformIsServer)}createRenderer(we,Je){if(!we||!Je)return this.defaultRenderer;this.platformIsServer&&Je.encapsulation===O.gXe.ShadowDom&&(Je={...Je,encapsulation:O.gXe.Emulated});const Ae=this.getOrCreateRenderer(we,Je);return Ae instanceof Ht?Ae.applyToHost(we):Ae instanceof qt&&Ae.applyStyles(),Ae}getOrCreateRenderer(we,Je){const Ae=this.rendererByCompId;let Ne=Ae.get(Je.id);if(!Ne){const ft=this.doc,Vt=this.ngZone,Rt=this.eventManager,Mn=this.sharedStylesHost,ar=this.removeStylesOnCompDestroy,wr=this.platformIsServer;switch(Je.encapsulation){case O.gXe.Emulated:Ne=new Ht(Rt,Mn,Je,this.appId,ar,ft,Vt,wr);break;case O.gXe.ShadowDom:return new Cn(Rt,Mn,we,Je,ft,Vt,this.nonce,wr);default:Ne=new qt(Rt,Mn,Je,ar,ft,Vt,wr)}Ae.set(Je.id,Ne)}return Ne}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(me),O.KVO(Oe),O.KVO(O.sZ2),O.KVO(Xe),O.KVO(z.qQ),O.KVO(O.Agw),O.KVO(O.SKi),O.KVO(O.BIS))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac})}return Re})();class it{constructor(Ie,we,Je,Ae){this.eventManager=Ie,this.doc=we,this.ngZone=Je,this.platformIsServer=Ae,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(Ie,we){return we?this.doc.createElementNS(je[we]||we,Ie):this.doc.createElement(Ie)}createComment(Ie){return this.doc.createComment(Ie)}createText(Ie){return this.doc.createTextNode(Ie)}appendChild(Ie,we){(bn(Ie)?Ie.content:Ie).appendChild(we)}insertBefore(Ie,we,Je){Ie&&(bn(Ie)?Ie.content:Ie).insertBefore(we,Je)}removeChild(Ie,we){Ie&&Ie.removeChild(we)}selectRootElement(Ie,we){let Je="string"==typeof Ie?this.doc.querySelector(Ie):Ie;if(!Je)throw new O.wOt(-5104,!1);return we||(Je.textContent=""),Je}parentNode(Ie){return Ie.parentNode}nextSibling(Ie){return Ie.nextSibling}setAttribute(Ie,we,Je,Ae){if(Ae){we=Ae+":"+we;const Ne=je[Ae];Ne?Ie.setAttributeNS(Ne,we,Je):Ie.setAttribute(we,Je)}else Ie.setAttribute(we,Je)}removeAttribute(Ie,we,Je){if(Je){const Ae=je[Je];Ae?Ie.removeAttributeNS(Ae,we):Ie.removeAttribute(`${Je}:${we}`)}else Ie.removeAttribute(we)}addClass(Ie,we){Ie.classList.add(we)}removeClass(Ie,we){Ie.classList.remove(we)}setStyle(Ie,we,Je,Ae){Ae&(O.czy.DashCase|O.czy.Important)?Ie.style.setProperty(we,Je,Ae&O.czy.Important?"important":""):Ie.style[we]=Je}removeStyle(Ie,we,Je){Je&O.czy.DashCase?Ie.style.removeProperty(we):Ie.style[we]=""}setProperty(Ie,we,Je){null!=Ie&&(Ie[we]=Je)}setValue(Ie,we){Ie.nodeValue=we}listen(Ie,we,Je){if("string"==typeof Ie&&!(Ie=(0,z.QT)().getGlobalEventTarget(this.doc,Ie)))throw new Error(`Unsupported event target ${Ie} for event ${we}`);return this.eventManager.addEventListener(Ie,we,this.decoratePreventDefault(Je))}decoratePreventDefault(Ie){return we=>{if("__ngUnwrap__"===we)return Ie;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>Ie(we)):Ie(we))&&we.preventDefault()}}}function bn(Re){return"TEMPLATE"===Re.tagName&&void 0!==Re.content}class Cn extends it{constructor(Ie,we,Je,Ae,Ne,ft,Vt,Rt){super(Ie,Ne,ft,Rt),this.sharedStylesHost=we,this.hostEl=Je,this.shadowRoot=Je.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Mn=at(Ae.id,Ae.styles);for(const ar of Mn){const wr=document.createElement("style");Vt&&wr.setAttribute("nonce",Vt),wr.textContent=ar,this.shadowRoot.appendChild(wr)}}nodeOrShadowRoot(Ie){return Ie===this.hostEl?this.shadowRoot:Ie}appendChild(Ie,we){return super.appendChild(this.nodeOrShadowRoot(Ie),we)}insertBefore(Ie,we,Je){return super.insertBefore(this.nodeOrShadowRoot(Ie),we,Je)}removeChild(Ie,we){return super.removeChild(this.nodeOrShadowRoot(Ie),we)}parentNode(Ie){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Ie)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class qt extends it{constructor(Ie,we,Je,Ae,Ne,ft,Vt,Rt){super(Ie,Ne,ft,Vt),this.sharedStylesHost=we,this.removeStylesOnCompDestroy=Ae,this.styles=Rt?at(Rt,Je.styles):Je.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Ht extends qt{constructor(Ie,we,Je,Ae,Ne,ft,Vt,Rt){const Mn=Ae+"-"+Je.id;super(Ie,we,Je,Ne,ft,Vt,Rt,Mn),this.contentAttr=function Le(Re){return"_ngcontent-%COMP%".replace(ht,Re)}(Mn),this.hostAttr=function Te(Re){return"_nghost-%COMP%".replace(ht,Re)}(Mn)}applyToHost(Ie){this.applyStyles(),this.setAttribute(Ie,this.hostAttr,"")}createElement(Ie,we){const Je=super.createElement(Ie,we);return super.setAttribute(Je,this.contentAttr,""),Je}}let lt=(()=>{class Re extends He{constructor(we){super(we)}supports(we){return!0}addEventListener(we,Je,Ae){return we.addEventListener(Je,Ae,!1),()=>this.removeEventListener(we,Je,Ae)}removeEventListener(we,Je,Ae){return we.removeEventListener(Je,Ae)}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(z.qQ))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac})}return Re})();const Ct=["alt","control","meta","shift"],Pt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Qe={alt:Re=>Re.altKey,control:Re=>Re.ctrlKey,meta:Re=>Re.metaKey,shift:Re=>Re.shiftKey};let Tt=(()=>{class Re extends He{constructor(we){super(we)}supports(we){return null!=Re.parseEventName(we)}addEventListener(we,Je,Ae){const Ne=Re.parseEventName(Je),ft=Re.eventCallback(Ne.fullKey,Ae,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,z.QT)().onAndCancel(we,Ne.domEventName,ft))}static parseEventName(we){const Je=we.toLowerCase().split("."),Ae=Je.shift();if(0===Je.length||"keydown"!==Ae&&"keyup"!==Ae)return null;const Ne=Re._normalizeKey(Je.pop());let ft="",Vt=Je.indexOf("code");if(Vt>-1&&(Je.splice(Vt,1),ft="code."),Ct.forEach(Mn=>{const ar=Je.indexOf(Mn);ar>-1&&(Je.splice(ar,1),ft+=Mn+".")}),ft+=Ne,0!=Je.length||0===Ne.length)return null;const Rt={};return Rt.domEventName=Ae,Rt.fullKey=ft,Rt}static matchEventFullKeyCode(we,Je){let Ae=Pt[we.key]||we.key,Ne="";return Je.indexOf("code.")>-1&&(Ae=we.code,Ne="code."),!(null==Ae||!Ae)&&(Ae=Ae.toLowerCase()," "===Ae?Ae="space":"."===Ae&&(Ae="dot"),Ct.forEach(ft=>{ft!==Ae&&(0,Qe[ft])(we)&&(Ne+=ft+".")}),Ne+=Ae,Ne===Je)}static eventCallback(we,Je,Ae){return Ne=>{Re.matchEventFullKeyCode(Ne,we)&&Ae.runGuarded(()=>Je(Ne))}}static _normalizeKey(we){return"esc"===we?"escape":we}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(z.qQ))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac})}return Re})();const Or=(0,O.oH4)(O.fpN,"browser",[{provide:O.Agw,useValue:z.AJ},{provide:O.PLl,useValue:function Vn(){m.makeCurrent()},multi:!0},{provide:z.qQ,useFactory:function Ot(){return(0,O.TL$)(document),document},deps:[]}]),jr=new O.nKC(""),ur=[{provide:O.e01,useClass:class Ve{addToWindow(Ie){O.JZv.getAngularTestability=(Je,Ae=!0)=>{const Ne=Ie.findTestabilityInTree(Je,Ae);if(null==Ne)throw new O.wOt(5103,!1);return Ne},O.JZv.getAllAngularTestabilities=()=>Ie.getAllTestabilities(),O.JZv.getAllAngularRootElements=()=>Ie.getAllRootElements(),O.JZv.frameworkStabilizers||(O.JZv.frameworkStabilizers=[]),O.JZv.frameworkStabilizers.push(Je=>{const Ae=O.JZv.getAllAngularTestabilities();let Ne=Ae.length;const ft=function(){Ne--,0==Ne&&Je()};Ae.forEach(Vt=>{Vt.whenStable(ft)})})}findTestabilityInTree(Ie,we,Je){return null==we?null:Ie.getTestability(we)??(Je?(0,z.QT)().isShadowRoot(we)?this.findTestabilityInTree(Ie,we.host,!0):this.findTestabilityInTree(Ie,we.parentElement,!0):null)}},deps:[]},{provide:O.WHO,useClass:O.NYb,deps:[O.SKi,O.giA,O.e01]},{provide:O.NYb,useClass:O.NYb,deps:[O.SKi,O.giA,O.e01]}],Ai=[{provide:O.H8p,useValue:"root"},{provide:O.zcH,useFactory:function Fr(){return new O.zcH},deps:[]},{provide:se,useClass:lt,multi:!0,deps:[z.qQ,O.SKi,O.Agw]},{provide:se,useClass:Tt,multi:!0,deps:[z.qQ]},Ze,Oe,me,{provide:O._9s,useExisting:Ze},{provide:z.N0,useClass:xe,deps:[]},[]];let Ri=(()=>{class Re{constructor(we){}static withServerTransition(we){return{ngModule:Re,providers:[{provide:O.sZ2,useValue:we.appId}]}}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(jr,12))};static#t=this.\u0275mod=O.$C({type:Re});static#n=this.\u0275inj=O.G2t({providers:[...Ai,...ur],imports:[z.MD,O.Hbi]})}return Re})(),Er=(()=>{class Re{constructor(we){this._doc=we}getTitle(){return this._doc.title}setTitle(we){this._doc.title=we||""}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(z.qQ))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac,providedIn:"root"})}return Re})(),ci=(()=>{class Re{static#e=this.\u0275fac=function(Je){return new(Je||Re)};static#t=this.\u0275prov=O.jDH({token:Re,factory:function(Je){let Ae=null;return Ae=Je?new(Je||Re):O.KVO(qn),Ae},providedIn:"root"})}return Re})(),qn=(()=>{class Re extends ci{constructor(we){super(),this._doc=we}sanitize(we,Je){if(null==Je)return null;switch(we){case O.WPN.NONE:return Je;case O.WPN.HTML:return(0,O.ZF7)(Je,"HTML")?(0,O.rcV)(Je):(0,O.h9k)(this._doc,String(Je)).toString();case O.WPN.STYLE:return(0,O.ZF7)(Je,"Style")?(0,O.rcV)(Je):Je;case O.WPN.SCRIPT:if((0,O.ZF7)(Je,"Script"))return(0,O.rcV)(Je);throw new O.wOt(5200,!1);case O.WPN.URL:return(0,O.ZF7)(Je,"URL")?(0,O.rcV)(Je):(0,O.$MX)(String(Je));case O.WPN.RESOURCE_URL:if((0,O.ZF7)(Je,"ResourceURL"))return(0,O.rcV)(Je);throw new O.wOt(5201,!1);default:throw new O.wOt(5202,!1)}}bypassSecurityTrustHtml(we){return(0,O.Kcf)(we)}bypassSecurityTrustStyle(we){return(0,O.cWb)(we)}bypassSecurityTrustScript(we){return(0,O.UyX)(we)}bypassSecurityTrustUrl(we){return(0,O.osQ)(we)}bypassSecurityTrustResourceUrl(we){return(0,O.e5t)(we)}static#e=this.\u0275fac=function(Je){return new(Je||Re)(O.KVO(z.qQ))};static#t=this.\u0275prov=O.jDH({token:Re,factory:Re.\u0275fac,providedIn:"root"})}return Re})()},4721:(An,xt,H)=>{"use strict";H.d(xt,{nX:()=>Ei,Ix:()=>qi,Wk:()=>Si,iI:()=>uc,n3:()=>Fa});var O=H(4438),z=H(1985),ye=H(8071),ae=H(8455),De=H(7673),Be=H(4412),Ve=H(3073),xe=H(3669),se=H(6450),me=H(9326),He=H(8496),qe=H(4360),Oe=H(5225);function je(...c){const n=(0,me.lI)(c),a=(0,me.ms)(c),{args:p,keys:y}=(0,Ve.D)(c);if(0===p.length)return(0,ae.H)([],n);const w=new z.c(function ht(c,n,a=xe.D){return p=>{et(n,()=>{const{length:y}=c,w=new Array(y);let C=y,P=y;for(let V=0;V<y;V++)et(n,()=>{const K=(0,ae.H)(c[V],n);let Y=!1;K.subscribe((0,qe._)(p,ce=>{w[V]=ce,Y||(Y=!0,P--),P||p.next(a(w.slice()))},()=>{--C||p.complete()}))},p)},p)}}(p,n,y?C=>(0,He.e)(y,C):xe.D));return a?w.pipe((0,se.I)(a)):w}function et(c,n,a){c?(0,Oe.N)(a,c,n):n()}var ct=H(9350),Ue=H(8793),nt=H(9030),Xe=H(1203);function Le(c,n){const a=(0,ye.T)(c)?c:()=>c,p=y=>y.error(a());return new z.c(n?y=>n.schedule(p,0,y):p)}var Te=H(983),at=H(8359),Ze=H(9974);function it(){return(0,Ze.N)((c,n)=>{let a=null;c._refCount++;const p=(0,qe._)(n,void 0,void 0,void 0,()=>{if(!c||c._refCount<=0||0<--c._refCount)return void(a=null);const y=c._connection,w=a;a=null,y&&(!w||y===w)&&y.unsubscribe(),n.unsubscribe()});c.subscribe(p),p.closed||(a=c.connect())})}class Ge extends z.c{constructor(n,a){super(),this.source=n,this.subjectFactory=a,this._subject=null,this._refCount=0,this._connection=null,(0,Ze.S)(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new at.yU;const a=this.getSubject();n.add(this.source.subscribe((0,qe._)(a,void 0,()=>{this._teardown(),a.complete()},p=>{this._teardown(),a.error(p)},()=>this._teardown()))),n.closed&&(this._connection=null,n=at.yU.EMPTY)}return n}refCount(){return it()(this)}}var nn=H(1413),bn=H(177),Cn=H(6354),qt=H(5558),Ht=H(6697),lt=H(9172),Ct=H(5964),Pt=H(1397),Qe=H(1594),Tt=H(274),$t=H(8141),Qt=H(8750);function sn(c){return(0,Ze.N)((n,a)=>{let w,p=null,y=!1;p=n.subscribe((0,qe._)(a,void 0,void 0,C=>{w=(0,Qt.Tg)(c(C,sn(c)(n))),p?(p.unsubscribe(),p=null,w.subscribe(a)):y=!0})),y&&(p.unsubscribe(),p=null,w.subscribe(a))})}var mn=H(2816),Vn=H(9901);function Fr(c){return c<=0?()=>Te.w:(0,Ze.N)((n,a)=>{let p=[];n.subscribe((0,qe._)(a,y=>{p.push(y),c<p.length&&p.shift()},()=>{for(const y of p)a.next(y);a.complete()},void 0,()=>{p=null}))})}var Ot=H(3774),Or=H(3703),jr=H(980),ur=H(5343),Ri=H(6365),nr=H(345);const mr="primary",Er=Symbol("RouteTitle");class Zn{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const a=this.params[n];return Array.isArray(a)?a[0]:a}return null}getAll(n){if(this.has(n)){const a=this.params[n];return Array.isArray(a)?a:[a]}return[]}get keys(){return Object.keys(this.params)}}function us(c){return new Zn(c)}function Hn(c,n,a){const p=a.path.split("/");if(p.length>c.length||"full"===a.pathMatch&&(n.hasChildren()||p.length<c.length))return null;const y={};for(let w=0;w<p.length;w++){const C=p[w],P=c[w];if(C.startsWith(":"))y[C.substring(1)]=P;else if(C!==P.path)return null}return{consumed:c.slice(0,p.length),posParams:y}}function kr(c,n){const a=c?Gt(c):void 0,p=n?Gt(n):void 0;if(!a||!p||a.length!=p.length)return!1;let y;for(let w=0;w<a.length;w++)if(y=a[w],!Bt(c[y],n[y]))return!1;return!0}function Gt(c){return[...Object.keys(c),...Object.getOwnPropertySymbols(c)]}function Bt(c,n){if(Array.isArray(c)&&Array.isArray(n)){if(c.length!==n.length)return!1;const a=[...c].sort(),p=[...n].sort();return a.every((y,w)=>p[w]===y)}return c===n}function Ce(c){return c.length>0?c[c.length-1]:null}function pt(c){return function m(c){return!!c&&(c instanceof z.c||(0,ye.T)(c.lift)&&(0,ye.T)(c.subscribe))}(c)?c:(0,O.jNT)(c)?(0,ae.H)(Promise.resolve(c)):(0,De.of)(c)}const Mt={exact:function $r(c,n,a){if(!ge(c.segments,n.segments)||!Zt(c.segments,n.segments,a)||c.numberOfChildren!==n.numberOfChildren)return!1;for(const p in n.children)if(!c.children[p]||!$r(c.children[p],n.children[p],a))return!1;return!0},subset:qn},hn={exact:function vi(c,n){return kr(c,n)},subset:function ci(c,n){return Object.keys(n).length<=Object.keys(c).length&&Object.keys(n).every(a=>Bt(c[a],n[a]))},ignored:()=>!0};function Ur(c,n,a){return Mt[a.paths](c.root,n.root,a.matrixParams)&&hn[a.queryParams](c.queryParams,n.queryParams)&&!("exact"===a.fragment&&c.fragment!==n.fragment)}function qn(c,n,a){return Fs(c,n,n.segments,a)}function Fs(c,n,a,p){if(c.segments.length>a.length){const y=c.segments.slice(0,a.length);return!(!ge(y,a)||n.hasChildren()||!Zt(y,a,p))}if(c.segments.length===a.length){if(!ge(c.segments,a)||!Zt(c.segments,a,p))return!1;for(const y in n.children)if(!c.children[y]||!qn(c.children[y],n.children[y],p))return!1;return!0}{const y=a.slice(0,c.segments.length),w=a.slice(c.segments.length);return!!(ge(c.segments,y)&&Zt(c.segments,y,p)&&c.children[mr])&&Fs(c.children[mr],n,w,p)}}function Zt(c,n,a){return n.every((p,y)=>hn[a](c[y].parameters,p.parameters))}class ve{constructor(n=new re([],{}),a={},p=null){this.root=n,this.queryParams=a,this.fragment=p}get queryParamMap(){return this._queryParamMap??=us(this.queryParams),this._queryParamMap}toString(){return Ie.serialize(this)}}class re{constructor(n,a){this.segments=n,this.children=a,this.parent=null,Object.values(a).forEach(p=>p.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return we(this)}}class Q{constructor(n,a){this.path=n,this.parameters=a}get parameterMap(){return this._parameterMap??=us(this.parameters),this._parameterMap}toString(){return ar(this)}}function ge(c,n){return c.length===n.length&&c.every((a,p)=>a.path===n[p].path)}let $e=(()=>{class c{static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:()=>new Re,providedIn:"root"})}return c})();class Re{parse(n){const a=new Jt(n);return new ve(a.parseRootSegment(),a.parseQueryParams(),a.parseFragment())}serialize(n){const a=`/${Je(n.root,!0)}`,p=function Hr(c){const n=Object.entries(c).map(([a,p])=>Array.isArray(p)?p.map(y=>`${Ne(a)}=${Ne(y)}`).join("&"):`${Ne(a)}=${Ne(p)}`).filter(a=>a);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${a}${p}${"string"==typeof n.fragment?`#${function ft(c){return encodeURI(c)}(n.fragment)}`:""}`}}const Ie=new Re;function we(c){return c.segments.map(n=>ar(n)).join("/")}function Je(c,n){if(!c.hasChildren())return we(c);if(n){const a=c.children[mr]?Je(c.children[mr],!1):"",p=[];return Object.entries(c.children).forEach(([y,w])=>{y!==mr&&p.push(`${y}:${Je(w,!1)}`)}),p.length>0?`${a}(${p.join("//")})`:a}{const a=function Me(c,n){let a=[];return Object.entries(c.children).forEach(([p,y])=>{p===mr&&(a=a.concat(n(y,p)))}),Object.entries(c.children).forEach(([p,y])=>{p!==mr&&(a=a.concat(n(y,p)))}),a}(c,(p,y)=>y===mr?[Je(c.children[mr],!1)]:[`${y}:${Je(p,!1)}`]);return 1===Object.keys(c.children).length&&null!=c.children[mr]?`${we(c)}/${a[0]}`:`${we(c)}/(${a.join("//")})`}}function Ae(c){return encodeURIComponent(c).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ne(c){return Ae(c).replace(/%3B/gi,";")}function Vt(c){return Ae(c).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Rt(c){return decodeURIComponent(c)}function Mn(c){return Rt(c.replace(/\+/g,"%20"))}function ar(c){return`${Vt(c.path)}${function wr(c){return Object.entries(c).map(([n,a])=>`;${Vt(n)}=${Vt(a)}`).join("")}(c.parameters)}`}const Li=/^[^\/()?;#]+/;function $i(c){const n=c.match(Li);return n?n[0]:""}const Wr=/^[^\/()?;=#]+/,Bs=/^[^=?&#]+/,wa=/^[^&#]+/;class Jt{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new re([],{}):new re([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let a={};this.peekStartsWith("/(")&&(this.capture("/"),a=this.parseParens(!0));let p={};return this.peekStartsWith("(")&&(p=this.parseParens(!1)),(n.length>0||Object.keys(a).length>0)&&(p[mr]=new re(n,a)),p}parseSegment(){const n=$i(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new O.wOt(4009,!1);return this.capture(n),new Q(Rt(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const a=function _r(c){const n=c.match(Wr);return n?n[0]:""}(this.remaining);if(!a)return;this.capture(a);let p="";if(this.consumeOptional("=")){const y=$i(this.remaining);y&&(p=y,this.capture(p))}n[Rt(a)]=Rt(p)}parseQueryParam(n){const a=function ra(c){const n=c.match(Bs);return n?n[0]:""}(this.remaining);if(!a)return;this.capture(a);let p="";if(this.consumeOptional("=")){const C=function In(c){const n=c.match(wa);return n?n[0]:""}(this.remaining);C&&(p=C,this.capture(p))}const y=Mn(a),w=Mn(p);if(n.hasOwnProperty(y)){let C=n[y];Array.isArray(C)||(C=[C],n[y]=C),C.push(w)}else n[y]=w}parseParens(n){const a={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const p=$i(this.remaining),y=this.remaining[p.length];if("/"!==y&&")"!==y&&";"!==y)throw new O.wOt(4010,!1);let w;p.indexOf(":")>-1?(w=p.slice(0,p.indexOf(":")),this.capture(w),this.capture(":")):n&&(w=mr);const C=this.parseChildren();a[w]=1===Object.keys(C).length?C[mr]:new re([],C),this.consumeOptional("//")}return a}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new O.wOt(4011,!1)}}function Sn(c){return c.segments.length>0?new re([],{[mr]:c}):c}function Gr(c){const n={};for(const[p,y]of Object.entries(c.children)){const w=Gr(y);if(p===mr&&0===w.segments.length&&w.hasChildren())for(const[C,P]of Object.entries(w.children))n[C]=P;else(w.segments.length>0||w.hasChildren())&&(n[p]=w)}return function gi(c){if(1===c.numberOfChildren&&c.children[mr]){const n=c.children[mr];return new re(c.segments.concat(n.segments),n.children)}return c}(new re(c.segments,n))}function Ii(c){return c instanceof ve}function ws(c){let n;const y=Sn(function a(w){const C={};for(const V of w.children){const K=a(V);C[V.outlet]=K}const P=new re(w.url,C);return w===c&&(n=P),P}(c.root));return n??y}function _i(c,n,a,p){let y=c;for(;y.parent;)y=y.parent;if(0===n.length)return Nt(y,y,y,a,p);const w=function On(c){if("string"==typeof c[0]&&1===c.length&&"/"===c[0])return new bt(!0,0,c);let n=0,a=!1;const p=c.reduce((y,w,C)=>{if("object"==typeof w&&null!=w){if(w.outlets){const P={};return Object.entries(w.outlets).forEach(([V,K])=>{P[V]="string"==typeof K?K.split("/"):K}),[...y,{outlets:P}]}if(w.segmentPath)return[...y,w.segmentPath]}return"string"!=typeof w?[...y,w]:0===C?(w.split("/").forEach((P,V)=>{0==V&&"."===P||(0==V&&""===P?a=!0:".."===P?n++:""!=P&&y.push(P))}),y):[...y,w]},[]);return new bt(a,n,p)}(n);if(w.toRoot())return Nt(y,y,new re([],{}),a,p);const C=function ei(c,n,a){if(c.isAbsolute)return new sr(n,!0,0);if(!a)return new sr(n,!1,NaN);if(null===a.parent)return new sr(a,!0,0);const p=ut(c.commands[0])?0:1;return function Mr(c,n,a){let p=c,y=n,w=a;for(;w>y;){if(w-=y,p=p.parent,!p)throw new O.wOt(4005,!1);y=p.segments.length}return new sr(p,!1,y-w)}(a,a.segments.length-1+p,c.numberOfDoubleDots)}(w,y,c),P=C.processChildren?Ds(C.segmentGroup,C.index,w.commands):xi(C.segmentGroup,C.index,w.commands);return Nt(y,C.segmentGroup,P,a,p)}function ut(c){return"object"==typeof c&&null!=c&&!c.outlets&&!c.segmentPath}function Dt(c){return"object"==typeof c&&null!=c&&c.outlets}function Nt(c,n,a,p,y){let C,w={};p&&Object.entries(p).forEach(([V,K])=>{w[V]=Array.isArray(K)?K.map(Y=>`${Y}`):`${K}`}),C=c===n?a:wn(c,n,a);const P=Sn(Gr(C));return new ve(P,w,y)}function wn(c,n,a){const p={};return Object.entries(c.children).forEach(([y,w])=>{p[y]=w===n?a:wn(w,n,a)}),new re(c.segments,p)}class bt{constructor(n,a,p){if(this.isAbsolute=n,this.numberOfDoubleDots=a,this.commands=p,n&&p.length>0&&ut(p[0]))throw new O.wOt(4003,!1);const y=p.find(Dt);if(y&&y!==Ce(p))throw new O.wOt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class sr{constructor(n,a,p){this.segmentGroup=n,this.processChildren=a,this.index=p}}function xi(c,n,a){if(c??=new re([],{}),0===c.segments.length&&c.hasChildren())return Ds(c,n,a);const p=function Vs(c,n,a){let p=0,y=n;const w={match:!1,pathIndex:0,commandIndex:0};for(;y<c.segments.length;){if(p>=a.length)return w;const C=c.segments[y],P=a[p];if(Dt(P))break;const V=`${P}`,K=p<a.length-1?a[p+1]:null;if(y>0&&void 0===V)break;if(V&&K&&"object"==typeof K&&void 0===K.outlets){if(!Ci(V,K,C))return w;p+=2}else{if(!Ci(V,{},C))return w;p++}y++}return{match:!0,pathIndex:y,commandIndex:p}}(c,n,a),y=a.slice(p.commandIndex);if(p.match&&p.pathIndex<c.segments.length){const w=new re(c.segments.slice(0,p.pathIndex),{});return w.children[mr]=new re(c.segments.slice(p.pathIndex),c.children),Ds(w,0,y)}return p.match&&0===y.length?new re(c.segments,{}):p.match&&!c.hasChildren()?gr(c,n,a):p.match?Ds(c,0,y):gr(c,n,a)}function Ds(c,n,a){if(0===a.length)return new re(c.segments,{});{const p=function li(c){return Dt(c[0])?c[0].outlets:{[mr]:c}}(a),y={};if(Object.keys(p).some(w=>w!==mr)&&c.children[mr]&&1===c.numberOfChildren&&0===c.children[mr].segments.length){const w=Ds(c.children[mr],n,a);return new re(c.segments,w.children)}return Object.entries(p).forEach(([w,C])=>{"string"==typeof C&&(C=[C]),null!==C&&(y[w]=xi(c.children[w],n,C))}),Object.entries(c.children).forEach(([w,C])=>{void 0===p[w]&&(y[w]=C)}),new re(c.segments,y)}}function gr(c,n,a){const p=c.segments.slice(0,n);let y=0;for(;y<a.length;){const w=a[y];if(Dt(w)){const V=ti(w.outlets);return new re(p,V)}if(0===y&&ut(a[0])){p.push(new Q(c.segments[n].path,qr(a[0]))),y++;continue}const C=Dt(w)?w.outlets[mr]:`${w}`,P=y<a.length-1?a[y+1]:null;C&&P&&ut(P)?(p.push(new Q(C,qr(P))),y+=2):(p.push(new Q(C,{})),y++)}return new re(p,{})}function ti(c){const n={};return Object.entries(c).forEach(([a,p])=>{"string"==typeof p&&(p=[p]),null!==p&&(n[a]=gr(new re([],{}),0,p))}),n}function qr(c){const n={};return Object.entries(c).forEach(([a,p])=>n[a]=`${p}`),n}function Ci(c,n,a){return c==a.path&&kr(n,a.parameters)}const _s="imperative";var br=function(c){return c[c.NavigationStart=0]="NavigationStart",c[c.NavigationEnd=1]="NavigationEnd",c[c.NavigationCancel=2]="NavigationCancel",c[c.NavigationError=3]="NavigationError",c[c.RoutesRecognized=4]="RoutesRecognized",c[c.ResolveStart=5]="ResolveStart",c[c.ResolveEnd=6]="ResolveEnd",c[c.GuardsCheckStart=7]="GuardsCheckStart",c[c.GuardsCheckEnd=8]="GuardsCheckEnd",c[c.RouteConfigLoadStart=9]="RouteConfigLoadStart",c[c.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",c[c.ChildActivationStart=11]="ChildActivationStart",c[c.ChildActivationEnd=12]="ChildActivationEnd",c[c.ActivationStart=13]="ActivationStart",c[c.ActivationEnd=14]="ActivationEnd",c[c.Scroll=15]="Scroll",c[c.NavigationSkipped=16]="NavigationSkipped",c}(br||{});class Ui{constructor(n,a){this.id=n,this.url=a}}class Mo extends Ui{constructor(n,a,p="imperative",y=null){super(n,a),this.type=br.NavigationStart,this.navigationTrigger=p,this.restoredState=y}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class bs extends Ui{constructor(n,a,p){super(n,a),this.urlAfterRedirects=p,this.type=br.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Gi=function(c){return c[c.Redirect=0]="Redirect",c[c.SupersededByNewNavigation=1]="SupersededByNewNavigation",c[c.NoDataFromResolver=2]="NoDataFromResolver",c[c.GuardRejected=3]="GuardRejected",c}(Gi||{}),ys=function(c){return c[c.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",c[c.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",c}(ys||{});class fi extends Ui{constructor(n,a,p,y){super(n,a),this.reason=p,this.code=y,this.type=br.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Pi extends Ui{constructor(n,a,p,y){super(n,a),this.reason=p,this.code=y,this.type=br.NavigationSkipped}}class Fl extends Ui{constructor(n,a,p,y){super(n,a),this.error=p,this.target=y,this.type=br.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Wo extends Ui{constructor(n,a,p,y){super(n,a),this.urlAfterRedirects=p,this.state=y,this.type=br.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gc extends Ui{constructor(n,a,p,y){super(n,a),this.urlAfterRedirects=p,this.state=y,this.type=br.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Iu extends Ui{constructor(n,a,p,y,w){super(n,a),this.urlAfterRedirects=p,this.state=y,this.shouldActivate=w,this.type=br.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class bl extends Ui{constructor(n,a,p,y){super(n,a),this.urlAfterRedirects=p,this.state=y,this.type=br.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Fi extends Ui{constructor(n,a,p,y){super(n,a),this.urlAfterRedirects=p,this.state=y,this.type=br.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Nr{constructor(n){this.route=n,this.type=br.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class eo{constructor(n){this.route=n,this.type=br.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class to{constructor(n){this.snapshot=n,this.type=br.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ds{constructor(n){this.snapshot=n,this.type=br.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bc{constructor(n){this.snapshot=n,this.type=br.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Tl{constructor(n){this.snapshot=n,this.type=br.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ba{constructor(n,a,p){this.routerEvent=n,this.position=a,this.anchor=p,this.type=br.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Ro{}class Ta{constructor(n){this.url=n}}class no{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Xo,this.attachRef=null}}let Xo=(()=>{class c{constructor(){this.contexts=new Map}onChildOutletCreated(a,p){const y=this.getOrCreateContext(a);y.outlet=p,this.contexts.set(a,y)}onChildOutletDestroyed(a){const p=this.getContext(a);p&&(p.outlet=null,p.attachRef=null)}onOutletDeactivated(){const a=this.contexts;return this.contexts=new Map,a}onOutletReAttached(a){this.contexts=a}getOrCreateContext(a){let p=this.getContext(a);return p||(p=new no,this.contexts.set(a,p)),p}getContext(a){return this.contexts.get(a)||null}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();class Za{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const a=this.pathFromRoot(n);return a.length>1?a[a.length-2]:null}children(n){const a=ia(n,this._root);return a?a.children.map(p=>p.value):[]}firstChild(n){const a=ia(n,this._root);return a&&a.children.length>0?a.children[0].value:null}siblings(n){const a=hs(n,this._root);return a.length<2?[]:a[a.length-2].children.map(y=>y.value).filter(y=>y!==n)}pathFromRoot(n){return hs(n,this._root).map(a=>a.value)}}function ia(c,n){if(c===n.value)return n;for(const a of n.children){const p=ia(c,a);if(p)return p}return null}function hs(c,n){if(c===n.value)return[n];for(const a of n.children){const p=hs(c,a);if(p.length)return p.unshift(n),p}return[]}class sa{constructor(n,a){this.value=n,this.children=a}toString(){return`TreeNode(${this.value})`}}function wi(c){const n={};return c&&c.children.forEach(a=>n[a.value.outlet]=a),n}class Zs extends Za{constructor(n,a){super(n),this.snapshot=a,_c(this,n)}toString(){return this.snapshot.toString()}}function Us(c){const n=function ga(c){const w=new La([],{},{},"",{},mr,c,null,{});return new Bo("",new sa(w,[]))}(c),a=new Be.t([new Q("",{})]),p=new Be.t({}),y=new Be.t({}),w=new Be.t({}),C=new Be.t(""),P=new Ei(a,p,w,C,y,mr,c,n.root);return P.snapshot=n.root,new Zs(new sa(P,[]),n)}class Ei{constructor(n,a,p,y,w,C,P,V){this.urlSubject=n,this.paramsSubject=a,this.queryParamsSubject=p,this.fragmentSubject=y,this.dataSubject=w,this.outlet=C,this.component=P,this._futureSnapshot=V,this.title=this.dataSubject?.pipe((0,Cn.T)(K=>K[Er]))??(0,De.of)(void 0),this.url=n,this.params=a,this.queryParams=p,this.fragment=y,this.data=w}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe((0,Cn.T)(n=>us(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe((0,Cn.T)(n=>us(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Il(c,n,a="emptyOnly"){let p;const{routeConfig:y}=c;return p=null===n||"always"!==a&&""!==y?.path&&(n.component||n.routeConfig?.loadComponent)?{params:{...c.params},data:{...c.data},resolve:{...c.data,...c._resolvedData??{}}}:{params:{...n.params,...c.params},data:{...n.data,...c.data},resolve:{...c.data,...n.data,...y?.data,...c._resolvedData}},y&&Ko(y)&&(p.resolve[Er]=y.title),p}class La{get title(){return this.data?.[Er]}constructor(n,a,p,y,w,C,P,V,K){this.url=n,this.params=a,this.queryParams=p,this.fragment=y,this.data=w,this.outlet=C,this.component=P,this.routeConfig=V,this._resolve=K}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=us(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=us(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(p=>p.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Bo extends Za{constructor(n,a){super(a),this.url=n,_c(this,a)}toString(){return Xa(this._root)}}function _c(c,n){n.value._routerState=c,n.children.forEach(a=>_c(c,a))}function Xa(c){const n=c.children.length>0?` { ${c.children.map(Xa).join(", ")} } `:"";return`${c.value}${n}`}function qo(c){if(c.snapshot){const n=c.snapshot,a=c._futureSnapshot;c.snapshot=a,kr(n.queryParams,a.queryParams)||c.queryParamsSubject.next(a.queryParams),n.fragment!==a.fragment&&c.fragmentSubject.next(a.fragment),kr(n.params,a.params)||c.paramsSubject.next(a.params),function Sr(c,n){if(c.length!==n.length)return!1;for(let a=0;a<c.length;++a)if(!kr(c[a],n[a]))return!1;return!0}(n.url,a.url)||c.urlSubject.next(a.url),kr(n.data,a.data)||c.dataSubject.next(a.data)}else c.snapshot=c._futureSnapshot,c.dataSubject.next(c._futureSnapshot.data)}function Qo(c,n){const a=kr(c.params,n.params)&&function oe(c,n){return ge(c,n)&&c.every((a,p)=>kr(a.parameters,n[p].parameters))}(c.url,n.url);return a&&!(!c.parent!=!n.parent)&&(!c.parent||Qo(c.parent,n.parent))}function Ko(c){return"string"==typeof c.title||null===c.title}let Fa=(()=>{class c{constructor(){this.activated=null,this._activatedRoute=null,this.name=mr,this.activateEvents=new O.bkB,this.deactivateEvents=new O.bkB,this.attachEvents=new O.bkB,this.detachEvents=new O.bkB,this.parentContexts=(0,O.WQX)(Xo),this.location=(0,O.WQX)(O.c1b),this.changeDetector=(0,O.WQX)(O.gRc),this.environmentInjector=(0,O.WQX)(O.uvJ),this.inputBinder=(0,O.WQX)(Bl,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(a){if(a.name){const{firstChange:p,previousValue:y}=a.name;if(p)return;this.isTrackedInParentContexts(y)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(y)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(a){return this.parentContexts.getContext(a)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const a=this.parentContexts.getContext(this.name);a?.route&&(a.attachRef?this.attach(a.attachRef,a.route):this.activateWith(a.route,a.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new O.wOt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new O.wOt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new O.wOt(4012,!1);this.location.detach();const a=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(a.instance),a}attach(a,p){this.activated=a,this._activatedRoute=p,this.location.insert(a.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(a.instance)}deactivate(){if(this.activated){const a=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(a)}}activateWith(a,p){if(this.isActivated)throw new O.wOt(4013,!1);this._activatedRoute=a;const y=this.location,C=a.snapshot.component,P=this.parentContexts.getOrCreateContext(this.name).children,V=new oa(a,P,y.injector);this.activated=y.createComponent(C,{index:y.length,injector:V,environmentInjector:p??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275dir=O.FsC({type:c,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[O.OA$]})}return c})();class oa{constructor(n,a,p){this.route=n,this.childContexts=a,this.parent=p}get(n,a){return n===Ei?this.route:n===Xo?this.childContexts:this.parent.get(n,a)}}const Bl=new O.nKC("");let Qa=(()=>{class c{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(a){this.unsubscribeFromRouteData(a),this.subscribeToRouteData(a)}unsubscribeFromRouteData(a){this.outletDataSubscriptions.get(a)?.unsubscribe(),this.outletDataSubscriptions.delete(a)}subscribeToRouteData(a){const{activatedRoute:p}=a,y=je([p.queryParams,p.params,p.data]).pipe((0,qt.n)(([w,C,P],V)=>(P={...w,...C,...P},0===V?(0,De.of)(P):Promise.resolve(P)))).subscribe(w=>{if(!a.isActivated||!a.activatedComponentRef||a.activatedRoute!==p||null===p.component)return void this.unsubscribeFromRouteData(a);const C=(0,O.HJs)(p.component);if(C)for(const{templateName:P}of C.inputs)a.activatedComponentRef.setInput(P,w[P]);else this.unsubscribeFromRouteData(a)});this.outletDataSubscriptions.set(a,y)}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac})}return c})();function So(c,n,a){if(a&&c.shouldReuseRoute(n.value,a.value.snapshot)){const p=a.value;p._futureSnapshot=n.value;const y=function Vl(c,n,a){return n.children.map(p=>{for(const y of a.children)if(c.shouldReuseRoute(p.value,y.value.snapshot))return So(c,p,y);return So(c,p)})}(c,n,a);return new sa(p,y)}{if(c.shouldAttach(n.value)){const w=c.retrieve(n.value);if(null!==w){const C=w.route;return C.value._futureSnapshot=n.value,C.children=n.children.map(P=>So(c,P)),C}}const p=function Ul(c){return new Ei(new Be.t(c.url),new Be.t(c.params),new Be.t(c.queryParams),new Be.t(c.fragment),new Be.t(c.data),c.outlet,c.component,c)}(n.value),y=n.children.map(w=>So(c,w));return new sa(p,y)}}const Ki="ngNavigationCancelingError";function zl(c,n){const{redirectTo:a,navigationBehaviorOptions:p}=Ii(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,y=aa(!1,Gi.Redirect);return y.url=a,y.navigationBehaviorOptions=p,y}function aa(c,n){const a=new Error(`NavigationCancelingError: ${c||""}`);return a[Ki]=!0,a.cancellationCode=n,a}function Va(c){return!!c&&c[Ki]}let Vc=(()=>{class c{static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275cmp=O.VBU({type:c,selectors:[["ng-component"]],standalone:!0,features:[O.aNF],decls:1,vars:0,template:function(p,y){1&p&&O.nrm(0,"router-outlet")},dependencies:[Fa],encapsulation:2})}return c})();function _a(c){const n=c.children&&c.children.map(_a),a=n?{...c,children:n}:{...c};return!a.component&&!a.loadComponent&&(n||a.loadChildren)&&a.outlet&&a.outlet!==mr&&(a.component=Vc),a}function zi(c){return c.outlet||mr}function Uo(c){if(!c)return null;if(c.routeConfig?._injector)return c.routeConfig._injector;for(let n=c.parent;n;n=n.parent){const a=n.routeConfig;if(a?._loadedInjector)return a._loadedInjector;if(a?._injector)return a._injector}return null}class ll{constructor(n,a,p,y,w){this.routeReuseStrategy=n,this.futureState=a,this.currState=p,this.forwardEvent=y,this.inputBindingEnabled=w}activate(n){const a=this.futureState._root,p=this.currState?this.currState._root:null;this.deactivateChildRoutes(a,p,n),qo(this.futureState.root),this.activateChildRoutes(a,p,n)}deactivateChildRoutes(n,a,p){const y=wi(a);n.children.forEach(w=>{const C=w.value.outlet;this.deactivateRoutes(w,y[C],p),delete y[C]}),Object.values(y).forEach(w=>{this.deactivateRouteAndItsChildren(w,p)})}deactivateRoutes(n,a,p){const y=n.value,w=a?a.value:null;if(y===w)if(y.component){const C=p.getContext(y.outlet);C&&this.deactivateChildRoutes(n,a,C.children)}else this.deactivateChildRoutes(n,a,p);else w&&this.deactivateRouteAndItsChildren(a,p)}deactivateRouteAndItsChildren(n,a){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,a):this.deactivateRouteAndOutlet(n,a)}detachAndStoreRouteSubtree(n,a){const p=a.getContext(n.value.outlet),y=p&&n.value.component?p.children:a,w=wi(n);for(const C of Object.values(w))this.deactivateRouteAndItsChildren(C,y);if(p&&p.outlet){const C=p.outlet.detach(),P=p.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:C,route:n,contexts:P})}}deactivateRouteAndOutlet(n,a){const p=a.getContext(n.value.outlet),y=p&&n.value.component?p.children:a,w=wi(n);for(const C of Object.values(w))this.deactivateRouteAndItsChildren(C,y);p&&(p.outlet&&(p.outlet.deactivate(),p.children.onOutletDeactivated()),p.attachRef=null,p.route=null)}activateChildRoutes(n,a,p){const y=wi(a);n.children.forEach(w=>{this.activateRoutes(w,y[w.value.outlet],p),this.forwardEvent(new Tl(w.value.snapshot))}),n.children.length&&this.forwardEvent(new ds(n.value.snapshot))}activateRoutes(n,a,p){const y=n.value,w=a?a.value:null;if(qo(y),y===w)if(y.component){const C=p.getOrCreateContext(y.outlet);this.activateChildRoutes(n,a,C.children)}else this.activateChildRoutes(n,a,p);else if(y.component){const C=p.getOrCreateContext(y.outlet);if(this.routeReuseStrategy.shouldAttach(y.snapshot)){const P=this.routeReuseStrategy.retrieve(y.snapshot);this.routeReuseStrategy.store(y.snapshot,null),C.children.onOutletReAttached(P.contexts),C.attachRef=P.componentRef,C.route=P.route.value,C.outlet&&C.outlet.attach(P.componentRef,P.route.value),qo(P.route.value),this.activateChildRoutes(n,null,C.children)}else{const P=Uo(y.snapshot);C.attachRef=null,C.route=y,C.injector=P,C.outlet&&C.outlet.activateWith(y,C.injector),this.activateChildRoutes(n,null,C.children)}}else this.activateChildRoutes(n,null,p)}}class Hi{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class cl{constructor(n,a){this.component=n,this.route=a}}function nc(c,n,a){const p=c._root;return vs(p,n?n._root:null,a,[p.value])}function da(c,n){const a=Symbol(),p=n.get(c,a);return p===a?"function"!=typeof c||(0,O.LfX)(c)?n.get(c):c:p}function vs(c,n,a,p,y={canDeactivateChecks:[],canActivateChecks:[]}){const w=wi(n);return c.children.forEach(C=>{(function el(c,n,a,p,y={canDeactivateChecks:[],canActivateChecks:[]}){const w=c.value,C=n?n.value:null,P=a?a.getContext(c.value.outlet):null;if(C&&w.routeConfig===C.routeConfig){const V=function uu(c,n,a){if("function"==typeof a)return a(c,n);switch(a){case"pathParamsChange":return!ge(c.url,n.url);case"pathParamsOrQueryParamsChange":return!ge(c.url,n.url)||!kr(c.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Qo(c,n)||!kr(c.queryParams,n.queryParams);default:return!Qo(c,n)}}(C,w,w.routeConfig.runGuardsAndResolvers);V?y.canActivateChecks.push(new Hi(p)):(w.data=C.data,w._resolvedData=C._resolvedData),vs(c,n,w.component?P?P.children:null:a,p,y),V&&P&&P.outlet&&P.outlet.isActivated&&y.canDeactivateChecks.push(new cl(P.outlet.component,C))}else C&&Sl(n,P,y),y.canActivateChecks.push(new Hi(p)),vs(c,null,w.component?P?P.children:null:a,p,y)})(C,w[C.value.outlet],a,p.concat([C.value]),y),delete w[C.value.outlet]}),Object.entries(w).forEach(([C,P])=>Sl(P,a.getContext(C),y)),y}function Sl(c,n,a){const p=wi(c),y=c.value;Object.entries(p).forEach(([w,C])=>{Sl(C,y.component?n?n.children.getContext(w):null:n,a)}),a.canDeactivateChecks.push(new cl(y.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,y))}function wo(c){return"function"==typeof c}function Cl(c){return c instanceof ct.G||"EmptyError"===c?.name}const $l=Symbol("INITIAL_VALUE");function zo(){return(0,qt.n)(c=>je(c.map(n=>n.pipe((0,Ht.s)(1),(0,lt.Z)($l)))).pipe((0,Cn.T)(n=>{for(const a of n)if(!0!==a){if(a===$l)return $l;if(!1===a||a instanceof ve)return a}return!0}),(0,Ct.p)(n=>n!==$l),(0,Ht.s)(1)))}function $s(c){return(0,Xe.F)((0,$t.M)(n=>{if(Ii(n))throw zl(0,n)}),(0,Cn.T)(n=>!0===n))}class Yo{constructor(n){this.segmentGroup=n||null}}class uo extends Error{constructor(n){super(),this.urlTree=n}}function Ns(c){return Le(new Yo(c))}class eu{constructor(n,a){this.urlSerializer=n,this.urlTree=a}lineralizeSegments(n,a){let p=[],y=a.root;for(;;){if(p=p.concat(y.segments),0===y.numberOfChildren)return(0,De.of)(p);if(y.numberOfChildren>1||!y.children[mr])return Le(new O.wOt(4e3,!1));y=y.children[mr]}}applyRedirectCommands(n,a,p){const y=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),n,p);if(a.startsWith("/"))throw new uo(y);return y}applyRedirectCreateUrlTree(n,a,p,y){const w=this.createSegmentGroup(n,a.root,p,y);return new ve(w,this.createQueryParams(a.queryParams,this.urlTree.queryParams),a.fragment)}createQueryParams(n,a){const p={};return Object.entries(n).forEach(([y,w])=>{if("string"==typeof w&&w.startsWith(":")){const P=w.substring(1);p[y]=a[P]}else p[y]=w}),p}createSegmentGroup(n,a,p,y){const w=this.createSegments(n,a.segments,p,y);let C={};return Object.entries(a.children).forEach(([P,V])=>{C[P]=this.createSegmentGroup(n,V,p,y)}),new re(w,C)}createSegments(n,a,p,y){return a.map(w=>w.path.startsWith(":")?this.findPosParam(n,w,y):this.findOrReturn(w,p))}findPosParam(n,a,p){const y=p[a.path.substring(1)];if(!y)throw new O.wOt(4001,!1);return y}findOrReturn(n,a){let p=0;for(const y of a){if(y.path===n.path)return a.splice(p),y;p++}return n}}const nl={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function sc(c,n,a,p,y){const w=os(c,n,a);return w.matched?(p=function Vo(c,n){return c.providers&&!c._injector&&(c._injector=(0,O.Ol2)(c.providers,n,`Route: ${c.path}`)),c._injector??n}(n,p),function Is(c,n,a,p){const y=n.canMatch;if(!y||0===y.length)return(0,De.of)(!0);const w=y.map(C=>{const P=da(C,c);return pt(function Uc(c){return c&&wo(c.canMatch)}(P)?P.canMatch(n,a):(0,O.N4e)(c,()=>P(n,a)))});return(0,De.of)(w).pipe(zo(),$s())}(p,n,a).pipe((0,Cn.T)(C=>!0===C?w:{...nl}))):(0,De.of)(w)}function os(c,n,a){if("**"===n.path)return function Ec(c){return{matched:!0,parameters:c.length>0?Ce(c).parameters:{},consumedSegments:c,remainingSegments:[],positionalParamSegments:{}}}(a);if(""===n.path)return"full"===n.pathMatch&&(c.hasChildren()||a.length>0)?{...nl}:{matched:!0,consumedSegments:[],remainingSegments:a,parameters:{},positionalParamSegments:{}};const y=(n.matcher||Hn)(a,c,n);if(!y)return{...nl};const w={};Object.entries(y.posParams??{}).forEach(([P,V])=>{w[P]=V.path});const C=y.consumed.length>0?{...w,...y.consumed[y.consumed.length-1].parameters}:w;return{matched:!0,consumedSegments:y.consumed,remainingSegments:a.slice(y.consumed.length),parameters:C,positionalParamSegments:y.posParams??{}}}function zc(c,n,a,p){return a.length>0&&function hu(c,n,a){return a.some(p=>Ps(c,n,p)&&zi(p)!==mr)}(c,a,p)?{segmentGroup:new re(n,Hl(p,new re(a,c.children))),slicedSegments:[]}:0===a.length&&function oc(c,n,a){return a.some(p=>Ps(c,n,p))}(c,a,p)?{segmentGroup:new re(c.segments,yo(c,a,p,c.children)),slicedSegments:a}:{segmentGroup:new re(c.segments,c.children),slicedSegments:a}}function yo(c,n,a,p){const y={};for(const w of a)if(Ps(c,n,w)&&!p[zi(w)]){const C=new re([],{});y[zi(w)]=C}return{...p,...y}}function Hl(c,n){const a={};a[mr]=n;for(const p of c)if(""===p.path&&zi(p)!==mr){const y=new re([],{});a[zi(p)]=y}return a}function Ps(c,n,a){return(!(c.hasChildren()||n.length>0)||"full"!==a.pathMatch)&&""===a.path}class ja{}class ha{constructor(n,a,p,y,w,C,P){this.injector=n,this.configLoader=a,this.rootComponentType=p,this.config=y,this.urlTree=w,this.paramsInheritanceStrategy=C,this.urlSerializer=P,this.applyRedirects=new eu(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(n){return new O.wOt(4002,`'${n.segmentGroup}'`)}recognize(){const n=zc(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe((0,Cn.T)(a=>{const p=new La([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},mr,this.rootComponentType,null,{}),y=new sa(p,a),w=new Bo("",y),C=function ki(c,n,a=null,p=null){return _i(ws(c),n,a,p)}(p,[],this.urlTree.queryParams,this.urlTree.fragment);return C.queryParams=this.urlTree.queryParams,w.url=this.urlSerializer.serialize(C),this.inheritParamsAndData(w._root,null),{state:w,tree:C}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n,mr).pipe(sn(p=>{if(p instanceof uo)return this.urlTree=p.urlTree,this.match(p.urlTree.root);throw p instanceof Yo?this.noMatchError(p):p}))}inheritParamsAndData(n,a){const p=n.value,y=Il(p,a,this.paramsInheritanceStrategy);p.params=Object.freeze(y.params),p.data=Object.freeze(y.data),n.children.forEach(w=>this.inheritParamsAndData(w,p))}processSegmentGroup(n,a,p,y){return 0===p.segments.length&&p.hasChildren()?this.processChildren(n,a,p):this.processSegment(n,a,p,p.segments,y,!0).pipe((0,Cn.T)(w=>w instanceof sa?[w]:[]))}processChildren(n,a,p){const y=[];for(const w of Object.keys(p.children))"primary"===w?y.unshift(w):y.push(w);return(0,ae.H)(y).pipe((0,Tt.H)(w=>{const C=p.children[w],P=function tc(c,n){const a=c.filter(p=>zi(p)===n);return a.push(...c.filter(p=>zi(p)!==n)),a}(a,w);return this.processSegmentGroup(n,P,C,w)}),(0,mn.S)((w,C)=>(w.push(...C),w)),(0,Vn.U)(null),function on(c,n){const a=arguments.length>=2;return p=>p.pipe(c?(0,Ct.p)((y,w)=>c(y,w,p)):xe.D,Fr(1),a?(0,Vn.U)(n):(0,Ot.v)(()=>new ct.G))}(),(0,Pt.Z)(w=>{if(null===w)return Ns(p);const C=ho(w);return function ql(c){c.sort((n,a)=>n.value.outlet===mr?-1:a.value.outlet===mr?1:n.value.outlet.localeCompare(a.value.outlet))}(C),(0,De.of)(C)}))}processSegment(n,a,p,y,w,C){return(0,ae.H)(a).pipe((0,Tt.H)(P=>this.processSegmentAgainstRoute(P._injector??n,a,P,p,y,w,C).pipe(sn(V=>{if(V instanceof Yo)return(0,De.of)(null);throw V}))),(0,Qe.$)(P=>!!P),sn(P=>{if(Cl(P))return function Wl(c,n,a){return 0===n.length&&!c.children[a]}(p,y,w)?(0,De.of)(new ja):Ns(p);throw P}))}processSegmentAgainstRoute(n,a,p,y,w,C,P){return function gs(c,n,a,p){return!!(zi(c)===p||p!==mr&&Ps(n,a,c))&&os(n,c,a).matched}(p,y,w,C)?void 0===p.redirectTo?this.matchSegmentAgainstRoute(n,y,p,w,C):this.allowRedirects&&P?this.expandSegmentAgainstRouteUsingRedirect(n,y,a,p,w,C):Ns(y):Ns(y)}expandSegmentAgainstRouteUsingRedirect(n,a,p,y,w,C){const{matched:P,consumedSegments:V,positionalParamSegments:K,remainingSegments:Y}=os(a,y,w);if(!P)return Ns(a);y.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const ce=this.applyRedirects.applyRedirectCommands(V,y.redirectTo,K);return this.applyRedirects.lineralizeSegments(y,ce).pipe((0,Pt.Z)(Pe=>this.processSegment(n,p,a,Pe.concat(Y),C,!1)))}matchSegmentAgainstRoute(n,a,p,y,w){const C=sc(a,p,y,n);return"**"===p.path&&(a.children={}),C.pipe((0,qt.n)(P=>P.matched?this.getChildConfig(n=p._injector??n,p,y).pipe((0,qt.n)(({routes:V})=>{const K=p._loadedInjector??n,{consumedSegments:Y,remainingSegments:ce,parameters:Pe}=P,Ke=new La(Y,Pe,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function wc(c){return c.data||{}}(p),zi(p),p.component??p._loadedComponent??null,p,function io(c){return c.resolve||{}}(p)),{segmentGroup:Ye,slicedSegments:rt}=zc(a,Y,ce,V);if(0===rt.length&&Ye.hasChildren())return this.processChildren(K,V,Ye).pipe((0,Cn.T)(pe=>null===pe?null:new sa(Ke,pe)));if(0===V.length&&0===rt.length)return(0,De.of)(new sa(Ke,[]));const ot=zi(p)===w;return this.processSegment(K,V,Ye,rt,ot?mr:w,!0).pipe((0,Cn.T)(pe=>new sa(Ke,pe instanceof sa?[pe]:[])))})):Ns(a)))}getChildConfig(n,a,p){return a.children?(0,De.of)({routes:a.children,injector:n}):a.loadChildren?void 0!==a._loadedRoutes?(0,De.of)({routes:a._loadedRoutes,injector:a._loadedInjector}):function Bi(c,n,a,p){const y=n.canLoad;if(void 0===y||0===y.length)return(0,De.of)(!0);const w=y.map(C=>{const P=da(C,c);return pt(function Al(c){return c&&wo(c.canLoad)}(P)?P.canLoad(n,a):(0,O.N4e)(c,()=>P(n,a)))});return(0,De.of)(w).pipe(zo(),$s())}(n,a,p).pipe((0,Pt.Z)(y=>y?this.configLoader.loadChildren(n,a).pipe((0,$t.M)(w=>{a._loadedRoutes=w.routes,a._loadedInjector=w.injector})):function du(c){return Le(aa(!1,Gi.GuardRejected))}())):(0,De.of)({routes:[],injector:n})}}function Rl(c){const n=c.value.routeConfig;return n&&""===n.path}function ho(c){const n=[],a=new Set;for(const p of c){if(!Rl(p)){n.push(p);continue}const y=n.find(w=>p.value.routeConfig===w.value.routeConfig);void 0!==y?(y.children.push(...p.children),a.add(y)):n.push(p)}for(const p of a){const y=ho(p.children);n.push(new sa(p.value,y))}return n.filter(p=>!a.has(p))}function Ls(c){const n=c.children.map(a=>Ls(a)).flat();return[c,...n]}function va(c){return(0,qt.n)(n=>{const a=c(n);return a?(0,ae.H)(a).pipe((0,Cn.T)(()=>n)):(0,De.of)(n)})}let Da=(()=>{class c{buildTitle(a){let p,y=a.root;for(;void 0!==y;)p=this.getResolvedTitleForRoute(y)??p,y=y.children.find(w=>w.outlet===mr);return p}getResolvedTitleForRoute(a){return a.data[Er]}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:()=>(0,O.WQX)(jc),providedIn:"root"})}return c})(),jc=(()=>{class c extends Da{constructor(a){super(),this.title=a}updateTitle(a){const p=this.buildTitle(a);void 0!==p&&this.title.setTitle(p)}static#e=this.\u0275fac=function(p){return new(p||c)(O.KVO(nr.hE))};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();const W=new O.nKC("",{providedIn:"root",factory:()=>({})}),ke=new O.nKC("");let ie=(()=>{class c{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,O.WQX)(O.Ql9)}loadComponent(a){if(this.componentLoaders.get(a))return this.componentLoaders.get(a);if(a._loadedComponent)return(0,De.of)(a._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(a);const p=pt(a.loadComponent()).pipe((0,Cn.T)(_n),(0,$t.M)(w=>{this.onLoadEndListener&&this.onLoadEndListener(a),a._loadedComponent=w}),(0,jr.j)(()=>{this.componentLoaders.delete(a)})),y=new Ge(p,()=>new nn.B).pipe(it());return this.componentLoaders.set(a,y),y}loadChildren(a,p){if(this.childrenLoaders.get(p))return this.childrenLoaders.get(p);if(p._loadedRoutes)return(0,De.of)({routes:p._loadedRoutes,injector:p._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(p);const w=function be(c,n,a,p){return pt(c.loadChildren()).pipe((0,Cn.T)(_n),(0,Pt.Z)(y=>y instanceof O.Co$||Array.isArray(y)?(0,De.of)(y):(0,ae.H)(n.compileModuleAsync(y))),(0,Cn.T)(y=>{p&&p(c);let w,C,P=!1;return Array.isArray(y)?(C=y,!0):(w=y.create(a).injector,C=w.get(ke,[],{optional:!0,self:!0}).flat()),{routes:C.map(_a),injector:w}}))}(p,this.compiler,a,this.onLoadEndListener).pipe((0,jr.j)(()=>{this.childrenLoaders.delete(p)})),C=new Ge(w,()=>new nn.B).pipe(it());return this.childrenLoaders.set(p,C),C}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();function _n(c){return function wt(c){return c&&"object"==typeof c&&"default"in c}(c)?c.default:c}let Gn=(()=>{class c{static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:()=>(0,O.WQX)(Ar),providedIn:"root"})}return c})(),Ar=(()=>{class c{shouldProcessUrl(a){return!0}extract(a){return a}merge(a,p){return a}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();const Xn=new O.nKC(""),Qr=new O.nKC("");function zs(c,n,a){const p=c.get(Qr),y=c.get(bn.qQ);return c.get(O.SKi).runOutsideAngular(()=>{if(!y.startViewTransition||p.skipNextTransition)return p.skipNextTransition=!1,Promise.resolve();let w;const C=new Promise(K=>{w=K}),P=y.startViewTransition(()=>(w(),function Wi(c){return new Promise(n=>{(0,O.mal)(n,{injector:c})})}(c))),{onViewTransitionCreated:V}=p;return V&&(0,O.N4e)(c,()=>V({transition:P,from:n,to:a})),C})}let fs=(()=>{class c{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new nn.B,this.transitionAbortSubject=new nn.B,this.configLoader=(0,O.WQX)(ie),this.environmentInjector=(0,O.WQX)(O.uvJ),this.urlSerializer=(0,O.WQX)($e),this.rootContexts=(0,O.WQX)(Xo),this.location=(0,O.WQX)(bn.aZ),this.inputBindingEnabled=null!==(0,O.WQX)(Bl,{optional:!0}),this.titleStrategy=(0,O.WQX)(Da),this.options=(0,O.WQX)(W,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=(0,O.WQX)(Gn),this.createViewTransition=(0,O.WQX)(Xn,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>(0,De.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=y=>this.events.next(new eo(y)),this.configLoader.onLoadStartListener=y=>this.events.next(new Nr(y))}complete(){this.transitions?.complete()}handleNavigationRequest(a){const p=++this.navigationId;this.transitions?.next({...this.transitions.value,...a,id:p})}setupNavigations(a,p,y){return this.transitions=new Be.t({id:0,currentUrlTree:p,currentRawUrl:p,extractedUrl:this.urlHandlingStrategy.extract(p),urlAfterRedirects:this.urlHandlingStrategy.extract(p),rawUrl:p,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:_s,restoredState:null,currentSnapshot:y.snapshot,targetSnapshot:null,currentRouterState:y,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Ct.p)(w=>0!==w.id),(0,Cn.T)(w=>({...w,extractedUrl:this.urlHandlingStrategy.extract(w.rawUrl)})),(0,qt.n)(w=>{let C=!1,P=!1;return(0,De.of)(w).pipe((0,qt.n)(V=>{if(this.navigationId>w.id)return this.cancelNavigationTransition(w,"",Gi.SupersededByNewNavigation),Te.w;this.currentTransition=w,this.currentNavigation={id:V.id,initialUrl:V.rawUrl,extractedUrl:V.extractedUrl,trigger:V.source,extras:V.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const K=!a.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!K&&"reload"!==(V.extras.onSameUrlNavigation??a.onSameUrlNavigation)){const ce="";return this.events.next(new Pi(V.id,this.urlSerializer.serialize(V.rawUrl),ce,ys.IgnoredSameUrlNavigation)),V.resolve(null),Te.w}if(this.urlHandlingStrategy.shouldProcessUrl(V.rawUrl))return(0,De.of)(V).pipe((0,qt.n)(ce=>{const Pe=this.transitions?.getValue();return this.events.next(new Mo(ce.id,this.urlSerializer.serialize(ce.extractedUrl),ce.source,ce.restoredState)),Pe!==this.transitions?.getValue()?Te.w:Promise.resolve(ce)}),function as(c,n,a,p,y,w){return(0,Pt.Z)(C=>function ya(c,n,a,p,y,w,C="emptyOnly"){return new ha(c,n,a,p,y,C,w).recognize()}(c,n,a,p,C.extractedUrl,y,w).pipe((0,Cn.T)(({state:P,tree:V})=>({...C,targetSnapshot:P,urlAfterRedirects:V}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,a.config,this.urlSerializer,this.paramsInheritanceStrategy),(0,$t.M)(ce=>{w.targetSnapshot=ce.targetSnapshot,w.urlAfterRedirects=ce.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:ce.urlAfterRedirects};const Pe=new Wo(ce.id,this.urlSerializer.serialize(ce.extractedUrl),this.urlSerializer.serialize(ce.urlAfterRedirects),ce.targetSnapshot);this.events.next(Pe)}));if(K&&this.urlHandlingStrategy.shouldProcessUrl(V.currentRawUrl)){const{id:ce,extractedUrl:Pe,source:Ke,restoredState:Ye,extras:rt}=V,ot=new Mo(ce,this.urlSerializer.serialize(Pe),Ke,Ye);this.events.next(ot);const pe=Us(this.rootComponentType).snapshot;return this.currentTransition=w={...V,targetSnapshot:pe,urlAfterRedirects:Pe,extras:{...rt,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=Pe,(0,De.of)(w)}{const ce="";return this.events.next(new Pi(V.id,this.urlSerializer.serialize(V.extractedUrl),ce,ys.IgnoredByUrlHandlingStrategy)),V.resolve(null),Te.w}}),(0,$t.M)(V=>{const K=new gc(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects),V.targetSnapshot);this.events.next(K)}),(0,Cn.T)(V=>(this.currentTransition=w={...V,guards:nc(V.targetSnapshot,V.currentSnapshot,this.rootContexts)},w)),function yc(c,n){return(0,Pt.Z)(a=>{const{targetSnapshot:p,currentSnapshot:y,guards:{canActivateChecks:w,canDeactivateChecks:C}}=a;return 0===C.length&&0===w.length?(0,De.of)({...a,guardsResult:!0}):function Ca(c,n,a,p){return(0,ae.H)(c).pipe((0,Pt.Z)(y=>function xc(c,n,a,p,y){const w=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!w||0===w.length)return(0,De.of)(!0);const C=w.map(P=>{const V=Uo(n)??y,K=da(P,V);return pt(function jl(c){return c&&wo(c.canDeactivate)}(K)?K.canDeactivate(c,n,a,p):(0,O.N4e)(V,()=>K(c,n,a,p))).pipe((0,Qe.$)())});return(0,De.of)(C).pipe(zo())}(y.component,y.route,a,n,p)),(0,Qe.$)(y=>!0!==y,!0))}(C,p,y,c).pipe((0,Pt.Z)(P=>P&&function Mc(c){return"boolean"==typeof c}(P)?function Jc(c,n,a,p){return(0,ae.H)(n).pipe((0,Tt.H)(y=>(0,Ue.x)(function Gl(c,n){return null!==c&&n&&n(new to(c)),(0,De.of)(!0)}(y.route.parent,p),function vc(c,n){return null!==c&&n&&n(new Bc(c)),(0,De.of)(!0)}(y.route,p),function Dl(c,n,a){const p=n[n.length-1],w=n.slice(0,n.length-1).reverse().map(C=>function Ja(c){const n=c.routeConfig?c.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:c,guards:n}:null}(C)).filter(C=>null!==C).map(C=>(0,nt.v)(()=>{const P=C.guards.map(V=>{const K=Uo(C.node)??a,Y=da(V,K);return pt(function Ts(c){return c&&wo(c.canActivateChild)}(Y)?Y.canActivateChild(p,c):(0,O.N4e)(K,()=>Y(p,c))).pipe((0,Qe.$)())});return(0,De.of)(P).pipe(zo())}));return(0,De.of)(w).pipe(zo())}(c,y.path,a),function ic(c,n,a){const p=n.routeConfig?n.routeConfig.canActivate:null;if(!p||0===p.length)return(0,De.of)(!0);const y=p.map(w=>(0,nt.v)(()=>{const C=Uo(n)??a,P=da(w,C);return pt(function rc(c){return c&&wo(c.canActivate)}(P)?P.canActivate(n,c):(0,O.N4e)(C,()=>P(n,c))).pipe((0,Qe.$)())}));return(0,De.of)(y).pipe(zo())}(c,y.route,a))),(0,Qe.$)(y=>!0!==y,!0))}(p,w,c,n):(0,De.of)(P)),(0,Cn.T)(P=>({...a,guardsResult:P})))})}(this.environmentInjector,V=>this.events.next(V)),(0,$t.M)(V=>{if(w.guardsResult=V.guardsResult,Ii(V.guardsResult))throw zl(0,V.guardsResult);const K=new Iu(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects),V.targetSnapshot,!!V.guardsResult);this.events.next(K)}),(0,Ct.p)(V=>!!V.guardsResult||(this.cancelNavigationTransition(V,"",Gi.GuardRejected),!1)),va(V=>{if(V.guards.canActivateChecks.length)return(0,De.of)(V).pipe((0,$t.M)(K=>{const Y=new bl(K.id,this.urlSerializer.serialize(K.extractedUrl),this.urlSerializer.serialize(K.urlAfterRedirects),K.targetSnapshot);this.events.next(Y)}),(0,qt.n)(K=>{let Y=!1;return(0,De.of)(K).pipe(function Pl(c,n){return(0,Pt.Z)(a=>{const{targetSnapshot:p,guards:{canActivateChecks:y}}=a;if(!y.length)return(0,De.of)(a);const w=new Set(y.map(V=>V.route)),C=new Set;for(const V of w)if(!C.has(V))for(const K of Ls(V))C.add(K);let P=0;return(0,ae.H)(C).pipe((0,Tt.H)(V=>w.has(V)?function la(c,n,a,p){const y=c.routeConfig,w=c._resolve;return void 0!==y?.title&&!Ko(y)&&(w[Er]=y.title),function ul(c,n,a,p){const y=Gt(c);if(0===y.length)return(0,De.of)({});const w={};return(0,ae.H)(y).pipe((0,Pt.Z)(C=>function lc(c,n,a,p){const y=Uo(n)??p,w=da(c,y);return pt(w.resolve?w.resolve(n,a):(0,O.N4e)(y,()=>w(n,a)))}(c[C],n,a,p).pipe((0,Qe.$)(),(0,$t.M)(P=>{w[C]=P}))),Fr(1),(0,Or.u)(w),sn(C=>Cl(C)?Te.w:Le(C)))}(w,c,n,p).pipe((0,Cn.T)(C=>(c._resolvedData=C,c.data=Il(c,c.parent,a).resolve,null)))}(V,p,c,n):(V.data=Il(V,V.parent,c).resolve,(0,De.of)(void 0))),(0,$t.M)(()=>P++),Fr(1),(0,Pt.Z)(V=>P===C.size?(0,De.of)(a):Te.w))})}(this.paramsInheritanceStrategy,this.environmentInjector),(0,$t.M)({next:()=>Y=!0,complete:()=>{Y||this.cancelNavigationTransition(K,"",Gi.NoDataFromResolver)}}))}),(0,$t.M)(K=>{const Y=new Fi(K.id,this.urlSerializer.serialize(K.extractedUrl),this.urlSerializer.serialize(K.urlAfterRedirects),K.targetSnapshot);this.events.next(Y)}))}),va(V=>{const K=Y=>{const ce=[];Y.routeConfig?.loadComponent&&!Y.routeConfig._loadedComponent&&ce.push(this.configLoader.loadComponent(Y.routeConfig).pipe((0,$t.M)(Pe=>{Y.component=Pe}),(0,Cn.T)(()=>{})));for(const Pe of Y.children)ce.push(...K(Pe));return ce};return je(K(V.targetSnapshot.root)).pipe((0,Vn.U)(null),(0,Ht.s)(1))}),va(()=>this.afterPreactivation()),(0,qt.n)(()=>{const{currentSnapshot:V,targetSnapshot:K}=w,Y=this.createViewTransition?.(this.environmentInjector,V.root,K.root);return Y?(0,ae.H)(Y).pipe((0,Cn.T)(()=>w)):(0,De.of)(w)}),(0,Cn.T)(V=>{const K=function Yc(c,n,a){const p=So(c,n._root,a?a._root:void 0);return new Zs(p,n)}(a.routeReuseStrategy,V.targetSnapshot,V.currentRouterState);return this.currentTransition=w={...V,targetRouterState:K},this.currentNavigation.targetRouterState=K,w}),(0,$t.M)(()=>{this.events.next(new Ro)}),((c,n,a,p)=>(0,Cn.T)(y=>(new ll(n,y.targetRouterState,y.currentRouterState,a,p).activate(c),y)))(this.rootContexts,a.routeReuseStrategy,V=>this.events.next(V),this.inputBindingEnabled),(0,Ht.s)(1),(0,$t.M)({next:V=>{C=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new bs(V.id,this.urlSerializer.serialize(V.extractedUrl),this.urlSerializer.serialize(V.urlAfterRedirects))),this.titleStrategy?.updateTitle(V.targetRouterState.snapshot),V.resolve(!0)},complete:()=>{C=!0}}),function Ai(c){return(0,Ze.N)((n,a)=>{(0,Qt.Tg)(c).subscribe((0,qe._)(a,()=>a.complete(),ur.l)),!a.closed&&n.subscribe(a)})}(this.transitionAbortSubject.pipe((0,$t.M)(V=>{throw V}))),(0,jr.j)(()=>{!C&&!P&&this.cancelNavigationTransition(w,"",Gi.SupersededByNewNavigation),this.currentTransition?.id===w.id&&(this.currentNavigation=null,this.currentTransition=null)}),sn(V=>{if(P=!0,Va(V))this.events.next(new fi(w.id,this.urlSerializer.serialize(w.extractedUrl),V.message,V.cancellationCode)),function Ba(c){return Va(c)&&Ii(c.url)}(V)?this.events.next(new Ta(V.url)):w.resolve(!1);else{this.events.next(new Fl(w.id,this.urlSerializer.serialize(w.extractedUrl),V,w.targetSnapshot??void 0));try{w.resolve(a.errorHandler(V))}catch(K){this.options.resolveNavigationPromiseOnError?w.resolve(!1):w.reject(K)}}return Te.w}))}))}cancelNavigationTransition(a,p,y){const w=new fi(a.id,this.urlSerializer.serialize(a.extractedUrl),p,y);this.events.next(w),a.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();function ji(c){return c!==_s}let so=(()=>{class c{static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:()=>(0,O.WQX)(xs),providedIn:"root"})}return c})();class Jo{shouldDetach(n){return!1}store(n,a){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,a){return n.routeConfig===a.routeConfig}}let xs=(()=>{class c extends Jo{static#e=this.\u0275fac=(()=>{let a;return function(y){return(a||(a=O.xGo(c)))(y||c)}})();static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})(),lr=(()=>{class c{static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:()=>(0,O.WQX)(Kr),providedIn:"root"})}return c})(),Kr=(()=>{class c extends lr{constructor(){super(...arguments),this.location=(0,O.WQX)(bn.aZ),this.urlSerializer=(0,O.WQX)($e),this.options=(0,O.WQX)(W,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=(0,O.WQX)(Gn),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new ve,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Us(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(a){return this.location.subscribe(p=>{"popstate"===p.type&&a(p.url,p.state)})}handleRouterEvent(a,p){if(a instanceof Mo)this.stateMemento=this.createStateMemento();else if(a instanceof Pi)this.rawUrlTree=p.initialUrl;else if(a instanceof Wo){if("eager"===this.urlUpdateStrategy&&!p.extras.skipLocationChange){const y=this.urlHandlingStrategy.merge(p.finalUrl,p.initialUrl);this.setBrowserUrl(y,p)}}else a instanceof Ro?(this.currentUrlTree=p.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(p.finalUrl,p.initialUrl),this.routerState=p.targetRouterState,"deferred"===this.urlUpdateStrategy&&(p.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,p))):a instanceof fi&&(a.code===Gi.GuardRejected||a.code===Gi.NoDataFromResolver)?this.restoreHistory(p):a instanceof Fl?this.restoreHistory(p,!0):a instanceof bs&&(this.lastSuccessfulId=a.id,this.currentPageId=this.browserPageId)}setBrowserUrl(a,p){const y=this.urlSerializer.serialize(a);if(this.location.isCurrentPathEqualTo(y)||p.extras.replaceUrl){const C={...p.extras.state,...this.generateNgRouterState(p.id,this.browserPageId)};this.location.replaceState(y,"",C)}else{const w={...p.extras.state,...this.generateNgRouterState(p.id,this.browserPageId+1)};this.location.go(y,"",w)}}restoreHistory(a,p=!1){if("computed"===this.canceledNavigationResolution){const w=this.currentPageId-this.browserPageId;0!==w?this.location.historyGo(w):this.currentUrlTree===a.finalUrl&&0===w&&(this.resetState(a),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(p&&this.resetState(a),this.resetUrlToCurrentUrlTree())}resetState(a){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,a.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(a,p){return"computed"===this.canceledNavigationResolution?{navigationId:a,\u0275routerPageId:p}:{navigationId:a}}static#e=this.\u0275fac=(()=>{let a;return function(y){return(a||(a=O.xGo(c)))(y||c)}})();static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();var Di=function(c){return c[c.COMPLETE=0]="COMPLETE",c[c.FAILED=1]="FAILED",c[c.REDIRECTING=2]="REDIRECTING",c}(Di||{});function Ni(c,n){c.events.pipe((0,Ct.p)(a=>a instanceof bs||a instanceof fi||a instanceof Fl||a instanceof Pi),(0,Cn.T)(a=>a instanceof bs||a instanceof Pi?Di.COMPLETE:a instanceof fi&&(a.code===Gi.Redirect||a.code===Gi.SupersededByNewNavigation)?Di.REDIRECTING:Di.FAILED),(0,Ct.p)(a=>a!==Di.REDIRECTING),(0,Ht.s)(1)).subscribe(()=>{n()})}function js(c){throw c}const ea={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},rl={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let qi=(()=>{class c{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=(0,O.WQX)(O.H3F),this.stateManager=(0,O.WQX)(lr),this.options=(0,O.WQX)(W,{optional:!0})||{},this.pendingTasks=(0,O.WQX)(O.TgB),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=(0,O.WQX)(fs),this.urlSerializer=(0,O.WQX)($e),this.location=(0,O.WQX)(bn.aZ),this.urlHandlingStrategy=(0,O.WQX)(Gn),this._events=new nn.B,this.errorHandler=this.options.errorHandler||js,this.navigated=!1,this.routeReuseStrategy=(0,O.WQX)(so),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=(0,O.WQX)(ke,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!(0,O.WQX)(Bl,{optional:!0}),this.eventsSubscription=new at.yU,this.isNgZoneEnabled=(0,O.WQX)(O.SKi)instanceof O.SKi&&O.SKi.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:a=>{this.console.warn(a)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const a=this.navigationTransitions.events.subscribe(p=>{try{const y=this.navigationTransitions.currentTransition,w=this.navigationTransitions.currentNavigation;if(null!==y&&null!==w)if(this.stateManager.handleRouterEvent(p,w),p instanceof fi&&p.code!==Gi.Redirect&&p.code!==Gi.SupersededByNewNavigation)this.navigated=!0;else if(p instanceof bs)this.navigated=!0;else if(p instanceof Ta){const C=this.urlHandlingStrategy.merge(p.url,y.currentRawUrl),P={info:y.extras.info,skipLocationChange:y.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ji(y.source)};this.scheduleNavigation(C,_s,null,P,{resolve:y.resolve,reject:y.reject,promise:y.promise})}(function fo(c){return!(c instanceof Ro||c instanceof Ta)})(p)&&this._events.next(p)}catch(y){this.navigationTransitions.transitionAbortSubject.next(y)}});this.eventsSubscription.add(a)}resetRootComponentType(a){this.routerState.root.component=a,this.navigationTransitions.rootComponentType=a}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),_s,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((a,p)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(a,"popstate",p)},0)})}navigateToSyncWithBrowser(a,p,y){const w={replaceUrl:!0},C=y?.navigationId?y:null;if(y){const V={...y};delete V.navigationId,delete V.\u0275routerPageId,0!==Object.keys(V).length&&(w.state=V)}const P=this.parseUrl(a);this.scheduleNavigation(P,p,C,w)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(a){this.config=a.map(_a),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(a,p={}){const{relativeTo:y,queryParams:w,fragment:C,queryParamsHandling:P,preserveFragment:V}=p,K=V?this.currentUrlTree.fragment:C;let ce,Y=null;switch(P){case"merge":Y={...this.currentUrlTree.queryParams,...w};break;case"preserve":Y=this.currentUrlTree.queryParams;break;default:Y=w||null}null!==Y&&(Y=this.removeEmptyProps(Y));try{ce=ws(y?y.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof a[0]||!a[0].startsWith("/"))&&(a=[]),ce=this.currentUrlTree.root}return _i(ce,a,Y,K??null)}navigateByUrl(a,p={skipLocationChange:!1}){const y=Ii(a)?a:this.parseUrl(a),w=this.urlHandlingStrategy.merge(y,this.rawUrlTree);return this.scheduleNavigation(w,_s,null,p)}navigate(a,p={skipLocationChange:!1}){return function ca(c){for(let n=0;n<c.length;n++)if(null==c[n])throw new O.wOt(4008,!1)}(a),this.navigateByUrl(this.createUrlTree(a,p),p)}serializeUrl(a){return this.urlSerializer.serialize(a)}parseUrl(a){try{return this.urlSerializer.parse(a)}catch{return this.urlSerializer.parse("/")}}isActive(a,p){let y;if(y=!0===p?{...ea}:!1===p?{...rl}:p,Ii(a))return Ur(this.currentUrlTree,a,y);const w=this.parseUrl(a);return Ur(this.currentUrlTree,w,y)}removeEmptyProps(a){return Object.entries(a).reduce((p,[y,w])=>(null!=w&&(p[y]=w),p),{})}scheduleNavigation(a,p,y,w,C){if(this.disposed)return Promise.resolve(!1);let P,V,K;C?(P=C.resolve,V=C.reject,K=C.promise):K=new Promise((ce,Pe)=>{P=ce,V=Pe});const Y=this.pendingTasks.add();return Ni(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Y))}),this.navigationTransitions.handleNavigationRequest({source:p,restoredState:y,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:a,extras:w,resolve:P,reject:V,promise:K,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),K.catch(ce=>Promise.reject(ce))}static#e=this.\u0275fac=function(p){return new(p||c)};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})(),Si=(()=>{class c{constructor(a,p,y,w,C,P){this.router=a,this.route=p,this.tabIndexAttribute=y,this.renderer=w,this.el=C,this.locationStrategy=P,this.href=null,this.commands=null,this.onChanges=new nn.B,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const V=C.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===V||"area"===V,this.isAnchorElement?this.subscription=a.events.subscribe(K=>{K instanceof bs&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(a){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",a)}ngOnChanges(a){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(a){null!=a?(this.commands=Array.isArray(a)?a:[a],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(a,p,y,w,C){const P=this.urlTree;return!!(null===P||this.isAnchorElement&&(0!==a||p||y||w||C||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(P,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const a=this.urlTree;this.href=null!==a&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(a)):null;const p=null===this.href?null:(0,O.n$t)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",p)}applyAttributeValue(a,p){const y=this.renderer,w=this.el.nativeElement;null!==p?y.setAttribute(w,a,p):y.removeAttribute(w,a)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(p){return new(p||c)(O.rXU(qi),O.rXU(Ei),O.kS0("tabindex"),O.rXU(O.sFG),O.rXU(O.aKT),O.rXU(bn.hb))};static#t=this.\u0275dir=O.FsC({type:c,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(p,y){1&p&&O.bIt("click",function(C){return y.onClick(C.button,C.ctrlKey,C.shiftKey,C.altKey,C.metaKey)}),2&p&&O.BMQ("target",y.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[O.Mj6.HasDecoratorInputTransform,"preserveFragment","preserveFragment",O.L39],skipLocationChange:[O.Mj6.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",O.L39],replaceUrl:[O.Mj6.HasDecoratorInputTransform,"replaceUrl","replaceUrl",O.L39],routerLink:"routerLink"},standalone:!0,features:[O.GFd,O.OA$]})}return c})();class Ol{}let Zl=(()=>{class c{constructor(a,p,y,w,C){this.router=a,this.injector=y,this.preloadingStrategy=w,this.loader=C}setUpPreloading(){this.subscription=this.router.events.pipe((0,Ct.p)(a=>a instanceof bs),(0,Tt.H)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(a,p){const y=[];for(const w of p){w.providers&&!w._injector&&(w._injector=(0,O.Ol2)(w.providers,a,`Route: ${w.path}`));const C=w._injector??a,P=w._loadedInjector??C;(w.loadChildren&&!w._loadedRoutes&&void 0===w.canLoad||w.loadComponent&&!w._loadedComponent)&&y.push(this.preloadConfig(C,w)),(w.children||w._loadedRoutes)&&y.push(this.processRoutes(P,w.children??w._loadedRoutes))}return(0,ae.H)(y).pipe((0,Ri.U)())}preloadConfig(a,p){return this.preloadingStrategy.preload(p,()=>{let y;y=p.loadChildren&&void 0===p.canLoad?this.loader.loadChildren(a,p):(0,De.of)(null);const w=y.pipe((0,Pt.Z)(C=>null===C?(0,De.of)(void 0):(p._loadedRoutes=C.routes,p._loadedInjector=C.injector,this.processRoutes(C.injector??a,C.routes))));if(p.loadComponent&&!p._loadedComponent){const C=this.loader.loadComponent(p);return(0,ae.H)([w,C]).pipe((0,Ri.U)())}return w})}static#e=this.\u0275fac=function(p){return new(p||c)(O.KVO(qi),O.KVO(O.Ql9),O.KVO(O.uvJ),O.KVO(Ol),O.KVO(ie))};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})();const jo=new O.nKC("");let Ga=(()=>{class c{constructor(a,p,y,w,C={}){this.urlSerializer=a,this.transitions=p,this.viewportScroller=y,this.zone=w,this.options=C,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},C.scrollPositionRestoration||="disabled",C.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(a=>{a instanceof Mo?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=a.navigationTrigger,this.restoredId=a.restoredState?a.restoredState.navigationId:0):a instanceof bs?(this.lastId=a.id,this.scheduleScrollEvent(a,this.urlSerializer.parse(a.urlAfterRedirects).fragment)):a instanceof Pi&&a.code===ys.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(a,this.urlSerializer.parse(a.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(a=>{a instanceof ba&&(a.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(a.position):a.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(a.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(a,p){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new ba(a,"popstate"===this.lastSource?this.store[this.restoredId]:null,p))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(p){O.QTQ()};static#t=this.\u0275prov=O.jDH({token:c,factory:c.\u0275fac})}return c})();function hl(c,n){return{\u0275kind:c,\u0275providers:n}}function vo(){const c=(0,O.WQX)(O.zZn);return n=>{const a=c.get(O.o8S);if(n!==a.components[0])return;const p=c.get(qi),y=c.get(zn);1===c.get(Gs)&&p.initialNavigation(),c.get(zr,null,O.$GK.Optional)?.setUpPreloading(),c.get(jo,null,O.$GK.Optional)?.init(),p.resetRootComponentType(a.componentTypes[0]),y.closed||(y.next(),y.complete(),y.unsubscribe())}}const zn=new O.nKC("",{factory:()=>new nn.B}),Gs=new O.nKC("",{providedIn:"root",factory:()=>1}),zr=new O.nKC("");function $u(c){return hl(0,[{provide:zr,useExisting:Zl},{provide:Ol,useExisting:c}])}function Cr(c){return hl(9,[{provide:Xn,useValue:zs},{provide:Qr,useValue:{skipNextTransition:!!c?.skipInitialTransition,...c}}])}const $c=new O.nKC("ROUTER_FORROOT_GUARD"),bc=[bn.aZ,{provide:$e,useClass:Re},qi,Xo,{provide:Ei,useFactory:function fa(c){return c.routerState.root},deps:[qi]},ie,[]];let uc=(()=>{class c{constructor(a){}static forRoot(a,p){return{ngModule:c,providers:[bc,[],{provide:ke,multi:!0,useValue:a},{provide:$c,useFactory:yd,deps:[[qi,new O.Xx1,new O.kdw]]},{provide:W,useValue:p||{}},p?.useHash?{provide:bn.hb,useClass:bn.fw}:{provide:bn.hb,useClass:bn.Sm},{provide:jo,useFactory:()=>{const c=(0,O.WQX)(bn.Xr),n=(0,O.WQX)(O.SKi),a=(0,O.WQX)(W),p=(0,O.WQX)(fs),y=(0,O.WQX)($e);return a.scrollOffset&&c.setOffset(a.scrollOffset),new Ga(y,p,c,n,a)}},p?.preloadingStrategy?$u(p.preloadingStrategy).\u0275providers:[],p?.initialNavigation?Gu(p):[],p?.bindToComponentInputs?hl(8,[Qa,{provide:Bl,useExisting:Qa}]).\u0275providers:[],p?.enableViewTransitions?Cr().\u0275providers:[],[{provide:td,useFactory:vo},{provide:O.iLQ,multi:!0,useExisting:td}]]}}static forChild(a){return{ngModule:c,providers:[{provide:ke,multi:!0,useValue:a}]}}static#e=this.\u0275fac=function(p){return new(p||c)(O.KVO($c,8))};static#t=this.\u0275mod=O.$C({type:c});static#n=this.\u0275inj=O.G2t({})}return c})();function yd(c){return"guarded"}function Gu(c){return["disabled"===c.initialNavigation?hl(3,[{provide:O.hnV,multi:!0,useFactory:()=>{const n=(0,O.WQX)(qi);return()=>{n.setUpLocationChangeListener()}}},{provide:Gs,useValue:2}]).\u0275providers:[],"enabledBlocking"===c.initialNavigation?hl(2,[{provide:Gs,useValue:0},{provide:O.hnV,multi:!0,deps:[O.zZn],useFactory:n=>{const a=n.get(bn.hj,Promise.resolve());return()=>a.then(()=>new Promise(p=>{const y=n.get(qi),w=n.get(zn);Ni(y,()=>{p(!0)}),n.get(fs).afterPreactivation=()=>(p(!0),w.closed?(0,De.of)(void 0):w),y.initialNavigation()}))}}]).\u0275providers:[]]}const td=new O.nKC("")},8041:(An,xt,H)=>{"use strict";H.d(xt,{$b:()=>z,Ey:()=>xe,He:()=>Ve,Vy:()=>Be});const O=[];var z=function(se){return se[se.DEBUG=0]="DEBUG",se[se.VERBOSE=1]="VERBOSE",se[se.INFO=2]="INFO",se[se.WARN=3]="WARN",se[se.ERROR=4]="ERROR",se[se.SILENT=5]="SILENT",se}(z||{});const ye={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},m=z.INFO,ae={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},De=(se,me,...He)=>{if(me<se.logLevel)return;const qe=(new Date).toISOString(),Oe=ae[me];if(!Oe)throw new Error(`Attempted to log a message with an invalid logType (value: ${me})`);console[Oe](`[${qe}]  ${se.name}:`,...He)};class Be{constructor(me){this.name=me,this._logLevel=m,this._logHandler=De,this._userLogHandler=null,O.push(this)}get logLevel(){return this._logLevel}set logLevel(me){if(!(me in z))throw new TypeError(`Invalid value "${me}" assigned to \`logLevel\``);this._logLevel=me}setLogLevel(me){this._logLevel="string"==typeof me?ye[me]:me}get logHandler(){return this._logHandler}set logHandler(me){if("function"!=typeof me)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=me}get userLogHandler(){return this._userLogHandler}set userLogHandler(me){this._userLogHandler=me}debug(...me){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...me),this._logHandler(this,z.DEBUG,...me)}log(...me){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...me),this._logHandler(this,z.VERBOSE,...me)}info(...me){this._userLogHandler&&this._userLogHandler(this,z.INFO,...me),this._logHandler(this,z.INFO,...me)}warn(...me){this._userLogHandler&&this._userLogHandler(this,z.WARN,...me),this._logHandler(this,z.WARN,...me)}error(...me){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...me),this._logHandler(this,z.ERROR,...me)}}function Ve(se){O.forEach(me=>{me.setLogLevel(se)})}function xe(se,me){for(const He of O){let qe=null;me&&me.level&&(qe=ye[me.level]),He.userLogHandler=null===se?null:(Oe,je,...ht)=>{const et=ht.map(ct=>{if(null==ct)return null;if("string"==typeof ct)return ct;if("number"==typeof ct||"boolean"==typeof ct)return ct.toString();if(ct instanceof Error)return ct.message;try{return JSON.stringify(ct)}catch{return null}}).filter(ct=>ct).join(" ");je>=(qe??Oe.logLevel)&&se({level:z[je].toLowerCase(),message:et,args:ht,type:Oe.name})}}}},9987:(An,xt,H)=>{"use strict";H.d(xt,{dp:()=>yd,JF:()=>Un,Ts:()=>Gs});var O=H(2248),z=H(1769),ye=H(781),m=H(2064),ae=H(557),De=H(1057);const Be=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/],Ve=[/^.*\/healthcheck$/,/^.*\/healthy$/,/^.*\/live$/,/^.*\/ready$/,/^.*\/heartbeat$/,/^.*\/health$/,/^.*\/healthz$/],xe="InboundFilters",me=(0,De._C)((Z={})=>({name:xe,setupOnce(){},processEvent(c,n,a){const p=a.getOptions(),y=function qe(Z={},c={}){return{allowUrls:[...Z.allowUrls||[],...c.allowUrls||[]],denyUrls:[...Z.denyUrls||[],...c.denyUrls||[]],ignoreErrors:[...Z.ignoreErrors||[],...c.ignoreErrors||[],...Z.disableErrorDefaults?[]:Be],ignoreTransactions:[...Z.ignoreTransactions||[],...c.ignoreTransactions||[],...Z.disableTransactionDefaults?[]:Ve],ignoreInternal:void 0===Z.ignoreInternal||Z.ignoreInternal}}(Z,p);return function Oe(Z,c){return c.ignoreInternal&&function nt(Z){try{return"SentryError"===Z.exception.values[0].type}catch{}return!1}(Z)?(ae.T&&z.vF.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${(0,ye.$X)(Z)}`),!0):function je(Z,c){return!(Z.type||!c||!c.length)&&function Ue(Z){const c=[];let n;Z.message&&c.push(Z.message);try{n=Z.exception.values[Z.exception.values.length-1]}catch{}return n&&n.value&&(c.push(n.value),n.type&&c.push(`${n.type}: ${n.value}`)),ae.T&&0===c.length&&z.vF.error(`Could not extract message for event ${(0,ye.$X)(Z)}`),c}(Z).some(n=>(0,m.Xr)(n,c))}(Z,c.ignoreErrors)?(ae.T&&z.vF.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${(0,ye.$X)(Z)}`),!0):function ht(Z,c){if("transaction"!==Z.type||!c||!c.length)return!1;const n=Z.transaction;return!!n&&(0,m.Xr)(n,c)}(Z,c.ignoreTransactions)?(ae.T&&z.vF.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${(0,ye.$X)(Z)}`),!0):function et(Z,c){if(!c||!c.length)return!1;const n=Le(Z);return!!n&&(0,m.Xr)(n,c)}(Z,c.denyUrls)?(ae.T&&z.vF.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${(0,ye.$X)(Z)}.\nUrl: ${Le(Z)}`),!0):!function ct(Z,c){if(!c||!c.length)return!0;const n=Le(Z);return!n||(0,m.Xr)(n,c)}(Z,c.allowUrls)&&(ae.T&&z.vF.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${(0,ye.$X)(Z)}.\nUrl: ${Le(Z)}`),!0)}(c,y)?null:c}}));function Le(Z){try{let c;try{c=Z.exception.values[0].stacktrace.frames}catch{}return c?function Xe(Z=[]){for(let c=Z.length-1;c>=0;c--){const n=Z[c];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(c):null}catch{return ae.T&&z.vF.error(`Cannot extract url for event ${(0,ye.$X)(Z)}`),null}}(0,De.F)(xe,me);var Te=H(7474);let at;const Ze="FunctionToString",it=new WeakMap,nn=(0,De._C)(()=>({name:Ze,setupOnce(){at=Function.prototype.toString;try{Function.prototype.toString=function(...Z){const c=(0,Te.sp)(this),n=it.has((0,O.KU)())&&void 0!==c?c:this;return at.apply(n,Z)}}catch{}},setup(Z){it.set(Z,!0)}}));(0,De.F)(Ze,nn);var Cn=H(5560);var Ct=H(8251),Pt=H(9868),Qe=H(5953),Tt=H(6597),$t=H(5948),Qt=H(7199);function sn(Z,c,n=[c],a="npm"){const p=Z._metadata||{};p.sdk||(p.sdk={name:`sentry.javascript.${c}`,packages:n.map(y=>({name:`${a}:@sentry/${y}`,version:Qt.M})),version:Qt.M}),Z._metadata=p}var mn=H(286),Vn=H(4965),Fr=H(5800),on=H(3892);const Or=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;var jr=H(5801),ur=H(5433),Ai=H(7473);function Ri(Z,c){const n=Er(Z,c),a={type:c&&c.name,value:Hn(c)};return n.length&&(a.stacktrace={frames:n}),void 0===a.type&&""===a.value&&(a.value="Unrecoverable error caught"),a}function mr(Z,c){return{exception:{values:[Ri(Z,c)]}}}function Er(Z,c){const n=c.stacktrace||c.stack||"",a=function us(Z){if(Z){if("number"==typeof Z.framesToPop)return Z.framesToPop;if(Zn.test(Z.message))return 1}return 0}(c);try{return Z(n,a)}catch{}return[]}const Zn=/Minified React error #\d+;/i;function Hn(Z){const c=Z&&Z.message;return c?c.error&&"string"==typeof c.error.message?c.error.message:c:"No error message"}function Gt(Z,c,n,a,p){let y;if((0,jr.T2)(c)&&c.error)return mr(Z,c.error);if((0,jr.BD)(c)||(0,jr.W6)(c)){const w=c;if("stack"in c)y=mr(Z,c);else{const C=w.name||((0,jr.BD)(w)?"DOMError":"DOMException"),P=w.message?`${C}: ${w.message}`:C;y=Bt(Z,P,n,a),(0,ye.gO)(y,P)}return"code"in w&&(y.tags={...y.tags,"DOMException.code":`${w.code}`}),y}return(0,jr.bJ)(c)?mr(Z,c):(0,jr.Qd)(c)||(0,jr.xH)(c)?(y=function nr(Z,c,n,a){const p=(0,O.KU)(),y=p&&p.getOptions().normalizeDepth,w={exception:{values:[{type:(0,jr.xH)(c)?c.constructor.name:a?"UnhandledRejection":"Error",value:Ce(c,{isUnhandledRejection:a})}]},extra:{__serialized__:(0,ur.cd)(c,y)}};if(n){const C=Er(Z,n);C.length&&(w.exception.values[0].stacktrace={frames:C})}return w}(Z,c,n,p),(0,ye.M6)(y,{synthetic:!0}),y):(y=Bt(Z,c,n,a),(0,ye.gO)(y,`${c}`,void 0),(0,ye.M6)(y,{synthetic:!0}),y)}function Bt(Z,c,n,a){const p={};if(a&&n){const y=Er(Z,n);y.length&&(p.exception={values:[{value:c,stacktrace:{frames:y}}]})}if((0,jr.NF)(c)){const{__sentry_template_string__:y,__sentry_template_values__:w}=c;return p.logentry={message:y,params:w},p}return p.message=c,p}function Ce(Z,{isUnhandledRejection:c}){const n=(0,Te.HF)(Z),a=c?"promise rejection":"exception";return(0,jr.T2)(Z)?`Event \`ErrorEvent\` captured as ${a} with message \`${Z.message}\``:(0,jr.xH)(Z)?`Event \`${function pt(Z){try{const c=Object.getPrototypeOf(Z);return c?c.constructor.name:void 0}catch{}}(Z)}\` (type=${Z.type}) captured as ${a}`:`Object captured as ${a} with keys: ${n}`}var Mt=H(7018);const hn=Mt.OW;let Ur=0;function vi(){return Ur>0}function ci(Z,c={},n){if("function"!=typeof Z)return Z;try{const p=Z.__sentry_wrapped__;if(p)return p;if((0,Te.sp)(Z))return Z}catch{return Z}const a=function(){const p=Array.prototype.slice.call(arguments);try{n&&"function"==typeof n&&n.apply(this,arguments);const y=p.map(w=>ci(w,c));return Z.apply(this,y)}catch(y){throw function $r(){Ur++,setTimeout(()=>{Ur--})}(),(0,O.v4)(w=>{w.addEventProcessor(C=>(c.mechanism&&((0,ye.gO)(C,void 0,void 0),(0,ye.M6)(C,c.mechanism)),C.extra={...C.extra,arguments:p},C)),(0,O.Cp)(y)}),y}};try{for(const p in Z)Object.prototype.hasOwnProperty.call(Z,p)&&(a[p]=Z[p])}catch{}(0,Te.pO)(a,Z),(0,Te.my)(Z,"__sentry_wrapped__",a);try{Object.getOwnPropertyDescriptor(a,"name").configurable&&Object.defineProperty(a,"name",{get:()=>Z.name})}catch{}return a}class Zt extends $t.V{constructor(c){sn(c,"browser",["browser"],hn.SENTRY_SDK_SOURCE||(0,mn.e)()),super(c),c.sendClientReports&&hn.document&&hn.document.addEventListener("visibilitychange",()=>{"hidden"===hn.document.visibilityState&&this._flushOutcomes()})}eventFromException(c,n){return function Sr(Z,c,n,a){const y=Gt(Z,c,n&&n.syntheticException||void 0,a);return(0,ye.M6)(y),y.level="error",n&&n.event_id&&(y.event_id=n.event_id),(0,Ai.XW)(y)}(this._options.stackParser,c,n,this._options.attachStacktrace)}eventFromMessage(c,n="info",a){return function kr(Z,c,n="info",a,p){const w=Bt(Z,c,a&&a.syntheticException||void 0,p);return w.level=n,a&&a.event_id&&(w.event_id=a.event_id),(0,Ai.XW)(w)}(this._options.stackParser,c,n,a,this._options.attachStacktrace)}captureUserFeedback(c){if(!this._isEnabled())return void(Or&&z.vF.warn("SDK not enabled, will not capture user feedback."));const n=function qn(Z,{metadata:c,tunnel:n,dsn:a}){const p={event_id:Z.event_id,sent_at:(new Date).toISOString(),...c&&c.sdk&&{sdk:{name:c.sdk.name,version:c.sdk.version}},...!!n&&!!a&&{dsn:(0,on.SB)(a)}},y=function Fs(Z){return[{type:"user_report"},Z]}(Z);return(0,Vn.h4)(p,[y])}(c,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this._sendEnvelope(n)}_prepareEvent(c,n,a){return c.platform=c.platform||"javascript",super._prepareEvent(c,n,a)}_flushOutcomes(){const c=this._clearOutcomes();if(0===c.length)return void(Or&&z.vF.log("No outcomes to send"));if(!this._dsn)return void(Or&&z.vF.log("No dsn provided, will not send outcomes"));Or&&z.vF.log("Sending outcomes:",c);const n=function Ot(Z,c,n){const a=[{type:"client_report"},{timestamp:n||(0,Fr.lu)(),discarded_events:Z}];return(0,Vn.h4)(c?{dsn:c}:{},[a])}(c,this._options.tunnel&&(0,on.SB)(this._dsn));this._sendEnvelope(n)}}var ve=H(9243);function Q(){"console"in Mt.OW&&z.Ow.forEach(function(Z){Z in Mt.OW.console&&(0,Te.GS)(Mt.OW.console,Z,function(c){return z.Z9[Z]=c,function(...n){(0,ve.aj)("console",{args:n,level:Z});const p=z.Z9[Z];p&&p.apply(Mt.OW.console,n)}})})}var oe=H(6084),ge=H(5429),Me=H(8603),$e=H(8617);const Re=["fatal","error","warning","log","info","debug"];function we(Z){return"warn"===Z?"warning":Re.includes(Z)?Z:"log"}function Je(Z){if(!Z)return{};const c=Z.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!c)return{};const n=c[6]||"",a=c[8]||"";return{host:c[4],path:c[5],protocol:c[2],search:n,hash:a,relative:c[5]+n+a}}const Rt="Breadcrumbs",ar=(0,De._C)((Z={})=>{const c={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...Z};return{name:Rt,setupOnce(){},setup(n){c.console&&function re(Z){const c="console";(0,ve.s5)(c,Z),(0,ve.AS)(c,Q)}(function $i(Z){return function(n){if((0,O.KU)()!==Z)return;const a={category:"console",data:{arguments:n.args,logger:"console"},level:we(n.level),message:(0,m.gt)(n.args," ")};if("assert"===n.level){if(!1!==n.args[0])return;a.message=`Assertion failed: ${(0,m.gt)(n.args.slice(1)," ")||"console.assert"}`,a.data.arguments=n.args.slice(1)}(0,O.ZQ)(a,{input:n.args,level:n.level})}}(n)),c.dom&&(0,oe.i)(function Li(Z,c){return function(a){if((0,O.KU)()!==Z)return;let p,y,w="object"==typeof c?c.serializeAttribute:void 0,C="object"==typeof c&&"number"==typeof c.maxStringLength?c.maxStringLength:void 0;C&&C>1024&&(Or&&z.vF.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${C} was configured. Sentry will use 1024 instead.`),C=1024),"string"==typeof w&&(w=[w]);try{const V=a.event,K=function ra(Z){return!!Z&&!!Z.target}(V)?V.target:V;p=(0,$e.Hd)(K,{keyAttrs:w,maxStringLength:C}),y=(0,$e.xE)(K)}catch{p="<unknown>"}if(0===p.length)return;const P={category:`ui.${a.name}`,message:p};y&&(P.data={"ui.component_name":y}),(0,O.ZQ)(P,{event:a.event,name:a.name,global:a.global})}}(n,c.dom)),c.xhr&&(0,ge.Mn)(function Wr(Z){return function(n){if((0,O.KU)()!==Z)return;const{startTimestamp:a,endTimestamp:p}=n,y=n.xhr[ge.Er];if(!a||!p||!y)return;const{method:w,url:C,status_code:P,body:V}=y;(0,O.ZQ)({category:"xhr",data:{method:w,url:C,status_code:P},type:"http"},{xhr:n.xhr,input:V,startTimestamp:a,endTimestamp:p})}}(n)),c.fetch&&(0,Me.u)(function _r(Z){return function(n){if((0,O.KU)()!==Z)return;const{startTimestamp:a,endTimestamp:p}=n;if(p&&(!n.fetchData.url.match(/sentry_key/)||"POST"!==n.fetchData.method))if(n.error)(0,O.ZQ)({category:"fetch",data:n.fetchData,level:"error",type:"http"},{data:n.error,input:n.args,startTimestamp:a,endTimestamp:p});else{const y=n.response,w={...n.fetchData,status_code:y&&y.status};(0,O.ZQ)({category:"fetch",data:w,type:"http"},{input:n.args,response:y,startTimestamp:a,endTimestamp:p})}}}(n)),c.history&&(0,Tt._)(function Bs(Z){return function(n){if((0,O.KU)()!==Z)return;let a=n.from,p=n.to;const y=Je(hn.location.href);let w=a?Je(a):void 0;const C=Je(p);(!w||!w.path)&&(w=y),y.protocol===C.protocol&&y.host===C.host&&(p=C.relative),y.protocol===w.protocol&&y.host===w.host&&(a=w.relative),(0,O.ZQ)({category:"navigation",data:{from:a,to:p}})}}(n)),c.sentry&&n.on&&n.on("beforeSendEvent",function Hr(Z){return function(n){(0,O.KU)()===Z&&(0,O.ZQ)({category:"sentry."+("transaction"===n.type?"transaction":"event"),event_id:n.event_id,level:n.level,message:(0,ye.$X)(n)},{event:n})}}(n))}}});(0,De.F)(Rt,ar);const Jt=(0,De._C)(()=>{let Z;return{name:"Dedupe",setupOnce(){},processEvent(c){if(c.type)return c;try{if(function Gr(Z,c){return!(!c||!function gi(Z,c){const n=Z.message,a=c.message;return!(!n&&!a||n&&!a||!n&&a||n!==a||!ws(Z,c)||!ki(Z,c))}(Z,c)&&!function Ii(Z,c){const n=_i(c),a=_i(Z);return!!(n&&a&&n.type===a.type&&n.value===a.value&&ws(Z,c)&&ki(Z,c))}(Z,c))}(c,Z))return Or&&z.vF.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return Z=c}}});function ki(Z,c){let n=ut(Z),a=ut(c);if(!n&&!a)return!0;if(n&&!a||!n&&a||a.length!==n.length)return!1;for(let p=0;p<a.length;p++){const y=a[p],w=n[p];if(y.filename!==w.filename||y.lineno!==w.lineno||y.colno!==w.colno||y.function!==w.function)return!1}return!0}function ws(Z,c){let n=Z.fingerprint,a=c.fingerprint;if(!n&&!a)return!0;if(n&&!a||!n&&a)return!1;try{return n.join("")===a.join("")}catch{return!1}}function _i(Z){return Z.exception&&Z.exception.values&&Z.exception.values[0]}function ut(Z){const c=Z.exception;if(c)try{return c.values[0].stacktrace.frames}catch{return}}(0,De.F)("Dedupe",Jt);let Dt=null;function Nt(Z){const c="error";(0,ve.s5)(c,Z),(0,ve.AS)(c,wn)}function wn(){Dt=Mt.OW.onerror,Mt.OW.onerror=function(Z,c,n,a,p){return(0,ve.aj)("error",{column:a,error:p,line:n,msg:Z,url:c}),!(!Dt||Dt.__SENTRY_LOADER__)&&Dt.apply(this,arguments)},Mt.OW.onerror.__SENTRY_INSTRUMENTED__=!0}let bt=null;function On(Z){const c="unhandledrejection";(0,ve.s5)(c,Z),(0,ve.AS)(c,sr)}function sr(){bt=Mt.OW.onunhandledrejection,Mt.OW.onunhandledrejection=function(Z){return(0,ve.aj)("unhandledrejection",Z),!(bt&&!bt.__SENTRY_LOADER__)||bt.apply(this,arguments)},Mt.OW.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}const ei="GlobalHandlers",li=(0,De._C)((Z={})=>{const c={onerror:!0,onunhandledrejection:!0,...Z};return{name:ei,setupOnce(){Error.stackTraceLimit=50},setup(n){c.onerror&&(function Ds(Z){Nt(c=>{const{stackParser:n,attachStacktrace:a}=br();if((0,O.KU)()!==Z||vi())return;const{msg:p,url:y,line:w,column:C,error:P}=c,V=void 0===P&&(0,jr.Kg)(p)?function qr(Z,c,n,a){let y=(0,jr.T2)(Z)?Z.message:Z,w="Error";const C=y.match(/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i);return C&&(w=C[1],y=C[2]),Ci({exception:{values:[{type:w,value:y}]}},c,n,a)}(p,y,w,C):Ci(Gt(n,P||p,void 0,a,!1),y,w,C);V.level="error",(0,O.r)(V,{originalException:P,mechanism:{handled:!1,type:"onerror"}})})}(n),_s("onerror")),c.onunhandledrejection&&(function Vs(Z){On(c=>{const{stackParser:n,attachStacktrace:a}=br();if((0,O.KU)()!==Z||vi())return;const p=function gr(Z){if((0,jr.sO)(Z))return Z;const c=Z;try{if("reason"in c)return c.reason;if("detail"in c&&"reason"in c.detail)return c.detail.reason}catch{}return Z}(c),y=(0,jr.sO)(p)?function ti(Z){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(Z)}`}]}}}(p):Gt(n,p,void 0,a,!0);y.level="error",(0,O.r)(y,{originalException:p,mechanism:{handled:!1,type:"onunhandledrejection"}})})}(n),_s("onunhandledrejection"))}}});function Ci(Z,c,n,a){const p=Z.exception=Z.exception||{},y=p.values=p.values||[],w=y[0]=y[0]||{},C=w.stacktrace=w.stacktrace||{},P=C.frames=C.frames||[],V=isNaN(parseInt(a,10))?void 0:a,K=isNaN(parseInt(n,10))?void 0:n,Y=(0,jr.Kg)(c)&&c.length>0?c:(0,$e.$N)();return 0===P.length&&P.push({colno:V,filename:Y,function:"?",in_app:!0,lineno:K}),Z}function _s(Z){Or&&z.vF.log(`Global Handler attached: ${Z}`)}function br(){const Z=(0,O.KU)();return Z&&Z.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}(0,De.F)(ei,li);const Ui="HttpContext",bs=(0,De._C)(()=>({name:Ui,setupOnce(){},preprocessEvent(Z){if(!hn.navigator&&!hn.location&&!hn.document)return;const c=Z.request&&Z.request.url||hn.location&&hn.location.href,{referrer:n}=hn.document||{},{userAgent:a}=hn.navigator||{},p={...Z.request&&Z.request.headers,...n&&{Referer:n},...a&&{"User-Agent":a}},y={...Z.request,...c&&{url:c},headers:p};Z.request=y}}));function ys(Z,c,n=250,a,p,y,w){if(!(y.exception&&y.exception.values&&w&&(0,jr.tH)(w.originalException,Error)))return;const C=y.exception.values.length>0?y.exception.values[y.exception.values.length-1]:void 0;C&&(y.exception.values=function Wo(Z,c){return Z.map(n=>(n.value&&(n.value=(0,m.xv)(n.value,c)),n))}(fi(Z,c,p,w.originalException,a,y.exception.values,C,0),n))}function fi(Z,c,n,a,p,y,w,C){if(y.length>=n+1)return y;let P=[...y];if((0,jr.tH)(a[p],Error)){Pi(w,C);const V=Z(c,a[p]),K=P.length;Fl(V,p,K,C),P=fi(Z,c,n,a[p],p,[V,...P],V,K)}return Array.isArray(a.errors)&&a.errors.forEach((V,K)=>{if((0,jr.tH)(V,Error)){Pi(w,C);const Y=Z(c,V),ce=P.length;Fl(Y,`errors[${K}]`,ce,C),P=fi(Z,c,n,V,p,[Y,...P],Y,ce)}}),P}function Pi(Z,c){Z.mechanism=Z.mechanism||{type:"generic",handled:!0},Z.mechanism={...Z.mechanism,..."AggregateError"===Z.type&&{is_exception_group:!0},exception_id:c}}function Fl(Z,c,n,a){Z.mechanism=Z.mechanism||{type:"generic",handled:!0},Z.mechanism={...Z.mechanism,type:"chained",source:c,exception_id:n,parent_id:a}}(0,De.F)(Ui,bs);const bl="LinkedErrors",Nr=(0,De._C)((Z={})=>{const c=Z.limit||5,n=Z.key||"cause";return{name:bl,setupOnce(){},preprocessEvent(a,p,y){const w=y.getOptions();ys(Ri,w.stackParser,w.maxValueLength,n,c,a,p)}}}),to=((0,De.F)(bl,Nr),["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"]),ds="TryCatch",Tl=(0,De._C)((Z={})=>{const c={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...Z};return{name:ds,setupOnce(){c.setTimeout&&(0,Te.GS)(hn,"setTimeout",Ro),c.setInterval&&(0,Te.GS)(hn,"setInterval",Ro),c.requestAnimationFrame&&(0,Te.GS)(hn,"requestAnimationFrame",Ta),c.XMLHttpRequest&&"XMLHttpRequest"in hn&&(0,Te.GS)(XMLHttpRequest.prototype,"send",al);const n=c.eventTarget;n&&(Array.isArray(n)?n:to).forEach(no)}}});function Ro(Z){return function(...c){return c[0]=ci(c[0],{mechanism:{data:{function:(0,Pt.qQ)(Z)},handled:!1,type:"instrument"}}),Z.apply(this,c)}}function Ta(Z){return function(c){return Z.apply(this,[ci(c,{mechanism:{data:{function:"requestAnimationFrame",handler:(0,Pt.qQ)(Z)},handled:!1,type:"instrument"}})])}}function al(Z){return function(...c){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(p=>{p in n&&"function"==typeof n[p]&&(0,Te.GS)(n,p,function(y){const w={mechanism:{data:{function:p,handler:(0,Pt.qQ)(y)},handled:!1,type:"instrument"}},C=(0,Te.sp)(y);return C&&(w.mechanism.data.handler=(0,Pt.qQ)(C)),ci(y,w)})}),Z.apply(this,c)}}function no(Z){const n=hn[Z]&&hn[Z].prototype;!n||!n.hasOwnProperty||!n.hasOwnProperty("addEventListener")||((0,Te.GS)(n,"addEventListener",function(a){return function(p,y,w){try{"function"==typeof y.handleEvent&&(y.handleEvent=ci(y.handleEvent,{mechanism:{data:{function:"handleEvent",handler:(0,Pt.qQ)(y),target:Z},handled:!1,type:"instrument"}}))}catch{}return a.apply(this,[p,ci(y,{mechanism:{data:{function:"addEventListener",handler:(0,Pt.qQ)(y),target:Z},handled:!1,type:"instrument"}}),w])}}),(0,Te.GS)(n,"removeEventListener",function(a){return function(p,y,w){const C=y;try{const P=C&&C.__sentry_wrapped__;P&&a.call(this,p,P,w)}catch{}return a.call(this,p,C,w)}}))}function Zs(Z,c,n,a){const p={filename:Z,function:c,in_app:!0};return void 0!==n&&(p.lineno=n),void 0!==a&&(p.colno=a),p}(0,De.F)(ds,Tl);const Us=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,ga=/\((\S*)(?::(\d+))(?::(\d+))\)/,La=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Bo=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,qo=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:[-a-z]+):.*?):(\d+)(?::(\d+))?\)?\s*$/i,Ul=(0,Pt.gd)([30,Z=>{const c=Us.exec(Z);if(c){if(c[2]&&0===c[2].indexOf("eval")){const y=ga.exec(c[2]);y&&(c[2]=y[1],c[3]=y[2],c[4]=y[3])}const[a,p]=Ki(c[1]||"?",c[2]);return Zs(p,a,c[3]?+c[3]:void 0,c[4]?+c[4]:void 0)}}],[50,Z=>{const c=La.exec(Z);if(c){if(c[3]&&c[3].indexOf(" > eval")>-1){const y=Bo.exec(c[3]);y&&(c[1]=c[1]||"eval",c[3]=y[1],c[4]=y[2],c[5]="")}let a=c[3],p=c[1]||"?";return[p,a]=Ki(p,a),Zs(a,p,c[4]?+c[4]:void 0,c[5]?+c[5]:void 0)}}],[40,Z=>{const c=qo.exec(Z);return c?Zs(c[2],c[1]||"?",+c[3],c[4]?+c[4]:void 0):void 0}]),Ki=(Z,c)=>{const n=-1!==Z.indexOf("safari-extension"),a=-1!==Z.indexOf("safari-web-extension");return n||a?[-1!==Z.indexOf("@")?Z.split("@")[0]:"?",n?`safari-extension:${c}`:`safari-web-extension:${c}`]:[Z,c]};var zl=H(6619);var Ba=H(3200);const Va=30;function Vc(Z,c,n=function aa(Z){const c=[];function a(w){return c.splice(c.indexOf(w),1)[0]}return{$:c,add:function p(w){if(!function n(){return void 0===Z||c.length<Z}())return(0,Ai.xg)(new zl.U("Not adding Promise because buffer limit was reached."));const C=w();return-1===c.indexOf(C)&&c.push(C),C.then(()=>a(C)).then(null,()=>a(C).then(null,()=>{})),C},drain:function y(w){return new Ai.T2((C,P)=>{let V=c.length;if(!V)return C(!0);const K=setTimeout(()=>{w&&w>0&&C(!1)},w);c.forEach(Y=>{(0,Ai.XW)(Y).then(()=>{--V||(clearTimeout(K),C(!0))},P)})})}}}(Z.bufferSize||Va)){let a={};function y(w){const C=[];if((0,Vn.yH)(w,(Y,ce)=>{const Pe=(0,Vn.zk)(ce);if((0,Ba.Jz)(a,Pe)){const Ke=Vo(Y,ce);Z.recordDroppedEvent("ratelimit_backoff",Pe,Ke)}else C.push(Y)}),0===C.length)return(0,Ai.XW)();const P=(0,Vn.h4)(w[0],C),V=Y=>{(0,Vn.yH)(P,(ce,Pe)=>{const Ke=Vo(ce,Pe);Z.recordDroppedEvent(Y,(0,Vn.zk)(Pe),Ke)})};return n.add(()=>c({body:(0,Vn.bN)(P,Z.textEncoder)}).then(Y=>(void 0!==Y.statusCode&&(Y.statusCode<200||Y.statusCode>=300)&&ae.T&&z.vF.warn(`Sentry responded with status code ${Y.statusCode} to sent event.`),a=(0,Ba.wq)(a,Y),Y),Y=>{throw V("network_error"),Y})).then(Y=>Y,Y=>{if(Y instanceof zl.U)return ae.T&&z.vF.error("Skipped sending event because buffer is full."),V("queue_overflow"),(0,Ai.XW)();throw Y})}return y.__sentry__baseTransport__=!0,{send:y,flush:w=>n.drain(w)}}function Vo(Z,c){if("event"===c||"transaction"===c)return Array.isArray(Z)?Z[1]:void 0}let Ia;function Sa(Z,c=function Ya(){if(Ia)return Ia;if((0,Qe.ap)(hn.fetch))return Ia=hn.fetch.bind(hn);const Z=hn.document;let c=hn.fetch;if(Z&&"function"==typeof Z.createElement)try{const n=Z.createElement("iframe");n.hidden=!0,Z.head.appendChild(n);const a=n.contentWindow;a&&a.fetch&&(c=a.fetch),Z.head.removeChild(n)}catch(n){Or&&z.vF.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return Ia=c.bind(hn)}()){let n=0,a=0;return Vc(Z,function p(y){const w=y.body.length;n+=w,a++;const C={body:y.body,method:"POST",referrerPolicy:"origin",headers:Z.headers,keepalive:n<=6e4&&a<15,...Z.fetchOptions};try{return c(Z.url,C).then(P=>(n-=w,a--,{statusCode:P.status,headers:{"x-sentry-rate-limits":P.headers.get("X-Sentry-Rate-Limits"),"retry-after":P.headers.get("Retry-After")}}))}catch(P){return function Ua(){Ia=void 0}(),n-=w,a--,(0,Ai.xg)(P)}})}const ro=4;function si(Z){return Vc(Z,function c(n){return new Ai.T2((a,p)=>{const y=new XMLHttpRequest;y.onerror=p,y.onreadystatechange=()=>{y.readyState===ro&&a({statusCode:y.status,headers:{"x-sentry-rate-limits":y.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":y.getResponseHeader("Retry-After")}})},y.open("POST",Z.url);for(const w in Z.headers)Object.prototype.hasOwnProperty.call(Z.headers,w)&&y.setRequestHeader(w,Z.headers[w]);y.send(n.body)})})}const Aa=[me(),nn(),Tl(),ar(),li(),Nr(),Jt(),bs()];function Po(Z){return[...Aa]}function _a(Z={}){void 0===Z.defaultIntegrations&&(Z.defaultIntegrations=Po()),void 0===Z.release&&("string"==typeof __SENTRY_RELEASE__&&(Z.release=__SENTRY_RELEASE__),hn.SENTRY_RELEASE&&hn.SENTRY_RELEASE.id&&(Z.release=hn.SENTRY_RELEASE.id)),void 0===Z.autoSessionTracking&&(Z.autoSessionTracking=!0),void 0===Z.sendClientReports&&(Z.sendClientReports=!0);const c={...Z,stackParser:(0,Pt.vk)(Z.stackParser||Ul),integrations:(0,De.mH)(Z),transport:Z.transport||((0,Qe.vm)()?Sa:si)};(function qt(Z,c){!0===c.debug&&(ae.T?z.vF.enable():(0,z.pq)(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),(0,O.o5)().update(c.initialScope);const a=new Z(c);(function Ht(Z){const n=(0,Cn.BF)().getStackTop();n.client=Z,n.scope.setClient(Z)})(a),function lt(Z){Z.init?Z.init():Z.setupIntegrations&&Z.setupIntegrations()}(a)})(Zt,c),Z.autoSessionTracking&&function ns(){typeof hn.document>"u"?Or&&z.vF.warn("Session tracking in non-browser environment with @sentry/browser is not supported."):((0,O.J0)({ignoreDuration:!0}),(0,O.J5)(),(0,Tt._)(({from:Z,to:c})=>{void 0!==Z&&Z!==c&&((0,O.J0)({ignoreDuration:!0}),(0,O.J5)())}))}()}const zi=(Z={},c=(0,Cn.BF)())=>{if(!hn.document)return void(Or&&z.vF.error("Global document not defined in showReportDialog call"));const{client:n,scope:a}=c.getStackTop(),p=Z.dsn||n&&n.getDsn();if(!p)return void(Or&&z.vF.error("DSN not configured for showReportDialog call"));a&&(Z.user={...a.getUser(),...Z.user}),Z.eventId||(Z.eventId=c.lastEventId());const y=hn.document.createElement("script");y.async=!0,y.crossOrigin="anonymous",y.src=(0,Ct.k)(p,Z),Z.onLoad&&(y.onload=Z.onLoad);const{onClose:w}=Z;if(w){const P=V=>{if("__sentry_reportdialog_closed__"===V.data)try{w()}finally{hn.removeEventListener("message",P)}};hn.addEventListener("message",P)}const C=hn.document.head||hn.document.body;C?C.appendChild(y):Or&&z.vF.error("Not injecting report dialog. No injection point found in HTML")};var Hi=H(3308);let cl;function Ja(Z){const c=function nc(Z){return cl?cl.get(Z):void 0}(Z);if(!c)return;const n={};for(const[,[a,p]]of c)n[a]||(n[a]=[]),n[a].push((0,Te.Ce)(p));return n}var uu,Z,vs=H(962),el=H(1477);function Mc(Z,c){Z.setTag("http.status_code",String(c)),Z.setData("http.response.status_code",c);const n=function Sl(Z){if(Z<400&&Z>=100)return"ok";if(Z>=400&&Z<500)switch(Z){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(Z>=500&&Z<600)switch(Z){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}(c);"unknown_error"!==n&&Z.setStatus(n)}(Z=uu||(uu={})).Ok="ok",Z.DeadlineExceeded="deadline_exceeded",Z.Unauthenticated="unauthenticated",Z.PermissionDenied="permission_denied",Z.NotFound="not_found",Z.ResourceExhausted="resource_exhausted",Z.InvalidArgument="invalid_argument",Z.Unimplemented="unimplemented",Z.Unavailable="unavailable",Z.InternalError="internal_error",Z.UnknownError="unknown_error",Z.Cancelled="cancelled",Z.AlreadyExists="already_exists",Z.FailedPrecondition="failed_precondition",Z.Aborted="aborted",Z.OutOfRange="out_of_range",Z.DataLoss="data_loss";class Al{constructor(c=1e3){this._maxlen=c,this.spans=[]}add(c){this.spans.length>this._maxlen?c.spanRecorder=void 0:this.spans.push(c)}}class rc{constructor(c={}){this._traceId=c.traceId||(0,ye.eJ)(),this._spanId=c.spanId||(0,ye.eJ)().substring(16),this._startTime=c.startTimestamp||(0,Fr.zf)(),this.tags=c.tags?{...c.tags}:{},this.data=c.data?{...c.data}:{},this.instrumenter=c.instrumenter||"sentry",this._attributes={},this.setAttributes({[vs.JD]:c.origin||"manual",[vs.uT]:c.op,...c.attributes}),this._name=c.name||c.description,c.parentSpanId&&(this._parentSpanId=c.parentSpanId),"sampled"in c&&(this._sampled=c.sampled),c.status&&(this._status=c.status),c.endTimestamp&&(this._endTime=c.endTimestamp),c.exclusiveTime&&(this._exclusiveTime=c.exclusiveTime),this._measurements=c.measurements?{...c.measurements}:{}}get name(){return this._name||""}set name(c){this.updateName(c)}get description(){return this._name}set description(c){this._name=c}get traceId(){return this._traceId}set traceId(c){this._traceId=c}get spanId(){return this._spanId}set spanId(c){this._spanId=c}set parentSpanId(c){this._parentSpanId=c}get parentSpanId(){return this._parentSpanId}get sampled(){return this._sampled}set sampled(c){this._sampled=c}get attributes(){return this._attributes}set attributes(c){this._attributes=c}get startTimestamp(){return this._startTime}set startTimestamp(c){this._startTime=c}get endTimestamp(){return this._endTime}set endTimestamp(c){this._endTime=c}get status(){return this._status}set status(c){this._status=c}get op(){return this._attributes[vs.uT]}set op(c){this.setAttribute(vs.uT,c)}get origin(){return this._attributes[vs.JD]}set origin(c){this.setAttribute(vs.JD,c)}spanContext(){const{_spanId:c,_traceId:n,_sampled:a}=this;return{spanId:c,traceId:n,traceFlags:a?Hi.aO:Hi.CC}}startChild(c){const n=new rc({...c,parentSpanId:this._spanId,sampled:this._sampled,traceId:this._traceId});n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n);const a=(0,el.z)(this);if(n.transaction=a,ae.T&&a){const C=`[Tracing] Starting '${c&&c.op||"< unknown op >"}' span on transaction '${(0,Hi.et)(n).description||"< unknown name >"}' (${a.spanContext().spanId}).`;z.vF.log(C),this._logMessage=C}return n}setTag(c,n){return this.tags={...this.tags,[c]:n},this}setData(c,n){return this.data={...this.data,[c]:n},this}setAttribute(c,n){void 0===n?delete this._attributes[c]:this._attributes[c]=n}setAttributes(c){Object.keys(c).forEach(n=>this.setAttribute(n,c[n]))}setStatus(c){return this._status=c,this}setHttpStatus(c){return Mc(this,c),this}setName(c){this.updateName(c)}updateName(c){return this._name=c,this}isSuccess(){return"ok"===this._status}finish(c){return this.end(c)}end(c){if(this._endTime)return;const n=(0,el.z)(this);if(ae.T&&n&&n.spanContext().spanId!==this._spanId){const a=this._logMessage;a&&z.vF.log(a.replace("Starting","Finishing"))}this._endTime=(0,Hi.cI)(c)}toTraceparent(){return(0,Hi.Qh)(this)}toContext(){return(0,Te.Ce)({data:this._getData(),description:this._name,endTimestamp:this._endTime,op:this.op,parentSpanId:this._parentSpanId,sampled:this._sampled,spanId:this._spanId,startTimestamp:this._startTime,status:this._status,tags:this.tags,traceId:this._traceId})}updateWithContext(c){return this.data=c.data||{},this._name=c.name||c.description,this._endTime=c.endTimestamp,this.op=c.op,this._parentSpanId=c.parentSpanId,this._sampled=c.sampled,this._spanId=c.spanId||this._spanId,this._startTime=c.startTimestamp||this._startTime,this._status=c.status,this.tags=c.tags||{},this._traceId=c.traceId||this._traceId,this}getTraceContext(){return(0,Hi.kX)(this)}getSpanJSON(){return(0,Te.Ce)({data:this._getData(),description:this._name,op:this._attributes[vs.uT],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:this._status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[vs.JD],_metrics_summary:Ja(this),profile_id:this._attributes[vs.E1],exclusive_time:this._exclusiveTime,measurements:Object.keys(this._measurements).length>0?this._measurements:void 0})}isRecording(){return!this._endTime&&!!this._sampled}toJSON(){return this.getSpanJSON()}_getData(){const{data:c,_attributes:n}=this,a=Object.keys(c).length>0,p=Object.keys(n).length>0;if(a||p)return a&&p?{...c,...n}:a?c:n}}var Ts=H(3787);function jl(Z){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const c=(0,O.KU)(),n=Z||c&&c.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}function yc(Z){if(!jl())return;const c=function Gl(Z){if(Z.startTime){const c={...Z};return c.startTimestamp=(0,Hi.cI)(Z.startTime),delete c.startTime,c}return Z}(Z),n=(0,Cn.BF)(),a=Z.scope?Z.scope.getSpan():Ca();if(Z.onlyIfParent&&!a)return;const w=(Z.scope||(0,O.o5)()).clone();return function vc(Z,{parentSpan:c,spanContext:n,forceTransaction:a,scope:p}){if(!jl())return;const y=(0,Cn.rm)();let w;if(c&&!a)w=c.startChild(n);else if(c){const C=(0,Ts.k)(c),{traceId:P,spanId:V}=c.spanContext(),K=(0,Hi.pK)(c);w=Z.startTransaction({traceId:P,parentSpanId:V,parentSampled:K,...n,metadata:{dynamicSamplingContext:C,...n.metadata}})}else{const{traceId:C,dsc:P,parentSpanId:V,sampled:K}={...y.getPropagationContext(),...p.getPropagationContext()};w=Z.startTransaction({traceId:C,parentSpanId:V,parentSampled:K,...n,metadata:{dynamicSamplingContext:P,...n.metadata}})}return p.setSpan(w),function xc(Z,c,n){Z&&((0,Te.my)(Z,Dl,n),(0,Te.my)(Z,ic,c))}(w,p,y),w}(n,{parentSpan:a,spanContext:c,forceTransaction:Z.forceTransaction,scope:w})}function Ca(){return(0,O.o5)().getSpan()}const ic="_sentryScope",Dl="_sentryIsolationScope";class $s extends rc{constructor(c,n){super(c),this._contexts={},this._hub=n||(0,Cn.BF)(),this._name=c.name||"",this._metadata={...c.metadata},this._trimEnd=c.trimEnd,this.transaction=this;const a=this._metadata.dynamicSamplingContext;a&&(this._frozenDynamicSamplingContext={...a})}get name(){return this._name}set name(c){this.setName(c)}get metadata(){return{source:"custom",spanMetadata:{},...this._metadata,...this._attributes[vs.i_]&&{source:this._attributes[vs.i_]},...this._attributes[vs.sy]&&{sampleRate:this._attributes[vs.sy]}}}set metadata(c){this._metadata=c}setName(c,n="custom"){this._name=c,this.setAttribute(vs.i_,n)}updateName(c){return this._name=c,this}initSpanRecorder(c=1e3){this.spanRecorder||(this.spanRecorder=new Al(c)),this.spanRecorder.add(this)}setContext(c,n){null===n?delete this._contexts[c]:this._contexts[c]=n}setMeasurement(c,n,a=""){this._measurements[c]={value:n,unit:a}}setMetadata(c){this._metadata={...this._metadata,...c}}end(c){const n=(0,Hi.cI)(c),a=this._finishTransaction(n);if(a)return this._hub.captureEvent(a)}toContext(){const c=super.toContext();return(0,Te.Ce)({...c,name:this._name,trimEnd:this._trimEnd})}updateWithContext(c){return super.updateWithContext(c),this._name=c.name||"",this._trimEnd=c.trimEnd,this}getDynamicSamplingContext(){return(0,Ts.k)(this)}setHub(c){this._hub=c}getProfileId(){if(void 0!==this._contexts&&void 0!==this._contexts.profile)return this._contexts.profile.profile_id}_finishTransaction(c){if(void 0!==this._endTime)return;this._name||(ae.T&&z.vF.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>"),super.end(c);const n=this._hub.getClient();if(n&&n.emit&&n.emit("finishTransaction",this),!0!==this._sampled)return ae.T&&z.vF.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),void(n&&n.recordDroppedEvent("sample_rate","transaction"));const a=this.spanRecorder?this.spanRecorder.spans.filter(K=>K!==this&&(0,Hi.et)(K).timestamp):[];if(this._trimEnd&&a.length>0){const K=a.map(Y=>(0,Hi.et)(Y).timestamp).filter(Boolean);this._endTime=K.reduce((Y,ce)=>Y>ce?Y:ce)}const{scope:p,isolationScope:y}=function Bi(Z){return{scope:Z[ic],isolationScope:Z[Dl]}}(this),{metadata:w}=this,{source:C}=w,P={contexts:{...this._contexts,trace:(0,Hi.kX)(this)},spans:a,start_timestamp:this._startTime,tags:this.tags,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{...w,capturedSpanScope:p,capturedSpanIsolationScope:y,...(0,Te.Ce)({dynamicSamplingContext:(0,Ts.k)(this)})},_metrics_summary:Ja(this),...C&&{transaction_info:{source:C}}};return Object.keys(this._measurements).length>0&&(ae.T&&z.vF.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),P.measurements=this._measurements),ae.T&&z.vF.log(`[Tracing] Finishing ${this.op} transaction: ${this._name}.`),P}}const Is={idleTimeout:1e3,finalTimeout:3e4,heartbeatInterval:5e3},uo=["heartbeatFailed","idleTimeout","documentHidden","finalTimeout","externalFinish","cancelled"];class Ns extends Al{constructor(c,n,a,p){super(p),this._pushActivity=c,this._popActivity=n,this.transactionSpanId=a}add(c){if(c.spanContext().spanId!==this.transactionSpanId){const n=c.end;c.end=(...a)=>(this._popActivity(c.spanContext().spanId),n.apply(c,a)),void 0===(0,Hi.et)(c).timestamp&&this._pushActivity(c.spanContext().spanId)}super.add(c)}}class Ml extends $s{constructor(c,n,a=Is.idleTimeout,p=Is.finalTimeout,y=Is.heartbeatInterval,w=!1,C=!1){super(c,n),this._idleHub=n,this._idleTimeout=a,this._finalTimeout=p,this._heartbeatInterval=y,this._onScope=w,this.activities={},this._heartbeatCounter=0,this._finished=!1,this._idleTimeoutCanceledPermanently=!1,this._beforeFinishCallbacks=[],this._finishReason=uo[4],this._autoFinishAllowed=!C,w&&(ae.T&&z.vF.log(`Setting idle transaction on scope. Span ID: ${this.spanContext().spanId}`),n.getScope().setSpan(this)),C||this._restartIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this._finishReason=uo[3],this.end())},this._finalTimeout)}end(c){const n=(0,Hi.cI)(c);if(this._finished=!0,this.activities={},"ui.action.click"===this.op&&this.setAttribute("finishReason",this._finishReason),this.spanRecorder){ae.T&&z.vF.log("[Tracing] finishing IdleTransaction",new Date(1e3*n).toISOString(),this.op);for(const a of this._beforeFinishCallbacks)a(this,n);this.spanRecorder.spans=this.spanRecorder.spans.filter(a=>{if(a.spanContext().spanId===this.spanContext().spanId)return!0;(0,Hi.et)(a).timestamp||(a.setStatus("cancelled"),a.end(n),ae.T&&z.vF.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(a,void 0,2)));const{start_timestamp:p,timestamp:y}=(0,Hi.et)(a),w=p&&p<n,P=y&&p&&y-p<(this._finalTimeout+this._idleTimeout)/1e3;if(ae.T){const V=JSON.stringify(a,void 0,2);w?P||z.vF.log("[Tracing] discarding Span since it finished after Transaction final timeout",V):z.vF.log("[Tracing] discarding Span since it happened after Transaction was finished",V)}return w&&P}),ae.T&&z.vF.log("[Tracing] flushing IdleTransaction")}else ae.T&&z.vF.log("[Tracing] No active IdleTransaction");if(this._onScope){const a=this._idleHub.getScope();a.getTransaction()===this&&a.setSpan(void 0)}return super.end(c)}registerBeforeFinishCallback(c){this._beforeFinishCallbacks.push(c)}initSpanRecorder(c){this.spanRecorder||(this.spanRecorder=new Ns(p=>{this._finished||this._pushActivity(p)},p=>{this._finished||this._popActivity(p)},this.spanContext().spanId,c),ae.T&&z.vF.log("Starting heartbeat"),this._pingHeartbeat()),this.spanRecorder.add(this)}cancelIdleTimeout(c,{restartOnChildSpanChange:n}={restartOnChildSpanChange:!0}){this._idleTimeoutCanceledPermanently=!1===n,this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0,0===Object.keys(this.activities).length&&this._idleTimeoutCanceledPermanently&&(this._finishReason=uo[5],this.end(c)))}setFinishReason(c){this._finishReason=c}sendAutoFinishSignal(){this._autoFinishAllowed||(ae.T&&z.vF.log("[Tracing] Received finish signal for idle transaction."),this._restartIdleTimeout(),this._autoFinishAllowed=!0)}_restartIdleTimeout(c){this.cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&0===Object.keys(this.activities).length&&(this._finishReason=uo[1],this.end(c))},this._idleTimeout)}_pushActivity(c){this.cancelIdleTimeout(void 0,{restartOnChildSpanChange:!this._idleTimeoutCanceledPermanently}),ae.T&&z.vF.log(`[Tracing] pushActivity: ${c}`),this.activities[c]=!0,ae.T&&z.vF.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(c){if(this.activities[c]&&(ae.T&&z.vF.log(`[Tracing] popActivity ${c}`),delete this.activities[c],ae.T&&z.vF.log("[Tracing] new activities count",Object.keys(this.activities).length)),0===Object.keys(this.activities).length){const n=(0,Fr.zf)();this._idleTimeoutCanceledPermanently?this._autoFinishAllowed&&(this._finishReason=uo[5],this.end(n)):this._restartIdleTimeout(n+this._idleTimeout/1e3)}}_beat(){if(this._finished)return;const c=Object.keys(this.activities).join("");c===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=c,this._heartbeatCounter>=3?this._autoFinishAllowed&&(ae.T&&z.vF.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this._finishReason=uo[0],this.end()):this._pingHeartbeat()}_pingHeartbeat(){ae.T&&z.vF.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}}function tl(Z){return(Z||(0,Cn.BF)()).getScope().getTransaction()}let eu=!1;function sc(){const Z=tl();if(Z){const c="internal_error";ae.T&&z.vF.log(`[Tracing] Transaction: ${c} -> Global error occured`),Z.setStatus(c)}}function os(Z,c,n){if(!jl(c))return Z.sampled=!1,Z;if(void 0!==Z.sampled)return Z.setAttribute(vs.sy,Number(Z.sampled)),Z;let a;return"function"==typeof c.tracesSampler?(a=c.tracesSampler(n),Z.setAttribute(vs.sy,Number(a))):void 0!==n.parentSampled?a=n.parentSampled:typeof c.tracesSampleRate<"u"?(a=c.tracesSampleRate,Z.setAttribute(vs.sy,Number(a))):(a=1,Z.setAttribute(vs.sy,a)),Ec(a)?a?(Z.sampled=Math.random()<a,Z.sampled?(ae.T&&z.vF.log(`[Tracing] starting ${Z.op} transaction - ${(0,Hi.et)(Z).description}`),Z):(ae.T&&z.vF.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(a)})`),Z)):(ae.T&&z.vF.log("[Tracing] Discarding transaction because "+("function"==typeof c.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),Z.sampled=!1,Z):(ae.T&&z.vF.warn("[Tracing] Discarding transaction because of invalid sample rate."),Z.sampled=!1,Z)}function Ec(Z){return(0,jr.yr)(Z)||"number"!=typeof Z&&"boolean"!=typeof Z?(ae.T&&z.vF.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(Z)} of type ${JSON.stringify(typeof Z)}.`),!1):!(Z<0||Z>1)||(ae.T&&z.vF.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${Z}.`),!1)}function zc(){const c=this.getScope().getSpan();return c?{"sentry-trace":(0,Hi.Qh)(c)}:{}}function yo(Z,c){const n=this.getClient(),a=n&&n.getOptions()||{},p=a.instrumenter||"sentry",y=Z.instrumenter||"sentry";p!==y&&(ae.T&&z.vF.error(`A transaction was started with instrumenter=\`${y}\`, but the SDK is configured with the \`${p}\` instrumenter.\nThe transaction will not be sampled. Please use the ${p} instrumentation to start transactions.`),Z.sampled=!1);let w=new $s(Z,this);return w=os(w,a,{name:Z.name,parentSampled:Z.parentSampled,transactionContext:Z,attributes:{...Z.data,...Z.attributes},...c}),w.isRecording()&&w.initSpanRecorder(a._experiments&&a._experiments.maxSpans),n&&n.emit&&n.emit("startTransaction",w),w}function Hl(Z,c,n,a,p,y,w,C=!1){const P=Z.getClient(),V=P&&P.getOptions()||{};let K=new Ml(c,Z,n,a,w,p,C);return K=os(K,V,{name:c.name,parentSampled:c.parentSampled,transactionContext:c,attributes:{...c.data,...c.attributes},...y}),K.isRecording()&&K.initSpanRecorder(V._experiments&&V._experiments.maxSpans),P&&P.emit&&P.emit("startTransaction",K),K}sc.tag="sentry_tracingErrorCallback";var oc=H(8399),Ps=H(5640),gs=H(4756),ja=H(2373);function ac(Z){return[{type:"span"},Z]}var ql=H(8810);function Rl(Z){return"number"==typeof Z&&isFinite(Z)}function ho(Z,{startTimestamp:c,...n}){return c&&Z.startTimestamp>c&&(Z.startTimestamp=c),Z.startChild({startTimestamp:c,...n})}var $a=H(4872);const wc=2147483647;function io(Z){return Z/1e3}function as(){return gs.j&&gs.j.addEventListener&&gs.j.performance}let la,ul,Pl=0,Ls={};const wt={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function Qr(Z,c,n,a,p,y){const w=y?c[y]:c[`${n}End`],C=c[`${n}Start`];!C||!w||ho(Z,{op:"browser",origin:"auto.browser.browser.metrics",description:p||n,startTimestamp:a+io(C),endTimestamp:a+io(w)})}function so(Z,c,n,a){const p=c[n];null!=p&&p<wc&&(Z[a]=p)}var lr=H(8095);const Ni=["localhost",/^\/(?!\/)/],js={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,tracingOrigins:Ni,tracePropagationTargets:Ni};function ea(Z){const{traceFetch:c,traceXHR:n,tracePropagationTargets:a,tracingOrigins:p,shouldCreateSpanForRequest:y,enableHTTPTimings:w}={traceFetch:js.traceFetch,traceXHR:js.traceXHR,...Z},C="function"==typeof y?y:K=>!0,P=K=>function dl(Z,c){return(0,m.Xr)(Z,c||Ni)}(K,a||p),V={};c&&(0,Me.u)(K=>{const Y=function Kr(Z,c,n,a,p="auto.http.browser"){if(!jl()||!Z.fetchData)return;const y=c(Z.fetchData.url);if(Z.endTimestamp&&y){const Y=Z.fetchData.__span;if(!Y)return;const ce=a[Y];if(ce){if(Z.response){Mc(ce,Z.response.status);const Pe=Z.response&&Z.response.headers&&Z.response.headers.get("content-length");if(Pe){const Ke=parseInt(Pe);Ke>0&&ce.setAttribute("http.response_content_length",Ke)}}else Z.error&&ce.setStatus("internal_error");ce.end(),delete a[Y]}return}const w=(0,O.o5)(),C=(0,O.KU)(),{method:P,url:V}=Z.fetchData,K=y?yc({name:`${P} ${V}`,onlyIfParent:!0,attributes:{url:V,type:"fetch","http.method":P,[vs.JD]:p},op:"http.client"}):void 0;if(K&&(Z.fetchData.__span=K.spanContext().spanId,a[K.spanContext().spanId]=K),n(Z.fetchData.url)&&C){const Y=Z.args[0];Z.args[1]=Z.args[1]||{};const ce=Z.args[1];ce.headers=function Di(Z,c,n,a,p){const y=p||n.getSpan(),w=(0,Cn.rm)(),{traceId:C,spanId:P,sampled:V,dsc:K}={...w.getPropagationContext(),...n.getPropagationContext()},Y=y?(0,Hi.Qh)(y):(0,oc.TC)(C,P,V),ce=(0,lr.De)(K||(y?(0,Ts.k)(y):(0,Ts.l)(C,c,n))),Pe=a.headers||(typeof Request<"u"&&(0,jr.tH)(Z,Request)?Z.headers:void 0);if(Pe){if(typeof Headers<"u"&&(0,jr.tH)(Pe,Headers)){const Ke=new Headers(Pe);return Ke.append("sentry-trace",Y),ce&&Ke.append(lr.hF,ce),Ke}if(Array.isArray(Pe)){const Ke=[...Pe,["sentry-trace",Y]];return ce&&Ke.push([lr.hF,ce]),Ke}{const Ke="baggage"in Pe?Pe.baggage:void 0,Ye=[];return Array.isArray(Ke)?Ye.push(...Ke):Ke&&Ye.push(Ke),ce&&Ye.push(ce),{...Pe,"sentry-trace":Y,baggage:Ye.length>0?Ye.join(","):void 0}}}return{"sentry-trace":Y,baggage:ce}}(Y,C,w,ce,K)}return K}(K,C,P,V);w&&Y&&qi(Y)}),n&&(0,ge.Mn)(K=>{const Y=function Kl(Z,c,n,a){const p=Z.xhr,y=p&&p[ge.Er];if(!jl()||!p||p.__sentry_own_request__||!y)return;const w=c(y.url);if(Z.endTimestamp&&w){const Y=p.__sentry_xhr_span_id__;if(!Y)return;const ce=a[Y];return void(ce&&void 0!==y.status_code&&(Mc(ce,y.status_code),ce.end(),delete a[Y]))}const C=(0,O.o5)(),P=(0,Cn.rm)(),V=w?yc({name:`${y.method} ${y.url}`,onlyIfParent:!0,attributes:{type:"xhr","http.method":y.method,url:y.url,[vs.JD]:"auto.http.browser"},op:"http.client"}):void 0;V&&(p.__sentry_xhr_span_id__=V.spanContext().spanId,a[p.__sentry_xhr_span_id__]=V);const K=(0,O.KU)();if(p.setRequestHeader&&n(y.url)&&K){const{traceId:Y,spanId:ce,sampled:Pe,dsc:Ke}={...P.getPropagationContext(),...C.getPropagationContext()};!function Ol(Z,c,n){try{Z.setRequestHeader("sentry-trace",c),n&&Z.setRequestHeader(lr.hF,n)}catch{}}(p,V?(0,Hi.Qh)(V):(0,oc.TC)(Y,ce,Pe),(0,lr.De)(Ke||(V?(0,Ts.k)(V):(0,Ts.l)(Y,K,C))))}return V}(K,C,P,V);w&&Y&&qi(Y)})}function qi(Z){const{url:c}=(0,Hi.et)(Z).data||{};if(!c||"string"!=typeof c)return;const n=(0,ja.wv)("resource",({entries:a})=>{a.forEach(p=>{(function rl(Z){return"resource"===Z.entryType&&"initiatorType"in Z&&"string"==typeof Z.nextHopProtocol&&("fetch"===Z.initiatorType||"xmlhttprequest"===Z.initiatorType)})(p)&&p.name.endsWith(c)&&(function Si(Z){const{name:c,version:n}=function ca(Z){let c="unknown",n="unknown",a="";for(const p of Z){if("/"===p){[c,n]=Z.split("/");break}if(!isNaN(Number(p))){c="h"===a?"http":a,n=Z.split(a)[1];break}a+=p}return a===Z&&(c=a),{name:c,version:n}}(Z.nextHopProtocol),a=[];return a.push(["network.protocol.version",n],["network.protocol.name",c]),Fr.k3?[...a,["http.request.redirect_start",fo(Z.redirectStart)],["http.request.fetch_start",fo(Z.fetchStart)],["http.request.domain_lookup_start",fo(Z.domainLookupStart)],["http.request.domain_lookup_end",fo(Z.domainLookupEnd)],["http.request.connect_start",fo(Z.connectStart)],["http.request.secure_connection_start",fo(Z.secureConnectionStart)],["http.request.connection_end",fo(Z.connectEnd)],["http.request.request_start",fo(Z.requestStart)],["http.request.response_start",fo(Z.responseStart)],["http.request.response_end",fo(Z.responseEnd)]]:a}(p).forEach(w=>Z.setAttribute(...w)),setTimeout(n))})})}function fo(Z=0){return((Fr.k3||performance.timeOrigin)+Z)/1e3}const Rc={...Is,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableInp:!1,_experiments:{},...js},Zl=(Z={})=>{const c=!(!Ps.T||!Z.tracePropagationTargets&&!Z.tracingOrigins);(function hu(){const Z=(0,Cn.EU)();Z.__SENTRY__&&(Z.__SENTRY__.extensions=Z.__SENTRY__.extensions||{},Z.__SENTRY__.extensions.startTransaction||(Z.__SENTRY__.extensions.startTransaction=yo),Z.__SENTRY__.extensions.traceHeaders||(Z.__SENTRY__.extensions.traceHeaders=zc),function nl(){eu||(eu=!0,Nt(sc),On(sc))}())})(),!Z.tracePropagationTargets&&Z.tracingOrigins&&(Z.tracePropagationTargets=Z.tracingOrigins);const n={...Rc,...Z},a=function lc(){const Z=as();if(Z&&Fr.k3){Z.mark&&gs.j.performance.mark("sentry-tracing-init");const c=function ie(){return(0,ja.T5)(({metric:Z})=>{const c=Z.entries[Z.entries.length-1];if(!c)return;const n=io(Fr.k3),a=io(c.startTime);Ps.T&&z.vF.log("[Measurements] Adding FID"),Ls.fid={value:Z.value,unit:"millisecond"},Ls["mark.fid"]={value:n+a,unit:"second"}})}(),n=function W(){return(0,ja.a9)(({metric:Z})=>{const c=Z.entries[Z.entries.length-1];c&&(Ps.T&&z.vF.log("[Measurements] Adding CLS"),Ls.cls={value:Z.value,unit:""},ul=c)},!0)}(),a=function ke(){return(0,ja.Pt)(({metric:Z})=>{const c=Z.entries[Z.entries.length-1];c&&(Ps.T&&z.vF.log("[Measurements] Adding LCP"),Ls.lcp={value:Z.value,unit:"millisecond"},la=c)},!0)}(),p=function be(){return(0,ja.YG)(({metric:Z})=>{Z.entries[Z.entries.length-1]&&(Ps.T&&z.vF.log("[Measurements] Adding TTFB"),Ls.ttfb={value:Z.value,unit:"millisecond"})})}();return()=>{c(),n(),a(),p()}}return()=>{}}(),p={};n.enableInp&&function jc(Z){if(as()&&Fr.k3){const n=function _n(Z){return(0,ja.hT)(({metric:c})=>{if(void 0===c.value)return;const n=c.entries.find(pe=>pe.duration===c.value&&void 0!==wt[pe.name]),a=(0,O.KU)();if(!n||!a)return;const p=wt[n.name],y=a.getOptions(),w=io(Fr.k3+n.startTime),C=io(c.value),P=void 0!==n.interactionId?Z[n.interactionId]:void 0;if(void 0===P)return;const{routeName:V,parentContext:K,activeTransaction:Y,user:ce,replayId:Pe}=P,Ke=void 0!==ce?ce.email||ce.id||ce.ip_address:void 0,Ye=void 0!==Y?Y.getProfileId():void 0,rt=new rc({startTimestamp:w,endTimestamp:w+C,op:`ui.interaction.${p}`,name:(0,$e.Hd)(n.target),attributes:{release:y.release,environment:y.environment,transaction:V,...void 0!==Ke&&""!==Ke?{user:Ke}:{},...void 0!==Ye?{profile_id:Ye}:{},...void 0!==Pe?{replay_id:Pe}:{}},exclusiveTime:c.value,measurements:{inp:{value:c.value,unit:"millisecond"}}}),ot=function xs(Z,c){if(!jl(c))return!1;let n;return n=void 0!==Z&&"function"==typeof c.tracesSampler?c.tracesSampler({transactionContext:Z,name:Z.name,parentSampled:Z.parentSampled,attributes:{...Z.data,...Z.attributes},location:gs.j.location}):void 0!==Z&&void 0!==Z.sampled?Z.sampled:typeof c.tracesSampleRate<"u"?c.tracesSampleRate:1,Ec(n)?n:(Ps.T&&z.vF.warn("[Tracing] Discarding transaction because of invalid sample rate."),!1)}(K,y);if(ot&&Math.random()<ot){const pe=rt?function ya(Z,c){const n={sent_at:(new Date).toISOString()};c&&(n.dsn=(0,on.SB)(c));const a=Z.map(ac);return(0,Vn.h4)(n,a)}([rt],a.getDsn()):void 0,he=a&&a.getTransport();he&&pe&&he.send(pe).then(null,gt=>{Ps.T&&z.vF.error("Error while sending interaction:",gt)})}})}(Z);return()=>{n()}}return()=>{}}(p),n.enableLongTask&&function va(){(0,ja.wv)("longtask",({entries:Z})=>{for(const c of Z){const n=tl();if(!n)return;const a=io(Fr.k3+c.startTime),p=io(c.duration);n.startChild({description:"Main UI thread blocked",op:"ui.long-task",origin:"auto.ui.browser.metrics",startTimestamp:a,endTimestamp:a+p})}})}(),n._experiments.enableInteractions&&function Da(){(0,ja.wv)("event",({entries:Z})=>{for(const c of Z){const n=tl();if(!n)return;if("click"===c.name){const a=io(Fr.k3+c.startTime),p=io(c.duration),y={description:(0,$e.Hd)(c.target),op:`ui.interaction.${c.name}`,origin:"auto.ui.browser.metrics",startTimestamp:a,endTimestamp:a+p},w=(0,$e.xE)(c.target);w&&(y.attributes={"ui.component_name":w}),n.startChild(y)}}})}();const y={name:void 0,context:void 0};function w(C){const P=(0,Cn.BF)(),{beforeStartSpan:V,idleTimeout:K,finalTimeout:Y,heartbeatInterval:ce}=n,Pe="pageload"===C.op;let Ke;if(Pe){const pe=Pe?ju("sentry-trace"):"",he=Pe?ju("baggage"):void 0,{traceId:gt,dsc:mt,parentSpanId:Ut,sampled:jt}=(0,oc.kM)(pe,he);Ke={traceId:gt,parentSpanId:Ut,parentSampled:jt,...C,metadata:{...C.metadata,dynamicSamplingContext:mt},trimEnd:!0}}else Ke={trimEnd:!0,...C};const Ye=V?V(Ke):Ke;Ye.metadata=Ye.name!==Ke.name?{...Ye.metadata,source:"custom"}:Ye.metadata,y.name=Ye.name,y.context=Ye,!1===Ye.sampled&&Ps.T&&z.vF.log(`[Tracing] Will not send ${Ye.op} transaction because of beforeNavigate.`),Ps.T&&z.vF.log(`[Tracing] Starting ${Ye.op} transaction on scope`);const{location:rt}=gs.j,ot=Hl(P,Ye,K,Y,!0,{location:rt},ce,Pe);return Pe&&gs.j.document&&(gs.j.document.addEventListener("readystatechange",()=>{["interactive","complete"].includes(gs.j.document.readyState)&&ot.sendAutoFinishSignal()}),["interactive","complete"].includes(gs.j.document.readyState)&&ot.sendAutoFinishSignal()),ot.registerBeforeFinishCallback(pe=>{a(),function Gn(Z){const c=as();if(!c||!gs.j.performance.getEntries||!Fr.k3)return;Ps.T&&z.vF.log("[Tracing] Adding & adjusting spans using Performance API");const n=io(Fr.k3),a=c.getEntries(),{op:p,start_timestamp:y}=(0,Hi.et)(Z);if(a.slice(Pl).forEach(w=>{const C=io(w.startTime),P=io(w.duration);if(!("navigation"===Z.op&&y&&n+C<y))switch(w.entryType){case"navigation":!function Xn(Z,c,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(a=>{Qr(Z,c,a,n)}),Qr(Z,c,"secureConnection",n,"TLS/SSL","connectEnd"),Qr(Z,c,"fetch",n,"cache","domainLookupStart"),Qr(Z,c,"domainLookup",n,"DNS"),function zs(Z,c,n){c.responseEnd&&(ho(Z,{op:"browser",origin:"auto.browser.browser.metrics",description:"request",startTimestamp:n+io(c.requestStart),endTimestamp:n+io(c.responseEnd)}),ho(Z,{op:"browser",origin:"auto.browser.browser.metrics",description:"response",startTimestamp:n+io(c.responseStart),endTimestamp:n+io(c.responseEnd)}))}(Z,c,n)}(Z,w,n);break;case"mark":case"paint":case"measure":{!function Ar(Z,c,n,a,p){const y=p+n;ho(Z,{description:c.name,endTimestamp:y+a,op:c.entryType,origin:"auto.resource.browser.metrics",startTimestamp:y})}(Z,w,C,P,n);const V=(0,ql.N)(),K=w.startTime<V.firstHiddenTime;"first-paint"===w.name&&K&&(Ps.T&&z.vF.log("[Measurements] Adding FP"),Ls.fp={value:w.startTime,unit:"millisecond"}),"first-contentful-paint"===w.name&&K&&(Ps.T&&z.vF.log("[Measurements] Adding FCP"),Ls.fcp={value:w.startTime,unit:"millisecond"});break}case"resource":!function Wi(Z,c,n,a,p,y){if("xmlhttprequest"===c.initiatorType||"fetch"===c.initiatorType)return;const w=Je(n),C={};so(C,c,"transferSize","http.response_transfer_size"),so(C,c,"encodedBodySize","http.response_content_length"),so(C,c,"decodedBodySize","http.decoded_response_content_length"),"renderBlockingStatus"in c&&(C["resource.render_blocking_status"]=c.renderBlockingStatus),w.protocol&&(C["url.scheme"]=w.protocol.split(":").pop()),w.host&&(C["server.address"]=w.host),C["url.same_origin"]=n.includes(gs.j.location.origin);const P=y+a,V=P+p;ho(Z,{description:n.replace(gs.j.location.origin,""),endTimestamp:V,op:c.initiatorType?`resource.${c.initiatorType}`:"resource.other",origin:"auto.resource.browser.metrics",startTimestamp:P,data:C})}(Z,w,w.name,C,P,n)}}),Pl=Math.max(a.length-1,0),function fs(Z){const c=gs.j.navigator;if(!c)return;const n=c.connection;n&&(n.effectiveType&&Z.setTag("effectiveConnectionType",n.effectiveType),n.type&&Z.setTag("connectionType",n.type),Rl(n.rtt)&&(Ls["connection.rtt"]={value:n.rtt,unit:"millisecond"})),Rl(c.deviceMemory)&&Z.setTag("deviceMemory",`${c.deviceMemory} GB`),Rl(c.hardwareConcurrency)&&Z.setTag("hardwareConcurrency",String(c.hardwareConcurrency))}(Z),"pageload"===p){(function Jo(Z){const c=(0,$a.z)(),{responseStart:n,requestStart:a}=c;a<=n&&(Ps.T&&z.vF.log("[Measurements] Adding TTFB Request Time"),Z["ttfb.requestTime"]={value:n-a,unit:"millisecond"})})(Ls),["fcp","fp","lcp"].forEach(C=>{if(!Ls[C]||!y||n>=y)return;const P=Ls[C].value,V=n+io(P),K=Math.abs(1e3*(V-y));Ps.T&&z.vF.log(`[Measurements] Normalized ${C} from ${P} to ${K} (${K-P})`),Ls[C].value=K});const w=Ls["mark.fid"];w&&Ls.fid&&(ho(Z,{description:"first input delay",endTimestamp:w.value+io(Ls.fid.value),op:"ui.action",origin:"auto.ui.browser.metrics",startTimestamp:w.value}),delete Ls["mark.fid"]),"fcp"in Ls||delete Ls.cls,Object.keys(Ls).forEach(C=>{!function ha(Z,c,n){const a=tl();a&&a.setMeasurement(Z,c,n)}(C,Ls[C].value,Ls[C].unit)}),function ji(Z){la&&(Ps.T&&z.vF.log("[Measurements] Adding LCP Data"),la.element&&Z.setTag("lcp.element",(0,$e.Hd)(la.element)),la.id&&Z.setTag("lcp.id",la.id),la.url&&Z.setTag("lcp.url",la.url.trim().slice(0,200)),Z.setTag("lcp.size",la.size)),ul&&ul.sources&&(Ps.T&&z.vF.log("[Measurements] Adding CLS Data"),ul.sources.forEach((c,n)=>Z.setTag(`cls.source.${n+1}`,(0,$e.Hd)(c.node))))}(Z)}la=void 0,ul=void 0,Ls={}}(pe)}),ot}return{name:"BrowserTracing",setupOnce:()=>{},afterAllSetup(C){const P=C.getOptions(),{markBackgroundSpan:V,traceFetch:K,traceXHR:Y,shouldCreateSpanForRequest:ce,enableHTTPTimings:Pe,_experiments:Ke}=n,Ye=P&&P.tracePropagationTargets,rt=Ye||n.tracePropagationTargets;Ps.T&&c&&Ye&&z.vF.warn("[Tracing] The `tracePropagationTargets` option was set in the BrowserTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used.");let ot,pe=gs.j.location&&gs.j.location.href;C.on&&(C.on("startNavigationSpan",he=>{ot&&(Ps.T&&z.vF.log(`[Tracing] Finishing current transaction with op: ${(0,Hi.et)(ot).op}`),ot.end()),ot=w({op:"navigation",...he})}),C.on("startPageLoadSpan",he=>{ot&&(Ps.T&&z.vF.log(`[Tracing] Finishing current transaction with op: ${(0,Hi.et)(ot).op}`),ot.end()),ot=w({op:"pageload",...he})})),n.instrumentPageLoad&&C.emit&&gs.j.location&&function jo(Z,c){if(!Z.emit)return;Z.emit("startPageLoadSpan",c);const n=Ca();n&&(0,Hi.et)(n)}(C,{name:gs.j.location.pathname,startTimestamp:Fr.k3?Fr.k3/1e3:void 0,origin:"auto.pageload.browser",attributes:{[vs.i_]:"url"}}),n.instrumentNavigation&&C.emit&&gs.j.location&&(0,Tt._)(({to:he,from:gt})=>{void 0===gt&&pe&&-1!==pe.indexOf(he)?pe=void 0:gt!==he&&(pe=void 0,function Ga(Z,c){if(!Z.emit)return;Z.emit("startNavigationSpan",c);const n=Ca();n&&(0,Hi.et)(n)}(C,{name:gs.j.location.pathname,origin:"auto.navigation.browser",attributes:{[vs.i_]:"url"}}))}),V&&function Wl(){gs.j&&gs.j.document?gs.j.document.addEventListener("visibilitychange",()=>{const Z=tl();if(gs.j.document.hidden&&Z){const c="cancelled",{op:n,status:a}=(0,Hi.et)(Z);Ps.T&&z.vF.log(`[Tracing] Transaction: ${c} -> since tab moved to the background, op: ${n}`),a||Z.setStatus(c),Z.setTag("visibilitychange","document.hidden"),Z.end()}}):Ps.T&&z.vF.warn("[Tracing] Could not set up background tab detection due to lack of global document")}(),Ke.enableInteractions&&function fa(Z,c){let n;const a=()=>{const{idleTimeout:p,finalTimeout:y,heartbeatInterval:w}=Z,C="ui.action.click",P=tl();if(P&&P.op&&["navigation","pageload"].includes(P.op))return void(Ps.T&&z.vF.warn(`[Tracing] Did not create ${C} transaction because a pageload or navigation transaction is in progress.`));if(n&&(n.setFinishReason("interactionInterrupted"),n.end(),n=void 0),!c.name)return void(Ps.T&&z.vF.warn(`[Tracing] Did not create ${C} transaction because _latestRouteName is missing.`));const{location:V}=gs.j,K={name:c.name,op:C,trimEnd:!0,data:{[vs.i_]:c.context?cc(c.context):"url"}};n=Hl((0,Cn.BF)(),K,p,y,!0,{location:V},w)};["click"].forEach(p=>{addEventListener(p,a,{once:!1,capture:!0})})}(n,y),n.enableInp&&function Oi(Z,c){const n=({entries:a})=>{const p=(0,O.KU)(),y=void 0!==p&&void 0!==p.getIntegrationByName?p.getIntegrationByName("Replay"):void 0,w=void 0!==y?y.getReplayId():void 0,C=tl(),P=(0,O.o5)(),V=void 0!==P?P.getUser():void 0;a.forEach(K=>{if(function hl(Z){return"duration"in Z}(K)){const Y=K.interactionId;if(void 0===Y)return;const ce=Z[Y],Pe=K.duration,Ke=K.startTime,Ye=Object.keys(Z),rt=Ye.length>0?Ye.reduce((ot,pe)=>Z[ot].duration<Z[pe].duration?ot:pe):void 0;if("first-input"===K.entryType&&Ye.map(pe=>Z[pe]).some(pe=>pe.duration===Pe&&pe.startTime===Ke)||!Y)return;if(ce)ce.duration=Math.max(ce.duration,Pe);else if(Ye.length<Ss||void 0===rt||Pe>Z[rt].duration){const ot=c.name,pe=c.context;ot&&pe&&(rt&&Object.keys(Z).length>=Ss&&delete Z[rt],Z[Y]={routeName:ot,duration:Pe,parentContext:pe,user:V,activeTransaction:C,replayId:w,startTime:Ke})}}})};(0,ja.wv)("event",n),(0,ja.wv)("first-input",n)}(p,y),ea({traceFetch:K,traceXHR:Y,tracePropagationTargets:rt,shouldCreateSpanForRequest:ce,enableHTTPTimings:Pe})},options:n}};function ju(Z){const c=(0,$e.NX)(`meta[name=${Z}]`);return c?c.getAttribute("content"):void 0}const Ss=10;function cc(Z){return Z.attributes&&Z.attributes[vs.i_]||Z.data&&Z.data[vs.i_]||Z.metadata&&Z.metadata.source}var ta=H(4438),vo=H(1626);const zn=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Gs(Z){const c=Object.assign({defaultIntegrations:Po().filter(n=>"TryCatch"!==n.name)},Z);sn(c,"angular-ivy"),function As(){const c=ta.xvI&&ta.xvI.major?parseInt(ta.xvI.major,10):void 0;c&&(c<12&&zn&&z.vF.warn(`This Sentry SDK does not officially support Angular ${c}.`,"This SDK only supports Angular 12 and above.","If you're using Angular 10 or 11, please use `@sentry/angular` instead.","Otherwise, please consider upgrading your Angular version."),(0,O.o)("angular",{version:c}))}(),_a(c)}const fu=typeof Zone<"u"&&!!Zone.current;function dr(Z){if(Z instanceof Error)return!0;if(null===Z||"object"!=typeof Z)return!1;const c=Z;return(0,jr.Kg)(c.name)&&(0,jr.Kg)(c.message)&&(void 0===c.stack||(0,jr.Kg)(c.stack))}let xn=(()=>{class Z{constructor(n){this._registeredAfterSendEventHandler=!1,this._options=Object.assign({logErrors:!0},n)}handleError(n){const a=this._extractError(n)||"Handled unknown error",p=function pr(Z){return fu?Zone.root.run(Z):Z()}(()=>O.Cp(a,{mechanism:{type:"angular",handled:!1}}));if(this._options.logErrors&&console.error(a),this._options.showDialog){const y=O.KU();y&&y.on&&!this._registeredAfterSendEventHandler?(y.on("afterSendEvent",w=>{w.type||zi(Object.assign(Object.assign({},this._options.dialogOptions),{eventId:w.event_id}))}),this._registeredAfterSendEventHandler=!0):(!y||!y.on)&&zi(Object.assign(Object.assign({},this._options.dialogOptions),{eventId:p}))}}_extractError(n){if(this._options.extractor){const a=this._defaultExtractor.bind(this);return this._options.extractor(n,a)}return this._defaultExtractor(n)}_defaultExtractor(n){const a=function zr(Z){return Z&&Z.ngOriginalError?Z.ngOriginalError:Z}(n);return a instanceof vo.yz?function $u(Z){return dr(Z.error)?Z.error:Z.error instanceof ErrorEvent&&Z.error.message?Z.error.message:"string"==typeof Z.error?`Server returned code ${Z.status} with body "${Z.error}"`:Z.message}(a):"string"==typeof a||dr(a)?a:null}}return Z.\u0275fac=function(n){return new(n||Z)(ta.KVO("errorHandlerOptions"))},Z.\u0275prov=ta.jDH({token:Z,factory:Z.\u0275fac,providedIn:"root"}),Z})();function Un(Z){return new xn(Z)}let $c,vr=!1;function yd(Z={}){return!1!==Z.instrumentNavigation&&($c=!0,vr=!0),Zl(Object.assign(Object.assign({},Z),{instrumentNavigation:!1}))}},8458:(An,xt,H)=>{"use strict";H.d(xt,{A:()=>ye});var O=H(5272);function z(m){var ae=[1/0,1/0,-1/0,-1/0];return(0,O.Fh)(m,function(De){ae[0]>De[0]&&(ae[0]=De[0]),ae[1]>De[1]&&(ae[1]=De[1]),ae[2]<De[0]&&(ae[2]=De[0]),ae[3]<De[1]&&(ae[3]=De[1])}),ae}z.default=z;const ye=z},2035:(An,xt,H)=>{"use strict";H.d(xt,{Ay:()=>Be});var O=H(8458),z=H(6267),ye=H(3628);function ae(ct,Ue,nt,Xe,Le){var Te=nt[0],at=nt[1],Ze=ct[0],it=ct[1],Ge=Ue[0],nn=Ue[1],qt=Ge-Ze,Ht=nn-it,lt=(nt[0]-Ze)*Ht-(nt[1]-it)*qt;if(null!==Le){if(Math.abs(lt)>Le)return!1}else if(0!==lt)return!1;return Xe?"start"===Xe?Math.abs(qt)>=Math.abs(Ht)?qt>0?Ze<Te&&Te<=Ge:Ge<=Te&&Te<Ze:Ht>0?it<at&&at<=nn:nn<=at&&at<it:"end"===Xe?Math.abs(qt)>=Math.abs(Ht)?qt>0?Ze<=Te&&Te<Ge:Ge<Te&&Te<=Ze:Ht>0?it<=at&&at<nn:nn<at&&at<=it:"both"===Xe&&(Math.abs(qt)>=Math.abs(Ht)?qt>0?Ze<Te&&Te<Ge:Ge<Te&&Te<Ze:Ht>0?it<at&&at<nn:nn<at&&at<it):Math.abs(qt)>=Math.abs(Ht)?qt>0?Ze<=Te&&Te<=Ge:Ge<=Te&&Te<=Ze:Ht>0?it<=at&&at<=nn:nn<=at&&at<=it}const De=function m(ct,Ue,nt){void 0===nt&&(nt={});for(var Xe=(0,ye.uG)(ct),Le=(0,ye.$R)(Ue),Te=0;Te<Le.length-1;Te++){var at=!1;if(nt.ignoreEndVertices&&(0===Te&&(at="start"),Te===Le.length-2&&(at="end"),0===Te&&Te+1===Le.length-1&&(at="both")),ae(Le[Te],Le[Te+1],Xe,at,typeof nt.epsilon>"u"?null:nt.epsilon))return!0}return!1};function Be(ct,Ue){var nt=(0,ye.bg)(ct),Xe=(0,ye.bg)(Ue),Le=nt.type,Te=Xe.type,at=nt.coordinates,Ze=Xe.coordinates;switch(Le){case"Point":if("Point"===Te)return ht(at,Ze);throw new Error("feature2 "+Te+" geometry not supported");case"MultiPoint":switch(Te){case"Point":return function Ve(ct,Ue){var nt,Xe=!1;for(nt=0;nt<ct.coordinates.length;nt++)if(ht(ct.coordinates[nt],Ue.coordinates)){Xe=!0;break}return Xe}(nt,Xe);case"MultiPoint":return function xe(ct,Ue){for(var nt=0,Xe=Ue.coordinates;nt<Xe.length;nt++){for(var Le=Xe[nt],Te=!1,at=0,Ze=ct.coordinates;at<Ze.length;at++)if(ht(Le,Ze[at])){Te=!0;break}if(!Te)return!1}return!0}(nt,Xe);default:throw new Error("feature2 "+Te+" geometry not supported")}case"LineString":switch(Te){case"Point":return De(Xe,nt,{ignoreEndVertices:!0});case"LineString":return function He(ct,Ue){for(var nt=!1,Xe=0,Le=Ue.coordinates;Xe<Le.length;Xe++){var Te=Le[Xe];if(De({type:"Point",coordinates:Te},ct,{ignoreEndVertices:!0})&&(nt=!0),!De({type:"Point",coordinates:Te},ct,{ignoreEndVertices:!1}))return!1}return nt}(nt,Xe);case"MultiPoint":return function se(ct,Ue){for(var nt=!1,Xe=0,Le=Ue.coordinates;Xe<Le.length;Xe++){var Te=Le[Xe];if(De(Te,ct,{ignoreEndVertices:!0})&&(nt=!0),!De(Te,ct))return!1}return!!nt}(nt,Xe);default:throw new Error("feature2 "+Te+" geometry not supported")}case"Polygon":switch(Te){case"Point":return(0,z.A)(Xe,nt,{ignoreBoundary:!0});case"LineString":return function qe(ct,Ue){var nt=!1,Xe=0;if(!je((0,O.A)(ct),(0,O.A)(Ue)))return!1;for(;Xe<Ue.coordinates.length-1;Xe++){var at=et(Ue.coordinates[Xe],Ue.coordinates[Xe+1]);if((0,z.A)({type:"Point",coordinates:at},ct,{ignoreBoundary:!0})){nt=!0;break}}return nt}(nt,Xe);case"Polygon":return function Oe(ct,Ue){if("Feature"===ct.type&&null===ct.geometry||"Feature"===Ue.type&&null===Ue.geometry)return!1;if(!je((0,O.A)(ct),(0,O.A)(Ue)))return!1;for(var Te=0,at=(0,ye.bg)(Ue).coordinates;Te<at.length;Te++)for(var it=0,Ge=at[Te];it<Ge.length;it++)if(!(0,z.A)(Ge[it],ct))return!1;return!0}(nt,Xe);case"MultiPoint":return function me(ct,Ue){for(var nt=0,Xe=Ue.coordinates;nt<Xe.length;nt++)if(!(0,z.A)(Xe[nt],ct,{ignoreBoundary:!0}))return!1;return!0}(nt,Xe);default:throw new Error("feature2 "+Te+" geometry not supported")}default:throw new Error("feature1 "+Le+" geometry not supported")}}function je(ct,Ue){return!(ct[0]>Ue[0]||ct[2]<Ue[2]||ct[1]>Ue[1]||ct[3]<Ue[3])}function ht(ct,Ue){return ct[0]===Ue[0]&&ct[1]===Ue[1]}function et(ct,Ue){return[(ct[0]+Ue[0])/2,(ct[1]+Ue[1])/2]}},6267:(An,xt,H)=>{"use strict";H.d(xt,{A:()=>z});var O=H(3628);function z(ae,De,Be){if(void 0===Be&&(Be={}),!ae)throw new Error("point is required");if(!De)throw new Error("polygon is required");var Ve=(0,O.uG)(ae),xe=(0,O.bg)(De),se=xe.type,me=De.bbox,He=xe.coordinates;if(me&&!1===function m(ae,De){return De[0]<=ae[0]&&De[1]<=ae[1]&&De[2]>=ae[0]&&De[3]>=ae[1]}(Ve,me))return!1;"Polygon"===se&&(He=[He]);for(var qe=!1,Oe=0;Oe<He.length&&!qe;Oe++)if(ye(Ve,He[Oe][0],Be.ignoreBoundary)){for(var je=!1,ht=1;ht<He[Oe].length&&!je;)ye(Ve,He[Oe][ht],!Be.ignoreBoundary)&&(je=!0),ht++;je||(qe=!0)}return qe}function ye(ae,De,Be){var Ve=!1;De[0][0]===De[De.length-1][0]&&De[0][1]===De[De.length-1][1]&&(De=De.slice(0,De.length-1));for(var xe=0,se=De.length-1;xe<De.length;se=xe++){var me=De[xe][0],He=De[xe][1],qe=De[se][0],Oe=De[se][1];if(ae[1]*(me-qe)+He*(qe-ae[0])+Oe*(ae[0]-me)==0&&(me-ae[0])*(qe-ae[0])<=0&&(He-ae[1])*(Oe-ae[1])<=0)return!Be;He>ae[1]!=Oe>ae[1]&&ae[0]<(qe-me)*(ae[1]-He)/(Oe-He)+me&&(Ve=!Ve)}return Ve}},8938:(An,xt,H)=>{"use strict";H.d(xt,{A:()=>m});var O=H(3628),z=H(1354);const m=function ye(ae,De,Be){void 0===Be&&(Be={});var Ve=(0,O.uG)(ae),xe=(0,O.uG)(De),se=(0,z.tR)(xe[1]-Ve[1]),me=(0,z.tR)(xe[0]-Ve[0]),He=(0,z.tR)(Ve[1]),qe=(0,z.tR)(xe[1]),Oe=Math.pow(Math.sin(se/2),2)+Math.pow(Math.sin(me/2),2)*Math.cos(He)*Math.cos(qe);return(0,z.cJ)(2*Math.atan2(Math.sqrt(Oe),Math.sqrt(1-Oe)),Be.units)}},1354:(An,xt,H)=>{"use strict";H.d(xt,{Lr:()=>qe,N4:()=>ae,cJ:()=>Ue,tR:()=>at,zx:()=>Be});var O=6371008.8,z={centimeters:100*O,centimetres:100*O,degrees:O/111325,feet:3.28084*O,inches:39.37*O,kilometers:O/1e3,kilometres:O/1e3,meters:O,metres:O,miles:O/1609.344,millimeters:1e3*O,millimetres:1e3*O,nauticalmiles:O/1852,radians:1,yards:1.0936*O};function ae(qt,Ht,lt){void 0===lt&&(lt={});var Ct={type:"Feature"};return(0===lt.id||lt.id)&&(Ct.id=lt.id),lt.bbox&&(Ct.bbox=lt.bbox),Ct.properties=Ht||{},Ct.geometry=qt,Ct}function Be(qt,Ht,lt){if(void 0===lt&&(lt={}),!qt)throw new Error("coordinates is required");if(!Array.isArray(qt))throw new Error("coordinates must be an Array");if(qt.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ge(qt[0])||!Ge(qt[1]))throw new Error("coordinates must contain numbers");return ae({type:"Point",coordinates:qt},Ht,lt)}function qe(qt,Ht){void 0===Ht&&(Ht={});var lt={type:"FeatureCollection"};return Ht.id&&(lt.id=Ht.id),Ht.bbox&&(lt.bbox=Ht.bbox),lt.features=qt,lt}function Ue(qt,Ht){void 0===Ht&&(Ht="kilometers");var lt=z[Ht];if(!lt)throw new Error(Ht+" units is invalid");return qt*lt}function at(qt){return qt%360*Math.PI/180}function Ge(qt){return!isNaN(qt)&&null!==qt&&!Array.isArray(qt)}},3628:(An,xt,H)=>{"use strict";function z(se){if(!se)throw new Error("coord is required");if(!Array.isArray(se)){if("Feature"===se.type&&null!==se.geometry&&"Point"===se.geometry.type)return se.geometry.coordinates;if("Point"===se.type)return se.coordinates}if(Array.isArray(se)&&se.length>=2&&!Array.isArray(se[0])&&!Array.isArray(se[1]))return se;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ye(se){if(Array.isArray(se))return se;if("Feature"===se.type){if(null!==se.geometry)return se.geometry.coordinates}else if(se.coordinates)return se.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ve(se){return"Feature"===se.type?se.geometry:se}H.d(xt,{$R:()=>ye,bg:()=>Ve,uG:()=>z}),H(1354)},5272:(An,xt,H)=>{"use strict";function z(Ue,nt,Xe){if(null!==Ue)for(var Le,Te,at,Ze,it,Ge,nn,qt,bn=0,Cn=0,Ht=Ue.type,lt="FeatureCollection"===Ht,Ct="Feature"===Ht,Pt=lt?Ue.features.length:1,Qe=0;Qe<Pt;Qe++){it=(qt=!!(nn=lt?Ue.features[Qe].geometry:Ct?Ue.geometry:Ue)&&"GeometryCollection"===nn.type)?nn.geometries.length:1;for(var Tt=0;Tt<it;Tt++){var $t=0,Qt=0;if(null!==(Ze=qt?nn.geometries[Tt]:nn)){Ge=Ze.coordinates;var sn=Ze.type;switch(bn=!Xe||"Polygon"!==sn&&"MultiPolygon"!==sn?0:1,sn){case null:break;case"Point":if(!1===nt(Ge,Cn,Qe,$t,Qt))return!1;Cn++,$t++;break;case"LineString":case"MultiPoint":for(Le=0;Le<Ge.length;Le++){if(!1===nt(Ge[Le],Cn,Qe,$t,Qt))return!1;Cn++,"MultiPoint"===sn&&$t++}"LineString"===sn&&$t++;break;case"Polygon":case"MultiLineString":for(Le=0;Le<Ge.length;Le++){for(Te=0;Te<Ge[Le].length-bn;Te++){if(!1===nt(Ge[Le][Te],Cn,Qe,$t,Qt))return!1;Cn++}"MultiLineString"===sn&&$t++,"Polygon"===sn&&Qt++}"Polygon"===sn&&$t++;break;case"MultiPolygon":for(Le=0;Le<Ge.length;Le++){for(Qt=0,Te=0;Te<Ge[Le].length;Te++){for(at=0;at<Ge[Le][Te].length-bn;at++){if(!1===nt(Ge[Le][Te][at],Cn,Qe,$t,Qt))return!1;Cn++}Qt++}$t++}break;case"GeometryCollection":for(Le=0;Le<Ze.geometries.length;Le++)if(!1===z(Ze.geometries[Le],nt,Xe))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function De(Ue,nt){if("Feature"===Ue.type)nt(Ue,0);else if("FeatureCollection"===Ue.type)for(var Xe=0;Xe<Ue.features.length&&!1!==nt(Ue.features[Xe],Xe);Xe++);}H.d(xt,{Fh:()=>z,us:()=>De}),H(1354)},3069:(An,xt,H)=>{"use strict";H.d(xt,{A:()=>Le});var O=H(5272),z=H(1354);const m=function ye(Te){var at=[];return"FeatureCollection"===Te.type?(0,O.us)(Te,function(Ze){(0,O.Fh)(Ze,function(it){at.push((0,z.zx)(it,Ze.properties))})}):(0,O.Fh)(Te,function(Ze){at.push((0,z.zx)(Ze,Te.properties))}),(0,z.Lr)(at)};var ae=H(8458);function xe(Te){var at={type:"Feature"};return Object.keys(Te).forEach(function(Ze){switch(Ze){case"type":case"properties":case"geometry":return;default:at[Ze]=Te[Ze]}}),at.properties=se(Te.properties),at.geometry=He(Te.geometry),at}function se(Te){var at={};return Te&&Object.keys(Te).forEach(function(Ze){var it=Te[Ze];at[Ze]="object"==typeof it?null===it?null:Array.isArray(it)?it.map(function(Ge){return Ge}):se(it):it}),at}function He(Te){var at={type:Te.type};return Te.bbox&&(at.bbox=Te.bbox),"GeometryCollection"===Te.type?(at.geometries=Te.geometries.map(function(Ze){return He(Ze)}),at):(at.coordinates=qe(Te.coordinates),at)}function qe(Te){var at=Te;return"object"!=typeof at[0]?at.slice():at.map(function(Ze){return qe(Ze)})}var je=H(8938);const et=function ht(Te,at){if(!Te)throw new Error("targetPoint is required");if(!at)throw new Error("points is required");var Ze,it=1/0,Ge=0;return(0,O.us)(at,function(nn,bn){var Cn=(0,je.A)(Te,nn);Cn<it&&(Ge=bn,it=Cn)}),(Ze=function Ve(Te){if(!Te)throw new Error("geojson is required");switch(Te.type){case"Feature":return xe(Te);case"FeatureCollection":return function me(Te){var at={type:"FeatureCollection"};return Object.keys(Te).forEach(function(Ze){switch(Ze){case"type":case"features":return;default:at[Ze]=Te[Ze]}}),at.features=Te.features.map(function(Ze){return xe(Ze)}),at}(Te);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return He(Te);default:throw new Error("unknown GeoJSON type")}}(at.features[Ge])).properties.featureIndex=Ge,Ze.properties.distanceToPoint=it,Ze};var ct=H(6267);function Xe(Te,at,Ze,it,Ge,nn){return Math.sqrt((Ge-Ze)*(Ge-Ze)+(nn-it)*(nn-it))===Math.sqrt((Te-Ze)*(Te-Ze)+(at-it)*(at-it))+Math.sqrt((Ge-Te)*(Ge-Te)+(nn-at)*(nn-at))}const Le=function Ue(Te){for(var at=function nt(Te){return"FeatureCollection"!==Te.type?(0,z.Lr)("Feature"!==Te.type?[(0,z.N4)(Te)]:[Te]):Te}(Te),Ze=function De(Te,at){void 0===at&&(at={});var Ze=(0,ae.A)(Te);return(0,z.zx)([(Ze[0]+Ze[2])/2,(Ze[1]+Ze[3])/2],at.properties,at)}(at),it=!1,Ge=0;!it&&Ge<at.features.length;){var Pt,nn=at.features[Ge].geometry,Qe=!1;if("Point"===nn.type)Ze.geometry.coordinates[0]===nn.coordinates[0]&&Ze.geometry.coordinates[1]===nn.coordinates[1]&&(it=!0);else if("MultiPoint"===nn.type){var Tt=!1;for(Pt=0;!Tt&&Pt<nn.coordinates.length;)Ze.geometry.coordinates[0]===nn.coordinates[Pt][0]&&Ze.geometry.coordinates[1]===nn.coordinates[Pt][1]&&(it=!0,Tt=!0),Pt++}else if("LineString"===nn.type)for(Pt=0;!Qe&&Pt<nn.coordinates.length-1;)Xe(Ze.geometry.coordinates[0],Ze.geometry.coordinates[1],nn.coordinates[Pt][0],nn.coordinates[Pt][1],nn.coordinates[Pt+1][0],nn.coordinates[Pt+1][1])&&(Qe=!0,it=!0),Pt++;else if("MultiLineString"===nn.type)for(var $t=0;$t<nn.coordinates.length;){Qe=!1,Pt=0;for(var Qt=nn.coordinates[$t];!Qe&&Pt<Qt.length-1;)Xe(Ze.geometry.coordinates[0],Ze.geometry.coordinates[1],Qt[Pt][0],Qt[Pt][1],Qt[Pt+1][0],Qt[Pt+1][1])&&(Qe=!0,it=!0),Pt++;$t++}else("Polygon"===nn.type||"MultiPolygon"===nn.type)&&(0,ct.A)(Ze,nn)&&(it=!0);Ge++}if(it)return Ze;var sn=(0,z.Lr)([]);for(Ge=0;Ge<at.features.length;Ge++)sn.features=sn.features.concat(m(at.features[Ge]).features);return(0,z.zx)(et(Ze,sn).geometry.coordinates)}},9434:(An,xt,H)=>{"use strict";H.d(xt,{nn:()=>mn,u1:()=>Sr,x9:()=>kr,yv:()=>Fr});var O=H(467),z=H(4438),ye=H(1413),m=H(7673),ae=H(9030),De=H(8455),Be=H(1594),Ve=H(8141),xe=H(5558),se=H(1626),me=H(177),He=H(345);function qe(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.j41(0,"a",2),z.bIt("click",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.params.fixme())}),z.k0s()}if(2&Gt){const Ce=z.XpG();z.Y8G("innerHTML",Ce.params.fixmeMessage,z.npT)}}function Oe(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.qex(0),z.j41(1,"button",3),z.bIt("click",function(){const Mt=z.eBV(Ce).$implicit,hn=z.XpG();return z.Njj(hn.onSubmit(Mt))})("animationend",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.content.reportUpdated(null))}),z.nrm(2,"span",4),z.k0s(),z.bVm()}if(2&Gt){const Ce=Bt.$implicit,pt=z.XpG();z.R7$(),z.HbH(Ce.class||""),z.AVh("active",pt.active)("selected",pt.isSelected&&pt.equalsSelected(Ce.value))("echo",Ce.echo)("not-selected",pt.isSelected&&!pt.equalsSelected(Ce.value)),z.Y8G("disabled",!pt.enabled),z.R7$(),z.Y8G("innerHtml",Ce.display,z.npT)}}function je(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.j41(0,"a",5),z.bIt("click",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.params.fixme())}),z.k0s()}if(2&Gt){const Ce=z.XpG();z.Y8G("innerHTML",Ce.params.fixmeMessage,z.npT)}}const ht=["file"];function et(Gt,Bt){if(1&Gt&&(z.j41(0,"div",5),z.EFF(1),z.k0s()),2&Gt){const Ce=z.XpG();z.R7$(),z.JRh(Ce.content.uploadFileText)}}function ct(Gt,Bt){if(1&Gt&&(z.j41(0,"div",5),z.EFF(1),z.k0s()),2&Gt){const Ce=z.XpG();z.R7$(),z.JRh(Ce.selectedFile.name)}}function Ue(Gt,Bt){if(1&Gt&&(z.j41(0,"div",5),z.EFF(1),z.k0s()),2&Gt){const Ce=z.XpG();z.R7$(),z.JRh(Ce.content.uploadedFileText)}}function nt(Gt,Bt){if(1&Gt&&(z.j41(0,"div",5),z.EFF(1),z.k0s()),2&Gt){const Ce=z.XpG();z.R7$(),z.JRh(Ce.content.notUploadedFileText)}}function Xe(Gt,Bt){if(1&Gt&&(z.j41(0,"div",6),z.nrm(1,"div",7),z.k0s()),2&Gt){const Ce=z.XpG();z.R7$(),z.xc7("left",Ce.progressInternal-100+"%")}}function Le(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.qex(0),z.j41(1,"button",3),z.bIt("click",function(){const Mt=z.eBV(Ce).$implicit,hn=z.XpG();return z.Njj(Mt.field?hn.toggle(Mt.field):hn.onSubmit())})("animationend",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.content.reportUpdated(null))}),z.nrm(2,"span",4),z.k0s(),z.bVm()}if(2&Gt){const Ce=Bt.$implicit,pt=z.XpG();z.R7$(),z.HbH(Ce.class||""),z.AVh("active",pt.active)("selected",!!pt.value[Ce.field])("echo",Ce.echo)("not-selected",pt.selected&&!pt.value[Ce.field]),z.Y8G("disabled",!pt.enabled),z.R7$(),z.Y8G("innerHtml",Ce.display,z.npT)}}function Te(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.j41(0,"a",5),z.bIt("click",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.params.fixme())}),z.k0s()}if(2&Gt){const Ce=z.XpG();z.Y8G("innerHTML",Ce.params.fixmeMessage,z.npT)}}function Ze(Gt,Bt){}function it(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-from",3),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)("params",Ce.item.params)("first",Ce.item.first)}}function Ge(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-to",3),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)("params",Ce.item.params)("first",Ce.item.first)}}function nn(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-typing",4),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)}}function bn(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-options",5),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)("params",Ce.item.params)}}function Cn(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-multi-options",5),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)("params",Ce.item.params)}}function qt(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-uploader",5),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)("params",Ce.item.params)}}function Ht(Gt,Bt){if(1&Gt&&z.nrm(0,"htl-message-custom-component",5),2&Gt){const Ce=z.XpG();z.Y8G("content",Ce.content)("params",Ce.item.params)}}const lt=["container"];function Ct(Gt,Bt){if(1&Gt&&(z.qex(0),z.j41(1,"htl-message-switch",3),z.EFF(2," >"),z.k0s(),z.bVm()),2&Gt){const Ce=Bt.$implicit,pt=z.XpG();z.R7$(),z.xc7("display",pt.content.visibleRevision<Ce.revision?"none":"block"),z.Y8G("content",pt.content)("item",Ce)}}const Pt=["input"];function Qe(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.qex(0),z.j41(1,"div",2)(2,"textarea",3,0),z.bIt("keyup",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.validate())})("change",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.validate())}),z.k0s(),z.j41(4,"button",4),z.bIt("click",function(){z.eBV(Ce);const Mt=z.XpG();return z.Njj(Mt.onSubmit())}),z.k0s()(),z.bVm()}if(2&Gt){const Ce=z.XpG();z.R7$(2),z.Y8G("placeholder",Ce.placeholder||Ce.content.inputPlaceholder),z.R7$(2),z.Y8G("innerHTML",Ce.content.sendButtonText,z.npT)("disabled",!Ce.valid)}}function Tt(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.j41(0,"span",10),z.bIt("click",function(){const Mt=z.eBV(Ce).$implicit,hn=z.XpG(3);return z.Njj(hn.selectSuggestion(Mt))})("touchstart",function(Mt){const hn=z.eBV(Ce).$implicit,Ur=z.XpG(3);return z.Njj(Ur.selectSuggestion(hn,Mt))}),z.j41(1,"strong"),z.EFF(2),z.k0s(),z.EFF(3),z.k0s()}if(2&Gt){const Ce=Bt.$implicit;z.R7$(2),z.JRh(Ce[0]),z.R7$(),z.SpI("",Ce[1]," ")}}function $t(Gt,Bt){if(1&Gt&&(z.j41(0,"div",7)(1,"div",8),z.DNE(2,Tt,4,2,"span",9),z.k0s()()),2&Gt){const Ce=z.XpG(2);z.R7$(2),z.Y8G("ngForOf",Ce.visibleSuggestions)}}function Qt(Gt,Bt){if(1&Gt){const Ce=z.RV6();z.j41(0,"div",11)(1,"input",12,0),z.bIt("keyup",function(Mt){z.eBV(Ce);const hn=z.XpG(2);return z.Njj(hn.validate()&&13==Mt.keyCode&&hn.onSubmit())})("change",function(){z.eBV(Ce);const Mt=z.XpG(2);return z.Njj(Mt.validate())}),z.k0s(),z.j41(3,"button",13),z.bIt("click",function(){z.eBV(Ce);const Mt=z.XpG(2);return z.Njj(Mt.onSubmit())}),z.k0s()()}if(2&Gt){const Ce=z.XpG(2);z.AVh("invalid",!Ce.valid),z.R7$(),z.Y8G("type",Ce.inputKind)("disabled",!Ce.inputEnabled)("placeholder",Ce.placeholder||Ce.content.inputPlaceholder),z.BMQ("min",Ce.inputMin)("max",Ce.inputMax)("step",Ce.inputStep),z.R7$(2),z.Y8G("disabled",!Ce.valid)("innerHTML",Ce.content.sendButtonText,z.npT)}}function sn(Gt,Bt){if(1&Gt&&(z.qex(0),z.DNE(1,$t,3,1,"div",5)(2,Qt,4,10,"div",6),z.bVm()),2&Gt){const Ce=z.XpG();z.R7$(),z.Y8G("ngIf",Ce.visibleSuggestions&&Ce.visibleSuggestions.length>0),z.R7$(),z.Y8G("ngIf",Ce.inputEnabled)}}class mn{constructor(){this.messages=[],this.revision=0,this.visibleRevision=0,this.inputs=new ye.B,this.updated=new ye.B,this.inputEnabled=!1,this.textArea=!1,this.inputKind="text",this.placeholder="",this.validator=null,this.fastScroll=!1,this.scrollLock=!1,this.fixme=null,this.debug=!1,this.sendButtonText="Send",this.inputPlaceholder="Type something...",this.uploadFileText="Upload File...",this.uploadedFileText="Uploaded Successfully",this.notUploadedFileText="Failed to upload file",this.fixmeMessage="Fix",this.timeout=1e3,this.toQueue=[]}clear(){this.messages=[],this.toQueue=[]}reportValue(Bt){this.inputs.next(Bt)}reportUpdated(Bt){this.debug&&console.log("CONTENT UPDATED",this.timeout),this.timeout&&window.setTimeout(()=>{this.updated.next(Bt)},this.timeout)}add(Bt,Ce){this.messages.push({kind:Bt,params:Ce,first:0===this.messages.length||Bt!==this.messages[this.messages.length-1].kind,revision:this.revision})}queue(Bt,Ce){this.toQueue.push({kind:Bt,params:Ce}),1===this.toQueue.length&&this.typing()}queueFunction(Bt){return new Promise(Ce=>{this.queue("function",{callable:Bt,resolve:Ce})})}typing(){var Bt=this;if(this.debug&&console.log("TYPING, queue len="+this.toQueue.length),this.toQueue.length>0){const Ce=this.toQueue[0];if(this.debug&&console.log("item=",Ce),"function"===Ce.kind)this.debug&&console.log("RUNNING FUNCTION",Ce),this.toQueue.shift(),Ce.params.callable().then(Mt=>{this.debug&&console.log("FUNCTION RESOLVED to",Mt,Ce),Ce.params.resolve(Mt),this.typing()});else{this.add("typing",null);const pt=()=>{this.toQueue.shift(),this.debug&&console.log("handling item=",Ce),this.replace(Ce.kind,Ce.params),this.typing()};let Mt=this.timeout;if(this.toQueue.length>0){let hn=this.toQueue[0].params.timeout;(hn||0===hn)&&(Mt=hn)}0===Mt?pt():window.setTimeout(()=>{pt(),this.reportUpdated(Ce)},Mt)}}else window.setTimeout((0,O.A)(function*(){Bt.reportUpdated(null)}),this.timeout)}replace(Bt,Ce){this.messages[this.messages.length-1]={kind:Bt,params:Ce,first:this.messages.length<2||Bt!==this.messages[this.messages.length-2].kind}}addFrom(Bt){this.add("from",{message:Bt,fixme:this.fixme,fixmeMessage:this.fixmeMessage})}reportInput(Bt){this.reportValue(Bt),this.reportUpdated(Bt),this.textArea=!1,this.placeholder="",this.validator=null}queueFrom(Bt,Ce){this.queue("from",{message:Bt,fixme:this.fixme,fixmeMessage:this.fixmeMessage,timeout:Ce})}addTo(Bt,Ce){this.queue("to",{message:Bt,timeout:Ce})}addOptions(Bt,Ce,pt,Mt){Bt&&this.queue("to",{message:Bt}),this.queue("options",{options:Ce,selected:pt,multi:Mt,fixme:this.fixme,fixmeMessage:this.fixmeMessage})}addUploader(Bt,Ce){Bt&&this.queue("to",{message:Bt}),this.queue("uploader",Ce)}addCustomComponent(Bt,Ce,pt){return new Promise(Mt=>{this.queue("component",{step:Bt,timeout:pt,componentCreatedCallback:()=>(this.debug&&console.log("CUSTOM COMPONENT CREATED",Bt),Mt())})}).then(()=>{if(Ce)return this.queueFunction(()=>Bt.__instance.wait())})}setTextArea(){this.textArea=!0}setInputKind(Bt,Ce,pt,Mt,hn){this.inputKind=Bt||"text",this.inputRequired=!!Ce,this.inputMin=void 0===pt?null:pt,this.inputMax=void 0===Mt?null:Mt,this.inputStep=void 0===hn?null:hn}setInputSuggestions(Bt){this.inputSuggestions=Bt}setPlaceholder(Bt){this.placeholder=Bt}setValidator(Bt){this.validator=Bt}setFixme(Bt){this.fixme=Bt}setFastScroll(Bt){this.fastScroll=Bt}setScrollLock(Bt){this.scrollLock!==Bt&&(this.scrollLock=Bt,Bt?this.revision+=1:(this.visibleRevision=this.revision,this.debug&&console.log("SETTING VISIBLE REVISION",this.visibleRevision,"LAST MESSAGE",this.messages[this.messages.length-1])))}waitForInput(Bt){var Ce=this;return(0,O.A)(function*(){let pt=null;return(Bt=!1!==Bt)&&(yield Ce.queueFunction((0,O.A)(function*(){Ce.debug&&console.log("ENABLING INPUT"),pt=document.activeElement,Ce.inputEnabled=!0}))),Ce.inputs.pipe((0,Be.$)(),(0,Ve.M)(Mt=>{Ce.debug&&console.log("DISABLING INPUT, value=",Mt),Ce.inputEnabled=!1,console.log("FOCUSING",pt),pt?.focus()})).toPromise()})()}setQueueTimeout(Bt){let Ce=!1;0===this.timeout&&0!==Bt&&(Ce=!0),this.timeout=Bt,Ce&&this.reportUpdated(null)}}let Vn=(()=>{class Gt{constructor(){this.M=new mn}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275prov=z.jDH({token:Gt,factory:Gt.\u0275fac,providedIn:"root"})}return Gt})();class Fr{constructor(Bt,Ce,pt,Mt=null){this.http=Bt,this.content=Ce,this.locale=pt,this.customComponents=Mt,this.record={},this.context={},this.snippets={},this.runFastInternal=!1,this.lastMessage="",this.debug=!1,this.fixme=null,this.RETURN=0,this.COMPLETE=-1,this.BREAK=-2,this.state={},this.TIMEOUT=1e3,console.log("Running with locale",this.locale)}set timeout(Bt){this.TIMEOUT=Bt}set runFast(Bt){var Ce=this;this.runFastInternal=Bt,this.content.setScrollLock(Bt),window.setTimeout(()=>{this.content.setFastScroll(Bt),Bt||this.content.queueFunction((0,O.A)(function*(){Ce.content.reportUpdated(null)}))},0)}get runFast(){return this.runFastInternal}registerCustomComponents(Bt){this.customComponents=Bt}i18n(Bt){return Bt&&Bt[".tx"]?this.locale&&Bt[".tx"][this.locale]?Bt[".tx"][this.locale]:Bt[".tx"]._:Bt}get(Bt,Ce){const pt=Ce.split(".");for(const Mt of pt)Bt=Bt[Mt]||{};return Bt.constructor!==Object||Object.entries(Bt).length>0?Bt:null}getDefault(Bt){const Ce=this.get(this.record,Bt);return Ce?Ce+"":Bt}fillIn(Bt){return Bt.trim().replace(RegExp("(\\{\\{((\\p{L}|\\p{N}|_|\\.)+)\\}\\})","gum"),(Ce,pt,Mt)=>this.getDefault(Mt))}run(Bt,Ce,pt,Mt,hn){this.context=pt,this.setCallback=Mt||((vi,$r)=>null),this.record=hn||this.record,this.runFast=this.state&&Object.keys(this.state).length>0,this.content.setQueueTimeout(this.runFast?0:this.TIMEOUT),this.debug&&(console.log("STATE:",this.state,Object.keys(this.state)),console.log("RUN FAST enabled:",this.runFast));let Ur=null;return Ur=Bt.hasOwnProperty("s")?(0,m.of)(Bt):this.http.get(Bt),Ur.pipe((0,xe.n)(vi=>{vi=vi.s[Ce];for(const $r of vi.snippets)this.snippets[$r.name]=$r;return this.runSnippet(this.snippets.default)}))}check_res(Bt,Ce){if(this.debug&&(console.log("RETURN VALUE:",Bt),console.log("CURRENT SNIPPET:",Ce)),0===(""+Bt).indexOf("pop:")){if(!Ce.hasOwnProperty("name")||Bt.slice(4)!==Ce.name)return Bt}else{if(Bt<0)return Bt;if(Bt>0)return Ce.name?Bt-1:Bt}return 0}isInState(Bt){return Bt&&this.state.hasOwnProperty(Bt)}clearState(Bt){this.isInState(Bt)&&delete this.state[Bt]}getState(Bt){return this.state[Bt]}setState(Bt,Ce){Bt&&(this.state[Bt]=Ce)}isCustomStep(Bt){if(Bt.__component)return!0;if(this.customComponents)for(const Ce of this.customComponents)if(Bt.hasOwnProperty(Ce.keyword))return Bt.__component=Ce,!0;return!1}doCommand(Bt,Ce){var pt=this;return(0,O.A)(function*(){let Mt=pt.context[Bt.cmd];const hn=[];if(Bt.params)for(const Ur of Bt.params)if("record"===Ur)hn.push(pt.record);else if("context"===Ur)hn.push(pt.context);else if("uploader"===Ur){if(pt.content.addUploader(null),pt.isInState(Ce)){Mt=null,pt.content.queueFrom("...");break}hn.push(yield pt.content.waitForInput(!1)),pt.setState(Ce,!0)}else hn.push(pt.i18n(Ur));if(Mt){const Ur=yield pt.content.queueFunction((0,O.A)(function*(){return yield Mt(...hn)}));return pt.debug&&console.log("CALLABLE",Bt.cmd,"RETURNED",Ur),Bt.variable&&(pt.record[Bt.variable]=Ur,yield pt.setCallback(Bt.variable,Ur,pt.record)),Ur}return console.log(`ERROR: function ${Bt.cmd} is not defined`),null})()}runSnippet(Bt){var Ce=this;return(0,O.A)(function*(){Ce.debug&&console.log("RUN SNIPPET",Bt);for(const pt of Bt.steps){const Mt=Ce.lastMessage+"-"+pt.uid;if(Ce.debug&&console.log("STEP:",pt),pt.hasOwnProperty("say")){const hn=Ce.fillIn(Ce.i18n(pt.say));Ce.lastMessage=hn,Ce.content.addTo(hn)}else if(pt.hasOwnProperty("wait")){let hn=null;if(Mt&&Ce.fixme&&Ce.content.setFixme(()=>{Ce.clearState(Mt),Ce.fixme()}),pt.wait.optionsFrom&&(pt.wait.options=Ce.record[pt.wait.optionsFrom]),pt.wait.options){const Ur=[];for(const $r of pt.wait.options){$r.value=$r.hasOwnProperty("value")?$r.value:$r.show,$r.value=$r.value.hasOwnProperty(".tx")?$r.value[".tx"]._:$r.value;const ci={display:Ce.i18n($r.show),value:$r.value,field:$r.field,class:$r.class,echo:!1!==$r.echo,func:$r.do?(0,O.A)(function*(){return yield Ce.doCommand($r.do)}):null};$r.unless&&Ce.record[$r.unless]&&(ci.class="unless "+(ci.class||"")),Ur.push(ci)}const vi=!!pt.wait.multi;Ce.isInState(Mt)&&Ce.runFast?(hn=Ce.getState(Mt),Ce.content.addOptions(null,Ur,hn,vi)):(Ce.runFast&&(Ce.debug&&console.log("RUN FAST TURNED OFF"),yield Ce.content.queueFunction((0,O.A)(function*(){Ce.content.setQueueTimeout(Ce.TIMEOUT),Ce.runFast=!1}))),Ce.content.addOptions(null,Ur,null,vi),hn=yield Ce.content.waitForInput(!1),Ce.setState(Mt,hn)),pt.wait.variable&&(Ce.record[pt.wait.variable]=hn,yield Ce.setCallback(pt.wait.variable,hn,Ce.record));for(const $r of pt.wait.options)if(hn===$r.value){if(Ce.runFast&&$r.do&&(yield Ce.doCommand($r.do)),$r.steps){let ci=yield Ce.runSnippet($r);if(ci=Ce.check_res(ci,Bt),0!==ci)return ci}break}}else{if(pt.wait.long&&Ce.content.setTextArea(),Ce.content.setInputKind(pt.wait["input-kind"]||"text",!1!==pt.wait.required,pt.wait["input-min"],pt.wait["input-max"],pt.wait["input-step"]),pt.wait.suggestionsFrom&&(pt.wait.suggestions=Ce.record[pt.wait.suggestionsFrom]),Ce.content.setInputSuggestions(pt.wait.suggestions),pt.wait.placeholder&&Ce.content.setPlaceholder(Ce.i18n(pt.wait.placeholder)),pt.wait.validation){const vi=new RegExp("^"+pt.wait.validation+"$");Ce.content.setValidator($r=>vi.test($r))}else Ce.content.setValidator(vi=>!0);Ce.isInState(Mt)&&Ce.runFast?hn=Ce.getState(Mt):(Ce.runFast&&(Ce.debug&&console.log("RUN FAST TURNED OFF"),yield Ce.content.queueFunction((0,O.A)(function*(){Ce.content.setQueueTimeout(Ce.TIMEOUT),Ce.runFast=!1}))),Ce.content.queueFunction((0,O.A)(function*(){Ce.content.reportUpdated(null)})),hn=yield Ce.content.waitForInput(!0),Ce.setState(Mt,hn)),Ce.record[pt.wait.variable]=hn;let Ur=hn+"";pt.wait.response&&pt.wait.response.length&&(Ur=Ce.fillIn(pt.wait.response)),Ce.debug&&console.log(`FORMATTED ${JSON.stringify(hn)} to "${Ur}" (using ${pt.wait.response})`),Ur.length&&Ce.content.queueFrom(Ur),yield Ce.setCallback(pt.wait.variable,hn,Ce.record)}Ce.content.setFixme(null)}else if(pt.hasOwnProperty("do"))yield Ce.doCommand(pt.do,Mt);else if(pt.hasOwnProperty("switch")){const hn=pt.switch.arg,Ur=Ce.get(Ce.record,hn);Ce.debug&&console.log("SWITCH on value",Ur,"(",hn,",",Ce.record,")");let vi=null,$r=null;for(const ci of pt.switch.cases)Ce.debug&&console.log("CASE",ci),ci.default&&(Ce.debug&&console.log("CASE DEFAULT"),$r=ci),(ci.hasOwnProperty("match")&&ci.match===Ur||ci.hasOwnProperty("pattern")&&RegExp(ci.pattern).test(Ur)||ci.hasOwnProperty("undefined")&&ci.undefined&&null==Ur)&&(vi=ci);if(Ce.debug&&console.log("CASE SELECTED",vi),vi=vi||$r,vi){if(vi.steps){let ci=yield Ce.runSnippet(vi);if(ci=Ce.check_res(ci,Bt),0!==ci)return ci}}else console.log(`ERROR: no viable option for ${Ur} (${pt.switch.arg}) in switch`)}else if(pt.hasOwnProperty("goto")){if("complete"===pt.goto)return Ce.COMPLETE;if("break"===pt.goto)return Ce.BREAK;if("return"===pt.goto)return Ce.RETURN+2;const hn=Ce.snippets[pt.goto];if(hn){let Ur=yield Ce.runSnippet(hn);if(Ur=Ce.check_res(Ur,Bt),0!==Ur)return Ur}else console.log(`ERROR: unknown snippet requested ${pt.goto}`)}else{if(pt.hasOwnProperty("pop"))return"pop:"+pt.pop;if(!Ce.isCustomStep(pt))throw new Error(`Bad step ${JSON.stringify(pt)}`);{pt.__runner=Ce,pt.__runFast=Ce.runFast;let hn=null;Ce.isInState(Mt)&&Ce.runFast?(yield Ce.content.addCustomComponent(pt,!1),hn=Ce.getState(Mt)):(hn=yield Ce.content.addCustomComponent(pt,!0,pt.__component.timeout),Ce.setState(Mt,hn)),hn&&Ce.content.queueFrom(hn,0)}}}return Ce.RETURN})()}}let on=(()=>{class Gt{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-from"]],inputs:{params:"params",first:"first",content:"content"},decls:5,vars:6,consts:[[1,"speech-bubble"],["class","fixme",3,"innerHTML","click",4,"ngIf"],[1,"fixme",3,"click","innerHTML"]],template:function(pt,Mt){1&pt&&(z.j41(0,"div")(1,"p",0)(2,"span"),z.EFF(3),z.k0s()(),z.DNE(4,qe,1,1,"a",1),z.k0s()),2&pt&&(z.AVh("message-from-wrapper",!0)("first",Mt.first),z.R7$(3),z.JRh(Mt.params.message),z.R7$(),z.Y8G("ngIf",Mt.params.fixme))},dependencies:[me.bT],styles:["[_nghost-%COMP%]{display:flex;justify-content:right;flex:0 0 auto;align-items:flex-start;justify-content:flex-start}[_nghost-%COMP%]   .message-from-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:flex-end;flex-flow:row}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{flex:0 1 auto;text-align:right}"]})}return Gt})(),Or=(()=>{class Gt{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-to"]],inputs:{params:"params",first:"first",content:"content"},decls:3,vars:3,consts:[[1,"message-to-wrapper"],[1,"speech-bubble"],[3,"innerHtml"]],template:function(pt,Mt){1&pt&&(z.j41(0,"div",0)(1,"p",1),z.nrm(2,"span",2),z.k0s()()),2&pt&&(z.AVh("first",Mt.first),z.R7$(2),z.Y8G("innerHtml",Mt.params.message,z.npT))},styles:["[_nghost-%COMP%]{display:flex;justify-content:left;flex:0 0 auto;align-items:flex-end;justify-content:flex-end}[_nghost-%COMP%]   .message-to-wrapper[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:flex-start;flex-flow:row}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{flex:0 1 auto;text-align:right}"]})}return Gt})(),jr=(()=>{class Gt{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-typing"]],inputs:{content:"content"},decls:4,vars:0,consts:[[1,"typing","is-typing-init","is-typing-active"],[1,"typing__bullet"]],template:function(pt,Mt){1&pt&&(z.j41(0,"div",0),z.nrm(1,"span",1)(2,"span",1)(3,"span",1),z.k0s())},styles:["[_nghost-%COMP%]{display:flex;flex-flow:row;justify-content:flex-end;flex:0 0 auto}[_nghost-%COMP%]   .typing[_ngcontent-%COMP%]{direction:ltr;display:none;padding:35px;font-size:0;animation:_ngcontent-%COMP%_fadeInUp .2s linear 1 both}[_nghost-%COMP%]   .typing__bullet[_ngcontent-%COMP%]{display:inline-block;width:7px;height:7px;border-radius:50%;background-color:#0000004d;transition:all .3s linear}[_nghost-%COMP%]   .typing__bullet[_ngcontent-%COMP%]:not(:last-child){margin-right:3px}[_nghost-%COMP%]   .typing.is-typing-init[_ngcontent-%COMP%]{display:inline-block}[_nghost-%COMP%]   .typing.is-typing-active[_ngcontent-%COMP%]   .typing__bullet[_ngcontent-%COMP%]{background-color:#000;animation:_ngcontent-%COMP%_bounce .6s linear infinite both}[_nghost-%COMP%]   .typing.is-typing-active[_ngcontent-%COMP%]   .typing__bullet[_ngcontent-%COMP%]:nth-child(2){animation-delay:.15s}[_nghost-%COMP%]   .typing.is-typing-active[_ngcontent-%COMP%]   .typing__bullet[_ngcontent-%COMP%]:nth-child(3){animation-delay:.3s}@keyframes _ngcontent-%COMP%_bounce{0%,80%,to{opacity:1;transform:translateY(0)}50%{opacity:.5;transform:translateY(-100%)}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(50%)}to{opacity:1;transform:translateY(0)}}"]})}return Gt})(),ur=(()=>{class Gt{constructor(Ce){this.el=Ce,this.active=!1,this.enabled=!0,this.selected=null,this.isSelected=!1,this.echoSelected=!1}ngOnInit(){null!=this.params.selected&&(this.selected=this.params.selected,this.isSelected=!0),this.selectedJson=JSON.stringify(this.selected)}get multi(){return!!this.params.multi}equalsSelected(Ce){return JSON.stringify(Ce)===this.selectedJson}ngAfterViewInit(){setTimeout(()=>{this.active=!0},0)}onSubmit(Ce){const pt=Ce.value;let Mt=null;Mt=Ce.func?(0,ae.v)(Ce.func):(0,De.H)([pt]),Mt.subscribe(hn=>{null!==hn&&(this.enabled=!1,this.selected=hn,this.isSelected=!0,this.echoSelected=Ce.echo,this.selectedJson=JSON.stringify(this.selected),this.content.reportValue(this.selected))})}static#e=this.\u0275fac=function(pt){return new(pt||Gt)(z.rXU(z.aKT))};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-options"]],inputs:{params:"params",content:"content"},decls:3,vars:4,consts:[["role","group",1,"options"],[4,"ngFor","ngForOf"],["class","fixme",3,"innerHTML","click",4,"ngIf"],[3,"click","animationend","disabled"],[3,"innerHtml"],[1,"fixme",3,"click","innerHTML"]],template:function(pt,Mt){1&pt&&(z.j41(0,"span",0),z.DNE(1,Oe,3,12,"ng-container",1)(2,je,1,1,"a",2),z.k0s()),2&pt&&(z.AVh("selected",Mt.isSelected),z.R7$(),z.Y8G("ngForOf",Mt.params.options),z.R7$(),z.Y8G("ngIf",Mt.params.fixme&&Mt.echoSelected))},dependencies:[me.Sq,me.bT],styles:["[_nghost-%COMP%]{flex:0 0 auto}[_nghost-%COMP%]   .options[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;justify-content:space-evenly}"]})}return Gt})(),Ai=(()=>{class Gt{constructor(){this.progressInternal=0,this.activeInternal=!1,this.successInternal=!1,this.selectedInternal=!1,this.selectedFile=null}ngOnInit(){}addFiles(){this.file.nativeElement.click()}onFilesAdded(){const Ce=this.file.nativeElement.files;for(const pt in Ce)if(!isNaN(parseInt(pt,10))){this.selectedFile=Ce[pt],this.selectedInternal=!0,this.content.reportValue(this);break}}set progress(Ce){this.selectedInternal&&this.activeInternal&&(this.progressInternal=Ce)}set active(Ce){this.selectedInternal&&(this.activeInternal=Ce)}set success(Ce){this.activeInternal&&(this.successInternal=Ce,this.activeInternal=!1,this.progressInternal=100)}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-uploader"]],viewQuery:function(pt,Mt){if(1&pt&&z.GBs(ht,7),2&pt){let hn;z.mGM(hn=z.lsd())&&(Mt.file=hn.first)}},inputs:{params:"params",content:"content"},decls:8,vars:11,consts:[["file",""],["type","file",3,"change"],[1,"button",3,"click"],["class","message",4,"ngIf"],["class","progress",4,"ngIf"],[1,"message"],[1,"progress"],[1,"bar"]],template:function(pt,Mt){if(1&pt){const hn=z.RV6();z.j41(0,"input",1,0),z.bIt("change",function(){return z.eBV(hn),z.Njj(Mt.onFilesAdded())}),z.k0s(),z.j41(2,"div",2),z.bIt("click",function(){return z.eBV(hn),z.Njj(Mt.addFiles())}),z.DNE(3,et,2,1,"div",3)(4,ct,2,1,"div",3)(5,Ue,2,1,"div",3)(6,nt,2,1,"div",3)(7,Xe,2,2,"div",4),z.k0s()}2&pt&&(z.R7$(2),z.AVh("selected",Mt.selectedInternal)("active",Mt.activeInternal)("success",Mt.successInternal),z.R7$(),z.Y8G("ngIf",!Mt.activeInternal&&!Mt.selectedInternal),z.R7$(),z.Y8G("ngIf",Mt.activeInternal),z.R7$(),z.Y8G("ngIf",!Mt.activeInternal&&Mt.selectedInternal&&Mt.successInternal),z.R7$(),z.Y8G("ngIf",!Mt.activeInternal&&Mt.selectedInternal&&!Mt.successInternal),z.R7$(),z.Y8G("ngIf",Mt.activeInternal))},dependencies:[me.bT],styles:["[_nghost-%COMP%]{display:flex;flex-flow:row;justify-content:center;flex:0 0 auto}[_nghost-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .button[_ngcontent-%COMP%]{display:flex;flex-flow:column;justify-content:center;align-items:center}[_nghost-%COMP%]   .button[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{width:100%;text-align:center}[_nghost-%COMP%]   .button[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{height:2px;width:80%;border:none;background-color:#ccc;overflow:hidden}[_nghost-%COMP%]   .button[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background-color:green}"]})}return Gt})(),Ri=(()=>{class Gt{constructor(){this.active=!1,this.enabled=!0,this.selected=!1,this.checked=!1,this.value=null}ngOnInit(){this.value=this.params.selected||{},this.selected=!!this.params.selected,this.checkChecked()}get multi(){return!!this.params.multi}ngAfterViewInit(){setTimeout(()=>{this.active=!0,this.content.reportUpdated(null)},0)}toggle(Ce){this.value[Ce]=!this.value[Ce],this.checkChecked()}onSubmit(){this.enabled=!1,this.selected=!0,this.content.reportValue(this.value)}checkChecked(){this.checked=Object.values(this.value).indexOf(!0)>=0}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-multi-options"]],inputs:{params:"params",content:"content"},decls:3,vars:6,consts:[[1,"options"],[4,"ngFor","ngForOf"],["class","fixme",3,"innerHTML","click",4,"ngIf"],[3,"click","animationend","disabled"],[3,"innerHtml"],[1,"fixme",3,"click","innerHTML"]],template:function(pt,Mt){1&pt&&(z.j41(0,"span",0),z.DNE(1,Le,3,12,"ng-container",1)(2,Te,1,1,"a",2),z.k0s()),2&pt&&(z.AVh("selected",Mt.selected)("checked",Mt.checked),z.R7$(),z.Y8G("ngForOf",Mt.params.options),z.R7$(),z.Y8G("ngIf",Mt.params.fixme))},dependencies:[me.Sq,me.bT],styles:["[_nghost-%COMP%]{flex:0 0 auto}[_nghost-%COMP%]   .options[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap;justify-content:space-evenly}"]})}return Gt})(),nr=(()=>{class Gt{constructor(Ce){this.viewContainerRef=Ce}static#e=this.\u0275fac=function(pt){return new(pt||Gt)(z.rXU(z.c1b))};static#t=this.\u0275dir=z.FsC({type:Gt,selectors:[["","htlMessageCustomComponentAux",""]]})}return Gt})(),mr=(()=>{class Gt{constructor(Ce){this.componentFactoryResolver=Ce}ngOnInit(){const Ce=this.componentFactoryResolver.resolveComponentFactory(this.params.step.__component.cls),pt=this.inner.viewContainerRef;pt.clear();const Mt=pt.createComponent(Ce);Mt.instance.content=this.content,Mt.instance.params=this.params.step,this.params.step.__instance=Mt.instance,this.params.componentCreatedCallback()}static#e=this.\u0275fac=function(pt){return new(pt||Gt)(z.rXU(z.OM3))};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-custom-component"]],viewQuery:function(pt,Mt){if(1&pt&&z.GBs(nr,7),2&pt){let hn;z.mGM(hn=z.lsd())&&(Mt.inner=hn.first)}},inputs:{content:"content",params:"params"},decls:1,vars:0,consts:[["htlMessageCustomComponentAux",""]],template:function(pt,Mt){1&pt&&z.DNE(0,Ze,0,0,"ng-template",0)},dependencies:[nr]})}return Gt})(),Er=(()=>{class Gt{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-message-switch"]],inputs:{content:"content",item:"item"},decls:7,vars:7,consts:[[3,"content","params","first",4,"ngIf"],[3,"content",4,"ngIf"],[3,"content","params",4,"ngIf"],[3,"content","params","first"],[3,"content"],[3,"content","params"]],template:function(pt,Mt){1&pt&&z.DNE(0,it,1,3,"htl-message-from",0)(1,Ge,1,3,"htl-message-to",0)(2,nn,1,1,"htl-message-typing",1)(3,bn,1,2,"htl-message-options",2)(4,Cn,1,2,"htl-message-multi-options",2)(5,qt,1,2,"htl-message-uploader",2)(6,Ht,1,2,"htl-message-custom-component",2),2&pt&&(z.Y8G("ngIf","from"==Mt.item.kind),z.R7$(),z.Y8G("ngIf","to"==Mt.item.kind),z.R7$(),z.Y8G("ngIf","typing"==Mt.item.kind),z.R7$(),z.Y8G("ngIf","options"==Mt.item.kind&&!Mt.item.params.multi),z.R7$(),z.Y8G("ngIf","options"==Mt.item.kind&&!!Mt.item.params.multi),z.R7$(),z.Y8G("ngIf","uploader"==Mt.item.kind),z.R7$(),z.Y8G("ngIf","component"==Mt.item.kind))},dependencies:[me.bT,on,Or,jr,ur,Ai,Ri,mr],styles:["[_nghost-%COMP%]{display:block;width:100%}"]})}return Gt})(),Zn=(()=>{class Gt{constructor(){}resize(Ce){this.updateScroll()}updateScroll(){setTimeout(()=>{const Ce=this.container.nativeElement;this.content.debug&&console.log("SCROLLING TO BOTTOM"),Ce.scrollTo({left:0,top:Ce.scrollHeight,behavior:this.content.fastScroll?"auto":"smooth"})},0)}ngOnInit(){}ngOnChanges(){this.updatedSub&&this.updatedSub.unsubscribe(),this.updatedSub=this.content.updated.subscribe(()=>{this.updateScroll()})}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-messages"]],viewQuery:function(pt,Mt){if(1&pt&&z.GBs(lt,7),2&pt){let hn;z.mGM(hn=z.lsd())&&(Mt.container=hn.first)}},hostBindings:function(pt,Mt){1&pt&&z.bIt("resize",function(Ur){return Mt.resize(Ur)},!1,z.tSv)},inputs:{content:"content"},features:[z.OA$],decls:3,vars:5,consts:[["container",""],[1,"container"],[4,"ngFor","ngForOf"],[3,"content","item"]],template:function(pt,Mt){1&pt&&(z.j41(0,"div",1,0),z.DNE(2,Ct,3,4,"ng-container",2),z.k0s()),2&pt&&(z.AVh("fast-scroll",Mt.content.fastScroll)("scroll-lock",Mt.content.scrollLock),z.R7$(2),z.Y8G("ngForOf",Mt.content.messages))},dependencies:[me.Sq,Er],styles:["[_nghost-%COMP%]{display:flex;flex-flow:column;justify-content:flex-end;overflow-y:hidden;flex:1 1 100%}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;flex-flow:column;height:100%;margin-left:0;margin-right:0;flex-basis:auto;flex-grow:1;flex-shrink:1;overflow-wrap:break-word;overflow-y:auto;overflow:-moz-scrollbars-none;-ms-overflow-style:none;scroll-behavior:smooth}[_nghost-%COMP%]   .container.scroll-lock[_ngcontent-%COMP%]{overflow-y:hidden}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]::-webkit-scrollbar{width:0!important}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:first-child{margin-top:auto}[_nghost-%COMP%]   .container.fast-scroll[_ngcontent-%COMP%]{scroll-behavior:auto}"]})}return Gt})(),us=(()=>{class Gt{constructor(){this.inputRequired=!0,this.suggestions=null,this.visibleSuggestions=null,this.value=null,this.valid=!0;try{const Ce=new Intl.Collator(["he","en","ru","ar","fr","es"],{sensitivity:"base"});this.comparer=Ce.compare}catch{this.comparer=(pt,Mt)=>pt.toUpperCase()===Mt.toUpperCase()?0:1}}ngOnInit(){setTimeout(()=>{this.validate()},0)}ngOnChanges(){window.setTimeout(()=>{if(this.input){const Ce=this.input.nativeElement;Ce&&Ce.focus()}},0)}onSubmit(){const Ce=this.input.nativeElement;this.value=Ce.value,this.visibleSuggestions=null,Ce.value="",this.content.reportInput(this.value)}updateSuggestions(Ce){if(this.suggestions&&this.suggestions.length&&Ce.length>1){this.visibleSuggestions=[];const pt=Ce.length;for(const Mt of this.suggestions){const hn=Mt.slice(0,pt);0===this.comparer(Ce,hn)&&this.visibleSuggestions.push([hn,Mt.slice(pt)])}}else this.visibleSuggestions=null}selectSuggestion(Ce,pt){Ce=Ce[0]+Ce[1],this.input&&(this.input.nativeElement.value=Ce,this.validate(),this.valid&&(this.onSubmit(),this.visibleSuggestions=null)),pt&&pt.preventDefault()}validate(){if(this.input){const Ce=this.input.nativeElement.value;if(this.updateSuggestions(Ce),this.valid=!this.inputRequired||!!Ce,!this.valid)return console.log("invalid as inputRequired="+this.inputRequired+", value="+Ce),!1;if(this.valid=!this.input.nativeElement.validity||this.input.nativeElement.validity.valid,!this.valid)return console.log("invalid as nativeElement.validity="+this.input.nativeElement.validity+", validity.valid="+this.input.nativeElement.validity.valid),!1;if(this.valid=!this.validator||this.validator(Ce),!this.valid)return console.log("invalid as validator="+this.validator+", validator(value)="+this.validator(Ce)),!1}else if(this.valid=!this.validator||this.validator(""),!this.valid)return console.log("invalid as validator="+this.validator+', validator("")='+this.validator("")),!1;return this.valid}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-input"]],viewQuery:function(pt,Mt){if(1&pt&&z.GBs(Pt,5),2&pt){let hn;z.mGM(hn=z.lsd())&&(Mt.input=hn.first)}},inputs:{content:"content",inputEnabled:"inputEnabled",textArea:"textArea",inputKind:"inputKind",inputMin:"inputMin",inputMax:"inputMax",inputStep:"inputStep",placeholder:"placeholder",inputRequired:"inputRequired",suggestions:"suggestions",validator:"validator"},features:[z.OA$],decls:2,vars:2,consts:[["input",""],[4,"ngIf"],[1,"textarea"],["rows","4","autofocus","",3,"keyup","change","placeholder"],[3,"click","innerHTML","disabled"],["class","suggestions-wrapper",4,"ngIf"],["class","input",3,"invalid",4,"ngIf"],[1,"suggestions-wrapper"],[1,"suggestions"],["class","suggestion",3,"click","touchstart",4,"ngFor","ngForOf"],[1,"suggestion",3,"click","touchstart"],[1,"input"],["autofocus","",3,"keyup","change","type","disabled","placeholder"],["aria-label","SEND",3,"click","disabled","innerHTML"]],template:function(pt,Mt){1&pt&&z.DNE(0,Qe,5,3,"ng-container",1)(1,sn,3,2,"ng-container",1),2&pt&&(z.Y8G("ngIf",Mt.textArea&&Mt.inputEnabled),z.R7$(),z.Y8G("ngIf",!Mt.textArea||!Mt.inputEnabled))},dependencies:[me.Sq,me.bT],styles:["[_nghost-%COMP%]{display:flex;flex-flow:column;flex:0 0 auto}[_nghost-%COMP%]   .textarea[_ngcontent-%COMP%], [_nghost-%COMP%]   .input[_ngcontent-%COMP%]{display:flex;flex-flow:row;justify-content:stretch;align-items:center}[_nghost-%COMP%]   .textarea[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], [_nghost-%COMP%]   .input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:0 0 auto}[_nghost-%COMP%]   .textarea[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], [_nghost-%COMP%]   .input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], [_nghost-%COMP%]   .textarea[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], [_nghost-%COMP%]   .input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1 1 100%}[_nghost-%COMP%]   .suggestions-wrapper[_ngcontent-%COMP%]{position:relative;overflow:visible;width:100%;height:0px}[_nghost-%COMP%]   .suggestions-wrapper[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]{position:absolute;bottom:0;border:1px solid #89a9a8;margin:8px 0;z-index:1;width:100%;max-height:200px;overflow-y:scroll;overflow-x:hidden;display:flex;flex-flow:column;align-items:stretch;padding:0 8px;border-radius:8px;box-shadow:0 4px 8px #0000001f;background-color:#fff}[_nghost-%COMP%]   .suggestions-wrapper[_ngcontent-%COMP%]   .suggestions[_ngcontent-%COMP%]   .suggestion[_ngcontent-%COMP%]{display:flex;flex:0 0 auto;flex-flow:row;align-items:center;justify-content:flex-start;height:40px;font-size:22px;border-bottom:solid 1px rgba(0,0,0,.12);padding:0 8px;white-space:pre;cursor:pointer}"]})}return Gt})(),Hn=(()=>{class Gt{constructor(){}ngOnInit(){}static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-chatbox"]],inputs:{content:"content"},decls:2,vars:14,consts:[[3,"content"],[3,"inputEnabled","textArea","inputKind","inputMin","inputMax","inputStep","inputRequired","suggestions","content","placeholder","validator"]],template:function(pt,Mt){1&pt&&z.nrm(0,"htl-messages",0)(1,"htl-input",1),2&pt&&(z.Y8G("content",Mt.content),z.R7$(),z.AVh("enabled",Mt.content.inputEnabled),z.Y8G("inputEnabled",Mt.content.inputEnabled)("textArea",Mt.content.textArea)("inputKind",Mt.content.inputKind)("inputMin",Mt.content.inputMin)("inputMax",Mt.content.inputMax)("inputStep",Mt.content.inputStep)("inputRequired",Mt.content.inputRequired)("suggestions",Mt.content.inputSuggestions)("content",Mt.content)("placeholder",Mt.content.placeholder)("validator",Mt.content.validator))},dependencies:[Zn,us],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column}"]})}return Gt})(),Sr=(()=>{class Gt{constructor(Ce){this.contentService=Ce}ngOnInit(){this.content=this.content?this.content:this.contentService.M}static#e=this.\u0275fac=function(pt){return new(pt||Gt)(z.rXU(Vn))};static#t=this.\u0275cmp=z.VBU({type:Gt,selectors:[["htl-hatool"]],inputs:{content:"content"},decls:1,vars:1,consts:[[3,"content"]],template:function(pt,Mt){1&pt&&z.nrm(0,"htl-chatbox",0),2&pt&&z.Y8G("content",Mt.content)},dependencies:[Hn],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})}return Gt})(),kr=(()=>{class Gt{static#e=this.\u0275fac=function(pt){return new(pt||Gt)};static#t=this.\u0275mod=z.$C({type:Gt});static#n=this.\u0275inj=z.G2t({imports:[He.Bb,se.q1]})}return Gt})()},467:(An,xt,H)=>{"use strict";function O(ye,m,ae,De,Be,Ve,xe){try{var se=ye[Ve](xe),me=se.value}catch(He){return void ae(He)}se.done?m(me):Promise.resolve(me).then(De,Be)}function z(ye){return function(){var m=this,ae=arguments;return new Promise(function(De,Be){var Ve=ye.apply(m,ae);function xe(me){O(Ve,De,Be,xe,se,"next",me)}function se(me){O(Ve,De,Be,xe,se,"throw",me)}xe(void 0)})}}H.d(xt,{A:()=>z})},1635:(An,xt,H)=>{"use strict";function m(Qe,Tt){var $t={};for(var Qt in Qe)Object.prototype.hasOwnProperty.call(Qe,Qt)&&Tt.indexOf(Qt)<0&&($t[Qt]=Qe[Qt]);if(null!=Qe&&"function"==typeof Object.getOwnPropertySymbols){var sn=0;for(Qt=Object.getOwnPropertySymbols(Qe);sn<Qt.length;sn++)Tt.indexOf(Qt[sn])<0&&Object.prototype.propertyIsEnumerable.call(Qe,Qt[sn])&&($t[Qt[sn]]=Qe[Qt[sn]])}return $t}function He(Qe,Tt,$t,Qt){return new($t||($t=Promise))(function(mn,Vn){function Fr(Or){try{on(Qt.next(Or))}catch(jr){Vn(jr)}}function Ot(Or){try{on(Qt.throw(Or))}catch(jr){Vn(jr)}}function on(Or){Or.done?mn(Or.value):function sn(mn){return mn instanceof $t?mn:new $t(function(Vn){Vn(mn)})}(Or.value).then(Fr,Ot)}on((Qt=Qt.apply(Qe,Tt||[])).next())})}function Xe(Qe){return this instanceof Xe?(this.v=Qe,this):new Xe(Qe)}function Le(Qe,Tt,$t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var sn,Qt=$t.apply(Qe,Tt||[]),mn=[];return sn={},Vn("next"),Vn("throw"),Vn("return"),sn[Symbol.asyncIterator]=function(){return this},sn;function Vn(ur){Qt[ur]&&(sn[ur]=function(Ai){return new Promise(function(Ri,nr){mn.push([ur,Ai,Ri,nr])>1||Fr(ur,Ai)})})}function Fr(ur,Ai){try{!function Ot(ur){ur.value instanceof Xe?Promise.resolve(ur.value.v).then(on,Or):jr(mn[0][2],ur)}(Qt[ur](Ai))}catch(Ri){jr(mn[0][3],Ri)}}function on(ur){Fr("next",ur)}function Or(ur){Fr("throw",ur)}function jr(ur,Ai){ur(Ai),mn.shift(),mn.length&&Fr(mn[0][0],mn[0][1])}}function at(Qe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var $t,Tt=Qe[Symbol.asyncIterator];return Tt?Tt.call(Qe):(Qe=function ht(Qe){var Tt="function"==typeof Symbol&&Symbol.iterator,$t=Tt&&Qe[Tt],Qt=0;if($t)return $t.call(Qe);if(Qe&&"number"==typeof Qe.length)return{next:function(){return Qe&&Qt>=Qe.length&&(Qe=void 0),{value:Qe&&Qe[Qt++],done:!Qe}}};throw new TypeError(Tt?"Object is not iterable.":"Symbol.iterator is not defined.")}(Qe),$t={},Qt("next"),Qt("throw"),Qt("return"),$t[Symbol.asyncIterator]=function(){return this},$t);function Qt(mn){$t[mn]=Qe[mn]&&function(Vn){return new Promise(function(Fr,Ot){!function sn(mn,Vn,Fr,Ot){Promise.resolve(Ot).then(function(on){mn({value:on,done:Fr})},Vn)}(Fr,Ot,(Vn=Qe[mn](Vn)).done,Vn.value)})}}}H.d(xt,{AQ:()=>Le,N3:()=>Xe,Tt:()=>m,sH:()=>He,xN:()=>at}),"function"==typeof SuppressedError&&SuppressedError}}]);