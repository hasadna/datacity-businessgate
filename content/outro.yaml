- name: outro
  steps:
    - switch:
        arg: _topic_selection
        cases:
          - match: none
            steps:
              - say: ×œ×¤×ª×•×— ×¢×¡×§ ×–×” ×œ× ××©×—×§ ×™×œ×“×™× - ××‘×œ ×× ×—× ×• ×‘×¡×™×¤×•×¨ ×”×–×” ×‘×™×—×“!
              - say: ×× ×™ ××©××— ×œ×—×‘×¨ ×‘×™× ×š ×œ×‘×™×Ÿ ×“×§×œ×” ××™×¢×“×™×
          - default: true
            steps:
              - say: ×–×”×•, ×¢×‘×¨× ×• ×¢×œ ×›×œ ××” ×©×‘×—×¨×ª ××ª×•×š ×”× ×•×©××™× ×©××¦××ª×™ ×¨×œ×•×•× ×˜×™×™× ×œ×¢×¡×§ ×©×œ×š.
              - switch:
                  arg: _topic_selection
                  cases:
                    - default: true
                    - match: some
                      steps:
                        - say: ×¨×•×¦×” ××•×œ×™ ×œ×©××•×¢ ×¢×œ ××—×“ ×”× ×•×©××™× ×©×“×™×œ×’× ×• ×¢×œ×™×”×?
                        - topic-selection:
                            id: outro
                            choices:
                              - id: licensing
                                show: ×¨×™×©×•×™ ×”×¢×¡×§
                                requires:
                                  - business_kind
                              - id: geo_insights
                                show: ××–×•×¨ ×”× ×›×¡
                                requires:
                                  - location
                              - id: arnona
                                show: ××¨× ×•× ×”
                                requires:
                                  - business_kind
                                  - location
                              - id: business-operation
                                show: × ×™×”×•×œ ×”×¢×¡×§ ×•×”×¤×™×§×•×— ×”×¢×™×¨×•× ×™ 
                                requires: []
                              - id: signage
                                show: ×©×™×œ×•×˜
                                requires:
                                  - business_kind
                              - id: tips
                                show: ×˜×™×¤×™× ×›×œ×œ×™×™× ×œ×‘×¢×œ×™ ×¢×¡×§×™× 
                                requires: []
                              - id: demand
                                show: ×¡×§×¨ ×”×‘×™×§×•×©×™× ×©× ×¢×¨×š ×‘-2019
                                requires: []
                            responses:
                              some:
                                show: ×¡×¤×¨ ×œ×™ ×¢×•×“
                              all:
                                show: ×¡×¤×¨ ×œ×™ ×¢×•×“
                              none:
                                show: ×œ×, ×–×” ×”×›×œ, ×ª×•×“×”
                        - goto: run-all


              - say: ××¤×” ×œ×©× ××¡×¤×ª×™ ×¢×‘×•×¨×š {{stack_count}} ×›×¨×˜×™×¡×™× - ×›×•×œ× × ×’×™×©×™× ×‘×›×œ ×¢×ª ×‘×¤×™× ×” ×œ××¢×œ×”.
              
              - say: >
                  ××ª ×›×œ ×”×§×™×©×•×¨×™× ×©×”×–×›×¨× ×• ×‘×©×™×—×” ××¤×©×¨ ×œ××¦×•× ×›××Ÿ:
              - cards:
                  stack: links.×§×™×©×•×¨×™×
              - switch:
                  arg: email_address
                  cases:
                  - undefined: true
                    steps:
                      - say: ×¨×•×¦×” ×©××©×œ×— ××ª ×›×œ ×–×” ×œ××™××™×™×œ ×©×œ×š?
                      - wait:
                          options:
                            - show: ×”×××ª ×©×›×Ÿ
                              steps:
                              - goto: get-email
                            - show: ×œ× ×ª×•×“×”, ×©××¨×ª×™ ××ª ×”×œ×™× ×§ ×‘×¢×¦××™
                              steps:
                              - say: ××™×Ÿ ×‘×¢×™×”

                  - default: true
              - switch:
                  arg: email_address
                  cases:
                  - undefined: true
                  - default: true
                    steps:
                      - say: ×× ×™ ×ª×™×›×£ ××©×œ×— ×œ××™×™×œ ×©×œ×š ×¡×™×›×•× ×¢× ×›×œ ×”×§×™×©×•×¨×™× ×”××œ×”, ×©×™×”×™×• ×œ×š ×‘×”×™×©×’ ×™×“.
              

              - say: ×œ×¤×ª×•×— ×¢×¡×§ ×–×” ×œ× ××©×—×§ ×™×œ×“×™× - ××‘×œ ×× ×—× ×• ×‘×¡×™×¤×•×¨ ×”×–×” ×‘×™×—×“!
              - say: ×œ×¤× ×™ ×©× ×¤×¨×“, ×× ×™ ××©××— ×œ×—×‘×¨ ×‘×™× ×š ×œ×‘×™×Ÿ ×“×§×œ×” ××™×¢×“×™×

    - say: ×”×™× ×”-××•××—×™×ª ×œ×¤×ª×™×—×ª ×¢×¡×§×™× ×‘×¢×™×¨, ×•×”×™× ×ª×©××— ×œ×œ×•×•×ª ××•×ª×š ×‘×”××©×š ×”×ª×”×œ×™×š.
    - say: ×™×© ×”×•×“×¢×” ×©×× ×™ ×™×›×•×œ ×œ××¡×•×¨ ×œ×” ×‘×©××š? ×‘×™×Ÿ ×”×™×ª×¨ ×”×™× ×ª×©××— ×œ×©××•×¢ ×’× ×”×¢×¨×•×ª ×¢×œ ×—×•×™×™×ª ×”×©×™×—×” ××™×ª×™ ğŸ¤–
    - wait:
        options:
          - show: ××›×ª×•×‘ ×›××” ××™×œ×™×
            echo: false
            steps:
              - wait:
                  variable: _feedback
                  long: true
                  placeholder: ××” ×œ×”×¢×‘×™×¨ ×œ×“×§×œ×”? × ×©××— ×œ×©××•×¢ ×’× ×‘×™×§×•×¨×ª ×‘×•× ×”â€¦
              - say: ×ª×•×“×”, ×× ×™ ××¢×‘×™×¨ ××ª ×–×” ×”×œ××”.
              - goto: get-contact-if-needed
          - show: ×¤×©×•×˜ ×©×ª×”×™×” ××™×ª×™ ×‘×§×©×¨
            steps:
              - say: ××•×§×™×™!
              - goto: get-contact-if-needed
          - show: ××™×Ÿ ×¦×•×¨×š ×‘×©×œ×‘ ×–×”
            class: grayed
            steps:
              - say: ×‘×¡×“×¨ ×’××•×¨

    - switch:
        arg: email_address
        cases:
          - default: true
            steps:
              - switch:
                  arg: _crm_email_receipt
                  cases:
                    - undefined: true
                      steps:
                        - do:
                            cmd: send_crm_email
                            variable: _crm_email_receipt
                            params:
                              - record
                    - default: true
          - undefined: true

    - say: ×“×‘×¨ ××—×¨×•×Ÿ, ×× ×—× ×• × ×©××— ×œ×¢×–×•×¨ ×œ×¢×•×“ ×× ×©×™× ×©×¨×•×¦×™× ×œ×¤×ª×•×— ×¢×¡×§×™× ×‘×¢×™×¨ ×©×œ× ×•
    - say: ××¤×©×¨ ××•×œ×™ ×œ×‘×§×© ××™×–×” ×©×™×ª×•×£ ×§×˜×Ÿ ×©×œ ×”××ª×¨ ×¢× ××™×–×• ××™×œ×” ×˜×•×‘×”?
    - wait:
        options:
          - show: ×‘×©××—×” ×¨×‘×”
            echo: no
            steps:
              - share-dialog:
              - say: ×ª×•×“×” ×¢× ×§×™×ª ××›×•×œ× ×• ×•××× ×™ ×‘××™×•×—×“!
          - show: ×œ× ×›×¨×’×¢
            class: grayed
            steps:
              - say: ××™×Ÿ ×‘×¢×™×”
    - say: ××©××— ×××•×“ ×©× ×©××•×¨ ×¢×œ ×§×©×¨
    - say: ×•×”×›×™ ×—×©×•×‘, ×©×™×”×™×” ×”××•×Ÿ ×‘×”×¦×œ×—×”!
    - img:
        mobile:
          asset: assets/img/bot-bye.png
          justify_content: flex-start
          width: '40%'
        desktop:
          asset: assets/img/bye-desktop.png
          justify_content: flex-start
          width: '40%'
    - do:
        cmd: save
    - wait:
        options:
          - show: ×©×™×—×” ×—×“×©×”
            class: grayed
            steps:
              - do:
                  cmd: new_chat


- name: get-contact-if-needed
  steps:
    - switch:
        arg: email_address
        cases:
        - undefined: true
        - default: true
          steps:
            - say: ×“×§×œ×” ××™×¢×“×™× ×ª×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×ª×•×š ×›××” ×™××™×, ×‘×›×ª×•×‘×ª {{email_address}}
            - goto: return
    - switch:
        arg: phone_number
        cases:
        - undefined: true
        - default: true
          steps:
            - say: ×“×§×œ×” ××™×¢×“×™× ×ª×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×ª×•×š ×›××” ×™××™×, ×‘×˜×œ×¤×•×Ÿ {{phone_number}}
            - goto: return
    - say: ××™×š ×”×›×™ × ×•×— ×œ×š ×©× ×—×–×•×¨ ××œ×™×š?
    - wait:
        options:
          - show: ×‘××™××™×™×œ
            steps:
              - goto: get-email
              - switch:
                  arg: email_address
                  cases:
                  - undefined: true
                    steps:
                      - say: ×“×§×œ×” ××™×¢×“×™× ×ª×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×ª×•×š ×›××” ×™××™×, ×‘×›×ª×•×‘×ª {{email_address}}
                      - goto: return
                  - default: true
          - show: ×‘×©×™×—×ª ×˜×œ×¤×•×Ÿ
            steps:
              - goto: get-phone-number
              - switch:
                  arg: phone_number
                  cases:
                  - undefined: true
                    steps:
                      - say: ×“×§×œ×” ××™×¢×“×™× ×ª×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×ª×•×š ×›××” ×™××™×, ×‘×˜×œ×¤×•×Ÿ {{phone_number}}
                      - goto: return
                  - default: true

- name: get-email
  steps:
    - wait:
        variable: email_address
        input-kind: email
        placeholder: ×›×ª×•×‘×ª ×”××™×™×œ ×©×œ×š

- name: get-phone-number
  steps:
    - wait:
        variable: phone_number
        placeholder: ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×©×œ×š
        validation: '[-+0-9]+'
